(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"2qMH":function(e,t,i){"use strict";var n=i("Q1FS"),r=i("zB/H");t.scheduleArray=function(e,t){return new n.Observable((function(i){var n=new r.Subscription,c=0;return n.add(t.schedule((function(){c!==e.length?(i.next(e[c++]),i.closed||n.add(this.schedule())):i.complete()}))),n}))}},"9+85":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("0IaG"),r=i("fXoL"),c=i("ofXK");function o(e,t){if(1&e&&r.Rb(0,"div",5),2&e){const e=r.ic();r.oc("innerHTML",e.question.details,r.yc)}}class s{constructor(e,t,i="Cancel",n="OK"){this.question=e,this.details=t,this.cancelLabel=i,this.okLabel=n}}let a=(()=>{class e{constructor(e){this.question=e||new s("Missing question")}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(r.Qb(n.a))},e.\u0275cmp=r.Kb({type:e,selectors:[["ng-component"]],decls:10,vars:5,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-content","",1,"modal-body"],[3,"innerHTML",4,"ngIf"],["mat-dialog-close","",1,"btn","btn-primary","btn-sm","mr-2"],[1,"btn","btn-primary","btn-sm",3,"mat-dialog-close"],[3,"innerHTML"]],template:function(e,t){1&e&&(r.Wb(0,"h4",0),r.Gc(1),r.Vb(),r.Wb(2,"div",1),r.Ec(3,o,1,1,"div",2),r.Vb(),r.Rb(4,"hr"),r.Wb(5,"div"),r.Wb(6,"button",3),r.Gc(7),r.Vb(),r.Wb(8,"button",4),r.Gc(9),r.Vb(),r.Vb()),2&e&&(r.Cb(1),r.Ic("",t.question.question," "),r.Cb(2),r.oc("ngIf",t.question.details),r.Cb(4),r.Hc(t.question.cancelLabel),r.Cb(1),r.oc("mat-dialog-close",!0),r.Cb(1),r.Hc(t.question.okLabel))},directives:[n.h,n.e,c.m,n.d],encapsulation:2}),e})(),l=(()=>{class e{constructor(e){this.dialogs=e}confirm(e,t,i="Cancel",n="OK"){const r=new s(e,t,i,n);return this.dialogs.open(a,{data:r,autoFocus:!1}).afterClosed()}}return e.\u0275fac=function(t){return new(t||e)(r.ac(n.b))},e.\u0275prov=r.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},"9AGB":function(e,t,i){"use strict";var n=i("yoF8");function r(e){return 0===e.length?n.identity:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}t.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(e)},t.pipeFromArray=r},FWf1:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),r=i("pshJ"),c=i("GiSu"),o=i("zB/H"),s=i("p//D"),a=i("n3uD"),l=i("MkmW"),u=function(e){function t(i,n,r){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=c.empty;break;case 1:if(!i){o.destination=c.empty;break}if("object"==typeof i){i instanceof t?(o.syncErrorThrowable=i.syncErrorThrowable,o.destination=i,i.add(o)):(o.syncErrorThrowable=!0,o.destination=new b(o,i));break}default:o.syncErrorThrowable=!0,o.destination=new b(o,i,n,r)}return o}return n(t,e),t.prototype[s.rxSubscriber]=function(){return this},t.create=function(e,i,n){var r=new t(e,i,n);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(o.Subscription);t.Subscriber=u;var b=function(e){function t(t,i,n,o){var s,a=e.call(this)||this;a._parentSubscriber=t;var l=a;return r.isFunction(i)?s=i:i&&(s=i.next,n=i.error,o=i.complete,i!==c.empty&&(l=Object.create(i),r.isFunction(l.unsubscribe)&&a.add(l.unsubscribe.bind(l)),l.unsubscribe=a.unsubscribe.bind(a))),a._context=l,a._next=s,a._error=n,a._complete=o,a}return n(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;a.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,i=a.config.useDeprecatedSynchronousErrorHandling;if(this._error)i&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)i?(t.syncErrorValue=e,t.syncErrorThrown=!0):l.hostReportError(e),this.unsubscribe();else{if(this.unsubscribe(),i)throw e;l.hostReportError(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var i=function(){return e._complete.call(e._context)};a.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,i),this.unsubscribe()):(this.__tryOrUnsub(i),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(i){if(this.unsubscribe(),a.config.useDeprecatedSynchronousErrorHandling)throw i;l.hostReportError(i)}},t.prototype.__tryOrSetError=function(e,t,i){if(!a.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,i)}catch(n){return a.config.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=n,e.syncErrorThrown=!0,!0):(l.hostReportError(n),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(u);t.SafeSubscriber=b},GMZp:function(e,t,i){"use strict";t.isObject=function(e){return null!==e&&"object"==typeof e}},GVyA:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("fXoL"),r=i("RtrU"),c=i("qnP+"),o=i("6tuW"),s=i("BMm9"),a=i("tyNb");let l=(()=>{class e{constructor(e,t,i,n,r){this.experimentService=e,this.currentExperiment=t,this.feedback=i,this.titleSetter=n,this.router=r}}return e.\u0275fac=function(t){return new(t||e)(n.ac(r.a),n.ac(c.a),n.ac(o.a),n.ac(s.a),n.ac(a.c))},e.\u0275prov=n.Mb({token:e,factory:e.\u0275fac}),e})()},GiSu:function(e,t,i){"use strict";var n=i("n3uD"),r=i("MkmW");t.empty={closed:!0,next:function(e){},error:function(e){if(n.config.useDeprecatedSynchronousErrorHandling)throw e;r.hostReportError(e)},complete:function(){}}},I65S:function(e,t,i){"use strict";var n=i("nzqU"),r=i("zzsZ"),c=i("2qMH");t.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[e.length-1];return n.isScheduler(i)?(e.pop(),c.scheduleArray(e,i)):r.fromArray(e)}},LBXl:function(e,t,i){"use strict";t.UnsubscriptionError=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}()},MkmW:function(e,t,i){"use strict";t.hostReportError=function(e){setTimeout((function(){throw e}),0)}},OAkW:function(e,t,i){"use strict";t.subscribeToArray=function(e){return function(t){for(var i=0,n=e.length;i<n&&!t.closed;i++)t.next(e[i]);t.complete()}}},Q1FS:function(e,t,i){"use strict";var n=i("yx2s"),r=i("Xwq/"),c=i("zfKp"),o=i("9AGB"),s=i("n3uD");function a(e){if(e||(e=s.config.Promise||Promise),!e)throw new Error("no Promise impl found");return e}t.Observable=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var i=new e;return i.source=this,i.operator=t,i},e.prototype.subscribe=function(e,t,i){var n=this.operator,c=r.toSubscriber(e,t,i);if(c.add(n?n.call(c,this.source):this.source||s.config.useDeprecatedSynchronousErrorHandling&&!c.syncErrorThrowable?this._subscribe(c):this._trySubscribe(c)),s.config.useDeprecatedSynchronousErrorHandling&&c.syncErrorThrowable&&(c.syncErrorThrowable=!1,c.syncErrorThrown))throw c.syncErrorValue;return c},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){s.config.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),n.canReportError(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var i=this;return new(t=a(t))((function(t,n){var r;r=i.subscribe((function(t){try{e(t)}catch(i){n(i),r&&r.unsubscribe()}}),n,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[c.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:o.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=a(e))((function(e,i){var n;t.subscribe((function(e){return n=e}),(function(e){return i(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}()},TPWj:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{constructor(e){this.validator=e,this.errors=void 0}triggerValidation(){const e=this.validate(this.getModel());return e?(this.showErrors(e),!1):(this.clearErrors(),!0)}clearErrors(){this.errors=void 0}showErrors(e){this.errors=e}validate(e){if(this.validator){const t=this.validator.validate(e);return 0===t.length?null:t}return null}}},"Xwq/":function(e,t,i){"use strict";var n=i("FWf1"),r=i("p//D"),c=i("GiSu");t.toSubscriber=function(e,t,i){if(e){if(e instanceof n.Subscriber)return e;if(e[r.rxSubscriber])return e[r.rxSubscriber]()}return e||t||i?new n.Subscriber(e,t,i):new n.Subscriber(c.empty)}},YiFe:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("ofXK"),r=i("3Pt+"),c=i("fXoL");let o=(()=>{class e{}return e.\u0275mod=c.Ob({type:e}),e.\u0275inj=c.Nb({factory:function(t){return new(t||e)},providers:[],imports:[[n.c,r.j]]}),e})()},eLum:function(e,t,i){"use strict";i.r(t),i.d(t,"ExperimentModule",(function(){return Hi}));var n=i("ofXK"),r=i("tyNb"),c=i("pLZG"),o=i("lJxs"),s=i("qnP+"),a=i("GVyA"),l=i("fXoL"),u=i("RtrU"),b=i("vejM"),d=i("6tuW"),h=i("ZMwR"),m=i("9+85");function f(e,t){if(1&e&&(l.Wb(0,"div",2),l.Wb(1,"strong"),l.Gc(2,"Open Access: "),l.Vb(),l.Gc(3," under "),l.Wb(4,"strong"),l.Gc(5),l.Vb(),l.Gc(6," license "),l.Vb()),2&e){const e=l.ic(2);l.Cb(5),l.Hc(e.model.features.licence)}}function p(e,t){if(1&e&&(l.Wb(0,"span"),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Ic("",e.name,", ")}}function g(e,t){if(1&e&&(l.Wb(0,"div",2),l.Wb(1,"strong"),l.Gc(2,"Authors: "),l.Vb(),l.Ec(3,p,2,1,"span",5),l.Vb()),2&e){const e=l.ic(2);l.Cb(3),l.oc("ngForOf",e.model.contributionDesc.authors)}}function v(e,t){if(1&e&&(l.Wb(0,"div",1),l.Wb(1,"div",2),l.Wb(2,"strong"),l.Gc(3,"Purpose: "),l.Vb(),l.Gc(4),l.Vb(),l.Ec(5,f,7,1,"div",3),l.Ec(6,g,4,1,"div",3),l.Wb(7,"div",4),l.Wb(8,"strong"),l.Gc(9,"Data category: "),l.Vb(),l.Gc(10),l.Vb(),l.Vb()),2&e){const e=l.ic();l.Cb(4),l.Ic(" ",e.model.generalDesc.purpose," "),l.Cb(1),l.oc("ngIf",e.model.features.isOpenAccess),l.Cb(1),l.oc("ngIf",e.model.contributionDesc.authors),l.Cb(4),l.Ic(" ",null==e.model.dataCategory?null:e.model.dataCategory.longName," ")}}let y=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-experiment-basic-info-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[["class","summary-box",4,"ngIf"],[1,"summary-box"],[1,"item"],["class","item",4,"ngIf"],[1,"item","item-last"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&l.Ec(0,v,11,4,"div",0),2&e&&l.oc("ngIf",t.model)},directives:[n.m,n.l],encapsulation:2}),e})();const W=function(){return["edit"]},V=function(){return{exact:!0}};function C(e,t){1&e&&(l.Wb(0,"a",6),l.Gc(1,"Edit"),l.Vb()),2&e&&l.oc("routerLink",l.qc(2,W))("routerLinkActiveOptions",l.qc(3,V))}const E=function(){return[".","data","view","ts"]};function x(e,t){1&e&&(l.Wb(0,"a",6),l.Gc(1,"Show data"),l.Vb()),2&e&&l.oc("routerLink",l.qc(2,E))("routerLinkActiveOptions",l.qc(3,V))}const w=function(){return[".","data","view","heatmap"]};function k(e,t){1&e&&(l.Wb(0,"a",6),l.Gc(1,"Heatmap"),l.Vb()),2&e&&l.oc("routerLink",l.qc(2,w))("routerLinkActiveOptions",l.qc(3,V))}const I=function(){return["ppa/new"]};function S(e,t){1&e&&(l.Wb(0,"a",6),l.Gc(1,"Period analysis"),l.Vb()),2&e&&l.oc("routerLink",l.qc(2,I))("routerLinkActiveOptions",l.qc(3,V))}const G=function(){return["ppa"]},D=function(){return{exact:!1}};function M(e,t){1&e&&(l.Wb(0,"a",6),l.Gc(1,"Period analysis"),l.Vb()),2&e&&l.oc("routerLink",l.qc(2,G))("routerLinkActiveOptions",l.qc(3,D))}const F=function(){return["rhythmicity"]};function A(e,t){1&e&&(l.Wb(0,"a",6),l.Gc(1,"Rhythmicity"),l.Vb()),2&e&&l.oc("routerLink",l.qc(2,F))("routerLinkActiveOptions",l.qc(3,D))}const O=function(){return[".","data","ts-import"]};function q(e,t){if(1&e&&(l.Wb(0,"a",6),l.Gc(1),l.Vb()),2&e){const e=l.ic(2);l.oc("routerLink",l.qc(3,O))("routerLinkActiveOptions",l.qc(4,V)),l.Cb(1),l.Ic(" ",e.experiment.features.hasTSData?"Replace data":"Import data","")}}const T=function(){return["publish"]};function _(e,t){1&e&&(l.Wb(0,"a",6),l.Wb(1,"i",8),l.Gc(2,"lock_open"),l.Vb(),l.Vb()),2&e&&l.oc("routerLink",l.qc(2,T))("routerLinkActiveOptions",l.qc(3,V))}const N=function(){return["/experiments"]},R=function(){return["."]},P=function(){return["file"]};function L(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div",1),l.Wb(1,"nav",2),l.Wb(2,"a",3),l.Wb(3,"i",4),l.Gc(4,"fast_rewind"),l.Vb(),l.Vb(),l.Wb(5,"a",5),l.ec("click",(function(){return l.xc(e),l.ic().back()})),l.Wb(6,"i",4),l.Gc(7,"arrow_left"),l.Vb(),l.Vb(),l.Wb(8,"a",5),l.ec("click",(function(){return l.xc(e),l.ic().refresh()})),l.Wb(9,"i",4),l.Gc(10,"refresh"),l.Vb(),l.Vb(),l.Wb(11,"a",6),l.Gc(12,"Overview"),l.Vb(),l.Ec(13,C,2,4,"a",7),l.Ec(14,x,2,4,"a",7),l.Ec(15,k,2,4,"a",7),l.Ec(16,S,2,4,"a",7),l.Ec(17,M,2,4,"a",7),l.Ec(18,A,2,4,"a",7),l.Ec(19,q,2,5,"a",7),l.Wb(20,"a",6),l.Gc(21,"Files"),l.Vb(),l.Ec(22,_,3,4,"a",7),l.Vb(),l.Vb()}if(2&e){const e=l.ic();l.Cb(2),l.oc("routerLink",l.qc(13,N)),l.Cb(9),l.oc("routerLink",l.qc(14,R))("routerLinkActiveOptions",l.qc(15,V)),l.Cb(2),l.oc("ngIf",e.experiment.security.canWrite),l.Cb(1),l.oc("ngIf",e.experiment.features.hasTSData),l.Cb(1),l.oc("ngIf",e.experiment.features.hasTSData),l.Cb(1),l.oc("ngIf",e.experiment.security.canWrite&&e.experiment.features.hasTSData&&!e.experiment.features.hasPPAJobs),l.Cb(1),l.oc("ngIf",e.experiment.features.hasPPAJobs),l.Cb(1),l.oc("ngIf",e.experiment.security.canWrite&&e.experiment.features.hasTSData||e.experiment.features.hasRhythmicityJobs),l.Cb(1),l.oc("ngIf",e.experiment.security.canWrite),l.Cb(1),l.oc("routerLink",l.qc(16,P))("routerLinkActiveOptions",l.qc(17,V)),l.Cb(2),l.oc("ngIf",e.experiment.security.isOwner||e.experiment.security.isSuperOwner)}}let j=(()=>{class e{constructor(){this.onRefresh=new l.o}refresh(){this.onRefresh.emit(!0)}back(){window.history.back()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-experiment-navigation"]],inputs:{experiment:"experiment"},outputs:{onRefresh:"onRefresh"},features:[l.Bb([])],decls:1,vars:1,consts:[["style","margin-bottom: 2em;",4,"ngIf"],[2,"margin-bottom","2em"],[1,"secondary"],[3,"routerLink"],[1,"material-icons","bd-icon"],["role","button",1,"shade",3,"click"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions",4,"ngIf"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(e,t){1&e&&l.Ec(0,L,23,18,"div",0),2&e&&l.oc("ngIf",t.experiment)},directives:[n.m,r.e,r.d],encapsulation:2}),e})();function z(e,t){1&e&&(l.Wb(0,"i",7),l.Gc(1,"lock_open"),l.Vb())}function H(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Wb(1,"div",1),l.Wb(2,"div",2),l.Wb(3,"h3"),l.Ec(4,z,2,0,"i",3),l.Gc(5),l.Rb(6,"br"),l.Wb(7,"small"),l.Gc(8),l.Vb(),l.Vb(),l.Vb(),l.Wb(9,"div",4),l.Rb(10,"bd2-experiment-basic-info-view",5),l.Vb(),l.Vb(),l.Wb(11,"bd2-experiment-navigation",6),l.ec("onRefresh",(function(){return l.xc(e),l.ic().refresh()})),l.Vb(),l.Vb()}if(2&e){const e=l.ic();l.Cb(4),l.oc("ngIf",e.model.features.isOpenAccess),l.Cb(1),l.Ic(" Experiment: ",e.model.id,""),l.Cb(3),l.Hc(e.model.name),l.Cb(2),l.oc("model",e.model),l.Cb(1),l.oc("experiment",e.model)}}function B(e,t){1&e&&(l.Wb(0,"div"),l.Gc(1," ... loading experiment "),l.Wb(2,"p"),l.Gc(3,"If just logged in try to refresh the window if the experiment is not loading."),l.Vb(),l.Vb())}function X(e,t){1&e&&(l.Wb(0,"div"),l.Wb(1,"h4"),l.Gc(2,"You don't have sufficient permissions to see the experiment"),l.Vb(),l.Wb(3,"p"),l.Gc(4,"Try to login"),l.Vb(),l.Vb())}let U=(()=>{class e{constructor(e,t,i,n,r,c,o,s){this.experimentService=e,this.RDMSocial=t,this.currentExperiment=i,this.feedback=n,this.analytics=r,this.route=c,this.router=o,this.dialogs=s,this.isUnauthorised=!1}ngOnInit(){this.expSubscription=this.currentExperiment.experiment().pipe(Object(c.a)(e=>!!e)).subscribe(e=>{this.model=e,this.analytics.experimentView(e.id),this.RDMSocial.shouldShowMeasurementWarning(e).then(e=>{e&&this.showMetadataWarning()})},e=>this.feedback.error(e),()=>console.log("currentExperimentStream completed")),this.paramsSubscription=this.route.paramMap.pipe(Object(o.a)(e=>e.get("id")),Object(c.a)(e=>!!e)).subscribe(e=>this.loadExperiment(+e))}ngOnDestroy(){this.paramsSubscription&&this.paramsSubscription.unsubscribe(),this.expSubscription&&this.expSubscription.unsubscribe(),this.currentExperiment&&this.currentExperiment.close()}refresh(){this.model&&this.loadExperiment(this.model.id)}loadExperiment(e){this.experimentService.getExperiment(e).then(e=>{this.currentExperiment.push(e),this.isUnauthorised=!1}).catch(e=>{this.isUnauthorised=e.isUnauthorised,this.feedback.error(e)})}handleWarningResponse(e){console.log("Dialog: "+e)}showMetadataWarning(){this.dialogs.confirm("Metadata reminder","\n        <p>\n        Please add measurements details, like technique, equipment and short description.\n        </p>\n        <p>\n        It will improve the metadata quality and it will help you when searching for the data.\n        </p>\n","Not now").subscribe(e=>{this.RDMSocial.registerMeasurementWarning(this.model),e&&this.router.navigate(["edit"],{relativeTo:this.route,fragment:"MeasurementSection"})})}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(u.a),l.Qb(b.a),l.Qb(s.a),l.Qb(d.a),l.Qb(h.a),l.Qb(r.a),l.Qb(r.c),l.Qb(m.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["ng-component"]],features:[l.Bb([s.a,a.a])],decls:5,vars:3,consts:[[4,"ngIf"],[1,"card","asset-card"],[1,"card-header"],["class","material-icons bd-icon","style","color: green; font-size: 1.5em;",4,"ngIf"],[1,"card-body"],[3,"model"],[3,"experiment","onRefresh"],[1,"material-icons","bd-icon",2,"color","green","font-size","1.5em"]],template:function(e,t){1&e&&(l.Wb(0,"div"),l.Ec(1,H,12,5,"div",0),l.Ec(2,B,4,0,"div",0),l.Ec(3,X,5,0,"div",0),l.Rb(4,"router-outlet"),l.Vb()),2&e&&(l.Cb(1),l.oc("ngIf",t.model),l.Cb(1),l.oc("ngIf",!t.model&&!t.isUnauthorised),l.Cb(1),l.oc("ngIf",!t.model&&t.isUnauthorised))},directives:[n.m,r.g,y,j],encapsulation:2}),e})();var K=i("yYXI");function Q(e,t){if(1&e&&(l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"strong"),l.Gc(3,"Description"),l.Vb(),l.Wb(4,"div"),l.Gc(5),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(5),l.Hc(e.model.description)}}function $(e,t){if(1&e&&(l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"strong"),l.Gc(3,"Comments"),l.Vb(),l.Wb(4,"div"),l.Gc(5),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(5),l.Hc(e.model.comments)}}function J(e,t){if(1&e&&(l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"strong"),l.Gc(3,"Execution date"),l.Vb(),l.Wb(4,"div"),l.Gc(5),l.jc(6,"date"),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(5),l.Hc(l.kc(6,1,e.model.executionDate.date))}}function Y(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"h4"),l.Gc(2),l.Vb(),l.Wb(3,"div"),l.Rb(4,"hr"),l.Wb(5,"strong"),l.Gc(6,"Purpose/Hypothesis"),l.Vb(),l.Wb(7,"div"),l.Gc(8),l.Vb(),l.Vb(),l.Ec(9,Q,6,1,"div",0),l.Ec(10,$,6,1,"div",0),l.Ec(11,J,7,3,"div",0),l.Vb()),2&e){const e=l.ic();l.Cb(2),l.Hc(e.model.name),l.Cb(6),l.Hc(e.model.purpose),l.Cb(1),l.oc("ngIf",e.model.description),l.Cb(1),l.oc("ngIf",e.model.comments),l.Cb(1),l.oc("ngIf",e.model.executionDate)}}let Z=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-general-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&l.Ec(0,Y,12,5,"div",0),2&e&&l.oc("ngIf",t.model)},directives:[n.m],pipes:[n.e],encapsulation:2}),e})();function ee(e,t){if(1&e&&(l.Wb(0,"span"),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Ic("",e.name,", ")}}function te(e,t){if(1&e&&(l.Wb(0,"h4"),l.Ec(1,ee,2,1,"span",1),l.Vb()),2&e){const e=l.ic(2);l.Cb(1),l.oc("ngForOf",e.model.authors)}}function ie(e,t){if(1&e&&(l.Wb(0,"span"),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Ic("",e.name,", ")}}function ne(e,t){if(1&e&&(l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"strong"),l.Gc(3,"Data curators: "),l.Vb(),l.Ec(4,ie,2,1,"span",1),l.Vb()),2&e){const e=l.ic(2);l.Cb(4),l.oc("ngForOf",e.model.curators)}}function re(e,t){if(1&e&&(l.Wb(0,"span"),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Ic("",e.name,", ")}}function ce(e,t){if(1&e&&(l.Wb(0,"span"),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Ic("",e.name,", ")}}function oe(e,t){if(1&e&&(l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"strong"),l.Gc(3,"Institutions/Fundings: "),l.Vb(),l.Ec(4,re,2,1,"span",1),l.Ec(5,ce,2,1,"span",1),l.Vb()),2&e){const e=l.ic(2);l.Cb(4),l.oc("ngForOf",e.model.institutions),l.Cb(1),l.oc("ngForOf",e.model.fundings)}}function se(e,t){if(1&e&&(l.Wb(0,"div"),l.Ec(1,te,2,1,"h4",0),l.Ec(2,ne,5,1,"div",0),l.Ec(3,oe,6,2,"div",0),l.Vb()),2&e){const e=l.ic();l.Cb(1),l.oc("ngIf",e.model.authors.length>0),l.Cb(1),l.oc("ngIf",e.model.curators.length>0),l.Cb(1),l.oc("ngIf",e.model.institutions.length>0||e.model.fundings.length>0)}}let ae=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-contr-desc-view"]],inputs:{model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&l.Ec(0,se,4,3,"div",0),2&e&&l.oc("ngIf",t.model)},directives:[n.m,n.l],encapsulation:2}),e})();function le(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"p"),l.Wb(2,"strong"),l.Gc(3,"Species: "),l.Vb(),l.Gc(4),l.Vb(),l.Wb(5,"p"),l.Wb(6,"strong"),l.Gc(7,"Data category: "),l.Vb(),l.Gc(8),l.Vb(),l.Vb()),2&e){const e=l.ic();l.Cb(4),l.Ic(" ",e.model.species," "),l.Cb(4),l.Ic(" ",null==e.model.dataCategory?null:e.model.dataCategory.longName," ")}}let ue=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-simple-bio-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&l.Ec(0,le,9,2,"div",0),2&e&&l.oc("ngIf",t.model)},directives:[n.m],encapsulation:2}),e})();function be(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"strong"),l.Gc(2,"Details"),l.Vb(),l.Wb(3,"div"),l.Gc(4),l.Vb(),l.Vb()),2&e){const e=l.ic(3);l.Cb(4),l.Hc(e.model.description)}}function de(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"strong"),l.Gc(2,"Technique:"),l.Vb(),l.Gc(3),l.Ec(4,be,5,1,"div",0),l.Vb()),2&e){const e=l.ic(2);l.Cb(3),l.Jc(" ",e.model.technique," ",e.model.equipment?"("+e.model.equipment+")":""," "),l.Cb(1),l.oc("ngIf",e.model.description)}}function he(e,t){1&e&&(l.Wb(0,"div"),l.Gc(1," Unspecified "),l.Vb())}function me(e,t){if(1&e&&(l.Wb(0,"div"),l.Ec(1,de,5,3,"div",0),l.Ec(2,he,2,0,"div",0),l.Vb()),2&e){const e=l.ic();l.Cb(1),l.oc("ngIf",e.model.technique),l.Cb(1),l.oc("ngIf",!e.model.technique)}}let fe=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-measurement-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&l.Ec(0,me,3,2,"div",0),2&e&&l.oc("ngIf",t.model)},directives:[n.m],encapsulation:2}),e})();function pe(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"h3"),l.Gc(2,"Overview of experimental details"),l.Vb(),l.Wb(3,"div",1),l.Wb(4,"div",2),l.Gc(5,"General description"),l.Vb(),l.Wb(6,"div",3),l.Rb(7,"bd2-general-desc-view",4),l.Vb(),l.Vb(),l.Wb(8,"div",1),l.Wb(9,"div",2),l.Gc(10,"Contributions"),l.Vb(),l.Wb(11,"div",3),l.Rb(12,"bd2-contr-desc-view",4),l.Vb(),l.Vb(),l.Wb(13,"div",1),l.Wb(14,"div",2),l.Gc(15,"Biological details"),l.Vb(),l.Wb(16,"div",3),l.Rb(17,"bd2-simple-bio-desc-view",4),l.Vb(),l.Vb(),l.Wb(18,"div",1),l.Wb(19,"div",2),l.Gc(20,"Measurement details"),l.Vb(),l.Wb(21,"div",3),l.Rb(22,"bd2-measurement-desc-view",4),l.Vb(),l.Vb(),l.Vb()),2&e){const e=l.ic();l.Cb(7),l.oc("model",e.assay.generalDesc),l.Cb(5),l.oc("model",e.assay.contributionDesc),l.Cb(5),l.oc("model",e.assay),l.Cb(5),l.oc("model",e.assay.experimentalDetails.measurementDesc)}}let ge=(()=>{class e extends K.a{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(a.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["ng-component"]],features:[l.Bb([]),l.zb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"model"]],template:function(e,t){1&e&&l.Ec(0,pe,23,4,"div",0),2&e&&l.oc("ngIf",t.assay)},directives:[n.m,Z,ae,ue,fe],encapsulation:2}),e})(),ve=(()=>{class e{validate(e){const t=[];return e?(e.name&&""!=e.name.trim()||t.push("Non empty name is required"),e.purpose&&""!=e.purpose.trim()||t.push("Purpose is required"),e.purpose&&e.purpose.trim().length<20&&t.push("Purpose is too short"),t):["General description cannot be empty"]}GeneralDescValidator(){}}return e.INSTANCE=new e,e})(),ye=(()=>{class e{validate(e){return e?e.authors.length<1?["At least one author is required"]:[]:["Contribution cannot be empty"]}ContributionDescValidator(){}}return e.INSTANCE=new e,e})(),We=(()=>{class e{constructor(){}validate(e){const t=[];return e?(e.species&&""!=e.species.trim()||t.push("Non empty species is required"),e.dataCategory&&"NONE"!=e.dataCategory.name||t.push("Data category is required"),t):["Cannot validate null object"]}}return e.INSTANCE=new e,e})(),Ve=(()=>{class e{constructor(){this.generalV=ve.INSTANCE,this.contribV=ye.INSTANCE,this.bioV=We.INSTANCE}validate(e){let t=[];return t=t.concat(this.generalV.validate(e.generalDesc),this.contribV.validate(e.contributionDesc),this.bioV.validate(e)),t}}return e.INSTANCE=new e,e})();var Ce=i("TPWj");class Ee extends Ce.a{constructor(e){super(e),this.onAccepted=new l.o,this.onCancelled=new l.o}cancel(){this.clearErrors(),this.onCancelled.emit(!0)}save(){this._orgModel&&this.triggerValidation()&&(this._orgModel.setAll(this._model),this.onAccepted.emit(this._orgModel))}getModel(){return this._model}setModel(e){this._orgModel=e,e&&(this._model=e.clone())}}class xe{constructor(e){this.text=e||"",this.nextPosition=0,this.limit=this.text.length,this.currentWorld=""}next(){if(this.nextPosition>=this.limit)return"";for(;this.nextPosition<this.limit;this.nextPosition++){const e=this.text.charAt(this.nextPosition);if(" "===e||"\t"===e||"\n"===e){if(this.currentWorld){const e=this.currentWorld.toLowerCase();return this.currentWorld="",e}}else{if("."===e||","===e||":"===e||"'"===e)continue;this.currentWorld=this.currentWorld+e}}return this.currentWorld.toLowerCase()}}let we=(()=>{class e{static initBannedWords(){const e=new Set;return e.add("sensible"),e.add("description"),e.add("with"),e.add("more"),e.add("words"),e.add("required"),e.add("purpose"),e.add("hypothesis"),e}static removeLetterChain(e){if(!e)return"";const t=e.length;let i=e.charAt(0),n=e.charAt(0);for(let r=1;r<t;r++){const t=e.charAt(r);t!==n&&(n=t,i+=t)}return i}static removePairChain(e){if(!e)return"";if(e.length<4)return e;const t=e.length-1;let i=e.substring(0,2),n=i,r=2;for(;r<t;){const t=e.substring(r,r+2);t!==n?(n=n.charAt(1)+t.charAt(0),i+=t.charAt(0),r++):r+=2}return r==t&&(i+=e.charAt(e.length-1)),i}static simplifyWorld(t){let i=e.removeLetterChain(t);return i=e.removePairChain(i),i}static countDistinctCharacters(e){if(!e)return 0;const t=new Set;for(let i=0;i<e.length;i++)t.add(e.charAt(i));return t.size}static isSensibleWorld(t){if(!t)return!1;if(t.length>6&&e.countDistinctCharacters(t)<=4)return!1;if(e.bannedWords.has(t))return!1;const i=e.simplifyWorld(t);let n=4;return 4===t.length&&(n=3),t.length>10&&(n=.6*t.length),i.length>=n}}return e.bannedWords=e.initBannedWords(),e})();class ke{constructor(e){this.minWords=5,this.previouslyValid="",this.minWords=e||5}validateText(e){if(e&&this.previouslyValid&&e.startsWith(this.previouslyValid))return null;const t=this.countWords(e,this.minWords);return t<this.minWords?{minWords:"required "+this.minWords+" found: "+t}:(this.previouslyValid=e,null)}countWords(e,t){const i=new xe(e),n=new Set;for(let r=i.next();r&&n.size<t;r=i.next())we.isSensibleWorld(r)&&n.add(r);return n.size}}var Ie=i("B9cw"),Se=i("3Pt+"),Ge=i("kmnG"),De=i("qFsG"),Me=i("iadO");function Fe(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Wb(1,"form",null,1),l.Wb(3,"div",2),l.Wb(4,"mat-form-field",3),l.Wb(5,"mat-label",4),l.Gc(6,"Name"),l.Vb(),l.Wb(7,"input",5,6),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic().model.name=t})),l.Vb(),l.Wb(9,"mat-hint"),l.Gc(10,"Good name hints the data content"),l.Vb(),l.Wb(11,"mat-error"),l.Gc(12,"Descriptive name is required"),l.Vb(),l.Vb(),l.Vb(),l.Wb(13,"div",2),l.Wb(14,"mat-form-field",3),l.Wb(15,"mat-label",7),l.Gc(16,"Purpose/Hypothesis"),l.Vb(),l.Wb(17,"textarea",8,9),l.ec("input",(function(){return l.xc(e),l.ic().checkPurpose()}))("ngModelChange",(function(t){return l.xc(e),l.ic().model.purpose=t})),l.Gc(19,"                   "),l.Vb(),l.Wb(20,"mat-hint"),l.Gc(21,"Sensible description with more than few words is required"),l.Vb(),l.Vb(),l.Vb(),l.Wb(22,"div",2),l.Wb(23,"mat-form-field",3),l.Wb(24,"mat-label",10),l.Gc(25,"Description"),l.Vb(),l.Wb(26,"textarea",11,12),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic().model.description=t})),l.Gc(28,"                 "),l.Vb(),l.Vb(),l.Vb(),l.Wb(29,"div",2),l.Wb(30,"mat-form-field",3),l.Wb(31,"mat-label",13),l.Gc(32,"Comments"),l.Vb(),l.Wb(33,"textarea",14,15),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic().model.comments=t})),l.Gc(35,"                "),l.Vb(),l.Vb(),l.Vb(),l.Wb(36,"div",2),l.Wb(37,"mat-form-field"),l.Wb(38,"input",16,17),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic().executionDate=t})),l.Vb(),l.Rb(40,"mat-datepicker-toggle",18),l.Rb(41,"mat-datepicker",null,19),l.Wb(43,"mat-error"),l.Gc(44,"Date is required and cannot be much in the future"),l.Vb(),l.Vb(),l.Rb(45,"br"),l.Vb(),l.Wb(46,"button",20),l.ec("click",(function(){return l.xc(e),l.ic().save()})),l.Gc(47),l.Vb(),l.Wb(48,"button",21),l.ec("click",(function(){return l.xc(e),l.ic().cancel()})),l.Gc(49,"Cancel"),l.Vb(),l.Vb(),l.Vb()}if(2&e){const e=l.vc(2),t=l.vc(18),i=l.vc(42),n=l.ic();l.Cb(7),l.oc("ngModel",n.model.name),l.Cb(10),l.oc("ngModel",n.model.purpose),l.Cb(3),l.Dc("color",n.sufficientPurpose||t.pristine?"":"red"),l.Cb(6),l.oc("ngModel",n.model.description),l.Cb(7),l.oc("ngModel",n.model.comments),l.Cb(5),l.oc("matDatepicker",i)("ngModel",n.executionDate)("max",n.maxDate)("min",n.minDate),l.Cb(2),l.oc("for",i),l.Cb(6),l.oc("disabled",n.blocked||!e.form.valid||!n.sufficientPurpose),l.Cb(1),l.Hc(n.okLabel)}}let Ae=(()=>{class e extends Ee{constructor(){super(ve.INSTANCE),this.okLabel="Save",this.sufficientPurpose=!1,this.purposeWorldValidator=new ke(5),this.maxDate=new Date,this.maxDate.setDate(this.maxDate.getDate()+21),this.minDate=new Date,this.minDate.setFullYear(this.minDate.getFullYear()-10)}get model(){return this._model}set model(e){this.setModel(e),this.executionDate=e.executionDate.date,this.checkPurpose()}checkPurpose(){this.sufficientPurpose=null===this.purposeWorldValidator.validateText(this.model.purpose)}save(){this.model.executionDate=Ie.a.fromDate(this.executionDate),super.save()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-general-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[l.zb],decls:1,vars:1,consts:[[4,"ngIf"],["gDescForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","gName"],["matInput","","id","gName","maxlength","100","minlength","6","name","gName","placeholder","e.g. Testing robustness in low light (E12)","required","","type","text",1,"",3,"ngModel","ngModelChange"],["gName","ngModel"],["for","gPurpose"],["matInput","","id","gPurpose","minlength","55","name","gPurpose","placeholder","Describe the main aim of the experiment. What you tried to achieve, test, verify, on what kind of samples.","required","","rows","4","type","text",1,"",3,"ngModel","input","ngModelChange"],["gPurpose","ngModel"],["for","gDescription"],["matInput","","id","gDescription","name","gDescription","placeholder","Describe how the experiment was conducted, what environmental conditions, sampling procedure.\nFor example: seedlings were exposed to short day light regime (LD 6:18) at two temperatures 15 and 25. Samples where harvested every 4 hours for 3 days and the genes levels measured with RT PCR","rows","5","type","text",1,"",3,"ngModel","ngModelChange"],["gDescription","ngModel"],["for","gComments"],["matInput","","id","gComments","name","gComments","placeholder","Optional remarks, for example technical issues during the experiment, discrepancies/simplifications of in the following sections","type","text",1,"",3,"ngModel","ngModelChange"],["gComments","ngModel"],["matInput","","name","executionDate","placeholder","Exp. execution date","required","",3,"matDatepicker","ngModel","max","min","ngModelChange"],["gDate","ngModel"],["matSuffix","",3,"for"],["picker",""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(e,t){1&e&&l.Ec(0,Fe,50,13,"div",0),2&e&&l.oc("ngIf",t.model)},directives:[n.m,Se.C,Se.q,Se.r,Ge.c,Ge.g,De.b,Se.c,Se.k,Se.l,Se.y,Se.p,Se.s,Ge.f,Ge.b,Me.b,Me.d,Ge.h,Me.a],encapsulation:2}),e})();var Oe=i("kKfy"),qe=i("RkHi"),Te=i("cEDj"),_e=i("BOp5"),Ne=i("Wp6s"),Re=i("A5z7"),Pe=i("f0Cb"),Le=i("NFeN");const je=["persForm"],ze=["instForm"],He=["fundForm"];function Be(e,t){if(1&e&&(l.Wb(0,"li"),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Hc(e)}}function Xe(e,t){if(1&e&&(l.Wb(0,"div",35),l.Wb(1,"ul",36),l.Ec(2,Be,2,1,"li",37),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(2),l.oc("ngForOf",e.errors)}}function Ue(e,t){1&e&&(l.Wb(0,"p"),l.Gc(1,"Please add an author"),l.Vb())}function Ke(e,t){if(1&e){const e=l.Xb();l.Wb(0,"mat-chip",38),l.ec("removed",(function(){l.xc(e);const i=t.$implicit;return l.ic(2).removeAuthor(i)})),l.Gc(1),l.Wb(2,"mat-icon",39),l.Gc(3,"cancel"),l.Vb(),l.Vb()}if(2&e){const e=t.$implicit;l.Cb(1),l.Ic(" ",e.name," ")}}function Qe(e,t){if(1&e){const e=l.Xb();l.Wb(0,"mat-chip",38),l.ec("removed",(function(){l.xc(e);const i=t.$implicit;return l.ic(3).removeCurator(i)})),l.Gc(1),l.Wb(2,"mat-icon",39),l.Gc(3,"cancel"),l.Vb(),l.Vb()}if(2&e){const e=t.$implicit;l.Cb(1),l.Ic(" ",e.name," ")}}function $e(e,t){if(1&e&&(l.Wb(0,"div",2),l.Wb(1,"label"),l.Wb(2,"strong"),l.Gc(3,"Data curators"),l.Vb(),l.Vb(),l.Wb(4,"mat-chip-list"),l.Ec(5,Qe,4,1,"mat-chip",3),l.Vb(),l.Rb(6,"mat-divider",4),l.Vb()),2&e){const e=l.ic(2);l.Cb(5),l.oc("ngForOf",e.model.curators)}}function Je(e,t){1&e&&(l.Wb(0,"p"),l.Gc(1,"Please add an institution"),l.Vb())}function Ye(e,t){if(1&e){const e=l.Xb();l.Wb(0,"mat-chip",38),l.ec("removed",(function(){l.xc(e);const i=t.$implicit;return l.ic(2).removeInstitution(i)})),l.Gc(1),l.Wb(2,"mat-icon",39),l.Gc(3,"cancel"),l.Vb(),l.Vb()}if(2&e){const e=t.$implicit;l.Cb(1),l.Ic(" ",e.name," ")}}function Ze(e,t){if(1&e){const e=l.Xb();l.Wb(0,"mat-chip",38),l.ec("removed",(function(){l.xc(e);const i=t.$implicit;return l.ic(3).removeFunding(i)})),l.Gc(1),l.Wb(2,"mat-icon",39),l.Gc(3,"cancel"),l.Vb(),l.Vb()}if(2&e){const e=t.$implicit;l.Cb(1),l.Ic(" ",e.name," ")}}function et(e,t){if(1&e&&(l.Wb(0,"div",2),l.Wb(1,"label"),l.Wb(2,"strong"),l.Gc(3,"Fundings"),l.Vb(),l.Vb(),l.Wb(4,"mat-chip-list"),l.Ec(5,Ze,4,1,"mat-chip",3),l.Vb(),l.Rb(6,"mat-divider",4),l.Vb()),2&e){const e=l.ic(2);l.Cb(5),l.oc("ngForOf",e.model.fundings)}}function tt(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Ec(1,Xe,3,1,"div",1),l.Wb(2,"mat-card"),l.Wb(3,"mat-card-content"),l.Wb(4,"div",2),l.Wb(5,"label"),l.Wb(6,"strong"),l.Gc(7,"Authors"),l.Vb(),l.Vb(),l.Ec(8,Ue,2,0,"p",0),l.Wb(9,"mat-chip-list"),l.Ec(10,Ke,4,1,"mat-chip",3),l.Vb(),l.Rb(11,"mat-divider",4),l.Vb(),l.Ec(12,$e,7,1,"div",5),l.Wb(13,"form",6,7),l.Wb(15,"div",8),l.Wb(16,"mat-form-field"),l.Wb(17,"mat-label",9),l.Gc(18,"Name"),l.Vb(),l.Wb(19,"input",10,11),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic().firstName=t})),l.Vb(),l.Vb(),l.Vb(),l.Wb(21,"div",2),l.Wb(22,"mat-form-field"),l.Wb(23,"mat-label",12),l.Gc(24,"Surname"),l.Vb(),l.Wb(25,"input",13,14),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic().lastName=t})),l.Vb(),l.Vb(),l.Vb(),l.Wb(27,"button",15),l.ec("click",(function(){return l.xc(e),l.ic().addAuthor()})),l.Gc(28,"New Author "),l.Vb(),l.Wb(29,"button",16),l.ec("click",(function(){return l.xc(e),l.ic().addCurator()})),l.Gc(30,"New Curator "),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Rb(31,"mat-divider",17),l.Wb(32,"mat-card"),l.Wb(33,"mat-card-content"),l.Wb(34,"div",2),l.Wb(35,"label"),l.Wb(36,"strong"),l.Gc(37,"Institutions"),l.Vb(),l.Vb(),l.Ec(38,Je,2,0,"p",0),l.Wb(39,"mat-chip-list"),l.Ec(40,Ye,4,1,"mat-chip",3),l.Vb(),l.Rb(41,"mat-divider",4),l.Vb(),l.Wb(42,"form",6,18),l.Wb(44,"div",2),l.Wb(45,"mat-form-field"),l.Wb(46,"mat-label",19),l.Gc(47,"Institution"),l.Vb(),l.Wb(48,"input",20,21),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic().institutionName=t})),l.Vb(),l.Vb(),l.Vb(),l.Wb(50,"button",22),l.ec("click",(function(){return l.xc(e),l.ic().addInstitution()})),l.Gc(51," Add Institution "),l.Vb(),l.Rb(52,"mat-divider",23),l.Vb(),l.Ec(53,et,7,1,"div",5),l.Wb(54,"form",6,24),l.Wb(56,"div",2),l.Wb(57,"mat-form-field",25),l.Wb(58,"mat-label",26),l.Gc(59,"Funder"),l.Vb(),l.Wb(60,"input",27,28),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic().funderName=t})),l.Vb(),l.Vb(),l.Vb(),l.Wb(62,"div",2),l.Wb(63,"mat-form-field"),l.Wb(64,"mat-label",29),l.Gc(65,"Grant"),l.Vb(),l.Wb(66,"input",30,31),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic().grantNr=t})),l.Vb(),l.Vb(),l.Vb(),l.Wb(68,"button",22),l.ec("click",(function(){return l.xc(e),l.ic().addFunding()})),l.Gc(69," Add Funding "),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Wb(70,"div",32),l.Wb(71,"button",33),l.ec("click",(function(){return l.xc(e),l.ic().save()})),l.Gc(72),l.Vb(),l.Wb(73,"button",34),l.ec("click",(function(){return l.xc(e),l.ic().cancel()})),l.Gc(74,"Cancel"),l.Vb(),l.Vb(),l.Vb()}if(2&e){const e=l.vc(14),t=l.vc(43),i=l.vc(55),n=l.ic();l.Cb(1),l.oc("ngIf",n.errors),l.Cb(7),l.oc("ngIf",!n.model.authors||n.model.authors.length<1),l.Cb(2),l.oc("ngForOf",n.model.authors),l.Cb(2),l.oc("ngIf",n.model.curators.length>0),l.Cb(7),l.oc("ngModel",n.firstName),l.Cb(6),l.oc("ngModel",n.lastName),l.Cb(2),l.oc("disabled",!e.form.valid),l.Cb(2),l.oc("disabled",!e.form.valid),l.Cb(9),l.oc("ngIf",!n.model.institutions||n.model.institutions.length<1),l.Cb(2),l.oc("ngForOf",n.model.institutions),l.Cb(8),l.oc("ngModel",n.institutionName),l.Cb(2),l.oc("disabled",!t.form.valid),l.Cb(3),l.oc("ngIf",n.model.fundings.length>0),l.Cb(7),l.oc("ngModel",n.funderName),l.Cb(6),l.oc("ngModel",n.grantNr),l.Cb(2),l.oc("disabled",!i.form.valid),l.Cb(3),l.oc("disabled",n.blocked||n.errors),l.Cb(1),l.Hc(n.okLabel)}}let it=(()=>{class e extends Ee{constructor(){super(ye.INSTANCE),this.okLabel="Save",this.blocked=!1}get model(){return this._model}set model(e){this.setModel(e)}addAuthor(){const e=this.selectedPerson();e&&(this._model.authors.push(e),this.resetPerson(),this.triggerValidation())}addCurator(){const e=this.selectedPerson();e&&(this._model.curators.push(e),this.resetPerson())}removeAuthor(e){Object(_e.b)(e,this._model.authors),this.triggerValidation()}removeCurator(e){Object(_e.b)(e,this._model.curators)}addInstitution(){const e=this.selectedInstitution();if(e){if(this.hasInstitution(e,this._model))return;this._model.institutions.push(e),this.resetInstitution()}}hasInstitution(e,t){return t.institutions.findIndex(t=>t.name===e.name)>=0}removeInstitution(e){Object(_e.b)(e,this.model.institutions)}addFunding(){const e=this.selectedFunding();if(e){if(this.hasFunding(e,this._model))return;this._model.fundings.push(e),this.resetFunding()}}hasFunding(e,t){return t.fundings.findIndex(t=>t.name===e.name)>=0}removeFunding(e){Object(_e.b)(e,this._model.fundings)}resetPerson(){this.firstName=void 0,this.lastName=void 0,this.persForm.reset()}selectedPerson(){return this.firstName&&this.lastName?new Te.a(this.firstName,this.lastName):null}resetInstitution(){this.institutionName=void 0,this.instForm.reset()}selectedInstitution(){return this.institutionName?new qe.a(this.institutionName):null}resetFunding(){this.funderName=void 0,this.grantNr=void 0,this.fundForm.reset()}selectedFunding(){if(this.funderName){const e=new qe.a(this.funderName),t=new Oe.a;return t.institution=e,t.grantNr=this.grantNr,t}return null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-contr-desc-form"]],viewQuery:function(e,t){var i;1&e&&(l.Mc(je,!0),l.Mc(ze,!0),l.Mc(He,!0)),2&e&&(l.uc(i=l.fc())&&(t.persForm=i.first),l.uc(i=l.fc())&&(t.instForm=i.first),l.uc(i=l.fc())&&(t.fundForm=i.first))},inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[l.zb],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"form-group"],[3,"removed",4,"ngFor","ngForOf"],["inset","",1,"mt-2"],["class","form-group",4,"ngIf"],[1,"form-inline"],["persForm","ngForm"],[1,"form-group","mr-1"],["for","pFirst"],["matInput","","id","pFirst","maxlength","100","minlength","2","name","pFirst","placeholder","e.g. John)","required","","type","text",3,"ngModel","ngModelChange"],["pFirst","ngModel"],["for","pLast"],["matInput","","id","pLast","maxlength","100","minlength","2","name","pLast","placeholder","e.g. Smith","required","","type","text",3,"ngModel","ngModelChange"],["pLast","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","mr-1","ml-1",3,"disabled","click"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"mb-1"],["instForm","ngForm"],["for","iName"],["matInput","","id","iName","maxlength","100","minlength","3","name","iName","placeholder","e.g. University of Edinburgh","required","","type","text",1,"",3,"ngModel","ngModelChange"],["iName","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","ml-1",3,"disabled","click"],["inset","",1,"mt-1","mb-2"],["fundForm","ngForm"],[1,"mr-1"],["for","fName"],["matInput","","id","fName","maxlength","100","minlength","3","name","fName","placeholder","e.g. BBSRC","required","","type","text",1,"",3,"ngModel","ngModelChange"],["fName","ngModel"],["for","fGrant"],["matInput","","id","fGrant","maxlength","100","minlength","3","name","fGrant","placeholder","e.g. EC2014","type","text",1,"",3,"ngModel","ngModelChange"],["fGrant","ngModel"],[1,"mt-2"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"alert","alert-danger"],[1,"mb-0"],[4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""]],template:function(e,t){1&e&&l.Ec(0,tt,75,18,"div",0),2&e&&l.oc("ngIf",t.model)},directives:[n.m,Ne.a,Ne.c,Re.c,n.l,Pe.a,Se.C,Se.q,Se.r,Ge.c,Ge.g,De.b,Se.c,Se.k,Se.l,Se.y,Se.p,Se.s,Re.a,Le.a,Re.d],encapsulation:2}),e})();var nt=i("FUU9"),rt=i("D0XW");const ct=(()=>{function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e})();var ot=i("mlxB"),st=i("l7GE"),at=i("ZUHj");class lt{constructor(e,t,i,n){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=i,this.scheduler=n}call(e,t){return t.subscribe(new ut(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))}}class ut extends st.a{constructor(e,t,i,n,r){super(e),this.absoluteTimeout=t,this.waitFor=i,this.withObservable=n,this.scheduler=r,this.action=null,this.scheduleTimeout()}static dispatchTimeout(e){const{withObservable:t}=e;e._unsubscribeAndRecycle(),e.add(Object(at.a)(e,t))}scheduleTimeout(){const{action:e}=this;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(ut.dispatchTimeout,this.waitFor,this))}_next(e){this.absoluteTimeout||this.scheduleTimeout(),super._next(e)}_unsubscribe(){this.action=null,this.scheduler=null,this.withObservable=null}}var bt=i("z6cu"),dt=i("vkgz"),ht=i("JIr8"),mt=i("I65S"),ft=i("UsWK");let pt=(()=>{class e{constructor(e){this.BD2REST=e,this.popularSpecies=["Arabidopsis thaliana","Brassica rapa","Danio rerio","Drosophila melanogaster","Glycine max","Homo sapiens","Lemna gibba","Lemna minor","Marchantia polymorpha","Medicago truncatula","Mus musculus","Nannochloropsis","Neurospora crassa","Oryza sativa","Ostreococcus tauri","Phaeodactylum tricornutum","Physcometrella patens","Picea abies","Rattus norvegicus","Saccharomyces cerevisiae","Synechococcus elongatus","Synthetic data"],this.fetchedSpecies=void 0,console.log("Species Service")}species(){return this.fetchedSpecies?Promise.resolve(this.fetchedSpecies):this.fetchSpecies().toPromise()}fetchSpecies(){return this.BD2REST.species().pipe(function(e,t=rt.a){return function(e,t,i=rt.a){return n=>{let r=Object(ot.a)(e),c=r?+e-i.now():Math.abs(e);return n.lift(new lt(c,r,t,i))}}(5e3,Object(bt.a)(new ct),t)}(),Object(dt.a)(e=>{if(!(e&&e.length>0))throw new Error("Retrieved empty species falls back to default");this.fetchedSpecies=e}),Object(ht.a)(e=>(console.log(" Could not fetch species",e),Object(mt.of)(this.popularSpecies))))}}return e.\u0275fac=function(t){return new(t||e)(l.ac(ft.a))},e.\u0275prov=l.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var gt=i("d3UM"),vt=i("FKr1");function yt(e,t){if(1&e&&(l.Wb(0,"mat-option",13),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.oc("value",e),l.Cb(1),l.Ic("",e," ")}}function Wt(e,t){if(1&e&&(l.Wb(0,"mat-option",13),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.oc("value",e.name),l.Cb(1),l.Ic(" ",e.longName," ")}}function Vt(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Wb(1,"form",null,1),l.Wb(3,"div",2),l.Wb(4,"mat-form-field",3),l.Wb(5,"mat-label",4),l.Gc(6,"Species"),l.Vb(),l.Wb(7,"mat-select",5,6),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic()._model.species=t})),l.Ec(9,yt,2,2,"mat-option",7),l.Vb(),l.Wb(10,"mat-hint"),l.Gc(11,"Please email us if you don't see suitable terms in the value lists"),l.Vb(),l.Vb(),l.Vb(),l.Wb(12,"div",2),l.Wb(13,"mat-form-field",3),l.Wb(14,"mat-label",8),l.Gc(15,"Data category"),l.Vb(),l.Wb(16,"mat-select",9,10),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic()._model.category=t})),l.Ec(18,Wt,2,2,"mat-option",7),l.Vb(),l.Wb(19,"mat-hint"),l.Gc(20,"Please email us if you don't see suitable terms in the value lists"),l.Vb(),l.Vb(),l.Vb(),l.Wb(21,"button",11),l.ec("click",(function(){return l.xc(e),l.ic().save()})),l.Gc(22),l.Vb(),l.Wb(23,"button",12),l.ec("click",(function(){return l.xc(e),l.ic().cancel()})),l.Gc(24,"Cancel"),l.Vb(),l.Vb(),l.Vb()}if(2&e){const e=l.vc(2),t=l.ic();l.Cb(7),l.oc("ngModel",t._model.species),l.Cb(2),l.oc("ngForOf",t.knownSpecies),l.Cb(7),l.oc("ngModel",t._model.category),l.Cb(2),l.oc("ngForOf",t.categories),l.Cb(3),l.oc("disabled",t.blocked||!e.form.valid),l.Cb(1),l.Hc(t.okLabel)}}let Ct=(()=>{class e extends Ce.a{constructor(e){super(),this.speciesService=e,this.okLabel="Save",this.blocked=!1,this.onAccepted=new l.o,this.onCancelled=new l.o,this.categories=[],this.knownSpecies=[],this._model={species:null,category:null}}set model(e){e&&(this.experiment=e,this._model.species=e.species,this._model.category=e.dataCategory?e.dataCategory.name:null)}getModel(){return this._model}ngOnInit(){this.speciesService.species().then(e=>this.knownSpecies=e),this.categories=this.initCategories()}cancel(){this.clearErrors(),this.onCancelled.emit(!0)}save(){this.triggerValidation()&&(this.experiment.dataCategory=nt.a.get(this._model.category),this.experiment.species=this._model.species,this.onAccepted.emit(this.experiment))}validate(e){const t=[];return e.species&&""!==e.species.trim()||t.push("Species cannot be empty"),e.species&&this.knownSpecies.indexOf(e.species)<0&&t.push("Unknown species: "+e.species),e.category&&"NONE"!==e.category||t.push("Data category is required"),0===t.length?null:t}initCategories(){const e=nt.a.getValidOptions().slice();return Object(_e.b)(nt.a.get("NONE"),e),e}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(pt))},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-simple-bio-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[l.zb],decls:1,vars:1,consts:[[4,"ngIf"],["sBioForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","species"],["id","species","required","","placeholder","Select species","name","species",1,"",3,"ngModel","ngModelChange"],["species","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","dataCategory"],["id","dataCategory","required","","placeholder","Select category","name","dataCategory",1,"",3,"ngModel","ngModelChange"],["dataCategory","ngModel"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(e,t){1&e&&l.Ec(0,Vt,25,6,"div",0),2&e&&l.oc("ngIf",t.experiment)},directives:[n.m,Se.C,Se.q,Se.r,Ge.c,Ge.g,gt.a,Se.y,Se.p,Se.s,n.l,Ge.f,vt.o],encapsulation:2}),e})();var Et=i("LRne"),xt=i("JX91"),wt=i("zrmi");let kt=(()=>{class e{constructor(){this.equipments=new Map,this.parameters=new Map,this.initTechniques()}getTechniques(){return Promise.resolve(this.techniques)}getEquipments(e){return this.equipments.has(e)?Promise.resolve(this.equipments.get(e)):Promise.reject(new Error("Unknown technique: "+e))}getParameters(e){return this.parameters.has(e)?Promise.resolve(this.parameters.get(e)):Promise.reject(new Error("Unknown technique: "+e))}registerEquipment(e,t){return this.equipments.has(e)?(this.equipments.get(e).indexOf(t)<0&&this.equipments.get(e).push(t),Promise.resolve(t)):Promise.reject(new Error("Unknown technique: "+e))}initTechniques(){const e=["Luciferase luminescence","Bioluminescence","(G)FP fluorescence","Delayed fluorescence","Endogenous fluorescence","Leaf movement","General imaging"];this.techniques=e.concat(["Computer simulation","qRT-PCR","RNA microarray","RNA-Seq","Northern blot","Western blot","Protein array","Mass Spectrometry","Flow cytometry","Spectrophotometry","Immunoprecipitation","Biomass Assay","Gas exchange","Oxygen concentration","Other"]);const t=["","Luminometer","Tecan Infinite 200 PRO","Topcount 1","Topcount 2","Topcount 3","Topcount 4","HAM 1","HAM 2","HAM 3","Unknown"];this.equipments=new Map,this.techniques.forEach(e=>this.equipments.set(e,["","Unknown"])),e.forEach(e=>this.equipments.set(e,t)),this.equipments.set("qRT-PCR",["","Robot + Light Cycler 480","Light Cycler 480","Unknown"]),this.equipments.set("Oxygen concentration",["","Galvanic Clarck's probe","Unknown"]);const i=[];i.push(new wt.b("exposure_time",void 0,"Exposure time","min")),i.push(new wt.b("interval",void 0,"Img interval","h")),i.push(new wt.b("start_time",void 0,"Start time","h")),this.parameters=new Map,this.techniques.forEach(e=>this.parameters.set(e,[])),e.forEach(e=>this.parameters.set(e,i))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=l.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var It=i("/1cH");function St(e,t){1&e&&(l.Wb(0,"mat-error"),l.Gc(1,"Known technique must be selected"),l.Vb())}function Gt(e,t){if(1&e&&(l.Wb(0,"mat-option",19),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.oc("value",e),l.Cb(1),l.Ic(" ",e," ")}}function Dt(e,t){if(1&e&&(l.Wb(0,"mat-option",19),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.oc("value",e),l.Cb(1),l.Ic(" ",e," ")}}function Mt(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Wb(1,"form",1),l.Wb(2,"mat-hint",2),l.Gc(3,"Please email us if you don't see suitable terms in the value lists"),l.Vb(),l.Wb(4,"div",3),l.Wb(5,"mat-form-field",4),l.Wb(6,"mat-label",5),l.Gc(7,"Technique"),l.Vb(),l.Rb(8,"input",6,7),l.Wb(10,"mat-hint"),l.Gc(11,"Type to select technique (backspace for all available)"),l.Vb(),l.Ec(12,St,2,0,"mat-error",0),l.Vb(),l.Wb(13,"mat-autocomplete",8,9),l.ec("optionSelected",(function(t){return l.xc(e),l.ic().techniqueSelected(t)})),l.Ec(15,Gt,2,2,"mat-option",10),l.jc(16,"async"),l.Vb(),l.Vb(),l.Wb(17,"div",3),l.Wb(18,"mat-form-field",4),l.Wb(19,"mat-label",11),l.Gc(20,"Equipment"),l.Vb(),l.Rb(21,"input",12,13),l.Wb(23,"mat-hint"),l.Gc(24,"Type define your equipment or choose from the list (backspace for all known)"),l.Vb(),l.Vb(),l.Wb(25,"mat-autocomplete",null,14),l.Ec(27,Dt,2,2,"mat-option",10),l.jc(28,"async"),l.Vb(),l.Vb(),l.Wb(29,"div",3),l.Wb(30,"mat-form-field",4),l.Wb(31,"mat-label",15),l.Gc(32,"Description"),l.Vb(),l.Wb(33,"textarea",16),l.Gc(34,"     "),l.Vb(),l.Wb(35,"mat-hint"),l.Gc(36,"Describe how the measurement was conducted"),l.Vb(),l.Vb(),l.Vb(),l.Wb(37,"button",17),l.ec("click",(function(){return l.xc(e),l.ic().save()})),l.Gc(38),l.Vb(),l.Wb(39,"button",18),l.ec("click",(function(){return l.xc(e),l.ic().cancel()})),l.Gc(40,"Cancel"),l.Vb(),l.Vb(),l.Vb()}if(2&e){const e=l.vc(14),t=l.vc(26),i=l.ic();l.Cb(1),l.oc("formGroup",i.formModel),l.Cb(7),l.oc("matAutocomplete",e),l.Cb(4),l.oc("ngIf",null==i.formModel.get("technique").errors?null:i.formModel.get("technique").errors.validTechnique),l.Cb(3),l.oc("ngForOf",l.kc(16,8,i.filteredTechniques)),l.Cb(6),l.oc("matAutocomplete",t),l.Cb(6),l.oc("ngForOf",l.kc(28,10,i.filteredEquipments)),l.Cb(10),l.oc("disabled",i.blocked||!i.formModel.valid),l.Cb(1),l.Hc(i.okLabel)}}let Ft=(()=>{class e{constructor(e,t,i){this.techniqueService=e,this.feedback=t,this.fb=i,this.okLabel="Save",this.onAccepted=new l.o,this.onCancelled=new l.o,this.techniques=[],this.filteredTechniques=Object(Et.a)([]),this.equipments=[],this.filteredEquipments=Object(Et.a)([])}set model(e){this.setModel(e),this.updateTechniques().then(t=>this.updateEquipments(e.technique)).then(t=>this.formModel=this.buildMainForm(e)).then(e=>{this.filteredTechniques=this.formModel.get("technique").valueChanges.pipe(Object(xt.a)(""),Object(o.a)(e=>this.filter(this.techniques,e))),this.filteredEquipments=this.formModel.get("equipment").valueChanges.pipe(Object(xt.a)(""),Object(o.a)(e=>this.filter(this.equipments,e)))})}setModel(e){this._orgModel=e}ngOnInit(){this.updateTechniques()}filter(e,t){const i=t.toLowerCase();return e.filter(e=>e.toLowerCase().includes(i))}buildMainForm(e){return this.fb.group({technique:[e.technique,[Se.A.required,e=>this.knownTechnique(e.value)]],equipment:[e.equipment],description:[e.description],parameters:[]})}knownTechnique(e){return e?this.techniques.find(t=>t===e)?null:{validTechnique:"Unknown technique: "+e}:{validTechnique:"Empty value"}}techniqueSelected(e){e.option.value&&this.updateEquipments(e.option.value)}updateTechniques(){return this.techniqueService.getTechniques().then(e=>(this.techniques=e||[],e)).catch(e=>(this.feedback.error(e),Promise.reject(e)))}updateEquipments(e){return e?this.techniqueService.getEquipments(e).then(e=>(this.equipments=e||[],e)).catch(e=>(this.feedback.error(e),Promise.reject(e))):(this.equipments=[],Promise.resolve([]))}cancel(){this.onCancelled.emit(!0)}save(){this.formModel.valid&&(this._orgModel.setAll(this.formModel.value),this.onAccepted.emit(this._orgModel))}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(kt),l.Qb(d.a),l.Qb(Se.d))},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-measurement-desc-rform"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"formGroup"],[1,"mb-2"],[1,"form-group"],[1,"w-100"],["for","mTechNameA"],["matInput","","formControlName","technique","id","mTechNameA","placeholder","Type to select technique (backspace for all available)","required","",1,"",3,"matAutocomplete"],["mTechNameA",""],[3,"optionSelected"],["techniqueAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["for","mEquipNameA"],["matInput","","formControlName","equipment","id","mEquipNameA","placeholder","Type to choose or define equipment",1,"",3,"matAutocomplete"],["mEquipNameA",""],["equipmentAuto","matAutocomplete"],["for","mDescription"],["matInput","","formControlName","description","id","mDescription","placeholder","Describe how the measurement was conducted, used technical tricks etc...\nFor example: plants were sprayed with luciferase two ours before measurement. Images were taken every two ours.","rows","5","type","text",1,""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(e,t){1&e&&l.Ec(0,Mt,41,12,"div",0),2&e&&l.oc("ngIf",t.formModel)},directives:[n.m,Se.C,Se.q,Se.h,Ge.f,Ge.c,Ge.g,De.b,Se.c,It.c,Se.p,Se.g,Se.y,It.a,n.l,Ge.b,vt.o],pipes:[n.b],encapsulation:2}),e})();function At(e,t){if(1&e&&(l.Wb(0,"li"),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Hc(e)}}function Ot(e,t){if(1&e&&(l.Wb(0,"div",8),l.Wb(1,"ul"),l.Ec(2,At,2,1,"li",9),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(2),l.oc("ngForOf",e.errors)}}function qt(e,t){if(1&e){const e=l.Xb();l.Wb(0,"bd2-general-desc-form",10),l.ec("onAccepted",(function(t){return l.xc(e),l.ic(2).saveEdits(t)}))("onCancelled",(function(t){return l.xc(e),l.ic(2).hideEdits(t)})),l.Vb()}if(2&e){const e=l.ic(2);l.oc("blocked",e.blocked)("model",e.assay.generalDesc)}}function Tt(e,t){if(1&e&&l.Rb(0,"bd2-general-desc-view",11),2&e){const e=l.ic(2);l.oc("model",e.assay.generalDesc)}}function _t(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"button",12),l.ec("click",(function(){return l.xc(e),l.ic(2).activeGeneralDescForm=!0})),l.Gc(3,"Modify "),l.Vb(),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(2),l.oc("disabled",e.activeGeneralDescForm)}}function Nt(e,t){if(1&e){const e=l.Xb();l.Wb(0,"bd2-contr-desc-form",10),l.ec("onAccepted",(function(t){return l.xc(e),l.ic(2).saveEdits(t)}))("onCancelled",(function(t){return l.xc(e),l.ic(2).hideEdits(t)})),l.Vb()}if(2&e){const e=l.ic(2);l.oc("blocked",e.blocked)("model",e.assay.contributionDesc)}}function Rt(e,t){if(1&e&&l.Rb(0,"bd2-contr-desc-view",11),2&e){const e=l.ic(2);l.oc("model",e.assay.contributionDesc)}}function Pt(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"button",12),l.ec("click",(function(){return l.xc(e),l.ic(2).activeContributionDescForm=!0})),l.Gc(3,"Modify "),l.Vb(),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(2),l.oc("disabled",e.activeContributionDescForm)}}function Lt(e,t){if(1&e){const e=l.Xb();l.Wb(0,"bd2-simple-bio-desc-form",10),l.ec("onAccepted",(function(t){return l.xc(e),l.ic(2).saveEdits(t)}))("onCancelled",(function(t){return l.xc(e),l.ic(2).hideEdits(t)})),l.Vb()}if(2&e){const e=l.ic(2);l.oc("blocked",e.blocked)("model",e.assay)}}function jt(e,t){if(1&e&&l.Rb(0,"bd2-simple-bio-desc-view",11),2&e){const e=l.ic(2);l.oc("model",e.assay)}}function zt(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"button",12),l.ec("click",(function(){return l.xc(e),l.ic(2).activeSimpleBioDescForm=!0})),l.Gc(3,"Modify "),l.Vb(),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(2),l.oc("disabled",e.activeSimpleBioDescForm)}}function Ht(e,t){if(1&e){const e=l.Xb();l.Wb(0,"bd2-measurement-desc-rform",10),l.ec("onAccepted",(function(t){return l.xc(e),l.ic(2).saveEdits(t)}))("onCancelled",(function(t){return l.xc(e),l.ic(2).hideEdits(t)})),l.Vb()}if(2&e){const e=l.ic(2);l.oc("blocked",e.blocked)("model",e.assay.experimentalDetails.measurementDesc)}}function Bt(e,t){if(1&e&&l.Rb(0,"bd2-measurement-desc-view",11),2&e){const e=l.ic(2);l.oc("model",e.assay.experimentalDetails.measurementDesc)}}function Xt(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"button",12),l.ec("click",(function(){return l.xc(e),l.ic(2).activeMeasurementDescForm=!0})),l.Gc(3,"Modify "),l.Vb(),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(2),l.oc("disabled",e.activeMeasurementDescForm)}}function Ut(e,t){if(1&e&&(l.Wb(0,"li"),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Hc(e)}}function Kt(e,t){if(1&e&&(l.Wb(0,"div",8),l.Wb(1,"ul"),l.Ec(2,Ut,2,1,"li",9),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(2),l.oc("ngForOf",e.errors)}}function Qt(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"h3"),l.Gc(2,"Modify experiment description"),l.Vb(),l.Ec(3,Ot,3,1,"div",1),l.Wb(4,"div",2),l.Wb(5,"div",3),l.Gc(6,"General description"),l.Vb(),l.Wb(7,"div",4),l.Ec(8,qt,1,2,"bd2-general-desc-form",5),l.Ec(9,Tt,1,1,"bd2-general-desc-view",6),l.Ec(10,_t,4,1,"div",0),l.Vb(),l.Vb(),l.Wb(11,"div",2),l.Wb(12,"div",3),l.Gc(13,"Contributions"),l.Vb(),l.Wb(14,"div",4),l.Ec(15,Nt,1,2,"bd2-contr-desc-form",5),l.Ec(16,Rt,1,1,"bd2-contr-desc-view",6),l.Ec(17,Pt,4,1,"div",0),l.Vb(),l.Vb(),l.Wb(18,"div",2),l.Wb(19,"div",3),l.Gc(20,"Biological details"),l.Vb(),l.Wb(21,"div",4),l.Ec(22,Lt,1,2,"bd2-simple-bio-desc-form",5),l.Ec(23,jt,1,1,"bd2-simple-bio-desc-view",6),l.Ec(24,zt,4,1,"div",0),l.Vb(),l.Vb(),l.Wb(25,"div",7),l.Wb(26,"div",3),l.Gc(27,"Measurement details"),l.Vb(),l.Wb(28,"div",4),l.Ec(29,Ht,1,2,"bd2-measurement-desc-rform",5),l.Ec(30,Bt,1,1,"bd2-measurement-desc-view",6),l.Ec(31,Xt,4,1,"div",0),l.Vb(),l.Vb(),l.Ec(32,Kt,3,1,"div",1),l.Vb()),2&e){const e=l.ic();l.Cb(3),l.oc("ngIf",e.errors),l.Cb(5),l.oc("ngIf",e.activeGeneralDescForm),l.Cb(1),l.oc("ngIf",!e.activeGeneralDescForm),l.Cb(1),l.oc("ngIf",!e.activeGeneralDescForm),l.Cb(5),l.oc("ngIf",e.activeContributionDescForm),l.Cb(1),l.oc("ngIf",!e.activeContributionDescForm),l.Cb(1),l.oc("ngIf",!e.activeContributionDescForm),l.Cb(5),l.oc("ngIf",e.activeSimpleBioDescForm),l.Cb(1),l.oc("ngIf",!e.activeSimpleBioDescForm),l.Cb(1),l.oc("ngIf",!e.activeSimpleBioDescForm),l.Cb(5),l.oc("ngIf",e.activeMeasurementDescForm),l.Cb(1),l.oc("ngIf",!e.activeMeasurementDescForm),l.Cb(1),l.oc("ngIf",!e.activeMeasurementDescForm),l.Cb(1),l.oc("ngIf",e.errors)}}let $t=(()=>{class e extends K.a{constructor(e,t){super(t),this.route=e,this.blocked=!1,this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.titlePart=" Edit",this.validator=Ve.INSTANCE}ngOnInit(){super.ngOnInit(),this.route.fragment.subscribe(e=>{this.requestedSection=e,this.focusOnSection(e)})}ngAfterViewInit(){this.focusOnSection(this.requestedSection)}focusOnSection(e){if(!e)return;const t=document.getElementById(e);t&&t.scrollIntoView(),"MeasurementSection"===e&&(this.activeMeasurementDescForm=!0)}saveEdits(e){this.assay&&e&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.save(this.assay).then(e=>(this.feedback.success('Experiment: "'+e.name+'" updated.'),e)).then(e=>(this.currentExperiment.push(e),e)).then(t=>{this.blocked=!1,this.hideEdits(e)}).catch(e=>{this.blocked=!1,this.feedback.error(e)}))}hideEdits(e){this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiment",this.assay.id])}updateModel(e){this._orgModel=e,this.assay=e?e.clone():null,this.setTitle()}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(r.a),l.Qb(a.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["ng-component"]],features:[l.Bb([]),l.zb],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"blocked","model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["id","MeasurementSection",1,"card","mb-2"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"],[3,"blocked","model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&l.Ec(0,Qt,33,14,"div",0),2&e&&l.oc("ngIf",t.assay)},directives:[n.m,n.l,Ae,Z,it,ae,Ct,ue,Ft,fe],encapsulation:2}),e})(),Jt=(()=>{class e{constructor(e){this.name=e}static deserialize(t){if(null==t)return null;const i=e.valuesMap.get(t);if(i)return i;const n=+t;if(n<0||n>=e.values.length||Number.isNaN(n))throw new RangeError("Uknown AssetType "+t);return e.values[n]}static initValuesMap(){const t=new Map;return e.values.forEach(e=>t.set(e.name,e)),t}equals(e){return this.name===e.name}toJSON(){return this.name}}return e.NONE=new e("NONE"),e.FILE=new e("FILE"),e.MEDIA=new e("MEDIA"),e.DATA=new e("DATA"),e.TS_DATA=new e("TS_DATA"),e.values=[e.NONE,e.FILE,e.MEDIA,e.DATA,e.TS_DATA],e.valuesMap=e.initValuesMap(),e})();class Yt{constructor(){this.assetType=Jt.NONE,this.versions=[]}get last(){return this.versions[0]}static deserialize(e){const t=new Yt;return t.id=e.id,t.originalName=e.originalName,t.url=e.url,t.assetType=Jt.deserialize(e.assetType),e.versions&&(t.versions=e.versions.map(e=>class{static deserialize(e){return e.created=Ie.a.deserialize(e.created),e}}.deserialize(e))),t}setAll(e){this.id=e.id,this.originalName=e.originalName,this.assetType=e.assetType,this.url=e.url,this.versions=e.versions}}let Zt=(()=>{class e{constructor(e){this.BD2REST=e}upload(e,t){const i=new FormData;for(let n=0;n<t.length;n++)i.append("file",t[n],t[n].name);return this.BD2REST.expFileUpload(e.id,i).then(e=>e.data)}getFiles(e){return this.BD2REST.files(e.id).then(e=>e.data).then(e=>this.json2AssetsList(e)).then(t=>this.fillURLs(t,e))}fillURLs(e,t){return e.map(e=>this.fillURL(e,t))}fillURL(e,t){const i=this.BD2REST.fileURL(t.id,e.id);return e.url=i,e.versions.forEach(e=>{e.url=i+"/"+e.versionId}),e}json2AssetsList(e){return e.map(e=>Yt.deserialize(e))}}return e.\u0275fac=function(t){return new(t||e)(l.ac(ft.a))},e.\u0275prov=l.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var ei=i("vLYz");function ti(e,t){if(1&e&&(l.Wb(0,"div"),l.Gc(1),l.Vb()),2&e){const e=l.ic(2);l.Cb(1),l.Hc(e.file.last.description)}}function ii(e,t){if(1&e){const e=l.Xb();l.Wb(0,"li"),l.Gc(1),l.jc(2,"date"),l.Wb(3,"strong"),l.Wb(4,"a",4),l.ec("click",(function(){return l.xc(e),l.ic(3).recordDownload()})),l.Gc(5),l.Vb(),l.Vb(),l.Rb(6,"br"),l.Gc(7),l.Vb()}if(2&e){const e=t.$implicit;l.Cb(1),l.Jc(" Version ",e.versionId,". ",l.lc(2,6,e.created.date,"shortDate")," "),l.Cb(3),l.pc("href",e.url,l.zc),l.pc("download",e.originalName),l.Cb(1),l.Hc(e.originalName),l.Cb(2),l.Ic("",e.description," ")}}function ni(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"ul",5),l.Ec(2,ii,8,9,"li",6),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(2),l.oc("ngForOf",e.file.versions)}}function ri(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Wb(1,"div",1),l.Gc(2),l.Wb(3,"a",2),l.ec("click",(function(){l.xc(e);const t=l.ic();return t.showVersions=!t.showVersions})),l.Wb(4,"i",3),l.Gc(5,"expand_more"),l.Vb(),l.Vb(),l.Vb(),l.Wb(6,"h5"),l.Wb(7,"a",4),l.ec("click",(function(){return l.xc(e),l.ic().recordDownload()})),l.Gc(8),l.Vb(),l.Vb(),l.Ec(9,ti,2,1,"div",0),l.Ec(10,ni,3,1,"div",0),l.Vb()}if(2&e){const e=l.ic();l.Cb(2),l.Ic(" ",e.file.versions.length," versions "),l.Cb(5),l.pc("href",e.file.url,l.zc),l.pc("download",e.file.last.originalName),l.Cb(1),l.Hc(e.file.last.originalName),l.Cb(1),l.oc("ngIf",e.file.last.description),l.Cb(1),l.oc("ngIf",e.showVersions)}}let ci=(()=>{class e{constructor(e){this.analytics=e,this.canEdit=!0,this.showVersions=!1,this.edit=!1,this.model=this.fakeFileAsset()}set model(e){this.file=e}ngOnInit(){}fakeFileAsset(){const e=JSON.parse('{\n      "id" : 2,\n      "originalName" : "f2",\n      "assetType" : "TS_DATA",\n      "versions" : [ {\n        "versionId" : 2,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : "Some description",\n        "created" : [ 2016, 12, 8 ]\n      }, {\n        "versionId" : 1,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : null,\n        "created" : [ 2016, 12, 8 ]\n      } ]\n    }');return Yt.deserialize(e)}recordDownload(){this.analytics.fileDownload(this.parentId,this.file.id)}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(h.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-file-asset-view"]],inputs:{canEdit:"canEdit",parentId:"parentId",model:"model"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"float-right"],["role","button","aria-label","expand",3,"click"],[1,"material-icons","bd-icon"],[3,"href","download","click"],[1,"list-unstyled"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&l.Ec(0,ri,11,6,"div",0),2&e&&l.oc("ngIf",t.file&&t.file.last)},directives:[n.m,n.l],pipes:[n.e],encapsulation:2}),e})();const oi=["uploadWidget"];function si(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Wb(1,"bd2-file-upload-widget",2,3),l.ec("uploadFiles",(function(t){return l.xc(e),l.ic(2).upload(t)})),l.Vb(),l.Rb(3,"hr"),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(1),l.oc("autoReset",!1)("blocked",e.blocked)}}function ai(e,t){if(1&e&&l.Rb(0,"bd2-file-asset-view",5),2&e){const e=t.$implicit,i=l.ic(3);l.oc("model",e)("parentId",i.assay.id)}}function li(e,t){1&e&&(l.Wb(0,"div",6),l.Gc(1,' Use "Replace data" to change timeseries files. '),l.Vb())}function ui(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"h4"),l.Gc(2,"Timeseries files"),l.Vb(),l.Ec(3,ai,1,2,"bd2-file-asset-view",4),l.Ec(4,li,2,0,"div",1),l.Rb(5,"hr"),l.Vb()),2&e){const e=l.ic(2);l.Cb(3),l.oc("ngForOf",e.tsData),l.Cb(1),l.oc("ngIf",e.assay.security.canWrite)}}function bi(e,t){1&e&&(l.Wb(0,"div",6),l.Gc(1,' Use "Import data" to add timeseries files. '),l.Vb())}function di(e,t){if(1&e&&l.Rb(0,"bd2-file-asset-view",5),2&e){const e=t.$implicit,i=l.ic(3);l.oc("model",e)("parentId",i.assay.id)}}function hi(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"h4"),l.Gc(2,"Attachments"),l.Vb(),l.Ec(3,di,1,2,"bd2-file-asset-view",4),l.Vb()),2&e){const e=l.ic(2);l.Cb(3),l.oc("ngForOf",e.attachments)}}function mi(e,t){1&e&&(l.Wb(0,"div",6),l.Gc(1," Drag and upload files using the upload area in order to update the attachments. "),l.Vb())}function fi(e,t){if(1&e&&(l.Wb(0,"div"),l.Ec(1,si,4,2,"div",0),l.Ec(2,ui,6,2,"div",0),l.Ec(3,bi,2,0,"div",1),l.Ec(4,hi,4,1,"div",0),l.Ec(5,mi,2,0,"div",1),l.Vb()),2&e){const e=l.ic();l.Cb(1),l.oc("ngIf",e.assay.security.canWrite),l.Cb(1),l.oc("ngIf",e.tsData&&e.tsData.length>0),l.Cb(1),l.oc("ngIf",!e.tsData||0===e.tsData.length),l.Cb(1),l.oc("ngIf",e.attachments&&e.attachments.length>0),l.Cb(1),l.oc("ngIf",e.assay.security.canWrite)}}let pi=(()=>{class e extends K.a{constructor(e,t){super(t),this.attachmentsService=e,this.attachments=[],this.tsData=[],this.blocked=!1,this.titlePart=" Files"}updateModel(e){super.updateModel(e),this.refreshAttachments()}refreshAttachments(){this.attachmentsService.getFiles(this.assay).then(e=>this.setFiles(e)).catch(e=>{this.feedback.error(e)})}setFiles(e){this.tsData=e.filter(e=>e.assetType.equals(Jt.TS_DATA)),this.attachments=e.filter(e=>!e.assetType.equals(Jt.TS_DATA))}upload(e){console.log("Uploading "+e.length),e&&0!==e.length&&(this.blocked=!0,this.attachmentsService.upload(this.assay,e).then(e=>{this.uploadWidget.reset(),this.blocked=!1,this.feedback.success(e.length+" files uploaded")}).then(()=>this.refreshModel()).catch(e=>{this.blocked=!1,this.feedback.error(e)}))}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(Zt),l.Qb(a.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var i;1&e&&l.Mc(oi,!0),2&e&&l.uc(i=l.fc())&&(t.uploadWidget=i.first)},features:[l.zb],decls:4,vars:1,consts:[[4,"ngIf"],["type","info","class","alert alert-info","role","alert",4,"ngIf"],[3,"autoReset","blocked","uploadFiles"],["uploadWidget",""],[3,"model","parentId",4,"ngFor","ngForOf"],[3,"model","parentId"],["type","info","role","alert",1,"alert","alert-info"]],template:function(e,t){1&e&&(l.Wb(0,"h3"),l.Gc(1,"Attached files"),l.Vb(),l.Rb(2,"hr"),l.Ec(3,fi,6,5,"div",0)),2&e&&(l.Cb(3),l.oc("ngIf",t.assay))},directives:[n.m,ei.a,n.l,ci],styles:[""]}),e})();function gi(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"div",1),l.Gc(2," Experiment is already publicly available under "),l.Wb(3,"strong"),l.Gc(4),l.Vb(),l.Gc(5," licence. "),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(4),l.Hc(e.assay.features.licence)}}function vi(e,t){if(1&e&&(l.Wb(0,"option",12),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.oc("value",e),l.Cb(1),l.Ic("",e," ")}}function yi(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Wb(1,"div",2),l.Gc(2," You are about to make the data public. Once they are public they cannot be made private again. "),l.Wb(3,"ul"),l.Wb(4,"li"),l.Gc(5,"make sure you know what you are doing"),l.Vb(),l.Wb(6,"li"),l.Gc(7,"make sure all contributors agree to public sharing"),l.Vb(),l.Wb(8,"li"),l.Gc(9,"double check the description is correct, not all changes will be possible after the publishing"),l.Vb(),l.Vb(),l.Vb(),l.Wb(10,"form",null,3),l.Wb(12,"div",4),l.Wb(13,"label",5),l.Gc(14,"Licence"),l.Vb(),l.Wb(15,"select",6,7),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic(2).licence=t})),l.Ec(17,vi,2,2,"option",8),l.Vb(),l.Vb(),l.Wb(18,"div",4),l.Wb(19,"label"),l.Wb(20,"input",9,10),l.ec("ngModelChange",(function(t){return l.xc(e),l.ic(2).terms=t})),l.Vb(),l.Gc(22," I understand that I cannot undo this operation "),l.Vb(),l.Vb(),l.Wb(23,"button",11),l.ec("click",(function(){return l.xc(e),l.ic(2).publish()})),l.Gc(24," Publish "),l.Vb(),l.Vb(),l.Vb()}if(2&e){const e=l.vc(11),t=l.ic(2);l.Cb(15),l.oc("ngModel",t.licence),l.Cb(2),l.oc("ngForOf",t.licences),l.Cb(3),l.oc("ngModel",t.terms),l.Cb(3),l.oc("disabled",!e.form.valid)}}function Wi(e,t){if(1&e&&(l.Wb(0,"div"),l.Wb(1,"h3"),l.Gc(2,"Publish experiment"),l.Vb(),l.Ec(3,gi,6,1,"div",0),l.Ec(4,yi,25,4,"div",0),l.Vb()),2&e){const e=l.ic();l.Cb(3),l.oc("ngIf",e.assay.features.isOpenAccess),l.Cb(1),l.oc("ngIf",!e.assay.features.isOpenAccess)}}let Vi=(()=>{class e extends K.a{constructor(e){super(e),this.licences=["CC_BY"]}ngOnInit(){super.ngOnInit(),this.licence=this.licences[0]}publish(){this.terms&&this.licence&&this.experimentService.publish(this.assay,this.licence).then(e=>(this.feedback.success('Experiment: "'+e.name+'" published.'),e)).then(e=>(this.currentExperiment.push(e),e)).then(e=>{this.goToExpHome(e.id)}).catch(e=>{this.feedback.error(e)})}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(a.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["bd2-publish-form"]],features:[l.zb],decls:1,vars:1,consts:[[4,"ngIf"],["type","info","role","alert",1,"alert","alert-info"],["type","danger","role","alert",1,"alert","alert-danger"],["publishForm","ngForm"],[1,"form-group"],["for","licence"],["id","licence","required","","placeholder","Select licence","name","licence",1,"form-control",3,"ngModel","ngModelChange"],["licenceF","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","checkbox","required","","id","terms","name","fTerms",3,"ngModel","ngModelChange"],["fTerms","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[3,"value"]],template:function(e,t){1&e&&l.Ec(0,Wi,5,2,"div",0),2&e&&l.oc("ngIf",t.assay)},directives:[n.m,Se.C,Se.q,Se.r,Se.z,Se.y,Se.p,Se.s,n.l,Se.b,Se.a,Se.t,Se.B],encapsulation:2}),e})();function Ci(e,t){1&e&&(l.Wb(0,"div"),l.Wb(1,"h4"),l.Gc(2,"You don't have permission to create experiment"),l.Vb(),l.Wb(3,"p"),l.Gc(4,"Try to login"),l.Vb(),l.Vb())}function Ei(e,t){if(1&e){const e=l.Xb();l.Wb(0,"bd2-general-desc-form",9),l.ec("onAccepted",(function(t){return l.xc(e),l.ic(2).hideEdits(t)}))("onCancelled",(function(t){return l.xc(e),l.ic(2).hideEdits(t)})),l.Vb()}if(2&e){const e=l.ic(2);l.oc("model",e.assay.generalDesc)}}function xi(e,t){if(1&e&&l.Rb(0,"bd2-general-desc-view",10),2&e){const e=l.ic(2);l.oc("model",e.assay.generalDesc)}}function wi(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"button",11),l.ec("click",(function(){return l.xc(e),l.ic(2).activeGeneralDescForm=!0})),l.Gc(3,"Modify "),l.Vb(),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(2),l.oc("disabled",e.activeGeneralDescForm)}}function ki(e,t){if(1&e){const e=l.Xb();l.Wb(0,"bd2-simple-bio-desc-form",9),l.ec("onAccepted",(function(t){return l.xc(e),l.ic(2).hideEdits(t)}))("onCancelled",(function(t){return l.xc(e),l.ic(2).hideEdits(t)})),l.Vb()}if(2&e){const e=l.ic(2);l.oc("model",e.assay)}}function Ii(e,t){if(1&e&&l.Rb(0,"bd2-simple-bio-desc-view",10),2&e){const e=l.ic(2);l.oc("model",e.assay)}}function Si(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"button",11),l.ec("click",(function(){return l.xc(e),l.ic(2).activeSimpleBioDescForm=!0})),l.Gc(3,"Modify "),l.Vb(),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(2),l.oc("disabled",e.activeSimpleBioDescForm)}}function Gi(e,t){if(1&e){const e=l.Xb();l.Wb(0,"bd2-contr-desc-form",9),l.ec("onAccepted",(function(t){return l.xc(e),l.ic(2).hideEdits(t)}))("onCancelled",(function(t){return l.xc(e),l.ic(2).hideEdits(t)})),l.Vb()}if(2&e){const e=l.ic(2);l.oc("model",e.assay.contributionDesc)}}function Di(e,t){if(1&e&&l.Rb(0,"bd2-contr-desc-view",10),2&e){const e=l.ic(2);l.oc("model",e.assay.contributionDesc)}}function Mi(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"button",11),l.ec("click",(function(){return l.xc(e),l.ic(2).activeContributionDescForm=!0})),l.Gc(3,"Modify "),l.Vb(),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(2),l.oc("disabled",e.activeContributionDescForm)}}function Fi(e,t){if(1&e){const e=l.Xb();l.Wb(0,"bd2-measurement-desc-rform",9),l.ec("onAccepted",(function(t){return l.xc(e),l.ic(2).hideEdits(t)}))("onCancelled",(function(t){return l.xc(e),l.ic(2).hideEdits(t)})),l.Vb()}if(2&e){const e=l.ic(2);l.oc("model",e.assay.experimentalDetails.measurementDesc)}}function Ai(e,t){if(1&e&&l.Rb(0,"bd2-measurement-desc-view",10),2&e){const e=l.ic(2);l.oc("model",e.assay.experimentalDetails.measurementDesc)}}function Oi(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Rb(1,"hr"),l.Wb(2,"button",11),l.ec("click",(function(){return l.xc(e),l.ic(2).activeMeasurementDescForm=!0})),l.Gc(3,"Modify "),l.Vb(),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(2),l.oc("disabled",e.activeMeasurementDescForm)}}function qi(e,t){if(1&e&&(l.Wb(0,"li"),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Hc(e)}}function Ti(e,t){if(1&e&&(l.Wb(0,"div",12),l.Wb(1,"ul"),l.Ec(2,qi,2,1,"li",13),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(2),l.oc("ngForOf",e.errors)}}function _i(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Wb(1,"h3"),l.Gc(2,"Create experiment"),l.Vb(),l.Wb(3,"div",1),l.Wb(4,"div",2),l.Gc(5,"General description"),l.Vb(),l.Wb(6,"div",3),l.Ec(7,Ei,1,1,"bd2-general-desc-form",4),l.Ec(8,xi,1,1,"bd2-general-desc-view",5),l.Ec(9,wi,4,1,"div",0),l.Vb(),l.Vb(),l.Wb(10,"div",1),l.Wb(11,"div",2),l.Gc(12,"Biological details"),l.Vb(),l.Wb(13,"div",3),l.Ec(14,ki,1,1,"bd2-simple-bio-desc-form",4),l.Ec(15,Ii,1,1,"bd2-simple-bio-desc-view",5),l.Ec(16,Si,4,1,"div",0),l.Vb(),l.Vb(),l.Wb(17,"div",1),l.Wb(18,"div",2),l.Gc(19,"Contributions"),l.Vb(),l.Wb(20,"div",3),l.Ec(21,Gi,1,1,"bd2-contr-desc-form",4),l.Ec(22,Di,1,1,"bd2-contr-desc-view",5),l.Ec(23,Mi,4,1,"div",0),l.Vb(),l.Vb(),l.Wb(24,"div",1),l.Wb(25,"div",2),l.Gc(26,"Measurement details"),l.Vb(),l.Wb(27,"div",3),l.Ec(28,Fi,1,1,"bd2-measurement-desc-rform",4),l.Ec(29,Ai,1,1,"bd2-measurement-desc-view",5),l.Ec(30,Oi,4,1,"div",0),l.Vb(),l.Vb(),l.Ec(31,Ti,3,1,"div",6),l.Wb(32,"button",7),l.ec("click",(function(){return l.xc(e),l.ic().save()})),l.Gc(33,"Create"),l.Vb(),l.Wb(34,"button",8),l.ec("click",(function(){return l.xc(e),l.ic().cancel()})),l.Gc(35,"Cancel"),l.Vb(),l.Vb()}if(2&e){const e=l.ic();l.Cb(7),l.oc("ngIf",e.activeGeneralDescForm),l.Cb(1),l.oc("ngIf",!e.activeGeneralDescForm),l.Cb(1),l.oc("ngIf",!e.activeGeneralDescForm),l.Cb(5),l.oc("ngIf",e.activeSimpleBioDescForm),l.Cb(1),l.oc("ngIf",!e.activeSimpleBioDescForm),l.Cb(1),l.oc("ngIf",!e.activeSimpleBioDescForm),l.Cb(5),l.oc("ngIf",e.activeContributionDescForm),l.Cb(1),l.oc("ngIf",!e.activeContributionDescForm),l.Cb(1),l.oc("ngIf",!e.activeContributionDescForm),l.Cb(5),l.oc("ngIf",e.activeMeasurementDescForm),l.Cb(1),l.oc("ngIf",!e.activeMeasurementDescForm),l.Cb(1),l.oc("ngIf",!e.activeMeasurementDescForm),l.Cb(1),l.oc("ngIf",e.errors),l.Cb(1),l.oc("disabled",e.blocked||e.errors)}}const Ni=[{path:"new",pathMatch:"full",component:(()=>{class e extends Ce.a{constructor(e,t,i,n){super(Ve.INSTANCE),this.experimentService=e,this.RDMSocial=t,this.feedback=i,this.router=n,this.isUnauthorised=!1,this.blocked=!1,this.activeGeneralDescForm=!0,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!0,this.activeMeasurementDescForm=!1}ngOnInit(){this.experimentService.newDraft().then(e=>{this.assay=e}).catch(e=>{this.isUnauthorised=e.isUnauthorised,this.feedback.error(e)})}hideEdits(e){this.activeGeneralDescForm=!this.assay.generalDesc.name,this.activeSimpleBioDescForm=!this.assay.species||!this.assay.dataCategory,this.activeContributionDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiments"])}save(){this.assay&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.newExperiment(this.assay).then(e=>(this.feedback.success('Experiment: "'+e.name+'" created.'),e)).then(e=>this.router.navigate(["/experiment",e.id])).catch(e=>{this.blocked=!1,this.feedback.error(e)}))}getModel(){return this.assay}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(u.a),l.Qb(b.a),l.Qb(d.a),l.Qb(r.c))},e.\u0275cmp=l.Kb({type:e,selectors:[["ng-component"]],features:[l.zb],decls:2,vars:2,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],["okLabel","Accept",3,"model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["okLabel","Accept",3,"model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(l.Ec(0,Ci,5,0,"div",0),l.Ec(1,_i,36,14,"div",0)),2&e&&(l.oc("ngIf",t.isUnauthorised),l.Cb(1),l.oc("ngIf",t.assay))},directives:[n.m,Ae,Z,Ct,ue,it,ae,Ft,fe,n.l],encapsulation:2}),e})()},{path:":id",component:U,children:[{path:"",pathMatch:"full",component:ge},{path:"edit",component:$t},{path:"file",component:pi},{path:"publish",component:Vi},{path:"data",loadChildren:()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(13)]).then(i.bind(null,"d9Wp")).then(e=>e.TsDataModule)},{path:"ppa",loadChildren:()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(12)]).then(i.bind(null,"eJgY")).then(e=>e.PPAModule)},{path:"rhythmicity",loadChildren:()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(16)]).then(i.bind(null,"ja10")).then(e=>e.RhythmicityModule)}]}];let Ri=(()=>{class e{}return e.\u0275mod=l.Ob({type:e}),e.\u0275inj=l.Nb({factory:function(t){return new(t||e)},imports:[[r.f.forChild(Ni)],r.f]}),e})();var Pi=i("DkMi"),Li=i("YiFe");let ji=(()=>{class e{}return e.\u0275mod=l.Ob({type:e}),e.\u0275inj=l.Nb({factory:function(t){return new(t||e)},providers:[],imports:[[n.c,Li.a]]}),e})(),zi=(()=>{class e{}return e.\u0275mod=l.Ob({type:e}),e.\u0275inj=l.Nb({factory:function(t){return new(t||e)},providers:[],imports:[[n.c,Se.j]]}),e})(),Hi=(()=>{class e{}return e.\u0275mod=l.Ob({type:e}),e.\u0275inj=l.Nb({factory:function(t){return new(t||e)},imports:[[n.c,Pi.a,ji,zi,Ri]]}),e})()},mbIT:function(e,t,i){"use strict";t.isArray=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}()},n3uD:function(e,t,i){"use strict";var n=!1;t.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else n&&console.log("RxJS: Back to a better error behavior. Thank you. <3");n=e},get useDeprecatedSynchronousErrorHandling(){return n}}},nzqU:function(e,t,i){"use strict";t.isScheduler=function(e){return e&&"function"==typeof e.schedule}},"p//D":function(e,t,i){"use strict";t.rxSubscriber=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),t.$$rxSubscriber=t.rxSubscriber},pshJ:function(e,t,i){"use strict";t.isFunction=function(e){return"function"==typeof e}},"qnP+":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("2Vo4"),r=i("fXoL");let c=1,o=(()=>{class e{constructor(){this.experimentStream=new n.a(null),this.id=c++}close(){this.experimentStream.complete()}experiment(){return this.experimentStream}push(e){this.experimentStream.next(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Mb({token:e,factory:e.\u0275fac}),e})()},vLYz:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var n=i("fXoL"),r=i("BOp5"),c=i("ofXK");const o=["inputFieldM"];function s(e,t){if(1&e){const e=n.Xb();n.Wb(0,"div",11),n.Gc(1),n.Wb(2,"button",12),n.ec("click",(function(){n.xc(e);const i=t.$implicit;return n.ic(2).remove(i)})),n.Wb(3,"span",13),n.Gc(4,"\xd7"),n.Vb(),n.Vb(),n.Vb()}if(2&e){const e=t.$implicit;n.Cb(1),n.Ic(" ",e.name," ")}}function a(e,t){if(1&e&&(n.Wb(0,"div",8),n.Wb(1,"div",9),n.Wb(2,"label"),n.Gc(3,"Files:"),n.Vb(),n.Vb(),n.Ec(4,s,5,1,"div",10),n.Vb()),2&e){const e=n.ic();n.Cb(4),n.oc("ngForOf",e.files)}}function l(e,t){if(1&e){const e=n.Xb();n.Wb(0,"input",14,15),n.ec("change",(function(t){return n.xc(e),n.ic().handleFileSelect(t)})),n.Vb()}}function u(e,t){if(1&e){const e=n.Xb();n.Wb(0,"input",16,15),n.ec("change",(function(t){return n.xc(e),n.ic().handleFileSelect(t)})),n.Vb()}}function b(e,t){if(1&e&&(n.Wb(0,"div",17),n.Gc(1),n.Vb()),2&e){const e=n.ic();n.Cb(1),n.Ic(" Maximum upload size is ",e.sizeLimit,"MB ")}}let d=(()=>{class e{constructor(){this.activeColor="green",this.baseColor="#ccc",this.overlayColor="rgba(255,255,255,0.5)",this.blocked=!1,this.multiple=!0,this.noDuplicates=!0,this.autoReset=!1,this.sizeLimit=50,this.uploadFiles=new n.o,this.selectedFiles=new n.o,this.dragging=!1,this.loaded=!1,this.sizeError=!1,this.files=[]}ngOnInit(){}reset(){this.files=[],this.inputField&&this.inputField.nativeElement&&(this.inputField.nativeElement.value="")}handleDragEnter(){this.dragging=!0}handleDragLeave(){this.dragging=!1}handleDrop(e){e.preventDefault(),this.dragging=!1,e.dataTransfer&&this.handleFileChange(e.dataTransfer.files)}handleFileSelect(e){e.target&&this.handleFileChange(e.target.files)}handleFileChange(e){const t=this.multiple?e.length:Math.min(1,e.length);this.multiple||(this.files=[]);for(let i=0;i<t;i++){const t=e[i];this.noDuplicates&&this.removeDuplicate(t),this.files.push(t)}this.checkSize(),this.selectedFiles.next(this.files)}remove(e){Object(r.b)(e,this.files),this.checkSize()}removeDuplicate(e){const t=this.files.find(t=>t.name===e.name);this.remove(t)}checkSize(){let e=0;this.files.map(e=>e.size).forEach(t=>e+=t),e/=1048576,this.sizeError=e>this.sizeLimit}upload(){this.uploadFiles.next(this.files),this.autoReset&&this.reset()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-file-upload-widget"]],viewQuery:function(e,t){var i;1&e&&n.Mc(o,!0),2&e&&n.uc(i=n.fc())&&(t.inputField=i.first)},inputs:{activeColor:"activeColor",baseColor:"baseColor",overlayColor:"overlayColor",blocked:"blocked",multiple:"multiple",noDuplicates:"noDuplicates",autoReset:"autoReset",sizeLimit:"sizeLimit"},outputs:{uploadFiles:"uploadFiles",selectedFiles:"selectedFiles"},decls:13,vars:9,consts:[["class","clearfix","style","margin-bottom: 1em;",4,"ngIf"],[2,"margin-bottom","1em"],["ondragover","return false;",1,"uploader-zone",3,"dragenter","dragleave","drop"],[1,"material-icons","bd-icon","bd-primary",2,"font-size","400%"],["multiple","","name","inputField","type","file",3,"change",4,"ngIf"],["name","inputField","type","file",3,"change",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"clearfix",2,"margin-bottom","1em"],[1,""],["class","float-left fileitem",4,"ngFor","ngForOf"],[1,"float-left","fileitem"],["aria-label","Close","type","button",1,"close",2,"margin-left","0.5em",3,"click"],["aria-hidden","true"],["multiple","","name","inputField","type","file",3,"change"],["inputField",""],["name","inputField","type","file",3,"change"],[1,"alert","alert-danger"]],template:function(e,t){1&e&&(n.Wb(0,"div"),n.Ec(1,a,5,1,"div",0),n.Wb(2,"div",1),n.Wb(3,"label",2),n.ec("dragenter",(function(){return t.handleDragEnter()}))("dragleave",(function(){return t.handleDragLeave()}))("drop",(function(e){return t.handleDrop(e)})),n.Wb(4,"i",3),n.Gc(5,"cloud_upload"),n.Vb(),n.Wb(6,"p"),n.Gc(7," Drag file(s) or click to select"),n.Vb(),n.Ec(8,l,2,0,"input",4),n.Ec(9,u,2,0,"input",5),n.Vb(),n.Vb(),n.Ec(10,b,2,1,"div",6),n.Wb(11,"button",7),n.ec("click",(function(){return t.upload()})),n.Gc(12,"Upload selected "),n.Vb(),n.Vb()),2&e&&(n.Cb(1),n.oc("ngIf",t.files.length>0),n.Cb(2),n.Dc("outline-color",t.dragging?t.activeColor:t.baseColor),n.Gb("loaded",t.loaded),n.Cb(5),n.oc("ngIf",t.multiple),n.Cb(1),n.oc("ngIf",!t.multiple),n.Cb(1),n.oc("ngIf",t.sizeError),n.Cb(1),n.oc("disabled",t.blocked||t.files.length<1||t.sizeError))},directives:[c.m,c.l],styles:[".uploader-zone[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.uploader-zone[_ngcontent-%COMP%]{font-weight:400;align-items:center;background-color:#efefef;background-color:rgba(0,0,0,.02);cursor:pointer;display:flex;height:100px;justify-content:center;outline:3px dashed #ccc}div.fileitem[_ngcontent-%COMP%]{margin:2px;padding:2px;border:1px solid #efefef;border-radius:4px}"]}),e})()},vejM:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n=i("fXoL"),r=i("UsWK");let c=(()=>{class e{constructor(e){this.BD2REST=e,this.visited=new Set,console.log("RDMSocialServiceService created")}getAssayGuiAspects(e){return this.BD2REST.rdmAssayGuiAspects(e.id).then(t=>(this.visited.add(e.id),t))}shouldShowMeasurementWarning(e){return e.security.isOwner?this.visited.has(e.id)?Promise.resolve(!1):this.getAssayGuiAspects(e).then(e=>e.showMeasurementWarning):Promise.resolve(!1)}registerNewAssay(e){this.visited.add(e.id)}registerMeasurementWarning(e){this.BD2REST.rdmRegisterWarning(e.id,"MEASUREMENT").then(e=>!0)}canProceedByMeasurement(e){return e.security.isOwner?this.getAssayGuiAspects(e).then(e=>e.canProceedByMeasurement):Promise.resolve(!0)}}return e.\u0275fac=function(t){return new(t||e)(n.ac(r.a))},e.\u0275prov=n.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},yYXI:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("TPWj"),r=i("pLZG"),c=i("fXoL"),o=i("GVyA");let s=(()=>{class e extends n.a{constructor(e){super(),this.serviceDependencies=e,this.experimentService=e.experimentService,this.currentExperiment=e.currentExperiment,this.feedback=e.feedback,this.router=e.router,this.titleSetter=e.titleSetter,this.titlePart=""}ngOnInit(){this.subscribeToExperiment()}ngOnDestroy(){this.unsubscribeFromExperiment()}getModel(){return this.assay}updateModel(e){this.assay=e,this.setTitle()}setTitle(){this.titleSetter.setTitle("Exp "+this.assay.id+this.titlePart)}subscribeToExperiment(){this.expSubscription=this.currentExperiment.experiment().pipe(Object(r.a)(e=>!!e)).subscribe(e=>{this.updateModel(e)},e=>this.feedback.error(e),()=>console.log(this.constructor.name+" expSubscription completed"))}refreshModel(){return this.experimentService.getExperiment(this.assay.id).then(e=>(this.currentExperiment.push(e),e))}unsubscribeFromExperiment(){this.expSubscription&&this.expSubscription.unsubscribe()}expHomePath(e){return["/experiment",e=e||this.assay.id]}goToExpHome(e){this.router.navigate(this.expHomePath(e))}goToExpEdit(e,t){const i=this.expHomePath(e);i.push("edit"),t?this.router.navigate(i,{fragment:t}):this.router.navigate(i)}}return e.\u0275fac=function(t){return new(t||e)(c.Qb(o.a))},e.\u0275dir=c.Lb({type:e,features:[c.zb]}),e})()},yoF8:function(e,t,i){"use strict";t.identity=function(e){return e}},yx2s:function(e,t,i){"use strict";var n=i("FWf1");t.canReportError=function(e){for(;e;){var t=e.destination;if(e.closed||e.isStopped)return!1;e=t&&t instanceof n.Subscriber?t:null}return!0}},"zB/H":function(e,t,i){"use strict";var n=i("mbIT"),r=i("GMZp"),c=i("pshJ"),o=i("LBXl");function s(e){return e.reduce((function(e,t){return e.concat(t instanceof o.UnsubscriptionError?t.errors:t)}),[])}t.Subscription=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var i=this._parentOrParents,a=this._unsubscribe,l=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof e)i.remove(this);else if(null!==i)for(var u=0;u<i.length;++u)i[u].remove(this);if(c.isFunction(a))try{a.call(this)}catch(h){t=h instanceof o.UnsubscriptionError?s(h.errors):[h]}if(n.isArray(l)){u=-1;for(var b=l.length;++u<b;){var d=l[u];if(r.isObject(d))try{d.unsubscribe()}catch(h){t=t||[],h instanceof o.UnsubscriptionError?t=t.concat(s(h.errors)):t.push(h)}}}if(t)throw new o.UnsubscriptionError(t)}},e.prototype.add=function(t){var i=t;if(!t)return e.EMPTY;switch(typeof t){case"function":i=new e(t);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof e)){var n=i;(i=new e)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var r=i._parentOrParents;if(null===r)i._parentOrParents=this;else if(r instanceof e){if(r===this)return i;i._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return i;r.push(this)}var c=this._subscriptions;return null===c?this._subscriptions=[i]:c.push(i),i},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}},e.EMPTY=((t=new e).closed=!0,t),e}()},zfKp:function(e,t,i){"use strict";t.observable=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}()},zzsZ:function(e,t,i){"use strict";var n=i("Q1FS"),r=i("OAkW"),c=i("2qMH");t.fromArray=function(e,t){return t?c.scheduleArray(e,t):new n.Observable(r.subscribeToArray(e))}}}]);