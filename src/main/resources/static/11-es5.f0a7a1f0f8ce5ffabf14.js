function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=_superPropBase(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"2qMH":function(e,t,n){"use strict";var i=n("Q1FS"),r=n("zB/H");t.scheduleArray=function(e,t){return new i.Observable((function(n){var i=new r.Subscription,c=0;return i.add(t.schedule((function(){c!==e.length?(n.next(e[c++]),n.closed||i.add(this.schedule())):n.complete()}))),i}))}},"9+85":function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n("0IaG"),r=n("fXoL"),c=n("ofXK");function o(e,t){if(1&e&&r.Rb(0,"div",5),2&e){var n=r.ic();r.oc("innerHTML",n.question.details,r.yc)}}var s,a,u=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Cancel",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"OK";_classCallCheck(this,e),this.question=t,this.details=n,this.cancelLabel=i,this.okLabel=r},l=((a=function(){function e(t){_classCallCheck(this,e),this.question=t||new u("Missing question")}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||a)(r.Qb(i.a))},a.\u0275cmp=r.Kb({type:a,selectors:[["ng-component"]],decls:10,vars:5,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-content","",1,"modal-body"],[3,"innerHTML",4,"ngIf"],["mat-dialog-close","",1,"btn","btn-primary","btn-sm","mr-2"],[1,"btn","btn-primary","btn-sm",3,"mat-dialog-close"],[3,"innerHTML"]],template:function(e,t){1&e&&(r.Wb(0,"h4",0),r.Gc(1),r.Vb(),r.Wb(2,"div",1),r.Ec(3,o,1,1,"div",2),r.Vb(),r.Rb(4,"hr"),r.Wb(5,"div"),r.Wb(6,"button",3),r.Gc(7),r.Vb(),r.Wb(8,"button",4),r.Gc(9),r.Vb(),r.Vb()),2&e&&(r.Cb(1),r.Ic("",t.question.question," "),r.Cb(2),r.oc("ngIf",t.question.details),r.Cb(4),r.Hc(t.question.cancelLabel),r.Cb(1),r.oc("mat-dialog-close",!0),r.Cb(1),r.Hc(t.question.okLabel))},directives:[i.h,i.e,c.m,i.d],encapsulation:2}),a),b=((s=function(){function e(t){_classCallCheck(this,e),this.dialogs=t}return _createClass(e,[{key:"confirm",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Cancel",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"OK",r=new u(e,t,n,i);return this.dialogs.open(l,{data:r,autoFocus:!1}).afterClosed()}}]),e}()).\u0275fac=function(e){return new(e||s)(r.ac(i.b))},s.\u0275prov=r.Mb({token:s,factory:s.\u0275fac,providedIn:"root"}),s)},"9AGB":function(e,t,n){"use strict";var i=n("yoF8");function r(e){return 0===e.length?i.identity:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}t.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(e)},t.pipeFromArray=r},FWf1:function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=n("pshJ"),o=n("GiSu"),s=n("zB/H"),a=n("p//D"),u=n("n3uD"),l=n("MkmW"),b=function(e){function t(n,i,r){var c=e.call(this)||this;switch(c.syncErrorValue=null,c.syncErrorThrown=!1,c.syncErrorThrowable=!1,c.isStopped=!1,arguments.length){case 0:c.destination=o.empty;break;case 1:if(!n){c.destination=o.empty;break}if("object"==typeof n){n instanceof t?(c.syncErrorThrowable=n.syncErrorThrowable,c.destination=n,n.add(c)):(c.syncErrorThrowable=!0,c.destination=new d(c,n));break}default:c.syncErrorThrowable=!0,c.destination=new d(c,n,i,r)}return c}return r(t,e),t.prototype[a.rxSubscriber]=function(){return this},t.create=function(e,n,i){var r=new t(e,n,i);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(s.Subscription);t.Subscriber=b;var d=function(e){function t(t,n,i,r){var s,a=e.call(this)||this;a._parentSubscriber=t;var u=a;return c.isFunction(n)?s=n:n&&(s=n.next,i=n.error,r=n.complete,n!==o.empty&&(u=Object.create(n),c.isFunction(u.unsubscribe)&&a.add(u.unsubscribe.bind(u)),u.unsubscribe=a.unsubscribe.bind(a))),a._context=u,a._next=s,a._error=i,a._complete=r,a}return r(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;u.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=u.config.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):l.hostReportError(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;l.hostReportError(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};u.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),u.config.useDeprecatedSynchronousErrorHandling)throw n;l.hostReportError(n)}},t.prototype.__tryOrSetError=function(e,t,n){if(!u.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(i){return u.config.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=i,e.syncErrorThrown=!0,!0):(l.hostReportError(i),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(b);t.SafeSubscriber=d},GMZp:function(e,t,n){"use strict";t.isObject=function(e){return null!==e&&"object"==typeof e}},GVyA:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n("fXoL"),r=n("RtrU"),c=n("qnP+"),o=n("6tuW"),s=n("BMm9"),a=n("tyNb"),u=function(){var e=function e(t,n,i,r,c){_classCallCheck(this,e),this.experimentService=t,this.currentExperiment=n,this.feedback=i,this.titleSetter=r,this.router=c};return e.\u0275fac=function(t){return new(t||e)(i.ac(r.a),i.ac(c.a),i.ac(o.a),i.ac(s.a),i.ac(a.c))},e.\u0275prov=i.Mb({token:e,factory:e.\u0275fac}),e}()},GiSu:function(e,t,n){"use strict";var i=n("n3uD"),r=n("MkmW");t.empty={closed:!0,next:function(e){},error:function(e){if(i.config.useDeprecatedSynchronousErrorHandling)throw e;r.hostReportError(e)},complete:function(){}}},I65S:function(e,t,n){"use strict";var i=n("nzqU"),r=n("zzsZ"),c=n("2qMH");t.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return i.isScheduler(n)?(e.pop(),c.scheduleArray(e,n)):r.fromArray(e)}},LBXl:function(e,t,n){"use strict";t.UnsubscriptionError=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}()},MkmW:function(e,t,n){"use strict";t.hostReportError=function(e){setTimeout((function(){throw e}),0)}},OAkW:function(e,t,n){"use strict";t.subscribeToArray=function(e){return function(t){for(var n=0,i=e.length;n<i&&!t.closed;n++)t.next(e[n]);t.complete()}}},Q1FS:function(e,t,n){"use strict";var i=n("yx2s"),r=n("Xwq/"),c=n("zfKp"),o=n("9AGB"),s=n("n3uD");function a(e){if(e||(e=s.config.Promise||Promise),!e)throw new Error("no Promise impl found");return e}t.Observable=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this.operator,c=r.toSubscriber(e,t,n);if(c.add(i?i.call(c,this.source):this.source||s.config.useDeprecatedSynchronousErrorHandling&&!c.syncErrorThrowable?this._subscribe(c):this._trySubscribe(c)),s.config.useDeprecatedSynchronousErrorHandling&&c.syncErrorThrowable&&(c.syncErrorThrowable=!1,c.syncErrorThrown))throw c.syncErrorValue;return c},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){s.config.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),i.canReportError(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=a(t))((function(t,i){var r;r=n.subscribe((function(t){try{e(t)}catch(n){i(n),r&&r.unsubscribe()}}),i,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[c.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:o.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=a(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}()},TPWj:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function(){function e(t){_classCallCheck(this,e),this.validator=t,this.errors=void 0}return _createClass(e,[{key:"triggerValidation",value:function(){var e=this.validate(this.getModel());return e?(this.showErrors(e),!1):(this.clearErrors(),!0)}},{key:"clearErrors",value:function(){this.errors=void 0}},{key:"showErrors",value:function(e){this.errors=e}},{key:"validate",value:function(e){if(this.validator){var t=this.validator.validate(e);return 0===t.length?null:t}return null}}]),e}()},"Xwq/":function(e,t,n){"use strict";var i=n("FWf1"),r=n("p//D"),c=n("GiSu");t.toSubscriber=function(e,t,n){if(e){if(e instanceof i.Subscriber)return e;if(e[r.rxSubscriber])return e[r.rxSubscriber]()}return e||t||n?new i.Subscriber(e,t,n):new i.Subscriber(c.empty)}},YiFe:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("ofXK"),r=n("3Pt+"),c=n("fXoL"),o=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275mod=c.Ob({type:e}),e.\u0275inj=c.Nb({factory:function(t){return new(t||e)},providers:[],imports:[[i.c,r.j]]}),e}()},eLum:function(e,t,n){"use strict";n.r(t),n.d(t,"ExperimentModule",(function(){return pi}));var i=n("ofXK"),r=n("tyNb"),c=n("pLZG"),o=n("lJxs"),s=n("qnP+"),a=n("GVyA"),u=n("fXoL"),l=n("RtrU"),b=n("vejM"),d=n("6tuW"),f=n("ZMwR"),h=n("9+85");function m(e,t){if(1&e&&(u.Wb(0,"div",2),u.Wb(1,"strong"),u.Gc(2,"Open Access: "),u.Vb(),u.Gc(3," under "),u.Wb(4,"strong"),u.Gc(5),u.Vb(),u.Gc(6," license "),u.Vb()),2&e){var n=u.ic(2);u.Cb(5),u.Hc(n.model.features.licence)}}function p(e,t){if(1&e&&(u.Wb(0,"span"),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.Cb(1),u.Ic("",n.name,", ")}}function v(e,t){if(1&e&&(u.Wb(0,"div",2),u.Wb(1,"strong"),u.Gc(2,"Authors: "),u.Vb(),u.Ec(3,p,2,1,"span",5),u.Vb()),2&e){var n=u.ic(2);u.Cb(3),u.oc("ngForOf",n.model.contributionDesc.authors)}}function g(e,t){if(1&e&&(u.Wb(0,"div",1),u.Wb(1,"div",2),u.Wb(2,"strong"),u.Gc(3,"Purpose: "),u.Vb(),u.Gc(4),u.Vb(),u.Ec(5,m,7,1,"div",3),u.Ec(6,v,4,1,"div",3),u.Wb(7,"div",4),u.Wb(8,"strong"),u.Gc(9,"Data category: "),u.Vb(),u.Gc(10),u.Vb(),u.Vb()),2&e){var n=u.ic();u.Cb(4),u.Ic(" ",n.model.generalDesc.purpose," "),u.Cb(1),u.oc("ngIf",n.model.features.isOpenAccess),u.Cb(1),u.oc("ngIf",n.model.contributionDesc.authors),u.Cb(4),u.Ic(" ",null==n.model.dataCategory?null:n.model.dataCategory.longName," ")}}var y,C=((y=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||y)},y.\u0275cmp=u.Kb({type:y,selectors:[["bd2-experiment-basic-info-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[["class","summary-box",4,"ngIf"],[1,"summary-box"],[1,"item"],["class","item",4,"ngIf"],[1,"item","item-last"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&u.Ec(0,g,11,4,"div",0),2&e&&u.oc("ngIf",t.model)},directives:[i.m,i.l],encapsulation:2}),y),k=function(){return["edit"]},W=function(){return{exact:!0}};function V(e,t){1&e&&(u.Wb(0,"a",6),u.Gc(1,"Edit"),u.Vb()),2&e&&u.oc("routerLink",u.qc(2,k))("routerLinkActiveOptions",u.qc(3,W))}var E=function(){return[".","data","view","ts"]};function w(e,t){1&e&&(u.Wb(0,"a",6),u.Gc(1,"Show data"),u.Vb()),2&e&&u.oc("routerLink",u.qc(2,E))("routerLinkActiveOptions",u.qc(3,W))}var x=function(){return[".","data","view","heatmap"]};function _(e,t){1&e&&(u.Wb(0,"a",6),u.Gc(1,"Heatmap"),u.Vb()),2&e&&u.oc("routerLink",u.qc(2,x))("routerLinkActiveOptions",u.qc(3,W))}var S=function(){return["ppa/new"]};function I(e,t){1&e&&(u.Wb(0,"a",6),u.Gc(1,"Period analysis"),u.Vb()),2&e&&u.oc("routerLink",u.qc(2,S))("routerLinkActiveOptions",u.qc(3,W))}var D=function(){return["ppa"]},G=function(){return{exact:!1}};function M(e,t){1&e&&(u.Wb(0,"a",6),u.Gc(1,"Period analysis"),u.Vb()),2&e&&u.oc("routerLink",u.qc(2,D))("routerLinkActiveOptions",u.qc(3,G))}var F=function(){return["rhythmicity"]};function O(e,t){1&e&&(u.Wb(0,"a",6),u.Gc(1,"Rhythmicity"),u.Vb()),2&e&&u.oc("routerLink",u.qc(2,F))("routerLinkActiveOptions",u.qc(3,G))}var A=function(){return[".","data","ts-import"]};function q(e,t){if(1&e&&(u.Wb(0,"a",6),u.Gc(1),u.Vb()),2&e){var n=u.ic(2);u.oc("routerLink",u.qc(3,A))("routerLinkActiveOptions",u.qc(4,W)),u.Cb(1),u.Ic(" ",n.experiment.features.hasTSData?"Replace data":"Import data","")}}var T=function(){return["publish"]};function P(e,t){1&e&&(u.Wb(0,"a",6),u.Wb(1,"i",8),u.Gc(2,"lock_open"),u.Vb(),u.Vb()),2&e&&u.oc("routerLink",u.qc(2,T))("routerLinkActiveOptions",u.qc(3,W))}var R=function(){return["/experiments"]},N=function(){return["."]},L=function(){return["file"]};function j(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div",1),u.Wb(1,"nav",2),u.Wb(2,"a",3),u.Wb(3,"i",4),u.Gc(4,"fast_rewind"),u.Vb(),u.Vb(),u.Wb(5,"a",5),u.ec("click",(function(){return u.xc(n),u.ic().back()})),u.Wb(6,"i",4),u.Gc(7,"arrow_left"),u.Vb(),u.Vb(),u.Wb(8,"a",5),u.ec("click",(function(){return u.xc(n),u.ic().refresh()})),u.Wb(9,"i",4),u.Gc(10,"refresh"),u.Vb(),u.Vb(),u.Wb(11,"a",6),u.Gc(12,"Overview"),u.Vb(),u.Ec(13,V,2,4,"a",7),u.Ec(14,w,2,4,"a",7),u.Ec(15,_,2,4,"a",7),u.Ec(16,I,2,4,"a",7),u.Ec(17,M,2,4,"a",7),u.Ec(18,O,2,4,"a",7),u.Ec(19,q,2,5,"a",7),u.Wb(20,"a",6),u.Gc(21,"Files"),u.Vb(),u.Ec(22,P,3,4,"a",7),u.Vb(),u.Vb()}if(2&e){var i=u.ic();u.Cb(2),u.oc("routerLink",u.qc(13,R)),u.Cb(9),u.oc("routerLink",u.qc(14,N))("routerLinkActiveOptions",u.qc(15,W)),u.Cb(2),u.oc("ngIf",i.experiment.security.canWrite),u.Cb(1),u.oc("ngIf",i.experiment.features.hasTSData),u.Cb(1),u.oc("ngIf",i.experiment.features.hasTSData),u.Cb(1),u.oc("ngIf",i.experiment.security.canWrite&&i.experiment.features.hasTSData&&!i.experiment.features.hasPPAJobs),u.Cb(1),u.oc("ngIf",i.experiment.features.hasPPAJobs),u.Cb(1),u.oc("ngIf",i.experiment.security.canWrite&&i.experiment.features.hasTSData||i.experiment.features.hasRhythmicityJobs),u.Cb(1),u.oc("ngIf",i.experiment.security.canWrite),u.Cb(1),u.oc("routerLink",u.qc(16,L))("routerLinkActiveOptions",u.qc(17,W)),u.Cb(2),u.oc("ngIf",i.experiment.security.isOwner||i.experiment.security.isSuperOwner)}}var z,B=((z=function(){function e(){_classCallCheck(this,e),this.onRefresh=new u.o}return _createClass(e,[{key:"refresh",value:function(){this.onRefresh.emit(!0)}},{key:"back",value:function(){window.history.back()}}]),e}()).\u0275fac=function(e){return new(e||z)},z.\u0275cmp=u.Kb({type:z,selectors:[["bd2-experiment-navigation"]],inputs:{experiment:"experiment"},outputs:{onRefresh:"onRefresh"},features:[u.Bb([])],decls:1,vars:1,consts:[["style","margin-bottom: 2em;",4,"ngIf"],[2,"margin-bottom","2em"],[1,"secondary"],[3,"routerLink"],[1,"material-icons","bd-icon"],["role","button",1,"shade",3,"click"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions",4,"ngIf"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(e,t){1&e&&u.Ec(0,j,23,18,"div",0),2&e&&u.oc("ngIf",t.experiment)},directives:[i.m,r.e,r.d],encapsulation:2}),z);function H(e,t){1&e&&(u.Wb(0,"i",7),u.Gc(1,"lock_open"),u.Vb())}function X(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Wb(1,"div",1),u.Wb(2,"div",2),u.Wb(3,"h3"),u.Ec(4,H,2,0,"i",3),u.Gc(5),u.Rb(6,"br"),u.Wb(7,"small"),u.Gc(8),u.Vb(),u.Vb(),u.Vb(),u.Wb(9,"div",4),u.Rb(10,"bd2-experiment-basic-info-view",5),u.Vb(),u.Vb(),u.Wb(11,"bd2-experiment-navigation",6),u.ec("onRefresh",(function(){return u.xc(n),u.ic().refresh()})),u.Vb(),u.Vb()}if(2&e){var i=u.ic();u.Cb(4),u.oc("ngIf",i.model.features.isOpenAccess),u.Cb(1),u.Ic(" Experiment: ",i.model.id,""),u.Cb(3),u.Hc(i.model.name),u.Cb(2),u.oc("model",i.model),u.Cb(1),u.oc("experiment",i.model)}}function U(e,t){1&e&&(u.Wb(0,"div"),u.Gc(1," ... loading experiment "),u.Wb(2,"p"),u.Gc(3,"If just logged in try to refresh the window if the experiment is not loading."),u.Vb(),u.Vb())}function K(e,t){1&e&&(u.Wb(0,"div"),u.Wb(1,"h4"),u.Gc(2,"You don't have sufficient permissions to see the experiment"),u.Vb(),u.Wb(3,"p"),u.Gc(4,"Try to login"),u.Vb(),u.Vb())}var Q,$=((Q=function(){function e(t,n,i,r,c,o,s,a){_classCallCheck(this,e),this.experimentService=t,this.RDMSocial=n,this.currentExperiment=i,this.feedback=r,this.analytics=c,this.route=o,this.router=s,this.dialogs=a,this.isUnauthorised=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.expSubscription=this.currentExperiment.experiment().pipe(Object(c.a)((function(e){return!!e}))).subscribe((function(t){e.model=t,e.analytics.experimentView(t.id),e.RDMSocial.shouldShowMeasurementWarning(t).then((function(t){t&&e.showMetadataWarning()}))}),(function(t){return e.feedback.error(t)}),(function(){return console.log("currentExperimentStream completed")})),this.paramsSubscription=this.route.paramMap.pipe(Object(o.a)((function(e){return e.get("id")})),Object(c.a)((function(e){return!!e}))).subscribe((function(t){return e.loadExperiment(+t)}))}},{key:"ngOnDestroy",value:function(){this.paramsSubscription&&this.paramsSubscription.unsubscribe(),this.expSubscription&&this.expSubscription.unsubscribe(),this.currentExperiment&&this.currentExperiment.close()}},{key:"refresh",value:function(){this.model&&this.loadExperiment(this.model.id)}},{key:"loadExperiment",value:function(e){var t=this;this.experimentService.getExperiment(e).then((function(e){t.currentExperiment.push(e),t.isUnauthorised=!1})).catch((function(e){t.isUnauthorised=e.isUnauthorised,t.feedback.error(e)}))}},{key:"handleWarningResponse",value:function(e){console.log("Dialog: "+e)}},{key:"showMetadataWarning",value:function(){var e=this;this.dialogs.confirm("Metadata reminder","\n        <p>\n        Please add measurements details, like technique, equipment and short description.\n        </p>\n        <p>\n        It will improve the metadata quality and it will help you when searching for the data.\n        </p>\n","Not now").subscribe((function(t){e.RDMSocial.registerMeasurementWarning(e.model),t&&e.router.navigate(["edit"],{relativeTo:e.route,fragment:"MeasurementSection"})}))}}]),e}()).\u0275fac=function(e){return new(e||Q)(u.Qb(l.a),u.Qb(b.a),u.Qb(s.a),u.Qb(d.a),u.Qb(f.a),u.Qb(r.a),u.Qb(r.c),u.Qb(h.a))},Q.\u0275cmp=u.Kb({type:Q,selectors:[["ng-component"]],features:[u.Bb([s.a,a.a])],decls:5,vars:3,consts:[[4,"ngIf"],[1,"card","asset-card"],[1,"card-header"],["class","material-icons bd-icon","style","color: green; font-size: 1.5em;",4,"ngIf"],[1,"card-body"],[3,"model"],[3,"experiment","onRefresh"],[1,"material-icons","bd-icon",2,"color","green","font-size","1.5em"]],template:function(e,t){1&e&&(u.Wb(0,"div"),u.Ec(1,X,12,5,"div",0),u.Ec(2,U,4,0,"div",0),u.Ec(3,K,5,0,"div",0),u.Rb(4,"router-outlet"),u.Vb()),2&e&&(u.Cb(1),u.oc("ngIf",t.model),u.Cb(1),u.oc("ngIf",!t.model&&!t.isUnauthorised),u.Cb(1),u.oc("ngIf",!t.model&&t.isUnauthorised))},directives:[i.m,r.g,C,B],encapsulation:2}),Q),J=n("yYXI");function Y(e,t){if(1&e&&(u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"strong"),u.Gc(3,"Description"),u.Vb(),u.Wb(4,"div"),u.Gc(5),u.Vb(),u.Vb()),2&e){var n=u.ic(2);u.Cb(5),u.Hc(n.model.description)}}function Z(e,t){if(1&e&&(u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"strong"),u.Gc(3,"Comments"),u.Vb(),u.Wb(4,"div"),u.Gc(5),u.Vb(),u.Vb()),2&e){var n=u.ic(2);u.Cb(5),u.Hc(n.model.comments)}}function ee(e,t){if(1&e&&(u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"strong"),u.Gc(3,"Execution date"),u.Vb(),u.Wb(4,"div"),u.Gc(5),u.jc(6,"date"),u.Vb(),u.Vb()),2&e){var n=u.ic(2);u.Cb(5),u.Hc(u.kc(6,1,n.model.executionDate.date))}}function te(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"h4"),u.Gc(2),u.Vb(),u.Wb(3,"div"),u.Rb(4,"hr"),u.Wb(5,"strong"),u.Gc(6,"Purpose/Hypothesis"),u.Vb(),u.Wb(7,"div"),u.Gc(8),u.Vb(),u.Vb(),u.Ec(9,Y,6,1,"div",0),u.Ec(10,Z,6,1,"div",0),u.Ec(11,ee,7,3,"div",0),u.Vb()),2&e){var n=u.ic();u.Cb(2),u.Hc(n.model.name),u.Cb(6),u.Hc(n.model.purpose),u.Cb(1),u.oc("ngIf",n.model.description),u.Cb(1),u.oc("ngIf",n.model.comments),u.Cb(1),u.oc("ngIf",n.model.executionDate)}}var ne,ie=((ne=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||ne)},ne.\u0275cmp=u.Kb({type:ne,selectors:[["bd2-general-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&u.Ec(0,te,12,5,"div",0),2&e&&u.oc("ngIf",t.model)},directives:[i.m],pipes:[i.e],encapsulation:2}),ne);function re(e,t){if(1&e&&(u.Wb(0,"span"),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.Cb(1),u.Ic("",n.name,", ")}}function ce(e,t){if(1&e&&(u.Wb(0,"h4"),u.Ec(1,re,2,1,"span",1),u.Vb()),2&e){var n=u.ic(2);u.Cb(1),u.oc("ngForOf",n.model.authors)}}function oe(e,t){if(1&e&&(u.Wb(0,"span"),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.Cb(1),u.Ic("",n.name,", ")}}function se(e,t){if(1&e&&(u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"strong"),u.Gc(3,"Data curators: "),u.Vb(),u.Ec(4,oe,2,1,"span",1),u.Vb()),2&e){var n=u.ic(2);u.Cb(4),u.oc("ngForOf",n.model.curators)}}function ae(e,t){if(1&e&&(u.Wb(0,"span"),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.Cb(1),u.Ic("",n.name,", ")}}function ue(e,t){if(1&e&&(u.Wb(0,"span"),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.Cb(1),u.Ic("",n.name,", ")}}function le(e,t){if(1&e&&(u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"strong"),u.Gc(3,"Institutions/Fundings: "),u.Vb(),u.Ec(4,ae,2,1,"span",1),u.Ec(5,ue,2,1,"span",1),u.Vb()),2&e){var n=u.ic(2);u.Cb(4),u.oc("ngForOf",n.model.institutions),u.Cb(1),u.oc("ngForOf",n.model.fundings)}}function be(e,t){if(1&e&&(u.Wb(0,"div"),u.Ec(1,ce,2,1,"h4",0),u.Ec(2,se,5,1,"div",0),u.Ec(3,le,6,2,"div",0),u.Vb()),2&e){var n=u.ic();u.Cb(1),u.oc("ngIf",n.model.authors.length>0),u.Cb(1),u.oc("ngIf",n.model.curators.length>0),u.Cb(1),u.oc("ngIf",n.model.institutions.length>0||n.model.fundings.length>0)}}var de,fe=((de=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||de)},de.\u0275cmp=u.Kb({type:de,selectors:[["bd2-contr-desc-view"]],inputs:{model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&u.Ec(0,be,4,3,"div",0),2&e&&u.oc("ngIf",t.model)},directives:[i.m,i.l],encapsulation:2}),de);function he(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"p"),u.Wb(2,"strong"),u.Gc(3,"Species: "),u.Vb(),u.Gc(4),u.Vb(),u.Wb(5,"p"),u.Wb(6,"strong"),u.Gc(7,"Data category: "),u.Vb(),u.Gc(8),u.Vb(),u.Vb()),2&e){var n=u.ic();u.Cb(4),u.Ic(" ",n.model.species," "),u.Cb(4),u.Ic(" ",null==n.model.dataCategory?null:n.model.dataCategory.longName," ")}}var me,pe=((me=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||me)},me.\u0275cmp=u.Kb({type:me,selectors:[["bd2-simple-bio-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&u.Ec(0,he,9,2,"div",0),2&e&&u.oc("ngIf",t.model)},directives:[i.m],encapsulation:2}),me);function ve(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"strong"),u.Gc(2,"Details"),u.Vb(),u.Wb(3,"div"),u.Gc(4),u.Vb(),u.Vb()),2&e){var n=u.ic(3);u.Cb(4),u.Hc(n.model.description)}}function ge(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"strong"),u.Gc(2,"Technique:"),u.Vb(),u.Gc(3),u.Ec(4,ve,5,1,"div",0),u.Vb()),2&e){var n=u.ic(2);u.Cb(3),u.Jc(" ",n.model.technique," ",n.model.equipment?"("+n.model.equipment+")":""," "),u.Cb(1),u.oc("ngIf",n.model.description)}}function ye(e,t){1&e&&(u.Wb(0,"div"),u.Gc(1," Unspecified "),u.Vb())}function Ce(e,t){if(1&e&&(u.Wb(0,"div"),u.Ec(1,ge,5,3,"div",0),u.Ec(2,ye,2,0,"div",0),u.Vb()),2&e){var n=u.ic();u.Cb(1),u.oc("ngIf",n.model.technique),u.Cb(1),u.oc("ngIf",!n.model.technique)}}var ke,We=((ke=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||ke)},ke.\u0275cmp=u.Kb({type:ke,selectors:[["bd2-measurement-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&u.Ec(0,Ce,3,2,"div",0),2&e&&u.oc("ngIf",t.model)},directives:[i.m],encapsulation:2}),ke);function Ve(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"h3"),u.Gc(2,"Overview of experimental details"),u.Vb(),u.Wb(3,"div",1),u.Wb(4,"div",2),u.Gc(5,"General description"),u.Vb(),u.Wb(6,"div",3),u.Rb(7,"bd2-general-desc-view",4),u.Vb(),u.Vb(),u.Wb(8,"div",1),u.Wb(9,"div",2),u.Gc(10,"Contributions"),u.Vb(),u.Wb(11,"div",3),u.Rb(12,"bd2-contr-desc-view",4),u.Vb(),u.Vb(),u.Wb(13,"div",1),u.Wb(14,"div",2),u.Gc(15,"Biological details"),u.Vb(),u.Wb(16,"div",3),u.Rb(17,"bd2-simple-bio-desc-view",4),u.Vb(),u.Vb(),u.Wb(18,"div",1),u.Wb(19,"div",2),u.Gc(20,"Measurement details"),u.Vb(),u.Wb(21,"div",3),u.Rb(22,"bd2-measurement-desc-view",4),u.Vb(),u.Vb(),u.Vb()),2&e){var n=u.ic();u.Cb(7),u.oc("model",n.assay.generalDesc),u.Cb(5),u.oc("model",n.assay.contributionDesc),u.Cb(5),u.oc("model",n.assay),u.Cb(5),u.oc("model",n.assay.experimentalDetails.measurementDesc)}}var Ee,we,xe=((we=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return n}(J.a)).\u0275fac=function(e){return new(e||we)(u.Qb(a.a))},we.\u0275cmp=u.Kb({type:we,selectors:[["ng-component"]],features:[u.Bb([]),u.zb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"model"]],template:function(e,t){1&e&&u.Ec(0,Ve,23,4,"div",0),2&e&&u.oc("ngIf",t.assay)},directives:[i.m,ie,fe,pe,We],encapsulation:2}),we),_e=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"validate",value:function(e){var t=[];return e?(e.name&&""!=e.name.trim()||t.push("Non empty name is required"),e.purpose&&""!=e.purpose.trim()||t.push("Purpose is required"),e.purpose&&e.purpose.trim().length<20&&t.push("Purpose is too short"),t):["General description cannot be empty"]}},{key:"GeneralDescValidator",value:function(){}}]),e}();return e.INSTANCE=new e,e}(),Se=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"validate",value:function(e){return e?e.authors.length<1?["At least one author is required"]:[]:["Contribution cannot be empty"]}},{key:"ContributionDescValidator",value:function(){}}]),e}();return e.INSTANCE=new e,e}(),Ie=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"validate",value:function(e){var t=[];return e?(e.species&&""!=e.species.trim()||t.push("Non empty species is required"),e.dataCategory&&"NONE"!=e.dataCategory.name||t.push("Data category is required"),t):["Cannot validate null object"]}}]),e}();return e.INSTANCE=new e,e}(),De=((Ee=function(){function e(){_classCallCheck(this,e),this.generalV=_e.INSTANCE,this.contribV=Se.INSTANCE,this.bioV=Ie.INSTANCE}return _createClass(e,[{key:"validate",value:function(e){var t=[];return t=t.concat(this.generalV.validate(e.generalDesc),this.contribV.validate(e.contributionDesc),this.bioV.validate(e))}}]),e}()).INSTANCE=new Ee,Ee),Ge=n("TPWj"),Me=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var i;return _classCallCheck(this,n),(i=t.call(this,e)).onAccepted=new u.o,i.onCancelled=new u.o,i}return _createClass(n,[{key:"cancel",value:function(){this.clearErrors(),this.onCancelled.emit(!0)}},{key:"save",value:function(){this._orgModel&&this.triggerValidation()&&(this._orgModel.setAll(this._model),this.onAccepted.emit(this._orgModel))}},{key:"getModel",value:function(){return this._model}},{key:"setModel",value:function(e){this._orgModel=e,e&&(this._model=e.clone())}}]),n}(Ge.a),Fe=function(){function e(t){_classCallCheck(this,e),this.text=t||"",this.nextPosition=0,this.limit=this.text.length,this.currentWorld=""}return _createClass(e,[{key:"next",value:function(){if(this.nextPosition>=this.limit)return"";for(;this.nextPosition<this.limit;this.nextPosition++){var e=this.text.charAt(this.nextPosition);if(" "===e||"\t"===e||"\n"===e){if(this.currentWorld){var t=this.currentWorld.toLowerCase();return this.currentWorld="",t}}else{if("."===e||","===e||":"===e||"'"===e)continue;this.currentWorld=this.currentWorld+e}}return this.currentWorld.toLowerCase()}}]),e}(),Oe=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"initBannedWords",value:function(){var e=new Set;return e.add("sensible"),e.add("description"),e.add("with"),e.add("more"),e.add("words"),e.add("required"),e.add("purpose"),e.add("hypothesis"),e}},{key:"removeLetterChain",value:function(e){if(!e)return"";for(var t=e.length,n=e.charAt(0),i=e.charAt(0),r=1;r<t;r++){var c=e.charAt(r);c!==i&&(i=c,n+=c)}return n}},{key:"removePairChain",value:function(e){if(!e)return"";if(e.length<4)return e;for(var t=e.length-1,n=e.substring(0,2),i=n,r=2;r<t;){var c=e.substring(r,r+2);c!==i?(i=i.charAt(1)+c.charAt(0),n+=c.charAt(0),r++):r+=2}return r==t&&(n+=e.charAt(e.length-1)),n}},{key:"simplifyWorld",value:function(t){var n=e.removeLetterChain(t);return n=e.removePairChain(n)}},{key:"countDistinctCharacters",value:function(e){if(!e)return 0;for(var t=new Set,n=0;n<e.length;n++)t.add(e.charAt(n));return t.size}},{key:"isSensibleWorld",value:function(t){if(!t)return!1;if(t.length>6&&e.countDistinctCharacters(t)<=4)return!1;if(e.bannedWords.has(t))return!1;var n=e.simplifyWorld(t),i=4;return 4===t.length&&(i=3),t.length>10&&(i=.6*t.length),n.length>=i}}]),e}();return e.bannedWords=e.initBannedWords(),e}(),Ae=function(){function e(t){_classCallCheck(this,e),this.minWords=5,this.previouslyValid="",this.minWords=t||5}return _createClass(e,[{key:"validateText",value:function(e){if(e&&this.previouslyValid&&e.startsWith(this.previouslyValid))return null;var t=this.countWords(e,this.minWords);return t<this.minWords?{minWords:"required "+this.minWords+" found: "+t}:(this.previouslyValid=e,null)}},{key:"countWords",value:function(e,t){for(var n=new Fe(e),i=new Set,r=n.next();r&&i.size<t;r=n.next())Oe.isSensibleWorld(r)&&i.add(r);return i.size}}]),e}(),qe=n("B9cw"),Te=n("3Pt+"),Pe=n("kmnG"),Re=n("qFsG"),Ne=n("iadO");function Le(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Wb(1,"form",null,1),u.Wb(3,"div",2),u.Wb(4,"mat-form-field",3),u.Wb(5,"mat-label",4),u.Gc(6,"Name"),u.Vb(),u.Wb(7,"input",5,6),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic().model.name=e})),u.Vb(),u.Wb(9,"mat-hint"),u.Gc(10,"Good name hints the data content"),u.Vb(),u.Wb(11,"mat-error"),u.Gc(12,"Descriptive name is required"),u.Vb(),u.Vb(),u.Vb(),u.Wb(13,"div",2),u.Wb(14,"mat-form-field",3),u.Wb(15,"mat-label",7),u.Gc(16,"Purpose/Hypothesis"),u.Vb(),u.Wb(17,"textarea",8,9),u.ec("input",(function(){return u.xc(n),u.ic().checkPurpose()}))("ngModelChange",(function(e){return u.xc(n),u.ic().model.purpose=e})),u.Gc(19,"                   "),u.Vb(),u.Wb(20,"mat-hint"),u.Gc(21,"Sensible description with more than few words is required"),u.Vb(),u.Vb(),u.Vb(),u.Wb(22,"div",2),u.Wb(23,"mat-form-field",3),u.Wb(24,"mat-label",10),u.Gc(25,"Description"),u.Vb(),u.Wb(26,"textarea",11,12),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic().model.description=e})),u.Gc(28,"                 "),u.Vb(),u.Vb(),u.Vb(),u.Wb(29,"div",2),u.Wb(30,"mat-form-field",3),u.Wb(31,"mat-label",13),u.Gc(32,"Comments"),u.Vb(),u.Wb(33,"textarea",14,15),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic().model.comments=e})),u.Gc(35,"                "),u.Vb(),u.Vb(),u.Vb(),u.Wb(36,"div",2),u.Wb(37,"mat-form-field"),u.Wb(38,"input",16,17),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic().executionDate=e})),u.Vb(),u.Rb(40,"mat-datepicker-toggle",18),u.Rb(41,"mat-datepicker",null,19),u.Wb(43,"mat-error"),u.Gc(44,"Date is required and cannot be much in the future"),u.Vb(),u.Vb(),u.Rb(45,"br"),u.Vb(),u.Wb(46,"button",20),u.ec("click",(function(){return u.xc(n),u.ic().save()})),u.Gc(47),u.Vb(),u.Wb(48,"button",21),u.ec("click",(function(){return u.xc(n),u.ic().cancel()})),u.Gc(49,"Cancel"),u.Vb(),u.Vb(),u.Vb()}if(2&e){var i=u.vc(2),r=u.vc(18),c=u.vc(42),o=u.ic();u.Cb(7),u.oc("ngModel",o.model.name),u.Cb(10),u.oc("ngModel",o.model.purpose),u.Cb(3),u.Dc("color",o.sufficientPurpose||r.pristine?"":"red"),u.Cb(6),u.oc("ngModel",o.model.description),u.Cb(7),u.oc("ngModel",o.model.comments),u.Cb(5),u.oc("matDatepicker",c)("ngModel",o.executionDate)("max",o.maxDate)("min",o.minDate),u.Cb(2),u.oc("for",c),u.Cb(6),u.oc("disabled",o.blocked||!i.form.valid||!o.sufficientPurpose),u.Cb(1),u.Hc(o.okLabel)}}var je,ze=((je=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,_e.INSTANCE)).okLabel="Save",e.sufficientPurpose=!1,e.purposeWorldValidator=new Ae(5),e.maxDate=new Date,e.maxDate.setDate(e.maxDate.getDate()+21),e.minDate=new Date,e.minDate.setFullYear(e.minDate.getFullYear()-10),e}return _createClass(n,[{key:"checkPurpose",value:function(){this.sufficientPurpose=null===this.purposeWorldValidator.validateText(this.model.purpose)}},{key:"save",value:function(){this.model.executionDate=qe.a.fromDate(this.executionDate),_get(_getPrototypeOf(n.prototype),"save",this).call(this)}},{key:"model",get:function(){return this._model},set:function(e){this.setModel(e),this.executionDate=e.executionDate.date,this.checkPurpose()}}]),n}(Me)).\u0275fac=function(e){return new(e||je)},je.\u0275cmp=u.Kb({type:je,selectors:[["bd2-general-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[u.zb],decls:1,vars:1,consts:[[4,"ngIf"],["gDescForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","gName"],["matInput","","id","gName","maxlength","100","minlength","6","name","gName","placeholder","e.g. Testing robustness in low light (E12)","required","","type","text",1,"",3,"ngModel","ngModelChange"],["gName","ngModel"],["for","gPurpose"],["matInput","","id","gPurpose","minlength","55","name","gPurpose","placeholder","Describe the main aim of the experiment. What you tried to achieve, test, verify, on what kind of samples.","required","","rows","4","type","text",1,"",3,"ngModel","input","ngModelChange"],["gPurpose","ngModel"],["for","gDescription"],["matInput","","id","gDescription","name","gDescription","placeholder","Describe how the experiment was conducted, what environmental conditions, sampling procedure.\nFor example: seedlings were exposed to short day light regime (LD 6:18) at two temperatures 15 and 25. Samples where harvested every 4 hours for 3 days and the genes levels measured with RT PCR","rows","5","type","text",1,"",3,"ngModel","ngModelChange"],["gDescription","ngModel"],["for","gComments"],["matInput","","id","gComments","name","gComments","placeholder","Optional remarks, for example technical issues during the experiment, discrepancies/simplifications of in the following sections","type","text",1,"",3,"ngModel","ngModelChange"],["gComments","ngModel"],["matInput","","name","executionDate","placeholder","Exp. execution date","required","",3,"matDatepicker","ngModel","max","min","ngModelChange"],["gDate","ngModel"],["matSuffix","",3,"for"],["picker",""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(e,t){1&e&&u.Ec(0,Le,50,13,"div",0),2&e&&u.oc("ngIf",t.model)},directives:[i.m,Te.C,Te.q,Te.r,Pe.c,Pe.g,Re.b,Te.c,Te.k,Te.l,Te.y,Te.p,Te.s,Pe.f,Pe.b,Ne.b,Ne.d,Pe.h,Ne.a],encapsulation:2}),je),Be=n("kKfy"),He=n("RkHi"),Xe=n("cEDj"),Ue=n("BOp5"),Ke=n("Wp6s"),Qe=n("A5z7"),$e=n("f0Cb"),Je=n("NFeN"),Ye=["persForm"],Ze=["instForm"],et=["fundForm"];function tt(e,t){if(1&e&&(u.Wb(0,"li"),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.Cb(1),u.Hc(n)}}function nt(e,t){if(1&e&&(u.Wb(0,"div",35),u.Wb(1,"ul",36),u.Ec(2,tt,2,1,"li",37),u.Vb(),u.Vb()),2&e){var n=u.ic(2);u.Cb(2),u.oc("ngForOf",n.errors)}}function it(e,t){1&e&&(u.Wb(0,"p"),u.Gc(1,"Please add an author"),u.Vb())}function rt(e,t){if(1&e){var n=u.Xb();u.Wb(0,"mat-chip",38),u.ec("removed",(function(){u.xc(n);var e=t.$implicit;return u.ic(2).removeAuthor(e)})),u.Gc(1),u.Wb(2,"mat-icon",39),u.Gc(3,"cancel"),u.Vb(),u.Vb()}if(2&e){var i=t.$implicit;u.Cb(1),u.Ic(" ",i.name," ")}}function ct(e,t){if(1&e){var n=u.Xb();u.Wb(0,"mat-chip",38),u.ec("removed",(function(){u.xc(n);var e=t.$implicit;return u.ic(3).removeCurator(e)})),u.Gc(1),u.Wb(2,"mat-icon",39),u.Gc(3,"cancel"),u.Vb(),u.Vb()}if(2&e){var i=t.$implicit;u.Cb(1),u.Ic(" ",i.name," ")}}function ot(e,t){if(1&e&&(u.Wb(0,"div",2),u.Wb(1,"label"),u.Wb(2,"strong"),u.Gc(3,"Data curators"),u.Vb(),u.Vb(),u.Wb(4,"mat-chip-list"),u.Ec(5,ct,4,1,"mat-chip",3),u.Vb(),u.Rb(6,"mat-divider",4),u.Vb()),2&e){var n=u.ic(2);u.Cb(5),u.oc("ngForOf",n.model.curators)}}function st(e,t){1&e&&(u.Wb(0,"p"),u.Gc(1,"Please add an institution"),u.Vb())}function at(e,t){if(1&e){var n=u.Xb();u.Wb(0,"mat-chip",38),u.ec("removed",(function(){u.xc(n);var e=t.$implicit;return u.ic(2).removeInstitution(e)})),u.Gc(1),u.Wb(2,"mat-icon",39),u.Gc(3,"cancel"),u.Vb(),u.Vb()}if(2&e){var i=t.$implicit;u.Cb(1),u.Ic(" ",i.name," ")}}function ut(e,t){if(1&e){var n=u.Xb();u.Wb(0,"mat-chip",38),u.ec("removed",(function(){u.xc(n);var e=t.$implicit;return u.ic(3).removeFunding(e)})),u.Gc(1),u.Wb(2,"mat-icon",39),u.Gc(3,"cancel"),u.Vb(),u.Vb()}if(2&e){var i=t.$implicit;u.Cb(1),u.Ic(" ",i.name," ")}}function lt(e,t){if(1&e&&(u.Wb(0,"div",2),u.Wb(1,"label"),u.Wb(2,"strong"),u.Gc(3,"Fundings"),u.Vb(),u.Vb(),u.Wb(4,"mat-chip-list"),u.Ec(5,ut,4,1,"mat-chip",3),u.Vb(),u.Rb(6,"mat-divider",4),u.Vb()),2&e){var n=u.ic(2);u.Cb(5),u.oc("ngForOf",n.model.fundings)}}function bt(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Ec(1,nt,3,1,"div",1),u.Wb(2,"mat-card"),u.Wb(3,"mat-card-content"),u.Wb(4,"div",2),u.Wb(5,"label"),u.Wb(6,"strong"),u.Gc(7,"Authors"),u.Vb(),u.Vb(),u.Ec(8,it,2,0,"p",0),u.Wb(9,"mat-chip-list"),u.Ec(10,rt,4,1,"mat-chip",3),u.Vb(),u.Rb(11,"mat-divider",4),u.Vb(),u.Ec(12,ot,7,1,"div",5),u.Wb(13,"form",6,7),u.Wb(15,"div",8),u.Wb(16,"mat-form-field"),u.Wb(17,"mat-label",9),u.Gc(18,"Name"),u.Vb(),u.Wb(19,"input",10,11),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic().firstName=e})),u.Vb(),u.Vb(),u.Vb(),u.Wb(21,"div",2),u.Wb(22,"mat-form-field"),u.Wb(23,"mat-label",12),u.Gc(24,"Surname"),u.Vb(),u.Wb(25,"input",13,14),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic().lastName=e})),u.Vb(),u.Vb(),u.Vb(),u.Wb(27,"button",15),u.ec("click",(function(){return u.xc(n),u.ic().addAuthor()})),u.Gc(28,"New Author "),u.Vb(),u.Wb(29,"button",16),u.ec("click",(function(){return u.xc(n),u.ic().addCurator()})),u.Gc(30,"New Curator "),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Rb(31,"mat-divider",17),u.Wb(32,"mat-card"),u.Wb(33,"mat-card-content"),u.Wb(34,"div",2),u.Wb(35,"label"),u.Wb(36,"strong"),u.Gc(37,"Institutions"),u.Vb(),u.Vb(),u.Ec(38,st,2,0,"p",0),u.Wb(39,"mat-chip-list"),u.Ec(40,at,4,1,"mat-chip",3),u.Vb(),u.Rb(41,"mat-divider",4),u.Vb(),u.Wb(42,"form",6,18),u.Wb(44,"div",2),u.Wb(45,"mat-form-field"),u.Wb(46,"mat-label",19),u.Gc(47,"Institution"),u.Vb(),u.Wb(48,"input",20,21),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic().institutionName=e})),u.Vb(),u.Vb(),u.Vb(),u.Wb(50,"button",22),u.ec("click",(function(){return u.xc(n),u.ic().addInstitution()})),u.Gc(51," Add Institution "),u.Vb(),u.Rb(52,"mat-divider",23),u.Vb(),u.Ec(53,lt,7,1,"div",5),u.Wb(54,"form",6,24),u.Wb(56,"div",2),u.Wb(57,"mat-form-field",25),u.Wb(58,"mat-label",26),u.Gc(59,"Funder"),u.Vb(),u.Wb(60,"input",27,28),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic().funderName=e})),u.Vb(),u.Vb(),u.Vb(),u.Wb(62,"div",2),u.Wb(63,"mat-form-field"),u.Wb(64,"mat-label",29),u.Gc(65,"Grant"),u.Vb(),u.Wb(66,"input",30,31),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic().grantNr=e})),u.Vb(),u.Vb(),u.Vb(),u.Wb(68,"button",22),u.ec("click",(function(){return u.xc(n),u.ic().addFunding()})),u.Gc(69," Add Funding "),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Wb(70,"div",32),u.Wb(71,"button",33),u.ec("click",(function(){return u.xc(n),u.ic().save()})),u.Gc(72),u.Vb(),u.Wb(73,"button",34),u.ec("click",(function(){return u.xc(n),u.ic().cancel()})),u.Gc(74,"Cancel"),u.Vb(),u.Vb(),u.Vb()}if(2&e){var i=u.vc(14),r=u.vc(43),c=u.vc(55),o=u.ic();u.Cb(1),u.oc("ngIf",o.errors),u.Cb(7),u.oc("ngIf",!o.model.authors||o.model.authors.length<1),u.Cb(2),u.oc("ngForOf",o.model.authors),u.Cb(2),u.oc("ngIf",o.model.curators.length>0),u.Cb(7),u.oc("ngModel",o.firstName),u.Cb(6),u.oc("ngModel",o.lastName),u.Cb(2),u.oc("disabled",!i.form.valid),u.Cb(2),u.oc("disabled",!i.form.valid),u.Cb(9),u.oc("ngIf",!o.model.institutions||o.model.institutions.length<1),u.Cb(2),u.oc("ngForOf",o.model.institutions),u.Cb(8),u.oc("ngModel",o.institutionName),u.Cb(2),u.oc("disabled",!r.form.valid),u.Cb(3),u.oc("ngIf",o.model.fundings.length>0),u.Cb(7),u.oc("ngModel",o.funderName),u.Cb(6),u.oc("ngModel",o.grantNr),u.Cb(2),u.oc("disabled",!c.form.valid),u.Cb(3),u.oc("disabled",o.blocked||o.errors),u.Cb(1),u.Hc(o.okLabel)}}var dt,ft,ht=((dt=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,Se.INSTANCE)).okLabel="Save",e.blocked=!1,e}return _createClass(n,[{key:"addAuthor",value:function(){var e=this.selectedPerson();e&&(this._model.authors.push(e),this.resetPerson(),this.triggerValidation())}},{key:"addCurator",value:function(){var e=this.selectedPerson();e&&(this._model.curators.push(e),this.resetPerson())}},{key:"removeAuthor",value:function(e){Object(Ue.b)(e,this._model.authors),this.triggerValidation()}},{key:"removeCurator",value:function(e){Object(Ue.b)(e,this._model.curators)}},{key:"addInstitution",value:function(){var e=this.selectedInstitution();if(e){if(this.hasInstitution(e,this._model))return;this._model.institutions.push(e),this.resetInstitution()}}},{key:"hasInstitution",value:function(e,t){return t.institutions.findIndex((function(t){return t.name===e.name}))>=0}},{key:"removeInstitution",value:function(e){Object(Ue.b)(e,this.model.institutions)}},{key:"addFunding",value:function(){var e=this.selectedFunding();if(e){if(this.hasFunding(e,this._model))return;this._model.fundings.push(e),this.resetFunding()}}},{key:"hasFunding",value:function(e,t){return t.fundings.findIndex((function(t){return t.name===e.name}))>=0}},{key:"removeFunding",value:function(e){Object(Ue.b)(e,this._model.fundings)}},{key:"resetPerson",value:function(){this.firstName=void 0,this.lastName=void 0,this.persForm.reset()}},{key:"selectedPerson",value:function(){return this.firstName&&this.lastName?new Xe.a(this.firstName,this.lastName):null}},{key:"resetInstitution",value:function(){this.institutionName=void 0,this.instForm.reset()}},{key:"selectedInstitution",value:function(){return this.institutionName?new He.a(this.institutionName):null}},{key:"resetFunding",value:function(){this.funderName=void 0,this.grantNr=void 0,this.fundForm.reset()}},{key:"selectedFunding",value:function(){if(this.funderName){var e=new He.a(this.funderName),t=new Be.a;return t.institution=e,t.grantNr=this.grantNr,t}return null}},{key:"model",get:function(){return this._model},set:function(e){this.setModel(e)}}]),n}(Me)).\u0275fac=function(e){return new(e||dt)},dt.\u0275cmp=u.Kb({type:dt,selectors:[["bd2-contr-desc-form"]],viewQuery:function(e,t){var n;1&e&&(u.Mc(Ye,!0),u.Mc(Ze,!0),u.Mc(et,!0)),2&e&&(u.uc(n=u.fc())&&(t.persForm=n.first),u.uc(n=u.fc())&&(t.instForm=n.first),u.uc(n=u.fc())&&(t.fundForm=n.first))},inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[u.zb],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"form-group"],[3,"removed",4,"ngFor","ngForOf"],["inset","",1,"mt-2"],["class","form-group",4,"ngIf"],[1,"form-inline"],["persForm","ngForm"],[1,"form-group","mr-1"],["for","pFirst"],["matInput","","id","pFirst","maxlength","100","minlength","2","name","pFirst","placeholder","e.g. John)","required","","type","text",3,"ngModel","ngModelChange"],["pFirst","ngModel"],["for","pLast"],["matInput","","id","pLast","maxlength","100","minlength","2","name","pLast","placeholder","e.g. Smith","required","","type","text",3,"ngModel","ngModelChange"],["pLast","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","mr-1","ml-1",3,"disabled","click"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"mb-1"],["instForm","ngForm"],["for","iName"],["matInput","","id","iName","maxlength","100","minlength","3","name","iName","placeholder","e.g. University of Edinburgh","required","","type","text",1,"",3,"ngModel","ngModelChange"],["iName","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","ml-1",3,"disabled","click"],["inset","",1,"mt-1","mb-2"],["fundForm","ngForm"],[1,"mr-1"],["for","fName"],["matInput","","id","fName","maxlength","100","minlength","3","name","fName","placeholder","e.g. BBSRC","required","","type","text",1,"",3,"ngModel","ngModelChange"],["fName","ngModel"],["for","fGrant"],["matInput","","id","fGrant","maxlength","100","minlength","3","name","fGrant","placeholder","e.g. EC2014","type","text",1,"",3,"ngModel","ngModelChange"],["fGrant","ngModel"],[1,"mt-2"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"alert","alert-danger"],[1,"mb-0"],[4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""]],template:function(e,t){1&e&&u.Ec(0,bt,75,18,"div",0),2&e&&u.oc("ngIf",t.model)},directives:[i.m,Ke.a,Ke.c,Qe.c,i.l,$e.a,Te.C,Te.q,Te.r,Pe.c,Pe.g,Re.b,Te.c,Te.k,Te.l,Te.y,Te.p,Te.s,Qe.a,Je.a,Qe.d],encapsulation:2}),dt),mt=n("FUU9"),pt=n("D0XW"),vt=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),gt=n("mlxB"),yt=n("l7GE"),Ct=n("ZUHj"),kt=function(){function e(t,n,i,r){_classCallCheck(this,e),this.waitFor=t,this.absoluteTimeout=n,this.withObservable=i,this.scheduler=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Wt(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))}}]),e}(),Wt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,r,c,o){var s;return _classCallCheck(this,n),(s=t.call(this,e)).absoluteTimeout=i,s.waitFor=r,s.withObservable=c,s.scheduler=o,s.action=null,s.scheduleTimeout(),s}return _createClass(n,[{key:"scheduleTimeout",value:function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(n.dispatchTimeout,this.waitFor,this))}},{key:"_next",value:function(e){this.absoluteTimeout||this.scheduleTimeout(),_get(_getPrototypeOf(n.prototype),"_next",this).call(this,e)}},{key:"_unsubscribe",value:function(){this.action=null,this.scheduler=null,this.withObservable=null}}],[{key:"dispatchTimeout",value:function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(Object(Ct.a)(e,t))}}]),n}(yt.a),Vt=n("z6cu"),Et=n("vkgz"),wt=n("JIr8"),xt=n("I65S"),_t=n("UsWK"),St=((ft=function(){function e(t){_classCallCheck(this,e),this.BD2REST=t,this.popularSpecies=["Arabidopsis thaliana","Brassica rapa","Danio rerio","Drosophila melanogaster","Glycine max","Homo sapiens","Lemna gibba","Lemna minor","Marchantia polymorpha","Medicago truncatula","Mus musculus","Nannochloropsis","Neurospora crassa","Oryza sativa","Ostreococcus tauri","Phaeodactylum tricornutum","Physcometrella patens","Picea abies","Rattus norvegicus","Saccharomyces cerevisiae","Synechococcus elongatus","Synthetic data"],this.fetchedSpecies=void 0,console.log("Species Service")}return _createClass(e,[{key:"species",value:function(){return this.fetchedSpecies?Promise.resolve(this.fetchedSpecies):this.fetchSpecies().toPromise()}},{key:"fetchSpecies",value:function(){var e=this;return this.BD2REST.species().pipe(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pt.a;return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pt.a;return function(i){var r=Object(gt.a)(e),c=r?+e-n.now():Math.abs(e);return i.lift(new kt(c,r,t,n))}}(5e3,Object(Vt.a)(new vt),t)}(),Object(Et.a)((function(t){if(!(t&&t.length>0))throw new Error("Retrieved empty species falls back to default");e.fetchedSpecies=t})),Object(wt.a)((function(t){return console.log(" Could not fetch species",t),Object(xt.of)(e.popularSpecies)})))}}]),e}()).\u0275fac=function(e){return new(e||ft)(u.ac(_t.a))},ft.\u0275prov=u.Mb({token:ft,factory:ft.\u0275fac,providedIn:"root"}),ft),It=n("d3UM"),Dt=n("FKr1");function Gt(e,t){if(1&e&&(u.Wb(0,"mat-option",13),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.oc("value",n),u.Cb(1),u.Ic("",n," ")}}function Mt(e,t){if(1&e&&(u.Wb(0,"mat-option",13),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.oc("value",n.name),u.Cb(1),u.Ic(" ",n.longName," ")}}function Ft(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Wb(1,"form",null,1),u.Wb(3,"div",2),u.Wb(4,"mat-form-field",3),u.Wb(5,"mat-label",4),u.Gc(6,"Species"),u.Vb(),u.Wb(7,"mat-select",5,6),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic()._model.species=e})),u.Ec(9,Gt,2,2,"mat-option",7),u.Vb(),u.Wb(10,"mat-hint"),u.Gc(11,"Please email us if you don't see suitable terms in the value lists"),u.Vb(),u.Vb(),u.Vb(),u.Wb(12,"div",2),u.Wb(13,"mat-form-field",3),u.Wb(14,"mat-label",8),u.Gc(15,"Data category"),u.Vb(),u.Wb(16,"mat-select",9,10),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic()._model.category=e})),u.Ec(18,Mt,2,2,"mat-option",7),u.Vb(),u.Wb(19,"mat-hint"),u.Gc(20,"Please email us if you don't see suitable terms in the value lists"),u.Vb(),u.Vb(),u.Vb(),u.Wb(21,"button",11),u.ec("click",(function(){return u.xc(n),u.ic().save()})),u.Gc(22),u.Vb(),u.Wb(23,"button",12),u.ec("click",(function(){return u.xc(n),u.ic().cancel()})),u.Gc(24,"Cancel"),u.Vb(),u.Vb(),u.Vb()}if(2&e){var i=u.vc(2),r=u.ic();u.Cb(7),u.oc("ngModel",r._model.species),u.Cb(2),u.oc("ngForOf",r.knownSpecies),u.Cb(7),u.oc("ngModel",r._model.category),u.Cb(2),u.oc("ngForOf",r.categories),u.Cb(3),u.oc("disabled",r.blocked||!i.form.valid),u.Cb(1),u.Hc(r.okLabel)}}var Ot,At,qt=((Ot=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var i;return _classCallCheck(this,n),(i=t.call(this)).speciesService=e,i.okLabel="Save",i.blocked=!1,i.onAccepted=new u.o,i.onCancelled=new u.o,i.categories=[],i.knownSpecies=[],i._model={species:null,category:null},i}return _createClass(n,[{key:"getModel",value:function(){return this._model}},{key:"ngOnInit",value:function(){var e=this;this.speciesService.species().then((function(t){return e.knownSpecies=t})),this.categories=this.initCategories()}},{key:"cancel",value:function(){this.clearErrors(),this.onCancelled.emit(!0)}},{key:"save",value:function(){this.triggerValidation()&&(this.experiment.dataCategory=mt.a.get(this._model.category),this.experiment.species=this._model.species,this.onAccepted.emit(this.experiment))}},{key:"validate",value:function(e){var t=[];return e.species&&""!==e.species.trim()||t.push("Species cannot be empty"),e.species&&this.knownSpecies.indexOf(e.species)<0&&t.push("Unknown species: "+e.species),e.category&&"NONE"!==e.category||t.push("Data category is required"),0===t.length?null:t}},{key:"initCategories",value:function(){var e=mt.a.getValidOptions().slice();return Object(Ue.b)(mt.a.get("NONE"),e),e}},{key:"model",set:function(e){e&&(this.experiment=e,this._model.species=e.species,this._model.category=e.dataCategory?e.dataCategory.name:null)}}]),n}(Ge.a)).\u0275fac=function(e){return new(e||Ot)(u.Qb(St))},Ot.\u0275cmp=u.Kb({type:Ot,selectors:[["bd2-simple-bio-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[u.zb],decls:1,vars:1,consts:[[4,"ngIf"],["sBioForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","species"],["id","species","required","","placeholder","Select species","name","species",1,"",3,"ngModel","ngModelChange"],["species","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","dataCategory"],["id","dataCategory","required","","placeholder","Select category","name","dataCategory",1,"",3,"ngModel","ngModelChange"],["dataCategory","ngModel"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(e,t){1&e&&u.Ec(0,Ft,25,6,"div",0),2&e&&u.oc("ngIf",t.experiment)},directives:[i.m,Te.C,Te.q,Te.r,Pe.c,Pe.g,It.a,Te.y,Te.p,Te.s,i.l,Pe.f,Dt.o],encapsulation:2}),Ot),Tt=n("LRne"),Pt=n("JX91"),Rt=n("zrmi"),Nt=((At=function(){function e(){_classCallCheck(this,e),this.equipments=new Map,this.parameters=new Map,this.initTechniques()}return _createClass(e,[{key:"getTechniques",value:function(){return Promise.resolve(this.techniques)}},{key:"getEquipments",value:function(e){return this.equipments.has(e)?Promise.resolve(this.equipments.get(e)):Promise.reject(new Error("Unknown technique: "+e))}},{key:"getParameters",value:function(e){return this.parameters.has(e)?Promise.resolve(this.parameters.get(e)):Promise.reject(new Error("Unknown technique: "+e))}},{key:"registerEquipment",value:function(e,t){return this.equipments.has(e)?(this.equipments.get(e).indexOf(t)<0&&this.equipments.get(e).push(t),Promise.resolve(t)):Promise.reject(new Error("Unknown technique: "+e))}},{key:"initTechniques",value:function(){var e=this,t=["Luciferase luminescence","Bioluminescence","(G)FP fluorescence","Delayed fluorescence","Endogenous fluorescence","Leaf movement","General imaging"];this.techniques=t.concat(["Computer simulation","qRT-PCR","RNA microarray","RNA-Seq","Northern blot","Western blot","Protein array","Mass Spectrometry","Flow cytometry","Spectrophotometry","Immunoprecipitation","Biomass Assay","Gas exchange","Oxygen concentration","Other"]);var n=["","Luminometer","Tecan Infinite 200 PRO","Topcount 1","Topcount 2","Topcount 3","Topcount 4","HAM 1","HAM 2","HAM 3","Unknown"];this.equipments=new Map,this.techniques.forEach((function(t){return e.equipments.set(t,["","Unknown"])})),t.forEach((function(t){return e.equipments.set(t,n)})),this.equipments.set("qRT-PCR",["","Robot + Light Cycler 480","Light Cycler 480","Unknown"]),this.equipments.set("Oxygen concentration",["","Galvanic Clarck's probe","Unknown"]);var i=[];i.push(new Rt.b("exposure_time",void 0,"Exposure time","min")),i.push(new Rt.b("interval",void 0,"Img interval","h")),i.push(new Rt.b("start_time",void 0,"Start time","h")),this.parameters=new Map,this.techniques.forEach((function(t){return e.parameters.set(t,[])})),t.forEach((function(t){return e.parameters.set(t,i)}))}}]),e}()).\u0275fac=function(e){return new(e||At)},At.\u0275prov=u.Mb({token:At,factory:At.\u0275fac,providedIn:"root"}),At),Lt=n("/1cH");function jt(e,t){1&e&&(u.Wb(0,"mat-error"),u.Gc(1,"Known technique must be selected"),u.Vb())}function zt(e,t){if(1&e&&(u.Wb(0,"mat-option",19),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.oc("value",n),u.Cb(1),u.Ic(" ",n," ")}}function Bt(e,t){if(1&e&&(u.Wb(0,"mat-option",19),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.oc("value",n),u.Cb(1),u.Ic(" ",n," ")}}function Ht(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Wb(1,"form",1),u.Wb(2,"mat-hint",2),u.Gc(3,"Please email us if you don't see suitable terms in the value lists"),u.Vb(),u.Wb(4,"div",3),u.Wb(5,"mat-form-field",4),u.Wb(6,"mat-label",5),u.Gc(7,"Technique"),u.Vb(),u.Rb(8,"input",6,7),u.Wb(10,"mat-hint"),u.Gc(11,"Type to select technique (backspace for all available)"),u.Vb(),u.Ec(12,jt,2,0,"mat-error",0),u.Vb(),u.Wb(13,"mat-autocomplete",8,9),u.ec("optionSelected",(function(e){return u.xc(n),u.ic().techniqueSelected(e)})),u.Ec(15,zt,2,2,"mat-option",10),u.jc(16,"async"),u.Vb(),u.Vb(),u.Wb(17,"div",3),u.Wb(18,"mat-form-field",4),u.Wb(19,"mat-label",11),u.Gc(20,"Equipment"),u.Vb(),u.Rb(21,"input",12,13),u.Wb(23,"mat-hint"),u.Gc(24,"Type define your equipment or choose from the list (backspace for all known)"),u.Vb(),u.Vb(),u.Wb(25,"mat-autocomplete",null,14),u.Ec(27,Bt,2,2,"mat-option",10),u.jc(28,"async"),u.Vb(),u.Vb(),u.Wb(29,"div",3),u.Wb(30,"mat-form-field",4),u.Wb(31,"mat-label",15),u.Gc(32,"Description"),u.Vb(),u.Wb(33,"textarea",16),u.Gc(34,"     "),u.Vb(),u.Wb(35,"mat-hint"),u.Gc(36,"Describe how the measurement was conducted"),u.Vb(),u.Vb(),u.Vb(),u.Wb(37,"button",17),u.ec("click",(function(){return u.xc(n),u.ic().save()})),u.Gc(38),u.Vb(),u.Wb(39,"button",18),u.ec("click",(function(){return u.xc(n),u.ic().cancel()})),u.Gc(40,"Cancel"),u.Vb(),u.Vb(),u.Vb()}if(2&e){var i=u.vc(14),r=u.vc(26),c=u.ic();u.Cb(1),u.oc("formGroup",c.formModel),u.Cb(7),u.oc("matAutocomplete",i),u.Cb(4),u.oc("ngIf",null==c.formModel.get("technique").errors?null:c.formModel.get("technique").errors.validTechnique),u.Cb(3),u.oc("ngForOf",u.kc(16,8,c.filteredTechniques)),u.Cb(6),u.oc("matAutocomplete",r),u.Cb(6),u.oc("ngForOf",u.kc(28,10,c.filteredEquipments)),u.Cb(10),u.oc("disabled",c.blocked||!c.formModel.valid),u.Cb(1),u.Hc(c.okLabel)}}var Xt,Ut=((Xt=function(){function e(t,n,i){_classCallCheck(this,e),this.techniqueService=t,this.feedback=n,this.fb=i,this.okLabel="Save",this.onAccepted=new u.o,this.onCancelled=new u.o,this.techniques=[],this.filteredTechniques=Object(Tt.a)([]),this.equipments=[],this.filteredEquipments=Object(Tt.a)([])}return _createClass(e,[{key:"setModel",value:function(e){this._orgModel=e}},{key:"ngOnInit",value:function(){this.updateTechniques()}},{key:"filter",value:function(e,t){var n=t.toLowerCase();return e.filter((function(e){return e.toLowerCase().includes(n)}))}},{key:"buildMainForm",value:function(e){var t=this;return this.fb.group({technique:[e.technique,[Te.A.required,function(e){return t.knownTechnique(e.value)}]],equipment:[e.equipment],description:[e.description],parameters:[]})}},{key:"knownTechnique",value:function(e){return e?this.techniques.find((function(t){return t===e}))?null:{validTechnique:"Unknown technique: "+e}:{validTechnique:"Empty value"}}},{key:"techniqueSelected",value:function(e){e.option.value&&this.updateEquipments(e.option.value)}},{key:"updateTechniques",value:function(){var e=this;return this.techniqueService.getTechniques().then((function(t){return e.techniques=t||[],t})).catch((function(t){return e.feedback.error(t),Promise.reject(t)}))}},{key:"updateEquipments",value:function(e){var t=this;return e?this.techniqueService.getEquipments(e).then((function(e){return t.equipments=e||[],e})).catch((function(e){return t.feedback.error(e),Promise.reject(e)})):(this.equipments=[],Promise.resolve([]))}},{key:"cancel",value:function(){this.onCancelled.emit(!0)}},{key:"save",value:function(){this.formModel.valid&&(this._orgModel.setAll(this.formModel.value),this.onAccepted.emit(this._orgModel))}},{key:"model",set:function(e){var t=this;this.setModel(e),this.updateTechniques().then((function(n){return t.updateEquipments(e.technique)})).then((function(n){return t.formModel=t.buildMainForm(e)})).then((function(e){t.filteredTechniques=t.formModel.get("technique").valueChanges.pipe(Object(Pt.a)(""),Object(o.a)((function(e){return t.filter(t.techniques,e)}))),t.filteredEquipments=t.formModel.get("equipment").valueChanges.pipe(Object(Pt.a)(""),Object(o.a)((function(e){return t.filter(t.equipments,e)})))}))}}]),e}()).\u0275fac=function(e){return new(e||Xt)(u.Qb(Nt),u.Qb(d.a),u.Qb(Te.d))},Xt.\u0275cmp=u.Kb({type:Xt,selectors:[["bd2-measurement-desc-rform"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"formGroup"],[1,"mb-2"],[1,"form-group"],[1,"w-100"],["for","mTechNameA"],["matInput","","formControlName","technique","id","mTechNameA","placeholder","Type to select technique (backspace for all available)","required","",1,"",3,"matAutocomplete"],["mTechNameA",""],[3,"optionSelected"],["techniqueAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["for","mEquipNameA"],["matInput","","formControlName","equipment","id","mEquipNameA","placeholder","Type to choose or define equipment",1,"",3,"matAutocomplete"],["mEquipNameA",""],["equipmentAuto","matAutocomplete"],["for","mDescription"],["matInput","","formControlName","description","id","mDescription","placeholder","Describe how the measurement was conducted, used technical tricks etc...\nFor example: plants were sprayed with luciferase two ours before measurement. Images were taken every two ours.","rows","5","type","text",1,""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(e,t){1&e&&u.Ec(0,Ht,41,12,"div",0),2&e&&u.oc("ngIf",t.formModel)},directives:[i.m,Te.C,Te.q,Te.h,Pe.f,Pe.c,Pe.g,Re.b,Te.c,Lt.c,Te.p,Te.g,Te.y,Lt.a,i.l,Pe.b,Dt.o],pipes:[i.b],encapsulation:2}),Xt);function Kt(e,t){if(1&e&&(u.Wb(0,"li"),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.Cb(1),u.Hc(n)}}function Qt(e,t){if(1&e&&(u.Wb(0,"div",8),u.Wb(1,"ul"),u.Ec(2,Kt,2,1,"li",9),u.Vb(),u.Vb()),2&e){var n=u.ic(2);u.Cb(2),u.oc("ngForOf",n.errors)}}function $t(e,t){if(1&e){var n=u.Xb();u.Wb(0,"bd2-general-desc-form",10),u.ec("onAccepted",(function(e){return u.xc(n),u.ic(2).saveEdits(e)}))("onCancelled",(function(e){return u.xc(n),u.ic(2).hideEdits(e)})),u.Vb()}if(2&e){var i=u.ic(2);u.oc("blocked",i.blocked)("model",i.assay.generalDesc)}}function Jt(e,t){if(1&e&&u.Rb(0,"bd2-general-desc-view",11),2&e){var n=u.ic(2);u.oc("model",n.assay.generalDesc)}}function Yt(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"button",12),u.ec("click",(function(){return u.xc(n),u.ic(2).activeGeneralDescForm=!0})),u.Gc(3,"Modify "),u.Vb(),u.Vb()}if(2&e){var i=u.ic(2);u.Cb(2),u.oc("disabled",i.activeGeneralDescForm)}}function Zt(e,t){if(1&e){var n=u.Xb();u.Wb(0,"bd2-contr-desc-form",10),u.ec("onAccepted",(function(e){return u.xc(n),u.ic(2).saveEdits(e)}))("onCancelled",(function(e){return u.xc(n),u.ic(2).hideEdits(e)})),u.Vb()}if(2&e){var i=u.ic(2);u.oc("blocked",i.blocked)("model",i.assay.contributionDesc)}}function en(e,t){if(1&e&&u.Rb(0,"bd2-contr-desc-view",11),2&e){var n=u.ic(2);u.oc("model",n.assay.contributionDesc)}}function tn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"button",12),u.ec("click",(function(){return u.xc(n),u.ic(2).activeContributionDescForm=!0})),u.Gc(3,"Modify "),u.Vb(),u.Vb()}if(2&e){var i=u.ic(2);u.Cb(2),u.oc("disabled",i.activeContributionDescForm)}}function nn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"bd2-simple-bio-desc-form",10),u.ec("onAccepted",(function(e){return u.xc(n),u.ic(2).saveEdits(e)}))("onCancelled",(function(e){return u.xc(n),u.ic(2).hideEdits(e)})),u.Vb()}if(2&e){var i=u.ic(2);u.oc("blocked",i.blocked)("model",i.assay)}}function rn(e,t){if(1&e&&u.Rb(0,"bd2-simple-bio-desc-view",11),2&e){var n=u.ic(2);u.oc("model",n.assay)}}function cn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"button",12),u.ec("click",(function(){return u.xc(n),u.ic(2).activeSimpleBioDescForm=!0})),u.Gc(3,"Modify "),u.Vb(),u.Vb()}if(2&e){var i=u.ic(2);u.Cb(2),u.oc("disabled",i.activeSimpleBioDescForm)}}function on(e,t){if(1&e){var n=u.Xb();u.Wb(0,"bd2-measurement-desc-rform",10),u.ec("onAccepted",(function(e){return u.xc(n),u.ic(2).saveEdits(e)}))("onCancelled",(function(e){return u.xc(n),u.ic(2).hideEdits(e)})),u.Vb()}if(2&e){var i=u.ic(2);u.oc("blocked",i.blocked)("model",i.assay.experimentalDetails.measurementDesc)}}function sn(e,t){if(1&e&&u.Rb(0,"bd2-measurement-desc-view",11),2&e){var n=u.ic(2);u.oc("model",n.assay.experimentalDetails.measurementDesc)}}function an(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"button",12),u.ec("click",(function(){return u.xc(n),u.ic(2).activeMeasurementDescForm=!0})),u.Gc(3,"Modify "),u.Vb(),u.Vb()}if(2&e){var i=u.ic(2);u.Cb(2),u.oc("disabled",i.activeMeasurementDescForm)}}function un(e,t){if(1&e&&(u.Wb(0,"li"),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.Cb(1),u.Hc(n)}}function ln(e,t){if(1&e&&(u.Wb(0,"div",8),u.Wb(1,"ul"),u.Ec(2,un,2,1,"li",9),u.Vb(),u.Vb()),2&e){var n=u.ic(2);u.Cb(2),u.oc("ngForOf",n.errors)}}function bn(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"h3"),u.Gc(2,"Modify experiment description"),u.Vb(),u.Ec(3,Qt,3,1,"div",1),u.Wb(4,"div",2),u.Wb(5,"div",3),u.Gc(6,"General description"),u.Vb(),u.Wb(7,"div",4),u.Ec(8,$t,1,2,"bd2-general-desc-form",5),u.Ec(9,Jt,1,1,"bd2-general-desc-view",6),u.Ec(10,Yt,4,1,"div",0),u.Vb(),u.Vb(),u.Wb(11,"div",2),u.Wb(12,"div",3),u.Gc(13,"Contributions"),u.Vb(),u.Wb(14,"div",4),u.Ec(15,Zt,1,2,"bd2-contr-desc-form",5),u.Ec(16,en,1,1,"bd2-contr-desc-view",6),u.Ec(17,tn,4,1,"div",0),u.Vb(),u.Vb(),u.Wb(18,"div",2),u.Wb(19,"div",3),u.Gc(20,"Biological details"),u.Vb(),u.Wb(21,"div",4),u.Ec(22,nn,1,2,"bd2-simple-bio-desc-form",5),u.Ec(23,rn,1,1,"bd2-simple-bio-desc-view",6),u.Ec(24,cn,4,1,"div",0),u.Vb(),u.Vb(),u.Wb(25,"div",7),u.Wb(26,"div",3),u.Gc(27,"Measurement details"),u.Vb(),u.Wb(28,"div",4),u.Ec(29,on,1,2,"bd2-measurement-desc-rform",5),u.Ec(30,sn,1,1,"bd2-measurement-desc-view",6),u.Ec(31,an,4,1,"div",0),u.Vb(),u.Vb(),u.Ec(32,ln,3,1,"div",1),u.Vb()),2&e){var n=u.ic();u.Cb(3),u.oc("ngIf",n.errors),u.Cb(5),u.oc("ngIf",n.activeGeneralDescForm),u.Cb(1),u.oc("ngIf",!n.activeGeneralDescForm),u.Cb(1),u.oc("ngIf",!n.activeGeneralDescForm),u.Cb(5),u.oc("ngIf",n.activeContributionDescForm),u.Cb(1),u.oc("ngIf",!n.activeContributionDescForm),u.Cb(1),u.oc("ngIf",!n.activeContributionDescForm),u.Cb(5),u.oc("ngIf",n.activeSimpleBioDescForm),u.Cb(1),u.oc("ngIf",!n.activeSimpleBioDescForm),u.Cb(1),u.oc("ngIf",!n.activeSimpleBioDescForm),u.Cb(5),u.oc("ngIf",n.activeMeasurementDescForm),u.Cb(1),u.oc("ngIf",!n.activeMeasurementDescForm),u.Cb(1),u.oc("ngIf",!n.activeMeasurementDescForm),u.Cb(1),u.oc("ngIf",n.errors)}}var dn,fn,hn=((dn=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i){var r;return _classCallCheck(this,n),(r=t.call(this,i)).route=e,r.blocked=!1,r.activeGeneralDescForm=!1,r.activeContributionDescForm=!1,r.activeSimpleBioDescForm=!1,r.activeMeasurementDescForm=!1,r.titlePart=" Edit",r.validator=De.INSTANCE,r}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;_get(_getPrototypeOf(n.prototype),"ngOnInit",this).call(this),this.route.fragment.subscribe((function(t){e.requestedSection=t,e.focusOnSection(t)}))}},{key:"ngAfterViewInit",value:function(){this.focusOnSection(this.requestedSection)}},{key:"focusOnSection",value:function(e){if(e){var t=document.getElementById(e);t&&t.scrollIntoView(),"MeasurementSection"===e&&(this.activeMeasurementDescForm=!0)}}},{key:"saveEdits",value:function(e){var t=this;this.assay&&e&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.save(this.assay).then((function(e){return t.feedback.success('Experiment: "'+e.name+'" updated.'),e})).then((function(e){return t.currentExperiment.push(e),e})).then((function(n){t.blocked=!1,t.hideEdits(e)})).catch((function(e){t.blocked=!1,t.feedback.error(e)})))}},{key:"hideEdits",value:function(e){this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}},{key:"cancel",value:function(){this.clearErrors(),this.router.navigate(["/experiment",this.assay.id])}},{key:"updateModel",value:function(e){this._orgModel=e,this.assay=e?e.clone():null,this.setTitle()}}]),n}(J.a)).\u0275fac=function(e){return new(e||dn)(u.Qb(r.a),u.Qb(a.a))},dn.\u0275cmp=u.Kb({type:dn,selectors:[["ng-component"]],features:[u.Bb([]),u.zb],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"blocked","model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["id","MeasurementSection",1,"card","mb-2"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"],[3,"blocked","model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&u.Ec(0,bn,33,14,"div",0),2&e&&u.oc("ngIf",t.assay)},directives:[i.m,i.l,ze,ie,ht,fe,qt,pe,Ut,We],encapsulation:2}),dn),mn=function(){var e=function(){function e(t){_classCallCheck(this,e),this.name=t}return _createClass(e,[{key:"equals",value:function(e){return this.name===e.name}},{key:"toJSON",value:function(){return this.name}}],[{key:"deserialize",value:function(t){if(null==t)return null;var n=e.valuesMap.get(t);if(n)return n;var i=+t;if(i<0||i>=e.values.length||Number.isNaN(i))throw new RangeError("Uknown AssetType "+t);return e.values[i]}},{key:"initValuesMap",value:function(){var t=new Map;return e.values.forEach((function(e){return t.set(e.name,e)})),t}}]),e}();return e.NONE=new e("NONE"),e.FILE=new e("FILE"),e.MEDIA=new e("MEDIA"),e.DATA=new e("DATA"),e.TS_DATA=new e("TS_DATA"),e.values=[e.NONE,e.FILE,e.MEDIA,e.DATA,e.TS_DATA],e.valuesMap=e.initValuesMap(),e}(),pn=function(){function e(){_classCallCheck(this,e),this.assetType=mn.NONE,this.versions=[]}return _createClass(e,[{key:"setAll",value:function(e){this.id=e.id,this.originalName=e.originalName,this.assetType=e.assetType,this.url=e.url,this.versions=e.versions}},{key:"last",get:function(){return this.versions[0]}}],[{key:"deserialize",value:function(t){var n=new e;return n.id=t.id,n.originalName=t.originalName,n.url=t.url,n.assetType=mn.deserialize(t.assetType),t.versions&&(n.versions=t.versions.map((function(e){return function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"deserialize",value:function(e){return e.created=qe.a.deserialize(e.created),e}}]),e}().deserialize(e)}))),n}}]),e}(),vn=((fn=function(){function e(t){_classCallCheck(this,e),this.BD2REST=t}return _createClass(e,[{key:"upload",value:function(e,t){for(var n=new FormData,i=0;i<t.length;i++)n.append("file",t[i],t[i].name);return this.BD2REST.expFileUpload(e.id,n).then((function(e){return e.data}))}},{key:"getFiles",value:function(e){var t=this;return this.BD2REST.files(e.id).then((function(e){return e.data})).then((function(e){return t.json2AssetsList(e)})).then((function(n){return t.fillURLs(n,e)}))}},{key:"fillURLs",value:function(e,t){var n=this;return e.map((function(e){return n.fillURL(e,t)}))}},{key:"fillURL",value:function(e,t){var n=this.BD2REST.fileURL(t.id,e.id);return e.url=n,e.versions.forEach((function(e){e.url=n+"/"+e.versionId})),e}},{key:"json2AssetsList",value:function(e){return e.map((function(e){return pn.deserialize(e)}))}}]),e}()).\u0275fac=function(e){return new(e||fn)(u.ac(_t.a))},fn.\u0275prov=u.Mb({token:fn,factory:fn.\u0275fac,providedIn:"root"}),fn),gn=n("vLYz");function yn(e,t){if(1&e&&(u.Wb(0,"div"),u.Gc(1),u.Vb()),2&e){var n=u.ic(2);u.Cb(1),u.Hc(n.file.last.description)}}function Cn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"li"),u.Gc(1),u.jc(2,"date"),u.Wb(3,"strong"),u.Wb(4,"a",4),u.ec("click",(function(){return u.xc(n),u.ic(3).recordDownload()})),u.Gc(5),u.Vb(),u.Vb(),u.Rb(6,"br"),u.Gc(7),u.Vb()}if(2&e){var i=t.$implicit;u.Cb(1),u.Jc(" Version ",i.versionId,". ",u.lc(2,6,i.created.date,"shortDate")," "),u.Cb(3),u.pc("href",i.url,u.zc),u.pc("download",i.originalName),u.Cb(1),u.Hc(i.originalName),u.Cb(2),u.Ic("",i.description," ")}}function kn(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"ul",5),u.Ec(2,Cn,8,9,"li",6),u.Vb(),u.Vb()),2&e){var n=u.ic(2);u.Cb(2),u.oc("ngForOf",n.file.versions)}}function Wn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Wb(1,"div",1),u.Gc(2),u.Wb(3,"a",2),u.ec("click",(function(){u.xc(n);var e=u.ic();return e.showVersions=!e.showVersions})),u.Wb(4,"i",3),u.Gc(5,"expand_more"),u.Vb(),u.Vb(),u.Vb(),u.Wb(6,"h5"),u.Wb(7,"a",4),u.ec("click",(function(){return u.xc(n),u.ic().recordDownload()})),u.Gc(8),u.Vb(),u.Vb(),u.Ec(9,yn,2,1,"div",0),u.Ec(10,kn,3,1,"div",0),u.Vb()}if(2&e){var i=u.ic();u.Cb(2),u.Ic(" ",i.file.versions.length," versions "),u.Cb(5),u.pc("href",i.file.url,u.zc),u.pc("download",i.file.last.originalName),u.Cb(1),u.Hc(i.file.last.originalName),u.Cb(1),u.oc("ngIf",i.file.last.description),u.Cb(1),u.oc("ngIf",i.showVersions)}}var Vn,En=((Vn=function(){function e(t){_classCallCheck(this,e),this.analytics=t,this.canEdit=!0,this.showVersions=!1,this.edit=!1,this.model=this.fakeFileAsset()}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"fakeFileAsset",value:function(){var e=JSON.parse('{\n      "id" : 2,\n      "originalName" : "f2",\n      "assetType" : "TS_DATA",\n      "versions" : [ {\n        "versionId" : 2,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : "Some description",\n        "created" : [ 2016, 12, 8 ]\n      }, {\n        "versionId" : 1,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : null,\n        "created" : [ 2016, 12, 8 ]\n      } ]\n    }');return pn.deserialize(e)}},{key:"recordDownload",value:function(){this.analytics.fileDownload(this.parentId,this.file.id)}},{key:"model",set:function(e){this.file=e}}]),e}()).\u0275fac=function(e){return new(e||Vn)(u.Qb(f.a))},Vn.\u0275cmp=u.Kb({type:Vn,selectors:[["bd2-file-asset-view"]],inputs:{canEdit:"canEdit",parentId:"parentId",model:"model"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"float-right"],["role","button","aria-label","expand",3,"click"],[1,"material-icons","bd-icon"],[3,"href","download","click"],[1,"list-unstyled"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&u.Ec(0,Wn,11,6,"div",0),2&e&&u.oc("ngIf",t.file&&t.file.last)},directives:[i.m,i.l],pipes:[i.e],encapsulation:2}),Vn),wn=["uploadWidget"];function xn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Wb(1,"bd2-file-upload-widget",2,3),u.ec("uploadFiles",(function(e){return u.xc(n),u.ic(2).upload(e)})),u.Vb(),u.Rb(3,"hr"),u.Vb()}if(2&e){var i=u.ic(2);u.Cb(1),u.oc("autoReset",!1)("blocked",i.blocked)}}function _n(e,t){if(1&e&&u.Rb(0,"bd2-file-asset-view",5),2&e){var n=t.$implicit,i=u.ic(3);u.oc("model",n)("parentId",i.assay.id)}}function Sn(e,t){1&e&&(u.Wb(0,"div",6),u.Gc(1,' Use "Replace data" to change timeseries files. '),u.Vb())}function In(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"h4"),u.Gc(2,"Timeseries files"),u.Vb(),u.Ec(3,_n,1,2,"bd2-file-asset-view",4),u.Ec(4,Sn,2,0,"div",1),u.Rb(5,"hr"),u.Vb()),2&e){var n=u.ic(2);u.Cb(3),u.oc("ngForOf",n.tsData),u.Cb(1),u.oc("ngIf",n.assay.security.canWrite)}}function Dn(e,t){1&e&&(u.Wb(0,"div",6),u.Gc(1,' Use "Import data" to add timeseries files. '),u.Vb())}function Gn(e,t){if(1&e&&u.Rb(0,"bd2-file-asset-view",5),2&e){var n=t.$implicit,i=u.ic(3);u.oc("model",n)("parentId",i.assay.id)}}function Mn(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"h4"),u.Gc(2,"Attachments"),u.Vb(),u.Ec(3,Gn,1,2,"bd2-file-asset-view",4),u.Vb()),2&e){var n=u.ic(2);u.Cb(3),u.oc("ngForOf",n.attachments)}}function Fn(e,t){1&e&&(u.Wb(0,"div",6),u.Gc(1," Drag and upload files using the upload area in order to update the attachments. "),u.Vb())}function On(e,t){if(1&e&&(u.Wb(0,"div"),u.Ec(1,xn,4,2,"div",0),u.Ec(2,In,6,2,"div",0),u.Ec(3,Dn,2,0,"div",1),u.Ec(4,Mn,4,1,"div",0),u.Ec(5,Fn,2,0,"div",1),u.Vb()),2&e){var n=u.ic();u.Cb(1),u.oc("ngIf",n.assay.security.canWrite),u.Cb(1),u.oc("ngIf",n.tsData&&n.tsData.length>0),u.Cb(1),u.oc("ngIf",!n.tsData||0===n.tsData.length),u.Cb(1),u.oc("ngIf",n.attachments&&n.attachments.length>0),u.Cb(1),u.oc("ngIf",n.assay.security.canWrite)}}var An,qn=((An=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i){var r;return _classCallCheck(this,n),(r=t.call(this,i)).attachmentsService=e,r.attachments=[],r.tsData=[],r.blocked=!1,r.titlePart=" Files",r}return _createClass(n,[{key:"updateModel",value:function(e){_get(_getPrototypeOf(n.prototype),"updateModel",this).call(this,e),this.refreshAttachments()}},{key:"refreshAttachments",value:function(){var e=this;this.attachmentsService.getFiles(this.assay).then((function(t){return e.setFiles(t)})).catch((function(t){e.feedback.error(t)}))}},{key:"setFiles",value:function(e){this.tsData=e.filter((function(e){return e.assetType.equals(mn.TS_DATA)})),this.attachments=e.filter((function(e){return!e.assetType.equals(mn.TS_DATA)}))}},{key:"upload",value:function(e){var t=this;console.log("Uploading "+e.length),e&&0!==e.length&&(this.blocked=!0,this.attachmentsService.upload(this.assay,e).then((function(e){t.uploadWidget.reset(),t.blocked=!1,t.feedback.success(e.length+" files uploaded")})).then((function(){return t.refreshModel()})).catch((function(e){t.blocked=!1,t.feedback.error(e)})))}}]),n}(J.a)).\u0275fac=function(e){return new(e||An)(u.Qb(vn),u.Qb(a.a))},An.\u0275cmp=u.Kb({type:An,selectors:[["ng-component"]],viewQuery:function(e,t){var n;1&e&&u.Mc(wn,!0),2&e&&u.uc(n=u.fc())&&(t.uploadWidget=n.first)},features:[u.zb],decls:4,vars:1,consts:[[4,"ngIf"],["type","info","class","alert alert-info","role","alert",4,"ngIf"],[3,"autoReset","blocked","uploadFiles"],["uploadWidget",""],[3,"model","parentId",4,"ngFor","ngForOf"],[3,"model","parentId"],["type","info","role","alert",1,"alert","alert-info"]],template:function(e,t){1&e&&(u.Wb(0,"h3"),u.Gc(1,"Attached files"),u.Vb(),u.Rb(2,"hr"),u.Ec(3,On,6,5,"div",0)),2&e&&(u.Cb(3),u.oc("ngIf",t.assay))},directives:[i.m,gn.a,i.l,En],styles:[""]}),An);function Tn(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"div",1),u.Gc(2," Experiment is already publicly available under "),u.Wb(3,"strong"),u.Gc(4),u.Vb(),u.Gc(5," licence. "),u.Vb(),u.Vb()),2&e){var n=u.ic(2);u.Cb(4),u.Hc(n.assay.features.licence)}}function Pn(e,t){if(1&e&&(u.Wb(0,"option",12),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.oc("value",n),u.Cb(1),u.Ic("",n," ")}}function Rn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Wb(1,"div",2),u.Gc(2," You are about to make the data public. Once they are public they cannot be made private again. "),u.Wb(3,"ul"),u.Wb(4,"li"),u.Gc(5,"make sure you know what you are doing"),u.Vb(),u.Wb(6,"li"),u.Gc(7,"make sure all contributors agree to public sharing"),u.Vb(),u.Wb(8,"li"),u.Gc(9,"double check the description is correct, not all changes will be possible after the publishing"),u.Vb(),u.Vb(),u.Vb(),u.Wb(10,"form",null,3),u.Wb(12,"div",4),u.Wb(13,"label",5),u.Gc(14,"Licence"),u.Vb(),u.Wb(15,"select",6,7),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic(2).licence=e})),u.Ec(17,Pn,2,2,"option",8),u.Vb(),u.Vb(),u.Wb(18,"div",4),u.Wb(19,"label"),u.Wb(20,"input",9,10),u.ec("ngModelChange",(function(e){return u.xc(n),u.ic(2).terms=e})),u.Vb(),u.Gc(22," I understand that I cannot undo this operation "),u.Vb(),u.Vb(),u.Wb(23,"button",11),u.ec("click",(function(){return u.xc(n),u.ic(2).publish()})),u.Gc(24," Publish "),u.Vb(),u.Vb(),u.Vb()}if(2&e){var i=u.vc(11),r=u.ic(2);u.Cb(15),u.oc("ngModel",r.licence),u.Cb(2),u.oc("ngForOf",r.licences),u.Cb(3),u.oc("ngModel",r.terms),u.Cb(3),u.oc("disabled",!i.form.valid)}}function Nn(e,t){if(1&e&&(u.Wb(0,"div"),u.Wb(1,"h3"),u.Gc(2,"Publish experiment"),u.Vb(),u.Ec(3,Tn,6,1,"div",0),u.Ec(4,Rn,25,4,"div",0),u.Vb()),2&e){var n=u.ic();u.Cb(3),u.oc("ngIf",n.assay.features.isOpenAccess),u.Cb(1),u.oc("ngIf",!n.assay.features.isOpenAccess)}}var Ln,jn=((Ln=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var i;return _classCallCheck(this,n),(i=t.call(this,e)).licences=["CC_BY"],i}return _createClass(n,[{key:"ngOnInit",value:function(){_get(_getPrototypeOf(n.prototype),"ngOnInit",this).call(this),this.licence=this.licences[0]}},{key:"publish",value:function(){var e=this;this.terms&&this.licence&&this.experimentService.publish(this.assay,this.licence).then((function(t){return e.feedback.success('Experiment: "'+t.name+'" published.'),t})).then((function(t){return e.currentExperiment.push(t),t})).then((function(t){e.goToExpHome(t.id)})).catch((function(t){e.feedback.error(t)}))}}]),n}(J.a)).\u0275fac=function(e){return new(e||Ln)(u.Qb(a.a))},Ln.\u0275cmp=u.Kb({type:Ln,selectors:[["bd2-publish-form"]],features:[u.zb],decls:1,vars:1,consts:[[4,"ngIf"],["type","info","role","alert",1,"alert","alert-info"],["type","danger","role","alert",1,"alert","alert-danger"],["publishForm","ngForm"],[1,"form-group"],["for","licence"],["id","licence","required","","placeholder","Select licence","name","licence",1,"form-control",3,"ngModel","ngModelChange"],["licenceF","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","checkbox","required","","id","terms","name","fTerms",3,"ngModel","ngModelChange"],["fTerms","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[3,"value"]],template:function(e,t){1&e&&u.Ec(0,Nn,5,2,"div",0),2&e&&u.oc("ngIf",t.assay)},directives:[i.m,Te.C,Te.q,Te.r,Te.z,Te.y,Te.p,Te.s,i.l,Te.b,Te.a,Te.t,Te.B],encapsulation:2}),Ln);function zn(e,t){1&e&&(u.Wb(0,"div"),u.Wb(1,"h4"),u.Gc(2,"You don't have permission to create experiment"),u.Vb(),u.Wb(3,"p"),u.Gc(4,"Try to login"),u.Vb(),u.Vb())}function Bn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"bd2-general-desc-form",9),u.ec("onAccepted",(function(e){return u.xc(n),u.ic(2).hideEdits(e)}))("onCancelled",(function(e){return u.xc(n),u.ic(2).hideEdits(e)})),u.Vb()}if(2&e){var i=u.ic(2);u.oc("model",i.assay.generalDesc)}}function Hn(e,t){if(1&e&&u.Rb(0,"bd2-general-desc-view",10),2&e){var n=u.ic(2);u.oc("model",n.assay.generalDesc)}}function Xn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"button",11),u.ec("click",(function(){return u.xc(n),u.ic(2).activeGeneralDescForm=!0})),u.Gc(3,"Modify "),u.Vb(),u.Vb()}if(2&e){var i=u.ic(2);u.Cb(2),u.oc("disabled",i.activeGeneralDescForm)}}function Un(e,t){if(1&e){var n=u.Xb();u.Wb(0,"bd2-simple-bio-desc-form",9),u.ec("onAccepted",(function(e){return u.xc(n),u.ic(2).hideEdits(e)}))("onCancelled",(function(e){return u.xc(n),u.ic(2).hideEdits(e)})),u.Vb()}if(2&e){var i=u.ic(2);u.oc("model",i.assay)}}function Kn(e,t){if(1&e&&u.Rb(0,"bd2-simple-bio-desc-view",10),2&e){var n=u.ic(2);u.oc("model",n.assay)}}function Qn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"button",11),u.ec("click",(function(){return u.xc(n),u.ic(2).activeSimpleBioDescForm=!0})),u.Gc(3,"Modify "),u.Vb(),u.Vb()}if(2&e){var i=u.ic(2);u.Cb(2),u.oc("disabled",i.activeSimpleBioDescForm)}}function $n(e,t){if(1&e){var n=u.Xb();u.Wb(0,"bd2-contr-desc-form",9),u.ec("onAccepted",(function(e){return u.xc(n),u.ic(2).hideEdits(e)}))("onCancelled",(function(e){return u.xc(n),u.ic(2).hideEdits(e)})),u.Vb()}if(2&e){var i=u.ic(2);u.oc("model",i.assay.contributionDesc)}}function Jn(e,t){if(1&e&&u.Rb(0,"bd2-contr-desc-view",10),2&e){var n=u.ic(2);u.oc("model",n.assay.contributionDesc)}}function Yn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"button",11),u.ec("click",(function(){return u.xc(n),u.ic(2).activeContributionDescForm=!0})),u.Gc(3,"Modify "),u.Vb(),u.Vb()}if(2&e){var i=u.ic(2);u.Cb(2),u.oc("disabled",i.activeContributionDescForm)}}function Zn(e,t){if(1&e){var n=u.Xb();u.Wb(0,"bd2-measurement-desc-rform",9),u.ec("onAccepted",(function(e){return u.xc(n),u.ic(2).hideEdits(e)}))("onCancelled",(function(e){return u.xc(n),u.ic(2).hideEdits(e)})),u.Vb()}if(2&e){var i=u.ic(2);u.oc("model",i.assay.experimentalDetails.measurementDesc)}}function ei(e,t){if(1&e&&u.Rb(0,"bd2-measurement-desc-view",10),2&e){var n=u.ic(2);u.oc("model",n.assay.experimentalDetails.measurementDesc)}}function ti(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Rb(1,"hr"),u.Wb(2,"button",11),u.ec("click",(function(){return u.xc(n),u.ic(2).activeMeasurementDescForm=!0})),u.Gc(3,"Modify "),u.Vb(),u.Vb()}if(2&e){var i=u.ic(2);u.Cb(2),u.oc("disabled",i.activeMeasurementDescForm)}}function ni(e,t){if(1&e&&(u.Wb(0,"li"),u.Gc(1),u.Vb()),2&e){var n=t.$implicit;u.Cb(1),u.Hc(n)}}function ii(e,t){if(1&e&&(u.Wb(0,"div",12),u.Wb(1,"ul"),u.Ec(2,ni,2,1,"li",13),u.Vb(),u.Vb()),2&e){var n=u.ic(2);u.Cb(2),u.oc("ngForOf",n.errors)}}function ri(e,t){if(1&e){var n=u.Xb();u.Wb(0,"div"),u.Wb(1,"h3"),u.Gc(2,"Create experiment"),u.Vb(),u.Wb(3,"div",1),u.Wb(4,"div",2),u.Gc(5,"General description"),u.Vb(),u.Wb(6,"div",3),u.Ec(7,Bn,1,1,"bd2-general-desc-form",4),u.Ec(8,Hn,1,1,"bd2-general-desc-view",5),u.Ec(9,Xn,4,1,"div",0),u.Vb(),u.Vb(),u.Wb(10,"div",1),u.Wb(11,"div",2),u.Gc(12,"Biological details"),u.Vb(),u.Wb(13,"div",3),u.Ec(14,Un,1,1,"bd2-simple-bio-desc-form",4),u.Ec(15,Kn,1,1,"bd2-simple-bio-desc-view",5),u.Ec(16,Qn,4,1,"div",0),u.Vb(),u.Vb(),u.Wb(17,"div",1),u.Wb(18,"div",2),u.Gc(19,"Contributions"),u.Vb(),u.Wb(20,"div",3),u.Ec(21,$n,1,1,"bd2-contr-desc-form",4),u.Ec(22,Jn,1,1,"bd2-contr-desc-view",5),u.Ec(23,Yn,4,1,"div",0),u.Vb(),u.Vb(),u.Wb(24,"div",1),u.Wb(25,"div",2),u.Gc(26,"Measurement details"),u.Vb(),u.Wb(27,"div",3),u.Ec(28,Zn,1,1,"bd2-measurement-desc-rform",4),u.Ec(29,ei,1,1,"bd2-measurement-desc-view",5),u.Ec(30,ti,4,1,"div",0),u.Vb(),u.Vb(),u.Ec(31,ii,3,1,"div",6),u.Wb(32,"button",7),u.ec("click",(function(){return u.xc(n),u.ic().save()})),u.Gc(33,"Create"),u.Vb(),u.Wb(34,"button",8),u.ec("click",(function(){return u.xc(n),u.ic().cancel()})),u.Gc(35,"Cancel"),u.Vb(),u.Vb()}if(2&e){var i=u.ic();u.Cb(7),u.oc("ngIf",i.activeGeneralDescForm),u.Cb(1),u.oc("ngIf",!i.activeGeneralDescForm),u.Cb(1),u.oc("ngIf",!i.activeGeneralDescForm),u.Cb(5),u.oc("ngIf",i.activeSimpleBioDescForm),u.Cb(1),u.oc("ngIf",!i.activeSimpleBioDescForm),u.Cb(1),u.oc("ngIf",!i.activeSimpleBioDescForm),u.Cb(5),u.oc("ngIf",i.activeContributionDescForm),u.Cb(1),u.oc("ngIf",!i.activeContributionDescForm),u.Cb(1),u.oc("ngIf",!i.activeContributionDescForm),u.Cb(5),u.oc("ngIf",i.activeMeasurementDescForm),u.Cb(1),u.oc("ngIf",!i.activeMeasurementDescForm),u.Cb(1),u.oc("ngIf",!i.activeMeasurementDescForm),u.Cb(1),u.oc("ngIf",i.errors),u.Cb(1),u.oc("disabled",i.blocked||i.errors)}}var ci,oi,si,ai,ui,li=[{path:"new",pathMatch:"full",component:(ci=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,r,c){var o;return _classCallCheck(this,n),(o=t.call(this,De.INSTANCE)).experimentService=e,o.RDMSocial=i,o.feedback=r,o.router=c,o.isUnauthorised=!1,o.blocked=!1,o.activeGeneralDescForm=!0,o.activeContributionDescForm=!1,o.activeSimpleBioDescForm=!0,o.activeMeasurementDescForm=!1,o}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.experimentService.newDraft().then((function(t){e.assay=t})).catch((function(t){e.isUnauthorised=t.isUnauthorised,e.feedback.error(t)}))}},{key:"hideEdits",value:function(e){this.activeGeneralDescForm=!this.assay.generalDesc.name,this.activeSimpleBioDescForm=!this.assay.species||!this.assay.dataCategory,this.activeContributionDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}},{key:"cancel",value:function(){this.clearErrors(),this.router.navigate(["/experiments"])}},{key:"save",value:function(){var e=this;this.assay&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.newExperiment(this.assay).then((function(t){return e.feedback.success('Experiment: "'+t.name+'" created.'),t})).then((function(t){return e.router.navigate(["/experiment",t.id])})).catch((function(t){e.blocked=!1,e.feedback.error(t)})))}},{key:"getModel",value:function(){return this.assay}}]),n}(Ge.a),ci.\u0275fac=function(e){return new(e||ci)(u.Qb(l.a),u.Qb(b.a),u.Qb(d.a),u.Qb(r.c))},ci.\u0275cmp=u.Kb({type:ci,selectors:[["ng-component"]],features:[u.zb],decls:2,vars:2,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],["okLabel","Accept",3,"model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["okLabel","Accept",3,"model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(u.Ec(0,zn,5,0,"div",0),u.Ec(1,ri,36,14,"div",0)),2&e&&(u.oc("ngIf",t.isUnauthorised),u.Cb(1),u.oc("ngIf",t.assay))},directives:[i.m,ze,ie,qt,pe,ht,fe,Ut,We,i.l],encapsulation:2}),ci)},{path:":id",component:$,children:[{path:"",pathMatch:"full",component:xe},{path:"edit",component:hn},{path:"file",component:qn},{path:"publish",component:jn},{path:"data",loadChildren:function(){return Promise.all([n.e(2),n.e(3),n.e(4),n.e(13)]).then(n.bind(null,"d9Wp")).then((function(e){return e.TsDataModule}))}},{path:"ppa",loadChildren:function(){return Promise.all([n.e(2),n.e(3),n.e(4),n.e(0),n.e(12)]).then(n.bind(null,"eJgY")).then((function(e){return e.PPAModule}))}},{path:"rhythmicity",loadChildren:function(){return Promise.all([n.e(2),n.e(3),n.e(4),n.e(0),n.e(16)]).then(n.bind(null,"ja10")).then((function(e){return e.RhythmicityModule}))}}]}],bi=((oi=function e(){_classCallCheck(this,e)}).\u0275mod=u.Ob({type:oi}),oi.\u0275inj=u.Nb({factory:function(e){return new(e||oi)},imports:[[r.f.forChild(li)],r.f]}),oi),di=n("DkMi"),fi=n("YiFe"),hi=((ui=function e(){_classCallCheck(this,e)}).\u0275mod=u.Ob({type:ui}),ui.\u0275inj=u.Nb({factory:function(e){return new(e||ui)},providers:[],imports:[[i.c,fi.a]]}),ui),mi=((ai=function e(){_classCallCheck(this,e)}).\u0275mod=u.Ob({type:ai}),ai.\u0275inj=u.Nb({factory:function(e){return new(e||ai)},providers:[],imports:[[i.c,Te.j]]}),ai),pi=((si=function e(){_classCallCheck(this,e)}).\u0275mod=u.Ob({type:si}),si.\u0275inj=u.Nb({factory:function(e){return new(e||si)},imports:[[i.c,di.a,hi,mi,bi]]}),si)},mbIT:function(e,t,n){"use strict";t.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length}},n3uD:function(e,t,n){"use strict";var i=!1;t.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else i&&console.log("RxJS: Back to a better error behavior. Thank you. <3");i=e},get useDeprecatedSynchronousErrorHandling(){return i}}},nzqU:function(e,t,n){"use strict";t.isScheduler=function(e){return e&&"function"==typeof e.schedule}},"p//D":function(e,t,n){"use strict";t.rxSubscriber="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),t.$$rxSubscriber=t.rxSubscriber},pshJ:function(e,t,n){"use strict";t.isFunction=function(e){return"function"==typeof e}},"qnP+":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("2Vo4"),r=n("fXoL"),c=1,o=function(){var e=function(){function e(){_classCallCheck(this,e),this.experimentStream=new i.a(null),this.id=c++}return _createClass(e,[{key:"close",value:function(){this.experimentStream.complete()}},{key:"experiment",value:function(){return this.experimentStream}},{key:"push",value:function(e){this.experimentStream.next(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Mb({token:e,factory:e.\u0275fac}),e}()},vLYz:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n("fXoL"),r=n("BOp5"),c=n("ofXK"),o=["inputFieldM"];function s(e,t){if(1&e){var n=i.Xb();i.Wb(0,"div",11),i.Gc(1),i.Wb(2,"button",12),i.ec("click",(function(){i.xc(n);var e=t.$implicit;return i.ic(2).remove(e)})),i.Wb(3,"span",13),i.Gc(4,"\xd7"),i.Vb(),i.Vb(),i.Vb()}if(2&e){var r=t.$implicit;i.Cb(1),i.Ic(" ",r.name," ")}}function a(e,t){if(1&e&&(i.Wb(0,"div",8),i.Wb(1,"div",9),i.Wb(2,"label"),i.Gc(3,"Files:"),i.Vb(),i.Vb(),i.Ec(4,s,5,1,"div",10),i.Vb()),2&e){var n=i.ic();i.Cb(4),i.oc("ngForOf",n.files)}}function u(e,t){if(1&e){var n=i.Xb();i.Wb(0,"input",14,15),i.ec("change",(function(e){return i.xc(n),i.ic().handleFileSelect(e)})),i.Vb()}}function l(e,t){if(1&e){var n=i.Xb();i.Wb(0,"input",16,15),i.ec("change",(function(e){return i.xc(n),i.ic().handleFileSelect(e)})),i.Vb()}}function b(e,t){if(1&e&&(i.Wb(0,"div",17),i.Gc(1),i.Vb()),2&e){var n=i.ic();i.Cb(1),i.Ic(" Maximum upload size is ",n.sizeLimit,"MB ")}}var d=function(){var e=function(){function e(){_classCallCheck(this,e),this.activeColor="green",this.baseColor="#ccc",this.overlayColor="rgba(255,255,255,0.5)",this.blocked=!1,this.multiple=!0,this.noDuplicates=!0,this.autoReset=!1,this.sizeLimit=50,this.uploadFiles=new i.o,this.selectedFiles=new i.o,this.dragging=!1,this.loaded=!1,this.sizeError=!1,this.files=[]}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"reset",value:function(){this.files=[],this.inputField&&this.inputField.nativeElement&&(this.inputField.nativeElement.value="")}},{key:"handleDragEnter",value:function(){this.dragging=!0}},{key:"handleDragLeave",value:function(){this.dragging=!1}},{key:"handleDrop",value:function(e){e.preventDefault(),this.dragging=!1,e.dataTransfer&&this.handleFileChange(e.dataTransfer.files)}},{key:"handleFileSelect",value:function(e){e.target&&this.handleFileChange(e.target.files)}},{key:"handleFileChange",value:function(e){var t=this.multiple?e.length:Math.min(1,e.length);this.multiple||(this.files=[]);for(var n=0;n<t;n++){var i=e[n];this.noDuplicates&&this.removeDuplicate(i),this.files.push(i)}this.checkSize(),this.selectedFiles.next(this.files)}},{key:"remove",value:function(e){Object(r.b)(e,this.files),this.checkSize()}},{key:"removeDuplicate",value:function(e){var t=this.files.find((function(t){return t.name===e.name}));this.remove(t)}},{key:"checkSize",value:function(){var e=0;this.files.map((function(e){return e.size})).forEach((function(t){return e+=t})),e/=1048576,this.sizeError=e>this.sizeLimit}},{key:"upload",value:function(){this.uploadFiles.next(this.files),this.autoReset&&this.reset()}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Kb({type:e,selectors:[["bd2-file-upload-widget"]],viewQuery:function(e,t){var n;1&e&&i.Mc(o,!0),2&e&&i.uc(n=i.fc())&&(t.inputField=n.first)},inputs:{activeColor:"activeColor",baseColor:"baseColor",overlayColor:"overlayColor",blocked:"blocked",multiple:"multiple",noDuplicates:"noDuplicates",autoReset:"autoReset",sizeLimit:"sizeLimit"},outputs:{uploadFiles:"uploadFiles",selectedFiles:"selectedFiles"},decls:13,vars:9,consts:[["class","clearfix","style","margin-bottom: 1em;",4,"ngIf"],[2,"margin-bottom","1em"],["ondragover","return false;",1,"uploader-zone",3,"dragenter","dragleave","drop"],[1,"material-icons","bd-icon","bd-primary",2,"font-size","400%"],["multiple","","name","inputField","type","file",3,"change",4,"ngIf"],["name","inputField","type","file",3,"change",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"clearfix",2,"margin-bottom","1em"],[1,""],["class","float-left fileitem",4,"ngFor","ngForOf"],[1,"float-left","fileitem"],["aria-label","Close","type","button",1,"close",2,"margin-left","0.5em",3,"click"],["aria-hidden","true"],["multiple","","name","inputField","type","file",3,"change"],["inputField",""],["name","inputField","type","file",3,"change"],[1,"alert","alert-danger"]],template:function(e,t){1&e&&(i.Wb(0,"div"),i.Ec(1,a,5,1,"div",0),i.Wb(2,"div",1),i.Wb(3,"label",2),i.ec("dragenter",(function(){return t.handleDragEnter()}))("dragleave",(function(){return t.handleDragLeave()}))("drop",(function(e){return t.handleDrop(e)})),i.Wb(4,"i",3),i.Gc(5,"cloud_upload"),i.Vb(),i.Wb(6,"p"),i.Gc(7," Drag file(s) or click to select"),i.Vb(),i.Ec(8,u,2,0,"input",4),i.Ec(9,l,2,0,"input",5),i.Vb(),i.Vb(),i.Ec(10,b,2,1,"div",6),i.Wb(11,"button",7),i.ec("click",(function(){return t.upload()})),i.Gc(12,"Upload selected "),i.Vb(),i.Vb()),2&e&&(i.Cb(1),i.oc("ngIf",t.files.length>0),i.Cb(2),i.Dc("outline-color",t.dragging?t.activeColor:t.baseColor),i.Gb("loaded",t.loaded),i.Cb(5),i.oc("ngIf",t.multiple),i.Cb(1),i.oc("ngIf",!t.multiple),i.Cb(1),i.oc("ngIf",t.sizeError),i.Cb(1),i.oc("disabled",t.blocked||t.files.length<1||t.sizeError))},directives:[c.m,c.l],styles:[".uploader-zone[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.uploader-zone[_ngcontent-%COMP%]{font-weight:400;align-items:center;background-color:#efefef;background-color:rgba(0,0,0,.02);cursor:pointer;display:flex;height:100px;justify-content:center;outline:3px dashed #ccc}div.fileitem[_ngcontent-%COMP%]{margin:2px;padding:2px;border:1px solid #efefef;border-radius:4px}"]}),e}()},vejM:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("fXoL"),r=n("UsWK"),c=function(){var e=function(){function e(t){_classCallCheck(this,e),this.BD2REST=t,this.visited=new Set,console.log("RDMSocialServiceService created")}return _createClass(e,[{key:"getAssayGuiAspects",value:function(e){var t=this;return this.BD2REST.rdmAssayGuiAspects(e.id).then((function(n){return t.visited.add(e.id),n}))}},{key:"shouldShowMeasurementWarning",value:function(e){return e.security.isOwner?this.visited.has(e.id)?Promise.resolve(!1):this.getAssayGuiAspects(e).then((function(e){return e.showMeasurementWarning})):Promise.resolve(!1)}},{key:"registerNewAssay",value:function(e){this.visited.add(e.id)}},{key:"registerMeasurementWarning",value:function(e){this.BD2REST.rdmRegisterWarning(e.id,"MEASUREMENT").then((function(e){return!0}))}},{key:"canProceedByMeasurement",value:function(e){return e.security.isOwner?this.getAssayGuiAspects(e).then((function(e){return e.canProceedByMeasurement})):Promise.resolve(!0)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.ac(r.a))},e.\u0275prov=i.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},yYXI:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("TPWj"),r=n("pLZG"),c=n("fXoL"),o=n("GVyA"),s=function(){var e=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var i;return _classCallCheck(this,n),(i=t.call(this)).serviceDependencies=e,i.experimentService=e.experimentService,i.currentExperiment=e.currentExperiment,i.feedback=e.feedback,i.router=e.router,i.titleSetter=e.titleSetter,i.titlePart="",i}return _createClass(n,[{key:"ngOnInit",value:function(){this.subscribeToExperiment()}},{key:"ngOnDestroy",value:function(){this.unsubscribeFromExperiment()}},{key:"getModel",value:function(){return this.assay}},{key:"updateModel",value:function(e){this.assay=e,this.setTitle()}},{key:"setTitle",value:function(){this.titleSetter.setTitle("Exp "+this.assay.id+this.titlePart)}},{key:"subscribeToExperiment",value:function(){var e=this;this.expSubscription=this.currentExperiment.experiment().pipe(Object(r.a)((function(e){return!!e}))).subscribe((function(t){e.updateModel(t)}),(function(t){return e.feedback.error(t)}),(function(){return console.log(e.constructor.name+" expSubscription completed")}))}},{key:"refreshModel",value:function(){var e=this;return this.experimentService.getExperiment(this.assay.id).then((function(t){return e.currentExperiment.push(t),t}))}},{key:"unsubscribeFromExperiment",value:function(){this.expSubscription&&this.expSubscription.unsubscribe()}},{key:"expHomePath",value:function(e){return["/experiment",e=e||this.assay.id]}},{key:"goToExpHome",value:function(e){this.router.navigate(this.expHomePath(e))}},{key:"goToExpEdit",value:function(e,t){var n=this.expHomePath(e);n.push("edit"),t?this.router.navigate(n,{fragment:t}):this.router.navigate(n)}}]),n}(i.a);return e.\u0275fac=function(t){return new(t||e)(c.Qb(o.a))},e.\u0275dir=c.Lb({type:e,features:[c.zb]}),e}()},yoF8:function(e,t,n){"use strict";t.identity=function(e){return e}},yx2s:function(e,t,n){"use strict";var i=n("FWf1");t.canReportError=function(e){for(;e;){var t=e.destination;if(e.closed||e.isStopped)return!1;e=t&&t instanceof i.Subscriber?t:null}return!0}},"zB/H":function(e,t,n){"use strict";var i=n("mbIT"),r=n("GMZp"),c=n("pshJ"),o=n("LBXl");function s(e){return e.reduce((function(e,t){return e.concat(t instanceof o.UnsubscriptionError?t.errors:t)}),[])}t.Subscription=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this._parentOrParents,a=this._unsubscribe,u=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var l=0;l<n.length;++l)n[l].remove(this);if(c.isFunction(a))try{a.call(this)}catch(f){t=f instanceof o.UnsubscriptionError?s(f.errors):[f]}if(i.isArray(u)){l=-1;for(var b=u.length;++l<b;){var d=u[l];if(r.isObject(d))try{d.unsubscribe()}catch(f){t=t||[],f instanceof o.UnsubscriptionError?t=t.concat(s(f.errors)):t.push(f)}}}if(t)throw new o.UnsubscriptionError(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var i=n;(n=new e)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var r=n._parentOrParents;if(null===r)n._parentOrParents=this;else if(r instanceof e){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}var c=this._subscriptions;return null===c?this._subscriptions=[n]:c.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=((t=new e).closed=!0,t),e}()},zfKp:function(e,t,n){"use strict";t.observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},zzsZ:function(e,t,n){"use strict";var i=n("Q1FS"),r=n("OAkW"),c=n("2qMH");t.fromArray=function(e,t){return t?c.scheduleArray(e,t):new i.Observable(r.subscribeToArray(e))}}}]);