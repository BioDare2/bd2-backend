(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"9+85":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("0IaG"),c=i("fXoL"),s=i("ofXK");function o(e,t){if(1&e&&c.Ob(0,"div",5),2&e){const e=c.dc();c.jc("innerHTML",e.question.details,c.tc)}}class r{constructor(e,t,i="Cancel",n="OK"){this.question=e,this.details=t,this.cancelLabel=i,this.okLabel=n}}let a=(()=>{class e{constructor(e){this.question=e||new r("Missing question")}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(c.Nb(n.a))},e.\u0275cmp=c.Hb({type:e,selectors:[["ng-component"]],decls:10,vars:5,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-content","",1,"modal-body"],[3,"innerHTML",4,"ngIf"],["mat-dialog-close","",1,"btn","btn-primary","btn-sm","mr-2"],[1,"btn","btn-primary","btn-sm",3,"mat-dialog-close"],[3,"innerHTML"]],template:function(e,t){1&e&&(c.Tb(0,"h4",0),c.Dc(1),c.Sb(),c.Tb(2,"div",1),c.Bc(3,o,1,1,"div",2),c.Sb(),c.Ob(4,"hr"),c.Tb(5,"div"),c.Tb(6,"button",3),c.Dc(7),c.Sb(),c.Tb(8,"button",4),c.Dc(9),c.Sb(),c.Sb()),2&e&&(c.Bb(1),c.Fc("",t.question.question," "),c.Bb(2),c.jc("ngIf",t.question.details),c.Bb(4),c.Ec(t.question.cancelLabel),c.Bb(1),c.jc("mat-dialog-close",!0),c.Bb(1),c.Ec(t.question.okLabel))},directives:[n.h,n.e,s.m,n.d],encapsulation:2}),e})(),l=(()=>{class e{constructor(e){this.dialogs=e}confirm(e,t,i="Cancel",n="OK"){const c=new r(e,t,i,n);return this.dialogs.open(a,{data:c,autoFocus:!1}).afterClosed()}}return e.\u0275fac=function(t){return new(t||e)(c.Xb(n.b))},e.\u0275prov=c.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},GVyA:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("fXoL"),c=i("RtrU"),s=i("qnP+"),o=i("6tuW"),r=i("BMm9"),a=i("tyNb");let l=(()=>{class e{constructor(e,t,i,n,c){this.experimentService=e,this.currentExperiment=t,this.feedback=i,this.titleSetter=n,this.router=c}}return e.\u0275fac=function(t){return new(t||e)(n.Xb(c.a),n.Xb(s.a),n.Xb(o.a),n.Xb(r.a),n.Xb(a.c))},e.\u0275prov=n.Jb({token:e,factory:e.\u0275fac}),e})()},TPWj:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));class n{constructor(e){this.validator=e,this.errors=void 0}triggerValidation(){const e=this.validate(this.getModel());return e?(this.showErrors(e),!1):(this.clearErrors(),!0)}clearErrors(){this.errors=void 0}showErrors(e){this.errors=e}validate(e){if(this.validator){const t=this.validator.validate(e);return 0===t.length?null:t}return null}}},YiFe:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("ofXK"),c=i("3Pt+"),s=i("fXoL");let o=(()=>{class e{}return e.\u0275mod=s.Lb({type:e}),e.\u0275inj=s.Kb({factory:function(t){return new(t||e)},providers:[],imports:[[n.c,c.k]]}),e})()},eLum:function(e,t,i){"use strict";i.r(t),i.d(t,"ExperimentModule",(function(){return _i}));var n=i("ofXK"),c=i("tyNb"),s=i("pLZG"),o=i("lJxs"),r=i("qnP+"),a=i("GVyA"),l=i("fXoL"),d=i("RtrU"),b=i("vejM"),u=i("6tuW"),m=i("ZMwR"),h=i("9+85");function f(e,t){if(1&e&&(l.Tb(0,"div",2),l.Tb(1,"strong"),l.Dc(2,"Open Access: "),l.Sb(),l.Dc(3," under "),l.Tb(4,"strong"),l.Dc(5),l.Sb(),l.Dc(6," license "),l.Sb()),2&e){const e=l.dc(2);l.Bb(5),l.Ec(e.model.features.licence)}}function p(e,t){if(1&e&&(l.Tb(0,"span"),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.Bb(1),l.Fc("",e.name,", ")}}function g(e,t){if(1&e&&(l.Tb(0,"div",2),l.Tb(1,"strong"),l.Dc(2,"Authors: "),l.Sb(),l.Bc(3,p,2,1,"span",5),l.Sb()),2&e){const e=l.dc(2);l.Bb(3),l.jc("ngForOf",e.model.contributionDesc.authors)}}function v(e,t){if(1&e&&(l.Tb(0,"div",1),l.Tb(1,"div",2),l.Tb(2,"strong"),l.Dc(3,"Purpose: "),l.Sb(),l.Dc(4),l.Sb(),l.Bc(5,f,7,1,"div",3),l.Bc(6,g,4,1,"div",3),l.Tb(7,"div",4),l.Tb(8,"strong"),l.Dc(9,"Data category: "),l.Sb(),l.Dc(10),l.Sb(),l.Sb()),2&e){const e=l.dc();l.Bb(4),l.Fc(" ",e.model.generalDesc.purpose," "),l.Bb(1),l.jc("ngIf",e.model.features.isOpenAccess),l.Bb(1),l.jc("ngIf",e.model.contributionDesc.authors),l.Bb(4),l.Fc(" ",null==e.model.dataCategory?null:e.model.dataCategory.longName," ")}}let S=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-experiment-basic-info-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[["class","summary-box",4,"ngIf"],[1,"summary-box"],[1,"item"],["class","item",4,"ngIf"],[1,"item","item-last"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&l.Bc(0,v,11,4,"div",0),2&e&&l.jc("ngIf",t.model)},directives:[n.m,n.l],encapsulation:2}),e})();const T=function(){return["edit"]},D=function(){return{exact:!0}};function B(e,t){1&e&&(l.Tb(0,"a",6),l.Dc(1,"Edit"),l.Sb()),2&e&&l.jc("routerLink",l.lc(2,T))("routerLinkActiveOptions",l.lc(3,D))}const y=function(){return[".","data","view","ts"]};function w(e,t){1&e&&(l.Tb(0,"a",6),l.Dc(1,"Show data"),l.Sb()),2&e&&l.jc("routerLink",l.lc(2,y))("routerLinkActiveOptions",l.lc(3,D))}const k=function(){return[".","data","view","heatmap"]};function j(e,t){1&e&&(l.Tb(0,"a",6),l.Dc(1,"Heatmap"),l.Sb()),2&e&&l.jc("routerLink",l.lc(2,k))("routerLinkActiveOptions",l.lc(3,D))}const F=function(){return["ppa/new"]};function I(e,t){1&e&&(l.Tb(0,"a",6),l.Dc(1,"Period analysis"),l.Sb()),2&e&&l.jc("routerLink",l.lc(2,F))("routerLinkActiveOptions",l.lc(3,D))}const x=function(){return["ppa"]},M=function(){return{exact:!1}};function O(e,t){1&e&&(l.Tb(0,"a",6),l.Dc(1,"Period analysis"),l.Sb()),2&e&&l.jc("routerLink",l.lc(2,x))("routerLinkActiveOptions",l.lc(3,M))}const C=function(){return["rhythmicity"]};function E(e,t){1&e&&(l.Tb(0,"a",6),l.Dc(1,"Rhythmicity"),l.Sb()),2&e&&l.jc("routerLink",l.lc(2,C))("routerLinkActiveOptions",l.lc(3,M))}const A=function(){return[".","data","ts-import"]};function q(e,t){if(1&e&&(l.Tb(0,"a",6),l.Dc(1),l.Sb()),2&e){const e=l.dc(2);l.jc("routerLink",l.lc(3,A))("routerLinkActiveOptions",l.lc(4,D)),l.Bb(1),l.Fc(" ",e.experiment.features.hasTSData?"Replace data":"Import data","")}}const N=function(){return["publish"]};function L(e,t){1&e&&(l.Tb(0,"a",6),l.Tb(1,"i",8),l.Dc(2,"lock_open"),l.Sb(),l.Sb()),2&e&&l.jc("routerLink",l.lc(2,N))("routerLinkActiveOptions",l.lc(3,D))}const P=function(){return["/experiments"]},U=function(){return["."]},Z=function(){return["file"]};function R(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div",1),l.Tb(1,"nav",2),l.Tb(2,"a",3),l.Tb(3,"i",4),l.Dc(4,"fast_rewind"),l.Sb(),l.Sb(),l.Tb(5,"a",5),l.Zb("click",(function(){return l.sc(e),l.dc().back()})),l.Tb(6,"i",4),l.Dc(7,"arrow_left"),l.Sb(),l.Sb(),l.Tb(8,"a",5),l.Zb("click",(function(){return l.sc(e),l.dc().refresh()})),l.Tb(9,"i",4),l.Dc(10,"refresh"),l.Sb(),l.Sb(),l.Tb(11,"a",6),l.Dc(12,"Overview"),l.Sb(),l.Bc(13,B,2,4,"a",7),l.Bc(14,w,2,4,"a",7),l.Bc(15,j,2,4,"a",7),l.Bc(16,I,2,4,"a",7),l.Bc(17,O,2,4,"a",7),l.Bc(18,E,2,4,"a",7),l.Bc(19,q,2,5,"a",7),l.Tb(20,"a",6),l.Dc(21,"Files"),l.Sb(),l.Bc(22,L,3,4,"a",7),l.Sb(),l.Sb()}if(2&e){const e=l.dc();l.Bb(2),l.jc("routerLink",l.lc(13,P)),l.Bb(9),l.jc("routerLink",l.lc(14,U))("routerLinkActiveOptions",l.lc(15,D)),l.Bb(2),l.jc("ngIf",e.experiment.security.canWrite),l.Bb(1),l.jc("ngIf",e.experiment.features.hasTSData),l.Bb(1),l.jc("ngIf",e.experiment.features.hasTSData),l.Bb(1),l.jc("ngIf",e.experiment.security.canWrite&&e.experiment.features.hasTSData&&!e.experiment.features.hasPPAJobs),l.Bb(1),l.jc("ngIf",e.experiment.features.hasPPAJobs),l.Bb(1),l.jc("ngIf",e.experiment.security.canWrite&&e.experiment.features.hasTSData||e.experiment.features.hasRhythmicityJobs),l.Bb(1),l.jc("ngIf",e.experiment.security.canWrite),l.Bb(1),l.jc("routerLink",l.lc(16,Z))("routerLinkActiveOptions",l.lc(17,D)),l.Bb(2),l.jc("ngIf",e.experiment.security.isOwner||e.experiment.security.isSuperOwner)}}let W=(()=>{class e{constructor(){this.onRefresh=new l.o}refresh(){this.onRefresh.emit(!0)}back(){window.history.back()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-experiment-navigation"]],inputs:{experiment:"experiment"},outputs:{onRefresh:"onRefresh"},features:[l.Ab([])],decls:1,vars:1,consts:[["style","margin-bottom: 2em;",4,"ngIf"],[2,"margin-bottom","2em"],[1,"secondary"],[3,"routerLink"],[1,"material-icons","bd-icon"],["role","button",1,"shade",3,"click"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions",4,"ngIf"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(e,t){1&e&&l.Bc(0,R,23,18,"div",0),2&e&&l.jc("ngIf",t.experiment)},directives:[n.m,c.e,c.d],encapsulation:2}),e})();function _(e,t){1&e&&(l.Tb(0,"i",7),l.Dc(1,"lock_open"),l.Sb())}function G(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Tb(1,"div",1),l.Tb(2,"div",2),l.Tb(3,"h3"),l.Bc(4,_,2,0,"i",3),l.Dc(5),l.Ob(6,"br"),l.Tb(7,"small"),l.Dc(8),l.Sb(),l.Sb(),l.Sb(),l.Tb(9,"div",4),l.Ob(10,"bd2-experiment-basic-info-view",5),l.Sb(),l.Sb(),l.Tb(11,"bd2-experiment-navigation",6),l.Zb("onRefresh",(function(){return l.sc(e),l.dc().refresh()})),l.Sb(),l.Sb()}if(2&e){const e=l.dc();l.Bb(4),l.jc("ngIf",e.model.features.isOpenAccess),l.Bb(1),l.Fc(" Experiment: ",e.model.id,""),l.Bb(3),l.Ec(e.model.name),l.Bb(2),l.jc("model",e.model),l.Bb(1),l.jc("experiment",e.model)}}function z(e,t){1&e&&(l.Tb(0,"div"),l.Dc(1," ... loading experiment "),l.Tb(2,"p"),l.Dc(3,"If just logged in try to refresh the window if the experiment is not loading."),l.Sb(),l.Sb())}function V(e,t){1&e&&(l.Tb(0,"div"),l.Tb(1,"h4"),l.Dc(2,"You don't have sufficient permissions to see the experiment"),l.Sb(),l.Tb(3,"p"),l.Dc(4,"Try to login"),l.Sb(),l.Sb())}let H=(()=>{class e{constructor(e,t,i,n,c,s,o,r){this.experimentService=e,this.RDMSocial=t,this.currentExperiment=i,this.feedback=n,this.analytics=c,this.route=s,this.router=o,this.dialogs=r,this.isUnauthorised=!1}ngOnInit(){this.expSubscription=this.currentExperiment.experiment().pipe(Object(s.a)(e=>!!e)).subscribe(e=>{this.model=e,this.analytics.experimentView(e.id),this.RDMSocial.shouldShowMeasurementWarning(e).then(e=>{e&&this.showMetadataWarning()})},e=>this.feedback.error(e),()=>console.log("currentExperimentStream completed")),this.paramsSubscription=this.route.paramMap.pipe(Object(o.a)(e=>e.get("id")),Object(s.a)(e=>!!e)).subscribe(e=>this.loadExperiment(+e))}ngOnDestroy(){this.paramsSubscription&&this.paramsSubscription.unsubscribe(),this.expSubscription&&this.expSubscription.unsubscribe(),this.currentExperiment&&this.currentExperiment.close()}refresh(){this.model&&this.loadExperiment(this.model.id)}loadExperiment(e){this.experimentService.getExperiment(e).then(e=>{this.currentExperiment.push(e),this.isUnauthorised=!1}).catch(e=>{this.isUnauthorised=e.isUnauthorised,this.feedback.error(e)})}handleWarningResponse(e){console.log("Dialog: "+e)}showMetadataWarning(){this.dialogs.confirm("Metadata reminder","\n        <p>\n        Please add measurements details, like technique, equipment and short description.\n        </p>\n        <p>\n        It will improve the metadata quality and it will help you when searching for the data.\n        </p>\n","Not now").subscribe(e=>{this.RDMSocial.registerMeasurementWarning(this.model),e&&this.router.navigate(["edit"],{relativeTo:this.route,fragment:"MeasurementSection"})})}}return e.\u0275fac=function(t){return new(t||e)(l.Nb(d.a),l.Nb(b.a),l.Nb(r.a),l.Nb(u.a),l.Nb(m.a),l.Nb(c.a),l.Nb(c.c),l.Nb(h.a))},e.\u0275cmp=l.Hb({type:e,selectors:[["ng-component"]],features:[l.Ab([r.a,a.a])],decls:5,vars:3,consts:[[4,"ngIf"],[1,"card","asset-card"],[1,"card-header"],["class","material-icons bd-icon","style","color: green; font-size: 1.5em;",4,"ngIf"],[1,"card-body"],[3,"model"],[3,"experiment","onRefresh"],[1,"material-icons","bd-icon",2,"color","green","font-size","1.5em"]],template:function(e,t){1&e&&(l.Tb(0,"div"),l.Bc(1,G,12,5,"div",0),l.Bc(2,z,4,0,"div",0),l.Bc(3,V,5,0,"div",0),l.Ob(4,"router-outlet"),l.Sb()),2&e&&(l.Bb(1),l.jc("ngIf",t.model),l.Bb(1),l.jc("ngIf",!t.model&&!t.isUnauthorised),l.Bb(1),l.jc("ngIf",!t.model&&t.isUnauthorised))},directives:[n.m,c.g,S,W],encapsulation:2}),e})();var $=i("yYXI");function X(e,t){if(1&e&&(l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"strong"),l.Dc(3,"Description"),l.Sb(),l.Tb(4,"div"),l.Dc(5),l.Sb(),l.Sb()),2&e){const e=l.dc(2);l.Bb(5),l.Ec(e.model.description)}}function J(e,t){if(1&e&&(l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"strong"),l.Dc(3,"Comments"),l.Sb(),l.Tb(4,"div"),l.Dc(5),l.Sb(),l.Sb()),2&e){const e=l.dc(2);l.Bb(5),l.Ec(e.model.comments)}}function K(e,t){if(1&e&&(l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"strong"),l.Dc(3,"Execution date"),l.Sb(),l.Tb(4,"div"),l.Dc(5),l.ec(6,"date"),l.Sb(),l.Sb()),2&e){const e=l.dc(2);l.Bb(5),l.Ec(l.fc(6,1,e.model.executionDate.date))}}function Y(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"h4"),l.Dc(2),l.Sb(),l.Tb(3,"div"),l.Ob(4,"hr"),l.Tb(5,"strong"),l.Dc(6,"Purpose/Hypothesis"),l.Sb(),l.Tb(7,"div"),l.Dc(8),l.Sb(),l.Sb(),l.Bc(9,X,6,1,"div",0),l.Bc(10,J,6,1,"div",0),l.Bc(11,K,7,3,"div",0),l.Sb()),2&e){const e=l.dc();l.Bb(2),l.Ec(e.model.name),l.Bb(6),l.Ec(e.model.purpose),l.Bb(1),l.jc("ngIf",e.model.description),l.Bb(1),l.jc("ngIf",e.model.comments),l.Bb(1),l.jc("ngIf",e.model.executionDate)}}let Q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-general-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&l.Bc(0,Y,12,5,"div",0),2&e&&l.jc("ngIf",t.model)},directives:[n.m],pipes:[n.e],encapsulation:2}),e})();function ee(e,t){if(1&e&&(l.Tb(0,"span"),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.Bb(1),l.Fc("",e.name,", ")}}function te(e,t){if(1&e&&(l.Tb(0,"h4"),l.Bc(1,ee,2,1,"span",1),l.Sb()),2&e){const e=l.dc(2);l.Bb(1),l.jc("ngForOf",e.model.authors)}}function ie(e,t){if(1&e&&(l.Tb(0,"span"),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.Bb(1),l.Fc("",e.name,", ")}}function ne(e,t){if(1&e&&(l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"strong"),l.Dc(3,"Data curators: "),l.Sb(),l.Bc(4,ie,2,1,"span",1),l.Sb()),2&e){const e=l.dc(2);l.Bb(4),l.jc("ngForOf",e.model.curators)}}function ce(e,t){if(1&e&&(l.Tb(0,"span"),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.Bb(1),l.Fc("",e.name,", ")}}function se(e,t){if(1&e&&(l.Tb(0,"span"),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.Bb(1),l.Fc("",e.name,", ")}}function oe(e,t){if(1&e&&(l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"strong"),l.Dc(3,"Institutions/Fundings: "),l.Sb(),l.Bc(4,ce,2,1,"span",1),l.Bc(5,se,2,1,"span",1),l.Sb()),2&e){const e=l.dc(2);l.Bb(4),l.jc("ngForOf",e.model.institutions),l.Bb(1),l.jc("ngForOf",e.model.fundings)}}function re(e,t){if(1&e&&(l.Tb(0,"div"),l.Bc(1,te,2,1,"h4",0),l.Bc(2,ne,5,1,"div",0),l.Bc(3,oe,6,2,"div",0),l.Sb()),2&e){const e=l.dc();l.Bb(1),l.jc("ngIf",e.model.authors.length>0),l.Bb(1),l.jc("ngIf",e.model.curators.length>0),l.Bb(1),l.jc("ngIf",e.model.institutions.length>0||e.model.fundings.length>0)}}let ae=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-contr-desc-view"]],inputs:{model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&l.Bc(0,re,4,3,"div",0),2&e&&l.jc("ngIf",t.model)},directives:[n.m,n.l],encapsulation:2}),e})();function le(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"p"),l.Tb(2,"strong"),l.Dc(3,"Species: "),l.Sb(),l.Dc(4),l.Sb(),l.Tb(5,"p"),l.Tb(6,"strong"),l.Dc(7,"Data category: "),l.Sb(),l.Dc(8),l.Sb(),l.Sb()),2&e){const e=l.dc();l.Bb(4),l.Fc(" ",e.model.species," "),l.Bb(4),l.Fc(" ",null==e.model.dataCategory?null:e.model.dataCategory.longName," ")}}let de=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-simple-bio-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&l.Bc(0,le,9,2,"div",0),2&e&&l.jc("ngIf",t.model)},directives:[n.m],encapsulation:2}),e})();function be(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"strong"),l.Dc(2,"Details"),l.Sb(),l.Tb(3,"div"),l.Dc(4),l.Sb(),l.Sb()),2&e){const e=l.dc(3);l.Bb(4),l.Ec(e.model.description)}}function ue(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"strong"),l.Dc(2,"Technique:"),l.Sb(),l.Dc(3),l.Bc(4,be,5,1,"div",0),l.Sb()),2&e){const e=l.dc(2);l.Bb(3),l.Gc(" ",e.model.technique," ",e.model.equipment?"("+e.model.equipment+")":""," "),l.Bb(1),l.jc("ngIf",e.model.description)}}function me(e,t){1&e&&(l.Tb(0,"div"),l.Dc(1," Unspecified "),l.Sb())}function he(e,t){if(1&e&&(l.Tb(0,"div"),l.Bc(1,ue,5,3,"div",0),l.Bc(2,me,2,0,"div",0),l.Sb()),2&e){const e=l.dc();l.Bb(1),l.jc("ngIf",e.model.technique),l.Bb(1),l.jc("ngIf",!e.model.technique)}}let fe=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-measurement-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&l.Bc(0,he,3,2,"div",0),2&e&&l.jc("ngIf",t.model)},directives:[n.m],encapsulation:2}),e})();function pe(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"h3"),l.Dc(2,"Overview of experimental details"),l.Sb(),l.Tb(3,"div",1),l.Tb(4,"div",2),l.Dc(5,"General description"),l.Sb(),l.Tb(6,"div",3),l.Ob(7,"bd2-general-desc-view",4),l.Sb(),l.Sb(),l.Tb(8,"div",1),l.Tb(9,"div",2),l.Dc(10,"Contributions"),l.Sb(),l.Tb(11,"div",3),l.Ob(12,"bd2-contr-desc-view",4),l.Sb(),l.Sb(),l.Tb(13,"div",1),l.Tb(14,"div",2),l.Dc(15,"Biological details"),l.Sb(),l.Tb(16,"div",3),l.Ob(17,"bd2-simple-bio-desc-view",4),l.Sb(),l.Sb(),l.Tb(18,"div",1),l.Tb(19,"div",2),l.Dc(20,"Measurement details"),l.Sb(),l.Tb(21,"div",3),l.Ob(22,"bd2-measurement-desc-view",4),l.Sb(),l.Sb(),l.Sb()),2&e){const e=l.dc();l.Bb(7),l.jc("model",e.assay.generalDesc),l.Bb(5),l.jc("model",e.assay.contributionDesc),l.Bb(5),l.jc("model",e.assay),l.Bb(5),l.jc("model",e.assay.experimentalDetails.measurementDesc)}}let ge=(()=>{class e extends $.a{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(l.Nb(a.a))},e.\u0275cmp=l.Hb({type:e,selectors:[["ng-component"]],features:[l.Ab([]),l.yb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"model"]],template:function(e,t){1&e&&l.Bc(0,pe,23,4,"div",0),2&e&&l.jc("ngIf",t.assay)},directives:[n.m,Q,ae,de,fe],encapsulation:2}),e})(),ve=(()=>{class e{validate(e){const t=[];return e?(e.name&&""!=e.name.trim()||t.push("Non empty name is required"),e.purpose&&""!=e.purpose.trim()||t.push("Purpose is required"),e.purpose&&e.purpose.trim().length<20&&t.push("Purpose is too short"),t):["General description cannot be empty"]}GeneralDescValidator(){}}return e.INSTANCE=new e,e})(),Se=(()=>{class e{validate(e){return e?e.authors.length<1?["At least one author is required"]:[]:["Contribution cannot be empty"]}ContributionDescValidator(){}}return e.INSTANCE=new e,e})(),Te=(()=>{class e{constructor(){}validate(e){const t=[];return e?(e.species&&""!=e.species.trim()||t.push("Non empty species is required"),e.dataCategory&&"NONE"!=e.dataCategory.name||t.push("Data category is required"),t):["Cannot validate null object"]}}return e.INSTANCE=new e,e})(),De=(()=>{class e{constructor(){this.generalV=ve.INSTANCE,this.contribV=Se.INSTANCE,this.bioV=Te.INSTANCE}validate(e){let t=[];return t=t.concat(this.generalV.validate(e.generalDesc),this.contribV.validate(e.contributionDesc),this.bioV.validate(e)),t}}return e.INSTANCE=new e,e})();var Be=i("TPWj");class ye extends Be.a{constructor(e){super(e),this.onAccepted=new l.o,this.onCancelled=new l.o}cancel(){this.clearErrors(),this.onCancelled.emit(!0)}save(){this._orgModel&&this.triggerValidation()&&(this._orgModel.setAll(this._model),this.onAccepted.emit(this._orgModel))}getModel(){return this._model}setModel(e){this._orgModel=e,e&&(this._model=e.clone())}}class we{constructor(e){this.text=e||"",this.nextPosition=0,this.limit=this.text.length,this.currentWorld=""}next(){if(this.nextPosition>=this.limit)return"";for(;this.nextPosition<this.limit;this.nextPosition++){const e=this.text.charAt(this.nextPosition);if(" "===e||"\t"===e||"\n"===e){if(this.currentWorld){const e=this.currentWorld.toLowerCase();return this.currentWorld="",e}}else{if("."===e||","===e||":"===e||"'"===e)continue;this.currentWorld=this.currentWorld+e}}return this.currentWorld.toLowerCase()}}let ke=(()=>{class e{static initBannedWords(){const e=new Set;return e.add("sensible"),e.add("description"),e.add("with"),e.add("more"),e.add("words"),e.add("required"),e.add("purpose"),e.add("hypothesis"),e}static removeLetterChain(e){if(!e)return"";const t=e.length;let i=e.charAt(0),n=e.charAt(0);for(let c=1;c<t;c++){const t=e.charAt(c);t!==n&&(n=t,i+=t)}return i}static removePairChain(e){if(!e)return"";if(e.length<4)return e;const t=e.length-1;let i=e.substring(0,2),n=i,c=2;for(;c<t;){const t=e.substring(c,c+2);t!==n?(n=n.charAt(1)+t.charAt(0),i+=t.charAt(0),c++):c+=2}return c==t&&(i+=e.charAt(e.length-1)),i}static simplifyWorld(t){let i=e.removeLetterChain(t);return i=e.removePairChain(i),i}static countDistinctCharacters(e){if(!e)return 0;const t=new Set;for(let i=0;i<e.length;i++)t.add(e.charAt(i));return t.size}static isSensibleWorld(t){if(!t)return!1;if(t.length>6&&e.countDistinctCharacters(t)<=4)return!1;if(e.bannedWords.has(t))return!1;const i=e.simplifyWorld(t);let n=4;return 4===t.length&&(n=3),t.length>10&&(n=.6*t.length),i.length>=n}}return e.bannedWords=e.initBannedWords(),e})();class je{constructor(e){this.minWords=5,this.previouslyValid="",this.minWords=e||5}validateText(e){if(e&&this.previouslyValid&&e.startsWith(this.previouslyValid))return null;const t=this.countWords(e,this.minWords);return t<this.minWords?{minWords:"required "+this.minWords+" found: "+t}:(this.previouslyValid=e,null)}countWords(e,t){const i=new we(e),n=new Set;for(let c=i.next();c&&n.size<t;c=i.next())ke.isSensibleWorld(c)&&n.add(c);return n.size}}var Fe=i("B9cw"),Ie=i("3Pt+"),xe=i("kmnG"),Me=i("qFsG"),Oe=i("iadO");function Ce(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Tb(1,"form",null,1),l.Tb(3,"div",2),l.Tb(4,"mat-form-field",3),l.Tb(5,"mat-label",4),l.Dc(6,"Name"),l.Sb(),l.Tb(7,"input",5,6),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc().model.name=t})),l.Sb(),l.Tb(9,"mat-hint"),l.Dc(10,"Good name hints the data content"),l.Sb(),l.Tb(11,"mat-error"),l.Dc(12,"Descriptive name is required"),l.Sb(),l.Sb(),l.Sb(),l.Tb(13,"div",2),l.Tb(14,"mat-form-field",3),l.Tb(15,"mat-label",7),l.Dc(16,"Purpose/Hypothesis"),l.Sb(),l.Tb(17,"textarea",8,9),l.Zb("input",(function(){return l.sc(e),l.dc().checkPurpose()}))("ngModelChange",(function(t){return l.sc(e),l.dc().model.purpose=t})),l.Dc(19,"                   "),l.Sb(),l.Tb(20,"mat-hint"),l.Dc(21,"Sensible description with more than few words is required"),l.Sb(),l.Sb(),l.Sb(),l.Tb(22,"div",2),l.Tb(23,"mat-form-field",3),l.Tb(24,"mat-label",10),l.Dc(25,"Description"),l.Sb(),l.Tb(26,"textarea",11,12),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc().model.description=t})),l.Dc(28,"                 "),l.Sb(),l.Sb(),l.Sb(),l.Tb(29,"div",2),l.Tb(30,"mat-form-field",3),l.Tb(31,"mat-label",13),l.Dc(32,"Comments"),l.Sb(),l.Tb(33,"textarea",14,15),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc().model.comments=t})),l.Dc(35,"                "),l.Sb(),l.Sb(),l.Sb(),l.Tb(36,"div",2),l.Tb(37,"mat-form-field"),l.Tb(38,"input",16,17),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc().executionDate=t})),l.Sb(),l.Ob(40,"mat-datepicker-toggle",18),l.Ob(41,"mat-datepicker",null,19),l.Tb(43,"mat-error"),l.Dc(44,"Date is required and cannot be much in the future"),l.Sb(),l.Sb(),l.Ob(45,"br"),l.Sb(),l.Tb(46,"button",20),l.Zb("click",(function(){return l.sc(e),l.dc().save()})),l.Dc(47),l.Sb(),l.Tb(48,"button",21),l.Zb("click",(function(){return l.sc(e),l.dc().cancel()})),l.Dc(49,"Cancel"),l.Sb(),l.Sb(),l.Sb()}if(2&e){const e=l.qc(2),t=l.qc(18),i=l.qc(42),n=l.dc();l.Bb(7),l.jc("ngModel",n.model.name),l.Bb(10),l.jc("ngModel",n.model.purpose),l.Bb(3),l.yc("color",n.sufficientPurpose||t.pristine?"":"red"),l.Bb(6),l.jc("ngModel",n.model.description),l.Bb(7),l.jc("ngModel",n.model.comments),l.Bb(5),l.jc("matDatepicker",i)("ngModel",n.executionDate)("max",n.maxDate)("min",n.minDate),l.Bb(2),l.jc("for",i),l.Bb(6),l.jc("disabled",n.blocked||!e.form.valid||!n.sufficientPurpose),l.Bb(1),l.Ec(n.okLabel)}}let Ee=(()=>{class e extends ye{constructor(){super(ve.INSTANCE),this.okLabel="Save",this.sufficientPurpose=!1,this.purposeWorldValidator=new je(5),this.maxDate=new Date,this.maxDate.setDate(this.maxDate.getDate()+21),this.minDate=new Date,this.minDate.setFullYear(this.minDate.getFullYear()-10)}get model(){return this._model}set model(e){this.setModel(e),this.executionDate=e.executionDate.date,this.checkPurpose()}checkPurpose(){this.sufficientPurpose=null===this.purposeWorldValidator.validateText(this.model.purpose)}save(){this.model.executionDate=Fe.a.fromDate(this.executionDate),super.save()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-general-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[l.yb],decls:1,vars:1,consts:[[4,"ngIf"],["gDescForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","gName"],["matInput","","id","gName","maxlength","100","minlength","6","name","gName","placeholder","e.g. Testing robustness in low light (E12)","required","","type","text",1,"",3,"ngModel","ngModelChange"],["gName","ngModel"],["for","gPurpose"],["matInput","","id","gPurpose","minlength","55","name","gPurpose","placeholder","Describe the main aim of the experiment. What you tried to achieve, test, verify, on what kind of samples.","required","","rows","4","type","text",1,"",3,"ngModel","input","ngModelChange"],["gPurpose","ngModel"],["for","gDescription"],["matInput","","id","gDescription","name","gDescription","placeholder","Describe how the experiment was conducted, what environmental conditions, sampling procedure.\nFor example: seedlings were exposed to short day light regime (LD 6:18) at two temperatures 15 and 25. Samples where harvested every 4 hours for 3 days and the genes levels measured with RT PCR","rows","5","type","text",1,"",3,"ngModel","ngModelChange"],["gDescription","ngModel"],["for","gComments"],["matInput","","id","gComments","name","gComments","placeholder","Optional remarks, for example technical issues during the experiment, discrepancies/simplifications of in the following sections","type","text",1,"",3,"ngModel","ngModelChange"],["gComments","ngModel"],["matInput","","name","executionDate","placeholder","Exp. execution date","required","",3,"matDatepicker","ngModel","max","min","ngModelChange"],["gDate","ngModel"],["matSuffix","",3,"for"],["picker",""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(e,t){1&e&&l.Bc(0,Ce,50,13,"div",0),2&e&&l.jc("ngIf",t.model)},directives:[n.m,Ie.D,Ie.r,Ie.s,xe.c,xe.g,Me.b,Ie.d,Ie.l,Ie.m,Ie.z,Ie.q,Ie.t,xe.f,xe.b,Oe.b,Oe.d,xe.h,Oe.a],encapsulation:2}),e})();var Ae=i("kKfy"),qe=i("RkHi"),Ne=i("cEDj"),Le=i("BOp5"),Pe=i("Wp6s"),Ue=i("A5z7"),Ze=i("f0Cb"),Re=i("NFeN");const We=["persForm"],_e=["instForm"],Ge=["fundForm"];function ze(e,t){if(1&e&&(l.Tb(0,"li"),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.Bb(1),l.Ec(e)}}function Ve(e,t){if(1&e&&(l.Tb(0,"div",35),l.Tb(1,"ul",36),l.Bc(2,ze,2,1,"li",37),l.Sb(),l.Sb()),2&e){const e=l.dc(2);l.Bb(2),l.jc("ngForOf",e.errors)}}function He(e,t){1&e&&(l.Tb(0,"p"),l.Dc(1,"Please add an author"),l.Sb())}function $e(e,t){if(1&e){const e=l.Ub();l.Tb(0,"mat-chip",38),l.Zb("removed",(function(){l.sc(e);const i=t.$implicit;return l.dc(2).removeAuthor(i)})),l.Dc(1),l.Tb(2,"mat-icon",39),l.Dc(3,"cancel"),l.Sb(),l.Sb()}if(2&e){const e=t.$implicit;l.Bb(1),l.Fc(" ",e.name," ")}}function Xe(e,t){if(1&e){const e=l.Ub();l.Tb(0,"mat-chip",38),l.Zb("removed",(function(){l.sc(e);const i=t.$implicit;return l.dc(3).removeCurator(i)})),l.Dc(1),l.Tb(2,"mat-icon",39),l.Dc(3,"cancel"),l.Sb(),l.Sb()}if(2&e){const e=t.$implicit;l.Bb(1),l.Fc(" ",e.name," ")}}function Je(e,t){if(1&e&&(l.Tb(0,"div",2),l.Tb(1,"label"),l.Tb(2,"strong"),l.Dc(3,"Data curators"),l.Sb(),l.Sb(),l.Tb(4,"mat-chip-list"),l.Bc(5,Xe,4,1,"mat-chip",3),l.Sb(),l.Ob(6,"mat-divider",4),l.Sb()),2&e){const e=l.dc(2);l.Bb(5),l.jc("ngForOf",e.model.curators)}}function Ke(e,t){1&e&&(l.Tb(0,"p"),l.Dc(1,"Please add an institution"),l.Sb())}function Ye(e,t){if(1&e){const e=l.Ub();l.Tb(0,"mat-chip",38),l.Zb("removed",(function(){l.sc(e);const i=t.$implicit;return l.dc(2).removeInstitution(i)})),l.Dc(1),l.Tb(2,"mat-icon",39),l.Dc(3,"cancel"),l.Sb(),l.Sb()}if(2&e){const e=t.$implicit;l.Bb(1),l.Fc(" ",e.name," ")}}function Qe(e,t){if(1&e){const e=l.Ub();l.Tb(0,"mat-chip",38),l.Zb("removed",(function(){l.sc(e);const i=t.$implicit;return l.dc(3).removeFunding(i)})),l.Dc(1),l.Tb(2,"mat-icon",39),l.Dc(3,"cancel"),l.Sb(),l.Sb()}if(2&e){const e=t.$implicit;l.Bb(1),l.Fc(" ",e.name," ")}}function et(e,t){if(1&e&&(l.Tb(0,"div",2),l.Tb(1,"label"),l.Tb(2,"strong"),l.Dc(3,"Fundings"),l.Sb(),l.Sb(),l.Tb(4,"mat-chip-list"),l.Bc(5,Qe,4,1,"mat-chip",3),l.Sb(),l.Ob(6,"mat-divider",4),l.Sb()),2&e){const e=l.dc(2);l.Bb(5),l.jc("ngForOf",e.model.fundings)}}function tt(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Bc(1,Ve,3,1,"div",1),l.Tb(2,"mat-card"),l.Tb(3,"mat-card-content"),l.Tb(4,"div",2),l.Tb(5,"label"),l.Tb(6,"strong"),l.Dc(7,"Authors"),l.Sb(),l.Sb(),l.Bc(8,He,2,0,"p",0),l.Tb(9,"mat-chip-list"),l.Bc(10,$e,4,1,"mat-chip",3),l.Sb(),l.Ob(11,"mat-divider",4),l.Sb(),l.Bc(12,Je,7,1,"div",5),l.Tb(13,"form",6,7),l.Tb(15,"div",8),l.Tb(16,"mat-form-field"),l.Tb(17,"mat-label",9),l.Dc(18,"Name"),l.Sb(),l.Tb(19,"input",10,11),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc().firstName=t})),l.Sb(),l.Sb(),l.Sb(),l.Tb(21,"div",2),l.Tb(22,"mat-form-field"),l.Tb(23,"mat-label",12),l.Dc(24,"Surname"),l.Sb(),l.Tb(25,"input",13,14),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc().lastName=t})),l.Sb(),l.Sb(),l.Sb(),l.Tb(27,"button",15),l.Zb("click",(function(){return l.sc(e),l.dc().addAuthor()})),l.Dc(28,"New Author "),l.Sb(),l.Tb(29,"button",16),l.Zb("click",(function(){return l.sc(e),l.dc().addCurator()})),l.Dc(30,"New Curator "),l.Sb(),l.Sb(),l.Sb(),l.Sb(),l.Ob(31,"mat-divider",17),l.Tb(32,"mat-card"),l.Tb(33,"mat-card-content"),l.Tb(34,"div",2),l.Tb(35,"label"),l.Tb(36,"strong"),l.Dc(37,"Institutions"),l.Sb(),l.Sb(),l.Bc(38,Ke,2,0,"p",0),l.Tb(39,"mat-chip-list"),l.Bc(40,Ye,4,1,"mat-chip",3),l.Sb(),l.Ob(41,"mat-divider",4),l.Sb(),l.Tb(42,"form",6,18),l.Tb(44,"div",2),l.Tb(45,"mat-form-field"),l.Tb(46,"mat-label",19),l.Dc(47,"Institution"),l.Sb(),l.Tb(48,"input",20,21),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc().institutionName=t})),l.Sb(),l.Sb(),l.Sb(),l.Tb(50,"button",22),l.Zb("click",(function(){return l.sc(e),l.dc().addInstitution()})),l.Dc(51," Add Institution "),l.Sb(),l.Ob(52,"mat-divider",23),l.Sb(),l.Bc(53,et,7,1,"div",5),l.Tb(54,"form",6,24),l.Tb(56,"div",2),l.Tb(57,"mat-form-field",25),l.Tb(58,"mat-label",26),l.Dc(59,"Funder"),l.Sb(),l.Tb(60,"input",27,28),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc().funderName=t})),l.Sb(),l.Sb(),l.Sb(),l.Tb(62,"div",2),l.Tb(63,"mat-form-field"),l.Tb(64,"mat-label",29),l.Dc(65,"Grant"),l.Sb(),l.Tb(66,"input",30,31),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc().grantNr=t})),l.Sb(),l.Sb(),l.Sb(),l.Tb(68,"button",22),l.Zb("click",(function(){return l.sc(e),l.dc().addFunding()})),l.Dc(69," Add Funding "),l.Sb(),l.Sb(),l.Sb(),l.Sb(),l.Tb(70,"div",32),l.Tb(71,"button",33),l.Zb("click",(function(){return l.sc(e),l.dc().save()})),l.Dc(72),l.Sb(),l.Tb(73,"button",34),l.Zb("click",(function(){return l.sc(e),l.dc().cancel()})),l.Dc(74,"Cancel"),l.Sb(),l.Sb(),l.Sb()}if(2&e){const e=l.qc(14),t=l.qc(43),i=l.qc(55),n=l.dc();l.Bb(1),l.jc("ngIf",n.errors),l.Bb(7),l.jc("ngIf",!n.model.authors||n.model.authors.length<1),l.Bb(2),l.jc("ngForOf",n.model.authors),l.Bb(2),l.jc("ngIf",n.model.curators.length>0),l.Bb(7),l.jc("ngModel",n.firstName),l.Bb(6),l.jc("ngModel",n.lastName),l.Bb(2),l.jc("disabled",!e.form.valid),l.Bb(2),l.jc("disabled",!e.form.valid),l.Bb(9),l.jc("ngIf",!n.model.institutions||n.model.institutions.length<1),l.Bb(2),l.jc("ngForOf",n.model.institutions),l.Bb(8),l.jc("ngModel",n.institutionName),l.Bb(2),l.jc("disabled",!t.form.valid),l.Bb(3),l.jc("ngIf",n.model.fundings.length>0),l.Bb(7),l.jc("ngModel",n.funderName),l.Bb(6),l.jc("ngModel",n.grantNr),l.Bb(2),l.jc("disabled",!i.form.valid),l.Bb(3),l.jc("disabled",n.blocked||n.errors),l.Bb(1),l.Ec(n.okLabel)}}let it=(()=>{class e extends ye{constructor(){super(Se.INSTANCE),this.okLabel="Save",this.blocked=!1}get model(){return this._model}set model(e){this.setModel(e)}addAuthor(){const e=this.selectedPerson();e&&(this._model.authors.push(e),this.resetPerson(),this.triggerValidation())}addCurator(){const e=this.selectedPerson();e&&(this._model.curators.push(e),this.resetPerson())}removeAuthor(e){Object(Le.b)(e,this._model.authors),this.triggerValidation()}removeCurator(e){Object(Le.b)(e,this._model.curators)}addInstitution(){const e=this.selectedInstitution();if(e){if(this.hasInstitution(e,this._model))return;this._model.institutions.push(e),this.resetInstitution()}}hasInstitution(e,t){return t.institutions.findIndex(t=>t.name===e.name)>=0}removeInstitution(e){Object(Le.b)(e,this.model.institutions)}addFunding(){const e=this.selectedFunding();if(e){if(this.hasFunding(e,this._model))return;this._model.fundings.push(e),this.resetFunding()}}hasFunding(e,t){return t.fundings.findIndex(t=>t.name===e.name)>=0}removeFunding(e){Object(Le.b)(e,this._model.fundings)}resetPerson(){this.firstName=void 0,this.lastName=void 0,this.persForm.reset()}selectedPerson(){return this.firstName&&this.lastName?new Ne.a(this.firstName,this.lastName):null}resetInstitution(){this.institutionName=void 0,this.instForm.reset()}selectedInstitution(){return this.institutionName?new qe.a(this.institutionName):null}resetFunding(){this.funderName=void 0,this.grantNr=void 0,this.fundForm.reset()}selectedFunding(){if(this.funderName){const e=new qe.a(this.funderName),t=new Ae.a;return t.institution=e,t.grantNr=this.grantNr,t}return null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-contr-desc-form"]],viewQuery:function(e,t){var i;1&e&&(l.Ic(We,!0),l.Ic(_e,!0),l.Ic(Ge,!0)),2&e&&(l.pc(i=l.ac())&&(t.persForm=i.first),l.pc(i=l.ac())&&(t.instForm=i.first),l.pc(i=l.ac())&&(t.fundForm=i.first))},inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[l.yb],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"form-group"],[3,"removed",4,"ngFor","ngForOf"],["inset","",1,"mt-2"],["class","form-group",4,"ngIf"],[1,"form-inline"],["persForm","ngForm"],[1,"form-group","mr-1"],["for","pFirst"],["matInput","","id","pFirst","maxlength","100","minlength","2","name","pFirst","placeholder","e.g. John)","required","","type","text",3,"ngModel","ngModelChange"],["pFirst","ngModel"],["for","pLast"],["matInput","","id","pLast","maxlength","100","minlength","2","name","pLast","placeholder","e.g. Smith","required","","type","text",3,"ngModel","ngModelChange"],["pLast","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","mr-1","ml-1",3,"disabled","click"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"mb-1"],["instForm","ngForm"],["for","iName"],["matInput","","id","iName","maxlength","100","minlength","3","name","iName","placeholder","e.g. University of Edinburgh","required","","type","text",1,"",3,"ngModel","ngModelChange"],["iName","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","ml-1",3,"disabled","click"],["inset","",1,"mt-1","mb-2"],["fundForm","ngForm"],[1,"mr-1"],["for","fName"],["matInput","","id","fName","maxlength","100","minlength","3","name","fName","placeholder","e.g. BBSRC","required","","type","text",1,"",3,"ngModel","ngModelChange"],["fName","ngModel"],["for","fGrant"],["matInput","","id","fGrant","maxlength","100","minlength","3","name","fGrant","placeholder","e.g. EC2014","type","text",1,"",3,"ngModel","ngModelChange"],["fGrant","ngModel"],[1,"mt-2"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"alert","alert-danger"],[1,"mb-0"],[4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""]],template:function(e,t){1&e&&l.Bc(0,tt,75,18,"div",0),2&e&&l.jc("ngIf",t.model)},directives:[n.m,Pe.a,Pe.c,Ue.c,n.l,Ze.a,Ie.D,Ie.r,Ie.s,xe.c,xe.g,Me.b,Ie.d,Ie.l,Ie.m,Ie.z,Ie.q,Ie.t,Ue.a,Re.a,Ue.d],encapsulation:2}),e})();var nt=i("FUU9"),ct=i("D0XW");const st=(()=>{function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e})();var ot=i("mlxB"),rt=i("l7GE"),at=i("ZUHj");class lt{constructor(e,t,i,n){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=i,this.scheduler=n}call(e,t){return t.subscribe(new dt(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))}}class dt extends rt.a{constructor(e,t,i,n,c){super(e),this.absoluteTimeout=t,this.waitFor=i,this.withObservable=n,this.scheduler=c,this.action=null,this.scheduleTimeout()}static dispatchTimeout(e){const{withObservable:t}=e;e._unsubscribeAndRecycle(),e.add(Object(at.a)(e,t))}scheduleTimeout(){const{action:e}=this;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(dt.dispatchTimeout,this.waitFor,this))}_next(e){this.absoluteTimeout||this.scheduleTimeout(),super._next(e)}_unsubscribe(){this.action=null,this.scheduler=null,this.withObservable=null}}var bt=i("z6cu"),ut=i("vkgz"),mt=i("JIr8"),ht=i("LRne"),ft=i("UsWK");let pt=(()=>{class e{constructor(e){this.BD2REST=e,this.popularSpecies=["Arabidopsis thaliana","Brassica rapa","Danio rerio","Drosophila melanogaster","Glycine max","Homo sapiens","Lemna gibba","Lemna minor","Marchantia polymorpha","Medicago truncatula","Mus musculus","Nannochloropsis","Neurospora crassa","Oryza sativa","Ostreococcus tauri","Phaeodactylum tricornutum","Physcometrella patens","Picea abies","Rattus norvegicus","Saccharomyces cerevisiae","Synechococcus elongatus","Synthetic data"],this.fetchedSpecies=void 0,console.log("Species Service")}species(){return this.fetchedSpecies?Promise.resolve(this.fetchedSpecies):this.fetchSpecies().toPromise()}fetchSpecies(){return this.BD2REST.species().pipe(function(e,t=ct.a){return function(e,t,i=ct.a){return n=>{let c=Object(ot.a)(e),s=c?+e-i.now():Math.abs(e);return n.lift(new lt(s,c,t,i))}}(5e3,Object(bt.a)(new st),t)}(),Object(ut.a)(e=>{if(!(e&&e.length>0))throw new Error("Retrieved empty species falls back to default");this.fetchedSpecies=e}),Object(mt.a)(e=>(console.log(" Could not fetch species",e),Object(ht.a)(this.popularSpecies))))}}return e.\u0275fac=function(t){return new(t||e)(l.Xb(ft.a))},e.\u0275prov=l.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var gt=i("d3UM"),vt=i("FKr1");function St(e,t){if(1&e&&(l.Tb(0,"mat-option",13),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.jc("value",e),l.Bb(1),l.Fc("",e," ")}}function Tt(e,t){if(1&e&&(l.Tb(0,"mat-option",13),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.jc("value",e.name),l.Bb(1),l.Fc(" ",e.longName," ")}}function Dt(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Tb(1,"form",null,1),l.Tb(3,"div",2),l.Tb(4,"mat-form-field",3),l.Tb(5,"mat-label",4),l.Dc(6,"Species"),l.Sb(),l.Tb(7,"mat-select",5,6),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc()._model.species=t})),l.Bc(9,St,2,2,"mat-option",7),l.Sb(),l.Tb(10,"mat-hint"),l.Dc(11,"Please email us if you don't see suitable terms in the value lists"),l.Sb(),l.Sb(),l.Sb(),l.Tb(12,"div",2),l.Tb(13,"mat-form-field",3),l.Tb(14,"mat-label",8),l.Dc(15,"Data category"),l.Sb(),l.Tb(16,"mat-select",9,10),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc()._model.category=t})),l.Bc(18,Tt,2,2,"mat-option",7),l.Sb(),l.Tb(19,"mat-hint"),l.Dc(20,"Please email us if you don't see suitable terms in the value lists"),l.Sb(),l.Sb(),l.Sb(),l.Tb(21,"button",11),l.Zb("click",(function(){return l.sc(e),l.dc().save()})),l.Dc(22),l.Sb(),l.Tb(23,"button",12),l.Zb("click",(function(){return l.sc(e),l.dc().cancel()})),l.Dc(24,"Cancel"),l.Sb(),l.Sb(),l.Sb()}if(2&e){const e=l.qc(2),t=l.dc();l.Bb(7),l.jc("ngModel",t._model.species),l.Bb(2),l.jc("ngForOf",t.knownSpecies),l.Bb(7),l.jc("ngModel",t._model.category),l.Bb(2),l.jc("ngForOf",t.categories),l.Bb(3),l.jc("disabled",t.blocked||!e.form.valid),l.Bb(1),l.Ec(t.okLabel)}}let Bt=(()=>{class e extends Be.a{constructor(e){super(),this.speciesService=e,this.okLabel="Save",this.blocked=!1,this.onAccepted=new l.o,this.onCancelled=new l.o,this.categories=[],this.knownSpecies=[],this._model={species:null,category:null}}set model(e){e&&(this.experiment=e,this._model.species=e.species,this._model.category=e.dataCategory?e.dataCategory.name:null)}getModel(){return this._model}ngOnInit(){this.speciesService.species().then(e=>this.knownSpecies=e),this.categories=this.initCategories()}cancel(){this.clearErrors(),this.onCancelled.emit(!0)}save(){this.triggerValidation()&&(this.experiment.dataCategory=nt.a.get(this._model.category),this.experiment.species=this._model.species,this.onAccepted.emit(this.experiment))}validate(e){const t=[];return e.species&&""!==e.species.trim()||t.push("Species cannot be empty"),e.species&&this.knownSpecies.indexOf(e.species)<0&&t.push("Unknown species: "+e.species),e.category&&"NONE"!==e.category||t.push("Data category is required"),0===t.length?null:t}initCategories(){const e=nt.a.getValidOptions().slice();return Object(Le.b)(nt.a.get("NONE"),e),e}}return e.\u0275fac=function(t){return new(t||e)(l.Nb(pt))},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-simple-bio-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[l.yb],decls:1,vars:1,consts:[[4,"ngIf"],["sBioForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","species"],["id","species","required","","placeholder","Select species","name","species",1,"",3,"ngModel","ngModelChange"],["species","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","dataCategory"],["id","dataCategory","required","","placeholder","Select category","name","dataCategory",1,"",3,"ngModel","ngModelChange"],["dataCategory","ngModel"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(e,t){1&e&&l.Bc(0,Dt,25,6,"div",0),2&e&&l.jc("ngIf",t.experiment)},directives:[n.m,Ie.D,Ie.r,Ie.s,xe.c,xe.g,gt.a,Ie.z,Ie.q,Ie.t,n.l,xe.f,vt.o],encapsulation:2}),e})();var yt=i("JX91"),wt=i("zrmi");let kt=(()=>{class e{constructor(){this.equipments=new Map,this.parameters=new Map,this.initTechniques()}getTechniques(){return Promise.resolve(this.techniques)}getEquipments(e){return this.equipments.has(e)?Promise.resolve(this.equipments.get(e)):Promise.reject(new Error("Unknown technique: "+e))}getParameters(e){return this.parameters.has(e)?Promise.resolve(this.parameters.get(e)):Promise.reject(new Error("Unknown technique: "+e))}registerEquipment(e,t){return this.equipments.has(e)?(this.equipments.get(e).indexOf(t)<0&&this.equipments.get(e).push(t),Promise.resolve(t)):Promise.reject(new Error("Unknown technique: "+e))}initTechniques(){const e=["Luciferase luminescence","Bioluminescence","(G)FP fluorescence","Delayed fluorescence","Endogenous fluorescence","Leaf movement","General imaging"];this.techniques=e.concat(["Computer simulation","qRT-PCR","RNA microarray","RNA-Seq","Northern blot","Western blot","Protein array","Mass Spectrometry","Flow cytometry","Spectrophotometry","Immunoprecipitation","Biomass Assay","Gas exchange","Oxygen concentration","Other"]);const t=["","Luminometer","Tecan Infinite 200 PRO","Topcount 1","Topcount 2","Topcount 3","Topcount 4","HAM 1","HAM 2","HAM 3","Unknown"];this.equipments=new Map,this.techniques.forEach(e=>this.equipments.set(e,["","Unknown"])),e.forEach(e=>this.equipments.set(e,t)),this.equipments.set("qRT-PCR",["","Robot + Light Cycler 480","Light Cycler 480","Unknown"]),this.equipments.set("Oxygen concentration",["","Galvanic Clarck's probe","Unknown"]);const i=[];i.push(new wt.b("exposure_time",void 0,"Exposure time","min")),i.push(new wt.b("interval",void 0,"Img interval","h")),i.push(new wt.b("start_time",void 0,"Start time","h")),this.parameters=new Map,this.techniques.forEach(e=>this.parameters.set(e,[])),e.forEach(e=>this.parameters.set(e,i))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=l.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var jt=i("/1cH");function Ft(e,t){1&e&&(l.Tb(0,"mat-error"),l.Dc(1,"Known technique must be selected"),l.Sb())}function It(e,t){if(1&e&&(l.Tb(0,"mat-option",19),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.jc("value",e),l.Bb(1),l.Fc(" ",e," ")}}function xt(e,t){if(1&e&&(l.Tb(0,"mat-option",19),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.jc("value",e),l.Bb(1),l.Fc(" ",e," ")}}function Mt(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Tb(1,"form",1),l.Tb(2,"mat-hint",2),l.Dc(3,"Please email us if you don't see suitable terms in the value lists"),l.Sb(),l.Tb(4,"div",3),l.Tb(5,"mat-form-field",4),l.Tb(6,"mat-label",5),l.Dc(7,"Technique"),l.Sb(),l.Ob(8,"input",6,7),l.Tb(10,"mat-hint"),l.Dc(11,"Type to select technique (backspace for all available)"),l.Sb(),l.Bc(12,Ft,2,0,"mat-error",0),l.Sb(),l.Tb(13,"mat-autocomplete",8,9),l.Zb("optionSelected",(function(t){return l.sc(e),l.dc().techniqueSelected(t)})),l.Bc(15,It,2,2,"mat-option",10),l.ec(16,"async"),l.Sb(),l.Sb(),l.Tb(17,"div",3),l.Tb(18,"mat-form-field",4),l.Tb(19,"mat-label",11),l.Dc(20,"Equipment"),l.Sb(),l.Ob(21,"input",12,13),l.Tb(23,"mat-hint"),l.Dc(24,"Type define your equipment or choose from the list (backspace for all known)"),l.Sb(),l.Sb(),l.Tb(25,"mat-autocomplete",null,14),l.Bc(27,xt,2,2,"mat-option",10),l.ec(28,"async"),l.Sb(),l.Sb(),l.Tb(29,"div",3),l.Tb(30,"mat-form-field",4),l.Tb(31,"mat-label",15),l.Dc(32,"Description"),l.Sb(),l.Tb(33,"textarea",16),l.Dc(34,"     "),l.Sb(),l.Tb(35,"mat-hint"),l.Dc(36,"Describe how the measurement was conducted"),l.Sb(),l.Sb(),l.Sb(),l.Tb(37,"button",17),l.Zb("click",(function(){return l.sc(e),l.dc().save()})),l.Dc(38),l.Sb(),l.Tb(39,"button",18),l.Zb("click",(function(){return l.sc(e),l.dc().cancel()})),l.Dc(40,"Cancel"),l.Sb(),l.Sb(),l.Sb()}if(2&e){const e=l.qc(14),t=l.qc(26),i=l.dc();l.Bb(1),l.jc("formGroup",i.formModel),l.Bb(7),l.jc("matAutocomplete",e),l.Bb(4),l.jc("ngIf",null==i.formModel.get("technique").errors?null:i.formModel.get("technique").errors.validTechnique),l.Bb(3),l.jc("ngForOf",l.fc(16,8,i.filteredTechniques)),l.Bb(6),l.jc("matAutocomplete",t),l.Bb(6),l.jc("ngForOf",l.fc(28,10,i.filteredEquipments)),l.Bb(10),l.jc("disabled",i.blocked||!i.formModel.valid),l.Bb(1),l.Ec(i.okLabel)}}let Ot=(()=>{class e{constructor(e,t,i){this.techniqueService=e,this.feedback=t,this.fb=i,this.okLabel="Save",this.onAccepted=new l.o,this.onCancelled=new l.o,this.techniques=[],this.filteredTechniques=Object(ht.a)([]),this.equipments=[],this.filteredEquipments=Object(ht.a)([])}set model(e){this.setModel(e),this.updateTechniques().then(t=>this.updateEquipments(e.technique)).then(t=>this.formModel=this.buildMainForm(e)).then(e=>{this.filteredTechniques=this.formModel.get("technique").valueChanges.pipe(Object(yt.a)(""),Object(o.a)(e=>this.filter(this.techniques,e))),this.filteredEquipments=this.formModel.get("equipment").valueChanges.pipe(Object(yt.a)(""),Object(o.a)(e=>this.filter(this.equipments,e)))})}setModel(e){this._orgModel=e}ngOnInit(){this.updateTechniques()}filter(e,t){const i=t.toLowerCase();return e.filter(e=>e.toLowerCase().includes(i))}buildMainForm(e){return this.fb.group({technique:[e.technique,[Ie.B.required,e=>this.knownTechnique(e.value)]],equipment:[e.equipment],description:[e.description],parameters:[]})}knownTechnique(e){return e?this.techniques.find(t=>t===e)?null:{validTechnique:"Unknown technique: "+e}:{validTechnique:"Empty value"}}techniqueSelected(e){e.option.value&&this.updateEquipments(e.option.value)}updateTechniques(){return this.techniqueService.getTechniques().then(e=>(this.techniques=e||[],e)).catch(e=>(this.feedback.error(e),Promise.reject(e)))}updateEquipments(e){return e?this.techniqueService.getEquipments(e).then(e=>(this.equipments=e||[],e)).catch(e=>(this.feedback.error(e),Promise.reject(e))):(this.equipments=[],Promise.resolve([]))}cancel(){this.onCancelled.emit(!0)}save(){this.formModel.valid&&(this._orgModel.setAll(this.formModel.value),this.onAccepted.emit(this._orgModel))}}return e.\u0275fac=function(t){return new(t||e)(l.Nb(kt),l.Nb(u.a),l.Nb(Ie.e))},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-measurement-desc-rform"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"formGroup"],[1,"mb-2"],[1,"form-group"],[1,"w-100"],["for","mTechNameA"],["matInput","","formControlName","technique","id","mTechNameA","placeholder","Type to select technique (backspace for all available)","required","",1,"",3,"matAutocomplete"],["mTechNameA",""],[3,"optionSelected"],["techniqueAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["for","mEquipNameA"],["matInput","","formControlName","equipment","id","mEquipNameA","placeholder","Type to choose or define equipment",1,"",3,"matAutocomplete"],["mEquipNameA",""],["equipmentAuto","matAutocomplete"],["for","mDescription"],["matInput","","formControlName","description","id","mDescription","placeholder","Describe how the measurement was conducted, used technical tricks etc...\nFor example: plants were sprayed with luciferase two ours before measurement. Images were taken every two ours.","rows","5","type","text",1,""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(e,t){1&e&&l.Bc(0,Mt,41,12,"div",0),2&e&&l.jc("ngIf",t.formModel)},directives:[n.m,Ie.D,Ie.r,Ie.i,xe.f,xe.c,xe.g,Me.b,Ie.d,jt.c,Ie.q,Ie.h,Ie.z,jt.a,n.l,xe.b,vt.o],pipes:[n.b],encapsulation:2}),e})();function Ct(e,t){if(1&e&&(l.Tb(0,"li"),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.Bb(1),l.Ec(e)}}function Et(e,t){if(1&e&&(l.Tb(0,"div",8),l.Tb(1,"ul"),l.Bc(2,Ct,2,1,"li",9),l.Sb(),l.Sb()),2&e){const e=l.dc(2);l.Bb(2),l.jc("ngForOf",e.errors)}}function At(e,t){if(1&e){const e=l.Ub();l.Tb(0,"bd2-general-desc-form",10),l.Zb("onAccepted",(function(t){return l.sc(e),l.dc(2).saveEdits(t)}))("onCancelled",(function(t){return l.sc(e),l.dc(2).hideEdits(t)})),l.Sb()}if(2&e){const e=l.dc(2);l.jc("blocked",e.blocked)("model",e.assay.generalDesc)}}function qt(e,t){if(1&e&&l.Ob(0,"bd2-general-desc-view",11),2&e){const e=l.dc(2);l.jc("model",e.assay.generalDesc)}}function Nt(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"button",12),l.Zb("click",(function(){return l.sc(e),l.dc(2).activeGeneralDescForm=!0})),l.Dc(3,"Modify "),l.Sb(),l.Sb()}if(2&e){const e=l.dc(2);l.Bb(2),l.jc("disabled",e.activeGeneralDescForm)}}function Lt(e,t){if(1&e){const e=l.Ub();l.Tb(0,"bd2-contr-desc-form",10),l.Zb("onAccepted",(function(t){return l.sc(e),l.dc(2).saveEdits(t)}))("onCancelled",(function(t){return l.sc(e),l.dc(2).hideEdits(t)})),l.Sb()}if(2&e){const e=l.dc(2);l.jc("blocked",e.blocked)("model",e.assay.contributionDesc)}}function Pt(e,t){if(1&e&&l.Ob(0,"bd2-contr-desc-view",11),2&e){const e=l.dc(2);l.jc("model",e.assay.contributionDesc)}}function Ut(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"button",12),l.Zb("click",(function(){return l.sc(e),l.dc(2).activeContributionDescForm=!0})),l.Dc(3,"Modify "),l.Sb(),l.Sb()}if(2&e){const e=l.dc(2);l.Bb(2),l.jc("disabled",e.activeContributionDescForm)}}function Zt(e,t){if(1&e){const e=l.Ub();l.Tb(0,"bd2-simple-bio-desc-form",10),l.Zb("onAccepted",(function(t){return l.sc(e),l.dc(2).saveEdits(t)}))("onCancelled",(function(t){return l.sc(e),l.dc(2).hideEdits(t)})),l.Sb()}if(2&e){const e=l.dc(2);l.jc("blocked",e.blocked)("model",e.assay)}}function Rt(e,t){if(1&e&&l.Ob(0,"bd2-simple-bio-desc-view",11),2&e){const e=l.dc(2);l.jc("model",e.assay)}}function Wt(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"button",12),l.Zb("click",(function(){return l.sc(e),l.dc(2).activeSimpleBioDescForm=!0})),l.Dc(3,"Modify "),l.Sb(),l.Sb()}if(2&e){const e=l.dc(2);l.Bb(2),l.jc("disabled",e.activeSimpleBioDescForm)}}function _t(e,t){if(1&e){const e=l.Ub();l.Tb(0,"bd2-measurement-desc-rform",10),l.Zb("onAccepted",(function(t){return l.sc(e),l.dc(2).saveEdits(t)}))("onCancelled",(function(t){return l.sc(e),l.dc(2).hideEdits(t)})),l.Sb()}if(2&e){const e=l.dc(2);l.jc("blocked",e.blocked)("model",e.assay.experimentalDetails.measurementDesc)}}function Gt(e,t){if(1&e&&l.Ob(0,"bd2-measurement-desc-view",11),2&e){const e=l.dc(2);l.jc("model",e.assay.experimentalDetails.measurementDesc)}}function zt(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"button",12),l.Zb("click",(function(){return l.sc(e),l.dc(2).activeMeasurementDescForm=!0})),l.Dc(3,"Modify "),l.Sb(),l.Sb()}if(2&e){const e=l.dc(2);l.Bb(2),l.jc("disabled",e.activeMeasurementDescForm)}}function Vt(e,t){if(1&e&&(l.Tb(0,"li"),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.Bb(1),l.Ec(e)}}function Ht(e,t){if(1&e&&(l.Tb(0,"div",8),l.Tb(1,"ul"),l.Bc(2,Vt,2,1,"li",9),l.Sb(),l.Sb()),2&e){const e=l.dc(2);l.Bb(2),l.jc("ngForOf",e.errors)}}function $t(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"h3"),l.Dc(2,"Modify experiment description"),l.Sb(),l.Bc(3,Et,3,1,"div",1),l.Tb(4,"div",2),l.Tb(5,"div",3),l.Dc(6,"General description"),l.Sb(),l.Tb(7,"div",4),l.Bc(8,At,1,2,"bd2-general-desc-form",5),l.Bc(9,qt,1,1,"bd2-general-desc-view",6),l.Bc(10,Nt,4,1,"div",0),l.Sb(),l.Sb(),l.Tb(11,"div",2),l.Tb(12,"div",3),l.Dc(13,"Contributions"),l.Sb(),l.Tb(14,"div",4),l.Bc(15,Lt,1,2,"bd2-contr-desc-form",5),l.Bc(16,Pt,1,1,"bd2-contr-desc-view",6),l.Bc(17,Ut,4,1,"div",0),l.Sb(),l.Sb(),l.Tb(18,"div",2),l.Tb(19,"div",3),l.Dc(20,"Biological details"),l.Sb(),l.Tb(21,"div",4),l.Bc(22,Zt,1,2,"bd2-simple-bio-desc-form",5),l.Bc(23,Rt,1,1,"bd2-simple-bio-desc-view",6),l.Bc(24,Wt,4,1,"div",0),l.Sb(),l.Sb(),l.Tb(25,"div",7),l.Tb(26,"div",3),l.Dc(27,"Measurement details"),l.Sb(),l.Tb(28,"div",4),l.Bc(29,_t,1,2,"bd2-measurement-desc-rform",5),l.Bc(30,Gt,1,1,"bd2-measurement-desc-view",6),l.Bc(31,zt,4,1,"div",0),l.Sb(),l.Sb(),l.Bc(32,Ht,3,1,"div",1),l.Sb()),2&e){const e=l.dc();l.Bb(3),l.jc("ngIf",e.errors),l.Bb(5),l.jc("ngIf",e.activeGeneralDescForm),l.Bb(1),l.jc("ngIf",!e.activeGeneralDescForm),l.Bb(1),l.jc("ngIf",!e.activeGeneralDescForm),l.Bb(5),l.jc("ngIf",e.activeContributionDescForm),l.Bb(1),l.jc("ngIf",!e.activeContributionDescForm),l.Bb(1),l.jc("ngIf",!e.activeContributionDescForm),l.Bb(5),l.jc("ngIf",e.activeSimpleBioDescForm),l.Bb(1),l.jc("ngIf",!e.activeSimpleBioDescForm),l.Bb(1),l.jc("ngIf",!e.activeSimpleBioDescForm),l.Bb(5),l.jc("ngIf",e.activeMeasurementDescForm),l.Bb(1),l.jc("ngIf",!e.activeMeasurementDescForm),l.Bb(1),l.jc("ngIf",!e.activeMeasurementDescForm),l.Bb(1),l.jc("ngIf",e.errors)}}let Xt=(()=>{class e extends $.a{constructor(e,t){super(t),this.route=e,this.blocked=!1,this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.titlePart=" Edit",this.validator=De.INSTANCE}ngOnInit(){super.ngOnInit(),this.route.fragment.subscribe(e=>{this.requestedSection=e,this.focusOnSection(e)})}ngAfterViewInit(){this.focusOnSection(this.requestedSection)}focusOnSection(e){if(!e)return;const t=document.getElementById(e);t&&t.scrollIntoView(),"MeasurementSection"===e&&(this.activeMeasurementDescForm=!0)}saveEdits(e){this.assay&&e&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.save(this.assay).then(e=>(this.feedback.success('Experiment: "'+e.name+'" updated.'),e)).then(e=>(this.currentExperiment.push(e),e)).then(t=>{this.blocked=!1,this.hideEdits(e)}).catch(e=>{this.blocked=!1,this.feedback.error(e)}))}hideEdits(e){this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiment",this.assay.id])}updateModel(e){this._orgModel=e,this.assay=e?e.clone():null,this.setTitle()}}return e.\u0275fac=function(t){return new(t||e)(l.Nb(c.a),l.Nb(a.a))},e.\u0275cmp=l.Hb({type:e,selectors:[["ng-component"]],features:[l.Ab([]),l.yb],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"blocked","model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["id","MeasurementSection",1,"card","mb-2"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"],[3,"blocked","model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&l.Bc(0,$t,33,14,"div",0),2&e&&l.jc("ngIf",t.assay)},directives:[n.m,n.l,Ee,Q,it,ae,Bt,de,Ot,fe],encapsulation:2}),e})(),Jt=(()=>{class e{constructor(e){this.name=e}static deserialize(t){if(null==t)return null;const i=e.valuesMap.get(t);if(i)return i;const n=+t;if(n<0||n>=e.values.length||Number.isNaN(n))throw new RangeError("Uknown AssetType "+t);return e.values[n]}static initValuesMap(){const t=new Map;return e.values.forEach(e=>t.set(e.name,e)),t}equals(e){return this.name===e.name}toJSON(){return this.name}}return e.NONE=new e("NONE"),e.FILE=new e("FILE"),e.MEDIA=new e("MEDIA"),e.DATA=new e("DATA"),e.TS_DATA=new e("TS_DATA"),e.values=[e.NONE,e.FILE,e.MEDIA,e.DATA,e.TS_DATA],e.valuesMap=e.initValuesMap(),e})();class Kt{constructor(){this.assetType=Jt.NONE,this.versions=[]}get last(){return this.versions[0]}static deserialize(e){const t=new Kt;return t.id=e.id,t.originalName=e.originalName,t.url=e.url,t.assetType=Jt.deserialize(e.assetType),e.versions&&(t.versions=e.versions.map(e=>class{static deserialize(e){return e.created=Fe.a.deserialize(e.created),e}}.deserialize(e))),t}setAll(e){this.id=e.id,this.originalName=e.originalName,this.assetType=e.assetType,this.url=e.url,this.versions=e.versions}}let Yt=(()=>{class e{constructor(e){this.BD2REST=e}upload(e,t){const i=new FormData;for(let n=0;n<t.length;n++)i.append("file",t[n],t[n].name);return this.BD2REST.expFileUpload(e.id,i).then(e=>e.data)}getFiles(e){return this.BD2REST.files(e.id).then(e=>e.data).then(e=>this.json2AssetsList(e)).then(t=>this.fillURLs(t,e))}fillURLs(e,t){return e.map(e=>this.fillURL(e,t))}fillURL(e,t){const i=this.BD2REST.fileURL(t.id,e.id);return e.url=i,e.versions.forEach(e=>{e.url=i+"/"+e.versionId}),e}json2AssetsList(e){return e.map(e=>Kt.deserialize(e))}}return e.\u0275fac=function(t){return new(t||e)(l.Xb(ft.a))},e.\u0275prov=l.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Qt=i("vLYz");function ei(e,t){if(1&e&&(l.Tb(0,"div"),l.Dc(1),l.Sb()),2&e){const e=l.dc(2);l.Bb(1),l.Ec(e.file.last.description)}}function ti(e,t){if(1&e){const e=l.Ub();l.Tb(0,"li"),l.Dc(1),l.ec(2,"date"),l.Tb(3,"strong"),l.Tb(4,"a",4),l.Zb("click",(function(){return l.sc(e),l.dc(3).recordDownload()})),l.Dc(5),l.Sb(),l.Sb(),l.Ob(6,"br"),l.Dc(7),l.Sb()}if(2&e){const e=t.$implicit;l.Bb(1),l.Gc(" Version ",e.versionId,". ",l.gc(2,6,e.created.date,"shortDate")," "),l.Bb(3),l.kc("href",e.url,l.uc),l.kc("download",e.originalName),l.Bb(1),l.Ec(e.originalName),l.Bb(2),l.Fc("",e.description," ")}}function ii(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"ul",5),l.Bc(2,ti,8,9,"li",6),l.Sb(),l.Sb()),2&e){const e=l.dc(2);l.Bb(2),l.jc("ngForOf",e.file.versions)}}function ni(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Tb(1,"div",1),l.Dc(2),l.Tb(3,"a",2),l.Zb("click",(function(){l.sc(e);const t=l.dc();return t.showVersions=!t.showVersions})),l.Tb(4,"i",3),l.Dc(5,"expand_more"),l.Sb(),l.Sb(),l.Sb(),l.Tb(6,"h5"),l.Tb(7,"a",4),l.Zb("click",(function(){return l.sc(e),l.dc().recordDownload()})),l.Dc(8),l.Sb(),l.Sb(),l.Bc(9,ei,2,1,"div",0),l.Bc(10,ii,3,1,"div",0),l.Sb()}if(2&e){const e=l.dc();l.Bb(2),l.Fc(" ",e.file.versions.length," versions "),l.Bb(5),l.kc("href",e.file.url,l.uc),l.kc("download",e.file.last.originalName),l.Bb(1),l.Ec(e.file.last.originalName),l.Bb(1),l.jc("ngIf",e.file.last.description),l.Bb(1),l.jc("ngIf",e.showVersions)}}let ci=(()=>{class e{constructor(e){this.analytics=e,this.canEdit=!0,this.showVersions=!1,this.edit=!1,this.model=this.fakeFileAsset()}set model(e){this.file=e}ngOnInit(){}fakeFileAsset(){const e=JSON.parse('{\n      "id" : 2,\n      "originalName" : "f2",\n      "assetType" : "TS_DATA",\n      "versions" : [ {\n        "versionId" : 2,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : "Some description",\n        "created" : [ 2016, 12, 8 ]\n      }, {\n        "versionId" : 1,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : null,\n        "created" : [ 2016, 12, 8 ]\n      } ]\n    }');return Kt.deserialize(e)}recordDownload(){this.analytics.fileDownload(this.parentId,this.file.id)}}return e.\u0275fac=function(t){return new(t||e)(l.Nb(m.a))},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-file-asset-view"]],inputs:{canEdit:"canEdit",parentId:"parentId",model:"model"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"float-right"],["role","button","aria-label","expand",3,"click"],[1,"material-icons","bd-icon"],[3,"href","download","click"],[1,"list-unstyled"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&l.Bc(0,ni,11,6,"div",0),2&e&&l.jc("ngIf",t.file&&t.file.last)},directives:[n.m,n.l],pipes:[n.e],encapsulation:2}),e})();const si=["uploadWidget"];function oi(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Tb(1,"bd2-file-upload-widget",2,3),l.Zb("uploadFiles",(function(t){return l.sc(e),l.dc(2).upload(t)})),l.Sb(),l.Ob(3,"hr"),l.Sb()}if(2&e){const e=l.dc(2);l.Bb(1),l.jc("autoReset",!1)("blocked",e.blocked)}}function ri(e,t){if(1&e&&l.Ob(0,"bd2-file-asset-view",5),2&e){const e=t.$implicit,i=l.dc(3);l.jc("model",e)("parentId",i.assay.id)}}function ai(e,t){1&e&&(l.Tb(0,"div",6),l.Dc(1,' Use "Replace data" to change timeseries files. '),l.Sb())}function li(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"h4"),l.Dc(2,"Timeseries files"),l.Sb(),l.Bc(3,ri,1,2,"bd2-file-asset-view",4),l.Bc(4,ai,2,0,"div",1),l.Ob(5,"hr"),l.Sb()),2&e){const e=l.dc(2);l.Bb(3),l.jc("ngForOf",e.tsData),l.Bb(1),l.jc("ngIf",e.assay.security.canWrite)}}function di(e,t){1&e&&(l.Tb(0,"div",6),l.Dc(1,' Use "Import data" to add timeseries files. '),l.Sb())}function bi(e,t){if(1&e&&l.Ob(0,"bd2-file-asset-view",5),2&e){const e=t.$implicit,i=l.dc(3);l.jc("model",e)("parentId",i.assay.id)}}function ui(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"h4"),l.Dc(2,"Attachments"),l.Sb(),l.Bc(3,bi,1,2,"bd2-file-asset-view",4),l.Sb()),2&e){const e=l.dc(2);l.Bb(3),l.jc("ngForOf",e.attachments)}}function mi(e,t){1&e&&(l.Tb(0,"div",6),l.Dc(1," Drag and upload files using the upload area in order to update the attachments. "),l.Sb())}function hi(e,t){if(1&e&&(l.Tb(0,"div"),l.Bc(1,oi,4,2,"div",0),l.Bc(2,li,6,2,"div",0),l.Bc(3,di,2,0,"div",1),l.Bc(4,ui,4,1,"div",0),l.Bc(5,mi,2,0,"div",1),l.Sb()),2&e){const e=l.dc();l.Bb(1),l.jc("ngIf",e.assay.security.canWrite),l.Bb(1),l.jc("ngIf",e.tsData&&e.tsData.length>0),l.Bb(1),l.jc("ngIf",!e.tsData||0===e.tsData.length),l.Bb(1),l.jc("ngIf",e.attachments&&e.attachments.length>0),l.Bb(1),l.jc("ngIf",e.assay.security.canWrite)}}let fi=(()=>{class e extends $.a{constructor(e,t){super(t),this.attachmentsService=e,this.attachments=[],this.tsData=[],this.blocked=!1,this.titlePart=" Files"}updateModel(e){super.updateModel(e),this.refreshAttachments()}refreshAttachments(){this.attachmentsService.getFiles(this.assay).then(e=>this.setFiles(e)).catch(e=>{this.feedback.error(e)})}setFiles(e){this.tsData=e.filter(e=>e.assetType.equals(Jt.TS_DATA)),this.attachments=e.filter(e=>!e.assetType.equals(Jt.TS_DATA))}upload(e){console.log("Uploading "+e.length),e&&0!==e.length&&(this.blocked=!0,this.attachmentsService.upload(this.assay,e).then(e=>{this.uploadWidget.reset(),this.blocked=!1,this.feedback.success(e.length+" files uploaded")}).then(()=>this.refreshModel()).catch(e=>{this.blocked=!1,this.feedback.error(e)}))}}return e.\u0275fac=function(t){return new(t||e)(l.Nb(Yt),l.Nb(a.a))},e.\u0275cmp=l.Hb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var i;1&e&&l.Ic(si,!0),2&e&&l.pc(i=l.ac())&&(t.uploadWidget=i.first)},features:[l.yb],decls:4,vars:1,consts:[[4,"ngIf"],["type","info","class","alert alert-info","role","alert",4,"ngIf"],[3,"autoReset","blocked","uploadFiles"],["uploadWidget",""],[3,"model","parentId",4,"ngFor","ngForOf"],[3,"model","parentId"],["type","info","role","alert",1,"alert","alert-info"]],template:function(e,t){1&e&&(l.Tb(0,"h3"),l.Dc(1,"Attached files"),l.Sb(),l.Ob(2,"hr"),l.Bc(3,hi,6,5,"div",0)),2&e&&(l.Bb(3),l.jc("ngIf",t.assay))},directives:[n.m,Qt.a,n.l,ci],styles:[""]}),e})();function pi(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"div",1),l.Dc(2," Experiment is already publicly available under "),l.Tb(3,"strong"),l.Dc(4),l.Sb(),l.Dc(5," licence. "),l.Sb(),l.Sb()),2&e){const e=l.dc(2);l.Bb(4),l.Ec(e.assay.features.licence)}}function gi(e,t){if(1&e&&(l.Tb(0,"option",12),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.jc("value",e),l.Bb(1),l.Fc("",e," ")}}function vi(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Tb(1,"div",2),l.Dc(2," You are about to make the data public. Once they are public they cannot be made private again. "),l.Tb(3,"ul"),l.Tb(4,"li"),l.Dc(5,"make sure you know what you are doing"),l.Sb(),l.Tb(6,"li"),l.Dc(7,"make sure all contributors agree to public sharing"),l.Sb(),l.Tb(8,"li"),l.Dc(9,"double check the description is correct, not all changes will be possible after the publishing"),l.Sb(),l.Sb(),l.Sb(),l.Tb(10,"form",null,3),l.Tb(12,"div",4),l.Tb(13,"label",5),l.Dc(14,"Licence"),l.Sb(),l.Tb(15,"select",6,7),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc(2).licence=t})),l.Bc(17,gi,2,2,"option",8),l.Sb(),l.Sb(),l.Tb(18,"div",4),l.Tb(19,"label"),l.Tb(20,"input",9,10),l.Zb("ngModelChange",(function(t){return l.sc(e),l.dc(2).terms=t})),l.Sb(),l.Dc(22," I understand that I cannot undo this operation "),l.Sb(),l.Sb(),l.Tb(23,"button",11),l.Zb("click",(function(){return l.sc(e),l.dc(2).publish()})),l.Dc(24," Publish "),l.Sb(),l.Sb(),l.Sb()}if(2&e){const e=l.qc(11),t=l.dc(2);l.Bb(15),l.jc("ngModel",t.licence),l.Bb(2),l.jc("ngForOf",t.licences),l.Bb(3),l.jc("ngModel",t.terms),l.Bb(3),l.jc("disabled",!e.form.valid)}}function Si(e,t){if(1&e&&(l.Tb(0,"div"),l.Tb(1,"h3"),l.Dc(2,"Publish experiment"),l.Sb(),l.Bc(3,pi,6,1,"div",0),l.Bc(4,vi,25,4,"div",0),l.Sb()),2&e){const e=l.dc();l.Bb(3),l.jc("ngIf",e.assay.features.isOpenAccess),l.Bb(1),l.jc("ngIf",!e.assay.features.isOpenAccess)}}let Ti=(()=>{class e extends $.a{constructor(e){super(e),this.licences=["CC_BY"]}ngOnInit(){super.ngOnInit(),this.licence=this.licences[0]}publish(){this.terms&&this.licence&&this.experimentService.publish(this.assay,this.licence).then(e=>(this.feedback.success('Experiment: "'+e.name+'" published.'),e)).then(e=>(this.currentExperiment.push(e),e)).then(e=>{this.goToExpHome(e.id)}).catch(e=>{this.feedback.error(e)})}}return e.\u0275fac=function(t){return new(t||e)(l.Nb(a.a))},e.\u0275cmp=l.Hb({type:e,selectors:[["bd2-publish-form"]],features:[l.yb],decls:1,vars:1,consts:[[4,"ngIf"],["type","info","role","alert",1,"alert","alert-info"],["type","danger","role","alert",1,"alert","alert-danger"],["publishForm","ngForm"],[1,"form-group"],["for","licence"],["id","licence","required","","placeholder","Select licence","name","licence",1,"form-control",3,"ngModel","ngModelChange"],["licenceF","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","checkbox","required","","id","terms","name","fTerms",3,"ngModel","ngModelChange"],["fTerms","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[3,"value"]],template:function(e,t){1&e&&l.Bc(0,Si,5,2,"div",0),2&e&&l.jc("ngIf",t.assay)},directives:[n.m,Ie.D,Ie.r,Ie.s,Ie.A,Ie.z,Ie.q,Ie.t,n.l,Ie.b,Ie.a,Ie.u,Ie.C],encapsulation:2}),e})();function Di(e,t){1&e&&(l.Tb(0,"div"),l.Tb(1,"h4"),l.Dc(2,"You don't have permission to create experiment"),l.Sb(),l.Tb(3,"p"),l.Dc(4,"Try to login"),l.Sb(),l.Sb())}function Bi(e,t){if(1&e){const e=l.Ub();l.Tb(0,"bd2-general-desc-form",9),l.Zb("onAccepted",(function(t){return l.sc(e),l.dc(2).hideEdits(t)}))("onCancelled",(function(t){return l.sc(e),l.dc(2).hideEdits(t)})),l.Sb()}if(2&e){const e=l.dc(2);l.jc("model",e.assay.generalDesc)}}function yi(e,t){if(1&e&&l.Ob(0,"bd2-general-desc-view",10),2&e){const e=l.dc(2);l.jc("model",e.assay.generalDesc)}}function wi(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"button",11),l.Zb("click",(function(){return l.sc(e),l.dc(2).activeGeneralDescForm=!0})),l.Dc(3,"Modify "),l.Sb(),l.Sb()}if(2&e){const e=l.dc(2);l.Bb(2),l.jc("disabled",e.activeGeneralDescForm)}}function ki(e,t){if(1&e){const e=l.Ub();l.Tb(0,"bd2-simple-bio-desc-form",9),l.Zb("onAccepted",(function(t){return l.sc(e),l.dc(2).hideEdits(t)}))("onCancelled",(function(t){return l.sc(e),l.dc(2).hideEdits(t)})),l.Sb()}if(2&e){const e=l.dc(2);l.jc("model",e.assay)}}function ji(e,t){if(1&e&&l.Ob(0,"bd2-simple-bio-desc-view",10),2&e){const e=l.dc(2);l.jc("model",e.assay)}}function Fi(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"button",11),l.Zb("click",(function(){return l.sc(e),l.dc(2).activeSimpleBioDescForm=!0})),l.Dc(3,"Modify "),l.Sb(),l.Sb()}if(2&e){const e=l.dc(2);l.Bb(2),l.jc("disabled",e.activeSimpleBioDescForm)}}function Ii(e,t){if(1&e){const e=l.Ub();l.Tb(0,"bd2-contr-desc-form",9),l.Zb("onAccepted",(function(t){return l.sc(e),l.dc(2).hideEdits(t)}))("onCancelled",(function(t){return l.sc(e),l.dc(2).hideEdits(t)})),l.Sb()}if(2&e){const e=l.dc(2);l.jc("model",e.assay.contributionDesc)}}function xi(e,t){if(1&e&&l.Ob(0,"bd2-contr-desc-view",10),2&e){const e=l.dc(2);l.jc("model",e.assay.contributionDesc)}}function Mi(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"button",11),l.Zb("click",(function(){return l.sc(e),l.dc(2).activeContributionDescForm=!0})),l.Dc(3,"Modify "),l.Sb(),l.Sb()}if(2&e){const e=l.dc(2);l.Bb(2),l.jc("disabled",e.activeContributionDescForm)}}function Oi(e,t){if(1&e){const e=l.Ub();l.Tb(0,"bd2-measurement-desc-rform",9),l.Zb("onAccepted",(function(t){return l.sc(e),l.dc(2).hideEdits(t)}))("onCancelled",(function(t){return l.sc(e),l.dc(2).hideEdits(t)})),l.Sb()}if(2&e){const e=l.dc(2);l.jc("model",e.assay.experimentalDetails.measurementDesc)}}function Ci(e,t){if(1&e&&l.Ob(0,"bd2-measurement-desc-view",10),2&e){const e=l.dc(2);l.jc("model",e.assay.experimentalDetails.measurementDesc)}}function Ei(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Ob(1,"hr"),l.Tb(2,"button",11),l.Zb("click",(function(){return l.sc(e),l.dc(2).activeMeasurementDescForm=!0})),l.Dc(3,"Modify "),l.Sb(),l.Sb()}if(2&e){const e=l.dc(2);l.Bb(2),l.jc("disabled",e.activeMeasurementDescForm)}}function Ai(e,t){if(1&e&&(l.Tb(0,"li"),l.Dc(1),l.Sb()),2&e){const e=t.$implicit;l.Bb(1),l.Ec(e)}}function qi(e,t){if(1&e&&(l.Tb(0,"div",12),l.Tb(1,"ul"),l.Bc(2,Ai,2,1,"li",13),l.Sb(),l.Sb()),2&e){const e=l.dc(2);l.Bb(2),l.jc("ngForOf",e.errors)}}function Ni(e,t){if(1&e){const e=l.Ub();l.Tb(0,"div"),l.Tb(1,"h3"),l.Dc(2,"Create experiment"),l.Sb(),l.Tb(3,"div",1),l.Tb(4,"div",2),l.Dc(5,"General description"),l.Sb(),l.Tb(6,"div",3),l.Bc(7,Bi,1,1,"bd2-general-desc-form",4),l.Bc(8,yi,1,1,"bd2-general-desc-view",5),l.Bc(9,wi,4,1,"div",0),l.Sb(),l.Sb(),l.Tb(10,"div",1),l.Tb(11,"div",2),l.Dc(12,"Biological details"),l.Sb(),l.Tb(13,"div",3),l.Bc(14,ki,1,1,"bd2-simple-bio-desc-form",4),l.Bc(15,ji,1,1,"bd2-simple-bio-desc-view",5),l.Bc(16,Fi,4,1,"div",0),l.Sb(),l.Sb(),l.Tb(17,"div",1),l.Tb(18,"div",2),l.Dc(19,"Contributions"),l.Sb(),l.Tb(20,"div",3),l.Bc(21,Ii,1,1,"bd2-contr-desc-form",4),l.Bc(22,xi,1,1,"bd2-contr-desc-view",5),l.Bc(23,Mi,4,1,"div",0),l.Sb(),l.Sb(),l.Tb(24,"div",1),l.Tb(25,"div",2),l.Dc(26,"Measurement details"),l.Sb(),l.Tb(27,"div",3),l.Bc(28,Oi,1,1,"bd2-measurement-desc-rform",4),l.Bc(29,Ci,1,1,"bd2-measurement-desc-view",5),l.Bc(30,Ei,4,1,"div",0),l.Sb(),l.Sb(),l.Bc(31,qi,3,1,"div",6),l.Tb(32,"button",7),l.Zb("click",(function(){return l.sc(e),l.dc().save()})),l.Dc(33,"Create"),l.Sb(),l.Tb(34,"button",8),l.Zb("click",(function(){return l.sc(e),l.dc().cancel()})),l.Dc(35,"Cancel"),l.Sb(),l.Sb()}if(2&e){const e=l.dc();l.Bb(7),l.jc("ngIf",e.activeGeneralDescForm),l.Bb(1),l.jc("ngIf",!e.activeGeneralDescForm),l.Bb(1),l.jc("ngIf",!e.activeGeneralDescForm),l.Bb(5),l.jc("ngIf",e.activeSimpleBioDescForm),l.Bb(1),l.jc("ngIf",!e.activeSimpleBioDescForm),l.Bb(1),l.jc("ngIf",!e.activeSimpleBioDescForm),l.Bb(5),l.jc("ngIf",e.activeContributionDescForm),l.Bb(1),l.jc("ngIf",!e.activeContributionDescForm),l.Bb(1),l.jc("ngIf",!e.activeContributionDescForm),l.Bb(5),l.jc("ngIf",e.activeMeasurementDescForm),l.Bb(1),l.jc("ngIf",!e.activeMeasurementDescForm),l.Bb(1),l.jc("ngIf",!e.activeMeasurementDescForm),l.Bb(1),l.jc("ngIf",e.errors),l.Bb(1),l.jc("disabled",e.blocked||e.errors)}}const Li=[{path:"new",pathMatch:"full",component:(()=>{class e extends Be.a{constructor(e,t,i,n){super(De.INSTANCE),this.experimentService=e,this.RDMSocial=t,this.feedback=i,this.router=n,this.isUnauthorised=!1,this.blocked=!1,this.activeGeneralDescForm=!0,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!0,this.activeMeasurementDescForm=!1}ngOnInit(){this.experimentService.newDraft().then(e=>{this.assay=e}).catch(e=>{this.isUnauthorised=e.isUnauthorised,this.feedback.error(e)})}hideEdits(e){this.activeGeneralDescForm=!this.assay.generalDesc.name,this.activeSimpleBioDescForm=!this.assay.species||!this.assay.dataCategory,this.activeContributionDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiments"])}save(){this.assay&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.newExperiment(this.assay).then(e=>(this.feedback.success('Experiment: "'+e.name+'" created.'),e)).then(e=>this.router.navigate(["/experiment",e.id])).catch(e=>{this.blocked=!1,this.feedback.error(e)}))}getModel(){return this.assay}}return e.\u0275fac=function(t){return new(t||e)(l.Nb(d.a),l.Nb(b.a),l.Nb(u.a),l.Nb(c.c))},e.\u0275cmp=l.Hb({type:e,selectors:[["ng-component"]],features:[l.yb],decls:2,vars:2,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],["okLabel","Accept",3,"model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["okLabel","Accept",3,"model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(l.Bc(0,Di,5,0,"div",0),l.Bc(1,Ni,36,14,"div",0)),2&e&&(l.jc("ngIf",t.isUnauthorised),l.Bb(1),l.jc("ngIf",t.assay))},directives:[n.m,Ee,Q,Bt,de,it,ae,Ot,fe,n.l],encapsulation:2}),e})()},{path:":id",component:H,children:[{path:"",pathMatch:"full",component:ge},{path:"edit",component:Xt},{path:"file",component:fi},{path:"publish",component:Ti},{path:"data",loadChildren:()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(14)]).then(i.bind(null,"d9Wp")).then(e=>e.TsDataModule)},{path:"ppa",loadChildren:()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(6),i.e(0),i.e(12)]).then(i.bind(null,"eJgY")).then(e=>e.PPAModule)},{path:"rhythmicity",loadChildren:()=>Promise.all([i.e(2),i.e(3),i.e(4),i.e(0),i.e(17)]).then(i.bind(null,"ja10")).then(e=>e.RhythmicityModule)}]}];let Pi=(()=>{class e{}return e.\u0275mod=l.Lb({type:e}),e.\u0275inj=l.Kb({factory:function(t){return new(t||e)},imports:[[c.f.forChild(Li)],c.f]}),e})();var Ui=i("DkMi"),Zi=i("YiFe");let Ri=(()=>{class e{}return e.\u0275mod=l.Lb({type:e}),e.\u0275inj=l.Kb({factory:function(t){return new(t||e)},providers:[],imports:[[n.c,Zi.a]]}),e})(),Wi=(()=>{class e{}return e.\u0275mod=l.Lb({type:e}),e.\u0275inj=l.Kb({factory:function(t){return new(t||e)},providers:[],imports:[[n.c,Ie.k]]}),e})(),_i=(()=>{class e{}return e.\u0275mod=l.Lb({type:e}),e.\u0275inj=l.Kb({factory:function(t){return new(t||e)},imports:[[n.c,Ui.a,Ri,Wi,Pi]]}),e})()},"qnP+":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("2Vo4"),c=i("fXoL");let s=1,o=(()=>{class e{constructor(){this.experimentStream=new n.a(null),this.id=s++}close(){this.experimentStream.complete()}experiment(){return this.experimentStream}push(e){this.experimentStream.next(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=c.Jb({token:e,factory:e.\u0275fac}),e})()},vLYz:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var n=i("fXoL"),c=i("BOp5"),s=i("ofXK");const o=["inputFieldM"];function r(e,t){if(1&e){const e=n.Ub();n.Tb(0,"div",11),n.Dc(1),n.Tb(2,"button",12),n.Zb("click",(function(){n.sc(e);const i=t.$implicit;return n.dc(2).remove(i)})),n.Tb(3,"span",13),n.Dc(4,"\xd7"),n.Sb(),n.Sb(),n.Sb()}if(2&e){const e=t.$implicit;n.Bb(1),n.Fc(" ",e.name," ")}}function a(e,t){if(1&e&&(n.Tb(0,"div",8),n.Tb(1,"div",9),n.Tb(2,"label"),n.Dc(3,"Files:"),n.Sb(),n.Sb(),n.Bc(4,r,5,1,"div",10),n.Sb()),2&e){const e=n.dc();n.Bb(4),n.jc("ngForOf",e.files)}}function l(e,t){if(1&e){const e=n.Ub();n.Tb(0,"input",14,15),n.Zb("change",(function(t){return n.sc(e),n.dc().handleFileSelect(t)})),n.Sb()}}function d(e,t){if(1&e){const e=n.Ub();n.Tb(0,"input",16,15),n.Zb("change",(function(t){return n.sc(e),n.dc().handleFileSelect(t)})),n.Sb()}}function b(e,t){if(1&e&&(n.Tb(0,"div",17),n.Dc(1),n.Sb()),2&e){const e=n.dc();n.Bb(1),n.Fc(" Maximum upload size is ",e.sizeLimit,"MB ")}}let u=(()=>{class e{constructor(){this.activeColor="green",this.baseColor="#ccc",this.overlayColor="rgba(255,255,255,0.5)",this.blocked=!1,this.multiple=!0,this.noDuplicates=!0,this.autoReset=!1,this.sizeLimit=50,this.uploadFiles=new n.o,this.selectedFiles=new n.o,this.dragging=!1,this.loaded=!1,this.sizeError=!1,this.files=[]}ngOnInit(){}reset(){this.files=[],this.inputField&&this.inputField.nativeElement&&(this.inputField.nativeElement.value="")}handleDragEnter(){this.dragging=!0}handleDragLeave(){this.dragging=!1}handleDrop(e){e.preventDefault(),this.dragging=!1,e.dataTransfer&&this.handleFileChange(e.dataTransfer.files)}handleFileSelect(e){e.target&&this.handleFileChange(e.target.files)}handleFileChange(e){const t=this.multiple?e.length:Math.min(1,e.length);this.multiple||(this.files=[]);for(let i=0;i<t;i++){const t=e[i];this.noDuplicates&&this.removeDuplicate(t),this.files.push(t)}this.checkSize(),this.selectedFiles.next(this.files)}remove(e){Object(c.b)(e,this.files),this.checkSize()}removeDuplicate(e){const t=this.files.find(t=>t.name===e.name);this.remove(t)}checkSize(){let e=0;this.files.map(e=>e.size).forEach(t=>e+=t),e/=1048576,this.sizeError=e>this.sizeLimit}upload(){this.uploadFiles.next(this.files),this.autoReset&&this.reset()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-file-upload-widget"]],viewQuery:function(e,t){var i;1&e&&n.Ic(o,!0),2&e&&n.pc(i=n.ac())&&(t.inputField=i.first)},inputs:{activeColor:"activeColor",baseColor:"baseColor",overlayColor:"overlayColor",blocked:"blocked",multiple:"multiple",noDuplicates:"noDuplicates",autoReset:"autoReset",sizeLimit:"sizeLimit"},outputs:{uploadFiles:"uploadFiles",selectedFiles:"selectedFiles"},decls:13,vars:9,consts:[["class","clearfix","style","margin-bottom: 1em;",4,"ngIf"],[2,"margin-bottom","1em"],["ondragover","return false;",1,"uploader-zone",3,"dragenter","dragleave","drop"],[1,"material-icons","bd-icon","bd-primary",2,"font-size","400%"],["multiple","","name","inputField","type","file",3,"change",4,"ngIf"],["name","inputField","type","file",3,"change",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"clearfix",2,"margin-bottom","1em"],[1,""],["class","float-left fileitem",4,"ngFor","ngForOf"],[1,"float-left","fileitem"],["aria-label","Close","type","button",1,"close",2,"margin-left","0.5em",3,"click"],["aria-hidden","true"],["multiple","","name","inputField","type","file",3,"change"],["inputField",""],["name","inputField","type","file",3,"change"],[1,"alert","alert-danger"]],template:function(e,t){1&e&&(n.Tb(0,"div"),n.Bc(1,a,5,1,"div",0),n.Tb(2,"div",1),n.Tb(3,"label",2),n.Zb("dragenter",(function(){return t.handleDragEnter()}))("dragleave",(function(){return t.handleDragLeave()}))("drop",(function(e){return t.handleDrop(e)})),n.Tb(4,"i",3),n.Dc(5,"cloud_upload"),n.Sb(),n.Tb(6,"p"),n.Dc(7," Drag file(s) or click to select"),n.Sb(),n.Bc(8,l,2,0,"input",4),n.Bc(9,d,2,0,"input",5),n.Sb(),n.Sb(),n.Bc(10,b,2,1,"div",6),n.Tb(11,"button",7),n.Zb("click",(function(){return t.upload()})),n.Dc(12,"Upload selected "),n.Sb(),n.Sb()),2&e&&(n.Bb(1),n.jc("ngIf",t.files.length>0),n.Bb(2),n.yc("outline-color",t.dragging?t.activeColor:t.baseColor),n.Fb("loaded",t.loaded),n.Bb(5),n.jc("ngIf",t.multiple),n.Bb(1),n.jc("ngIf",!t.multiple),n.Bb(1),n.jc("ngIf",t.sizeError),n.Bb(1),n.jc("disabled",t.blocked||t.files.length<1||t.sizeError))},directives:[s.m,s.l],styles:[".uploader-zone[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.uploader-zone[_ngcontent-%COMP%]{font-weight:400;align-items:center;background-color:#efefef;background-color:rgba(0,0,0,.02);cursor:pointer;display:flex;height:100px;justify-content:center;outline:3px dashed #ccc}div.fileitem[_ngcontent-%COMP%]{margin:2px;padding:2px;border:1px solid #efefef;border-radius:4px}"]}),e})()},vejM:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("fXoL"),c=i("UsWK");let s=(()=>{class e{constructor(e){this.BD2REST=e,this.visited=new Set,console.log("RDMSocialServiceService created")}getAssayGuiAspects(e){return this.BD2REST.rdmAssayGuiAspects(e.id).then(t=>(this.visited.add(e.id),t))}shouldShowMeasurementWarning(e){return e.security.isOwner?this.visited.has(e.id)?Promise.resolve(!1):this.getAssayGuiAspects(e).then(e=>e.showMeasurementWarning):Promise.resolve(!1)}registerNewAssay(e){this.visited.add(e.id)}registerMeasurementWarning(e){this.BD2REST.rdmRegisterWarning(e.id,"MEASUREMENT").then(e=>!0)}canProceedByMeasurement(e){return e.security.isOwner?this.getAssayGuiAspects(e).then(e=>e.canProceedByMeasurement):Promise.resolve(!0)}}return e.\u0275fac=function(t){return new(t||e)(n.Xb(c.a))},e.\u0275prov=n.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},yYXI:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("TPWj"),c=i("pLZG"),s=i("fXoL"),o=i("GVyA");let r=(()=>{class e extends n.a{constructor(e){super(),this.serviceDependencies=e,this.experimentService=e.experimentService,this.currentExperiment=e.currentExperiment,this.feedback=e.feedback,this.router=e.router,this.titleSetter=e.titleSetter,this.titlePart=""}ngOnInit(){this.subscribeToExperiment()}ngOnDestroy(){this.unsubscribeFromExperiment()}getModel(){return this.assay}updateModel(e){this.assay=e,this.setTitle()}setTitle(){this.titleSetter.setTitle("Exp "+this.assay.id+this.titlePart)}subscribeToExperiment(){this.expSubscription=this.currentExperiment.experiment().pipe(Object(c.a)(e=>!!e)).subscribe(e=>{this.updateModel(e)},e=>this.feedback.error(e),()=>console.log(this.constructor.name+" expSubscription completed"))}refreshModel(){return this.experimentService.getExperiment(this.assay.id).then(e=>(this.currentExperiment.push(e),e))}unsubscribeFromExperiment(){this.expSubscription&&this.expSubscription.unsubscribe()}expHomePath(e){return["/experiment",e=e||this.assay.id]}goToExpHome(e){this.router.navigate(this.expHomePath(e))}goToExpEdit(e,t){const i=this.expHomePath(e);i.push("edit"),t?this.router.navigate(i,{fragment:t}):this.router.navigate(i)}}return e.\u0275fac=function(t){return new(t||e)(s.Nb(o.a))},e.\u0275dir=s.Ib({type:e,features:[s.yb]}),e})()}}]);