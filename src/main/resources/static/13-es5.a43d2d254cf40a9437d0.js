function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var o=_superPropBase(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var r,o=_getPrototypeOf(t);if(e){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"117B":function(t,e,r){"use strict";r.d(e,"a",(function(){return d}));var o=r("fXoL"),n=r("3Pt+"),a=r("BOp5"),i=r("B9cw"),s=r("QBpm"),c=r("QibW"),l=r("1jcm"),u=r("ofXK");function b(t,e){if(1&t&&(o.Wb(0,"option",20),o.Gc(1),o.jc(2,"date"),o.Vb()),2&t){var r=e.$implicit,n=o.ic();o.oc("value",r.jobId),o.Cb(1),o.Kc(" ",r.method,": ",n.shortUUID(r.jobId)," (",o.kc(2,4,n.toLocalDateTime(r.submitted)),") ")}}function p(t,e){if(1&t&&(o.Wb(0,"option",20),o.Gc(1),o.jc(2,"date"),o.Vb()),2&t){var r=e.$implicit,n=o.ic();o.oc("value",r.jobId),o.Cb(1),o.Kc(" ",n.friendlyRhythmMethod(r.parameters.METHOD),": ",n.shortUUID(r.jobId)," (",o.kc(2,4,n.toLocalDateTime(r.jobStatus.submitted)),") ")}}var d=function(){var t=function(){function t(e,r){_classCallCheck(this,t),this.fb=e,this.fetcher=r,this.sorting=new o.o,this.noPPA=!0,this.noRhythm=!0,this._rhythmJobs=[],this._ppaJobs=[],this.sortParamsForm=this.buildSortParamsForm(e),this.mainForm=this.buildMainForm(this.sortParamsForm,e),this.ppaJobs=[],this.rhythmJobs=[]}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.valuesSubscription=this.mainForm.valueChanges.subscribe((function(e){var r=e;r.direction=e.isAscending?"asc":"desc",t.sorting.next(r),t.fetcher&&t.fetcher.sort(r)}))}},{key:"ngOnDestroy",value:function(){this.valuesSubscription&&this.valuesSubscription.unsubscribe(),this.sorting&&this.sorting.complete()}},{key:"buildSortParamsForm",value:function(t){return t.group({active:[this.defaultSorting(),[n.A.required]],isAscending:[!0,[n.A.required]],ppaJobId:[],rhythmJobId:[]})}},{key:"buildMainForm",value:function(t,e){return t}},{key:"defaultSorting",value:function(){return"NR"}},{key:"shortUUID",value:function(t){return Object(a.c)(t)}},{key:"toLocalDateTime",value:function(t){return i.b.deserialize(t).date}},{key:"friendlyRhythmMethod",value:function(t){return"BD2JTK"===t?"JTK":"BD2EJTK"===t?"eJTK":t}},{key:"rhythmJobs",set:function(t){this._rhythmJobs=t,this.noRhythm=!t||t.length<1,this.sortParamsForm.get("rhythmJobId").setValue(this.noRhythm?void 0:t[0].jobId)},get:function(){return this._rhythmJobs}},{key:"ppaJobs",set:function(t){this._ppaJobs=t,this.noPPA=!t||t.length<1,this.sortParamsForm.get("ppaJobId").setValue(this.noPPA?void 0:t[0].jobId)},get:function(){return this._ppaJobs}}]),t}();return t.\u0275fac=function(e){return new(e||t)(o.Qb(n.d),o.Qb(s.a,8))},t.\u0275cmp=o.Kb({type:t,selectors:[["bd2-tssort-params-rform"]],inputs:{rhythmJobs:"rhythmJobs",ppaJobs:"ppaJobs"},outputs:{sorting:"sorting"},decls:42,vars:10,consts:[[1,"container"],["role","form",3,"formGroup"],["aria-label","Sorting options","formControlName","active"],[1,"row","mb-1"],[1,"col-lg-2"],[1,"col-lg-4"],["formControlName","isAscending"],[1,"col-lg-5"],["value","NR"],["value","LABEL"],["id","ppa","aria-label","Select period analysis","formControlName","ppaJobId",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["value","PERIOD",3,"disabled"],["value","PHASE",3,"disabled"],["value","AMP",3,"disabled"],["value","ERR",3,"disabled"],["id","rhythm","aria-label","Select rhythmicity test","formControlName","rhythmJobId",1,"form-control"],["value","R_TAU",3,"disabled"],["value","R_PEAK",3,"disabled"],["value","R_PERIOD",3,"disabled"],[3,"value"]],template:function(t,e){1&t&&(o.Wb(0,"div",0),o.Wb(1,"form",1),o.Wb(2,"mat-radio-group",2),o.Wb(3,"div",3),o.Wb(4,"label",4),o.Gc(5,"Sort"),o.Vb(),o.Wb(6,"div",5),o.Wb(7,"mat-slide-toggle",6),o.Gc(8,"asc."),o.Vb(),o.Vb(),o.Wb(9,"div",7),o.Wb(10,"mat-radio-button",8),o.Gc(11,"nr."),o.Vb(),o.Wb(12,"mat-radio-button",9),o.Gc(13,"label"),o.Vb(),o.Vb(),o.Vb(),o.Wb(14,"div",3),o.Wb(15,"label",4),o.Gc(16,"PPA Analysis"),o.Vb(),o.Wb(17,"div",5),o.Wb(18,"select",10),o.Ec(19,b,3,6,"option",11),o.Vb(),o.Vb(),o.Wb(20,"div",7),o.Wb(21,"mat-radio-button",12),o.Gc(22,"period"),o.Vb(),o.Wb(23,"mat-radio-button",13),o.Gc(24,"phase"),o.Vb(),o.Wb(25,"mat-radio-button",14),o.Gc(26,"amp."),o.Vb(),o.Wb(27,"mat-radio-button",15),o.Gc(28,"err"),o.Vb(),o.Vb(),o.Vb(),o.Wb(29,"div",3),o.Wb(30,"label",4),o.Gc(31,"Rhythmicity Test"),o.Vb(),o.Wb(32,"div",5),o.Wb(33,"select",16),o.Ec(34,p,3,6,"option",11),o.Vb(),o.Vb(),o.Wb(35,"div",7),o.Wb(36,"mat-radio-button",17),o.Gc(37,"signif."),o.Vb(),o.Wb(38,"mat-radio-button",18),o.Gc(39,"peak"),o.Vb(),o.Wb(40,"mat-radio-button",19),o.Gc(41,"length"),o.Vb(),o.Vb(),o.Vb(),o.Vb(),o.Vb(),o.Vb()),2&t&&(o.Cb(1),o.oc("formGroup",e.mainForm),o.Cb(18),o.oc("ngForOf",e.ppaJobs),o.Cb(2),o.oc("disabled",e.noPPA),o.Cb(2),o.oc("disabled",e.noPPA),o.Cb(2),o.oc("disabled",e.noPPA),o.Cb(2),o.oc("disabled",e.noPPA),o.Cb(7),o.oc("ngForOf",e.rhythmJobs),o.Cb(2),o.oc("disabled",e.noRhythm),o.Cb(2),o.oc("disabled",e.noRhythm),o.Cb(2),o.oc("disabled",e.noRhythm))},directives:[n.C,n.q,n.h,c.b,n.p,n.g,l.a,c.a,n.z,u.l,n.t,n.B],pipes:[u.e],styles:["mat-radio-button[_ngcontent-%COMP%] {\n        margin-right: 0.5em;\n      }"]}),t}()},K5d1:function(t,e,r){"use strict";r.d(e,"a",(function(){return u}));var o=r("XNiG"),n=r("2Vo4"),a=r("PkFh"),i=r("7jps"),s=r("fXoL"),c=r("ETLL"),l=r("FjDX"),u=function(){var t=function(){function t(e,r){_classCallCheck(this,t),this.ppa=e,this.rhythmicity=r,this.error$=new o.a,this.allowedPPAMethods=void 0,this.allowedRhythmMethods=void 0,this.ppaJobs=new n.a([]),this.rhythmJobs=new n.a([]),this.ppaJobs$=this.ppaJobs.asObservable(),this.rhythmJobs$=this.rhythmJobs.asObservable()}return _createClass(t,[{key:"ngOnDestroy",value:function(){this.ppaJobs.complete(),this.rhythmJobs.complete()}},{key:"experiment",value:function(t){this.fetchPPA(t),this.fetchRhythm(t)}},{key:"fetchPPA",value:function(t){var e=this;this.ppa.getPPAJobs(t).subscribe((function(t){t=t.filter((function(t){return a.c.isFinished(t)})),e.allowedPPAMethods&&(t=t.filter((function(t){return e.allowedPPAMethods.includes(t.method)}))),e.ppaJobs.next(t)}),(function(t){e.error$.next(t),e.ppaJobs.next([])}))}},{key:"fetchRhythm",value:function(t){var e=this;this.rhythmicity.getJobs(t).subscribe((function(t){t=t.filter((function(t){return i.e.isFinished(t)})),e.allowedRhythmMethods&&(t=t.filter((function(t){return e.allowedRhythmMethods.includes(t.parameters.METHOD)}))),e.rhythmJobs.next(t)}),(function(t){e.error$.next(t),e.rhythmJobs.next([])}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.ac(c.a),s.ac(l.a))},t.\u0275prov=s.Mb({token:t,factory:t.\u0275fac}),t}()},d9Wp:function(t,e,r){"use strict";r.r(e),r.d(e,"TsDataModule",(function(){return N}));var o=r("ofXK"),n=r("tyNb"),a=r("yYXI"),i=r("bngM"),s=r("QBpm"),c=r("e8YO"),l=r("Kj3r"),u=r("Iab2"),b=r("K5d1"),p=r("fXoL"),d=r("vejM"),h=r("ZMwR"),f=r("GVyA"),m=r("wcxA"),y=r("3Pt+"),g=r("1jcm"),v=r("M9IT");function P(t,e){if(1&t&&(p.Wb(0,"option",28),p.Gc(1),p.Vb()),2&t){var r=e.$implicit;p.oc("value",r.name),p.Cb(1),p.Hc(r.label)}}function V(t,e){if(1&t&&(p.Wb(0,"option",28),p.Gc(1),p.Vb()),2&t){var r=e.$implicit;p.oc("value",r.name),p.Cb(1),p.Hc(r.label)}}function C(t,e){if(1&t&&(p.Wb(0,"option",28),p.Gc(1),p.Vb()),2&t){var r=e.$implicit;p.oc("value",r.name),p.Cb(1),p.Hc(r.label)}}var k,W=function(){return[10,25,50,100,200]},w=((k=function(t){_inherits(r,t);var e=_createSuper(r);function r(t){return _classCallCheck(this,r),e.call(this,t)}return r}(m.a)).\u0275fac=function(t){return new(t||k)(p.Qb(y.d))},k.\u0275cmp=p.Kb({type:k,selectors:[["bd2-tsdisplay-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},features:[p.zb],decls:47,vars:10,consts:[["role","form",1,"form-horizontal","container",3,"formGroup"],[1,"row"],[1,"col-md-8","col-sm-10"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-md-3","col-sm-3"],["for","timeStart",1,"col-md-1","col-sm-2"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-md-1","col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"col-md-2","col-sm-4"],["formControlName","hourly",1,"mr-3"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-3"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-1"],["for","align",1,"col-sm-1"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-2"],["for","normalisation"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],[1,"col-sm"],["formControlName","trimFirst",1,"mr-3"],["formControlName","log2"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],[3,"value"]],template:function(t,e){1&t&&(p.Wb(0,"form",0),p.Wb(1,"div",1),p.Wb(2,"div",2),p.Wb(3,"div",3),p.Wb(4,"label",4),p.Gc(5,"Time range"),p.Vb(),p.Wb(6,"label",5),p.Gc(7,"from:"),p.Vb(),p.Wb(8,"div",4),p.Rb(9,"input",6),p.Vb(),p.Wb(10,"label",7),p.Gc(11,"to:"),p.Vb(),p.Wb(12,"div",4),p.Rb(13,"input",8),p.Vb(),p.Vb(),p.Vb(),p.Wb(14,"div",9),p.Wb(15,"mat-slide-toggle",10),p.Gc(16,"hourly"),p.Vb(),p.Vb(),p.Vb(),p.Wb(17,"div",11),p.Wb(18,"label",12),p.Gc(19,"Detrending"),p.Vb(),p.Wb(20,"div",13),p.Wb(21,"select",14),p.Ec(22,P,2,2,"option",15),p.Vb(),p.Vb(),p.Rb(23,"div",16),p.Wb(24,"label",17),p.Gc(25,"Align"),p.Vb(),p.Wb(26,"div",13),p.Wb(27,"select",18),p.Ec(28,V,2,2,"option",15),p.Vb(),p.Vb(),p.Vb(),p.Wb(29,"div",11),p.Wb(30,"div",19),p.Wb(31,"label",20),p.Gc(32,"Normalize"),p.Vb(),p.Vb(),p.Wb(33,"div",13),p.Wb(34,"select",21),p.Ec(35,C,2,2,"option",15),p.Vb(),p.Vb(),p.Wb(36,"div",22),p.Wb(37,"mat-slide-toggle",23),p.Gc(38,"within range"),p.Vb(),p.Wb(39,"mat-slide-toggle",24),p.Gc(40,"log2 transf."),p.Vb(),p.Vb(),p.Vb(),p.Rb(41,"div",11),p.Wb(42,"div",11),p.Rb(43,"label",19),p.Wb(44,"div",25),p.Wb(45,"mat-paginator",26,27),p.ec("page",(function(t){return e.loadDataPage(t)})),p.Vb(),p.Vb(),p.Vb(),p.Vb()),2&t&&(p.oc("formGroup",e.mainForm),p.Cb(22),p.oc("ngForOf",e.detrendingOptions),p.Cb(6),p.oc("ngForOf",e.alignOptions),p.Cb(7),p.oc("ngForOf",e.normalisationOptions),p.Cb(10),p.oc("length",e.totalTraces)("disabled",e.disabledPagination)("pageSize",e.currentPage.pageSize)("pageIndex",e.currentPage.pageIndex)("pageSizeOptions",p.qc(9,W)))},directives:[y.C,y.q,y.h,y.i,y.u,y.c,y.y,y.p,y.g,g.a,y.z,o.l,v.a,y.t,y.B],encapsulation:2}),k),_=r("7EHt"),S=r("117B"),x=r("nA4b");function O(t,e){if(1&t){var r=p.Xb();p.Wb(0,"div",8),p.Gc(1,"Please complete "),p.Wb(2,"a",9),p.ec("click",(function(){p.xc(r);var t=p.ic(2);return t.goToExpEdit(t.assay.id,"MeasurementSection")})),p.Gc(3,"Measurement details"),p.Vb(),p.Gc(4," to get access to the secondary data "),p.Vb()}}function E(t,e){if(1&t){var r=p.Xb();p.Wb(0,"div",10),p.Wb(1,"label",11),p.Wb(2,"a",12),p.ec("click",(function(){return p.xc(r),p.ic(2).exportDataView()})),p.Wb(3,"i",13),p.Gc(4,"save_alt"),p.Vb(),p.Wb(5,"span",14),p.Gc(6,"Download"),p.Vb(),p.Vb(),p.Gc(7," current view "),p.Vb(),p.Wb(8,"label",11),p.Wb(9,"a",15),p.ec("click",(function(){return p.xc(r),p.ic(2).exportFullData()})),p.Wb(10,"i",13),p.Gc(11,"save_alt"),p.Vb(),p.Wb(12,"span",14),p.Gc(13,"Download"),p.Vb(),p.Vb(),p.Gc(14," full "),p.Vb(),p.Vb()}}function R(t,e){if(1&t&&p.Rb(0,"bd2-ts-plots",16),2&t){var r=p.ic(2);p.oc("tracesPerPlot",r.tracesPerPlot)("data",r.timeseries)}}function J(t,e){if(1&t){var r=p.Xb();p.Wb(0,"div"),p.Wb(1,"h3"),p.Gc(2,"Show timeseries"),p.Vb(),p.Rb(3,"hr"),p.Wb(4,"bd2-tsdisplay-params-rform",1),p.ec("displayParams",(function(t){return p.xc(r),p.ic().displayChanged(t)})),p.Vb(),p.Wb(5,"mat-expansion-panel"),p.Wb(6,"mat-expansion-panel-header"),p.Wb(7,"mat-panel-title"),p.Gc(8," Sorting "),p.Vb(),p.Vb(),p.Rb(9,"bd2-tssort-params-rform",2),p.jc(10,"async"),p.jc(11,"async"),p.Vb(),p.Ec(12,O,5,0,"div",3),p.Rb(13,"hr"),p.Wb(14,"div",4),p.Gc(15," Hint: You can click on trace label box to remove it from the plot. "),p.Vb(),p.Wb(16,"div",5),p.Ec(17,E,15,0,"div",6),p.Vb(),p.Rb(18,"hr"),p.Ec(19,R,1,2,"bd2-ts-plots",7),p.Vb()}if(2&t){var o=p.ic();p.Cb(4),p.oc("disabled",o.disabledSecondary)("totalTraces",o.totalTraces)("currentPage",o.currentPage),p.Cb(5),p.oc("ppaJobs",p.kc(10,8,o.analysis.ppaJobs$))("rhythmJobs",p.kc(11,10,o.analysis.rhythmJobs$)),p.Cb(3),p.oc("ngIf",o.disabledSecondary),p.Cb(5),p.oc("ngIf",o.timeseries),p.Cb(2),p.oc("ngIf",o.timeseries)}}var D,G,T,I=[{path:"",children:[{path:"view/ts",component:(D=function(t){_inherits(r,t);var e=_createSuper(r);function r(t,o,n,a,s){var l;return _classCallCheck(this,r),(l=e.call(this,s)).analysis=t,l.fetcher=o,l.RDMSocial=n,l.analytics=a,l.timeseries=[],l.totalTraces=0,l.currentPage=i.a.firstPage(),l.tracesPerPlot=5,l.blocked=!1,l.disabledSecondary=!1,l.csvExporter=new c.a,t.allowedPPAMethods=["NLLS","MESA"],l.titlePart=" Data",l}return _createClass(r,[{key:"ngOnInit",value:function(){var t=this;_get(_getPrototypeOf(r.prototype),"ngOnInit",this).call(this),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(l.a)(1e3)).subscribe((function(e){if(t.assay){var r=e.data;t.currentParams=e.params,t.timeseries=r,t.tracesPerPlot=Math.max(5,r.length/20),t.totalTraces=e.totalTraces,t.currentPage=e.currentPage,t.analytics.experimentDataView(t.assay.id)}}),(function(e){console.log("Error in TS subscription: "+e),t.feedback.error(e)})),this.fetcher.error$.subscribe((function(e){return t.feedback.error(e)}))}},{key:"ngOnDestroy",value:function(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),_get(_getPrototypeOf(r.prototype),"ngOnDestroy",this).call(this)}},{key:"displayChanged",value:function(t){this.fetcher.changeDisplayParams(t)}},{key:"exportDataView",value:function(){this.exportSeriesPack(this.fetcher.current)}},{key:"exportFullData",value:function(){var t=this;this.fetcher.getFullDataSet(this.assay,this.fetcher.current.params,this.fetcher.current.sorting).subscribe((function(e){t.exportSeriesPack(e,!0)}))}},{key:"exportSeriesPack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var r=this.csvExporter.renderCSVTable(t.data,t.params,t.currentPage,t.sorting,this.assay),o=new Blob([r],{type:"text/csv"});u.saveAs(o,"".concat(this.assay.id,"_data.").concat(t.params.detrending.name).concat(e?".full":".page"+(t.currentPage.pageIndex+1),".csv")),this.recordExport()}}},{key:"recordExport",value:function(){this.analytics.experimentDataExport(this.assay.id)}},{key:"updateModel",value:function(t){var e=this;_get(_getPrototypeOf(r.prototype),"updateModel",this).call(this,t),this.RDMSocial.canProceedByMeasurement(t).then((function(t){e.disabledSecondary=!t})),this.fetcher.experiment(t),this.analysis.experiment(t)}}]),r}(a.a),D.\u0275fac=function(t){return new(t||D)(p.Qb(b.a),p.Qb(s.a),p.Qb(d.a),p.Qb(h.a),p.Qb(f.a))},D.\u0275cmp=p.Kb({type:D,selectors:[["ng-component"]],features:[p.Bb([s.a,b.a]),p.zb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams"],[3,"ppaJobs","rhythmJobs"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","info","role","alert","dismissible","true","dismissOnTimeout","20000",1,"alert","alert-info"],[1,"clearfix"],["class","float-right",4,"ngIf"],[3,"tracesPerPlot","data",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],[3,"click"],[1,"float-right"],[1,"mr-4"],["download","","role","button","aria-label","download",1,"btn","btn-primary",2,"color","white",3,"click"],[1,"material-icons","bd-icon"],[1,"cdk-visually-hidden"],["download","","role","button","aria-label","download whole",1,"btn","btn-primary",2,"color","white",3,"click"],[3,"tracesPerPlot","data"]],template:function(t,e){1&t&&p.Ec(0,J,20,12,"div",0),2&t&&p.oc("ngIf",e.assay)},directives:[o.m,w,_.b,_.c,_.d,S.a,x.a],pipes:[o.b],encapsulation:2}),D)},{path:"view/heatmap",loadChildren:function(){return Promise.all([r.e(0),r.e(18)]).then(r.bind(null,"QftV")).then((function(t){return t.TsHeatmapModule}))}},{path:"ts-old-import",loadChildren:function(){return Promise.all([r.e(0),r.e(17)]).then(r.bind(null,"9Gw/")).then((function(t){return t.TsOldImportModule}))}},{path:"ts-import",loadChildren:function(){return Promise.all([r.e(0),r.e(19)]).then(r.bind(null,"yPAH")).then((function(t){return t.TsImportModule}))}}]}],M=((G=function t(){_classCallCheck(this,t)}).\u0275mod=p.Ob({type:G}),G.\u0275inj=p.Nb({factory:function(t){return new(t||G)},imports:[[n.f.forChild(I)],n.f]}),G),A=r("YiFe"),j=r("a6j2"),F=r("ZTEM"),N=((T=function t(){_classCallCheck(this,t)}).\u0275mod=p.Ob({type:T}),T.\u0275inj=p.Nb({factory:function(t){return new(t||T)},imports:[[o.c,y.j,y.x,A.a,j.a,M,F.a]]}),T)},e8YO:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var o=function(){function t(e){_classCallCheck(this,t),this.rows=new Map,this.nextColumn=0,this.sorted=!0,null!=e&&(this.sorted=e)}return _createClass(t,[{key:"append",value:function(t,e){this.put(t,e,this.nextColumn)}},{key:"put",value:function(t,e,r){this._put(t,e,r),this.nextColumn=Math.max(this.nextColumn,r+1)}},{key:"putColumn",value:function(t,e,r){var o=this;t.forEach((function(t,n){o._put(t,e[n],r)})),this.nextColumn=Math.max(this.nextColumn,r+1)}},{key:"appendColumn",value:function(t,e){this.putColumn(t,e,this.nextColumn)}},{key:"getValue",value:function(t,e){var r=this.rows.get(t);return r?r[e]:void 0}},{key:"getRow",value:function(t){return this.rows.get(t)}},{key:"forEach",value:function(t){var e=this;this.keys().forEach((function(r,o){var n={key:r,columns:e.rows.get(r)};t(n,o,e)}))}},{key:"forEachFlat",value:function(t){var e=this;this.keys().forEach((function(r,o){var n=[r].concat(e.rows.get(r));t(n,o,e)}))}},{key:"keys",value:function(){return this.sorted?Array.from(this.rows.keys()).sort((function(t,e){return t==e?0:t<e?-1:1})):Array.from(this.rows.keys())}},{key:"_put",value:function(t,e,r){var o=this.rows.get(t);o||(o=[],this.rows.set(t,o)),o[r]=e}},{key:"width",get:function(){return this.nextColumn}},{key:"size",get:function(){return this.rows.size}}]),t}(),n=function(){function t(){_classCallCheck(this,t),this.SEP=","}return _createClass(t,[{key:"renderCSVTable",value:function(t,e,r,o,n){var a=this.prepareHeaders(n,e,r,o,t.length);this.appendDataLabels(a,t);var i=this.prepareDataTable(t),s=this.mapToString(a,this.SEP);return s+=this.mapToString(i,this.SEP)}},{key:"prepareHeaders",value:function(t,e,r,o,n){var a=this.prepareExpHeaders(t);return this.appendDisplayProperties(a,e),this.appendSortingProperties(a,o),this.appendDataProperties(a,n,r),a}},{key:"prepareExpHeaders",value:function(t){var e=new o(!1);return e.put("Exp Id:",""+t.id,0),e.put("Exp URL:","https://biodare2.ed.ac.uk/experiment/"+t.id,0),e.put("Exp Name:",t.name,0),t.contributionDesc.authors.forEach((function(t,r){e.put("Authors:",t.name,r)})),e}},{key:"appendDisplayProperties",value:function(t,e){t.put("Time range:",e.timeScaleLabel,0),t.put("Detrending:",e.detrending.label,0),e.hourly&&t.put("Hourly binned:","true",0),e.log2&&t.put("Log2 transform:",""+e.log2,0),t.put("Normalization:",e.normalisation,0),t.put("Normalization:",e.trimFirst?"within range":"whole serie",1),t.put("Align:",e.align,0)}},{key:"appendSortingProperties",value:function(t,e){t.put("Sorting:","".concat(e.active," ").concat(e.direction),0),t.put("Sorting jobs:","".concat(e.ppaJobId," ").concat(e.rhythmJobId),0)}},{key:"appendDataProperties",value:function(t,e,r){t.put("Traces",e+" of "+r.length,0);var o=Math.floor(r.length/r.pageSize)+(r.length%r.pageSize==0?0:1);t.put("Data Page",r.pageIndex+1+" of "+o,0)}},{key:"appendDataLabels",value:function(t,e){e.forEach((function(e,r){t.put("Label:",e.label,r)}))}},{key:"prepareDataTable",value:function(t){var e=new o;return t.forEach((function(t){var r=t.data.map((function(t){return t.x})),o=t.data.map((function(t){return t.y}));e.appendColumn(r,o)})),e}},{key:"mapToString",value:function(t,e){var r="";return t.forEachFlat((function(t){for(var o=0;o<t.length;o++)void 0!==t[o]&&(r+=t[o]),r+=e;r+="\n"})),r}}]),t}()}}]);