(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{ja10:function(t,e,i){"use strict";i.r(e),i.d(e,"RhythmicityModule",(function(){return ue}));var r=i("ofXK"),s=i("tyNb"),a=i("yYXI");class n extends a.a{constructor(t,e){super(e),this.rhythmicityService=t,this.titlePart=" Rhythm"}goToRhythmicityHome(t){const e=this.expHomePath(t);e.push("rhythmicity"),this.router.navigate(e)}}var c=i("fXoL"),o=i("2Vo4"),b=i("PqYM"),l=i("B9cw"),d=i("Iab2"),u=i("zQ7r"),h=i("Iurr"),p=i("tu3j"),m=i("lJxs"),f=i("UsWK");let g=(()=>{class t{constructor(t){this.BD2REST=t}newTest(t,e){return this.BD2REST.rhythmicityNew(t.id,e)}getJob(t,e){return this.BD2REST.rhythmicityJob(t,e)}getJobs(t){return this.BD2REST.rhythmicityJobs(t.id).pipe(Object(m.a)(t=>t.data))}getResults(t,e){return this.BD2REST.rhythmicityResults(t,e)}exportURL(t){return this.BD2REST.ppaExportURL(t.id)}deleteJob(t,e){return this.BD2REST.rhythmicityDeleteJob(t.id,e)}downloadJob(t,e){return this.BD2REST.rhythmicityExportJob(t,e)}}return t.\u0275fac=function(e){return new(e||t)(c.ac(f.a))},t.\u0275prov=c.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),y=(()=>{class t extends u.a{constructor(t,e=!1){super(e),this.rhythmicityService=t,this.finishedJob$=this.finished$,this.runningJob$=this.running$,this.allJob$=this.all$}get currentJob(){return this.currentAsset}initIntervalsKeeper(){return new p.a(1e3,3e4,6e5,2)}assayJob(t){this.input(t)}sameInput(t,e){return t[1]===e[1]&&t[0]===e[0]}fetchAsset([t,e]){return this.rhythmicityService.getJob(t,e)}hasFailed(t){return!!t&&!this.isFinished(t)&&!this.isRunning(t)}isFinished(t){return!(!t||!t.jobStatus||"FINISHED"!==t.jobStatus.state&&"SUCCESS"!==t.jobStatus.state)}isRunning(t){return!!t&&!(!t||!t.jobStatus||"SUBMITTED"!==t.jobStatus.state&&"PROCESSING"!==t.jobStatus.state)}assetToId(t){return t.jobId}assetToInput(t){return[t.parentId,t.jobId]}}return t.\u0275fac=function(e){return new(e||t)(c.ac(g),c.ac(h.a,8))},t.\u0275prov=c.Mb({token:t,factory:t.\u0275fac}),t})();var v=i("M9IT"),C=i("vkgz");let J=(()=>{class t{constructor(t,e){this._name=t,this._label=e}get name(){return this._name}get label(){return this._label}static get(e){return t.getValuesMap().get(e)}static getValuesMap(){return t.valuesMap||(t.valuesMap=t.initValuesMap()),t.valuesMap}static initValuesMap(){const e=new Map;return t.values.forEach(t=>e.set(t.name,t)),e}toJSON(){return this.name}}return t.BD2EJTK=new t("BD2EJTK","BD2 eJTK"),t.BD2JTK=new t("BD2JTK","simple JTK"),t.values=[t.BD2JTK,t.BD2EJTK],t})();const S=[J.BD2JTK,J.BD2EJTK];let V=(()=>{class t{constructor(t,e){this._name=t,this._label=e}get name(){return this._name}get label(){return this._label}static get(e){return t.getValuesMap().get(e)}static getValuesMap(){return t.valuesMap||(t.valuesMap=t.initValuesMap()),t.valuesMap}static initValuesMap(){const e=new Map;return t.values.forEach(t=>e.set(t.name,t)),e}toJSON(){return this.name}}return t.EJTK_CLASSIC=new t("EJTK_CLASSIC","eJTK Classic"),t.BD2_CLASSIC=new t("BD2_CLASSIC","BD2 Classic"),t.BD2_SPREAD=new t("BD2_SPREAD","Period range"),t.COS_1H=new t("COS_1H","Cosine 24h 1h"),t.COS_2H=new t("COS_2H","Cosine 24h 2h"),t.COS_4H=new t("COS_4H","Cosine 24h 4h"),t.values=[t.COS_1H,t.COS_2H,t.COS_4H,t.EJTK_CLASSIC,t.BD2_CLASSIC,t.BD2_SPREAD],t})();const W=[V.COS_1H,V.COS_2H,V.COS_4H,V.EJTK_CLASSIC,V.BD2_CLASSIC];class w{isValid(){return!(this.windowStart<0||this.windowEnd<0||this.periodMin<=0||this.periodMax<=0||this.periodMin>this.periodMax||this.windowEnd>0&&this.windowStart>=this.windowEnd||null==this.method||null==this.preset||null==this.detrending)}}class P{constructor(t=0,e=!1,i=!1,r=!1){this.pValue=t,this.bhCorrection=e,this.showPattern=i,this.circadian=r}clone(){return new P(this.pValue,this.bhCorrection,this.showPattern,this.circadian)}}var I=i("8jiw");let T=(()=>{class t extends I.a{constructor(t,e=!1){super(e),this.rhythmicityService=t,this.results$=this.data$}isClassicJob(){var t,e;return"BD2JTK"===(null===(e=null===(t=this.currentInput)||void 0===t?void 0:t.parameters)||void 0===e?void 0:e.METHOD)}sameInput(t,e){return class{static sameJob(t,e){return!(!t||!e)&&t.jobId===e.jobId&&t.parentId===e.parentId}}.sameJob(t,e)}assetToData(t,e){return t.results}fetchAsset(t){return this.rhythmicityService.getResults(t.parentId,t.jobId).pipe(Object(C.a)(t=>this.labelPatterns(t)))}sortingKey(t){switch(t.active){case"label":return t=>t.label;case"id":return t=>+t.id;case"empp":return t=>+t.result.empP;case"emppbh":return t=>+t.result.empPBH;case"p":return t=>+t.result.p;case"pbh":return t=>+t.result.pBH;case"tau":return t=>+t.result.tau;case"period":return t=>t.result.pattern.period;case"peak":return t=>t.result.pattern.peak;case"trough":return t=>t.result.pattern.trough;default:return console.error("Not implemented sorting for "+t.active),t=>0}}processData(t,e){return e?(this.rankResults(t,e.pValue,e.bhCorrection,this.isClassicJob()),t):t}labelPatterns(t){t.results.forEach(t=>{t.result.patternLabel=this.describePattern(t.result),t.result.pattern.shapeLabel=this.patternToShape(t.result.pattern)})}describePattern(t){const e=t.pattern,i=Math.round(10*e.period)/10,r=Math.round(100*e.peak)/100,s=Math.round(100*e.trough)/100;return`${this.patternToShape(e)}\t${i}\t${r}\t${s}`}patternToShape(t){switch(t.waveform){case"ASYM_COSINE":return.5===t.leftPortion?"COS":"ACOS";case"ASYM_COS_SPIKE":return"SPIKE";case"ASYM_COS_SPIKE_NEG":return"NPIKE";default:return t.waveform}}rankResults(t,e,i,r){t.forEach(t=>{const s=t.result;let a;a=r?i?s.pBH:s.p:i?s.empPBH:s.empP,s.rhythmic=a<e})}}return t.\u0275fac=function(e){return new(e||t)(c.ac(g),c.ac(h.a,8))},t.\u0275prov=c.Mb({token:t,factory:t.\u0275fac}),t})();var D=i("6tuW"),H=i("+0xr"),j=i("Dh3D"),R=i("bv9b");function O(t,e){1&t&&c.Rb(0,"mat-progress-bar",28)}function x(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"Id"),c.Vb())}function k(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(t.id)}}function E(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"Label"),c.Vb())}function M(t,e){if(1&t&&(c.Wb(0,"td",31),c.Jc(1),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(t.label)}}function K(t,e){1&t&&(c.Wb(0,"th",32),c.Jc(1,"Rhythmic"),c.Vb())}function B(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.Vb()),2&t){const t=e.$implicit;c.Gb("bold",t.result.rhythmic),c.Cb(1),c.Kc(t.result.rhythmic)}}function A(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"emp-p"),c.Vb())}function _(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,t.result.empP,"1.0-5"))}}function $(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"BH emp-p"),c.Vb())}function U(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,t.result.empPBH,"1.0-5"))}}function L(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"Tau"),c.Vb())}function N(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,t.result.tau,"1.0-2"))}}function z(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"p"),c.Vb())}function q(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,t.result.p,"1.0-5"))}}function F(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"BH p"),c.Vb())}function Q(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,t.result.pBH,"1.0-5"))}}function G(t,e){1&t&&(c.Wb(0,"th",32),c.Jc(1,"Pattern"),c.Vb())}function X(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(t.result.patternLabel)}}function Y(t,e){1&t&&(c.Wb(0,"th",32),c.Jc(1,"P.Shape"),c.Vb())}function Z(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(t.result.pattern.shapeLabel)}}function tt(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"P.Period"),c.Vb())}function et(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,t.result.pattern.period,"1.0-1"))}}function it(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"P.Peak"),c.Vb())}function rt(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,t.result.pattern.peak,"1.1-1"))}}function st(t,e){1&t&&(c.Wb(0,"th",32),c.Jc(1,"P.Peak"),c.Vb())}function at(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,24*t.result.pattern.peak/t.result.pattern.period,"1.1-1"))}}function nt(t,e){1&t&&(c.Wb(0,"th",29),c.Jc(1,"P.Trough"),c.Vb())}function ct(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,t.result.pattern.trough,"1.1-1"))}}function ot(t,e){1&t&&(c.Wb(0,"th",32),c.Jc(1,"P.Trough"),c.Vb())}function bt(t,e){if(1&t&&(c.Wb(0,"td",30),c.Jc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Kc(c.lc(2,1,24*t.result.pattern.trough/t.result.pattern.period,"1.1-1"))}}function lt(t,e){1&t&&c.Rb(0,"tr",33)}function dt(t,e){1&t&&c.Rb(0,"tr",34)}const ut=function(){return[10,25,50,100,250]};let ht=(()=>{class t{constructor(t,e){this.fetcher=t,this.feedback=e,this.normEmpPColumns=["id","label","rhythmic","empp","tau"],this.normClsPColumns=["id","label","rhythmic","p","tau"],this.bhEmpPColumns=["id","label","rhythmic","emppbh","tau"],this.bhClsPColumns=["id","label","rhythmic","pbh","tau"],this.patternColumns=["shape","period","peak","trough"],this.patternColumnsC=["shape","period","peakc","troughc"],this.displayedColumns=this.normEmpPColumns,this.disablePaginator=!1}set job(t){t&&this.fetcher.input(t)}set statTestParams(t){if(t){this.fetcher.params(t);let e=t.bhCorrection?this.bhEmpPColumns:this.normEmpPColumns;this.fetcher.isClassicJob()&&(e=t.bhCorrection?this.bhClsPColumns:this.normClsPColumns),t.showPattern&&(e=e.concat(t.circadian?this.patternColumnsC:this.patternColumns)),this.displayedColumns=e}}ngOnInit(){this.fetcher.error$.subscribe(t=>this.feedback.error(t));const t=new v.d;t.pageSize=25,t.pageIndex=0,this.fetcher.page(t),this.fetcher.on(!0)}ngOnDestroy(){this.fetcher.close()}ngAfterViewInit(){}reload(){this.fetcher.refresh()}sortData(t){this.fetcher.sort(t)}loadPage(t){this.fetcher.page(t)}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(T),c.Qb(D.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-rhythmicity-results-mdtable"]],inputs:{job:"job",statTestParams:"statTestParams"},features:[c.Bb([T])],decls:55,vars:18,consts:[[1,"mat-elevation-z8"],["mode","indeterminate",4,"ngIf"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["paginator",""],["mat-table","","matSort","","aria-label","Results","matSort","","matSortActive","id","matSortDirection","asc",1,"full-width-table",3,"dataSource","matSortChange"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","label"],["mat-cell","","class","word_wrapping","style","max-width: 100px",4,"matCellDef"],["matColumnDef","rhythmic"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"bold",4,"matCellDef"],["matColumnDef","empp"],["matColumnDef","emppbh"],["matColumnDef","tau"],["matColumnDef","p"],["matColumnDef","pbh"],["matColumnDef","pattern"],["matColumnDef","shape"],["matColumnDef","period"],["matColumnDef","peak"],["matColumnDef","peakc"],["matColumnDef","trough"],["matColumnDef","troughc"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["paginator2",""],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"word_wrapping",2,"max-width","100px"],["mat-header-cell",""],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(c.Wb(0,"div",0),c.Hc(1,O,1,0,"mat-progress-bar",1),c.jc(2,"async"),c.Wb(3,"mat-paginator",2,3),c.ec("page",(function(t){return e.loadPage(t)})),c.Vb(),c.Wb(5,"table",4),c.ec("matSortChange",(function(t){return e.sortData(t)})),c.Ub(6,5),c.Hc(7,x,2,0,"th",6),c.Hc(8,k,2,1,"td",7),c.Tb(),c.Ub(9,8),c.Hc(10,E,2,0,"th",6),c.Hc(11,M,2,1,"td",9),c.Tb(),c.Ub(12,10),c.Hc(13,K,2,0,"th",11),c.Hc(14,B,2,3,"td",12),c.Tb(),c.Ub(15,13),c.Hc(16,A,2,0,"th",6),c.Hc(17,_,3,4,"td",7),c.Tb(),c.Ub(18,14),c.Hc(19,$,2,0,"th",6),c.Hc(20,U,3,4,"td",7),c.Tb(),c.Ub(21,15),c.Hc(22,L,2,0,"th",6),c.Hc(23,N,3,4,"td",7),c.Tb(),c.Ub(24,16),c.Hc(25,z,2,0,"th",6),c.Hc(26,q,3,4,"td",7),c.Tb(),c.Ub(27,17),c.Hc(28,F,2,0,"th",6),c.Hc(29,Q,3,4,"td",7),c.Tb(),c.Ub(30,18),c.Hc(31,G,2,0,"th",11),c.Hc(32,X,2,1,"td",7),c.Tb(),c.Ub(33,19),c.Hc(34,Y,2,0,"th",11),c.Hc(35,Z,2,1,"td",7),c.Tb(),c.Ub(36,20),c.Hc(37,tt,2,0,"th",6),c.Hc(38,et,3,4,"td",7),c.Tb(),c.Ub(39,21),c.Hc(40,it,2,0,"th",6),c.Hc(41,rt,3,4,"td",7),c.Tb(),c.Ub(42,22),c.Hc(43,st,2,0,"th",11),c.Hc(44,at,3,4,"td",7),c.Tb(),c.Ub(45,23),c.Hc(46,nt,2,0,"th",6),c.Hc(47,ct,3,4,"td",7),c.Tb(),c.Ub(48,24),c.Hc(49,ot,2,0,"th",11),c.Hc(50,bt,3,4,"td",7),c.Tb(),c.Hc(51,lt,1,0,"tr",25),c.Hc(52,dt,1,0,"tr",26),c.Vb(),c.Wb(53,"mat-paginator",2,27),c.ec("page",(function(t){return e.loadPage(t)})),c.Vb(),c.Vb()),2&t&&(c.Cb(1),c.oc("ngIf",c.kc(2,14,e.fetcher.isBusy$)),c.Cb(2),c.oc("length",e.fetcher.dataLength)("disabled",e.disablePaginator)("pageSize",(null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageSize)||25)("pageIndex",null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageIndex)("pageSizeOptions",c.qc(16,ut)),c.Cb(2),c.oc("dataSource",e.fetcher.results$),c.Cb(46),c.oc("matHeaderRowDef",e.displayedColumns),c.Cb(1),c.oc("matRowDefColumns",e.displayedColumns),c.Cb(1),c.oc("length",e.fetcher.dataLength)("disabled",e.disablePaginator)("pageSize",(null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageSize)||25)("pageIndex",null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageIndex)("pageSizeOptions",c.qc(17,ut)))},directives:[r.m,v.a,H.n,j.a,H.c,H.i,H.b,H.k,H.m,R.a,H.h,j.b,H.a,H.j,H.l],pipes:[r.b,r.f],styles:[".full-width-table[_ngcontent-%COMP%] {\n      width: 100%;\n    }"]}),t})();var pt=i("BOp5"),mt=i("9+85"),ft=i("Wp6s"),gt=i("f0Cb"),yt=i("Xa2L"),vt=i("3Pt+"),Ct=i("kmnG"),Jt=i("QibW");function St(t,e){if(1&t&&(c.Wb(0,"mat-radio-button",5),c.Jc(1),c.Vb()),2&t){const t=e.$implicit;c.oc("value",t),c.Cb(1),c.Kc(t)}}let Vt=(()=>{class t{constructor(){this.values=[1e-4,.001,.005,.01,.05,.1],this.pvalue=.001,this.pvalue$=new c.o}ngOnInit(){}ngAfterViewInit(){this.pvalue$.emit(this.pvalue)}selected(t){this.pvalue$.emit(t.value)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-pvalue-form"]],outputs:{pvalue$:"pvalue$"},decls:8,vars:2,consts:[[1,"form-inline"],[1,"mx-auto","text-center"],["id","pvalues-label",1,"mb-1"],["aria-label","Select p-value","aria-labelledby","pvalues-label",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(c.Wb(0,"form",0),c.Wb(1,"div",1),c.Wb(2,"mat-label",2),c.Wb(3,"strong"),c.Jc(4,"p-value threshold:"),c.Vb(),c.Vb(),c.Wb(5,"div"),c.Wb(6,"mat-radio-group",3),c.ec("change",(function(t){return e.selected(t)})),c.Hc(7,St,2,2,"mat-radio-button",4),c.Vb(),c.Vb(),c.Vb(),c.Vb()),2&t&&(c.Cb(6),c.oc("value",e.pvalue),c.Cb(1),c.oc("ngForOf",e.values))},directives:[vt.C,vt.q,vt.r,Ct.g,Jt.b,r.l,Jt.a],styles:[".mat-radio-button[_ngcontent-%COMP%]  {\n      margin-right: 15px;\n    }"]}),t})();var Wt=i("1jcm");let wt=(()=>{class t{constructor(){this.options=new c.o,this.currentOptions=new P(0,!1,!1,!1)}ngOnInit(){}pValue(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.pValue=t,this.options.next(this.currentOptions)}bhCorrection(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.bhCorrection=t,this.options.next(this.currentOptions)}circadian(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.circadian=t,this.options.next(this.currentOptions)}showPattern(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.showPattern=t,this.options.next(this.currentOptions)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-stat-test-options-widget"]],outputs:{options:"options"},decls:14,vars:1,consts:[[3,"pvalue$"],[2,"margin-top","0.5em","text-align","center"],[3,"change"],["pattern",""],[3,"disabled","change"]],template:function(t,e){if(1&t&&(c.Wb(0,"mat-card"),c.Wb(1,"mat-card-content"),c.Wb(2,"section"),c.Wb(3,"bd2-pvalue-form",0),c.ec("pvalue$",(function(t){return e.pValue(t)})),c.Vb(),c.Vb(),c.Wb(4,"section",1),c.Wb(5,"mat-slide-toggle",2),c.ec("change",(function(t){return e.bhCorrection(t.checked)})),c.Jc(6,"Benjamini Hochberg correction"),c.Vb(),c.Vb(),c.Wb(7,"section",1),c.Wb(8,"mat-slide-toggle",2,3),c.ec("change",(function(t){return e.showPattern(t.checked)})),c.Jc(10,"show pattern"),c.Vb(),c.Jc(11," \xa0 "),c.Wb(12,"mat-slide-toggle",4),c.ec("change",(function(t){return e.circadian(t.checked)})),c.Jc(13,"circadian unit"),c.Vb(),c.Vb(),c.Vb(),c.Vb()),2&t){const t=c.xc(9);c.Cb(12),c.oc("disabled",!t.checked)}},directives:[ft.a,ft.c,Vt,Wt.a],encapsulation:2}),t})();function Pt(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div",5),c.Wb(1,"button",13),c.ec("click",(function(){return c.Ac(t),c.ic(2).delete()})),c.Wb(2,"i",4),c.Jc(3,"delete_forever"),c.Vb(),c.Vb(),c.Wb(4,"button",14),c.ec("click",(function(){return c.Ac(t),c.ic(2).export()})),c.Wb(5,"i",4),c.Jc(6,"save_alt"),c.Vb(),c.Vb(),c.Vb()}}function It(t,e){if(1&t&&(c.Wb(0,"div",15),c.Rb(1,"br"),c.Jc(2),c.Vb()),2&t){const t=c.ic().ngIf;c.Cb(2),c.Lc("ERROR: ",t.jobStatus.message," ")}}function Tt(t,e){1&t&&(c.Wb(0,"div"),c.Wb(1,"mat-card"),c.Wb(2,"mat-card-content"),c.Rb(3,"mat-spinner",16),c.Vb(),c.Vb(),c.Vb())}function Dt(t,e){1&t&&(c.Wb(0,"div"),c.Wb(1,"mat-card"),c.Wb(2,"mat-card-content"),c.Wb(3,"div",17),c.Jc(4,"It may take up to 10 minutes to test for rhythmicity"),c.Vb(),c.Vb(),c.Vb(),c.Vb())}function Ht(t,e){if(1&t){const t=c.Xb();c.Ub(0),c.Wb(1,"bd2-stat-test-options-widget",18),c.ec("options",(function(e){return c.Ac(t),c.ic(3).statTestOptions(e)})),c.Vb(),c.Rb(2,"bd2-rhythmicity-results-mdtable",19),c.Tb()}if(2&t){const t=e.ngIf,i=c.ic(3);c.Cb(2),c.oc("statTestParams",i.statTestParams)("job",t)}}function jt(t,e){if(1&t&&(c.Wb(0,"div"),c.Rb(1,"mat-divider"),c.Hc(2,Tt,4,0,"div",12),c.jc(3,"async"),c.Hc(4,Dt,5,0,"div",12),c.Hc(5,Ht,3,2,"ng-container",12),c.jc(6,"async"),c.Vb()),2&t){const t=c.ic().ngIf,e=c.ic();c.Cb(2),c.oc("ngIf",c.kc(3,3,e.rhythmicityJobDatasource.isReloading$)),c.Cb(2),c.oc("ngIf","SUBMITTED"===t.jobStatus.state),c.Cb(1),c.oc("ngIf",c.kc(6,5,e.rhythmicityJobDatasource.finishedJob$))}}function Rt(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div",1),c.Wb(1,"div",2),c.Wb(2,"div",3),c.ec("click",(function(){return c.Ac(t),c.ic().toggleExpanded()})),c.Wb(3,"i",4),c.Jc(4,"waves"),c.Vb(),c.Jc(5),c.jc(6,"date"),c.Rb(7,"br"),c.Jc(8),c.Vb(),c.Wb(9,"div",5),c.Jc(10),c.Wb(11,"a",6),c.ec("click",(function(){return c.Ac(t),c.ic().refresh()})),c.Wb(12,"i",7),c.Jc(13,"refresh"),c.Vb(),c.Vb(),c.Vb(),c.Vb(),c.Wb(14,"div",8),c.Wb(15,"mat-card"),c.Wb(16,"mat-card-content"),c.Wb(17,"div",9),c.Hc(18,Pt,7,0,"div",10),c.Jc(19),c.Hc(20,It,3,1,"div",11),c.Vb(),c.Vb(),c.Vb(),c.Hc(21,jt,7,7,"div",12),c.Vb(),c.Vb()}if(2&t){const t=e.ngIf,i=c.ic();c.Cb(3),c.Gc("color",i.isExpanded?"green":"red")("font-size",150,"%"),c.Cb(2),c.Mc(" \xa0",i.shortUUID(t.jobId)," (",c.kc(6,13,i.toLocalDateTime(t.jobStatus.submitted)),") "),c.Cb(3),c.Mc(" ",i.friendlyMethod(t.parameters.METHOD),"; \xa0 waveforms: ",t.parameters.PRESET," "),c.Cb(2),c.Lc(" ",t.jobStatus.state," "),c.Cb(8),c.oc("ngIf",i.assay.security.canWrite),c.Cb(1),c.Lc(" ",t.parameters.PARAMS_SUMMARY," "),c.Cb(1),c.oc("ngIf",t.jobStatus.message&&"OK"!=t.jobStatus.message),c.Cb(1),c.oc("ngIf",i.isExpanded)}}let Ot=(()=>{class t{constructor(t,e,i,r){this.rhythmicityService=t,this.rhythmicityJobDatasource=e,this.feedback=i,this.dialogs=r,this.deleted=new c.o,this.isExpanded=!1,this.expandedToogleStream=new o.a(!1)}set expanded(t){this.isExpanded=t,this.expandedToogleStream.next(t)}ngOnInit(){this.initSubscriptions()}ngOnDestroy(){this.rhythmicityJobDatasource.close(),this.expandedToogleStream&&this.expandedToogleStream.complete()}ngOnChanges(t){(t.jobId||t.assay)&&this.jobId&&this.assay&&this.rhythmicityJobDatasource.assayJob([this.assay.id,this.jobId])}statTestOptions(t){const e=Object(b.a)(1).subscribe(()=>{this.statTestParams=t,e&&e.unsubscribe()})}export(){this.rhythmicityService.downloadJob(this.assay.id,this.jobId).subscribe(t=>{this.saveJobBlob(t,this.assay.id,this.jobId)},t=>this.feedback.error(t))}saveJobBlob(t,e,i){d.saveAs(t,e+"_job"+this.shortUUID(i)+".rhythmicity.csv")}refresh(){this.rhythmicityJobDatasource.refresh(),this.resultsTable&&this.resultsTable.reload()}delete(){const t=this.assay,e=this.rhythmicityJobDatasource.currentJob;this.dialogs.confirm("Do you want to delete analysis: "+e.jobId,e.parameters.PARAMS_SUMMARY).subscribe(i=>{i&&this.doDelete(t,e.jobId)})}initSubscriptions(){this.rhythmicityJobDatasource.on(!0),this.rhythmicityJobDatasource.error$.forEach(t=>this.feedback.error(t))}doDelete(t,e){this.rhythmicityService.deleteJob(t,e).subscribe(t=>{this.deleted.next(t),this.feedback.success("Job: "+this.shortUUID(e)+" deleted")},t=>{this.feedback.error(t)})}toggleExpanded(){this.expanded=!this.isExpanded}toLocalDateTime(t){return l.b.deserialize(t).date}shortUUID(t){return Object(pt.c)(t)}friendlyMethod(t){return"BD2JTK"==t?"Classic JTK":"BD2EJTK"==t?"BD2 eJTK":t}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(g),c.Qb(y),c.Qb(D.a),c.Qb(mt.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-rhythmicity-job-pane"]],viewQuery:function(t,e){var i;1&t&&c.Pc(ht,!0),2&t&&c.wc(i=c.fc())&&(e.resultsTable=i.first)},inputs:{jobId:"jobId",assay:"assay",expanded:"expanded"},outputs:{deleted:"deleted"},features:[c.Bb([y]),c.Ab],decls:2,vars:3,consts:[["class","card mb-2",4,"ngIf"],[1,"card","mb-2"],[1,"card-header","clearfix"],["role","button",1,"float-left",3,"click"],[1,"material-icons","bd-icon"],[1,"float-right"],["role","button","aria-label","refresh",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"card-body"],[1,"clearfix"],["class","float-right",4,"ngIf"],["class","text-danger","style","word-wrap: break-word;",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-danger","btn-sm","mr-1",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"text-danger",2,"word-wrap","break-word"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"],[3,"options"],[3,"statTestParams","job"]],template:function(t,e){1&t&&(c.Hc(0,Rt,22,15,"div",0),c.jc(1,"async")),2&t&&c.oc("ngIf",c.kc(1,1,e.rhythmicityJobDatasource.allJob$))},directives:[r.m,ft.a,ft.c,gt.a,yt.b,wt,ht],pipes:[r.b,r.e],encapsulation:2}),t})();var xt=i("GVyA");function kt(t,e){if(1&t&&(c.Wb(0,"div"),c.Wb(1,"strong"),c.Jc(2),c.Vb(),c.Vb()),2&t){const t=c.ic(2);c.Cb(2),c.Lc("Submitted jobs: ",t.jobs.length,"")}}function Et(t,e){1&t&&(c.Wb(0,"div"),c.Jc(1," No jobs submitted, start a new test. "),c.Vb())}const Mt=function(){return["new"]};function Kt(t,e){1&t&&(c.Wb(0,"a",7),c.Jc(1," New test "),c.Vb()),2&t&&c.oc("routerLink",c.qc(1,Mt))}function Bt(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div"),c.Wb(1,"bd2-rhythmicity-job-pane",8),c.ec("deleted",(function(e){return c.Ac(t),c.ic(2).remove(e)}))("finished",(function(e){return c.Ac(t),c.ic(2).refreshJob(e)})),c.Vb(),c.Vb()}if(2&t){const t=e.$implicit,i=e.index,r=c.ic(2);c.Cb(1),c.oc("assay",r.assay)("jobId",t)("expanded",r.expandAll||0==i)}}function At(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div"),c.Wb(1,"h3"),c.Jc(2,"Rhythmicity tests"),c.Vb(),c.Rb(3,"hr"),c.Wb(4,"div",1),c.Wb(5,"div",2),c.Hc(6,kt,3,1,"div",0),c.Hc(7,Et,2,0,"div",0),c.Vb(),c.Wb(8,"div",3),c.Hc(9,Kt,2,2,"a",4),c.Wb(10,"button",5),c.ec("click",(function(){return c.Ac(t),c.ic().refresh()})),c.Jc(11,"Refresh "),c.Vb(),c.Vb(),c.Vb(),c.Rb(12,"hr"),c.Hc(13,Bt,2,3,"div",6),c.Rb(14,"hr"),c.Vb()}if(2&t){const t=c.ic();c.Cb(6),c.oc("ngIf",t.jobs&&t.jobs.length>0),c.Cb(1),c.oc("ngIf",!t.jobs||0==t.jobs.length),c.Cb(2),c.oc("ngIf",t.assay.security.canWrite),c.Cb(1),c.oc("disabled",t.blocked),c.Cb(3),c.oc("ngForOf",t.jobsIds)}}let _t=(()=>{class t extends n{constructor(t,e){super(t,e),this.expandAll=!1,this.blocked=!1,this.titlePart=" Rhythm"}updateModel(t){super.updateModel(t),t&&this.loadJobs(t)}loadJobs(t,e=!1){this.blocked=!0,this.rhythmicityService.getJobs(t).subscribe(i=>{this.jobs=i,this.refreshJobsInfo(i),this.exportURL=this.rhythmicityService.exportURL(t),e&&this.refreshPanes(),this.blocked=!1},t=>{this.blocked=!1,this.feedback.error(t)})}refreshJobsInfo(t){this.jobsIds=t.map(t=>t.jobId)}refresh(){this.loadJobs(this.assay,!0)}refreshPanes(){this.panes&&this.panes.forEach(t=>t.refresh())}remove(t){const e=this.jobs.findIndex(e=>t.jobId===e.jobId);e>=0&&(this.jobs.splice(e,1),this.refreshJobsInfo(this.jobs))}refreshJob(t){const e=this.jobs.findIndex(e=>t.jobId===e.jobId);e>=0&&(this.jobs[e]=t,this.refreshJobsInfo(this.jobs))}calculateQueuing(t){return t.filter(t=>this.isQueueing(t.jobStatus.state)).length}isQueueing(t){switch(t){case"WAITING":case"PROCESSING":case"SUBMITTED":return!0;default:return!1}}checkFinished(t){return!!t.find(t=>this.isFinished(t.jobStatus.state))}isFinished(t){switch(t){case"SUCCESS":case"FINISHED":case"COMPLETED":return!0;default:return!1}}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(g),c.Qb(xt.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){var i;1&t&&c.Pc(Ot,!0),2&t&&c.wc(i=c.fc())&&(e.panes=i)},features:[c.zb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-body"],["class","btn btn-primary mr-1",3,"routerLink",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","click"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary","mr-1",3,"routerLink"],[3,"assay","jobId","expanded","deleted","finished"]],template:function(t,e){1&t&&c.Hc(0,At,15,5,"div",0),2&t&&c.oc("ngIf",e.assay)},directives:[r.m,r.l,s.e,Ot],encapsulation:2}),t})();var $t=i("QBpm"),Ut=i("Kj3r"),Lt=i("bngM"),Nt=i("ZMwR"),zt=i("naqj"),qt=i("Tl2h"),Ft=i("wcxA");function Qt(t,e){if(1&t&&(c.Wb(0,"option",29),c.Jc(1),c.Vb()),2&t){const t=e.$implicit;c.oc("value",t.name),c.Cb(1),c.Kc(t.label)}}function Gt(t,e){1&t&&(c.Wb(0,"div",30),c.Wb(1,"div",31),c.Jc(2," Rhythmicity tests are generally used for short, sparse timeseries. "),c.Rb(3,"br"),c.Jc(4," The current limit is 5 or 4 days of hourly sampled data for eJTK preset and BD2 preset respectivelly."),c.Rb(5,"br"),c.Jc(6," Generally the raw data are being analysed, but we also enabled a linear detrended option. "),c.Vb(),c.Vb())}function Xt(t,e){if(1&t&&(c.Wb(0,"option",29),c.Jc(1),c.Vb()),2&t){const t=e.$implicit;c.oc("value",t.name),c.Cb(1),c.Kc(t.label)}}function Yt(t,e){1&t&&(c.Wb(0,"div",30),c.Wb(1,"div",31),c.Jc(2," BD2 eJTK is the BioDare2 implementation of Empirical JTK_CYCLE with asymmetry search from "),c.Wb(3,"a",32),c.Jc(4,"Alan L. Hutchison et al. 2015"),c.Vb(),c.Jc(5,". It is a classic JTK method but with p values empirically calculated against set of random noise data. "),c.Vb(),c.Vb())}function Zt(t,e){if(1&t&&(c.Wb(0,"option",29),c.Jc(1),c.Vb()),2&t){const t=e.$implicit;c.oc("value",t.name),c.Cb(1),c.Kc(t.label)}}function te(t,e){1&t&&(c.Wb(0,"div",30),c.Wb(1,"div",31),c.Jc(2," Presets determine set of pattern curves against the comparison test is run."),c.Rb(3,"br"),c.Wb(4,"ul"),c.Wb(5,"li"),c.Jc(6,"eJTK Classic is recommended for typical omics-like data for which eJTK method was developed. "),c.Rb(7,"br"),c.Jc(8," It works well for short data (48h, 2h- 1h-sampled) when actual period is within range 22-26 hours."),c.Rb(9,"br"),c.Jc(10," The patterns are series of cosine-like waveforms with 24h period, phases by 2hours and range of asymmetries by 2h (see original paper)."),c.Rb(11,"br"),c.Vb(),c.Wb(12,"li"),c.Jc(13,"BD2 Classic can detect non 24 periods and some forms of the spikes."),c.Rb(14,"br"),c.Jc(15," As it compares against much more patterns it has a weaker power."),c.Rb(16,"br"),c.Jc(17," It should be used when there is a good reason to suspect periods outside 22-26h range."),c.Rb(18,"br"),c.Jc(19," The patterns are series of cosine-like waverforms with periods from 18-35hours, for each period there are multiple "),c.Wb(20,"b"),c.Jc(21,"circadian"),c.Vb(),c.Jc(22," phases with step 2h (so each period value generates the same number of patterns but the peaks in absolute units do not coincide) and a range of assymetries by 2h in circadian units (see original paper). The preset contains also additional some spike patterns. "),c.Vb(),c.Vb(),c.Vb(),c.Vb())}const ee=function(){return[10,25,50,100,200]};let ie=(()=>{class t extends Ft.a{constructor(t){super(t),this.methodOptions=S,this.presetOptions=W,this.dataHelp=!1,this.presetsHelp=!1,this.methodHelp=!1,this.rhythmicityRequests=new c.o,this.detrendingOptions=[qt.b.NO_DTR,qt.b.LIN_DTR]}buildMainForm(){return this.fb.group({displayParams:this.displayParamsForm,periodScale:this.fb.group({periodMin:[18,[vt.A.required]],periodMax:[34,[vt.A.required]]},{validator:t=>this.validPeriodScale(t.value)}),method:[J.BD2EJTK.name,[vt.A.required]],preset:[V.EJTK_CLASSIC.name,[vt.A.required]]})}defaultDetrending(){return qt.b.NO_DTR.name}validPeriodScale(t){const e=t.periodMin,i=t.periodMax;return e<10?{validPeriodScale:"Period min must >= 10"}:i<10?{validPeriodScale:"Period max must >= 10"}:i>50?{validPeriodScale:"Period max must < 50"}:e>=i?{validPeriodScale:"Period min must be < max"}:null}analyse(){if(this.mainForm.invalid)return;const t=this.map2RhythmicityRequest(this.mainForm.value);t.isValid()&&this.rhythmicityRequests.next(t)}map2RhythmicityRequest(t){const e=new w;return e.detrending=qt.b.get(t.displayParams.detrending),e.method=J.get(t.method),e.preset=V.get(t.preset),e.periodMax=t.periodScale.periodMax,e.periodMin=t.periodScale.periodMin,e.windowEnd=t.displayParams.timeScale.timeEnd,e.windowStart=t.displayParams.timeScale.timeStart,e}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(vt.d))},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-rhythmicityjob-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams",rhythmicityRequests:"rhythmicityRequests"},features:[c.zb],decls:61,vars:15,consts:[["role","form",1,"form-horizontal",3,"formGroup"],["formGroupName","displayParams"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-sm-4"],["for","windowStart",1,"col-sm-1"],[1,"col-sm-2"],["formControlName","timeStart","id","windowStart","min","0","required","","size","5","step","any","type","number",1,"form-control"],["for","windowEnd",1,"col-sm-1"],["formControlName","timeEnd","id","windowEnd","min","0","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"form-group","row"],["for","detrending",1,"col-sm-4"],[3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"col-sm-6"],["formControlName","detrending","id","detrending","required","",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["class","col-sm-12",4,"ngIf"],["for","method",1,"col-sm-4"],["formControlName","method","id","method","required","",1,"form-control"],["formControlName","preset","id","preset","required","",1,"form-control"],["formGroupName","periodScale",1,"form-group","row",3,"hidden"],["for","periodMin",1,"col-sm-1"],["formControlName","periodMin","id","periodMin","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],["for","periodMax",1,"col-sm-1"],["formControlName","periodMax","id","periodMax","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],["type","button",1,"btn","btn-primary",3,"disabled","click"],[3,"value"],[1,"col-sm-12"],["role","alert","type","info",1,"alert","alert-info"],["href"," https://doi.org/10.1371/journal.pcbi.1004094","target","_blank"]],template:function(t,e){1&t&&(c.Wb(0,"form",0),c.Wb(1,"div",1),c.Wb(2,"div",2),c.Wb(3,"label",3),c.Jc(4,"Data window"),c.Vb(),c.Wb(5,"label",4),c.Jc(6,"from:"),c.Vb(),c.Wb(7,"div",5),c.Rb(8,"input",6),c.Vb(),c.Wb(9,"label",7),c.Jc(10,"to:"),c.Vb(),c.Wb(11,"div",5),c.Rb(12,"input",8),c.Vb(),c.Vb(),c.Wb(13,"div",9),c.Wb(14,"label",10),c.Jc(15,"Input Data "),c.Wb(16,"a",11),c.ec("click",(function(){return e.dataHelp=!e.dataHelp})),c.Wb(17,"i",12),c.Jc(18,"help"),c.Vb(),c.Vb(),c.Vb(),c.Wb(19,"div",13),c.Wb(20,"select",14),c.Hc(21,Qt,2,2,"option",15),c.Vb(),c.Vb(),c.Vb(),c.Vb(),c.Hc(22,Gt,7,0,"div",16),c.Wb(23,"div",9),c.Wb(24,"label",17),c.Jc(25,"Test Method "),c.Wb(26,"a",11),c.ec("click",(function(){return e.methodHelp=!e.methodHelp})),c.Wb(27,"i",12),c.Jc(28,"help"),c.Vb(),c.Vb(),c.Vb(),c.Wb(29,"div",13),c.Wb(30,"select",18),c.Hc(31,Xt,2,2,"option",15),c.Vb(),c.Vb(),c.Vb(),c.Hc(32,Yt,6,0,"div",16),c.Wb(33,"div",9),c.Wb(34,"label",17),c.Jc(35,"Analysis Presets "),c.Wb(36,"a",11),c.ec("click",(function(){return e.presetsHelp=!e.presetsHelp})),c.Wb(37,"i",12),c.Jc(38,"help"),c.Vb(),c.Vb(),c.Vb(),c.Wb(39,"div",13),c.Wb(40,"select",19),c.Hc(41,Zt,2,2,"option",15),c.Vb(),c.Vb(),c.Vb(),c.Hc(42,te,23,0,"div",16),c.Wb(43,"div",20),c.Wb(44,"label",3),c.Jc(45,"Expected periods"),c.Vb(),c.Wb(46,"label",21),c.Jc(47,"from:"),c.Vb(),c.Wb(48,"div",5),c.Rb(49,"input",22),c.Vb(),c.Wb(50,"label",23),c.Jc(51,"to:"),c.Vb(),c.Wb(52,"div",5),c.Rb(53,"input",24),c.Vb(),c.Vb(),c.Wb(54,"div",9),c.Rb(55,"label",5),c.Wb(56,"div",25),c.Wb(57,"mat-paginator",26,27),c.ec("page",(function(t){return e.loadDataPage(t)})),c.Vb(),c.Vb(),c.Vb(),c.Wb(59,"button",28),c.ec("click",(function(){return e.analyse()})),c.Jc(60,"Test Rhythmicity "),c.Vb(),c.Vb()),2&t&&(c.oc("formGroup",e.mainForm),c.Cb(21),c.oc("ngForOf",e.detrendingOptions),c.Cb(1),c.oc("ngIf",e.dataHelp),c.Cb(9),c.oc("ngForOf",e.methodOptions),c.Cb(1),c.oc("ngIf",e.methodHelp),c.Cb(9),c.oc("ngForOf",e.presetOptions),c.Cb(1),c.oc("ngIf",e.presetsHelp),c.Cb(1),c.oc("hidden",!0),c.Cb(14),c.oc("length",e.totalTraces)("disabled",e.disabledPagination)("pageSize",e.currentPage.pageSize)("pageIndex",e.currentPage.pageIndex)("pageSizeOptions",c.qc(14,ee)),c.Cb(2),c.oc("disabled",e.disabled||e.mainForm.invalid))},directives:[vt.C,vt.q,vt.h,vt.i,vt.c,vt.u,vt.p,vt.g,vt.y,vt.z,r.l,r.m,v.a,vt.t,vt.B],encapsulation:2}),t})();var re=i("nA4b");function se(t,e){if(1&t&&c.Rb(0,"bd2-ts-plots",3),2&t){const t=c.ic(3);c.oc("data",t.timeseries)("tracesPerPlot",t.tracesPerPlot)}}function ae(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div"),c.Wb(1,"bd2-rhythmicityjob-params-rform",1),c.ec("displayParams",(function(e){return c.Ac(t),c.ic(2).emitDisplayParams(e)}))("rhythmicityRequests",(function(e){return c.Ac(t),c.ic(2).doAnalysis(e)})),c.Vb(),c.Rb(2,"hr"),c.Hc(3,se,1,2,"bd2-ts-plots",2),c.Vb()}if(2&t){const t=c.ic(2);c.Cb(1),c.oc("disabled",t.blocked)("totalTraces",t.totalTraces)("currentPage",t.currentPage),c.Cb(2),c.oc("ngIf",t.timeseries)}}function ne(t,e){if(1&t&&(c.Wb(0,"div"),c.Wb(1,"h3"),c.Jc(2,"Start rhythmicity test"),c.Vb(),c.Rb(3,"hr"),c.Hc(4,ae,4,4,"div",0),c.Vb()),2&t){const t=c.ic();c.Cb(4),c.oc("ngIf",!t.disabled)}}const ce=[{path:"",children:[{path:"new",component:(()=>{class t extends n{constructor(t,e,i,r,s){super(r,s),this.fetcher=t,this.analytics=e,this.userService=i,this.disabled=!1,this.blocked=!1,this.tracesPerPlot=5,this.totalTraces=0,this.currentPage=Lt.a.firstPage(),this.titlePart=" New Test"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(Ut.a)(1e3)).subscribe(t=>{const e=t.data;this.tracesPerPlot=Math.max(5,e.length/20),this.timeseries=e,this.totalTraces=t.totalTraces,this.currentPage=t.currentPage},t=>{console.log("Error in TS subscription: "+t),this.feedback.error(t)})}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}emitDisplayParams(t){this.fetcher.changeDisplayParams(t)}doAnalysis(t){t.isValid()&&(this.blocked=!0,this.rhythmicityService.newTest(this.assay,t).subscribe(e=>{this.feedback.success("Rhythmicity test submitted"),this.analytics.rhythmicityNew(t.method.name,this.assay.id,this.userService.currentUser.login),this.refreshModel(),this.goToRhythmicityHome()},t=>{this.blocked=!1,this.feedback.error(t)}))}updateModel(t){this.fetcher.experiment(t),super.updateModel(t)}}return t.\u0275fac=function(e){return new(e||t)(c.Qb($t.a),c.Qb(Nt.a),c.Qb(zt.a),c.Qb(g),c.Qb(xt.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["ng-component"]],features:[c.Bb([$t.a]),c.zb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams","rhythmicityRequests"],[3,"data","tracesPerPlot",4,"ngIf"],[3,"data","tracesPerPlot"]],template:function(t,e){1&t&&c.Hc(0,ne,5,1,"div",0),2&t&&c.oc("ngIf",e.assay)},directives:[r.m,ie,re.a],encapsulation:2}),t})()},{path:"",component:_t,pathMatch:"full"}]}];let oe=(()=>{class t{}return t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({factory:function(e){return new(e||t)},imports:[[s.f.forChild(ce)],s.f]}),t})();var be=i("wMBR"),le=i("a6j2"),de=i("ZTEM");let ue=(()=>{class t{}return t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({factory:function(e){return new(e||t)},imports:[[r.c,vt.j,vt.x,be.a,le.a,de.a,oe]]}),t})()}}]);