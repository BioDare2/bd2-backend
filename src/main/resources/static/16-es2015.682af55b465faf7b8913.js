(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{ja10:function(t,e,i){"use strict";i.r(e),i.d(e,"RhythmicityModule",(function(){return ae}));var r=i("ofXK"),s=i("tyNb"),a=i("yYXI");class n extends a.a{constructor(t,e){super(e),this.rhythmicityService=t,this.titlePart=" Rhythm"}goToRhythmicityHome(t){const e=this.expHomePath(t);e.push("rhythmicity"),this.router.navigate(e)}}var c=i("fXoL"),o=i("2Vo4"),b=i("PqYM"),l=i("B9cw"),d=i("Iab2"),h=i("7jps"),u=i("zQ7r"),p=i("Iurr"),m=i("tu3j"),f=i("FjDX");let g=(()=>{class t extends u.a{constructor(t,e=!1){super(e),this.rhythmicityService=t,this.finishedJob$=this.finished$,this.runningJob$=this.running$,this.allJob$=this.all$}get currentJob(){return this.currentAsset}initIntervalsKeeper(){return new m.a(1e3,3e4,6e5,2)}assayJob(t){this.input(t)}sameInput(t,e){return t[1]===e[1]&&t[0]===e[0]}fetchAsset([t,e]){return this.rhythmicityService.getJob(t,e)}hasFailed(t){return h.e.hasFailed(t)}isFinished(t){return h.e.isFinished(t)}isRunning(t){return h.e.isRunning(t)}assetToId(t){return t.jobId}assetToInput(t){return[t.parentId,t.jobId]}}return t.\u0275fac=function(e){return new(e||t)(c.ac(f.a),c.ac(p.a,8))},t.\u0275prov=c.Mb({token:t,factory:t.\u0275fac}),t})();var y=i("M9IT"),v=i("vkgz"),V=i("8jiw");let C=(()=>{class t extends V.a{constructor(t,e=!1){super(e),this.rhythmicityService=t,this.results$=this.data$}isClassicJob(){var t,e;return"BD2JTK"===(null===(e=null===(t=this.currentInput)||void 0===t?void 0:t.parameters)||void 0===e?void 0:e.METHOD)}sameInput(t,e){return h.e.sameJob(t,e)}assetToData(t,e){return t.results}fetchAsset(t){return this.rhythmicityService.getResults(t.parentId,t.jobId).pipe(Object(v.a)(t=>this.labelPatterns(t)))}sortingKey(t){switch(t.active){case"label":return t=>t.label;case"id":return t=>+t.id;case"empp":return t=>+t.result.empP;case"emppbh":return t=>+t.result.empPBH;case"p":return t=>+t.result.p;case"pbh":return t=>+t.result.pBH;case"tau":return t=>+t.result.tau;case"period":return t=>t.result.pattern.period;case"peak":return t=>t.result.pattern.peak;case"trough":return t=>t.result.pattern.trough;default:return console.error("Not implemented sorting for "+t.active),t=>0}}processData(t,e){return e?(this.rankResults(t,e.pValue,e.bhCorrection,this.isClassicJob()),t):t}labelPatterns(t){t.results.forEach(t=>{t.result.patternLabel=this.describePattern(t.result),t.result.pattern.shapeLabel=this.patternToShape(t.result.pattern)})}describePattern(t){const e=t.pattern,i=Math.round(10*e.period)/10,r=Math.round(100*e.peak)/100,s=Math.round(100*e.trough)/100;return`${this.patternToShape(e)}\t${i}\t${r}\t${s}`}patternToShape(t){switch(t.waveform){case"ASYM_COSINE":return.5===t.leftPortion?"COS":"ACOS";case"ASYM_COS_SPIKE":return"SPIKE";case"ASYM_COS_SPIKE_NEG":return"NPIKE";default:return t.waveform}}rankResults(t,e,i,r){t.forEach(t=>{const s=t.result;let a;a=r?i?s.pBH:s.p:i?s.empPBH:s.empP,s.rhythmic=a<e})}}return t.\u0275fac=function(e){return new(e||t)(c.ac(f.a),c.ac(p.a,8))},t.\u0275prov=c.Mb({token:t,factory:t.\u0275fac}),t})();var W=i("6tuW"),P=i("+0xr"),w=i("Dh3D"),I=i("bv9b");function S(t,e){1&t&&c.Rb(0,"mat-progress-bar",28)}function E(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"Id"),c.Vb())}function G(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(t.id)}}function T(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"Label"),c.Vb())}function x(t,e){if(1&t&&(c.Wb(0,"td",31),c.Gc(1),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(t.label)}}function j(t,e){1&t&&(c.Wb(0,"th",32),c.Gc(1,"Rhythmic"),c.Vb())}function D(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.Vb()),2&t){const t=e.$implicit;c.Gb("bold",t.result.rhythmic),c.Cb(1),c.Hc(t.result.rhythmic)}}function k(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"emp-p"),c.Vb())}function O(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,t.result.empP,"1.0-5"))}}function R(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"BH emp-p"),c.Vb())}function J(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,t.result.empPBH,"1.0-5"))}}function M(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"Tau"),c.Vb())}function H(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,t.result.tau,"1.0-2"))}}function $(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"p"),c.Vb())}function K(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,t.result.p,"1.0-5"))}}function A(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"BH p"),c.Vb())}function F(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,t.result.pBH,"1.0-5"))}}function B(t,e){1&t&&(c.Wb(0,"th",32),c.Gc(1,"Pattern"),c.Vb())}function U(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(t.result.patternLabel)}}function z(t,e){1&t&&(c.Wb(0,"th",32),c.Gc(1,"P.Shape"),c.Vb())}function q(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(t.result.pattern.shapeLabel)}}function N(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"P.Period"),c.Vb())}function _(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,t.result.pattern.period,"1.0-1"))}}function L(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"P.Peak"),c.Vb())}function Q(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,t.result.pattern.peak,"1.1-1"))}}function X(t,e){1&t&&(c.Wb(0,"th",32),c.Gc(1,"P.Peak"),c.Vb())}function Y(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,24*t.result.pattern.peak/t.result.pattern.period,"1.1-1"))}}function Z(t,e){1&t&&(c.Wb(0,"th",29),c.Gc(1,"P.Trough"),c.Vb())}function tt(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,t.result.pattern.trough,"1.1-1"))}}function et(t,e){1&t&&(c.Wb(0,"th",32),c.Gc(1,"P.Trough"),c.Vb())}function it(t,e){if(1&t&&(c.Wb(0,"td",30),c.Gc(1),c.jc(2,"number"),c.Vb()),2&t){const t=e.$implicit;c.Cb(1),c.Hc(c.lc(2,1,24*t.result.pattern.trough/t.result.pattern.period,"1.1-1"))}}function rt(t,e){1&t&&c.Rb(0,"tr",33)}function st(t,e){1&t&&c.Rb(0,"tr",34)}const at=function(){return[10,25,50,100,250]};let nt=(()=>{class t{constructor(t,e){this.fetcher=t,this.feedback=e,this.normEmpPColumns=["id","label","rhythmic","empp","tau"],this.normClsPColumns=["id","label","rhythmic","p","tau"],this.bhEmpPColumns=["id","label","rhythmic","emppbh","tau"],this.bhClsPColumns=["id","label","rhythmic","pbh","tau"],this.patternColumns=["shape","period","peak","trough"],this.patternColumnsC=["shape","period","peakc","troughc"],this.displayedColumns=this.normEmpPColumns,this.disablePaginator=!1}set job(t){t&&this.fetcher.input(t)}set statTestParams(t){if(t){this.fetcher.params(t);let e=t.bhCorrection?this.bhEmpPColumns:this.normEmpPColumns;this.fetcher.isClassicJob()&&(e=t.bhCorrection?this.bhClsPColumns:this.normClsPColumns),t.showPattern&&(e=e.concat(t.circadian?this.patternColumnsC:this.patternColumns)),this.displayedColumns=e}}ngOnInit(){this.fetcher.error$.subscribe(t=>this.feedback.error(t));const t=new y.d;t.pageSize=25,t.pageIndex=0,this.fetcher.page(t),this.fetcher.on(!0)}ngOnDestroy(){this.fetcher.close()}ngAfterViewInit(){}reload(){this.fetcher.refresh()}sortData(t){this.fetcher.sort(t)}loadPage(t){this.fetcher.page(t)}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(C),c.Qb(W.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-rhythmicity-results-mdtable"]],inputs:{job:"job",statTestParams:"statTestParams"},features:[c.Bb([C])],decls:55,vars:18,consts:[[1,"mat-elevation-z8"],["mode","indeterminate",4,"ngIf"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["paginator",""],["mat-table","","matSort","","aria-label","Results","matSort","","matSortActive","id","matSortDirection","asc",1,"full-width-table",3,"dataSource","matSortChange"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","label"],["mat-cell","","class","word_wrapping","style","max-width: 100px",4,"matCellDef"],["matColumnDef","rhythmic"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"bold",4,"matCellDef"],["matColumnDef","empp"],["matColumnDef","emppbh"],["matColumnDef","tau"],["matColumnDef","p"],["matColumnDef","pbh"],["matColumnDef","pattern"],["matColumnDef","shape"],["matColumnDef","period"],["matColumnDef","peak"],["matColumnDef","peakc"],["matColumnDef","trough"],["matColumnDef","troughc"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["paginator2",""],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"word_wrapping",2,"max-width","100px"],["mat-header-cell",""],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(c.Wb(0,"div",0),c.Ec(1,S,1,0,"mat-progress-bar",1),c.jc(2,"async"),c.Wb(3,"mat-paginator",2,3),c.ec("page",(function(t){return e.loadPage(t)})),c.Vb(),c.Wb(5,"table",4),c.ec("matSortChange",(function(t){return e.sortData(t)})),c.Ub(6,5),c.Ec(7,E,2,0,"th",6),c.Ec(8,G,2,1,"td",7),c.Tb(),c.Ub(9,8),c.Ec(10,T,2,0,"th",6),c.Ec(11,x,2,1,"td",9),c.Tb(),c.Ub(12,10),c.Ec(13,j,2,0,"th",11),c.Ec(14,D,2,3,"td",12),c.Tb(),c.Ub(15,13),c.Ec(16,k,2,0,"th",6),c.Ec(17,O,3,4,"td",7),c.Tb(),c.Ub(18,14),c.Ec(19,R,2,0,"th",6),c.Ec(20,J,3,4,"td",7),c.Tb(),c.Ub(21,15),c.Ec(22,M,2,0,"th",6),c.Ec(23,H,3,4,"td",7),c.Tb(),c.Ub(24,16),c.Ec(25,$,2,0,"th",6),c.Ec(26,K,3,4,"td",7),c.Tb(),c.Ub(27,17),c.Ec(28,A,2,0,"th",6),c.Ec(29,F,3,4,"td",7),c.Tb(),c.Ub(30,18),c.Ec(31,B,2,0,"th",11),c.Ec(32,U,2,1,"td",7),c.Tb(),c.Ub(33,19),c.Ec(34,z,2,0,"th",11),c.Ec(35,q,2,1,"td",7),c.Tb(),c.Ub(36,20),c.Ec(37,N,2,0,"th",6),c.Ec(38,_,3,4,"td",7),c.Tb(),c.Ub(39,21),c.Ec(40,L,2,0,"th",6),c.Ec(41,Q,3,4,"td",7),c.Tb(),c.Ub(42,22),c.Ec(43,X,2,0,"th",11),c.Ec(44,Y,3,4,"td",7),c.Tb(),c.Ub(45,23),c.Ec(46,Z,2,0,"th",6),c.Ec(47,tt,3,4,"td",7),c.Tb(),c.Ub(48,24),c.Ec(49,et,2,0,"th",11),c.Ec(50,it,3,4,"td",7),c.Tb(),c.Ec(51,rt,1,0,"tr",25),c.Ec(52,st,1,0,"tr",26),c.Vb(),c.Wb(53,"mat-paginator",2,27),c.ec("page",(function(t){return e.loadPage(t)})),c.Vb(),c.Vb()),2&t&&(c.Cb(1),c.oc("ngIf",c.kc(2,14,e.fetcher.isBusy$)),c.Cb(2),c.oc("length",e.fetcher.dataLength)("disabled",e.disablePaginator)("pageSize",(null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageSize)||25)("pageIndex",null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageIndex)("pageSizeOptions",c.qc(16,at)),c.Cb(2),c.oc("dataSource",e.fetcher.results$),c.Cb(46),c.oc("matHeaderRowDef",e.displayedColumns),c.Cb(1),c.oc("matRowDefColumns",e.displayedColumns),c.Cb(1),c.oc("length",e.fetcher.dataLength)("disabled",e.disablePaginator)("pageSize",(null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageSize)||25)("pageIndex",null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageIndex)("pageSizeOptions",c.qc(17,at)))},directives:[r.m,y.a,P.n,w.a,P.c,P.i,P.b,P.k,P.m,I.a,P.h,w.b,P.a,P.j,P.l],pipes:[r.b,r.f],styles:[".full-width-table[_ngcontent-%COMP%] {\n      width: 100%;\n    }"]}),t})();var ct=i("BOp5"),ot=i("9+85"),bt=i("Wp6s"),lt=i("f0Cb"),dt=i("Xa2L"),ht=i("3Pt+"),ut=i("kmnG"),pt=i("QibW");function mt(t,e){if(1&t&&(c.Wb(0,"mat-radio-button",5),c.Gc(1),c.Vb()),2&t){const t=e.$implicit;c.oc("value",t),c.Cb(1),c.Hc(t)}}let ft=(()=>{class t{constructor(){this.values=[1e-4,.001,.005,.01,.05,.1],this.pvalue=.001,this.pvalue$=new c.o}ngOnInit(){}ngAfterViewInit(){this.pvalue$.emit(this.pvalue)}selected(t){this.pvalue$.emit(t.value)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-pvalue-form"]],outputs:{pvalue$:"pvalue$"},decls:8,vars:2,consts:[[1,"form-inline"],[1,"mx-auto","text-center"],["id","pvalues-label",1,"mb-1"],["aria-label","Select p-value","aria-labelledby","pvalues-label",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(c.Wb(0,"form",0),c.Wb(1,"div",1),c.Wb(2,"mat-label",2),c.Wb(3,"strong"),c.Gc(4,"p-value threshold:"),c.Vb(),c.Vb(),c.Wb(5,"div"),c.Wb(6,"mat-radio-group",3),c.ec("change",(function(t){return e.selected(t)})),c.Ec(7,mt,2,2,"mat-radio-button",4),c.Vb(),c.Vb(),c.Vb(),c.Vb()),2&t&&(c.Cb(6),c.oc("value",e.pvalue),c.Cb(1),c.oc("ngForOf",e.values))},directives:[ht.C,ht.q,ht.r,ut.g,pt.b,r.l,pt.a],styles:[".mat-radio-button[_ngcontent-%COMP%]  {\n      margin-right: 15px;\n    }"]}),t})();var gt=i("1jcm");let yt=(()=>{class t{constructor(){this.options=new c.o,this.currentOptions=new h.h(0,!1,!1,!1)}ngOnInit(){}pValue(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.pValue=t,this.options.next(this.currentOptions)}bhCorrection(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.bhCorrection=t,this.options.next(this.currentOptions)}circadian(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.circadian=t,this.options.next(this.currentOptions)}showPattern(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.showPattern=t,this.options.next(this.currentOptions)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-stat-test-options-widget"]],outputs:{options:"options"},decls:14,vars:1,consts:[[3,"pvalue$"],[2,"margin-top","0.5em","text-align","center"],[3,"change"],["pattern",""],[3,"disabled","change"]],template:function(t,e){if(1&t&&(c.Wb(0,"mat-card"),c.Wb(1,"mat-card-content"),c.Wb(2,"section"),c.Wb(3,"bd2-pvalue-form",0),c.ec("pvalue$",(function(t){return e.pValue(t)})),c.Vb(),c.Vb(),c.Wb(4,"section",1),c.Wb(5,"mat-slide-toggle",2),c.ec("change",(function(t){return e.bhCorrection(t.checked)})),c.Gc(6,"Benjamini Hochberg correction"),c.Vb(),c.Vb(),c.Wb(7,"section",1),c.Wb(8,"mat-slide-toggle",2,3),c.ec("change",(function(t){return e.showPattern(t.checked)})),c.Gc(10,"show pattern"),c.Vb(),c.Gc(11," \xa0 "),c.Wb(12,"mat-slide-toggle",4),c.ec("change",(function(t){return e.circadian(t.checked)})),c.Gc(13,"circadian unit"),c.Vb(),c.Vb(),c.Vb(),c.Vb()),2&t){const t=c.vc(9);c.Cb(12),c.oc("disabled",!t.checked)}},directives:[bt.a,bt.c,ft,gt.a],encapsulation:2}),t})();function vt(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div",5),c.Wb(1,"button",13),c.ec("click",(function(){return c.xc(t),c.ic(2).delete()})),c.Wb(2,"i",4),c.Gc(3,"delete_forever"),c.Vb(),c.Vb(),c.Wb(4,"button",14),c.ec("click",(function(){return c.xc(t),c.ic(2).export()})),c.Wb(5,"i",4),c.Gc(6,"save_alt"),c.Vb(),c.Vb(),c.Vb()}}function Vt(t,e){if(1&t&&(c.Wb(0,"div",15),c.Rb(1,"br"),c.Gc(2),c.Vb()),2&t){const t=c.ic().ngIf;c.Cb(2),c.Ic("ERROR: ",t.jobStatus.message," ")}}function Ct(t,e){1&t&&(c.Wb(0,"div"),c.Wb(1,"mat-card"),c.Wb(2,"mat-card-content"),c.Rb(3,"mat-spinner",16),c.Vb(),c.Vb(),c.Vb())}function Wt(t,e){1&t&&(c.Wb(0,"div"),c.Wb(1,"mat-card"),c.Wb(2,"mat-card-content"),c.Wb(3,"div",17),c.Gc(4,"It may take up to 10 minutes to test for rhythmicity"),c.Vb(),c.Vb(),c.Vb(),c.Vb())}function Pt(t,e){if(1&t){const t=c.Xb();c.Ub(0),c.Wb(1,"bd2-stat-test-options-widget",18),c.ec("options",(function(e){return c.xc(t),c.ic(3).statTestOptions(e)})),c.Vb(),c.Rb(2,"bd2-rhythmicity-results-mdtable",19),c.Tb()}if(2&t){const t=e.ngIf,i=c.ic(3);c.Cb(2),c.oc("statTestParams",i.statTestParams)("job",t)}}function wt(t,e){if(1&t&&(c.Wb(0,"div"),c.Rb(1,"mat-divider"),c.Ec(2,Ct,4,0,"div",12),c.jc(3,"async"),c.Ec(4,Wt,5,0,"div",12),c.Ec(5,Pt,3,2,"ng-container",12),c.jc(6,"async"),c.Vb()),2&t){const t=c.ic().ngIf,e=c.ic();c.Cb(2),c.oc("ngIf",c.kc(3,3,e.rhythmicityJobDatasource.isReloading$)),c.Cb(2),c.oc("ngIf","SUBMITTED"===t.jobStatus.state),c.Cb(1),c.oc("ngIf",c.kc(6,5,e.rhythmicityJobDatasource.finishedJob$))}}function It(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div",1),c.Wb(1,"div",2),c.Wb(2,"div",3),c.ec("click",(function(){return c.xc(t),c.ic().toggleExpanded()})),c.Wb(3,"i",4),c.Gc(4,"waves"),c.Vb(),c.Gc(5),c.jc(6,"date"),c.Rb(7,"br"),c.Gc(8),c.Vb(),c.Wb(9,"div",5),c.Gc(10),c.Wb(11,"a",6),c.ec("click",(function(){return c.xc(t),c.ic().refresh()})),c.Wb(12,"i",7),c.Gc(13,"refresh"),c.Vb(),c.Vb(),c.Vb(),c.Vb(),c.Wb(14,"div",8),c.Wb(15,"mat-card"),c.Wb(16,"mat-card-content"),c.Wb(17,"div",9),c.Ec(18,vt,7,0,"div",10),c.Gc(19),c.Ec(20,Vt,3,1,"div",11),c.Vb(),c.Vb(),c.Vb(),c.Ec(21,wt,7,7,"div",12),c.Vb(),c.Vb()}if(2&t){const t=e.ngIf,i=c.ic();c.Cb(3),c.Dc("color",i.isExpanded?"green":"red")("font-size",150,"%"),c.Cb(2),c.Jc(" \xa0",i.shortUUID(t.jobId)," (",c.kc(6,13,i.toLocalDateTime(t.jobStatus.submitted)),") "),c.Cb(3),c.Jc(" ",i.friendlyMethod(t.parameters.METHOD),"; \xa0 waveforms: ",t.parameters.PRESET," "),c.Cb(2),c.Ic(" ",t.jobStatus.state," "),c.Cb(8),c.oc("ngIf",i.assay.security.canWrite),c.Cb(1),c.Ic(" ",t.parameters.PARAMS_SUMMARY," "),c.Cb(1),c.oc("ngIf",t.jobStatus.message&&"OK"!=t.jobStatus.message),c.Cb(1),c.oc("ngIf",i.isExpanded)}}let St=(()=>{class t{constructor(t,e,i,r){this.rhythmicityService=t,this.rhythmicityJobDatasource=e,this.feedback=i,this.dialogs=r,this.deleted=new c.o,this.isExpanded=!1,this.expandedToogleStream=new o.a(!1)}set expanded(t){this.isExpanded=t,this.expandedToogleStream.next(t)}ngOnInit(){this.initSubscriptions()}ngOnDestroy(){this.rhythmicityJobDatasource.close(),this.expandedToogleStream&&this.expandedToogleStream.complete()}ngOnChanges(t){(t.jobId||t.assay)&&this.jobId&&this.assay&&this.rhythmicityJobDatasource.assayJob([this.assay.id,this.jobId])}statTestOptions(t){const e=Object(b.a)(1).subscribe(()=>{this.statTestParams=t,e&&e.unsubscribe()})}export(){this.rhythmicityService.downloadJob(this.assay.id,this.jobId).subscribe(t=>{this.saveJobBlob(t,this.assay.id,this.jobId)},t=>this.feedback.error(t))}saveJobBlob(t,e,i){d.saveAs(t,e+"_job"+this.shortUUID(i)+".rhythmicity.csv")}refresh(){this.rhythmicityJobDatasource.refresh(),this.resultsTable&&this.resultsTable.reload()}delete(){const t=this.assay,e=this.rhythmicityJobDatasource.currentJob;this.dialogs.confirm("Do you want to delete analysis: "+e.jobId,e.parameters.PARAMS_SUMMARY).subscribe(i=>{i&&this.doDelete(t,e.jobId)})}initSubscriptions(){this.rhythmicityJobDatasource.on(!0),this.rhythmicityJobDatasource.error$.forEach(t=>this.feedback.error(t))}doDelete(t,e){this.rhythmicityService.deleteJob(t,e).subscribe(t=>{this.deleted.next(t),this.feedback.success("Job: "+this.shortUUID(e)+" deleted")},t=>{this.feedback.error(t)})}toggleExpanded(){this.expanded=!this.isExpanded}toLocalDateTime(t){return l.b.deserialize(t).date}shortUUID(t){return Object(ct.c)(t)}friendlyMethod(t){return"BD2JTK"===t?"Classic JTK":"BD2EJTK"===t?"BD2 eJTK":t}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(f.a),c.Qb(g),c.Qb(W.a),c.Qb(ot.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-rhythmicity-job-pane"]],viewQuery:function(t,e){var i;1&t&&c.Mc(nt,!0),2&t&&c.uc(i=c.fc())&&(e.resultsTable=i.first)},inputs:{jobId:"jobId",assay:"assay",expanded:"expanded"},outputs:{deleted:"deleted"},features:[c.Bb([g]),c.Ab],decls:2,vars:3,consts:[["class","card mb-2",4,"ngIf"],[1,"card","mb-2"],[1,"card-header","clearfix"],["role","button",1,"float-left",3,"click"],[1,"material-icons","bd-icon"],[1,"float-right"],["role","button","aria-label","refresh",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"card-body"],[1,"clearfix"],["class","float-right",4,"ngIf"],["class","text-danger","style","word-wrap: break-word;",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-danger","btn-sm","mr-1",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"text-danger",2,"word-wrap","break-word"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"],[3,"options"],[3,"statTestParams","job"]],template:function(t,e){1&t&&(c.Ec(0,It,22,15,"div",0),c.jc(1,"async")),2&t&&c.oc("ngIf",c.kc(1,1,e.rhythmicityJobDatasource.allJob$))},directives:[r.m,bt.a,bt.c,lt.a,dt.b,yt,nt],pipes:[r.b,r.e],encapsulation:2}),t})();var Et=i("GVyA");function Gt(t,e){if(1&t&&(c.Wb(0,"div"),c.Wb(1,"strong"),c.Gc(2),c.Vb(),c.Vb()),2&t){const t=c.ic(2);c.Cb(2),c.Ic("Submitted jobs: ",t.jobs.length,"")}}function Tt(t,e){1&t&&(c.Wb(0,"div"),c.Gc(1," No jobs submitted, start a new test. "),c.Vb())}const xt=function(){return["new"]};function jt(t,e){1&t&&(c.Wb(0,"a",7),c.Gc(1," New test "),c.Vb()),2&t&&c.oc("routerLink",c.qc(1,xt))}function Dt(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div"),c.Wb(1,"bd2-rhythmicity-job-pane",8),c.ec("deleted",(function(e){return c.xc(t),c.ic(2).remove(e)}))("finished",(function(e){return c.xc(t),c.ic(2).refreshJob(e)})),c.Vb(),c.Vb()}if(2&t){const t=e.$implicit,i=e.index,r=c.ic(2);c.Cb(1),c.oc("assay",r.assay)("jobId",t)("expanded",r.expandAll||0==i)}}function kt(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div"),c.Wb(1,"h3"),c.Gc(2,"Rhythmicity tests"),c.Vb(),c.Rb(3,"hr"),c.Wb(4,"div",1),c.Wb(5,"div",2),c.Ec(6,Gt,3,1,"div",0),c.Ec(7,Tt,2,0,"div",0),c.Vb(),c.Wb(8,"div",3),c.Ec(9,jt,2,2,"a",4),c.Wb(10,"button",5),c.ec("click",(function(){return c.xc(t),c.ic().refresh()})),c.Gc(11,"Refresh "),c.Vb(),c.Vb(),c.Vb(),c.Rb(12,"hr"),c.Ec(13,Dt,2,3,"div",6),c.Rb(14,"hr"),c.Vb()}if(2&t){const t=c.ic();c.Cb(6),c.oc("ngIf",t.jobs&&t.jobs.length>0),c.Cb(1),c.oc("ngIf",!t.jobs||0==t.jobs.length),c.Cb(2),c.oc("ngIf",t.assay.security.canWrite),c.Cb(1),c.oc("disabled",t.blocked),c.Cb(3),c.oc("ngForOf",t.jobsIds)}}let Ot=(()=>{class t extends n{constructor(t,e){super(t,e),this.expandAll=!1,this.blocked=!1,this.titlePart=" Rhythm"}updateModel(t){super.updateModel(t),t&&this.loadJobs(t)}loadJobs(t,e=!1){this.blocked=!0,this.rhythmicityService.getJobs(t).subscribe(i=>{this.jobs=i,this.refreshJobsInfo(i),this.exportURL=this.rhythmicityService.exportURL(t),e&&this.refreshPanes(),this.blocked=!1},t=>{this.blocked=!1,this.feedback.error(t)})}refreshJobsInfo(t){this.jobsIds=t.map(t=>t.jobId)}refresh(){this.loadJobs(this.assay,!0)}refreshPanes(){this.panes&&this.panes.forEach(t=>t.refresh())}remove(t){const e=this.jobs.findIndex(e=>t.jobId===e.jobId);e>=0&&(this.jobs.splice(e,1),this.refreshJobsInfo(this.jobs))}refreshJob(t){const e=this.jobs.findIndex(e=>t.jobId===e.jobId);e>=0&&(this.jobs[e]=t,this.refreshJobsInfo(this.jobs))}calculateQueuing(t){return t.filter(t=>this.isQueueing(t.jobStatus.state)).length}isQueueing(t){switch(t){case"WAITING":case"PROCESSING":case"SUBMITTED":return!0;default:return!1}}checkFinished(t){return!!t.find(t=>this.isFinished(t.jobStatus.state))}isFinished(t){switch(t){case"SUCCESS":case"FINISHED":case"COMPLETED":return!0;default:return!1}}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(f.a),c.Qb(Et.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){var i;1&t&&c.Mc(St,!0),2&t&&c.uc(i=c.fc())&&(e.panes=i)},features:[c.zb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-body"],["class","btn btn-primary mr-1",3,"routerLink",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","click"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary","mr-1",3,"routerLink"],[3,"assay","jobId","expanded","deleted","finished"]],template:function(t,e){1&t&&c.Ec(0,kt,15,5,"div",0),2&t&&c.oc("ngIf",e.assay)},directives:[r.m,r.l,s.e,St],encapsulation:2}),t})();var Rt=i("QBpm"),Jt=i("Kj3r"),Mt=i("bngM"),Ht=i("ZMwR"),$t=i("naqj"),Kt=i("Tl2h"),At=i("wcxA");function Ft(t,e){if(1&t&&(c.Wb(0,"option",29),c.Gc(1),c.Vb()),2&t){const t=e.$implicit;c.oc("value",t.name),c.Cb(1),c.Hc(t.label)}}function Bt(t,e){1&t&&(c.Wb(0,"div",30),c.Wb(1,"div",31),c.Gc(2," Rhythmicity tests are generally used for short, sparse timeseries. "),c.Rb(3,"br"),c.Gc(4," The current limit is 5 or 4 days of hourly sampled data for eJTK preset and BD2 preset respectivelly."),c.Rb(5,"br"),c.Gc(6," Generally the raw data are being analysed, but we also enabled a linear detrended option. "),c.Vb(),c.Vb())}function Ut(t,e){if(1&t&&(c.Wb(0,"option",29),c.Gc(1),c.Vb()),2&t){const t=e.$implicit;c.oc("value",t.name),c.Cb(1),c.Hc(t.label)}}function zt(t,e){1&t&&(c.Wb(0,"div",30),c.Wb(1,"div",31),c.Wb(2,"p"),c.Wb(3,"b"),c.Gc(4,"Classic JTK"),c.Vb(),c.Gc(5," is the implementation of JTK_CYCLE from "),c.Wb(6,"a",32),c.Gc(7,"Michael E. Hughes et al. 2010"),c.Vb(),c.Gc(8," a standard method for detecting rhythmicity in genome-scale datasets. "),c.Rb(9,"br"),c.Gc(10,"The method is fast but it is reliable only when it tests against small set of patterns, we provide patterns of 24h cosines with different phases."),c.Vb(),c.Wb(11,"p"),c.Wb(12,"b"),c.Gc(13,"BD2 eJTK"),c.Vb(),c.Gc(14," is the BioDare2 implementation of Empirical JTK_CYCLE with asymmetry search from "),c.Wb(15,"a",33),c.Gc(16,"Alan L. Hutchison et al. 2015"),c.Vb(),c.Gc(17,". It is similar to the classic JTK method but with p values empirically calculated against set of random noise data. "),c.Rb(18,"br"),c.Gc(19,"This modification permits using larger sets of test patterns and it provides better accuracy. However, this method is much slower so it can only analyze timeseries only up to 5 days of data (though the Classic JTK method was never intended to be used with such a long data)."),c.Vb(),c.Vb(),c.Vb())}function qt(t,e){if(1&t&&(c.Wb(0,"option",29),c.Gc(1),c.Vb()),2&t){const t=e.$implicit;c.oc("value",t.name),c.Cb(1),c.Hc(t.label)}}function Nt(t,e){1&t&&(c.Wb(0,"div",30),c.Wb(1,"div",31),c.Gc(2," Presets determine set of pattern curves against the comparison test is run."),c.Rb(3,"br"),c.Wb(4,"ul"),c.Wb(5,"li"),c.Gc(6,"Cosine 24h 1/2/4h are set of cosine curves of 24h periods, and phases spread every 1, 2, or 4 hours. To be used mainly with Classic JTK."),c.Vb(),c.Wb(7,"li"),c.Gc(8,"eJTK Classic is recommended for typical omics-like data for which eJTK method was developed. "),c.Rb(9,"br"),c.Gc(10," It works well for short data (48h, 2h- 1h-sampled) when actual period is within range 22-26 hours."),c.Rb(11,"br"),c.Gc(12," The patterns are series of cosine-like waveforms with 24h period, phases by 2hours and range of asymmetries by 2h (see original paper)."),c.Rb(13,"br"),c.Vb(),c.Wb(14,"li"),c.Gc(15,"BD2 Classic can detect non 24 periods and some forms of the spikes."),c.Rb(16,"br"),c.Gc(17," As it compares against much more patterns it has a weaker power."),c.Rb(18,"br"),c.Gc(19," It should be used when there is a good reason to suspect periods outside 22-26h range."),c.Rb(20,"br"),c.Gc(21," The patterns are series of cosine-like waverforms with periods from 18-35hours, for each period there are multiple "),c.Wb(22,"b"),c.Gc(23,"circadian"),c.Vb(),c.Gc(24," phases with step 2h (so each period value generates the same number of patterns but the peaks in absolute units do not coincide) and a range of assymetries by 2h in circadian units (see original paper). The preset contains also additional some spike patterns. "),c.Vb(),c.Vb(),c.Vb(),c.Vb())}const _t=function(){return[10,25,50,100,200]};let Lt=(()=>{class t extends At.a{constructor(t){super(t),this.methodOptions=h.d,this.presetOptions=h.b,this.dataHelp=!1,this.presetsHelp=!1,this.methodHelp=!1,this.rhythmicityRequests=new c.o,this.detrendingOptions=[Kt.b.NO_DTR,Kt.b.LIN_DTR],this.methodForm=this.mainForm.get("method"),this.presetForm=this.mainForm.get("preset")}buildMainForm(){return this.fb.group({displayParams:this.displayParamsForm,periodScale:this.fb.group({periodMin:[18,[ht.A.required]],periodMax:[34,[ht.A.required]]},{validator:t=>this.validPeriodScale(t.value)}),method:[h.f.BD2EJTK.name,[ht.A.required]],preset:[h.a.EJTK_CLASSIC.name,[ht.A.required]]})}ngOnInit(){super.ngOnInit(),this.methodForm.valueChanges.subscribe(t=>this.setPresetOptions(t))}ngOnDestroy(){super.ngOnDestroy()}setPresetOptions(t){t===h.f.BD2EJTK.name?(this.presetOptions=h.b,this.presetForm.setValue(h.a.EJTK_CLASSIC.name)):t===h.f.BD2JTK.name?(this.presetOptions=h.c,this.presetForm.setValue(h.a.COS_2H.name)):this.presetOptions=[]}defaultDetrending(){return Kt.b.NO_DTR.name}validPeriodScale(t){const e=t.periodMin,i=t.periodMax;return e<10?{validPeriodScale:"Period min must >= 10"}:i<10?{validPeriodScale:"Period max must >= 10"}:i>50?{validPeriodScale:"Period max must < 50"}:e>=i?{validPeriodScale:"Period min must be < max"}:null}analyse(){if(this.mainForm.invalid)return;const t=this.map2RhythmicityRequest(this.mainForm.value);t.isValid()&&this.rhythmicityRequests.next(t)}map2RhythmicityRequest(t){const e=new h.g;return e.detrending=Kt.b.get(t.displayParams.detrending),e.method=h.f.get(t.method),e.preset=h.a.get(t.preset),e.periodMax=t.periodScale.periodMax,e.periodMin=t.periodScale.periodMin,e.windowEnd=t.displayParams.timeScale.timeEnd,e.windowStart=t.displayParams.timeScale.timeStart,e}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(ht.d))},t.\u0275cmp=c.Kb({type:t,selectors:[["bd2-rhythmicityjob-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams",rhythmicityRequests:"rhythmicityRequests"},features:[c.zb],decls:61,vars:15,consts:[["role","form",1,"form-horizontal",3,"formGroup"],["formGroupName","displayParams"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-sm-4"],["for","windowStart",1,"col-sm-1"],[1,"col-sm-2"],["formControlName","timeStart","id","windowStart","min","0","required","","size","5","step","any","type","number",1,"form-control"],["for","windowEnd",1,"col-sm-1"],["formControlName","timeEnd","id","windowEnd","min","0","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"form-group","row"],["for","detrending",1,"col-sm-4"],[3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"col-sm-6"],["formControlName","detrending","id","detrending","required","",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["class","col-sm-12",4,"ngIf"],["for","method",1,"col-sm-4"],["formControlName","method","id","method","required","",1,"form-control"],["formControlName","preset","id","preset","required","",1,"form-control"],["formGroupName","periodScale",1,"form-group","row",3,"hidden"],["for","periodMin",1,"col-sm-1"],["formControlName","periodMin","id","periodMin","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],["for","periodMax",1,"col-sm-1"],["formControlName","periodMax","id","periodMax","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],["type","button",1,"btn","btn-primary",3,"disabled","click"],[3,"value"],[1,"col-sm-12"],["role","alert","type","info",1,"alert","alert-info"],["href","https://dx.doi.org/10.1177%2F0748730410379711"],["href"," https://doi.org/10.1371/journal.pcbi.1004094","target","_blank"]],template:function(t,e){1&t&&(c.Wb(0,"form",0),c.Wb(1,"div",1),c.Wb(2,"div",2),c.Wb(3,"label",3),c.Gc(4,"Data window"),c.Vb(),c.Wb(5,"label",4),c.Gc(6,"from:"),c.Vb(),c.Wb(7,"div",5),c.Rb(8,"input",6),c.Vb(),c.Wb(9,"label",7),c.Gc(10,"to:"),c.Vb(),c.Wb(11,"div",5),c.Rb(12,"input",8),c.Vb(),c.Vb(),c.Wb(13,"div",9),c.Wb(14,"label",10),c.Gc(15,"Input Data "),c.Wb(16,"a",11),c.ec("click",(function(){return e.dataHelp=!e.dataHelp})),c.Wb(17,"i",12),c.Gc(18,"help"),c.Vb(),c.Vb(),c.Vb(),c.Wb(19,"div",13),c.Wb(20,"select",14),c.Ec(21,Ft,2,2,"option",15),c.Vb(),c.Vb(),c.Vb(),c.Vb(),c.Ec(22,Bt,7,0,"div",16),c.Wb(23,"div",9),c.Wb(24,"label",17),c.Gc(25,"Test Method "),c.Wb(26,"a",11),c.ec("click",(function(){return e.methodHelp=!e.methodHelp})),c.Wb(27,"i",12),c.Gc(28,"help"),c.Vb(),c.Vb(),c.Vb(),c.Wb(29,"div",13),c.Wb(30,"select",18),c.Ec(31,Ut,2,2,"option",15),c.Vb(),c.Vb(),c.Vb(),c.Ec(32,zt,20,0,"div",16),c.Wb(33,"div",9),c.Wb(34,"label",17),c.Gc(35,"Analysis Presets "),c.Wb(36,"a",11),c.ec("click",(function(){return e.presetsHelp=!e.presetsHelp})),c.Wb(37,"i",12),c.Gc(38,"help"),c.Vb(),c.Vb(),c.Vb(),c.Wb(39,"div",13),c.Wb(40,"select",19),c.Ec(41,qt,2,2,"option",15),c.Vb(),c.Vb(),c.Vb(),c.Ec(42,Nt,25,0,"div",16),c.Wb(43,"div",20),c.Wb(44,"label",3),c.Gc(45,"Expected periods"),c.Vb(),c.Wb(46,"label",21),c.Gc(47,"from:"),c.Vb(),c.Wb(48,"div",5),c.Rb(49,"input",22),c.Vb(),c.Wb(50,"label",23),c.Gc(51,"to:"),c.Vb(),c.Wb(52,"div",5),c.Rb(53,"input",24),c.Vb(),c.Vb(),c.Wb(54,"div",9),c.Rb(55,"label",5),c.Wb(56,"div",25),c.Wb(57,"mat-paginator",26,27),c.ec("page",(function(t){return e.loadDataPage(t)})),c.Vb(),c.Vb(),c.Vb(),c.Wb(59,"button",28),c.ec("click",(function(){return e.analyse()})),c.Gc(60,"Test Rhythmicity "),c.Vb(),c.Vb()),2&t&&(c.oc("formGroup",e.mainForm),c.Cb(21),c.oc("ngForOf",e.detrendingOptions),c.Cb(1),c.oc("ngIf",e.dataHelp),c.Cb(9),c.oc("ngForOf",e.methodOptions),c.Cb(1),c.oc("ngIf",e.methodHelp),c.Cb(9),c.oc("ngForOf",e.presetOptions),c.Cb(1),c.oc("ngIf",e.presetsHelp),c.Cb(1),c.oc("hidden",!0),c.Cb(14),c.oc("length",e.totalTraces)("disabled",e.disabledPagination)("pageSize",e.currentPage.pageSize)("pageIndex",e.currentPage.pageIndex)("pageSizeOptions",c.qc(14,_t)),c.Cb(2),c.oc("disabled",e.disabled||e.mainForm.invalid))},directives:[ht.C,ht.q,ht.h,ht.i,ht.c,ht.u,ht.p,ht.g,ht.y,ht.z,r.l,r.m,y.a,ht.t,ht.B],encapsulation:2}),t})();var Qt=i("nA4b");function Xt(t,e){if(1&t&&c.Rb(0,"bd2-ts-plots",3),2&t){const t=c.ic(3);c.oc("data",t.timeseries)("tracesPerPlot",t.tracesPerPlot)}}function Yt(t,e){if(1&t){const t=c.Xb();c.Wb(0,"div"),c.Wb(1,"bd2-rhythmicityjob-params-rform",1),c.ec("displayParams",(function(e){return c.xc(t),c.ic(2).emitDisplayParams(e)}))("rhythmicityRequests",(function(e){return c.xc(t),c.ic(2).doAnalysis(e)})),c.Vb(),c.Rb(2,"hr"),c.Ec(3,Xt,1,2,"bd2-ts-plots",2),c.Vb()}if(2&t){const t=c.ic(2);c.Cb(1),c.oc("disabled",t.blocked)("totalTraces",t.totalTraces)("currentPage",t.currentPage),c.Cb(2),c.oc("ngIf",t.timeseries)}}function Zt(t,e){if(1&t&&(c.Wb(0,"div"),c.Wb(1,"h3"),c.Gc(2,"Start rhythmicity test"),c.Vb(),c.Rb(3,"hr"),c.Ec(4,Yt,4,4,"div",0),c.Vb()),2&t){const t=c.ic();c.Cb(4),c.oc("ngIf",!t.disabled)}}const te=[{path:"",children:[{path:"new",component:(()=>{class t extends n{constructor(t,e,i,r,s){super(r,s),this.fetcher=t,this.analytics=e,this.userService=i,this.disabled=!1,this.blocked=!1,this.tracesPerPlot=5,this.totalTraces=0,this.currentPage=Mt.a.firstPage(),this.titlePart=" New Test"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(Jt.a)(1e3)).subscribe(t=>{const e=t.data;this.tracesPerPlot=Math.max(5,e.length/20),this.timeseries=e,this.totalTraces=t.totalTraces,this.currentPage=t.currentPage},t=>{console.log("Error in TS subscription: "+t),this.feedback.error(t)})}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}emitDisplayParams(t){this.fetcher.changeDisplayParams(t)}doAnalysis(t){t.isValid()&&(this.blocked=!0,this.rhythmicityService.newTest(this.assay,t).subscribe(e=>{this.feedback.success("Rhythmicity test submitted"),this.analytics.rhythmicityNew(t.method.name,this.assay.id,this.userService.currentUser.login),this.refreshModel(),this.goToRhythmicityHome()},t=>{this.blocked=!1,this.feedback.error(t)}))}updateModel(t){this.fetcher.experiment(t),super.updateModel(t)}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(Rt.a),c.Qb(Ht.a),c.Qb($t.a),c.Qb(f.a),c.Qb(Et.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["ng-component"]],features:[c.Bb([Rt.a]),c.zb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams","rhythmicityRequests"],[3,"data","tracesPerPlot",4,"ngIf"],[3,"data","tracesPerPlot"]],template:function(t,e){1&t&&c.Ec(0,Zt,5,1,"div",0),2&t&&c.oc("ngIf",e.assay)},directives:[r.m,Lt,Qt.a],encapsulation:2}),t})()},{path:"",component:Ot,pathMatch:"full"}]}];let ee=(()=>{class t{}return t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({factory:function(e){return new(e||t)},imports:[[s.f.forChild(te)],s.f]}),t})();var ie=i("wMBR"),re=i("a6j2"),se=i("ZTEM");let ae=(()=>{class t{}return t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({factory:function(e){return new(e||t)},imports:[[r.c,ht.j,ht.x,ie.a,re.a,se.a,ee]]}),t})()}}]);