(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{ja10:function(t,e,i){"use strict";i.r(e),i.d(e,"RhythmicityModule",(function(){return ue}));var r=i("ofXK"),s=i("tyNb"),a=i("yYXI");class n extends a.a{constructor(t,e){super(e),this.rhythmicityService=t,this.titlePart=" Rhythm"}goToRhythmicityHome(t){const e=this.expHomePath(t);e.push("rhythmicity"),this.router.navigate(e)}}var o=i("fXoL"),c=i("2Vo4"),b=i("PqYM"),l=i("B9cw"),h=i("Iab2"),d=i("zQ7r"),u=i("Iurr"),p=i("tu3j"),m=i("lJxs"),f=i("UsWK");let g=(()=>{class t{constructor(t){this.BD2REST=t}newTest(t,e){return this.BD2REST.rhythmicityNew(t.id,e)}getJob(t,e){return this.BD2REST.rhythmicityJob(t,e)}getJobs(t){return this.BD2REST.rhythmicityJobs(t.id).pipe(Object(m.a)(t=>t.data))}getResults(t,e){return this.BD2REST.rhythmicityResults(t,e)}exportURL(t){return this.BD2REST.ppaExportURL(t.id)}deleteJob(t,e){return this.BD2REST.rhythmicityDeleteJob(t.id,e)}downloadJob(t,e){return this.BD2REST.rhythmicityExportJob(t,e)}}return t.\u0275fac=function(e){return new(e||t)(o.ac(f.a))},t.\u0275prov=o.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),y=(()=>{class t extends d.a{constructor(t,e=!1){super(e),this.rhythmicityService=t,this.finishedJob$=this.finished$,this.runningJob$=this.running$,this.allJob$=this.all$}get currentJob(){return this.currentAsset}initIntervalsKeeper(){return new p.a(1e3,3e4,6e5,2)}assayJob(t){this.input(t)}sameInput(t,e){return t[1]===e[1]&&t[0]===e[0]}fetchAsset([t,e]){return this.rhythmicityService.getJob(t,e)}hasFailed(t){return!!t&&!this.isFinished(t)&&!this.isRunning(t)}isFinished(t){return!(!t||!t.jobStatus||"FINISHED"!==t.jobStatus.state&&"SUCCESS"!==t.jobStatus.state)}isRunning(t){return!!t&&!(!t||!t.jobStatus||"SUBMITTED"!==t.jobStatus.state&&"PROCESSING"!==t.jobStatus.state)}assetToId(t){return t.jobId}assetToInput(t){return[t.parentId,t.jobId]}}return t.\u0275fac=function(e){return new(e||t)(o.ac(g),o.ac(u.a,8))},t.\u0275prov=o.Mb({token:t,factory:t.\u0275fac}),t})();var C=i("M9IT"),v=i("vkgz");let J=(()=>{class t{constructor(t,e){this._name=t,this._label=e}get name(){return this._name}get label(){return this._label}static get(e){return t.getValuesMap().get(e)}static getValuesMap(){return t.valuesMap||(t.valuesMap=t.initValuesMap()),t.valuesMap}static initValuesMap(){const e=new Map;return t.values.forEach(t=>e.set(t.name,t)),e}toJSON(){return this.name}}return t.BD2EJTK=new t("BD2EJTK","BD2 eJTK"),t.BD2JTK=new t("BD2JTK","Classic JTK"),t.values=[t.BD2JTK,t.BD2EJTK],t})();const V=[J.BD2JTK,J.BD2EJTK];let S=(()=>{class t{constructor(t,e){this._name=t,this._label=e}get name(){return this._name}get label(){return this._label}static get(e){return t.getValuesMap().get(e)}static getValuesMap(){return t.valuesMap||(t.valuesMap=t.initValuesMap()),t.valuesMap}static initValuesMap(){const e=new Map;return t.values.forEach(t=>e.set(t.name,t)),e}toJSON(){return this.name}}return t.EJTK_CLASSIC=new t("EJTK_CLASSIC","eJTK Classic"),t.BD2_CLASSIC=new t("BD2_CLASSIC","BD2 Classic"),t.BD2_SPREAD=new t("BD2_SPREAD","Period range"),t.COS_1H=new t("COS_1H","Cosine 24h 1h"),t.COS_2H=new t("COS_2H","Cosine 24h 2h"),t.COS_4H=new t("COS_4H","Cosine 24h 4h"),t.values=[t.COS_1H,t.COS_2H,t.COS_4H,t.EJTK_CLASSIC,t.BD2_CLASSIC,t.BD2_SPREAD],t})();const w=[S.COS_1H,S.COS_2H,S.COS_4H,S.EJTK_CLASSIC,S.BD2_CLASSIC],W=[S.COS_1H,S.COS_2H,S.COS_4H];class P{isValid(){return!(this.windowStart<0||this.windowEnd<0||this.periodMin<=0||this.periodMax<=0||this.periodMin>this.periodMax||this.windowEnd>0&&this.windowStart>=this.windowEnd||null==this.method||null==this.preset||null==this.detrending)}}class I{constructor(t=0,e=!1,i=!1,r=!1){this.pValue=t,this.bhCorrection=e,this.showPattern=i,this.circadian=r}clone(){return new I(this.pValue,this.bhCorrection,this.showPattern,this.circadian)}}var T=i("8jiw");let D=(()=>{class t extends T.a{constructor(t,e=!1){super(e),this.rhythmicityService=t,this.results$=this.data$}isClassicJob(){var t,e;return"BD2JTK"===(null===(e=null===(t=this.currentInput)||void 0===t?void 0:t.parameters)||void 0===e?void 0:e.METHOD)}sameInput(t,e){return class{static sameJob(t,e){return!(!t||!e)&&t.jobId===e.jobId&&t.parentId===e.parentId}}.sameJob(t,e)}assetToData(t,e){return t.results}fetchAsset(t){return this.rhythmicityService.getResults(t.parentId,t.jobId).pipe(Object(v.a)(t=>this.labelPatterns(t)))}sortingKey(t){switch(t.active){case"label":return t=>t.label;case"id":return t=>+t.id;case"empp":return t=>+t.result.empP;case"emppbh":return t=>+t.result.empPBH;case"p":return t=>+t.result.p;case"pbh":return t=>+t.result.pBH;case"tau":return t=>+t.result.tau;case"period":return t=>t.result.pattern.period;case"peak":return t=>t.result.pattern.peak;case"trough":return t=>t.result.pattern.trough;default:return console.error("Not implemented sorting for "+t.active),t=>0}}processData(t,e){return e?(this.rankResults(t,e.pValue,e.bhCorrection,this.isClassicJob()),t):t}labelPatterns(t){t.results.forEach(t=>{t.result.patternLabel=this.describePattern(t.result),t.result.pattern.shapeLabel=this.patternToShape(t.result.pattern)})}describePattern(t){const e=t.pattern,i=Math.round(10*e.period)/10,r=Math.round(100*e.peak)/100,s=Math.round(100*e.trough)/100;return`${this.patternToShape(e)}\t${i}\t${r}\t${s}`}patternToShape(t){switch(t.waveform){case"ASYM_COSINE":return.5===t.leftPortion?"COS":"ACOS";case"ASYM_COS_SPIKE":return"SPIKE";case"ASYM_COS_SPIKE_NEG":return"NPIKE";default:return t.waveform}}rankResults(t,e,i,r){t.forEach(t=>{const s=t.result;let a;a=r?i?s.pBH:s.p:i?s.empPBH:s.empP,s.rhythmic=a<e})}}return t.\u0275fac=function(e){return new(e||t)(o.ac(g),o.ac(u.a,8))},t.\u0275prov=o.Mb({token:t,factory:t.\u0275fac}),t})();var H=i("6tuW"),O=i("+0xr"),j=i("Dh3D"),R=i("bv9b");function x(t,e){1&t&&o.Rb(0,"mat-progress-bar",28)}function k(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"Id"),o.Vb())}function E(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(t.id)}}function M(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"Label"),o.Vb())}function K(t,e){if(1&t&&(o.Wb(0,"td",31),o.Jc(1),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(t.label)}}function B(t,e){1&t&&(o.Wb(0,"th",32),o.Jc(1,"Rhythmic"),o.Vb())}function _(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.Vb()),2&t){const t=e.$implicit;o.Gb("bold",t.result.rhythmic),o.Cb(1),o.Kc(t.result.rhythmic)}}function A(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"emp-p"),o.Vb())}function $(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,t.result.empP,"1.0-5"))}}function L(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"BH emp-p"),o.Vb())}function U(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,t.result.empPBH,"1.0-5"))}}function F(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"Tau"),o.Vb())}function N(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,t.result.tau,"1.0-2"))}}function z(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"p"),o.Vb())}function q(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,t.result.p,"1.0-5"))}}function Q(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"BH p"),o.Vb())}function G(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,t.result.pBH,"1.0-5"))}}function X(t,e){1&t&&(o.Wb(0,"th",32),o.Jc(1,"Pattern"),o.Vb())}function Y(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(t.result.patternLabel)}}function Z(t,e){1&t&&(o.Wb(0,"th",32),o.Jc(1,"P.Shape"),o.Vb())}function tt(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(t.result.pattern.shapeLabel)}}function et(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"P.Period"),o.Vb())}function it(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,t.result.pattern.period,"1.0-1"))}}function rt(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"P.Peak"),o.Vb())}function st(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,t.result.pattern.peak,"1.1-1"))}}function at(t,e){1&t&&(o.Wb(0,"th",32),o.Jc(1,"P.Peak"),o.Vb())}function nt(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,24*t.result.pattern.peak/t.result.pattern.period,"1.1-1"))}}function ot(t,e){1&t&&(o.Wb(0,"th",29),o.Jc(1,"P.Trough"),o.Vb())}function ct(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,t.result.pattern.trough,"1.1-1"))}}function bt(t,e){1&t&&(o.Wb(0,"th",32),o.Jc(1,"P.Trough"),o.Vb())}function lt(t,e){if(1&t&&(o.Wb(0,"td",30),o.Jc(1),o.jc(2,"number"),o.Vb()),2&t){const t=e.$implicit;o.Cb(1),o.Kc(o.lc(2,1,24*t.result.pattern.trough/t.result.pattern.period,"1.1-1"))}}function ht(t,e){1&t&&o.Rb(0,"tr",33)}function dt(t,e){1&t&&o.Rb(0,"tr",34)}const ut=function(){return[10,25,50,100,250]};let pt=(()=>{class t{constructor(t,e){this.fetcher=t,this.feedback=e,this.normEmpPColumns=["id","label","rhythmic","empp","tau"],this.normClsPColumns=["id","label","rhythmic","p","tau"],this.bhEmpPColumns=["id","label","rhythmic","emppbh","tau"],this.bhClsPColumns=["id","label","rhythmic","pbh","tau"],this.patternColumns=["shape","period","peak","trough"],this.patternColumnsC=["shape","period","peakc","troughc"],this.displayedColumns=this.normEmpPColumns,this.disablePaginator=!1}set job(t){t&&this.fetcher.input(t)}set statTestParams(t){if(t){this.fetcher.params(t);let e=t.bhCorrection?this.bhEmpPColumns:this.normEmpPColumns;this.fetcher.isClassicJob()&&(e=t.bhCorrection?this.bhClsPColumns:this.normClsPColumns),t.showPattern&&(e=e.concat(t.circadian?this.patternColumnsC:this.patternColumns)),this.displayedColumns=e}}ngOnInit(){this.fetcher.error$.subscribe(t=>this.feedback.error(t));const t=new C.d;t.pageSize=25,t.pageIndex=0,this.fetcher.page(t),this.fetcher.on(!0)}ngOnDestroy(){this.fetcher.close()}ngAfterViewInit(){}reload(){this.fetcher.refresh()}sortData(t){this.fetcher.sort(t)}loadPage(t){this.fetcher.page(t)}}return t.\u0275fac=function(e){return new(e||t)(o.Qb(D),o.Qb(H.a))},t.\u0275cmp=o.Kb({type:t,selectors:[["bd2-rhythmicity-results-mdtable"]],inputs:{job:"job",statTestParams:"statTestParams"},features:[o.Bb([D])],decls:55,vars:18,consts:[[1,"mat-elevation-z8"],["mode","indeterminate",4,"ngIf"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["paginator",""],["mat-table","","matSort","","aria-label","Results","matSort","","matSortActive","id","matSortDirection","asc",1,"full-width-table",3,"dataSource","matSortChange"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","label"],["mat-cell","","class","word_wrapping","style","max-width: 100px",4,"matCellDef"],["matColumnDef","rhythmic"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"bold",4,"matCellDef"],["matColumnDef","empp"],["matColumnDef","emppbh"],["matColumnDef","tau"],["matColumnDef","p"],["matColumnDef","pbh"],["matColumnDef","pattern"],["matColumnDef","shape"],["matColumnDef","period"],["matColumnDef","peak"],["matColumnDef","peakc"],["matColumnDef","trough"],["matColumnDef","troughc"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["paginator2",""],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"word_wrapping",2,"max-width","100px"],["mat-header-cell",""],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(o.Wb(0,"div",0),o.Hc(1,x,1,0,"mat-progress-bar",1),o.jc(2,"async"),o.Wb(3,"mat-paginator",2,3),o.ec("page",(function(t){return e.loadPage(t)})),o.Vb(),o.Wb(5,"table",4),o.ec("matSortChange",(function(t){return e.sortData(t)})),o.Ub(6,5),o.Hc(7,k,2,0,"th",6),o.Hc(8,E,2,1,"td",7),o.Tb(),o.Ub(9,8),o.Hc(10,M,2,0,"th",6),o.Hc(11,K,2,1,"td",9),o.Tb(),o.Ub(12,10),o.Hc(13,B,2,0,"th",11),o.Hc(14,_,2,3,"td",12),o.Tb(),o.Ub(15,13),o.Hc(16,A,2,0,"th",6),o.Hc(17,$,3,4,"td",7),o.Tb(),o.Ub(18,14),o.Hc(19,L,2,0,"th",6),o.Hc(20,U,3,4,"td",7),o.Tb(),o.Ub(21,15),o.Hc(22,F,2,0,"th",6),o.Hc(23,N,3,4,"td",7),o.Tb(),o.Ub(24,16),o.Hc(25,z,2,0,"th",6),o.Hc(26,q,3,4,"td",7),o.Tb(),o.Ub(27,17),o.Hc(28,Q,2,0,"th",6),o.Hc(29,G,3,4,"td",7),o.Tb(),o.Ub(30,18),o.Hc(31,X,2,0,"th",11),o.Hc(32,Y,2,1,"td",7),o.Tb(),o.Ub(33,19),o.Hc(34,Z,2,0,"th",11),o.Hc(35,tt,2,1,"td",7),o.Tb(),o.Ub(36,20),o.Hc(37,et,2,0,"th",6),o.Hc(38,it,3,4,"td",7),o.Tb(),o.Ub(39,21),o.Hc(40,rt,2,0,"th",6),o.Hc(41,st,3,4,"td",7),o.Tb(),o.Ub(42,22),o.Hc(43,at,2,0,"th",11),o.Hc(44,nt,3,4,"td",7),o.Tb(),o.Ub(45,23),o.Hc(46,ot,2,0,"th",6),o.Hc(47,ct,3,4,"td",7),o.Tb(),o.Ub(48,24),o.Hc(49,bt,2,0,"th",11),o.Hc(50,lt,3,4,"td",7),o.Tb(),o.Hc(51,ht,1,0,"tr",25),o.Hc(52,dt,1,0,"tr",26),o.Vb(),o.Wb(53,"mat-paginator",2,27),o.ec("page",(function(t){return e.loadPage(t)})),o.Vb(),o.Vb()),2&t&&(o.Cb(1),o.oc("ngIf",o.kc(2,14,e.fetcher.isBusy$)),o.Cb(2),o.oc("length",e.fetcher.dataLength)("disabled",e.disablePaginator)("pageSize",(null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageSize)||25)("pageIndex",null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageIndex)("pageSizeOptions",o.qc(16,ut)),o.Cb(2),o.oc("dataSource",e.fetcher.results$),o.Cb(46),o.oc("matHeaderRowDef",e.displayedColumns),o.Cb(1),o.oc("matRowDefColumns",e.displayedColumns),o.Cb(1),o.oc("length",e.fetcher.dataLength)("disabled",e.disablePaginator)("pageSize",(null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageSize)||25)("pageIndex",null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageIndex)("pageSizeOptions",o.qc(17,ut)))},directives:[r.m,C.a,O.n,j.a,O.c,O.i,O.b,O.k,O.m,R.a,O.h,j.b,O.a,O.j,O.l],pipes:[r.b,r.f],styles:[".full-width-table[_ngcontent-%COMP%] {\n      width: 100%;\n    }"]}),t})();var mt=i("BOp5"),ft=i("9+85"),gt=i("Wp6s"),yt=i("f0Cb"),Ct=i("Xa2L"),vt=i("3Pt+"),Jt=i("kmnG"),Vt=i("QibW");function St(t,e){if(1&t&&(o.Wb(0,"mat-radio-button",5),o.Jc(1),o.Vb()),2&t){const t=e.$implicit;o.oc("value",t),o.Cb(1),o.Kc(t)}}let wt=(()=>{class t{constructor(){this.values=[1e-4,.001,.005,.01,.05,.1],this.pvalue=.001,this.pvalue$=new o.o}ngOnInit(){}ngAfterViewInit(){this.pvalue$.emit(this.pvalue)}selected(t){this.pvalue$.emit(t.value)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Kb({type:t,selectors:[["bd2-pvalue-form"]],outputs:{pvalue$:"pvalue$"},decls:8,vars:2,consts:[[1,"form-inline"],[1,"mx-auto","text-center"],["id","pvalues-label",1,"mb-1"],["aria-label","Select p-value","aria-labelledby","pvalues-label",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(o.Wb(0,"form",0),o.Wb(1,"div",1),o.Wb(2,"mat-label",2),o.Wb(3,"strong"),o.Jc(4,"p-value threshold:"),o.Vb(),o.Vb(),o.Wb(5,"div"),o.Wb(6,"mat-radio-group",3),o.ec("change",(function(t){return e.selected(t)})),o.Hc(7,St,2,2,"mat-radio-button",4),o.Vb(),o.Vb(),o.Vb(),o.Vb()),2&t&&(o.Cb(6),o.oc("value",e.pvalue),o.Cb(1),o.oc("ngForOf",e.values))},directives:[vt.C,vt.q,vt.r,Jt.g,Vt.b,r.l,Vt.a],styles:[".mat-radio-button[_ngcontent-%COMP%]  {\n      margin-right: 15px;\n    }"]}),t})();var Wt=i("1jcm");let Pt=(()=>{class t{constructor(){this.options=new o.o,this.currentOptions=new I(0,!1,!1,!1)}ngOnInit(){}pValue(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.pValue=t,this.options.next(this.currentOptions)}bhCorrection(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.bhCorrection=t,this.options.next(this.currentOptions)}circadian(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.circadian=t,this.options.next(this.currentOptions)}showPattern(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.showPattern=t,this.options.next(this.currentOptions)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Kb({type:t,selectors:[["bd2-stat-test-options-widget"]],outputs:{options:"options"},decls:14,vars:1,consts:[[3,"pvalue$"],[2,"margin-top","0.5em","text-align","center"],[3,"change"],["pattern",""],[3,"disabled","change"]],template:function(t,e){if(1&t&&(o.Wb(0,"mat-card"),o.Wb(1,"mat-card-content"),o.Wb(2,"section"),o.Wb(3,"bd2-pvalue-form",0),o.ec("pvalue$",(function(t){return e.pValue(t)})),o.Vb(),o.Vb(),o.Wb(4,"section",1),o.Wb(5,"mat-slide-toggle",2),o.ec("change",(function(t){return e.bhCorrection(t.checked)})),o.Jc(6,"Benjamini Hochberg correction"),o.Vb(),o.Vb(),o.Wb(7,"section",1),o.Wb(8,"mat-slide-toggle",2,3),o.ec("change",(function(t){return e.showPattern(t.checked)})),o.Jc(10,"show pattern"),o.Vb(),o.Jc(11," \xa0 "),o.Wb(12,"mat-slide-toggle",4),o.ec("change",(function(t){return e.circadian(t.checked)})),o.Jc(13,"circadian unit"),o.Vb(),o.Vb(),o.Vb(),o.Vb()),2&t){const t=o.xc(9);o.Cb(12),o.oc("disabled",!t.checked)}},directives:[gt.a,gt.c,wt,Wt.a],encapsulation:2}),t})();function It(t,e){if(1&t){const t=o.Xb();o.Wb(0,"div",5),o.Wb(1,"button",13),o.ec("click",(function(){return o.Ac(t),o.ic(2).delete()})),o.Wb(2,"i",4),o.Jc(3,"delete_forever"),o.Vb(),o.Vb(),o.Wb(4,"button",14),o.ec("click",(function(){return o.Ac(t),o.ic(2).export()})),o.Wb(5,"i",4),o.Jc(6,"save_alt"),o.Vb(),o.Vb(),o.Vb()}}function Tt(t,e){if(1&t&&(o.Wb(0,"div",15),o.Rb(1,"br"),o.Jc(2),o.Vb()),2&t){const t=o.ic().ngIf;o.Cb(2),o.Lc("ERROR: ",t.jobStatus.message," ")}}function Dt(t,e){1&t&&(o.Wb(0,"div"),o.Wb(1,"mat-card"),o.Wb(2,"mat-card-content"),o.Rb(3,"mat-spinner",16),o.Vb(),o.Vb(),o.Vb())}function Ht(t,e){1&t&&(o.Wb(0,"div"),o.Wb(1,"mat-card"),o.Wb(2,"mat-card-content"),o.Wb(3,"div",17),o.Jc(4,"It may take up to 10 minutes to test for rhythmicity"),o.Vb(),o.Vb(),o.Vb(),o.Vb())}function Ot(t,e){if(1&t){const t=o.Xb();o.Ub(0),o.Wb(1,"bd2-stat-test-options-widget",18),o.ec("options",(function(e){return o.Ac(t),o.ic(3).statTestOptions(e)})),o.Vb(),o.Rb(2,"bd2-rhythmicity-results-mdtable",19),o.Tb()}if(2&t){const t=e.ngIf,i=o.ic(3);o.Cb(2),o.oc("statTestParams",i.statTestParams)("job",t)}}function jt(t,e){if(1&t&&(o.Wb(0,"div"),o.Rb(1,"mat-divider"),o.Hc(2,Dt,4,0,"div",12),o.jc(3,"async"),o.Hc(4,Ht,5,0,"div",12),o.Hc(5,Ot,3,2,"ng-container",12),o.jc(6,"async"),o.Vb()),2&t){const t=o.ic().ngIf,e=o.ic();o.Cb(2),o.oc("ngIf",o.kc(3,3,e.rhythmicityJobDatasource.isReloading$)),o.Cb(2),o.oc("ngIf","SUBMITTED"===t.jobStatus.state),o.Cb(1),o.oc("ngIf",o.kc(6,5,e.rhythmicityJobDatasource.finishedJob$))}}function Rt(t,e){if(1&t){const t=o.Xb();o.Wb(0,"div",1),o.Wb(1,"div",2),o.Wb(2,"div",3),o.ec("click",(function(){return o.Ac(t),o.ic().toggleExpanded()})),o.Wb(3,"i",4),o.Jc(4,"waves"),o.Vb(),o.Jc(5),o.jc(6,"date"),o.Rb(7,"br"),o.Jc(8),o.Vb(),o.Wb(9,"div",5),o.Jc(10),o.Wb(11,"a",6),o.ec("click",(function(){return o.Ac(t),o.ic().refresh()})),o.Wb(12,"i",7),o.Jc(13,"refresh"),o.Vb(),o.Vb(),o.Vb(),o.Vb(),o.Wb(14,"div",8),o.Wb(15,"mat-card"),o.Wb(16,"mat-card-content"),o.Wb(17,"div",9),o.Hc(18,It,7,0,"div",10),o.Jc(19),o.Hc(20,Tt,3,1,"div",11),o.Vb(),o.Vb(),o.Vb(),o.Hc(21,jt,7,7,"div",12),o.Vb(),o.Vb()}if(2&t){const t=e.ngIf,i=o.ic();o.Cb(3),o.Gc("color",i.isExpanded?"green":"red")("font-size",150,"%"),o.Cb(2),o.Mc(" \xa0",i.shortUUID(t.jobId)," (",o.kc(6,13,i.toLocalDateTime(t.jobStatus.submitted)),") "),o.Cb(3),o.Mc(" ",i.friendlyMethod(t.parameters.METHOD),"; \xa0 waveforms: ",t.parameters.PRESET," "),o.Cb(2),o.Lc(" ",t.jobStatus.state," "),o.Cb(8),o.oc("ngIf",i.assay.security.canWrite),o.Cb(1),o.Lc(" ",t.parameters.PARAMS_SUMMARY," "),o.Cb(1),o.oc("ngIf",t.jobStatus.message&&"OK"!=t.jobStatus.message),o.Cb(1),o.oc("ngIf",i.isExpanded)}}let xt=(()=>{class t{constructor(t,e,i,r){this.rhythmicityService=t,this.rhythmicityJobDatasource=e,this.feedback=i,this.dialogs=r,this.deleted=new o.o,this.isExpanded=!1,this.expandedToogleStream=new c.a(!1)}set expanded(t){this.isExpanded=t,this.expandedToogleStream.next(t)}ngOnInit(){this.initSubscriptions()}ngOnDestroy(){this.rhythmicityJobDatasource.close(),this.expandedToogleStream&&this.expandedToogleStream.complete()}ngOnChanges(t){(t.jobId||t.assay)&&this.jobId&&this.assay&&this.rhythmicityJobDatasource.assayJob([this.assay.id,this.jobId])}statTestOptions(t){const e=Object(b.a)(1).subscribe(()=>{this.statTestParams=t,e&&e.unsubscribe()})}export(){this.rhythmicityService.downloadJob(this.assay.id,this.jobId).subscribe(t=>{this.saveJobBlob(t,this.assay.id,this.jobId)},t=>this.feedback.error(t))}saveJobBlob(t,e,i){h.saveAs(t,e+"_job"+this.shortUUID(i)+".rhythmicity.csv")}refresh(){this.rhythmicityJobDatasource.refresh(),this.resultsTable&&this.resultsTable.reload()}delete(){const t=this.assay,e=this.rhythmicityJobDatasource.currentJob;this.dialogs.confirm("Do you want to delete analysis: "+e.jobId,e.parameters.PARAMS_SUMMARY).subscribe(i=>{i&&this.doDelete(t,e.jobId)})}initSubscriptions(){this.rhythmicityJobDatasource.on(!0),this.rhythmicityJobDatasource.error$.forEach(t=>this.feedback.error(t))}doDelete(t,e){this.rhythmicityService.deleteJob(t,e).subscribe(t=>{this.deleted.next(t),this.feedback.success("Job: "+this.shortUUID(e)+" deleted")},t=>{this.feedback.error(t)})}toggleExpanded(){this.expanded=!this.isExpanded}toLocalDateTime(t){return l.b.deserialize(t).date}shortUUID(t){return Object(mt.c)(t)}friendlyMethod(t){return"BD2JTK"==t?"Classic JTK":"BD2EJTK"==t?"BD2 eJTK":t}}return t.\u0275fac=function(e){return new(e||t)(o.Qb(g),o.Qb(y),o.Qb(H.a),o.Qb(ft.a))},t.\u0275cmp=o.Kb({type:t,selectors:[["bd2-rhythmicity-job-pane"]],viewQuery:function(t,e){var i;1&t&&o.Pc(pt,!0),2&t&&o.wc(i=o.fc())&&(e.resultsTable=i.first)},inputs:{jobId:"jobId",assay:"assay",expanded:"expanded"},outputs:{deleted:"deleted"},features:[o.Bb([y]),o.Ab],decls:2,vars:3,consts:[["class","card mb-2",4,"ngIf"],[1,"card","mb-2"],[1,"card-header","clearfix"],["role","button",1,"float-left",3,"click"],[1,"material-icons","bd-icon"],[1,"float-right"],["role","button","aria-label","refresh",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"card-body"],[1,"clearfix"],["class","float-right",4,"ngIf"],["class","text-danger","style","word-wrap: break-word;",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-danger","btn-sm","mr-1",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"text-danger",2,"word-wrap","break-word"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"],[3,"options"],[3,"statTestParams","job"]],template:function(t,e){1&t&&(o.Hc(0,Rt,22,15,"div",0),o.jc(1,"async")),2&t&&o.oc("ngIf",o.kc(1,1,e.rhythmicityJobDatasource.allJob$))},directives:[r.m,gt.a,gt.c,yt.a,Ct.b,Pt,pt],pipes:[r.b,r.e],encapsulation:2}),t})();var kt=i("GVyA");function Et(t,e){if(1&t&&(o.Wb(0,"div"),o.Wb(1,"strong"),o.Jc(2),o.Vb(),o.Vb()),2&t){const t=o.ic(2);o.Cb(2),o.Lc("Submitted jobs: ",t.jobs.length,"")}}function Mt(t,e){1&t&&(o.Wb(0,"div"),o.Jc(1," No jobs submitted, start a new test. "),o.Vb())}const Kt=function(){return["new"]};function Bt(t,e){1&t&&(o.Wb(0,"a",7),o.Jc(1," New test "),o.Vb()),2&t&&o.oc("routerLink",o.qc(1,Kt))}function _t(t,e){if(1&t){const t=o.Xb();o.Wb(0,"div"),o.Wb(1,"bd2-rhythmicity-job-pane",8),o.ec("deleted",(function(e){return o.Ac(t),o.ic(2).remove(e)}))("finished",(function(e){return o.Ac(t),o.ic(2).refreshJob(e)})),o.Vb(),o.Vb()}if(2&t){const t=e.$implicit,i=e.index,r=o.ic(2);o.Cb(1),o.oc("assay",r.assay)("jobId",t)("expanded",r.expandAll||0==i)}}function At(t,e){if(1&t){const t=o.Xb();o.Wb(0,"div"),o.Wb(1,"h3"),o.Jc(2,"Rhythmicity tests"),o.Vb(),o.Rb(3,"hr"),o.Wb(4,"div",1),o.Wb(5,"div",2),o.Hc(6,Et,3,1,"div",0),o.Hc(7,Mt,2,0,"div",0),o.Vb(),o.Wb(8,"div",3),o.Hc(9,Bt,2,2,"a",4),o.Wb(10,"button",5),o.ec("click",(function(){return o.Ac(t),o.ic().refresh()})),o.Jc(11,"Refresh "),o.Vb(),o.Vb(),o.Vb(),o.Rb(12,"hr"),o.Hc(13,_t,2,3,"div",6),o.Rb(14,"hr"),o.Vb()}if(2&t){const t=o.ic();o.Cb(6),o.oc("ngIf",t.jobs&&t.jobs.length>0),o.Cb(1),o.oc("ngIf",!t.jobs||0==t.jobs.length),o.Cb(2),o.oc("ngIf",t.assay.security.canWrite),o.Cb(1),o.oc("disabled",t.blocked),o.Cb(3),o.oc("ngForOf",t.jobsIds)}}let $t=(()=>{class t extends n{constructor(t,e){super(t,e),this.expandAll=!1,this.blocked=!1,this.titlePart=" Rhythm"}updateModel(t){super.updateModel(t),t&&this.loadJobs(t)}loadJobs(t,e=!1){this.blocked=!0,this.rhythmicityService.getJobs(t).subscribe(i=>{this.jobs=i,this.refreshJobsInfo(i),this.exportURL=this.rhythmicityService.exportURL(t),e&&this.refreshPanes(),this.blocked=!1},t=>{this.blocked=!1,this.feedback.error(t)})}refreshJobsInfo(t){this.jobsIds=t.map(t=>t.jobId)}refresh(){this.loadJobs(this.assay,!0)}refreshPanes(){this.panes&&this.panes.forEach(t=>t.refresh())}remove(t){const e=this.jobs.findIndex(e=>t.jobId===e.jobId);e>=0&&(this.jobs.splice(e,1),this.refreshJobsInfo(this.jobs))}refreshJob(t){const e=this.jobs.findIndex(e=>t.jobId===e.jobId);e>=0&&(this.jobs[e]=t,this.refreshJobsInfo(this.jobs))}calculateQueuing(t){return t.filter(t=>this.isQueueing(t.jobStatus.state)).length}isQueueing(t){switch(t){case"WAITING":case"PROCESSING":case"SUBMITTED":return!0;default:return!1}}checkFinished(t){return!!t.find(t=>this.isFinished(t.jobStatus.state))}isFinished(t){switch(t){case"SUCCESS":case"FINISHED":case"COMPLETED":return!0;default:return!1}}}return t.\u0275fac=function(e){return new(e||t)(o.Qb(g),o.Qb(kt.a))},t.\u0275cmp=o.Kb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){var i;1&t&&o.Pc(xt,!0),2&t&&o.wc(i=o.fc())&&(e.panes=i)},features:[o.zb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-body"],["class","btn btn-primary mr-1",3,"routerLink",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","click"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary","mr-1",3,"routerLink"],[3,"assay","jobId","expanded","deleted","finished"]],template:function(t,e){1&t&&o.Hc(0,At,15,5,"div",0),2&t&&o.oc("ngIf",e.assay)},directives:[r.m,r.l,s.e,xt],encapsulation:2}),t})();var Lt=i("QBpm"),Ut=i("Kj3r"),Ft=i("bngM"),Nt=i("ZMwR"),zt=i("naqj"),qt=i("Tl2h"),Qt=i("wcxA");function Gt(t,e){if(1&t&&(o.Wb(0,"option",29),o.Jc(1),o.Vb()),2&t){const t=e.$implicit;o.oc("value",t.name),o.Cb(1),o.Kc(t.label)}}function Xt(t,e){1&t&&(o.Wb(0,"div",30),o.Wb(1,"div",31),o.Jc(2," Rhythmicity tests are generally used for short, sparse timeseries. "),o.Rb(3,"br"),o.Jc(4," The current limit is 5 or 4 days of hourly sampled data for eJTK preset and BD2 preset respectivelly."),o.Rb(5,"br"),o.Jc(6," Generally the raw data are being analysed, but we also enabled a linear detrended option. "),o.Vb(),o.Vb())}function Yt(t,e){if(1&t&&(o.Wb(0,"option",29),o.Jc(1),o.Vb()),2&t){const t=e.$implicit;o.oc("value",t.name),o.Cb(1),o.Kc(t.label)}}function Zt(t,e){1&t&&(o.Wb(0,"div",30),o.Wb(1,"div",31),o.Wb(2,"p"),o.Wb(3,"b"),o.Jc(4,"Classic JTK"),o.Vb(),o.Jc(5," is the implementation of JTK_CYCLE from "),o.Wb(6,"a",32),o.Jc(7,"Michael E. Hughes et al. 2010"),o.Vb(),o.Jc(8," a standard method for detecting rhythmicity in genome-scale datasets. "),o.Rb(9,"br"),o.Jc(10,"The method is fast but it is reliable only when it tests against small set of patterns, we provide patterns of 24h cosines with different phases."),o.Vb(),o.Wb(11,"p"),o.Wb(12,"b"),o.Jc(13,"BD2 eJTK"),o.Vb(),o.Jc(14," is the BioDare2 implementation of Empirical JTK_CYCLE with asymmetry search from "),o.Wb(15,"a",33),o.Jc(16,"Alan L. Hutchison et al. 2015"),o.Vb(),o.Jc(17,". It is similar to the classic JTK method but with p values empirically calculated against set of random noise data. "),o.Rb(18,"br"),o.Jc(19,"This modification permits using larger sets of test patterns and it provides better accuracy. However, this method is much slower so it can only analyze timeseries only up to 5 days of data (though the Classic JTK method was never intended to be used with such a long data)."),o.Vb(),o.Vb(),o.Vb())}function te(t,e){if(1&t&&(o.Wb(0,"option",29),o.Jc(1),o.Vb()),2&t){const t=e.$implicit;o.oc("value",t.name),o.Cb(1),o.Kc(t.label)}}function ee(t,e){1&t&&(o.Wb(0,"div",30),o.Wb(1,"div",31),o.Jc(2," Presets determine set of pattern curves against the comparison test is run."),o.Rb(3,"br"),o.Wb(4,"ul"),o.Wb(5,"li"),o.Jc(6,"Cosine 24h 1/2/4h are set of cosine curves of 24h periods, and phases spread every 1, 2, or 4 hours. To be used mainly with Classic JTK."),o.Vb(),o.Wb(7,"li"),o.Jc(8,"eJTK Classic is recommended for typical omics-like data for which eJTK method was developed. "),o.Rb(9,"br"),o.Jc(10," It works well for short data (48h, 2h- 1h-sampled) when actual period is within range 22-26 hours."),o.Rb(11,"br"),o.Jc(12," The patterns are series of cosine-like waveforms with 24h period, phases by 2hours and range of asymmetries by 2h (see original paper)."),o.Rb(13,"br"),o.Vb(),o.Wb(14,"li"),o.Jc(15,"BD2 Classic can detect non 24 periods and some forms of the spikes."),o.Rb(16,"br"),o.Jc(17," As it compares against much more patterns it has a weaker power."),o.Rb(18,"br"),o.Jc(19," It should be used when there is a good reason to suspect periods outside 22-26h range."),o.Rb(20,"br"),o.Jc(21," The patterns are series of cosine-like waverforms with periods from 18-35hours, for each period there are multiple "),o.Wb(22,"b"),o.Jc(23,"circadian"),o.Vb(),o.Jc(24," phases with step 2h (so each period value generates the same number of patterns but the peaks in absolute units do not coincide) and a range of assymetries by 2h in circadian units (see original paper). The preset contains also additional some spike patterns. "),o.Vb(),o.Vb(),o.Vb(),o.Vb())}const ie=function(){return[10,25,50,100,200]};let re=(()=>{class t extends Qt.a{constructor(t){super(t),this.methodOptions=V,this.presetOptions=w,this.dataHelp=!1,this.presetsHelp=!1,this.methodHelp=!1,this.rhythmicityRequests=new o.o,this.detrendingOptions=[qt.b.NO_DTR,qt.b.LIN_DTR],this.methodForm=this.mainForm.get("method"),this.presetForm=this.mainForm.get("preset")}buildMainForm(){return this.fb.group({displayParams:this.displayParamsForm,periodScale:this.fb.group({periodMin:[18,[vt.A.required]],periodMax:[34,[vt.A.required]]},{validator:t=>this.validPeriodScale(t.value)}),method:[J.BD2EJTK.name,[vt.A.required]],preset:[S.EJTK_CLASSIC.name,[vt.A.required]]})}ngOnInit(){super.ngOnInit(),this.methodForm.valueChanges.subscribe(t=>this.setPresetOptions(t))}ngOnDestroy(){super.ngOnDestroy()}setPresetOptions(t){t===J.BD2EJTK.name?(this.presetOptions=w,this.presetForm.setValue(S.EJTK_CLASSIC.name)):t===J.BD2JTK.name?(this.presetOptions=W,this.presetForm.setValue(S.COS_2H.name)):this.presetOptions=[]}defaultDetrending(){return qt.b.NO_DTR.name}validPeriodScale(t){const e=t.periodMin,i=t.periodMax;return e<10?{validPeriodScale:"Period min must >= 10"}:i<10?{validPeriodScale:"Period max must >= 10"}:i>50?{validPeriodScale:"Period max must < 50"}:e>=i?{validPeriodScale:"Period min must be < max"}:null}analyse(){if(this.mainForm.invalid)return;const t=this.map2RhythmicityRequest(this.mainForm.value);t.isValid()&&this.rhythmicityRequests.next(t)}map2RhythmicityRequest(t){const e=new P;return e.detrending=qt.b.get(t.displayParams.detrending),e.method=J.get(t.method),e.preset=S.get(t.preset),e.periodMax=t.periodScale.periodMax,e.periodMin=t.periodScale.periodMin,e.windowEnd=t.displayParams.timeScale.timeEnd,e.windowStart=t.displayParams.timeScale.timeStart,e}}return t.\u0275fac=function(e){return new(e||t)(o.Qb(vt.d))},t.\u0275cmp=o.Kb({type:t,selectors:[["bd2-rhythmicityjob-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams",rhythmicityRequests:"rhythmicityRequests"},features:[o.zb],decls:61,vars:15,consts:[["role","form",1,"form-horizontal",3,"formGroup"],["formGroupName","displayParams"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-sm-4"],["for","windowStart",1,"col-sm-1"],[1,"col-sm-2"],["formControlName","timeStart","id","windowStart","min","0","required","","size","5","step","any","type","number",1,"form-control"],["for","windowEnd",1,"col-sm-1"],["formControlName","timeEnd","id","windowEnd","min","0","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"form-group","row"],["for","detrending",1,"col-sm-4"],[3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"col-sm-6"],["formControlName","detrending","id","detrending","required","",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["class","col-sm-12",4,"ngIf"],["for","method",1,"col-sm-4"],["formControlName","method","id","method","required","",1,"form-control"],["formControlName","preset","id","preset","required","",1,"form-control"],["formGroupName","periodScale",1,"form-group","row",3,"hidden"],["for","periodMin",1,"col-sm-1"],["formControlName","periodMin","id","periodMin","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],["for","periodMax",1,"col-sm-1"],["formControlName","periodMax","id","periodMax","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],["type","button",1,"btn","btn-primary",3,"disabled","click"],[3,"value"],[1,"col-sm-12"],["role","alert","type","info",1,"alert","alert-info"],["href","https://dx.doi.org/10.1177%2F0748730410379711"],["href"," https://doi.org/10.1371/journal.pcbi.1004094","target","_blank"]],template:function(t,e){1&t&&(o.Wb(0,"form",0),o.Wb(1,"div",1),o.Wb(2,"div",2),o.Wb(3,"label",3),o.Jc(4,"Data window"),o.Vb(),o.Wb(5,"label",4),o.Jc(6,"from:"),o.Vb(),o.Wb(7,"div",5),o.Rb(8,"input",6),o.Vb(),o.Wb(9,"label",7),o.Jc(10,"to:"),o.Vb(),o.Wb(11,"div",5),o.Rb(12,"input",8),o.Vb(),o.Vb(),o.Wb(13,"div",9),o.Wb(14,"label",10),o.Jc(15,"Input Data "),o.Wb(16,"a",11),o.ec("click",(function(){return e.dataHelp=!e.dataHelp})),o.Wb(17,"i",12),o.Jc(18,"help"),o.Vb(),o.Vb(),o.Vb(),o.Wb(19,"div",13),o.Wb(20,"select",14),o.Hc(21,Gt,2,2,"option",15),o.Vb(),o.Vb(),o.Vb(),o.Vb(),o.Hc(22,Xt,7,0,"div",16),o.Wb(23,"div",9),o.Wb(24,"label",17),o.Jc(25,"Test Method "),o.Wb(26,"a",11),o.ec("click",(function(){return e.methodHelp=!e.methodHelp})),o.Wb(27,"i",12),o.Jc(28,"help"),o.Vb(),o.Vb(),o.Vb(),o.Wb(29,"div",13),o.Wb(30,"select",18),o.Hc(31,Yt,2,2,"option",15),o.Vb(),o.Vb(),o.Vb(),o.Hc(32,Zt,20,0,"div",16),o.Wb(33,"div",9),o.Wb(34,"label",17),o.Jc(35,"Analysis Presets "),o.Wb(36,"a",11),o.ec("click",(function(){return e.presetsHelp=!e.presetsHelp})),o.Wb(37,"i",12),o.Jc(38,"help"),o.Vb(),o.Vb(),o.Vb(),o.Wb(39,"div",13),o.Wb(40,"select",19),o.Hc(41,te,2,2,"option",15),o.Vb(),o.Vb(),o.Vb(),o.Hc(42,ee,25,0,"div",16),o.Wb(43,"div",20),o.Wb(44,"label",3),o.Jc(45,"Expected periods"),o.Vb(),o.Wb(46,"label",21),o.Jc(47,"from:"),o.Vb(),o.Wb(48,"div",5),o.Rb(49,"input",22),o.Vb(),o.Wb(50,"label",23),o.Jc(51,"to:"),o.Vb(),o.Wb(52,"div",5),o.Rb(53,"input",24),o.Vb(),o.Vb(),o.Wb(54,"div",9),o.Rb(55,"label",5),o.Wb(56,"div",25),o.Wb(57,"mat-paginator",26,27),o.ec("page",(function(t){return e.loadDataPage(t)})),o.Vb(),o.Vb(),o.Vb(),o.Wb(59,"button",28),o.ec("click",(function(){return e.analyse()})),o.Jc(60,"Test Rhythmicity "),o.Vb(),o.Vb()),2&t&&(o.oc("formGroup",e.mainForm),o.Cb(21),o.oc("ngForOf",e.detrendingOptions),o.Cb(1),o.oc("ngIf",e.dataHelp),o.Cb(9),o.oc("ngForOf",e.methodOptions),o.Cb(1),o.oc("ngIf",e.methodHelp),o.Cb(9),o.oc("ngForOf",e.presetOptions),o.Cb(1),o.oc("ngIf",e.presetsHelp),o.Cb(1),o.oc("hidden",!0),o.Cb(14),o.oc("length",e.totalTraces)("disabled",e.disabledPagination)("pageSize",e.currentPage.pageSize)("pageIndex",e.currentPage.pageIndex)("pageSizeOptions",o.qc(14,ie)),o.Cb(2),o.oc("disabled",e.disabled||e.mainForm.invalid))},directives:[vt.C,vt.q,vt.h,vt.i,vt.c,vt.u,vt.p,vt.g,vt.y,vt.z,r.l,r.m,C.a,vt.t,vt.B],encapsulation:2}),t})();var se=i("nA4b");function ae(t,e){if(1&t&&o.Rb(0,"bd2-ts-plots",3),2&t){const t=o.ic(3);o.oc("data",t.timeseries)("tracesPerPlot",t.tracesPerPlot)}}function ne(t,e){if(1&t){const t=o.Xb();o.Wb(0,"div"),o.Wb(1,"bd2-rhythmicityjob-params-rform",1),o.ec("displayParams",(function(e){return o.Ac(t),o.ic(2).emitDisplayParams(e)}))("rhythmicityRequests",(function(e){return o.Ac(t),o.ic(2).doAnalysis(e)})),o.Vb(),o.Rb(2,"hr"),o.Hc(3,ae,1,2,"bd2-ts-plots",2),o.Vb()}if(2&t){const t=o.ic(2);o.Cb(1),o.oc("disabled",t.blocked)("totalTraces",t.totalTraces)("currentPage",t.currentPage),o.Cb(2),o.oc("ngIf",t.timeseries)}}function oe(t,e){if(1&t&&(o.Wb(0,"div"),o.Wb(1,"h3"),o.Jc(2,"Start rhythmicity test"),o.Vb(),o.Rb(3,"hr"),o.Hc(4,ne,4,4,"div",0),o.Vb()),2&t){const t=o.ic();o.Cb(4),o.oc("ngIf",!t.disabled)}}const ce=[{path:"",children:[{path:"new",component:(()=>{class t extends n{constructor(t,e,i,r,s){super(r,s),this.fetcher=t,this.analytics=e,this.userService=i,this.disabled=!1,this.blocked=!1,this.tracesPerPlot=5,this.totalTraces=0,this.currentPage=Ft.a.firstPage(),this.titlePart=" New Test"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(Ut.a)(1e3)).subscribe(t=>{const e=t.data;this.tracesPerPlot=Math.max(5,e.length/20),this.timeseries=e,this.totalTraces=t.totalTraces,this.currentPage=t.currentPage},t=>{console.log("Error in TS subscription: "+t),this.feedback.error(t)})}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}emitDisplayParams(t){this.fetcher.changeDisplayParams(t)}doAnalysis(t){t.isValid()&&(this.blocked=!0,this.rhythmicityService.newTest(this.assay,t).subscribe(e=>{this.feedback.success("Rhythmicity test submitted"),this.analytics.rhythmicityNew(t.method.name,this.assay.id,this.userService.currentUser.login),this.refreshModel(),this.goToRhythmicityHome()},t=>{this.blocked=!1,this.feedback.error(t)}))}updateModel(t){this.fetcher.experiment(t),super.updateModel(t)}}return t.\u0275fac=function(e){return new(e||t)(o.Qb(Lt.a),o.Qb(Nt.a),o.Qb(zt.a),o.Qb(g),o.Qb(kt.a))},t.\u0275cmp=o.Kb({type:t,selectors:[["ng-component"]],features:[o.Bb([Lt.a]),o.zb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams","rhythmicityRequests"],[3,"data","tracesPerPlot",4,"ngIf"],[3,"data","tracesPerPlot"]],template:function(t,e){1&t&&o.Hc(0,oe,5,1,"div",0),2&t&&o.oc("ngIf",e.assay)},directives:[r.m,re,se.a],encapsulation:2}),t})()},{path:"",component:$t,pathMatch:"full"}]}];let be=(()=>{class t{}return t.\u0275mod=o.Ob({type:t}),t.\u0275inj=o.Nb({factory:function(e){return new(e||t)},imports:[[s.f.forChild(ce)],s.f]}),t})();var le=i("wMBR"),he=i("a6j2"),de=i("ZTEM");let ue=(()=>{class t{}return t.\u0275mod=o.Ob({type:t}),t.\u0275inj=o.Nb({factory:function(e){return new(e||t)},imports:[[r.c,vt.j,vt.x,le.a,he.a,de.a,be]]}),t})()}}]);