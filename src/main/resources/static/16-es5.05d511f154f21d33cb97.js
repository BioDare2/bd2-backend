function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var o=_superPropBase(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(i):n.value}})(e,t,i||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"9Gw/":function(e,t,i){"use strict";i.r(t);var o,n=i("ofXK"),a=i("3Pt+"),l=i("YiFe"),r=i("ZTEM"),s=i("tyNb"),c=i("yYXI"),u=i("EvUs"),b=i("fXoL"),f=i("UsWK"),d=((o=function(){function e(t){_classCallCheck(this,e),this.BD2REST=t}return _createClass(e,[{key:"getSimpleTableView",value:function(e){return this.BD2REST.fileViewSimpleTable(e).then((function(e){return e.data}))}},{key:"verifyFormat",value:function(e,t){return this.BD2REST.fileViewVerifyFormat(e,t).toPromise()}}]),e}()).\u0275fac=function(e){return new(e||o)(b.ac(f.a))},o.\u0275prov=b.Mb({token:o,factory:o.\u0275fac,providedIn:"root"}),o),h=i("GVyA"),m=i("KhIM"),p=function(){function e(t,i,o,n,a){_classCallCheck(this,e),this.rows=t,this.th=i,this.rowsLabels=o,this.specialRows=n,this.specialRowsLabels=a,this.width=e.maxLength(t),this.th=i||(t.length<1?[]:e.labelCols(this.width)),this.rowsLabels=o||e.labelRows(t.length),this.specialRows=n||[],this.specialRowsLabels=a||e.blankRows(this.specialRows.length)}return _createClass(e,null,[{key:"labelRows",value:function(e){for(var t=[],i=1;i<=e;i++)t.push(""+i);return t}},{key:"blankRows",value:function(e){for(var t=[],i=0;i<e;i++)t.push("");return t}},{key:"maxLength",value:function(e){return!e||e.length<1?0:Math.max.apply(Math,e.map((function(e){return e.length})))}},{key:"labelCols",value:function(e){for(var t=[],i=1;i<=e;i++)t.push(Object(m.i)(i));return t}}]),e}(),g=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"color",value:function(t){return e.colors[t%e.colors.length]}}]),e}();return e.TIME_BG="lightyellow",e.IGNORED_BG="lightgrey",e.NOISE_BG="darkgrey",e.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"],e}(),v=i("0IaG"),C=["columnTypeForm"];function y(e,t){if(1&e){var i=b.Xb();b.Wb(0,"li"),b.Wb(1,"input",14,15),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic().cellRole=e})),b.Vb(),b.Jc(3),b.Vb()}if(2&e){var o=t.$implicit,n=b.ic();b.Cb(1),b.pc("value",o.name),b.oc("ngModel",n.cellRole),b.Cb(2),b.Lc(" ",o.label," ")}}function w(e,t){if(1&e){var i=b.Xb();b.Wb(0,"div",5),b.Wb(1,"label",16),b.Jc(2,"Propagate until block size"),b.Vb(),b.Wb(3,"input",17,18),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic().rangeSize=e})),b.Vb(),b.Vb()}if(2&e){var o=b.ic();b.Cb(3),b.oc("ngModel",o.rangeSize)}}function k(e,t){if(1&e){var i=b.Xb();b.Wb(0,"div",5),b.Wb(1,"label",19),b.Jc(2,"Label"),b.Vb(),b.Wb(3,"input",20,21),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic().dataLabel=e})),b.Vb(),b.Vb()}if(2&e){var o=b.ic();b.Cb(3),b.oc("ngModel",o.dataLabel)}}function T(e,t){if(1&e&&(b.Wb(0,"option",32),b.Jc(1),b.Vb()),2&e){var i=t.$implicit;b.pc("value",i.name),b.Cb(1),b.Lc("",i.label," ")}}function V(e,t){if(1&e){var i=b.Xb();b.Wb(0,"div",5),b.Wb(1,"label",33),b.Jc(2,"Time between images (hours)"),b.Vb(),b.Wb(3,"input",34,35),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic(2).imgInterval=e})),b.Vb(),b.Vb()}if(2&e){var o=b.ic(2);b.Cb(3),b.oc("ngModel",o.imgInterval)}}function I(e,t){if(1&e){var i=b.Xb();b.Wb(0,"div"),b.Wb(1,"div",5),b.Wb(2,"label",22),b.Jc(3,"Type of time column"),b.Vb(),b.Wb(4,"select",23,24),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic().timeType=e})),b.Hc(6,T,2,2,"option",25),b.Vb(),b.Vb(),b.Wb(7,"div",5),b.Wb(8,"label",26),b.Jc(9,"Row with first timepoint"),b.Vb(),b.Wb(10,"input",27,28),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic().firstRow=e})),b.Vb(),b.Vb(),b.Wb(12,"div",5),b.Wb(13,"label",29),b.Jc(14,"Time offset (hours)"),b.Vb(),b.Wb(15,"input",30,31),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic().timeOffset=e})),b.Vb(),b.Vb(),b.Hc(17,V,5,1,"div",8),b.Vb()}if(2&e){var o=b.ic();b.Cb(4),b.oc("ngModel",o.timeType),b.Cb(2),b.oc("ngForOf",o.timeTypeOptions),b.Cb(4),b.oc("ngModel",o.firstRow),b.Cb(5),b.oc("ngModel",o.timeOffset),b.Cb(2),b.oc("ngIf",o.isImageBased())}}function O(e,t){if(1&e&&(b.Wb(0,"div",37),b.Jc(1),b.Vb()),2&e){var i=t.$implicit;b.Cb(1),b.Kc(i)}}function W(e,t){if(1&e&&(b.Wb(0,"div"),b.Hc(1,O,2,1,"div",36),b.Vb()),2&e){var i=b.ic();b.Cb(1),b.oc("ngForOf",i.errors)}}var R,D,M=function e(t,i,o,n){_classCallCheck(this,e),this.selectedRange=t,this.lastCol=i,this.showTime=o,this.label=n},_=((D=function(){function e(t,i){_classCallCheck(this,e),this.myself=t,this.errors=null,this.cellRoles=[m.d.IGNORED,m.d.BACKGROUND,m.d.TIME,m.d.DATA],this.timeTypeOptions=[m.h.TIME_IN_HOURS,m.h.TIME_IN_MINUTES,m.h.TIME_IN_SECONDS,m.h.IMG_NUMBER],this.lastCol=i.lastCol,this.showTime=i.showTime,this.show(i.selectedRange,i.label)}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"isData",value:function(){return this.cellRole===m.d.DATA.name}},{key:"isTime",value:function(){return this.cellRole===m.d.TIME.name}},{key:"isImageBased",value:function(){return this.isTime()&&this.timeType===m.h.IMG_NUMBER.name}},{key:"show",value:function(e,t){e&&(this.orgRange=e,this.rangeSize=e.range.size(),this.rangeLabel=t||e.columnRangeLabel,e.role&&(this.cellRole=e.role.name),e.role==m.d.DATA&&e.details&&(this.dataLabel=e.details.dataLabel),e.role==m.d.TIME&&e.details&&(this.timeType=e.details.timeType.name,this.timeOffset=e.details.timeOffset,this.imgInterval=e.details.imgInterval,this.firstRow=e.details.firstRow))}},{key:"hide",value:function(){this.myself.close()}},{key:"accepted",value:function(){this.isValid()&&this.myself.close(this.emitDescription())}},{key:"acceptedAndNext",value:function(){if(this.isValid()){var e=this.emitDescription();if(e.range.lastCol>=this.lastCol);else{var t=this.nextRange(e.range,this.rangeSize),i=new m.c(t);i.role=m.d.DATA,i.details=e.details,e.follow=i}this.myself.close(e)}}},{key:"nextRange",value:function(e,t){var i=e.lastCol+1,o=i+t-1;return o=Math.min(o,this.lastCol),new m.b(new m.a(i,e.first.row),new m.a(o,e.first.row))}},{key:"emitDescription",value:function(){var e=this.recalculateRange(this.orgRange.range),t={};if(this.isData())t=new m.f(this.dataLabel);else if(this.isTime()){var i=new m.g;i.firstRow=this.firstRow,i.timeType=m.h.get(this.timeType),i.timeOffset=this.timeOffset,this.isImageBased()&&(i.imgInterval=this.imgInterval),t=i}var o=new m.c(e,this.orgRange.content);return o.role=m.d.get(this.cellRole),o.details=t,o}},{key:"isValid",value:function(){var e=[];return m.d.get(this.cellRole)||e.push("Unknown role: "+this.cellRole),this.isData()&&(this.dataLabel&&""!==this.dataLabel.trim()||(e.push("Non empty data label is required"),this.dataLabel=null)),this.isTime()?((!this.firstRow||this.firstRow<1)&&e.push("Row nr of the first time point must be >= 1"),this.isImageBased()&&(!this.imgInterval||this.imgInterval<=0)&&e.push("Image interval must be > 0")):(!this.rangeSize||this.rangeSize<1)&&e.push("Block size must be >= 1"),0===e.length&&(this.errors=null,!0)}},{key:"recalculateRange",value:function(e){var t=e.first;if(this.isTime())return t=new m.a(t.col,this.firstRow),new m.b(t,t);if(this.rangeSize!==e.size()){var i=new m.a(Math.min(t.col+this.rangeSize-1,this.lastCol),t.row);return new m.b(t,i)}return e}},{key:"showTime",set:function(e){this.cellRoles=e?[m.d.IGNORED,m.d.BACKGROUND,m.d.TIME,m.d.DATA]:[m.d.IGNORED,m.d.BACKGROUND,m.d.DATA]}}]),e}()).\u0275fac=function(e){return new(e||D)(b.Qb(v.g),b.Qb(v.a))},D.\u0275cmp=b.Kb({type:D,selectors:[["ng-component"]],viewQuery:function(e,t){var i;1&e&&b.Fc(C,!0),2&e&&b.wc(i=b.fc())&&(t.columnTypeForm=i.first)},decls:28,vars:8,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],["columnTypeForm","ngForm"],[1,"form-group"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"disabled","click"],[1,"btn","btn-primary","btn-sm","m-1",3,"disabled","click"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","radio","required","","name","fCellRole",3,"value","ngModel","ngModelChange"],["fCellRole","ngModel"],["for","size"],["type","number","step","1","min","1","id","size","required","","name","fSize",1,"form-control",3,"ngModel","ngModelChange"],["fSize","ngModel"],["for","dataLabel"],["type","text","id","dataLabel","placeholder","e.g. TOC1 SD","required","","minlength","2","name","fDataLabel",1,"form-control",3,"ngModel","ngModelChange"],["fDataLabel","ngModel"],["for","timeType"],["id","timeType","required","","name","fTimeType",1,"form-control",3,"ngModel","ngModelChange"],["fTimeType","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","firstRow"],["type","number","id","firstRow","step","1","min","1","required","","placeholder","e.g. 2","name","fFirstRow",1,"form-control",3,"ngModel","ngModelChange"],["fFirstRow","ngModel"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control",3,"ngModel","ngModelChange"],["fTimeOffset","ngModel"],[3,"value"],["for","imgInterval"],["type","number","id","imgInterval","required","","step","any","min","0.01","placeholder","e.g. 1.5","name","fImgInterval",1,"form-control",3,"ngModel","ngModelChange"],["fImgInterval","ngModel"],["dismissOnTimeout","3000","dismissible","true","class","alert alert-danger","role","alert",4,"ngFor","ngForOf"],["dismissOnTimeout","3000","dismissible","true","role","alert",1,"alert","alert-danger"]],template:function(e,t){if(1&e&&(b.Wb(0,"h4",0),b.Jc(1,"Describe data column(s) "),b.Wb(2,"button",1),b.Wb(3,"span",2),b.Jc(4,"\xd7"),b.Vb(),b.Vb(),b.Vb(),b.Wb(5,"div",3),b.Wb(6,"p"),b.Jc(7," Columns "),b.Wb(8,"strong"),b.Jc(9),b.Vb(),b.Vb(),b.Wb(10,"form",null,4),b.Wb(12,"div",5),b.Wb(13,"label"),b.Jc(14,"Column type"),b.Vb(),b.Wb(15,"ul",6),b.Hc(16,y,4,3,"li",7),b.Vb(),b.Vb(),b.Hc(17,w,5,1,"div",8),b.Hc(18,k,5,1,"div",8),b.Hc(19,I,18,5,"div",9),b.Hc(20,W,2,1,"div",9),b.Vb(),b.Vb(),b.Wb(21,"div",10),b.Wb(22,"button",11),b.ec("click",(function(e){return t.acceptedAndNext()})),b.Jc(23,"OK and Next "),b.Vb(),b.Wb(24,"button",12),b.ec("click",(function(e){return t.accepted()})),b.Jc(25,"OK "),b.Vb(),b.Wb(26,"button",13),b.ec("click",(function(e){return t.hide()})),b.Jc(27,"Cancel"),b.Vb(),b.Vb()),2&e){var i=b.xc(11);b.Cb(9),b.Lc("[",t.rangeLabel,"]"),b.Cb(7),b.oc("ngForOf",t.cellRoles),b.Cb(1),b.oc("ngIf",!t.isTime()),b.Cb(1),b.oc("ngIf",t.isData()),b.Cb(1),b.oc("ngIf",t.isTime()),b.Cb(1),b.oc("ngIf",t.errors),b.Cb(2),b.oc("disabled",!i.form.valid),b.Cb(2),b.oc("disabled",!i.form.valid)}},directives:[v.h,v.d,v.e,a.C,a.q,a.r,n.l,n.m,v.c,a.w,a.c,a.y,a.p,a.s,a.u,a.l,a.z,a.t,a.B],encapsulation:2}),D),B=((R=function(){function e(t){_classCallCheck(this,e),this.show(t)}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"show",value:function(e){this.orgRange=e,this.rowNr=e.range.first.row,this.values=e.content}}]),e}()).\u0275fac=function(e){return new(e||R)(b.Qb(v.a))},R.\u0275cmp=b.Kb({type:R,selectors:[["ng-component"]],decls:24,vars:3,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],[1,"word_wrapping"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"mat-dialog-close"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm"]],template:function(e,t){1&e&&(b.Wb(0,"h4",0),b.Jc(1,"Use row content as data labels(s) "),b.Wb(2,"button",1),b.Wb(3,"span",2),b.Jc(4,"\xd7"),b.Vb(),b.Vb(),b.Vb(),b.Wb(5,"div",3),b.Wb(6,"div"),b.Wb(7,"p"),b.Jc(8,"Use values from row "),b.Wb(9,"strong"),b.Jc(10),b.Vb(),b.Jc(11," as data labels"),b.Vb(),b.Wb(12,"p"),b.Jc(13,"Existing labels and column types will be overwritten"),b.Vb(),b.Vb(),b.Wb(14,"div",4),b.Wb(15,"p"),b.Wb(16,"strong"),b.Jc(17,"Labels: "),b.Vb(),b.Jc(18),b.Vb(),b.Vb(),b.Vb(),b.Wb(19,"div",5),b.Wb(20,"button",6),b.Jc(21,"Copy labels"),b.Vb(),b.Wb(22,"button",7),b.Jc(23,"Cancel"),b.Vb(),b.Vb()),2&e&&(b.Cb(10),b.Lc("[",t.rowNr,"]"),b.Cb(8),b.Kc(t.values),b.Cb(2),b.oc("mat-dialog-close",t.orgRange))},directives:[v.h,v.d,v.e,v.c],encapsulation:2}),R),A=i("9+85");function L(e,t){1&e&&(b.Wb(0,"div",9),b.Wb(1,"strong"),b.Jc(2,"Missing data labels. Please use one of the methods:"),b.Vb(),b.Wb(3,"ul"),b.Wb(4,"li"),b.Jc(5,"Click and draw over the headers of columns to select the range and assign the data labels in the popup dialog. "),b.Vb(),b.Wb(6,"li"),b.Jc(7,"Use the form below to manually provide the column range and the data label."),b.Vb(),b.Vb(),b.Vb())}function J(e,t){if(1&e){var i=b.Xb();b.Wb(0,"div"),b.Wb(1,"div",10),b.Wb(2,"label",11),b.Jc(3,"Time parameter: offset (hours)"),b.Vb(),b.Wb(4,"input",12,13),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic(2).timeColumnDescription.details.timeOffset=e})),b.Vb(),b.Vb(),b.Vb()}if(2&e){var o=b.ic(2);b.Cb(4),b.oc("ngModel",o.timeColumnDescription.details.timeOffset)}}function E(e,t){if(1&e){var i=b.Xb();b.Wb(0,"li",17),b.ec("click",(function(e){b.Ac(i);var o=t.$implicit;return b.ic(3).editBlock(o)})),b.Wb(1,"span"),b.Wb(2,"strong"),b.Jc(3),b.Vb(),b.Jc(4),b.Vb(),b.Wb(5,"a",18),b.ec("click",(function(e){b.Ac(i);var o=t.$implicit;return b.ic(3).deleteBlock(o)})),b.Wb(6,"i",19),b.Jc(7,"delete_forever"),b.Vb(),b.Vb(),b.Vb()}if(2&e){var o=t.$implicit;b.Cb(3),b.Kc(o.topcountLabel),b.Cb(1),b.Lc(" : ",o.value,"")}}function S(e,t){if(1&e&&(b.Wb(0,"div"),b.Wb(1,"p"),b.Wb(2,"strong"),b.Jc(3,"Columns descriptions (select to edit)"),b.Vb(),b.Vb(),b.Wb(4,"div",14),b.Wb(5,"ul",15),b.Hc(6,E,8,2,"li",16),b.Vb(),b.Vb(),b.Vb()),2&e){var i=b.ic(2);b.Cb(6),b.oc("ngForOf",i.dataBlocks)}}function F(e,t){if(1&e){var i=b.Xb();b.Wb(0,"th",20),b.ec("mousedown",(function(e){b.Ac(i);var o=t.$implicit;return b.ic(2).thSelectStart(o)}))("mouseup",(function(e){b.Ac(i);var o=t.$implicit;return b.ic(2).thSelectEnd(o)})),b.Jc(1),b.Vb()}if(2&e){var o=t.$implicit,n=b.ic(2);b.Cb(1),b.Lc(" ",n.dataModel.th[o]," ")}}function P(e,t){if(1&e&&(b.Wb(0,"td"),b.Jc(1),b.Vb()),2&e){var i=t.$implicit,o=b.ic().$implicit,n=b.ic(2);b.Gc("background-color",n.bgColors[i]?n.bgColors[i]:"inherited"),b.Cb(1),b.Lc("",o[i]," ")}}function N(e,t){if(1&e&&(b.Wb(0,"tr"),b.Wb(1,"td",21),b.Jc(2),b.Vb(),b.Hc(3,P,2,3,"td",22),b.Vb()),2&e){var i=t.index,o=b.ic(2);b.Cb(2),b.Kc(o.dataModel.specialRowsLabels[i]),b.Cb(1),b.oc("ngForOf",o.visibleColIx)}}function G(e,t){if(1&e&&(b.Wb(0,"td"),b.Jc(1),b.Vb()),2&e){var i=t.$implicit,o=b.ic().$implicit,n=b.ic(2);b.Gc("background-color",n.bgColors[i]?n.bgColors[i]:"inherited"),b.Cb(1),b.Lc("",o[i]," ")}}function x(e,t){if(1&e&&(b.Wb(0,"tr"),b.Wb(1,"td",21),b.Jc(2),b.Vb(),b.Hc(3,G,2,3,"td",22),b.Vb()),2&e){var i=t.index,o=b.ic(2);b.Cb(2),b.Kc(o.dataModel.rowsLabels[i]),b.Cb(1),b.oc("ngForOf",o.visibleColIx)}}function H(e,t){if(1&e){var i=b.Xb();b.Wb(0,"div"),b.Rb(1,"hr"),b.Wb(2,"div"),b.Wb(3,"h4"),b.Jc(4,"Current Topcount import parameters "),b.Vb(),b.Hc(5,L,8,0,"div",1),b.Hc(6,J,6,1,"div",0),b.Hc(7,S,7,1,"div",2),b.Wb(8,"div"),b.Wb(9,"button",3),b.ec("click",(function(e){return b.Ac(i),b.ic().accept()})),b.Jc(10,"Import timeseries "),b.Vb(),b.Vb(),b.Vb(),b.Rb(11,"hr"),b.Wb(12,"h4"),b.Jc(13,"Data table "),b.Wb(14,"small"),b.Jc(15,"(only top rows)"),b.Vb(),b.Vb(),b.Wb(16,"p"),b.Jc(17,"Click on column headers for description options"),b.Vb(),b.Wb(18,"div",4),b.Wb(19,"table",5),b.Wb(20,"thead"),b.Wb(21,"tr",6),b.Rb(22,"th"),b.Hc(23,F,2,1,"th",7),b.Vb(),b.Vb(),b.Wb(24,"tbody"),b.Hc(25,N,4,2,"tr",8),b.Hc(26,x,4,2,"tr",8),b.Vb(),b.Vb(),b.Vb(),b.Vb()}if(2&e){var o=b.ic();b.Cb(5),b.oc("ngIf",!o.hasData()),b.Cb(1),b.oc("ngIf",o.timeColumnDescription),b.Cb(1),b.oc("ngIf",o.dataBlocks&&o.dataBlocks.length>0),b.Cb(2),b.oc("disabled",o.blocked||!o.hasTime()||!o.hasData()),b.Cb(14),b.oc("ngForOf",o.visibleColIx),b.Cb(2),b.oc("ngForOf",o.dataModel.specialRows),b.Cb(1),b.oc("ngForOf",o.dataModel.rows)}}var K,j=((K=function(){function e(t,i){_classCallCheck(this,e),this.confDialogs=t,this.matDialog=i,this.onAccepted=new b.o,this.blocked=!1,this.confirmDataLoss=!1,this.columnBlocks=new m.e,this.dataBlocks=[],this.bgColors=[]}return _createClass(e,[{key:"topcountHeaders",value:function(){var e=[];return["A","B","C","D","E","F","G","H"].forEach((function(t){for(var i=1;i<13;i++)e.push(t+i)})),e}},{key:"initTime",value:function(){var e=new m.b(new m.a(0,0),new m.a(0,0)),t=new m.g;t.timeType=m.h.TIME_IN_HOURS,t.timeOffset=0,t.firstRow=1;var i=new m.c(e);i.role=m.d.TIME,i.details=t,this.timeColumnDescription=i}},{key:"hasTime",value:function(){return this.timeColumnDescription&&this.timeColumnDescription.role===m.d.TIME}},{key:"hasData",value:function(){return this.dataBlocks.some((function(e){return e.details.role===m.d.DATA}))}},{key:"rowSelected",value:function(e){var t=this.joinRow(e),i=new m.a(0,e+1),o=new m.b(i,i),n=new m.c(o,t);this.askCopyRow(n)}},{key:"askCopyRow",value:function(e){var t=this;this.matDialog.open(B,{data:e,autoFocus:!1}).afterClosed().subscribe((function(e){e&&t.copyRowAsLabels(e)}))}},{key:"thSelectStart",value:function(e){this.thSelectedCol=e}},{key:"thSelectEnd",value:function(e){if(void 0!==this.thSelectedCol&&null!=this.thSelectedCol){var t=new m.a(this.thSelectedCol+1,1),i=new m.a(e+1,1),o=new m.b(t,i),n=new m.c(o,void 0),a=this.columnBlocks.details(t.col);a&&(n.role=a.role,n.details=a.details),this.thSelectedCol=void 0,this.askColumnsDetails(n)}}},{key:"askColumnsDetails",value:function(e){var t=this,i=this.rangeToTopcountLabel(e),o=new M(e,this.lastCol,!1,i);this.matDialog.open(_,{data:o,autoFocus:!1}).afterClosed().subscribe((function(e){if(e){var i=e.follow;e.follow=void 0,t.setColumnType(e),i&&t.askColumnsDetails(i)}}))}},{key:"rangeToTopcountLabel",value:function(e){var t=e.range;return Object(m.j)(t.firstCol)+"-"+Object(m.j)(t.lastCol)}},{key:"editBlock",value:function(e){e&&this.askColumnsDetails(e.details)}},{key:"deleteBlock",value:function(e){e&&(e.details.role==m.d.TIME?this.clearTime():this.resetRegion(e.details.range),this.dataBlocks=this.columnBlocks.blocks)}},{key:"accept",value:function(){var e=this;if(this.hasTime()&&this.hasData()){var t=Promise.resolve(!0);this.containsDataGaps()&&(t=this.confDialogs.confirm("Do you want to import partial data?","Not all columns are described. Data columns without annotations will not be imported.<br>Click OK if you want to proceed.").toPromise()),t.then((function(t){return!!t&&(!e.confirmDataLoss||e.confDialogs.confirm("Do you want to replace the existing data?","It will also erase all analysis results. <br>Click OK if you want to proceed.").toPromise())})).then((function(t){t&&e.emitParameters()})).catch((function(e){return console.log("Dialog error: "+e)}))}}},{key:"containsDataGaps",value:function(){if(this.dataBlocks.length<1)return!0;if(this.dataBlocks[this.dataBlocks.length-1].end<this.lastCol)return!0;for(var e=this.dataBlocks[0].start-1,t=0;t<this.dataBlocks.length;t++){if(this.dataBlocks[t].start!==e+1)return!0;e=this.dataBlocks[t].end}return!1}},{key:"emitParameters",value:function(){var e=new u.c;e.timeColumn=this.timeColumnDescription,e.dataBlocks=this.dataBlocks.map((function(e){return e.details})),this.onAccepted.emit(e)}},{key:"joinRow",value:function(e){return this.dataModel.rows[e].slice(0,10).join(" | ")+"..."}},{key:"setColumnType",value:function(e){if(e&&void 0!==e.role){var t;switch(this.timeColumnDescription&&(e.role==m.d.TIME?this.clearTime():this.timeColumnDescription.firstCol>=e.firstCol&&this.timeColumnDescription.firstCol<=e.lastCol&&this.clearTime()),e.role){case m.d.IGNORED:t="ign.";break;case m.d.BACKGROUND:t="bcg.";break;case m.d.TIME:t="Time";break;case m.d.DATA:t=e.details.dataLabel}this.columnBlocks.insert(e,t),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks;var i=this.dataModel.specialRows[0];if(i)for(var o=e.firstCol-1;o<e.lastCol;o++)i[o]=t;e.role==m.d.TIME&&(this.timeColumnDescription=e),this.updateBackgrounds()}}},{key:"copyRowAsLabels",value:function(e){var t=this;if(e){this.clearTime();var i=this.dataModel.specialRows[0];this.dataModel.rows[e.range.first.row-1].forEach((function(e,o){if(e){var n=new m.f(e),a=new m.a(o+1,0),l=new m.b(a,a),r=new m.c(l,void 0);r.details=n,r.role=m.d.DATA,t.columnBlocks.insert(r,e),i[o]=e}})),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks,this.updateBackgrounds()}}},{key:"clearTime",value:function(){this.timeColumnDescription&&(this.resetRegion(this.timeColumnDescription.range),this.timeColumnDescription=void 0)}},{key:"updateBackgrounds",value:function(){for(var e=0;e<this.dataBlocks.length;e++){var t=this.dataBlocks[e],i=g.color(e);t.details.role==m.d.IGNORED&&(i=g.IGNORED_BG),t.details.role==m.d.BACKGROUND&&(i=g.NOISE_BG),t.details.role==m.d.TIME&&(i=g.TIME_BG);for(var o=t.start-1;o<t.end;o++)this.bgColors[o]=i}}},{key:"resetRegion",value:function(e){this.resetLabels(e),this.resetBackground(e),this.columnBlocks.delete(e)}},{key:"resetBackground",value:function(e){for(var t=e.firstCol-1;t<e.lastCol;t++)this.bgColors[t]="transparent"}},{key:"resetLabels",value:function(e){for(var t=this.dataModel.specialRows[0],i=e.firstCol-1;i<e.lastCol;i++)t[i]="-"}},{key:"fakeData",value:function(){var e=[],t=[];t.push("");for(var i=1;i<25;i++)t.push("RO "+i);e.push(t),(t=[]).push("");for(var o=1;o<25;o++)t.push("cls"+Math.round(o/3));e.push(t);for(var n=1;n<5;n++){(t=[]).push(""+n);for(var a=1;a<25;a++)t.push(""+(n+a));e.push(t)}return e}},{key:"dataTable",set:function(e){if(e&&!(e.length<1)){var t=new p(e,this.topcountHeaders(),void 0,[[]],["L."]);this.dataModel=t,this.lastCol=t.width,this.visibleColIx=[];for(var i=0;i<t.width;i++)this.visibleColIx.push(i);this.initTime()}}}]),e}()).\u0275fac=function(e){return new(e||K)(b.Qb(A.a),b.Qb(v.b))},K.\u0275cmp=b.Kb({type:K,selectors:[["bd2-describe-topcount-table"]],inputs:{blocked:"blocked",confirmDataLoss:"confirmDataLoss",dataTable:"dataTable"},outputs:{onAccepted:"onAccepted"},decls:1,vars:1,consts:[[4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["style","",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[2,"overflow-x","auto"],["role","grid",1,"table","table-bordered","excel-table",2,"width","auto"],["role","row"],[3,"mousedown","mouseup",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["type","danger","role","alert",1,"alert","alert-danger"],[1,"form-group"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control","short-input",3,"ngModel","ngModelChange"],["fTimeOffset","ngModel"],[2,"max-height","20em","overflow-y","auto","margin-bottom","1em"],[1,"list-group"],["class","list-group-item",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item",3,"click"],["role","button","aria-label","delete",1,"float-right",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[3,"mousedown","mouseup"],[1,"rowh"],[3,"background-color",4,"ngFor","ngForOf"]],template:function(e,t){1&e&&b.Hc(0,H,27,7,"div",0),2&e&&b.oc("ngIf",t.dataModel)},directives:[n.m,n.l,a.u,a.c,a.p,a.s],encapsulation:2}),K);function z(e,t){if(1&e){var i=b.Xb();b.Wb(0,"bd2-describe-topcount-table",1),b.ec("onAccepted",(function(e){return b.Ac(i),b.ic().import(e)})),b.Vb()}if(2&e){var o=b.ic();b.oc("dataTable",o.dataTable)("blocked",o.blocked)("confirmDataLoss",null==o.assay?null:o.assay.features.hasTSData)}}var U,X,$=[{path:"",children:[{path:":format/:fileId",component:(U=function(e){function t(e,i,o){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,o))).fileViewService=e,n.route=i,n.blocked=!1,n.titlePart=" Import Data",n}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;_get(_getPrototypeOf(t.prototype),"ngOnInit",this).call(this),this.route.params.forEach((function(t){var i=t.fileId,o=t.format;i&&o?e.loadData(o,i):console.log(e.constructor.name+" null parameters")}))}},{key:"loadData",value:function(e,t){var i=this;this.format=u.e.get(e),this.fileId=t,this.blocked=!1,this.fileViewService.getSimpleTableView(t).then((function(e){i.dataTable=e})).catch((function(e){i.feedback.error(e)}))}},{key:"import",value:function(e){var t=this;if(e&&this.fileId&&this.format){this.blocked=!0;var i=new u.d;i.fileId=this.fileId,i.importFormat=this.format,i.importParameters=e,this.experimentService.importTimeSeries(this.assay,i).toPromise().then((function(e){return t.feedback.success("Imported "+e.imported+" timeseries"),e})).then((function(){return t.refreshModel()})).then((function(e){return t.goToTSView()})).catch((function(e){t.blocked=!1,t.feedback.error(e)}))}}},{key:"goToTSView",value:function(){var e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}}]),t}(c.a),U.\u0275fac=function(e){return new(e||U)(b.Qb(d),b.Qb(s.a),b.Qb(h.a))},U.\u0275cmp=b.Kb({type:U,selectors:[["ng-component"]],features:[b.Bb([]),b.zb],decls:3,vars:1,consts:[[3,"dataTable","blocked","confirmDataLoss","onAccepted",4,"ngIf"],[3,"dataTable","blocked","confirmDataLoss","onAccepted"]],template:function(e,t){1&e&&(b.Wb(0,"h3"),b.Jc(1,"Timeseries import"),b.Vb(),b.Hc(2,z,1,3,"bd2-describe-topcount-table",0)),2&e&&(b.Cb(2),b.oc("ngIf","TOPCOUNT"===(null==t.format?null:t.format.name)))},directives:[n.m,j],encapsulation:2}),U)}]}],q=((X=function e(){_classCallCheck(this,e)}).\u0275mod=b.Ob({type:X}),X.\u0275inj=b.Nb({factory:function(e){return new(e||X)},imports:[[s.f.forChild($)],s.f]}),X);i.d(t,"TsOldImportModule",(function(){return Y}));var Q,Y=((Q=function e(){_classCallCheck(this,e)}).\u0275mod=b.Ob({type:Q}),Q.\u0275inj=b.Nb({factory:function(e){return new(e||Q)},imports:[[n.c,a.j,a.x,l.a,r.a,q]]}),Q)}}]);