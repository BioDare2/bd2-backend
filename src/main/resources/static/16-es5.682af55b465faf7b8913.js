function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=_superPropBase(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(n=(o=c.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(s){i=!0,a=s}finally{try{n||null==c.return||c.return()}finally{if(i)throw a}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{ja10:function(e,t,r){"use strict";r.r(t),r.d(t,"RhythmicityModule",(function(){return pt}));var n,i,a=r("ofXK"),o=r("tyNb"),c=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),(i=t.call(this,n)).rhythmicityService=e,i.titlePart=" Rhythm",i}return _createClass(r,[{key:"goToRhythmicityHome",value:function(e){var t=this.expHomePath(e);t.push("rhythmicity"),this.router.navigate(t)}}]),r}(r("yYXI").a),s=r("fXoL"),u=r("2Vo4"),l=r("PqYM"),b=r("B9cw"),d=r("Iab2"),h=r("7jps"),f=r("zQ7r"),p=r("Iurr"),m=r("tu3j"),y=r("FjDX"),v=((n=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return _classCallCheck(this,r),(n=t.call(this,i)).rhythmicityService=e,n.finishedJob$=n.finished$,n.runningJob$=n.running$,n.allJob$=n.all$,n}return _createClass(r,[{key:"initIntervalsKeeper",value:function(){return new m.a(1e3,3e4,6e5,2)}},{key:"assayJob",value:function(e){this.input(e)}},{key:"sameInput",value:function(e,t){return e[1]===t[1]&&e[0]===t[0]}},{key:"fetchAsset",value:function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1];return this.rhythmicityService.getJob(r,n)}},{key:"hasFailed",value:function(e){return h.e.hasFailed(e)}},{key:"isFinished",value:function(e){return h.e.isFinished(e)}},{key:"isRunning",value:function(e){return h.e.isRunning(e)}},{key:"assetToId",value:function(e){return e.jobId}},{key:"assetToInput",value:function(e){return[e.parentId,e.jobId]}},{key:"currentJob",get:function(){return this.currentAsset}}]),r}(f.a)).\u0275fac=function(e){return new(e||n)(s.ac(y.a),s.ac(p.a,8))},n.\u0275prov=s.Mb({token:n,factory:n.\u0275fac}),n),g=r("M9IT"),C=r("vkgz"),k=r("8jiw"),V=((i=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return _classCallCheck(this,r),(n=t.call(this,i)).rhythmicityService=e,n.results$=n.data$,n}return _createClass(r,[{key:"isClassicJob",value:function(){var e,t;return"BD2JTK"===(null===(t=null===(e=this.currentInput)||void 0===e?void 0:e.parameters)||void 0===t?void 0:t.METHOD)}},{key:"sameInput",value:function(e,t){return h.e.sameJob(e,t)}},{key:"assetToData",value:function(e,t){return e.results}},{key:"fetchAsset",value:function(e){var t=this;return this.rhythmicityService.getResults(e.parentId,e.jobId).pipe(Object(C.a)((function(e){return t.labelPatterns(e)})))}},{key:"sortingKey",value:function(e){switch(e.active){case"label":return function(e){return e.label};case"id":return function(e){return+e.id};case"empp":return function(e){return+e.result.empP};case"emppbh":return function(e){return+e.result.empPBH};case"p":return function(e){return+e.result.p};case"pbh":return function(e){return+e.result.pBH};case"tau":return function(e){return+e.result.tau};case"period":return function(e){return e.result.pattern.period};case"peak":return function(e){return e.result.pattern.peak};case"trough":return function(e){return e.result.pattern.trough};default:return console.error("Not implemented sorting for "+e.active),function(e){return 0}}}},{key:"processData",value:function(e,t){return t?(this.rankResults(e,t.pValue,t.bhCorrection,this.isClassicJob()),e):e}},{key:"labelPatterns",value:function(e){var t=this;e.results.forEach((function(e){e.result.patternLabel=t.describePattern(e.result),e.result.pattern.shapeLabel=t.patternToShape(e.result.pattern)}))}},{key:"describePattern",value:function(e){var t=e.pattern,r=Math.round(10*t.period)/10,n=Math.round(100*t.peak)/100,i=Math.round(100*t.trough)/100;return"".concat(this.patternToShape(t),"\t").concat(r,"\t").concat(n,"\t").concat(i)}},{key:"patternToShape",value:function(e){switch(e.waveform){case"ASYM_COSINE":return.5===e.leftPortion?"COS":"ACOS";case"ASYM_COS_SPIKE":return"SPIKE";case"ASYM_COS_SPIKE_NEG":return"NPIKE";default:return e.waveform}}},{key:"rankResults",value:function(e,t,r,n){e.forEach((function(e){var i,a=e.result;i=n?r?a.pBH:a.p:r?a.empPBH:a.empP,a.rhythmic=i<t}))}}]),r}(k.a)).\u0275fac=function(e){return new(e||i)(s.ac(y.a),s.ac(p.a,8))},i.\u0275prov=s.Mb({token:i,factory:i.\u0275fac}),i),W=r("6tuW"),P=r("+0xr"),w=r("Dh3D"),I=r("bv9b");function S(e,t){1&e&&s.Rb(0,"mat-progress-bar",28)}function _(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"Id"),s.Vb())}function T(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(r.id)}}function O(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"Label"),s.Vb())}function E(e,t){if(1&e&&(s.Wb(0,"td",31),s.Gc(1),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(r.label)}}function G(e,t){1&e&&(s.Wb(0,"th",32),s.Gc(1,"Rhythmic"),s.Vb())}function j(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.Vb()),2&e){var r=t.$implicit;s.Gb("bold",r.result.rhythmic),s.Cb(1),s.Hc(r.result.rhythmic)}}function R(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"emp-p"),s.Vb())}function D(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,r.result.empP,"1.0-5"))}}function x(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"BH emp-p"),s.Vb())}function J(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,r.result.empPBH,"1.0-5"))}}function M(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"Tau"),s.Vb())}function H(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,r.result.tau,"1.0-2"))}}function A(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"p"),s.Vb())}function $(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,r.result.p,"1.0-5"))}}function K(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"BH p"),s.Vb())}function B(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,r.result.pBH,"1.0-5"))}}function F(e,t){1&e&&(s.Wb(0,"th",32),s.Gc(1,"Pattern"),s.Vb())}function U(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(r.result.patternLabel)}}function z(e,t){1&e&&(s.Wb(0,"th",32),s.Gc(1,"P.Shape"),s.Vb())}function N(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(r.result.pattern.shapeLabel)}}function L(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"P.Period"),s.Vb())}function q(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,r.result.pattern.period,"1.0-1"))}}function Q(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"P.Peak"),s.Vb())}function X(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,r.result.pattern.peak,"1.1-1"))}}function Y(e,t){1&e&&(s.Wb(0,"th",32),s.Gc(1,"P.Peak"),s.Vb())}function Z(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,24*r.result.pattern.peak/r.result.pattern.period,"1.1-1"))}}function ee(e,t){1&e&&(s.Wb(0,"th",29),s.Gc(1,"P.Trough"),s.Vb())}function te(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,r.result.pattern.trough,"1.1-1"))}}function re(e,t){1&e&&(s.Wb(0,"th",32),s.Gc(1,"P.Trough"),s.Vb())}function ne(e,t){if(1&e&&(s.Wb(0,"td",30),s.Gc(1),s.jc(2,"number"),s.Vb()),2&e){var r=t.$implicit;s.Cb(1),s.Hc(s.lc(2,1,24*r.result.pattern.trough/r.result.pattern.period,"1.1-1"))}}function ie(e,t){1&e&&s.Rb(0,"tr",33)}function ae(e,t){1&e&&s.Rb(0,"tr",34)}var oe,ce=function(){return[10,25,50,100,250]},se=((oe=function(){function e(t,r){_classCallCheck(this,e),this.fetcher=t,this.feedback=r,this.normEmpPColumns=["id","label","rhythmic","empp","tau"],this.normClsPColumns=["id","label","rhythmic","p","tau"],this.bhEmpPColumns=["id","label","rhythmic","emppbh","tau"],this.bhClsPColumns=["id","label","rhythmic","pbh","tau"],this.patternColumns=["shape","period","peak","trough"],this.patternColumnsC=["shape","period","peakc","troughc"],this.displayedColumns=this.normEmpPColumns,this.disablePaginator=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.fetcher.error$.subscribe((function(t){return e.feedback.error(t)}));var t=new g.d;t.pageSize=25,t.pageIndex=0,this.fetcher.page(t),this.fetcher.on(!0)}},{key:"ngOnDestroy",value:function(){this.fetcher.close()}},{key:"ngAfterViewInit",value:function(){}},{key:"reload",value:function(){this.fetcher.refresh()}},{key:"sortData",value:function(e){this.fetcher.sort(e)}},{key:"loadPage",value:function(e){this.fetcher.page(e)}},{key:"job",set:function(e){e&&this.fetcher.input(e)}},{key:"statTestParams",set:function(e){if(e){this.fetcher.params(e);var t=e.bhCorrection?this.bhEmpPColumns:this.normEmpPColumns;this.fetcher.isClassicJob()&&(t=e.bhCorrection?this.bhClsPColumns:this.normClsPColumns),e.showPattern&&(t=t.concat(e.circadian?this.patternColumnsC:this.patternColumns)),this.displayedColumns=t}}}]),e}()).\u0275fac=function(e){return new(e||oe)(s.Qb(V),s.Qb(W.a))},oe.\u0275cmp=s.Kb({type:oe,selectors:[["bd2-rhythmicity-results-mdtable"]],inputs:{job:"job",statTestParams:"statTestParams"},features:[s.Bb([V])],decls:55,vars:18,consts:[[1,"mat-elevation-z8"],["mode","indeterminate",4,"ngIf"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["paginator",""],["mat-table","","matSort","","aria-label","Results","matSort","","matSortActive","id","matSortDirection","asc",1,"full-width-table",3,"dataSource","matSortChange"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","label"],["mat-cell","","class","word_wrapping","style","max-width: 100px",4,"matCellDef"],["matColumnDef","rhythmic"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"bold",4,"matCellDef"],["matColumnDef","empp"],["matColumnDef","emppbh"],["matColumnDef","tau"],["matColumnDef","p"],["matColumnDef","pbh"],["matColumnDef","pattern"],["matColumnDef","shape"],["matColumnDef","period"],["matColumnDef","peak"],["matColumnDef","peakc"],["matColumnDef","trough"],["matColumnDef","troughc"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["paginator2",""],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"word_wrapping",2,"max-width","100px"],["mat-header-cell",""],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&(s.Wb(0,"div",0),s.Ec(1,S,1,0,"mat-progress-bar",1),s.jc(2,"async"),s.Wb(3,"mat-paginator",2,3),s.ec("page",(function(e){return t.loadPage(e)})),s.Vb(),s.Wb(5,"table",4),s.ec("matSortChange",(function(e){return t.sortData(e)})),s.Ub(6,5),s.Ec(7,_,2,0,"th",6),s.Ec(8,T,2,1,"td",7),s.Tb(),s.Ub(9,8),s.Ec(10,O,2,0,"th",6),s.Ec(11,E,2,1,"td",9),s.Tb(),s.Ub(12,10),s.Ec(13,G,2,0,"th",11),s.Ec(14,j,2,3,"td",12),s.Tb(),s.Ub(15,13),s.Ec(16,R,2,0,"th",6),s.Ec(17,D,3,4,"td",7),s.Tb(),s.Ub(18,14),s.Ec(19,x,2,0,"th",6),s.Ec(20,J,3,4,"td",7),s.Tb(),s.Ub(21,15),s.Ec(22,M,2,0,"th",6),s.Ec(23,H,3,4,"td",7),s.Tb(),s.Ub(24,16),s.Ec(25,A,2,0,"th",6),s.Ec(26,$,3,4,"td",7),s.Tb(),s.Ub(27,17),s.Ec(28,K,2,0,"th",6),s.Ec(29,B,3,4,"td",7),s.Tb(),s.Ub(30,18),s.Ec(31,F,2,0,"th",11),s.Ec(32,U,2,1,"td",7),s.Tb(),s.Ub(33,19),s.Ec(34,z,2,0,"th",11),s.Ec(35,N,2,1,"td",7),s.Tb(),s.Ub(36,20),s.Ec(37,L,2,0,"th",6),s.Ec(38,q,3,4,"td",7),s.Tb(),s.Ub(39,21),s.Ec(40,Q,2,0,"th",6),s.Ec(41,X,3,4,"td",7),s.Tb(),s.Ub(42,22),s.Ec(43,Y,2,0,"th",11),s.Ec(44,Z,3,4,"td",7),s.Tb(),s.Ub(45,23),s.Ec(46,ee,2,0,"th",6),s.Ec(47,te,3,4,"td",7),s.Tb(),s.Ub(48,24),s.Ec(49,re,2,0,"th",11),s.Ec(50,ne,3,4,"td",7),s.Tb(),s.Ec(51,ie,1,0,"tr",25),s.Ec(52,ae,1,0,"tr",26),s.Vb(),s.Wb(53,"mat-paginator",2,27),s.ec("page",(function(e){return t.loadPage(e)})),s.Vb(),s.Vb()),2&e&&(s.Cb(1),s.oc("ngIf",s.kc(2,14,t.fetcher.isBusy$)),s.Cb(2),s.oc("length",t.fetcher.dataLength)("disabled",t.disablePaginator)("pageSize",(null==t.fetcher.currentPage?null:t.fetcher.currentPage.pageSize)||25)("pageIndex",null==t.fetcher.currentPage?null:t.fetcher.currentPage.pageIndex)("pageSizeOptions",s.qc(16,ce)),s.Cb(2),s.oc("dataSource",t.fetcher.results$),s.Cb(46),s.oc("matHeaderRowDef",t.displayedColumns),s.Cb(1),s.oc("matRowDefColumns",t.displayedColumns),s.Cb(1),s.oc("length",t.fetcher.dataLength)("disabled",t.disablePaginator)("pageSize",(null==t.fetcher.currentPage?null:t.fetcher.currentPage.pageSize)||25)("pageIndex",null==t.fetcher.currentPage?null:t.fetcher.currentPage.pageIndex)("pageSizeOptions",s.qc(17,ce)))},directives:[a.m,g.a,P.n,w.a,P.c,P.i,P.b,P.k,P.m,I.a,P.h,w.b,P.a,P.j,P.l],pipes:[a.b,a.f],styles:[".full-width-table[_ngcontent-%COMP%] {\n      width: 100%;\n    }"]}),oe),ue=r("BOp5"),le=r("9+85"),be=r("Wp6s"),de=r("f0Cb"),he=r("Xa2L"),fe=r("3Pt+"),pe=r("kmnG"),me=r("QibW");function ye(e,t){if(1&e&&(s.Wb(0,"mat-radio-button",5),s.Gc(1),s.Vb()),2&e){var r=t.$implicit;s.oc("value",r),s.Cb(1),s.Hc(r)}}var ve,ge,Ce=((ve=function(){function e(){_classCallCheck(this,e),this.values=[1e-4,.001,.005,.01,.05,.1],this.pvalue=.001,this.pvalue$=new s.o}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngAfterViewInit",value:function(){this.pvalue$.emit(this.pvalue)}},{key:"selected",value:function(e){this.pvalue$.emit(e.value)}}]),e}()).\u0275fac=function(e){return new(e||ve)},ve.\u0275cmp=s.Kb({type:ve,selectors:[["bd2-pvalue-form"]],outputs:{pvalue$:"pvalue$"},decls:8,vars:2,consts:[[1,"form-inline"],[1,"mx-auto","text-center"],["id","pvalues-label",1,"mb-1"],["aria-label","Select p-value","aria-labelledby","pvalues-label",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,t){1&e&&(s.Wb(0,"form",0),s.Wb(1,"div",1),s.Wb(2,"mat-label",2),s.Wb(3,"strong"),s.Gc(4,"p-value threshold:"),s.Vb(),s.Vb(),s.Wb(5,"div"),s.Wb(6,"mat-radio-group",3),s.ec("change",(function(e){return t.selected(e)})),s.Ec(7,ye,2,2,"mat-radio-button",4),s.Vb(),s.Vb(),s.Vb(),s.Vb()),2&e&&(s.Cb(6),s.oc("value",t.pvalue),s.Cb(1),s.oc("ngForOf",t.values))},directives:[fe.C,fe.q,fe.r,pe.g,me.b,a.l,me.a],styles:[".mat-radio-button[_ngcontent-%COMP%]  {\n      margin-right: 15px;\n    }"]}),ve),ke=r("1jcm"),Ve=((ge=function(){function e(){_classCallCheck(this,e),this.options=new s.o,this.currentOptions=new h.h(0,!1,!1,!1)}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"pValue",value:function(e){this.currentOptions=this.currentOptions.clone(),this.currentOptions.pValue=e,this.options.next(this.currentOptions)}},{key:"bhCorrection",value:function(e){this.currentOptions=this.currentOptions.clone(),this.currentOptions.bhCorrection=e,this.options.next(this.currentOptions)}},{key:"circadian",value:function(e){this.currentOptions=this.currentOptions.clone(),this.currentOptions.circadian=e,this.options.next(this.currentOptions)}},{key:"showPattern",value:function(e){this.currentOptions=this.currentOptions.clone(),this.currentOptions.showPattern=e,this.options.next(this.currentOptions)}}]),e}()).\u0275fac=function(e){return new(e||ge)},ge.\u0275cmp=s.Kb({type:ge,selectors:[["bd2-stat-test-options-widget"]],outputs:{options:"options"},decls:14,vars:1,consts:[[3,"pvalue$"],[2,"margin-top","0.5em","text-align","center"],[3,"change"],["pattern",""],[3,"disabled","change"]],template:function(e,t){if(1&e&&(s.Wb(0,"mat-card"),s.Wb(1,"mat-card-content"),s.Wb(2,"section"),s.Wb(3,"bd2-pvalue-form",0),s.ec("pvalue$",(function(e){return t.pValue(e)})),s.Vb(),s.Vb(),s.Wb(4,"section",1),s.Wb(5,"mat-slide-toggle",2),s.ec("change",(function(e){return t.bhCorrection(e.checked)})),s.Gc(6,"Benjamini Hochberg correction"),s.Vb(),s.Vb(),s.Wb(7,"section",1),s.Wb(8,"mat-slide-toggle",2,3),s.ec("change",(function(e){return t.showPattern(e.checked)})),s.Gc(10,"show pattern"),s.Vb(),s.Gc(11," \xa0 "),s.Wb(12,"mat-slide-toggle",4),s.ec("change",(function(e){return t.circadian(e.checked)})),s.Gc(13,"circadian unit"),s.Vb(),s.Vb(),s.Vb(),s.Vb()),2&e){var r=s.vc(9);s.Cb(12),s.oc("disabled",!r.checked)}},directives:[be.a,be.c,Ce,ke.a],encapsulation:2}),ge);function We(e,t){if(1&e){var r=s.Xb();s.Wb(0,"div",5),s.Wb(1,"button",13),s.ec("click",(function(){return s.xc(r),s.ic(2).delete()})),s.Wb(2,"i",4),s.Gc(3,"delete_forever"),s.Vb(),s.Vb(),s.Wb(4,"button",14),s.ec("click",(function(){return s.xc(r),s.ic(2).export()})),s.Wb(5,"i",4),s.Gc(6,"save_alt"),s.Vb(),s.Vb(),s.Vb()}}function Pe(e,t){if(1&e&&(s.Wb(0,"div",15),s.Rb(1,"br"),s.Gc(2),s.Vb()),2&e){var r=s.ic().ngIf;s.Cb(2),s.Ic("ERROR: ",r.jobStatus.message," ")}}function we(e,t){1&e&&(s.Wb(0,"div"),s.Wb(1,"mat-card"),s.Wb(2,"mat-card-content"),s.Rb(3,"mat-spinner",16),s.Vb(),s.Vb(),s.Vb())}function Ie(e,t){1&e&&(s.Wb(0,"div"),s.Wb(1,"mat-card"),s.Wb(2,"mat-card-content"),s.Wb(3,"div",17),s.Gc(4,"It may take up to 10 minutes to test for rhythmicity"),s.Vb(),s.Vb(),s.Vb(),s.Vb())}function Se(e,t){if(1&e){var r=s.Xb();s.Ub(0),s.Wb(1,"bd2-stat-test-options-widget",18),s.ec("options",(function(e){return s.xc(r),s.ic(3).statTestOptions(e)})),s.Vb(),s.Rb(2,"bd2-rhythmicity-results-mdtable",19),s.Tb()}if(2&e){var n=t.ngIf,i=s.ic(3);s.Cb(2),s.oc("statTestParams",i.statTestParams)("job",n)}}function _e(e,t){if(1&e&&(s.Wb(0,"div"),s.Rb(1,"mat-divider"),s.Ec(2,we,4,0,"div",12),s.jc(3,"async"),s.Ec(4,Ie,5,0,"div",12),s.Ec(5,Se,3,2,"ng-container",12),s.jc(6,"async"),s.Vb()),2&e){var r=s.ic().ngIf,n=s.ic();s.Cb(2),s.oc("ngIf",s.kc(3,3,n.rhythmicityJobDatasource.isReloading$)),s.Cb(2),s.oc("ngIf","SUBMITTED"===r.jobStatus.state),s.Cb(1),s.oc("ngIf",s.kc(6,5,n.rhythmicityJobDatasource.finishedJob$))}}function Te(e,t){if(1&e){var r=s.Xb();s.Wb(0,"div",1),s.Wb(1,"div",2),s.Wb(2,"div",3),s.ec("click",(function(){return s.xc(r),s.ic().toggleExpanded()})),s.Wb(3,"i",4),s.Gc(4,"waves"),s.Vb(),s.Gc(5),s.jc(6,"date"),s.Rb(7,"br"),s.Gc(8),s.Vb(),s.Wb(9,"div",5),s.Gc(10),s.Wb(11,"a",6),s.ec("click",(function(){return s.xc(r),s.ic().refresh()})),s.Wb(12,"i",7),s.Gc(13,"refresh"),s.Vb(),s.Vb(),s.Vb(),s.Vb(),s.Wb(14,"div",8),s.Wb(15,"mat-card"),s.Wb(16,"mat-card-content"),s.Wb(17,"div",9),s.Ec(18,We,7,0,"div",10),s.Gc(19),s.Ec(20,Pe,3,1,"div",11),s.Vb(),s.Vb(),s.Vb(),s.Ec(21,_e,7,7,"div",12),s.Vb(),s.Vb()}if(2&e){var n=t.ngIf,i=s.ic();s.Cb(3),s.Dc("color",i.isExpanded?"green":"red")("font-size",150,"%"),s.Cb(2),s.Jc(" \xa0",i.shortUUID(n.jobId)," (",s.kc(6,13,i.toLocalDateTime(n.jobStatus.submitted)),") "),s.Cb(3),s.Jc(" ",i.friendlyMethod(n.parameters.METHOD),"; \xa0 waveforms: ",n.parameters.PRESET," "),s.Cb(2),s.Ic(" ",n.jobStatus.state," "),s.Cb(8),s.oc("ngIf",i.assay.security.canWrite),s.Cb(1),s.Ic(" ",n.parameters.PARAMS_SUMMARY," "),s.Cb(1),s.oc("ngIf",n.jobStatus.message&&"OK"!=n.jobStatus.message),s.Cb(1),s.oc("ngIf",i.isExpanded)}}var Oe,Ee=((Oe=function(){function e(t,r,n,i){_classCallCheck(this,e),this.rhythmicityService=t,this.rhythmicityJobDatasource=r,this.feedback=n,this.dialogs=i,this.deleted=new s.o,this.isExpanded=!1,this.expandedToogleStream=new u.a(!1)}return _createClass(e,[{key:"ngOnInit",value:function(){this.initSubscriptions()}},{key:"ngOnDestroy",value:function(){this.rhythmicityJobDatasource.close(),this.expandedToogleStream&&this.expandedToogleStream.complete()}},{key:"ngOnChanges",value:function(e){(e.jobId||e.assay)&&this.jobId&&this.assay&&this.rhythmicityJobDatasource.assayJob([this.assay.id,this.jobId])}},{key:"statTestOptions",value:function(e){var t=this,r=Object(l.a)(1).subscribe((function(){t.statTestParams=e,r&&r.unsubscribe()}))}},{key:"export",value:function(){var e=this;this.rhythmicityService.downloadJob(this.assay.id,this.jobId).subscribe((function(t){e.saveJobBlob(t,e.assay.id,e.jobId)}),(function(t){return e.feedback.error(t)}))}},{key:"saveJobBlob",value:function(e,t,r){d.saveAs(e,t+"_job"+this.shortUUID(r)+".rhythmicity.csv")}},{key:"refresh",value:function(){this.rhythmicityJobDatasource.refresh(),this.resultsTable&&this.resultsTable.reload()}},{key:"delete",value:function(){var e=this,t=this.assay,r=this.rhythmicityJobDatasource.currentJob;this.dialogs.confirm("Do you want to delete analysis: "+r.jobId,r.parameters.PARAMS_SUMMARY).subscribe((function(n){n&&e.doDelete(t,r.jobId)}))}},{key:"initSubscriptions",value:function(){var e=this;this.rhythmicityJobDatasource.on(!0),this.rhythmicityJobDatasource.error$.forEach((function(t){return e.feedback.error(t)}))}},{key:"doDelete",value:function(e,t){var r=this;this.rhythmicityService.deleteJob(e,t).subscribe((function(e){r.deleted.next(e),r.feedback.success("Job: "+r.shortUUID(t)+" deleted")}),(function(e){r.feedback.error(e)}))}},{key:"toggleExpanded",value:function(){this.expanded=!this.isExpanded}},{key:"toLocalDateTime",value:function(e){return b.b.deserialize(e).date}},{key:"shortUUID",value:function(e){return Object(ue.c)(e)}},{key:"friendlyMethod",value:function(e){return"BD2JTK"===e?"Classic JTK":"BD2EJTK"===e?"BD2 eJTK":e}},{key:"expanded",set:function(e){this.isExpanded=e,this.expandedToogleStream.next(e)}}]),e}()).\u0275fac=function(e){return new(e||Oe)(s.Qb(y.a),s.Qb(v),s.Qb(W.a),s.Qb(le.a))},Oe.\u0275cmp=s.Kb({type:Oe,selectors:[["bd2-rhythmicity-job-pane"]],viewQuery:function(e,t){var r;1&e&&s.Mc(se,!0),2&e&&s.uc(r=s.fc())&&(t.resultsTable=r.first)},inputs:{jobId:"jobId",assay:"assay",expanded:"expanded"},outputs:{deleted:"deleted"},features:[s.Bb([v]),s.Ab],decls:2,vars:3,consts:[["class","card mb-2",4,"ngIf"],[1,"card","mb-2"],[1,"card-header","clearfix"],["role","button",1,"float-left",3,"click"],[1,"material-icons","bd-icon"],[1,"float-right"],["role","button","aria-label","refresh",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"card-body"],[1,"clearfix"],["class","float-right",4,"ngIf"],["class","text-danger","style","word-wrap: break-word;",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-danger","btn-sm","mr-1",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"text-danger",2,"word-wrap","break-word"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"],[3,"options"],[3,"statTestParams","job"]],template:function(e,t){1&e&&(s.Ec(0,Te,22,15,"div",0),s.jc(1,"async")),2&e&&s.oc("ngIf",s.kc(1,1,t.rhythmicityJobDatasource.allJob$))},directives:[a.m,be.a,be.c,de.a,he.b,Ve,se],pipes:[a.b,a.e],encapsulation:2}),Oe),Ge=r("GVyA");function je(e,t){if(1&e&&(s.Wb(0,"div"),s.Wb(1,"strong"),s.Gc(2),s.Vb(),s.Vb()),2&e){var r=s.ic(2);s.Cb(2),s.Ic("Submitted jobs: ",r.jobs.length,"")}}function Re(e,t){1&e&&(s.Wb(0,"div"),s.Gc(1," No jobs submitted, start a new test. "),s.Vb())}var De=function(){return["new"]};function xe(e,t){1&e&&(s.Wb(0,"a",7),s.Gc(1," New test "),s.Vb()),2&e&&s.oc("routerLink",s.qc(1,De))}function Je(e,t){if(1&e){var r=s.Xb();s.Wb(0,"div"),s.Wb(1,"bd2-rhythmicity-job-pane",8),s.ec("deleted",(function(e){return s.xc(r),s.ic(2).remove(e)}))("finished",(function(e){return s.xc(r),s.ic(2).refreshJob(e)})),s.Vb(),s.Vb()}if(2&e){var n=t.$implicit,i=t.index,a=s.ic(2);s.Cb(1),s.oc("assay",a.assay)("jobId",n)("expanded",a.expandAll||0==i)}}function Me(e,t){if(1&e){var r=s.Xb();s.Wb(0,"div"),s.Wb(1,"h3"),s.Gc(2,"Rhythmicity tests"),s.Vb(),s.Rb(3,"hr"),s.Wb(4,"div",1),s.Wb(5,"div",2),s.Ec(6,je,3,1,"div",0),s.Ec(7,Re,2,0,"div",0),s.Vb(),s.Wb(8,"div",3),s.Ec(9,xe,2,2,"a",4),s.Wb(10,"button",5),s.ec("click",(function(){return s.xc(r),s.ic().refresh()})),s.Gc(11,"Refresh "),s.Vb(),s.Vb(),s.Vb(),s.Rb(12,"hr"),s.Ec(13,Je,2,3,"div",6),s.Rb(14,"hr"),s.Vb()}if(2&e){var n=s.ic();s.Cb(6),s.oc("ngIf",n.jobs&&n.jobs.length>0),s.Cb(1),s.oc("ngIf",!n.jobs||0==n.jobs.length),s.Cb(2),s.oc("ngIf",n.assay.security.canWrite),s.Cb(1),s.oc("disabled",n.blocked),s.Cb(3),s.oc("ngForOf",n.jobsIds)}}var He,Ae=((He=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),(i=t.call(this,e,n)).expandAll=!1,i.blocked=!1,i.titlePart=" Rhythm",i}return _createClass(r,[{key:"updateModel",value:function(e){_get(_getPrototypeOf(r.prototype),"updateModel",this).call(this,e),e&&this.loadJobs(e)}},{key:"loadJobs",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.blocked=!0,this.rhythmicityService.getJobs(e).subscribe((function(n){t.jobs=n,t.refreshJobsInfo(n),t.exportURL=t.rhythmicityService.exportURL(e),r&&t.refreshPanes(),t.blocked=!1}),(function(e){t.blocked=!1,t.feedback.error(e)}))}},{key:"refreshJobsInfo",value:function(e){this.jobsIds=e.map((function(e){return e.jobId}))}},{key:"refresh",value:function(){this.loadJobs(this.assay,!0)}},{key:"refreshPanes",value:function(){this.panes&&this.panes.forEach((function(e){return e.refresh()}))}},{key:"remove",value:function(e){var t=this.jobs.findIndex((function(t){return e.jobId===t.jobId}));t>=0&&(this.jobs.splice(t,1),this.refreshJobsInfo(this.jobs))}},{key:"refreshJob",value:function(e){var t=this.jobs.findIndex((function(t){return e.jobId===t.jobId}));t>=0&&(this.jobs[t]=e,this.refreshJobsInfo(this.jobs))}},{key:"calculateQueuing",value:function(e){var t=this;return e.filter((function(e){return t.isQueueing(e.jobStatus.state)})).length}},{key:"isQueueing",value:function(e){switch(e){case"WAITING":case"PROCESSING":case"SUBMITTED":return!0;default:return!1}}},{key:"checkFinished",value:function(e){var t=this;return!!e.find((function(e){return t.isFinished(e.jobStatus.state)}))}},{key:"isFinished",value:function(e){switch(e){case"SUCCESS":case"FINISHED":case"COMPLETED":return!0;default:return!1}}}]),r}(c)).\u0275fac=function(e){return new(e||He)(s.Qb(y.a),s.Qb(Ge.a))},He.\u0275cmp=s.Kb({type:He,selectors:[["ng-component"]],viewQuery:function(e,t){var r;1&e&&s.Mc(Ee,!0),2&e&&s.uc(r=s.fc())&&(t.panes=r)},features:[s.zb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-body"],["class","btn btn-primary mr-1",3,"routerLink",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","click"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary","mr-1",3,"routerLink"],[3,"assay","jobId","expanded","deleted","finished"]],template:function(e,t){1&e&&s.Ec(0,Me,15,5,"div",0),2&e&&s.oc("ngIf",t.assay)},directives:[a.m,a.l,o.e,Ee],encapsulation:2}),He),$e=r("QBpm"),Ke=r("Kj3r"),Be=r("bngM"),Fe=r("ZMwR"),Ue=r("naqj"),ze=r("Tl2h"),Ne=r("wcxA");function Le(e,t){if(1&e&&(s.Wb(0,"option",29),s.Gc(1),s.Vb()),2&e){var r=t.$implicit;s.oc("value",r.name),s.Cb(1),s.Hc(r.label)}}function qe(e,t){1&e&&(s.Wb(0,"div",30),s.Wb(1,"div",31),s.Gc(2," Rhythmicity tests are generally used for short, sparse timeseries. "),s.Rb(3,"br"),s.Gc(4," The current limit is 5 or 4 days of hourly sampled data for eJTK preset and BD2 preset respectivelly."),s.Rb(5,"br"),s.Gc(6," Generally the raw data are being analysed, but we also enabled a linear detrended option. "),s.Vb(),s.Vb())}function Qe(e,t){if(1&e&&(s.Wb(0,"option",29),s.Gc(1),s.Vb()),2&e){var r=t.$implicit;s.oc("value",r.name),s.Cb(1),s.Hc(r.label)}}function Xe(e,t){1&e&&(s.Wb(0,"div",30),s.Wb(1,"div",31),s.Wb(2,"p"),s.Wb(3,"b"),s.Gc(4,"Classic JTK"),s.Vb(),s.Gc(5," is the implementation of JTK_CYCLE from "),s.Wb(6,"a",32),s.Gc(7,"Michael E. Hughes et al. 2010"),s.Vb(),s.Gc(8," a standard method for detecting rhythmicity in genome-scale datasets. "),s.Rb(9,"br"),s.Gc(10,"The method is fast but it is reliable only when it tests against small set of patterns, we provide patterns of 24h cosines with different phases."),s.Vb(),s.Wb(11,"p"),s.Wb(12,"b"),s.Gc(13,"BD2 eJTK"),s.Vb(),s.Gc(14," is the BioDare2 implementation of Empirical JTK_CYCLE with asymmetry search from "),s.Wb(15,"a",33),s.Gc(16,"Alan L. Hutchison et al. 2015"),s.Vb(),s.Gc(17,". It is similar to the classic JTK method but with p values empirically calculated against set of random noise data. "),s.Rb(18,"br"),s.Gc(19,"This modification permits using larger sets of test patterns and it provides better accuracy. However, this method is much slower so it can only analyze timeseries only up to 5 days of data (though the Classic JTK method was never intended to be used with such a long data)."),s.Vb(),s.Vb(),s.Vb())}function Ye(e,t){if(1&e&&(s.Wb(0,"option",29),s.Gc(1),s.Vb()),2&e){var r=t.$implicit;s.oc("value",r.name),s.Cb(1),s.Hc(r.label)}}function Ze(e,t){1&e&&(s.Wb(0,"div",30),s.Wb(1,"div",31),s.Gc(2," Presets determine set of pattern curves against the comparison test is run."),s.Rb(3,"br"),s.Wb(4,"ul"),s.Wb(5,"li"),s.Gc(6,"Cosine 24h 1/2/4h are set of cosine curves of 24h periods, and phases spread every 1, 2, or 4 hours. To be used mainly with Classic JTK."),s.Vb(),s.Wb(7,"li"),s.Gc(8,"eJTK Classic is recommended for typical omics-like data for which eJTK method was developed. "),s.Rb(9,"br"),s.Gc(10," It works well for short data (48h, 2h- 1h-sampled) when actual period is within range 22-26 hours."),s.Rb(11,"br"),s.Gc(12," The patterns are series of cosine-like waveforms with 24h period, phases by 2hours and range of asymmetries by 2h (see original paper)."),s.Rb(13,"br"),s.Vb(),s.Wb(14,"li"),s.Gc(15,"BD2 Classic can detect non 24 periods and some forms of the spikes."),s.Rb(16,"br"),s.Gc(17," As it compares against much more patterns it has a weaker power."),s.Rb(18,"br"),s.Gc(19," It should be used when there is a good reason to suspect periods outside 22-26h range."),s.Rb(20,"br"),s.Gc(21," The patterns are series of cosine-like waverforms with periods from 18-35hours, for each period there are multiple "),s.Wb(22,"b"),s.Gc(23,"circadian"),s.Vb(),s.Gc(24," phases with step 2h (so each period value generates the same number of patterns but the peaks in absolute units do not coincide) and a range of assymetries by 2h in circadian units (see original paper). The preset contains also additional some spike patterns. "),s.Vb(),s.Vb(),s.Vb(),s.Vb())}var et,tt=function(){return[10,25,50,100,200]},rt=((et=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this,e)).methodOptions=h.d,n.presetOptions=h.b,n.dataHelp=!1,n.presetsHelp=!1,n.methodHelp=!1,n.rhythmicityRequests=new s.o,n.detrendingOptions=[ze.b.NO_DTR,ze.b.LIN_DTR],n.methodForm=n.mainForm.get("method"),n.presetForm=n.mainForm.get("preset"),n}return _createClass(r,[{key:"buildMainForm",value:function(){var e=this;return this.fb.group({displayParams:this.displayParamsForm,periodScale:this.fb.group({periodMin:[18,[fe.A.required]],periodMax:[34,[fe.A.required]]},{validator:function(t){return e.validPeriodScale(t.value)}}),method:[h.f.BD2EJTK.name,[fe.A.required]],preset:[h.a.EJTK_CLASSIC.name,[fe.A.required]]})}},{key:"ngOnInit",value:function(){var e=this;_get(_getPrototypeOf(r.prototype),"ngOnInit",this).call(this),this.methodForm.valueChanges.subscribe((function(t){return e.setPresetOptions(t)}))}},{key:"ngOnDestroy",value:function(){_get(_getPrototypeOf(r.prototype),"ngOnDestroy",this).call(this)}},{key:"setPresetOptions",value:function(e){e===h.f.BD2EJTK.name?(this.presetOptions=h.b,this.presetForm.setValue(h.a.EJTK_CLASSIC.name)):e===h.f.BD2JTK.name?(this.presetOptions=h.c,this.presetForm.setValue(h.a.COS_2H.name)):this.presetOptions=[]}},{key:"defaultDetrending",value:function(){return ze.b.NO_DTR.name}},{key:"validPeriodScale",value:function(e){var t=e.periodMin,r=e.periodMax;return t<10?{validPeriodScale:"Period min must >= 10"}:r<10?{validPeriodScale:"Period max must >= 10"}:r>50?{validPeriodScale:"Period max must < 50"}:t>=r?{validPeriodScale:"Period min must be < max"}:null}},{key:"analyse",value:function(){if(!this.mainForm.invalid){var e=this.map2RhythmicityRequest(this.mainForm.value);e.isValid()&&this.rhythmicityRequests.next(e)}}},{key:"map2RhythmicityRequest",value:function(e){var t=new h.g;return t.detrending=ze.b.get(e.displayParams.detrending),t.method=h.f.get(e.method),t.preset=h.a.get(e.preset),t.periodMax=e.periodScale.periodMax,t.periodMin=e.periodScale.periodMin,t.windowEnd=e.displayParams.timeScale.timeEnd,t.windowStart=e.displayParams.timeScale.timeStart,t}}]),r}(Ne.a)).\u0275fac=function(e){return new(e||et)(s.Qb(fe.d))},et.\u0275cmp=s.Kb({type:et,selectors:[["bd2-rhythmicityjob-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams",rhythmicityRequests:"rhythmicityRequests"},features:[s.zb],decls:61,vars:15,consts:[["role","form",1,"form-horizontal",3,"formGroup"],["formGroupName","displayParams"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-sm-4"],["for","windowStart",1,"col-sm-1"],[1,"col-sm-2"],["formControlName","timeStart","id","windowStart","min","0","required","","size","5","step","any","type","number",1,"form-control"],["for","windowEnd",1,"col-sm-1"],["formControlName","timeEnd","id","windowEnd","min","0","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"form-group","row"],["for","detrending",1,"col-sm-4"],[3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"col-sm-6"],["formControlName","detrending","id","detrending","required","",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["class","col-sm-12",4,"ngIf"],["for","method",1,"col-sm-4"],["formControlName","method","id","method","required","",1,"form-control"],["formControlName","preset","id","preset","required","",1,"form-control"],["formGroupName","periodScale",1,"form-group","row",3,"hidden"],["for","periodMin",1,"col-sm-1"],["formControlName","periodMin","id","periodMin","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],["for","periodMax",1,"col-sm-1"],["formControlName","periodMax","id","periodMax","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],["type","button",1,"btn","btn-primary",3,"disabled","click"],[3,"value"],[1,"col-sm-12"],["role","alert","type","info",1,"alert","alert-info"],["href","https://dx.doi.org/10.1177%2F0748730410379711"],["href"," https://doi.org/10.1371/journal.pcbi.1004094","target","_blank"]],template:function(e,t){1&e&&(s.Wb(0,"form",0),s.Wb(1,"div",1),s.Wb(2,"div",2),s.Wb(3,"label",3),s.Gc(4,"Data window"),s.Vb(),s.Wb(5,"label",4),s.Gc(6,"from:"),s.Vb(),s.Wb(7,"div",5),s.Rb(8,"input",6),s.Vb(),s.Wb(9,"label",7),s.Gc(10,"to:"),s.Vb(),s.Wb(11,"div",5),s.Rb(12,"input",8),s.Vb(),s.Vb(),s.Wb(13,"div",9),s.Wb(14,"label",10),s.Gc(15,"Input Data "),s.Wb(16,"a",11),s.ec("click",(function(){return t.dataHelp=!t.dataHelp})),s.Wb(17,"i",12),s.Gc(18,"help"),s.Vb(),s.Vb(),s.Vb(),s.Wb(19,"div",13),s.Wb(20,"select",14),s.Ec(21,Le,2,2,"option",15),s.Vb(),s.Vb(),s.Vb(),s.Vb(),s.Ec(22,qe,7,0,"div",16),s.Wb(23,"div",9),s.Wb(24,"label",17),s.Gc(25,"Test Method "),s.Wb(26,"a",11),s.ec("click",(function(){return t.methodHelp=!t.methodHelp})),s.Wb(27,"i",12),s.Gc(28,"help"),s.Vb(),s.Vb(),s.Vb(),s.Wb(29,"div",13),s.Wb(30,"select",18),s.Ec(31,Qe,2,2,"option",15),s.Vb(),s.Vb(),s.Vb(),s.Ec(32,Xe,20,0,"div",16),s.Wb(33,"div",9),s.Wb(34,"label",17),s.Gc(35,"Analysis Presets "),s.Wb(36,"a",11),s.ec("click",(function(){return t.presetsHelp=!t.presetsHelp})),s.Wb(37,"i",12),s.Gc(38,"help"),s.Vb(),s.Vb(),s.Vb(),s.Wb(39,"div",13),s.Wb(40,"select",19),s.Ec(41,Ye,2,2,"option",15),s.Vb(),s.Vb(),s.Vb(),s.Ec(42,Ze,25,0,"div",16),s.Wb(43,"div",20),s.Wb(44,"label",3),s.Gc(45,"Expected periods"),s.Vb(),s.Wb(46,"label",21),s.Gc(47,"from:"),s.Vb(),s.Wb(48,"div",5),s.Rb(49,"input",22),s.Vb(),s.Wb(50,"label",23),s.Gc(51,"to:"),s.Vb(),s.Wb(52,"div",5),s.Rb(53,"input",24),s.Vb(),s.Vb(),s.Wb(54,"div",9),s.Rb(55,"label",5),s.Wb(56,"div",25),s.Wb(57,"mat-paginator",26,27),s.ec("page",(function(e){return t.loadDataPage(e)})),s.Vb(),s.Vb(),s.Vb(),s.Wb(59,"button",28),s.ec("click",(function(){return t.analyse()})),s.Gc(60,"Test Rhythmicity "),s.Vb(),s.Vb()),2&e&&(s.oc("formGroup",t.mainForm),s.Cb(21),s.oc("ngForOf",t.detrendingOptions),s.Cb(1),s.oc("ngIf",t.dataHelp),s.Cb(9),s.oc("ngForOf",t.methodOptions),s.Cb(1),s.oc("ngIf",t.methodHelp),s.Cb(9),s.oc("ngForOf",t.presetOptions),s.Cb(1),s.oc("ngIf",t.presetsHelp),s.Cb(1),s.oc("hidden",!0),s.Cb(14),s.oc("length",t.totalTraces)("disabled",t.disabledPagination)("pageSize",t.currentPage.pageSize)("pageIndex",t.currentPage.pageIndex)("pageSizeOptions",s.qc(14,tt)),s.Cb(2),s.oc("disabled",t.disabled||t.mainForm.invalid))},directives:[fe.C,fe.q,fe.h,fe.i,fe.c,fe.u,fe.p,fe.g,fe.y,fe.z,a.l,a.m,g.a,fe.t,fe.B],encapsulation:2}),et),nt=r("nA4b");function it(e,t){if(1&e&&s.Rb(0,"bd2-ts-plots",3),2&e){var r=s.ic(3);s.oc("data",r.timeseries)("tracesPerPlot",r.tracesPerPlot)}}function at(e,t){if(1&e){var r=s.Xb();s.Wb(0,"div"),s.Wb(1,"bd2-rhythmicityjob-params-rform",1),s.ec("displayParams",(function(e){return s.xc(r),s.ic(2).emitDisplayParams(e)}))("rhythmicityRequests",(function(e){return s.xc(r),s.ic(2).doAnalysis(e)})),s.Vb(),s.Rb(2,"hr"),s.Ec(3,it,1,2,"bd2-ts-plots",2),s.Vb()}if(2&e){var n=s.ic(2);s.Cb(1),s.oc("disabled",n.blocked)("totalTraces",n.totalTraces)("currentPage",n.currentPage),s.Cb(2),s.oc("ngIf",n.timeseries)}}function ot(e,t){if(1&e&&(s.Wb(0,"div"),s.Wb(1,"h3"),s.Gc(2,"Start rhythmicity test"),s.Vb(),s.Rb(3,"hr"),s.Ec(4,at,4,4,"div",0),s.Vb()),2&e){var r=s.ic();s.Cb(4),s.oc("ngIf",!r.disabled)}}var ct,st,ut,lt=[{path:"",children:[{path:"new",component:(ct=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a,o){var c;return _classCallCheck(this,r),(c=t.call(this,a,o)).fetcher=e,c.analytics=n,c.userService=i,c.disabled=!1,c.blocked=!1,c.tracesPerPlot=5,c.totalTraces=0,c.currentPage=Be.a.firstPage(),c.titlePart=" New Test",c}return _createClass(r,[{key:"ngOnInit",value:function(){var e=this;_get(_getPrototypeOf(r.prototype),"ngOnInit",this).call(this),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(Ke.a)(1e3)).subscribe((function(t){var r=t.data;e.tracesPerPlot=Math.max(5,r.length/20),e.timeseries=r,e.totalTraces=t.totalTraces,e.currentPage=t.currentPage}),(function(t){console.log("Error in TS subscription: "+t),e.feedback.error(t)}))}},{key:"ngOnDestroy",value:function(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),_get(_getPrototypeOf(r.prototype),"ngOnDestroy",this).call(this)}},{key:"emitDisplayParams",value:function(e){this.fetcher.changeDisplayParams(e)}},{key:"doAnalysis",value:function(e){var t=this;e.isValid()&&(this.blocked=!0,this.rhythmicityService.newTest(this.assay,e).subscribe((function(r){t.feedback.success("Rhythmicity test submitted"),t.analytics.rhythmicityNew(e.method.name,t.assay.id,t.userService.currentUser.login),t.refreshModel(),t.goToRhythmicityHome()}),(function(e){t.blocked=!1,t.feedback.error(e)})))}},{key:"updateModel",value:function(e){this.fetcher.experiment(e),_get(_getPrototypeOf(r.prototype),"updateModel",this).call(this,e)}}]),r}(c),ct.\u0275fac=function(e){return new(e||ct)(s.Qb($e.a),s.Qb(Fe.a),s.Qb(Ue.a),s.Qb(y.a),s.Qb(Ge.a))},ct.\u0275cmp=s.Kb({type:ct,selectors:[["ng-component"]],features:[s.Bb([$e.a]),s.zb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams","rhythmicityRequests"],[3,"data","tracesPerPlot",4,"ngIf"],[3,"data","tracesPerPlot"]],template:function(e,t){1&e&&s.Ec(0,ot,5,1,"div",0),2&e&&s.oc("ngIf",t.assay)},directives:[a.m,rt,nt.a],encapsulation:2}),ct)},{path:"",component:Ae,pathMatch:"full"}]}],bt=((st=function e(){_classCallCheck(this,e)}).\u0275mod=s.Ob({type:st}),st.\u0275inj=s.Nb({factory:function(e){return new(e||st)},imports:[[o.f.forChild(lt)],o.f]}),st),dt=r("wMBR"),ht=r("a6j2"),ft=r("ZTEM"),pt=((ut=function e(){_classCallCheck(this,e)}).\u0275mod=s.Ob({type:ut}),ut.\u0275inj=s.Nb({factory:function(e){return new(e||ut)},imports:[[a.c,fe.j,fe.x,dt.a,ht.a,ft.a,bt]]}),ut)}}]);