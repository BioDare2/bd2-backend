"use strict";(self.webpackChunkbiodare2_ui=self.webpackChunkbiodare2_ui||[]).push([[162],{5162:(eo,F,r)=>{r.r(F),r.d(F,{TsImportModule:()=>Vt});var u=r(6814),d=r(6223),J=r(1896),c=r(8685),G=r(4621),e=r(5879),R=r(8351),K=r(6444),j=r(7937),_=r(7452),x=r(6138),y=r(5619),z=r(8645),X=r(2572),B=r(2181),W=r(3997),$=r(4664),V=r(7715);const te=r(1631).z;var L=r(7398),v=r(4900);class f{constructor(n=new v.kl,t=new v.kl){this.rowPage=n,this.colPage=t}static firstPage(){const n=new f;return n.rowPage.pageIndex=0,n.rowPage.pageSize=50,n.colPage.pageIndex=0,n.colPage.pageSize=50,n}static pageEquals(n,t){return n.pageIndex===t.pageIndex&&n.pageSize===t.pageSize}equals(n){return!!n&&f.pageEquals(this.rowPage,n.rowPage)&&f.pageEquals(this.colPage,n.colPage)}}let oe=(()=>{class i{constructor(t){this.BD2REST=t}uploadFile(t){const o=new FormData;return o.append("file",t,t.name),this.BD2REST.fileUpload(o).then(a=>a.id)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(R.q))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),A=(()=>{class i{constructor(t,o){this.uploadService=t,this.BD2REST=o}uploadFile(t,o){return(0,V.D)(this.uploadService.uploadFile(t)).pipe(te(a=>this.verifyFormat(o,a).pipe((0,L.U)(s=>a))))}verifyFormat(t,o){return this.BD2REST.fileViewVerifyFormat(t,o)}getTableSlice(t,o,a){return this.BD2REST.fileViewTableSlice(t,o,a)}previewLabels(t,o,a,s){const l=new f;return s?(l.rowPage.pageSize=500,l.rowPage.pageIndex=0,l.colPage.pageSize=1,l.colPage.pageIndex=a.colIx):(l.rowPage.pageSize=1,l.rowPage.pageIndex=a.rowIx,l.colPage.pageSize=500,l.colPage.pageIndex=0),this.getTableSlice(t,o,l).pipe((0,L.U)(p=>{const h=[];return p.data.forEach(T=>T.forEach(w=>h.push(""+w))),h}))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(oe),e.LFG(R.q))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),b=(()=>{class i{constructor(t){this.tsFileService=t,this.tableSlice$=new y.X(void 0),this.slice$=new y.X(void 0),this.fileIdFormat$=new y.X(void 0),this.error$=new z.x,this.dataSlice$=this.tableSlice$.asObservable().pipe((0,B.h)(o=>null!=o&&void 0!==o)),this.initDataStream()}close(){this.slice$.complete(),this.fileIdFormat$.complete(),this.tableSlice$.complete(),this.error$.complete()}slice(t){t&&this.slice$.next(t)}fileIdFormat(t){t&&t[0]&&t[1]&&this.fileIdFormat$.next(t)}sameParams([[t,o],a],[[s,l],p]){return t==s&&o==l&&a.equals(p)}initDataStream(){(0,X.a)([this.fileIdFormat$,this.slice$]).pipe((0,B.h)(([o,a])=>o&&!!a),(0,W.x)(this.sameParams)).pipe((0,$.w)(([o,a])=>this.tsFileService.getTableSlice(o[0],o[1],a))).subscribe(o=>this.tableSlice$.next(o),o=>this.error$.next(o))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(A))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var D=r(1574),O=r(8285),ie=r(2468),N=r(1943),Q=r(1075),ae=r(212),C=r(6005),E=r(6611),Z=r(6649);function ne(i,n){if(1&i&&(e.TgZ(0,"mat-option",9),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t.label)}}function se(i,n){1&i&&(e.TgZ(0,"div",10),e._uU(1," An Excel file in which one column contains time values while other columns contain measurements taken at the corresponding times. "),e.TgZ(2,"ul")(3,"li"),e._uU(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes from start, seconds from start, or as image nr (1-based) which will be converted to time using interval between images. "),e.qZA(),e.TgZ(5,"li"),e._uU(6," Not all columns have to be imported. "),e.qZA(),e.TgZ(7,"li"),e._uU(8," First few rows can contain arbitrary text. "),e.qZA(),e.TgZ(9,"li"),e._uU(10," Values from one row can be used as data labels. "),e.qZA()()())}function le(i,n){1&i&&(e.TgZ(0,"div",10),e._uU(1," A coma or tab separeted file in which one column or row contains time values while other columns or rows contain measurements taken at the corresponding times. "),e.TgZ(2,"ul")(3,"li"),e._uU(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes or seconds from start, or as image numbers "),e.qZA(),e.TgZ(5,"li"),e._uU(6," Not all columns/rows have to be imported. "),e.qZA(),e.TgZ(7,"li"),e._uU(8," First few rows/columns can contain arbitrary text. "),e.qZA(),e.TgZ(9,"li"),e._uU(10," Values from one row/column can be used as data labels. "),e.qZA()()())}function re(i,n){1&i&&(e.TgZ(0,"div",10),e._uU(1," Topcount data can be uploaded in two forms: "),e.TgZ(2,"ul")(3,"li"),e._uU(4,"Individual file which contains concatenated topcount data blocks in one file"),e.qZA(),e.TgZ(5,"li"),e._uU(6,"Zip file which contains packed files from individual topcount reads"),e.qZA()(),e._uU(7,' Check the Dosc section for details about suported data layouts inside tomcats file, we can currently read ASCI content with "plate map" or "column" layouts. '),e.qZA())}function ce(i,n){if(1&i&&(e.TgZ(0,"div",11),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij(" ",t.formatWarning," ")}}let me=(()=>{class i{constructor(){this.blocked=!1,this.uploadFiles=new e.vpe,this.importFormatOptions=c.Kw,this.importFormat=c.kk.EXCEL_TABLE}ngOnInit(){}upload(t){this.uploadFiles.next({files:t,importFormat:this.importFormat})}formatChanged(t){this.lastFiles&&this.checkFormat(this.lastFiles)}checkFormat(t){this.lastFiles=t,this.formatWarning=void 0,t.forEach(o=>{if(this.importFormat===c.kk.TOPCOUNT){const a=this.isTopCount(o);a&&(this.formatWarning="The selected file does not seem to be a topcount file/archive but rather: "+a+". If you sure it is a valid topcount file/archive you can continue upload.")}else if(this.importFormat===c.kk.EXCEL_TABLE){const a=this.isExcel(o);a&&(this.formatWarning="The selected file does not seem to be an excel file but rather: "+a+". If you sure it is a valid excel file you can continue upload.")}else if(this.importFormat===c.kk.TAB_SEP){const a=this.isTab(o);a&&(this.formatWarning="The selected file does not seem to be a tab-separated file but rather: "+a+". If you sure it is a valid tsv file you can continue upload.")}else if(this.importFormat===c.kk.COMA_SEP){const a=this.isComa(o);a&&(this.formatWarning="The selected file does not seem to be a coma-separated file but rather: "+a+". If you sure it is a valid csv file you can continue upload.")}})}isTopCount(t){let a=t.type;return t.name?(a||(a="Unknown"),t.name.endsWith(".csv")?"CSV":t.name.endsWith(".xls")||t.name.endsWith(".xlsx")?"Excel":t.name.endsWith(".tsv")?"tab separated":null):"Unknown"}isExcel(t){const a=t.type;return a&&t.name?t.name.endsWith(".csv")?"CSV":t.name.endsWith(".txt")?"text":t.name.endsWith(".tsv")?"tab separated":a.indexOf("excel")>=0||a.indexOf("sheet")>=0?null:a:"Unknown"}isTab(t){let a=t.type;return t.name?(a||(a="Unknown"),t.name.endsWith(".csv")?"CSV":t.name.endsWith(".xls")||t.name.endsWith(".xlsx")?"Excel":t.name.endsWith(".txt")?"Text":t.name.endsWith(".tsv")?null:"Unrecognized"):"Unknown"}isComa(t){let a=t.type;return t.name?(a||(a="Unknown"),t.name.endsWith(".tsv")?"tab separated":t.name.endsWith(".xls")||t.name.endsWith(".xlsx")?"Excel":t.name.endsWith(".txt")?"Text":t.name.endsWith(".csv")?null:"Unrecognized"):"Unknown"}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-upload-data-file-step"]],outputs:{uploadFiles:"uploadFiles"},decls:19,vars:9,consts:[[1,"mat-elevation-z4"],[1,""],[1,"form-group"],["required","",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["dismissible","true","style","font-size: smaller;","type","info","class","alert alert-info","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"autoReset","blocked","multiple","selectedFiles","uploadFiles"],["uploadWidget",""],[3,"value"],["dismissible","true","type","info","role","alert",1,"alert","alert-info",2,"font-size","smaller"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(t,o){1&t&&(e.TgZ(0,"div")(1,"mat-card",0)(2,"mat-card-title"),e._uU(3,"Time series file"),e.qZA(),e.TgZ(4,"mat-card-content")(5,"form",1)(6,"div",2)(7,"mat-form-field")(8,"mat-label"),e._uU(9,"File Format"),e.qZA(),e.TgZ(10,"mat-select",3),e.NdJ("valueChange",function(s){return o.importFormat=s})("selectionChange",function(s){return o.formatChanged(s)}),e.YNc(11,ne,2,2,"mat-option",4),e.qZA()()(),e.YNc(12,se,11,0,"div",5),e.YNc(13,le,11,0,"div",5),e.YNc(14,re,8,0,"div",5),e.YNc(15,ce,2,1,"div",6),e.TgZ(16,"div",2)(17,"bd2-file-upload-widget",7,8),e.NdJ("selectedFiles",function(s){return o.checkFormat(s)})("uploadFiles",function(s){return o.upload(s)}),e.qZA()()()()()()),2&t&&(e.xp6(10),e.Q6J("value",o.importFormat),e.xp6(1),e.Q6J("ngForOf",o.importFormatOptions),e.xp6(1),e.Q6J("ngIf","EXCEL_TABLE"==o.importFormat.name),e.xp6(1),e.Q6J("ngIf","TAB_SEP"==o.importFormat.name||"COMA_SEP"==o.importFormat.name),e.xp6(1),e.Q6J("ngIf","TOPCOUNT"==o.importFormat.name),e.xp6(1),e.Q6J("ngIf",o.formatWarning),e.xp6(2),e.Q6J("autoReset",!1)("blocked",o.blocked||!o.importFormat)("multiple",!1))},dependencies:[u.sg,u.O5,d._Y,d.JL,d.F,ae.F,C.KE,C.hX,E.gD,Z.ey,_.a8,_.dn,_.n5],encapsulation:2}),i})();function pe(i,n){if(1&i&&(e.TgZ(0,"span")(1,"label"),e._uU(2,"Images every"),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.importDetails.imgInterval,"h ")}}function de(i,n){if(1&i&&(e.TgZ(0,"span")(1,"label"),e._uU(2,"Time offset"),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.importDetails.timeOffset,"h ")}}function ue(i,n){if(1&i&&(e.TgZ(0,"p")(1,"label"),e._uU(2,"First time point:"),e.qZA(),e.TgZ(3,"strong"),e._uU(4),e.qZA(),e.YNc(5,pe,4,1,"span",1),e.YNc(6,de,4,1,"span",1),e.qZA()),2&i){const t=e.oxw();e.xp6(4),e.lnq("",t.firstTimeCell.value," ",null==t.importDetails.timeType?null:t.importDetails.timeType.unit," [",t.firstTimeCell.colName+":"+t.firstTimeCell.rowName,"]"),e.xp6(1),e.Q6J("ngIf","IMG_NUMBER"===(null==t.importDetails.timeType?null:t.importDetails.timeType.name)),e.xp6(1),e.Q6J("ngIf",0!=t.importDetails.timeOffset)}}function _e(i,n){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.TgZ(2,"strong"),e._uU(3),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.hij(" Labels in ",t.importDetails.inLabelNeg," "),e.xp6(2),e.hij("",t.importDetails.inRows?t.labelsSelection.colName:t.labelsSelection.rowName,";")}}function he(i,n){if(1&i&&(e.TgZ(0,"p")(1,"label"),e._uU(2,"Selected Labels:"),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw();e.xp6(3),e.hij(" ",t.importDetails.summarizeLabels()," ")}}function fe(i,n){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.TgZ(2,"strong"),e._uU(3),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.hij(" Data starts in ",t.importDetails.inLabel," "),e.xp6(2),e.hij("",t.importDetails.inRows?t.dataStart.rowName:t.dataStart.colName,";")}}function ge(i,n){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij(" Background noise as: ",t.importDetails.backgroundsLabels.join(", ")," ")}}let be=(()=>{class i{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(){this.showTime=!1,this.showLabelling=!1,this.showDataStart=!1}ngOnInit(){}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-import-details-summary"]],inputs:{importDetails:"importDetails",showTime:"showTime",showLabelling:"showLabelling",showDataStart:"showDataStart"},decls:13,vars:8,consts:[[1,"mat-elevation-z4"],[4,"ngIf"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card",0)(1,"p"),e._uU(2),e.TgZ(3,"strong"),e._uU(4),e.qZA()(),e.TgZ(5,"p")(6,"label"),e._uU(7),e.qZA()(),e.YNc(8,ue,7,5,"p",1),e.YNc(9,_e,4,2,"p",1),e.YNc(10,he,4,1,"p",1),e.YNc(11,fe,4,2,"p",1),e.YNc(12,ge,2,1,"p",1),e.qZA()),2&t&&(e.xp6(2),e.hij("",null==o.importDetails||null==o.importDetails.importFormat?null:o.importDetails.importFormat.label,": "),e.xp6(2),e.Oqu(null==o.importDetails?null:o.importDetails.fileName),e.xp6(3),e.hij("Time series in ",(null==o.importDetails?null:o.importDetails.inLabel)+"s",""),e.xp6(1),e.Q6J("ngIf",o.showTime&&o.firstTimeCell),e.xp6(1),e.Q6J("ngIf",o.showLabelling&&o.importDetails.importLabels&&o.labelsSelection),e.xp6(1),e.Q6J("ngIf",o.showLabelling&&!o.importDetails.importLabels),e.xp6(1),e.Q6J("ngIf",o.showDataStart&&o.importDetails.importLabels&&o.dataStart),e.xp6(1),e.Q6J("ngIf",o.showLabelling&&o.importDetails.containsBackgrounds&&o.importDetails.backgroundsLabels))},dependencies:[u.O5,_.a8],encapsulation:2}),i})();class U{constructor(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}reset(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}setRowBackground(n,t){this.rowsBackgrounds[n]=t}rowBackground(n){return this.getOrEmptyString(this.rowsBackgrounds,n)}colBackground(n){return this.getOrEmptyString(this.colsBackgrounds,n)}setColBackground(n,t){this.colsBackgrounds[n]=t}cellBackground(n,t){return this.getOrEmptyString(this.getOrDefault(this.cellBackgrounds,t,[]),n)||this.colBackground(n)}setCellBackground(n,t,o){let a=this.cellBackgrounds[t];void 0===a&&(a=[],this.cellBackgrounds[t]=a),a[n]=o}getOrEmptyString(n,t){return this.getOrDefault(n,t,"")}getOrDefault(n,t,o){return t>=n.length||void 0===n[t]?o:n[t]}}let g=(()=>{class i{rowBackground(t){return i.MAIN_ROW_BACKGROUND}cellBackground(t){return i.MAIN_CELL_BACKGROUND}columnBackground(t){return i.MAIN_COL_BACKGROUND}}return i.MAIN_ROW_BACKGROUND="#dda0dd",i.MAIN_COL_BACKGROUND="#87cefa",i.MAIN_CELL_BACKGROUND="#ba55d3",i.TIME_BACKGROUND="#dda0dd",i.LABELS_BACKGROUND="#87cefa",i.FIRST_TIME_BACKGROUND="#ba55d3",i.FIST_DATA_BACKGROUND="lightgreen",i})();class Ce{constructor(n,t){this.tableStyler=n,this.colorCycler=t,this.selectedRows=[],this.selectedCols=[],this.tableStyler=n||new U,this.colorCycler=t||new g}toggleRow(n,t=!1,o,a){const s=this.selectedRows.splice(0,this.selectedRows.length);this.selectedRows.push(n),this.uncolorRows(s),this.colorRows(this.selectedRows,o),t&&(this.uncolorCells(s),this.colorCells(this.selectedRows,a))}toggleRowSelection(n,t,o=!1,a,s){const l=this.selectedRows[n]?[this.selectedRows[n]]:[];this.selectedRows[n]=t,this.uncolorRows(l),this.colorRows([this.selectedRows[n]],a),o&&(this.uncolorCells(l),this.colorCells([this.selectedRows[n]],s))}selectRow(n,t){const o=new c.Xc(-1,-1,void 0,n,n,void 0,void 0),a=this.selectedRows.findIndex(s=>s.rowNumber===n);a<0?this.selectedRows.push(o):this.selectedRows[a]=o,this.colorRows([o],t)}deselectRow(n){const t=this.selectedRows.findIndex(a=>a.rowNumber===n);t>=0&&(this.selectedRows[t]=void 0);const o=new c.Xc(-1,-1,void 0,n,n,void 0,void 0);this.uncolorRows([o])}toggleCol(n,t=!1,o,a){const s=this.selectedCols.splice(0,this.selectedCols.length);this.selectedCols.push(n),this.uncolorCols(s),this.colorCols(this.selectedCols,o),t&&(this.uncolorCells(s),this.colorCells(this.selectedCols,a))}toggleColSelection(n,t,o=!1,a,s){const l=this.selectedCols[n]?[this.selectedCols[n]]:[];this.selectedCols[n]=t,this.uncolorCols(l),this.colorCols([this.selectedCols[n]],a),o&&(this.uncolorCells(l),this.colorCells([this.selectedCols[n]],s))}selectCol(n,t){const o=new c.Xc(n,n,void 0,-1,-1,void 0,void 0),a=this.selectedCols.findIndex(s=>s.colNumber===n);a<0?this.selectedCols.push(o):this.selectedCols[a]=o,this.colorCols([o],t)}deselectCol(n){const t=this.selectedCols.findIndex(a=>a.colNumber===n);t>=0&&(this.selectedCols[t]=void 0);const o=new c.Xc(n,n,void 0,-1,-1,void 0,void 0);this.uncolorCols([o])}reset(){this.selectedRows=[],this.selectedCols=[],this.tableStyler.reset()}colorRows(n,t){n.forEach((o,a)=>{this.tableStyler.setRowBackground(o.rowNumber,t||this.colorCycler.rowBackground(a))})}colorCols(n,t){n.forEach((o,a)=>{this.tableStyler.setColBackground(o.colNumber,t||this.colorCycler.columnBackground(a))})}colorCells(n,t){n.forEach((o,a)=>{this.tableStyler.setCellBackground(o.colNumber,o.rowNumber,t||this.colorCycler.cellBackground(a))})}uncolorRows(n){n.forEach(t=>{this.tableStyler.setRowBackground(t.rowNumber,void 0)})}uncolorCols(n){n.forEach(t=>{this.tableStyler.setColBackground(t.colNumber,void 0)})}uncolorCells(n){n.forEach(t=>{this.tableStyler.setCellBackground(t.colNumber,t.rowNumber,void 0)})}}let Se=(()=>{class i{constructor(){this.index=0,this.labelsIndexes=new Map}toColor(t){if(!t)return;this.labelsIndexes.has(t)||this.labelsIndexes.set(t,this.index++);const o=this.labelsIndexes.get(t)%i.colors.length;return i.colors[o]}setColor(t){}}return i.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"],i})(),k=(()=>{class i{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(t,o){this.dataService=t,this.feedback=o,this.tableSelector=new Ce,this.lastColumnSeen=0,this.lastRowSeen=0,this.firstPageSlice=f.firstPage(),this.currentPageSlice=f.firstPage()}ngOnInit(){this.dataService.error$.forEach(t=>this.feedback.error(t)),this.dataSubscription=this.dataService.dataSlice$.subscribe(t=>this.setDataSlice(t),t=>this.feedback.error(t))}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe()}colNumber(t){return t<0?-1:this.dataSlice.columnsNumbers[t]}rowNumber(t){return t<0?-1:this.dataSlice.rowsNumbers[t]}setDataSlice(t){this.dataSlice=t,this.lastColumnSeen=Math.max(this.lastColumnSeen,t.columnsNumbers[t.columnsNumbers.length-1]),this.lastRowSeen=Math.max(this.lastRowSeen,t.rowsNumbers[t.rowsNumbers.length-1]),this.currentPageSlice=new f(t.rowPage,t.colPage),this.applySelection()}loadData(){this.importDetails&&(this.lastColumnSeen=0,this.lastRowSeen=0,this.dataService.fileIdFormat([this.importDetails.fileId,this.importDetails.importFormat.name]),this.dataService.slice(this.firstPageSlice)),this.dataSlice&&this.applySelection()}applySelection(){this.tableSelector.reset(),this.markSelections(),this.applyDefaultSelections()}applyDefaultSelections(){}markSelections(){}selectFirstTime(t){this.importDetails.firstTimeCell=t,this.markFirstTime()}markFirstTime(){const t=this.firstTimeCell;t&&(this.importDetails.inRows?this.tableSelector.toggleRow(t,!0,g.TIME_BACKGROUND,g.FIRST_TIME_BACKGROUND):this.tableSelector.toggleCol(t,!0,g.TIME_BACKGROUND,g.FIRST_TIME_BACKGROUND))}selectLabels(t){this.importDetails.labelsSelection=t,this.markLabels()}markLabels(){const t=this.labelsSelection;t&&(this.importDetails.inRows?this.tableSelector.toggleCol(t,!1,g.LABELS_BACKGROUND):this.tableSelector.toggleRow(t,!1,g.LABELS_BACKGROUND))}selectDataStart(t){t?this.importDetails.inRows?(!this.firstTimeCell||this.firstTimeCell.rowIx!==t.rowIx)&&(this.importDetails.dataStart=t):(!this.firstTimeCell||this.firstTimeCell.colIx!==t.colIx)&&(this.importDetails.dataStart=t):this.importDetails.dataStart=void 0,this.markDataStart()}markDataStart(){const t=this.dataStart;t&&(this.importDetails.inRows?this.tableSelector.toggleRowSelection(1,t,!1,g.FIST_DATA_BACKGROUND):this.tableSelector.toggleColSelection(1,t,!1,g.FIST_DATA_BACKGROUND))}reselect(t){if(!this.dataSlice||!t)return;const o=this.dataSlice,a=t.colIx,s=t.rowIx;if(a>=o.columnsNumbers.length||s>=o.rowsNumbers.length)return;const h=new c.Xc(a,o.columnsNumbers[a],o.columnsNames[a],s,o.rowsNumbers[s],o.rowsNames[s],(s>=0?o.data[s]:[])[a]);return h.fake=t.fake,h}hasMoreTimes(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns:this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows)}hasMoreLabels(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows:this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b),e.Y36(D.T))},i.\u0275dir=e.lG2({type:i}),i})();var q=r(9548),m=r(2396);const Te=["table"];function we(i,n){1&i&&e._UZ(0,"th",10)}function De(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",11),e.NdJ("click",function(){const s=e.CHM(t).index,l=e.oxw(2);return e.KtG(l.selectCell(-1,s))}),e.TgZ(1,"label"),e._uU(2),e.qZA()()}if(2&i){const t=n.index,o=e.oxw(2);e.xp6(2),e.Oqu(o.rowsNames[t])}}function xe(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"th",15),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().index,s=e.oxw(2);return e.KtG(s.selectCell(a,-1))}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw(),o=t.index,a=t.$implicit,s=e.oxw(2);e.Udp("background-color",s.colBackground(o)),e.xp6(1),e.hij(" ",a," ")}}function ve(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",16),e.NdJ("click",function(){const s=e.CHM(t).index,l=e.oxw().index,p=e.oxw(2);return e.KtG(p.selectCell(l,s))}),e._uU(1),e.qZA()}if(2&i){const t=n.$implicit,o=n.index,a=e.oxw().index,s=e.oxw(2);e.Udp("background-color",s.cellBackground(a,o)),e.Q6J("matRippleCentered",!0),e.xp6(1),e.hij(" ",t[a]," ")}}function Ne(i,n){1&i&&(e.ynx(0,12),e.YNc(1,xe,2,3,"th",13),e.YNc(2,ve,2,4,"td",14),e.BQk()),2&i&&e.Q6J("matColumnDef",n.$implicit)}function Ze(i,n){1&i&&e._UZ(0,"tr",17)}function ke(i,n){if(1&i&&e._UZ(0,"tr",18),2&i){const t=n.index,o=e.oxw(2);e.Udp("background-color",o.rowBackground(t))}}function Ie(i,n){if(1&i&&(e.TgZ(0,"div",1)(1,"table",2,3),e.ynx(3,4),e.YNc(4,we,1,0,"th",5),e.YNc(5,De,3,1,"td",6),e.BQk(),e.YNc(6,Ne,3,1,"ng-container",7),e.YNc(7,Ze,1,0,"tr",8),e.YNc(8,ke,1,2,"tr",9),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("dataSource",t.data),e.xp6(5),e.Q6J("ngForOf",t.columnsNames),e.xp6(1),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns)}}let M=(()=>{class i{set dataSlice(t){t&&(this._dataSlice=t,this.columnsNames=t.columnsNames,this.rowsNames=t.rowsNames,this.displayedColumns=["rowNr"].concat(this.columnsNames),this.data=t.data,this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.styler=new U,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.selected=new e.vpe}colNumber(t){return t<0?-1:this._dataSlice.columnsNumbers[t]}rowNumber(t){return t<0?-1:this._dataSlice.rowsNumbers[t]}colBackground(t){return this.styler.colBackground(this.colNumber(t))}rowBackground(t){return this.styler.rowBackground(this.rowNumber(t))}cellBackground(t,o){return this.styler.cellBackground(this.colNumber(t),this.rowNumber(o))}ngOnInit(){}selectCell(t,o){if(t<0&&!this.selectableRowHeader||o<0&&!this.selectableColHeader)return;const w=new c.Xc(t,this._dataSlice.columnsNumbers[t],this._dataSlice.columnsNames[t],o,this._dataSlice.rowsNumbers[o],this._dataSlice.rowsNames[o],(o>=0?this.data[o]:[])[t]);this.selected.next(w)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-data-sheet-mdtable"]],viewQuery:function(t,o){if(1&t&&e.Gf(Te,5),2&t){let a;e.iGM(a=e.CRH())&&(o.matTable=a.first)}},inputs:{dataSlice:"dataSlice",styler:"styler",selectableColHeader:"selectableColHeader",selectableRowHeader:"selectableRowHeader"},outputs:{selected:"selected"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color","click",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"matRippleCentered","background-color","click",4,"matCellDef"],["mat-header-cell","",3,"click"],["mat-cell","","matRipple","",3,"matRippleCentered","click"],["mat-header-row",""],["mat-row",""]],template:function(t,o){1&t&&e.YNc(0,Ie,9,5,"div",0),2&t&&e.Q6J("ngIf",o.dataSlice)},dependencies:[u.sg,u.O5,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.ge,m.ev,m.XQ,m.Gk,Z.wG],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:300px;overflow:auto}.mat-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}"]}),i})();function Re(i,n){if(1&i&&(e.TgZ(0,"mat-option",9),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t.label)}}function ye(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"p")(1,"mat-form-field")(2,"input",10),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw(3);return e.KtG(s.importDetails.imgInterval=a)}),e.qZA()()()}if(2&i){const t=e.oxw(3);e.xp6(2),e.Q6J("ngModel",t.importDetails.imgInterval)}}function Le(i,n){if(1&i&&(e.TgZ(0,"div",11),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.hij(" The first time point value ",t.firstTimeCell.value," does not look like a number; ")}}function Ae(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"p"),e._uU(2),e.TgZ(3,"strong"),e._uU(4),e.qZA(),e._uU(5,"\xa0 First time point: "),e.TgZ(6,"strong"),e._uU(7),e.qZA(),e._uU(8),e.qZA(),e.TgZ(9,"p")(10,"mat-form-field")(11,"mat-label"),e._uU(12,"Time unit"),e.qZA(),e.TgZ(13,"mat-select",5),e.NdJ("valueChange",function(a){e.CHM(t);const s=e.oxw(2);return e.KtG(s.importDetails.timeType=a)}),e.YNc(14,Re,2,2,"mat-option",6),e.qZA()()(),e.TgZ(15,"p")(16,"mat-form-field")(17,"input",7),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw(2);return e.KtG(s.importDetails.timeOffset=a)}),e.qZA()()(),e.YNc(18,ye,3,1,"p",2),e.YNc(19,Le,2,1,"div",8),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(2),e.hij("Times in ",t.importDetails.inLabel," "),e.xp6(2),e.hij("",t.importDetails.inRows?t.firstTimeCell.rowName:t.firstTimeCell.colName,";"),e.xp6(3),e.AsE("",t.firstTimeCell.value," ",null==t.importDetails.timeType?null:t.importDetails.timeType.unit,""),e.xp6(1),e.hij(" [",t.firstTimeCell.colName+":"+t.firstTimeCell.rowName,"] "),e.xp6(5),e.Q6J("value",t.importDetails.timeType),e.xp6(1),e.Q6J("ngForOf",t.timeTypeOptions),e.xp6(3),e.Q6J("ngModel",t.importDetails.timeOffset),e.xp6(1),e.Q6J("ngIf","IMG_NUMBER"==(null==t.importDetails.timeType?null:t.importDetails.timeType.name)),e.xp6(1),e.Q6J("ngIf",t.firstTimeNotNumber())}}function Ue(i,n){if(1&i&&(e.TgZ(0,"div",12),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" Even if only the top part of the data table is presented all times from the selected ",t.importDetails.inLabel," will be imported ")}}function Me(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"mat-card",1)(1,"mat-card-content"),e.YNc(2,Ae,20,10,"div",2),e.TgZ(3,"div")(4,"div"),e._uU(5),e.qZA()(),e.TgZ(6,"bd2-data-sheet-mdtable",3),e.NdJ("selected",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.selectFirstTime(a))}),e.qZA(),e.YNc(7,Ue,2,1,"div",4),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.firstTimeCell),e.xp6(2),e.Tol(t.firstTimeCell?"alert alert-info":"alert alert-danger"),e.xp6(1),e.hij(" Click on the first timepoint in the time ",t.importDetails.inLabel," and then select a time unit. "),e.xp6(1),e.Q6J("dataSlice",t.dataSlice)("styler",t.tableSelector.tableStyler),e.xp6(1),e.Q6J("ngIf",t.hasMoreTimes())}}let Fe=(()=>{class i extends k{constructor(t,o){super(t,o),this.timeTypeOptions=[x.ET.TIME_IN_HOURS,x.ET.TIME_IN_MINUTES,x.ET.TIME_IN_SECONDS,x.ET.IMG_NUMBER]}applyDefaultSelections(){if(super.applyDefaultSelections(),this.firstTimeCell&&!this.firstTimeCell.fake)this.selectFirstTime(this.reselect(this.firstTimeCell));else{let t=this.importDetails.inRows?new c.Xc(1,this.colNumber(1),void 0,0,this.rowNumber(0),void 0,void 0):new c.Xc(0,this.colNumber(0),void 0,1,this.rowNumber(1),void 0,void 0);t=this.reselect(t),t.fake=!0,this.selectFirstTime(t)}}firstTimeNotNumber(){return!!this.firstTimeCell&&isNaN(Number(this.firstTimeCell.value))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b),e.Y36(D.T))},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-define-time-step"]],inputs:{importDetails:"importDetails"},features:[e.qOj],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["required","",3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","placeholder","Time offset",3,"ngModel","ngModelChange"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"value"],["matInput","","type","number","placeholder","Images interval (hours)","required","",3,"ngModel","ngModelChange"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(t,o){1&t&&e.YNc(0,Me,8,7,"mat-card",0),2&t&&e.Q6J("ngIf",o.importDetails)},dependencies:[u.sg,u.O5,d.Fj,d.wV,d.JJ,d.Q7,d.On,C.KE,C.hX,E.gD,Z.ey,_.a8,_.dn,q.Nt,M],encapsulation:2}),i})();function Je(i,n){if(1&i&&(e.TgZ(0,"div",7),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.hij(" Labels ",t.importDetails.inLabelNeg," must be before first time point. ")}}function Be(i,n){if(1&i&&(e.TgZ(0,"div")(1,"p"),e._uU(2),e.TgZ(3,"strong"),e._uU(4),e.qZA()(),e.YNc(5,Je,2,1,"div",6),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.hij("Labels in ",t.importDetails.inLabelNeg," "),e.xp6(2),e.hij("",t.importDetails.inRows?t.labelsSelection.colName:t.labelsSelection.rowName,";"),e.xp6(1),e.Q6J("ngIf",!t.importDetails.areLabelsAfterTime())}}function Oe(i,n){if(1&i&&(e.TgZ(0,"div",8),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" Even if only the top part of the data table is presented all labels from the selected ",t.importDetails.inLabelNeg," will be imported ")}}function Qe(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"mat-card",1)(1,"mat-card-content"),e.YNc(2,Be,6,3,"div",2),e.TgZ(3,"div")(4,"div",3),e._uU(5),e.qZA()(),e.TgZ(6,"bd2-data-sheet-mdtable",4),e.NdJ("selected",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.selectLabels(a))}),e.qZA(),e.TgZ(7,"div"),e._uU(8," \xa0 "),e.YNc(9,Oe,2,1,"div",5),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.labelsSelection),e.xp6(2),e.Tol(t.labelsSelection?"alert alert-info":"alert alert-danger"),e.xp6(1),e.hij(" Click on the ",t.importDetails.inLabelNeg," containing labels. "),e.xp6(1),e.Q6J("dataSlice",t.dataSlice)("selectableColHeader",t.importDetails.inRows)("selectableRowHeader",!t.importDetails.inRows)("styler",t.tableSelector.tableStyler),e.xp6(3),e.Q6J("ngIf",t.hasMoreLabels())}}let Ee=(()=>{class i extends k{constructor(t,o){super(t,o)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.labelsSelection&&!this.labelsSelection.fake)this.selectLabels(this.reselect(this.labelsSelection));else if(this.firstTimeCell){const t=this.reselect(new c.Xc(this.firstTimeCell.colIx-1,this.colNumber(this.firstTimeCell.colIx-1),void 0,this.firstTimeCell.rowIx-1,this.rowNumber(this.firstTimeCell.rowIx-1),void 0,void 0));t.fake=!0,this.selectLabels(t)}}markSelections(){super.markSelections(),this.markFirstTime()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b),e.Y36(D.T))},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-import-labels-step"]],inputs:{importDetails:"importDetails"},features:[e.qOj],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],["role","alert"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(t,o){1&t&&e.YNc(0,Qe,10,9,"mat-card",0),2&t&&e.Q6J("ngIf",o.importDetails)},dependencies:[u.O5,_.a8,_.dn,M],encapsulation:2}),i})();function qe(i,n){if(1&i&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.AsE(" Data start ",t.importDetails.inLabel," must be after time ",t.importDetails.inLabel,". ")}}function Ye(i,n){if(1&i&&(e.TgZ(0,"div")(1,"p"),e._uU(2),e.TgZ(3,"strong"),e._uU(4),e.qZA()(),e.YNc(5,qe,2,2,"div",4),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.hij("Data starts in ",t.importDetails.inLabel," "),e.xp6(2),e.hij("",t.importDetails.inRows?t.dataStart.rowName:t.dataStart.colName,";"),e.xp6(1),e.Q6J("ngIf",!t.importDetails.isDataAfterTime())}}function Pe(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"mat-card",1)(1,"mat-card-content"),e.YNc(2,Ye,6,3,"div",2),e.TgZ(3,"div")(4,"div"),e._uU(5),e.qZA()(),e.TgZ(6,"bd2-data-sheet-mdtable",3),e.NdJ("selected",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.selectDataStart(a))}),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.dataStart),e.xp6(2),e.Tol(t.dataStart?"alert alert-info":"alert alert-danger"),e.xp6(1),e.hij(" Click on the first data ",t.importDetails.inLabel,". "),e.xp6(1),e.Q6J("dataSlice",t.dataSlice)("selectableColHeader",!t.importDetails.inRows)("selectableRowHeader",t.importDetails.inRows)("styler",t.tableSelector.tableStyler)}}let He=(()=>{class i extends k{constructor(t,o){super(t,o)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.dataStart&&!this.dataStart.fake)this.selectDataStart(this.reselect(this.dataStart));else if(this.firstTimeCell){const t=this.reselect(new c.Xc(this.firstTimeCell.colIx+1,this.colNumber(this.firstTimeCell.colIx+1),void 0,this.firstTimeCell.rowIx+1,this.rowNumber(this.firstTimeCell.rowIx+1),void 0,void 0));t.fake=!0,this.selectDataStart(t)}}markSelections(){super.markSelections(),this.markFirstTime(),this.markLabels()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b),e.Y36(D.T))},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-select-data-start-step"]],inputs:{importDetails:"importDetails"},features:[e.qOj],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(t,o){1&t&&e.YNc(0,Pe,7,8,"mat-card",0),2&t&&e.Q6J("ngIf",o.importDetails)},dependencies:[u.O5,_.a8,_.dn,M],encapsulation:2}),i})();var S=r(8189);let Ge=(()=>{class i{constructor(t,o){this.dialogRef=t,this.data=o}ngOnInit(){}sendLabel(){this.dialogRef.close(this.data.label)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(S.so),e.Y36(S.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-edit-label-dialog"]],decls:20,vars:6,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","cdkFocusInitial","",3,"ngModel","ngModelChange","keydown.enter"],["align","start"],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-raised-button","","color","primary",3,"mat-dialog-close"],["ok",""]],template:function(t,o){1&t&&(e.TgZ(0,"h1",0),e._uU(1),e.qZA(),e.TgZ(2,"div",1)(3,"p"),e._uU(4),e.qZA(),e.TgZ(5,"mat-form-field")(6,"input",2),e.NdJ("ngModelChange",function(s){return o.data.label=s})("keydown.enter",function(){return o.sendLabel()}),e.qZA(),e.TgZ(7,"mat-hint",3),e._uU(8,"Pressing "),e.TgZ(9,"strong"),e._uU(10,"Enter"),e.qZA(),e._uU(11," submits "),e.qZA()()(),e.TgZ(12,"div",4)(13,"button",5),e._uU(14,"Cancel"),e.qZA(),e.TgZ(15,"button",5),e._uU(16,"Clear"),e.qZA(),e.TgZ(17,"button",6,7),e._uU(19,"Assign"),e.qZA()()),2&t&&(e.xp6(1),e.Oqu(o.data.title),e.xp6(3),e.hij("Write label for ",o.data.regionName,""),e.xp6(2),e.Q6J("ngModel",o.data.label),e.xp6(7),e.Q6J("mat-dialog-close",void 0),e.xp6(2),e.Q6J("mat-dialog-close",""),e.xp6(2),e.Q6J("mat-dialog-close",o.data.label))},dependencies:[d.Fj,d.JJ,d.On,C.KE,C.bx,q.Nt,Q.lW,S.ZT,S.uh,S.xY,S.H8],encapsulation:2}),i})();const Ke=["table"];function je(i,n){1&i&&e._UZ(0,"th",20)}function ze(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",21),e.NdJ("mousedown",function(){const s=e.CHM(t).index,l=e.oxw(2);return e.KtG(l.startSelectCell(-1,s))})("mouseup",function(){const s=e.CHM(t).index,l=e.oxw(2);return e.KtG(l.endSelectCell(-1,s))}),e.TgZ(1,"label"),e._uU(2),e.qZA()()}if(2&i){const t=n.index,o=e.oxw(2);e.xp6(2),e.Oqu(o.rowsNames[t])}}function Xe(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",22),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.nextRow())}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(t.hasMoreRows?"...":"end")}}function We(i,n){1&i&&(e.TgZ(0,"th",20),e._uU(1,"Labels"),e.qZA())}function $e(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",21),e.NdJ("mousedown",function(){const s=e.CHM(t).index,l=e.oxw(2);return e.KtG(l.startSelectCell(-1,s))})("mouseup",function(){const s=e.CHM(t).index,l=e.oxw(2);return e.KtG(l.endSelectCell(-1,s))}),e.TgZ(1,"label",23),e._uU(2),e.qZA()()}if(2&i){const t=n.index,o=e.oxw(2);e.xp6(2),e.Oqu(o.rowsLabels[t])}}function Ve(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",22),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.nextRow())}),e.qZA()}}function et(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"th",27),e.NdJ("mousedown",function(){e.CHM(t);const a=e.oxw().index,s=e.oxw(2);return e.KtG(s.startSelectCell(a,-1))})("mouseup",function(){e.CHM(t);const a=e.oxw().index,s=e.oxw(2);return e.KtG(s.endSelectCell(a,-1))}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw(),o=t.index,a=t.$implicit,s=e.oxw(2);e.Udp("background-color",s.colBackground(o)),e.xp6(1),e.hij(" ",a," ")}}function tt(i,n){if(1&i&&(e.TgZ(0,"td",28),e._uU(1),e.qZA()),2&i){const t=n.$implicit,o=n.index,a=e.oxw().index,s=e.oxw(2);e.Udp("background-color",s.cellBackground(a,o)),e.xp6(1),e.hij(" ",t[a]," ")}}function ot(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",22),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3);return e.KtG(a.nextRow())}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw(3);e.xp6(1),e.Oqu(t.hasMoreRows?"...":"")}}function it(i,n){1&i&&(e.ynx(0,24),e.YNc(1,et,2,3,"th",25),e.YNc(2,tt,2,3,"td",26),e.YNc(3,ot,2,1,"td",7),e.BQk()),2&i&&e.Q6J("matColumnDef",n.$implicit)}function at(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"th",29),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.nextColumn())}),e._uU(1,"..."),e.qZA()}}function nt(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",30),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.nextColumn())}),e._uU(1,"..."),e.qZA()}}function st(i,n){1&i&&e._UZ(0,"td",31)}function lt(i,n){1&i&&(e.TgZ(0,"th",20),e._uU(1,"Labels"),e.qZA())}function rt(i,n){1&i&&e._UZ(0,"th",20)}function ct(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"th",27),e.NdJ("mousedown",function(){e.CHM(t);const a=e.oxw().index,s=e.oxw(3);return e.KtG(s.startSelectCell(a,-1))})("mouseup",function(){e.CHM(t);const a=e.oxw().index,s=e.oxw(3);return e.KtG(s.endSelectCell(a,-1))}),e.TgZ(1,"label",23),e._uU(2),e.qZA()()}if(2&i){const t=e.oxw().index,o=e.oxw(3);e.Udp("background-color",o.colBackground(t)),e.xp6(2),e.Oqu(o.columnsLabels[t])}}function mt(i,n){1&i&&(e.ynx(0,24),e.YNc(1,ct,3,3,"th",25),e.BQk()),2&i&&e.Q6J("matColumnDef","label"+n.index)}function pt(i,n){if(1&i&&(e.ynx(0),e.YNc(1,mt,2,1,"ng-container",9),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.columnsNames)}}function dt(i,n){1&i&&e._UZ(0,"tr",32)}function ut(i,n){1&i&&e._UZ(0,"tr",32)}function _t(i,n){if(1&i&&(e.ynx(0),e.YNc(1,ut,1,0,"tr",17),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("matHeaderRowDef",t.displayedLabelsColumns)("matHeaderRowDefSticky",!0)}}function ht(i,n){if(1&i&&e._UZ(0,"tr",33),2&i){const t=n.index,o=e.oxw(2);e.Udp("background-color",o.rowBackground(t))}}function ft(i,n){1&i&&e._UZ(0,"tr",34)}function gt(i,n){if(1&i&&(e.TgZ(0,"div",1)(1,"table",2,3),e.ynx(3,4),e.YNc(4,je,1,0,"th",5),e.YNc(5,ze,3,1,"td",6),e.YNc(6,Xe,2,1,"td",7),e.BQk(),e.ynx(7,8),e.YNc(8,We,2,0,"th",5),e.YNc(9,$e,3,1,"td",6),e.YNc(10,Ve,1,0,"td",7),e.BQk(),e.YNc(11,it,4,1,"ng-container",9),e.ynx(12,10),e.YNc(13,at,2,0,"th",11),e.YNc(14,nt,2,0,"td",12),e.YNc(15,st,1,0,"td",13),e.BQk(),e.ynx(16,14),e.YNc(17,lt,2,0,"th",5),e.BQk(),e.ynx(18,15),e.YNc(19,rt,1,0,"th",5),e.BQk(),e.YNc(20,pt,2,1,"ng-container",16),e.YNc(21,dt,1,0,"tr",17),e.YNc(22,_t,2,2,"ng-container",16),e.YNc(23,ht,1,2,"tr",18),e.YNc(24,ft,1,0,"tr",19),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("dataSource",t.data),e.xp6(10),e.Q6J("ngForOf",t.columnsNames),e.xp6(9),e.Q6J("ngIf",t.showColumnsLabels),e.xp6(1),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("ngIf",t.showColumnsLabels),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns),e.xp6(1),e.Q6J("matFooterRowDef",t.displayedColumns)}}let bt=(()=>{class i{set columnsLabels(t){this._columnsLabels=t}get columnsLabels(){return this._columnsLabels}set rowsLabels(t){this._rowsLabels=t}get rowsLabels(){return this._rowsLabels}set dataSlice(t){t&&(this._dataSlice=t,this.columnsNames=t.columnsNames,this.rowsNames=t.rowsNames,this.data=t.data,this.hasMoreColumns=t.columnsNumbers[t.columnsNumbers.length-1]<t.totalColumns-1,this.hasMoreRows=t.rowsNumbers[t.rowsNumbers.length-1]<t.totalRows-1,this.decideColumns(),this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}set selectRows(t){this.selectableRowHeader=t,this.showRowsLabels=t,this.decideColumns()}set selectCols(t){this.selectableColHeader=t,this.showColumnsLabels=t,this.decideColumns()}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.hasMoreColumns=!1,this.hasMoreRows=!1,this._columnsLabels=[],this._rowsLabels=[],this.styler=new U,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.showColumnsLabels=!1,this.showRowsLabels=!1,this.selected=new e.vpe,this.moreRows=new e.vpe,this.moreColumns=new e.vpe}decideColumns(){this.displayedColumns=(this.showRowsLabels?["rowNr","rowLabel"]:["rowNr"]).concat(this.columnsNames),this.displayedLabelsColumns=(this.showRowsLabels?["rowNr2","rowLabel2"]:["rowNr2"]).concat(this.columnsNames.map((t,o)=>"label"+o)),this.hasMoreColumns&&(this.displayedColumns.push("more"),this.displayedLabelsColumns.push("more"))}ngOnInit(){}colNumber(t){return t<0?-1:this._dataSlice.columnsNumbers[t]}rowNumber(t){return t<0?-1:this._dataSlice.rowsNumbers[t]}colBackground(t){return this.styler.colBackground(this.colNumber(t))}rowBackground(t){return this.styler.rowBackground(this.rowNumber(t))}cellBackground(t,o){return this.styler.cellBackground(this.colNumber(t),this.rowNumber(o))}startSelectCell(t,o){if(t<0&&!this.selectableRowHeader||o<0&&!this.selectableColHeader)return;const w=new c.Xc(t,this._dataSlice.columnsNumbers[t],this._dataSlice.columnsNames[t],o,this._dataSlice.rowsNumbers[o],this._dataSlice.rowsNames[o],(o>=0?this.data[o]:[])[t]);this.selectionStart=w}endSelectCell(t,o){if(!this.selectionStart)return;if(o<0&&this.selectionStart.rowIx>=0)return void(this.selectionStart=void 0);if(t<0&&this.selectionStart.colIx>=0)return void(this.selectionStart=void 0);if(t<0&&!this.selectableRowHeader||o<0&&!this.selectableColHeader)return;const w=new c.Xc(t,this._dataSlice.columnsNumbers[t],this._dataSlice.columnsNames[t],o,this._dataSlice.rowsNumbers[o],this._dataSlice.rowsNames[o],(o>=0?this.data[o]:[])[t]);this.selected.next([this.selectionStart,w])}nextColumn(){this.moreColumns.next(!0)}nextRow(){this.moreRows.next(!0)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-selectable-region-mdtable"]],viewQuery:function(t,o){if(1&t&&e.Gf(Ke,5),2&t){let a;e.iGM(a=e.CRH())&&(o.matTable=a.first)}},inputs:{columnsLabels:"columnsLabels",rowsLabels:"rowsLabels",dataSlice:"dataSlice",selectRows:"selectRows",selectCols:"selectCols",styler:"styler"},outputs:{selected:"selected",moreRows:"moreRows",moreColumns:"moreColumns"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"mousedown","mouseup",4,"matCellDef"],["mat-footer-cell","",3,"click",4,"matFooterCellDef"],["matColumnDef","rowLabel","sticky",""],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","more","sticky",""],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","rowNr2","sticky",""],["matColumnDef","rowLabel2","sticky",""],[4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell","","matRipple","",3,"mousedown","mouseup"],["mat-footer-cell","",3,"click"],[1,"user"],[3,"matColumnDef"],["mat-header-cell","","matRipple","",3,"background-color","mousedown","mouseup",4,"matHeaderCellDef"],["mat-cell","",3,"background-color",4,"matCellDef"],["mat-header-cell","","matRipple","",3,"mousedown","mouseup"],["mat-cell",""],["mat-header-cell","",3,"click"],["mat-cell","",3,"click"],["mat-footer-cell",""],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(t,o){1&t&&e.YNc(0,gt,25,8,"div",0),2&t&&e.Q6J("ngIf",o.dataSlice)},dependencies:[u.sg,u.O5,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.mD,m.Ke,m.ge,m.ev,m.yh,m.XQ,m.Gk,m.Q2,Z.wG],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:800px;overflow:auto}.mat-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}label.user[_ngcontent-%COMP%]{color:#000}"]}),i})();const Ct=["colPaginator"],St=["rowPaginator"];function Tt(i,n){if(1&i&&(e.TgZ(0,"div",9),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij(" You have not seen yet all the available ",null==t.importDetails?null:t.importDetails.inLabel,"s for labelling\n")}}const Y=function(){return[10,25,50,100]};let wt=(()=>{class i extends k{get userLabels(){return this.importDetails?this.importDetails.userLabels:void 0}constructor(t,o,a){super(o,a),this.dialog=t,this.columnsLabels=[],this.rowsLabels=[],this.colorer=new Se}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy(),this.dataService&&this.dataService.close()}ngAfterViewInit(){this.colPaginator._intl=new v.ye,this.colPaginator._intl.itemsPerPageLabel="Columns per page",this.rowPaginator._intl=new v.ye,this.rowPaginator._intl.itemsPerPageLabel="Rows per page"}markSelections(){super.markSelections(),this.markFirstTime(),this.loadLabels(),this.markLabels(),this.labelsSummary=this.importDetails.summarizeLabels(25),this.labelTime()}labelTime(){if(this.firstTimeCell)if(this.importDetails.inRows){const t=this.dataSlice.rowsNumbers.indexOf(this.firstTimeCell.rowNumber);t>=0&&(this.rowsLabels[t]="Time")}else{const t=this.dataSlice.columnsNumbers.indexOf(this.firstTimeCell.colNumber);t>=0&&(this.columnsLabels[t]="Time")}}loadLabels(){const t=this.dataSlice;this.importDetails.inRows?(this.rowsLabels=this.userLabels.slice(t.rowsNumbers[0],t.rowsNumbers[t.rowsNumbers.length-1]),this.columnsLabels=[]):(this.rowsLabels=[],this.columnsLabels=this.userLabels.slice(t.columnsNumbers[0],t.columnsNumbers[t.columnsNumbers.length-1]))}markLabels(){this.userLabels.forEach((t,o)=>{this.importDetails.inRows?this.tableSelector.selectRow(o,this.colorer.toColor(t)):this.tableSelector.selectCol(o,this.colorer.toColor(t))})}hasSeenAll(){return!!this.dataSlice&&(this.importDetails.inRows?this.lastRowSeen>=this.dataSlice.totalRows-1:this.lastColumnSeen>=this.dataSlice.totalColumns-1)}selected(t){t[1].isBeforeOrSame(t[0])&&(t=[t[1],t[0]]),this.importDetails.inRows?this.labelRows(t[0],t[1]):this.labelColumns(t[0],t[1])}setUserLabel(t,o){this.userLabels[t]=o||void 0,this.labelsSummary=this.importDetails.summarizeLabels(25)}askForLabel(t,o,a){let s;return s=a?{title:"Label rows",regionName:t.hasSameIx(o)?"row "+t.rowName:"rows "+t.rowName+"-"+o.rowName,label:this.userLabels[t.rowNumber]}:{title:"Label columns",regionName:t.hasSameIx(o)?"column "+t.colName:"columns "+t.colName+"-"+o.colName,label:this.userLabels[t.rowNumber]},this.dialog.open(Ge,{data:s}).afterClosed()}labelRows(t,o){t.rowIx<0||o.rowIx<0?console.warn("Label rows with col selection",t):this.firstTimeCell&&this.firstTimeCell.rowNumber>=t.rowNumber||this.askForLabel(t,o,!0).subscribe(a=>{void 0!==a&&(this.setRowsLabel(t,o,a),a&&this.selectNextRegion(t,o))})}setRowsLabel(t,o,a){a=a.trim();const s=this.colorer.toColor(a);for(let l=t.rowIx;l<=o.rowIx;l++){const p=this.dataSlice.rowsNumbers[l];void 0===p?console.error("No row number for index "+l):(this.rowsLabels[l]=a,this.setUserLabel(p,a),a?this.tableSelector.selectRow(p,s):this.tableSelector.deselectRow(p))}}labelColumns(t,o){t.colIx<0||o.colIx<0?console.warn("Label cols with row selection",t):this.firstTimeCell&&this.firstTimeCell.colNumber>=t.colNumber?console.log("Ignroing labelling as Time col after selection"):this.askForLabel(t,o,!1).subscribe(a=>{void 0!==a&&(this.setColumnsLabel(t,o,a),a&&this.selectNextRegion(t,o))})}setColumnsLabel(t,o,a){a=a.trim();const s=this.colorer.toColor(a);for(let l=t.colIx;l<=o.colIx;l++){const p=this.dataSlice.columnsNumbers[l];void 0===p?console.error("No col number for index "+l):(this.columnsLabels[l]=a,this.setUserLabel(p,a),a?this.tableSelector.selectCol(p,s):this.tableSelector.deselectCol(p))}}selectNextRegion(t,o){const a=[o.colIx-t.colIx,o.rowIx-t.rowIx];let s=this.moveCell(o,[1,1]),l=this.moveCell(s,a);this.isInPage(s)&&(this.isInPage(l)||(l=this.fitToPage(l)),s=this.reselect(s),l=this.reselect(l),this.selected([s,l]))}isInPage(t){return!(t.colIx>=0&&t.colIx>=this.dataSlice.columnsNumbers.length||t.rowIx>=0&&t.rowIx>=this.dataSlice.rowsNumbers.length)}fitToPage(t){return new c.Xc(t.colIx>=0?this.dataSlice.columnsNumbers.length-1:-1,void 0,void 0,t.rowIx>=0?this.dataSlice.rowsNumbers.length-1:-1,void 0,void 0,void 0)}moveCell(t,o){return new c.Xc(t.colIx>=0?t.colIx+o[0]:-1,void 0,void 0,t.rowIx>=0?t.rowIx+o[1]:-1,void 0,void 0,void 0)}loadColPage(t){this.dataService.slice(new f(this.currentPageSlice.rowPage,t))}loadRowPage(t){this.dataService.slice(new f(t,this.currentPageSlice.colPage))}moreColumns(){this.importDetails.inRows||this.colPaginator.nextPage()}moreRows(){this.importDetails.inRows&&this.rowPaginator.nextPage()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(S.uw),e.Y36(b),e.Y36(D.T))},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-assign-labels-step"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Ct,7),e.Gf(St,7)),2&t){let a;e.iGM(a=e.CRH())&&(o.colPaginator=a.first),e.iGM(a=e.CRH())&&(o.rowPaginator=a.first)}},inputs:{importDetails:"importDetails"},features:[e._Bn([b]),e.qOj],decls:14,vars:23,consts:[["role","alert","type","info",1,"alert","alert-info",3,"hidden"],[3,"hidden"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["colPaginator",""],[3,"dataSlice","columnsLabels","rowsLabels","styler","selectRows","selectCols","selected","moreColumns","moreRows"],[3,"length","disabled","pageSize","pageSizeOptions","page"],["rowPaginator",""],["type","danger","class","alert alert-danger mt-2","role","alert",4,"ngIf"],[2,"margin-top","1em"],["type","danger","role","alert",1,"alert","alert-danger","mt-2"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._uU(1),e.qZA(),e.TgZ(2,"div",1)(3,"mat-paginator",2,3),e.NdJ("page",function(s){return o.loadColPage(s)}),e.qZA()(),e.TgZ(5,"bd2-selectable-region-mdtable",4),e.NdJ("selected",function(s){return o.selected(s)})("moreColumns",function(){return o.moreColumns()})("moreRows",function(){return o.moreRows()}),e.qZA(),e.TgZ(6,"div",1)(7,"mat-paginator",5,6),e.NdJ("page",function(s){return o.loadRowPage(s)}),e.qZA()(),e.YNc(9,Tt,2,1,"div",7),e.TgZ(10,"div",8)(11,"label"),e._uU(12,"Selected labels: "),e.qZA(),e._uU(13),e.qZA()),2&t&&(e.Q6J("hidden",(null==o.importDetails||null==o.importDetails.userLabels?null:o.importDetails.userLabels.length)>1),e.xp6(1),e.hij(" Click and drag over ",null==o.importDetails?null:o.importDetails.inLabel," headers to label the data.\n"),e.xp6(1),e.Q6J("hidden",null==o.importDetails?null:o.importDetails.inRows),e.xp6(1),e.Q6J("length",null==o.dataSlice?null:o.dataSlice.totalColumns)("disabled",null==o.importDetails?null:o.importDetails.inRows)("pageSize",o.currentPageSlice.colPage.pageSize)("pageIndex",o.currentPageSlice.colPage.pageIndex)("pageSizeOptions",e.DdM(21,Y)),e.xp6(2),e.Q6J("dataSlice",o.dataSlice)("columnsLabels",o.columnsLabels)("rowsLabels",o.rowsLabels)("styler",o.tableSelector.tableStyler)("selectRows",null==o.importDetails?null:o.importDetails.inRows)("selectCols",!(null!=o.importDetails&&o.importDetails.inRows)),e.xp6(1),e.Q6J("hidden",!(null!=o.importDetails&&o.importDetails.inRows)),e.xp6(1),e.Q6J("length",null==o.dataSlice?null:o.dataSlice.totalRows)("disabled",!(null!=o.importDetails&&o.importDetails.inRows))("pageSize",o.firstPageSlice.rowPage.pageSize)("pageSizeOptions",e.DdM(22,Y)),e.xp6(2),e.Q6J("ngIf",!o.hasSeenAll()),e.xp6(4),e.hij("",o.labelsSummary,"\n"))},dependencies:[u.O5,v.NW,bt],encapsulation:2}),i})();var P=r(4880),Dt=r(7921),I=r(4002),xt=r(4692),H=r(2626);const vt=["backgroundInput"],Nt=["auto"];function Zt(i,n){1&i&&(e.TgZ(0,"mat-icon",14),e._uU(1,"cancel"),e.qZA())}function kt(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"mat-chip",12),e.NdJ("removed",function(){const s=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.remove(s))}),e._uU(1),e.YNc(2,Zt,2,0,"mat-icon",13),e.qZA()}if(2&i){const t=n.$implicit,o=e.oxw(2);e.Q6J("selectable",o.selectable)("removable",o.removable),e.xp6(1),e.hij(" ",t," "),e.xp6(1),e.Q6J("ngIf",o.removable)}}function It(i,n){if(1&i&&(e.TgZ(0,"mat-option",15),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function Rt(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"mat-card",1)(2,"mat-card-content")(3,"div",2),e._uU(4," Select labels for which data should be treated as the background noise "),e.qZA(),e.TgZ(5,"mat-form-field",3)(6,"mat-chip-list",4,5),e.YNc(8,kt,3,4,"mat-chip",6),e.TgZ(9,"input",7,8),e.NdJ("matChipInputTokenEnd",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.add(a))}),e.qZA()(),e.TgZ(11,"mat-autocomplete",9,10),e.NdJ("optionSelected",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.selected(a))}),e.YNc(13,It,2,2,"mat-option",11),e.ALo(14,"async"),e.qZA()()()()()}if(2&i){const t=e.MAs(7),o=e.MAs(12),a=e.oxw();e.xp6(8),e.Q6J("ngForOf",a.backgrounds),e.xp6(1),e.Q6J("formControl",a.backgroundCtrl)("matAutocomplete",o)("matChipInputFor",t)("matChipInputSeparatorKeyCodes",a.separatorKeysCodes)("matChipInputAddOnBlur",a.addOnBlur),e.xp6(4),e.Q6J("ngForOf",e.lcZ(14,7,a.filteredLabels))}}let yt=(()=>{class i{get backgrounds(){return this.importDetails?this.importDetails.backgroundsLabels:[]}set backgrounds(t){this.importDetails.backgroundsLabels=t}constructor(t){this.tsFileService=t,this.selectable=!0,this.removable=!0,this.addOnBlur=!1,this.separatorKeysCodes=[P.K5,P.OC],this.backgroundCtrl=new d.p4,this.allLabels=[]}ngOnInit(){this.filteredLabels=this.backgroundCtrl.valueChanges.pipe((0,Dt.O)(null),(0,L.U)(t=>t?this.filter(t):this.allLabels))}loadLabels(){this.importDetails&&this.importDetails.fileId?this.importDetails.importLabels?this.importDetails.labelsSelection&&this.tsFileService.previewLabels(this.importDetails.fileId,this.importDetails.importFormat.name,this.importDetails.labelsSelection,this.importDetails.inRows).subscribe(t=>{this.updateAllLabels(this.unique(t))}):this.updateAllLabels(this.unique(this.importDetails.userLabels)):this.updateAllLabels([])}updateAllLabels(t){this.allLabels=t.slice().sort();const o=this.backgrounds||[];this.backgrounds=[],o.forEach(a=>this.addBackground(a)),this.backgroundCtrl.setValue(" "),this.backgroundCtrl.setValue(null)}unique(t){return t=t.filter(a=>!!a).map(a=>a.trim()),[...new Set(t)]}addBackground(t){if((t||"").trim()){const o=this.backgrounds.indexOf(t),a=this.allLabels.indexOf(t);o<0&&a>=0&&this.backgrounds.push(t.trim())}}add(t){if(!this.matAutocomplete.isOpen){const o=t.input;this.addBackground(t.value),o&&(o.value=""),this.backgroundCtrl.setValue(null)}}remove(t){const o=this.backgrounds.indexOf(t);o>=0&&this.backgrounds.splice(o,1)}selected(t){this.addBackground(t.option.viewValue),this.backgroundInput.nativeElement.value="",this.backgroundCtrl.setValue(null)}filter(t){const o=t.toLowerCase();return this.allLabels.filter(a=>a.toLowerCase().includes(o)).slice(0,7)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(A))},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-select-backgrounds-labels-step"]],viewQuery:function(t,o){if(1&t&&(e.Gf(vt,5),e.Gf(Nt,5)),2&t){let a;e.iGM(a=e.CRH())&&(o.backgroundInput=a.first),e.iGM(a=e.CRH())&&(o.matAutocomplete=a.first)}},inputs:{importDetails:"importDetails"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"mat-elevation-z4"],["type","info","role","alert",1,"alert","alert-info"],[2,"width","100%"],["aria-label","Backgrounds selection"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder","Type to select background label...",3,"formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["backgroundInput",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"selectable","removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"]],template:function(t,o){1&t&&e.YNc(0,Rt,15,9,"div",0),2&t&&e.Q6J("ngIf",null==o.importDetails?null:o.importDetails.containsBackgrounds)},dependencies:[u.sg,u.O5,d.Fj,d.JJ,d.oH,C.KE,Z.ey,_.a8,_.dn,I.qn,I.HS,I.oH,I.qH,xt.Hw,H.XC,H.ZL,u.Ov],encapsulation:2}),i})();const Lt=["stepper"],At=["importLabelsStep"],Ut=["assignLabelsStep"],Mt=["selectBackgroundsStep"];function Ft(i,n){1&i&&e._uU(0,"Upload data file")}function Jt(i,n){1&i&&e._uU(0,"Data layout")}function Bt(i,n){if(1&i&&e._uU(0),2&i){const t=e.oxw();e.hij("Define time ",t.importDetails.inLabel,"")}}function Ot(i,n){1&i&&e._uU(0,"Label data")}function Qt(i,n){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-step",12),e.YNc(2,Ot,1,0,"ng-template",2),e._UZ(3,"mat-divider")(4,"bd2-import-details-summary",19)(5,"bd2-assign-labels-step",4,20),e.TgZ(7,"div")(8,"button",10),e._uU(9,"Back"),e.qZA(),e.TgZ(10,"button",14),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.startChoosingBackgrounds())}),e._uU(11,"Next"),e.qZA()()(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("completed",t.importDetails.areLabelsCorrectlyAssigned()),e.xp6(3),e.Q6J("importDetails",t.importDetails)("showTime",!0),e.xp6(1),e.Q6J("importDetails",t.importDetails),e.xp6(5),e.Q6J("disabled",!t.importDetails.areLabelsCorrectlyAssigned())}}function Et(i,n){if(1&i&&e._uU(0),2&i){const t=e.oxw(2);e.hij("Select labels ",t.importDetails.inLabelNeg,"")}}function qt(i,n){1&i&&e._uU(0,"Select data start")}function Yt(i,n){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-step",12),e.YNc(2,Et,1,1,"ng-template",2),e._UZ(3,"mat-divider")(4,"bd2-import-details-summary",19)(5,"bd2-import-labels-step",4,21),e.TgZ(7,"div")(8,"button",10),e._uU(9,"Back"),e.qZA(),e.TgZ(10,"button",14),e.NdJ("click",function(){e.CHM(t);const a=e.MAs(17),s=e.oxw();return e.KtG(s.loadData(a))}),e._uU(11,"Next"),e.qZA()()(),e.TgZ(12,"mat-step",12),e.YNc(13,qt,1,0,"ng-template",2),e._UZ(14,"mat-divider")(15,"bd2-import-details-summary",22)(16,"bd2-select-data-start-step",4,23),e.TgZ(18,"div")(19,"button",10),e._uU(20,"Back"),e.qZA(),e.TgZ(21,"button",14),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.startChoosingBackgrounds())}),e._uU(22,"Next"),e.qZA()()(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("completed",t.importDetails.areLabelsCorrectlySelected()),e.xp6(3),e.Q6J("importDetails",t.importDetails)("showTime",!0),e.xp6(1),e.Q6J("importDetails",t.importDetails),e.xp6(5),e.Q6J("disabled",!t.importDetails.areLabelsCorrectlySelected()),e.xp6(2),e.Q6J("completed",t.importDetails.areLabelsCorrectlySelected()&&t.importDetails.isDataStartCorrectlySelected()),e.xp6(3),e.Q6J("importDetails",t.importDetails)("showTime",!0)("showLabelling",!0),e.xp6(1),e.Q6J("importDetails",t.importDetails),e.xp6(5),e.Q6J("disabled",!t.importDetails.isDataStartCorrectlySelected())}}function Pt(i,n){1&i&&e._uU(0,"Select backgrounds labels")}function Ht(i,n){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-step"),e.YNc(2,Pt,1,0,"ng-template",2),e._UZ(3,"mat-divider")(4,"bd2-import-details-summary",16)(5,"bd2-select-backgrounds-labels-step",4,24),e.TgZ(7,"div")(8,"button",10),e._uU(9,"Back"),e.qZA(),e.TgZ(10,"button",25),e._uU(11,"Next"),e.qZA()()(),e.BQk()),2&i){const t=e.oxw();e.xp6(4),e.Q6J("importDetails",t.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),e.xp6(1),e.Q6J("importDetails",t.importDetails)}}function Gt(i,n){1&i&&e._uU(0,"Import timeseries")}let Kt=(()=>{class i{constructor(t,o,a){this.fileService=t,this.feedback=o,this.dataService=a,this.import=new e.vpe,this.oldImport=new e.vpe,this.blocked=!1,this.importDetails=new c.Jt,this.importDetails.timeType=x.ET.TIME_IN_HOURS}ngOnInit(){}ngOnDestroy(){this.dataService&&this.dataService.close()}upload(t){t.files&&1===t.files.length?this.fileService.uploadFile(t.files[0],t.importFormat).subscribe(o=>{this.importDetails.fileId=o,this.importDetails.fileName=t.files[0].name,this.importDetails.importFormat=t.importFormat,this.importDetails.inRows=t.importFormat!=c.kk.EXCEL_TABLE,this.stepper.next(),t.importFormat==c.kk.TOPCOUNT&&this.oldImport.next(this.importDetails)},o=>{this.feedback.error(o)}):console.error("Wrong upload files size",t.files)}loadData(t){t.loadData()}startLabelling(){this.importDetails.importLabels?this.importLabelsStep?this.importLabelsStep.loadData():console.error("Missing importLabelStep"):this.assignLabelsStep?this.assignLabelsStep.loadData():console.error("Missing assignLabelsStep")}startChoosingBackgrounds(){this.importDetails.containsBackgrounds&&(this.selectBackgroundsStep?this.selectBackgroundsStep.loadLabels():console.error("Missing selectBackgroundsStep"))}importData(){this.importDetails.isComplete()&&this.import.next(this.importDetails)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(A),e.Y36(D.T),e.Y36(b))},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-import-steps"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Lt,5),e.Gf(At,5),e.Gf(Ut,5),e.Gf(Mt,5)),2&t){let a;e.iGM(a=e.CRH())&&(o.stepper=a.first),e.iGM(a=e.CRH())&&(o.importLabelsStep=a.first),e.iGM(a=e.CRH())&&(o.assignLabelsStep=a.first),e.iGM(a=e.CRH())&&(o.selectBackgroundsStep=a.first)}},inputs:{blocked:"blocked"},outputs:{import:"import",oldImport:"oldImport"},features:[e._Bn([b])],decls:62,vars:26,consts:[[3,"linear"],["stepper",""],["matStepLabel",""],[3,"uploadFiles"],[3,"importDetails"],[1,"mat-elevation-z4"],["name","inRows",1,"spaced",3,"ngModel","ngModelChange"],[3,"value"],["name","importLabels",1,"spaced",3,"ngModel","ngModelChange"],["name","containsBackgrounds",1,"spaced",3,"ngModel","ngModelChange"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","type","button",3,"click"],[3,"completed"],["defineTimeStep",""],["mat-button","","matStepperNext","","type","button",3,"disabled","click"],[4,"ngIf"],[3,"importDetails","showTime","showLabelling","showDataStart"],["type","info","role","alert",1,"alert","alert-info"],["mat-button","",3,"disabled","click"],[3,"importDetails","showTime"],["assignLabelsStep",""],["importLabelsStep",""],[3,"importDetails","showTime","showLabelling"],["selectDataStartStep",""],["selectBackgroundsStep",""],["mat-button","","matStepperNext","","type","button"]],template:function(t,o){if(1&t){const a=e.EpF();e.TgZ(0,"mat-vertical-stepper",0,1)(2,"mat-step"),e.YNc(3,Ft,1,0,"ng-template",2),e.TgZ(4,"bd2-upload-data-file-step",3),e.NdJ("uploadFiles",function(l){return o.upload(l)}),e.qZA()(),e.TgZ(5,"mat-step")(6,"form"),e.YNc(7,Jt,1,0,"ng-template",2),e._UZ(8,"mat-divider")(9,"bd2-import-details-summary",4),e.TgZ(10,"mat-card",5)(11,"mat-card-content")(12,"p")(13,"mat-radio-group",6),e.NdJ("ngModelChange",function(l){return o.importDetails.inRows=l}),e.TgZ(14,"mat-radio-button",7),e._uU(15,"Data in rows"),e.qZA(),e.TgZ(16,"mat-radio-button",7),e._uU(17,"Data in columns"),e.qZA()()(),e.TgZ(18,"p")(19,"mat-radio-group",8),e.NdJ("ngModelChange",function(l){return o.importDetails.importLabels=l}),e.TgZ(20,"mat-radio-button",7),e._uU(21),e.qZA(),e.TgZ(22,"mat-radio-button",7),e._uU(23,"Manually label"),e.qZA()()(),e.TgZ(24,"p")(25,"mat-radio-group",9),e.NdJ("ngModelChange",function(l){return o.importDetails.containsBackgrounds=l}),e.TgZ(26,"mat-radio-button",7),e._uU(27,"No noise data"),e.qZA(),e.TgZ(28,"mat-radio-button",7),e._uU(29),e.qZA()()()(),e.TgZ(30,"mat-card-actions")(31,"button",10),e._uU(32,"Back"),e.qZA(),e.TgZ(33,"button",11),e.NdJ("click",function(){e.CHM(a);const l=e.MAs(40);return e.KtG(o.loadData(l))}),e._uU(34,"Next"),e.qZA()()()()(),e.TgZ(35,"mat-step",12),e.YNc(36,Bt,1,1,"ng-template",2),e._UZ(37,"mat-divider")(38,"bd2-import-details-summary",4)(39,"bd2-define-time-step",4,13),e.TgZ(41,"div")(42,"button",10),e._uU(43,"Back"),e.qZA(),e.TgZ(44,"button",14),e.NdJ("click",function(){return o.startLabelling()}),e._uU(45,"Next"),e.qZA()()(),e.YNc(46,Qt,12,5,"ng-container",15),e.YNc(47,Yt,23,11,"ng-container",15),e.YNc(48,Ht,12,5,"ng-container",15),e.TgZ(49,"mat-step",12),e.YNc(50,Gt,1,0,"ng-template",2),e._UZ(51,"mat-divider")(52,"bd2-import-details-summary",16),e.TgZ(53,"mat-card",5)(54,"mat-card-content")(55,"div",17),e._uU(56,"You can now import the timeseries"),e.qZA()()(),e.TgZ(57,"div")(58,"button",10),e._uU(59,"Back"),e.qZA(),e.TgZ(60,"button",18),e.NdJ("click",function(){return o.importData()}),e._uU(61,"Import data"),e.qZA()()()()}2&t&&(e.Q6J("linear",!0),e.xp6(9),e.Q6J("importDetails",o.importDetails),e.xp6(4),e.Q6J("ngModel",o.importDetails.inRows),e.xp6(1),e.Q6J("value",!0),e.xp6(2),e.Q6J("value",!1),e.xp6(3),e.Q6J("ngModel",o.importDetails.importLabels),e.xp6(1),e.Q6J("value",!0),e.xp6(1),e.hij("Import labels from ",o.importDetails.inLabelNeg,""),e.xp6(1),e.Q6J("value",!1),e.xp6(3),e.Q6J("ngModel",o.importDetails.containsBackgrounds),e.xp6(1),e.Q6J("value",!1),e.xp6(2),e.Q6J("value",!0),e.xp6(1),e.hij("Background noise in ",o.importDetails.inLabel,"s"),e.xp6(6),e.Q6J("completed",o.importDetails.isTimeDefined()),e.xp6(3),e.Q6J("importDetails",o.importDetails),e.xp6(1),e.Q6J("importDetails",o.importDetails),e.xp6(5),e.Q6J("disabled",!o.importDetails.isTimeDefined()),e.xp6(2),e.Q6J("ngIf",!o.importDetails.importLabels),e.xp6(1),e.Q6J("ngIf",o.importDetails.importLabels),e.xp6(1),e.Q6J("ngIf",o.importDetails.containsBackgrounds),e.xp6(1),e.Q6J("completed",o.importDetails.isComplete()),e.xp6(3),e.Q6J("importDetails",o.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),e.xp6(8),e.Q6J("disabled",o.blocked||!o.importDetails.isComplete()))},dependencies:[u.O5,d._Y,d.JJ,d.JL,d.On,d.F,O.VQ,O.U0,_.a8,_.dn,_.hq,ie.d,N.C0,N.VY,N.Vq,N.Ic,N.fd,Q.lW,me,be,Fe,Ee,He,wt,yt],encapsulation:2}),i})();function jt(i,n){1&i&&(e.TgZ(0,"mat-card")(1,"mat-card-content"),e._UZ(2,"mat-spinner",2),e.TgZ(3,"div",3),e._uU(4,"Importing ...."),e.qZA()()())}const zt=[{path:"",children:[{path:"",component:(()=>{class i extends G.w{constructor(t,o){super(o),this.BD2REST=t,this.importing=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit()}importData(t){if(this.importing)return;const o=new c.nl;o.fileId=t.fileId,o.importFormat=t.importFormat,o.importParameters=t,this.importing=!0,this.BD2REST.experimentImportTS(this.assay.id,o).subscribe(a=>{this.feedback.success("Imported "+a.imported+" timeseries"),this.refreshModel(),this.importing=!1,this.goToTSView()},a=>{this.importing=!1,this.feedback.error(a)})}goToTSView(){const t=this.expHomePath();t.push("data"),t.push("view"),t.push("ts"),this.router.navigate(t)}goToOldImport(t){const o=this.expHomePath();o.push("data","ts-old-import",t.importFormat.name,t.fileId),this.router.navigate(o)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(R.q),e.Y36(K.L))},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-tsimport-dashboard"]],features:[e.qOj],decls:2,vars:1,consts:[[3,"import","oldImport"],[4,"ngIf"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"]],template:function(t,o){1&t&&(e.TgZ(0,"bd2-import-steps",0),e.NdJ("import",function(s){return o.importData(s)})("oldImport",function(s){return o.goToOldImport(s)}),e.qZA(),e.YNc(1,jt,5,0,"mat-card",1)),2&t&&(e.xp6(1),e.Q6J("ngIf",o.importing))},dependencies:[u.O5,j.Ou,_.a8,_.dn,Kt],encapsulation:2}),i})()}]}];let Xt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[J.Bz.forChild(zt),J.Bz]}),i})();var Wt=r(7229),$t=r(8345);let Vt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[u.ez,d.u5,d.UX,Wt.Q,$t.O,Xt]}),i})()}}]);