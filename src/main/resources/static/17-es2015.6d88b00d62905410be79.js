(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{d9Wp:function(e,t,r){"use strict";r.r(t);var a=r("ofXK"),i=r("tyNb"),s=r("yYXI"),n=r("bngM"),o=r("QBpm");class c{constructor(e){this.rows=new Map,this.nextColumn=0,this.sorted=!0,null!=e&&(this.sorted=e)}get width(){return this.nextColumn}get size(){return this.rows.size}append(e,t){this.put(e,t,this.nextColumn)}put(e,t,r){this._put(e,t,r),this.nextColumn=Math.max(this.nextColumn,r+1)}putColumn(e,t,r){e.forEach((e,a)=>{this._put(e,t[a],r)}),this.nextColumn=Math.max(this.nextColumn,r+1)}appendColumn(e,t){this.putColumn(e,t,this.nextColumn)}getValue(e,t){const r=this.rows.get(e);return r?r[t]:void 0}getRow(e){return this.rows.get(e)}forEach(e){this.keys().forEach((t,r)=>{const a={key:t,columns:this.rows.get(t)};e(a,r,this)})}forEachFlat(e){this.keys().forEach((t,r)=>{const a=[t].concat(this.rows.get(t));e(a,r,this)})}keys(){return this.sorted?Array.from(this.rows.keys()).sort((e,t)=>e==t?0:e<t?-1:1):Array.from(this.rows.keys())}_put(e,t,r){let a=this.rows.get(e);a||(a=[],this.rows.set(e,a)),a[r]=t}}class l{constructor(){this.SEP=","}renderCSVTable(e,t,r,a){const i=this.prepareHeaders(a,t,r,e.length);this.appendDataLabels(i,e);const s=this.prepareDataTable(e);let n=this.mapToString(i,this.SEP);return n+=this.mapToString(s,this.SEP),n}prepareHeaders(e,t,r,a){const i=this.prepareExpHeaders(e);return this.appendDisplayProperties(i,t),this.appendDataProperties(i,a,r),i}prepareExpHeaders(e){const t=new c(!1);return t.put("Exp Id:",""+e.id,0),t.put("Exp URL:","https://biodare2.ed.ac.uk/experiment/"+e.id,0),t.put("Exp Name:",e.name,0),e.contributionDesc.authors.forEach((e,r)=>{t.put("Authors:",e.name,r)}),t}appendDisplayProperties(e,t){e.put("Detrending:",t.detrending.label,0),e.put("Normalization:",t.normalisation,0),e.put("Align:",t.align,0)}appendDataProperties(e,t,r){e.put("Traces",t+" of "+r.length,0);const a=Math.floor(r.length/r.pageSize)+(r.length%r.pageSize==0?0:1);e.put("Data Page",r.pageIndex+1+" of "+a,0)}appendDataLabels(e,t){t.forEach((t,r)=>{e.put("Label:",t.label,r)})}prepareDataTable(e){const t=new c;return e.forEach(e=>{const r=e.data.map(e=>e.x),a=e.data.map(e=>e.y);t.appendColumn(r,a)}),t}mapToString(e,t){let r="";return e.forEachFlat(e=>{for(let a=0;a<e.length;a++)void 0!==e[a]&&(r+=e[a]),r+=t;r+="\n"}),r}}var p=r("Kj3r"),d=r("Iab2"),b=r("fXoL"),u=r("ZC3s"),h=r("vejM"),m=r("ZMwR"),f=r("GVyA"),g=r("wcxA"),y=r("3Pt+"),P=r("M9IT");function v(e,t){if(1&e&&(b.Wb(0,"option",19),b.Jc(1),b.Vb()),2&e){const e=t.$implicit;b.oc("value",e.name),b.Cb(1),b.Kc(e.label)}}function x(e,t){if(1&e&&(b.Wb(0,"option",19),b.Jc(1),b.Vb()),2&e){const e=t.$implicit;b.oc("value",e.name),b.Cb(1),b.Kc(e.label)}}function V(e,t){if(1&e&&(b.Wb(0,"option",19),b.Jc(1),b.Vb()),2&e){const e=t.$implicit;b.oc("value",e.name),b.Cb(1),b.Kc(e.label)}}const w=function(){return[10,25,50,100,200]};let W=(()=>{class e extends g.a{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(b.Qb(y.d))},e.\u0275cmp=b.Kb({type:e,selectors:[["bd2-tsdisplay-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},features:[b.zb],decls:37,vars:10,consts:[["role","form",1,"form-horizontal",3,"formGroup"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-sm-2"],["for","timeStart",1,"col-sm-1"],[1,"col-sm-3"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-6"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-1"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],[3,"value"]],template:function(e,t){1&e&&(b.Wb(0,"form",0),b.Wb(1,"div",1),b.Wb(2,"label",2),b.Jc(3,"Time scale"),b.Vb(),b.Wb(4,"label",3),b.Jc(5,"from:"),b.Vb(),b.Wb(6,"div",4),b.Rb(7,"input",5),b.Vb(),b.Wb(8,"label",6),b.Jc(9,"to:"),b.Vb(),b.Wb(10,"div",4),b.Rb(11,"input",7),b.Vb(),b.Vb(),b.Wb(12,"div",8),b.Wb(13,"label",9),b.Jc(14,"Processing"),b.Vb(),b.Wb(15,"label",9),b.Jc(16,"Detrending"),b.Vb(),b.Wb(17,"div",10),b.Wb(18,"select",11),b.Hc(19,v,2,2,"option",12),b.Vb(),b.Vb(),b.Vb(),b.Wb(20,"div",8),b.Rb(21,"label",2),b.Wb(22,"label",13),b.Jc(23,"Norm."),b.Vb(),b.Wb(24,"div",4),b.Wb(25,"select",14),b.Hc(26,x,2,2,"option",12),b.Vb(),b.Vb(),b.Wb(27,"label",13),b.Jc(28,"Align"),b.Vb(),b.Wb(29,"div",4),b.Wb(30,"select",15),b.Hc(31,V,2,2,"option",12),b.Vb(),b.Vb(),b.Vb(),b.Wb(32,"div",8),b.Rb(33,"label",2),b.Wb(34,"div",16),b.Wb(35,"mat-paginator",17,18),b.ec("page",(function(e){return t.loadDataPage(e)})),b.Vb(),b.Vb(),b.Vb(),b.Vb()),2&e&&(b.oc("formGroup",t.mainForm),b.Cb(19),b.oc("ngForOf",t.detrendingOptions),b.Cb(7),b.oc("ngForOf",t.normalisationOptions),b.Cb(5),b.oc("ngForOf",t.alignOptions),b.Cb(4),b.oc("length",t.totalTraces)("disabled",t.disabledPagination)("pageSize",t.currentPage.pageSize)("pageIndex",t.currentPage.pageIndex)("pageSizeOptions",b.qc(9,w)))},directives:[y.C,y.q,y.h,y.i,y.u,y.c,y.y,y.p,y.g,y.z,a.l,P.a,y.t,y.B],encapsulation:2}),e})();var C=r("nA4b");function S(e,t){if(1&e){const e=b.Xb();b.Wb(0,"div",6),b.Jc(1,"Please complete "),b.Wb(2,"a",7),b.ec("click",(function(t){b.Ac(e);const r=b.ic();return r.goToExpEdit(r.assay.id,"MeasurementSection")})),b.Jc(3,"Measurement details"),b.Vb(),b.Jc(4," to get access to the secondary data "),b.Vb()}}function E(e,t){if(1&e){const e=b.Xb();b.Wb(0,"div",8),b.Wb(1,"label",9),b.Wb(2,"a",10),b.ec("click",(function(t){return b.Ac(e),b.ic().exportData()})),b.Wb(3,"i",11),b.Jc(4,"save_alt"),b.Vb(),b.Wb(5,"span",12),b.Jc(6,"Download"),b.Vb(),b.Vb(),b.Jc(7," the current view "),b.Vb(),b.Wb(8,"label"),b.Wb(9,"a",13),b.ec("click",(function(t){return b.Ac(e),b.ic().recordExport()})),b.Wb(10,"i",11),b.Jc(11,"save_alt"),b.Vb(),b.Wb(12,"span",12),b.Jc(13,"Download"),b.Vb(),b.Vb(),b.Jc(14," the detrended dataset "),b.Vb(),b.Vb()}if(2&e){const e=b.ic();b.Cb(9),b.pc("href",e.exportURL,b.Cc)}}function D(e,t){if(1&e&&b.Rb(0,"bd2-ts-plots",14),2&e){const e=b.ic();b.oc("tracesPerPlot",e.tracesPerPlot)("data",e.timeseries)}}const T=[{path:"",children:[{path:"view/ts",component:(()=>{class e extends s.a{constructor(e,t,r,a,i){super(i),this.fetcher=e,this.tsdataService=t,this.RDMSocial=r,this.analytics=a,this.timeseries=[],this.totalTraces=0,this.currentPage=n.a.firstPage(),this.tracesPerPlot=5,this.blocked=!1,this.disabledSecondary=!1,this.csvExporter=new l,this.titlePart=" Data"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(p.a)(1e3)).subscribe(e=>{if(!this.assay)return;const t=e.data;this.currentParams=e.params,this.exportURL=this.tsdataService.exportURL(this.assay,e.params),this.timeseries=t,this.tracesPerPlot=Math.max(5,t.length/20),this.totalTraces=e.totalTraces,this.currentPage=e.currentPage,this.analytics.experimentDataViev(this.assay.id)},e=>{console.log("Error in TS subscription: "+e),this.feedback.error(e)})}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}displayChanged(e){this.fetcher.changeDisplayParams(e)}exportData(){const e=this.fetcher.current;if(!e)return;const t=this.csvExporter.renderCSVTable(e.data,e.params,e.currentPage,this.assay),r=new Blob([t],{type:"text/csv"});d.saveAs(r,this.assay.id+"_data."+this.currentParams.detrending.name+".page"+(e.currentPage.pageIndex+1)+".csv"),this.recordExport()}recordExport(){this.analytics.experimentDataExport(this.assay.id)}updateModel(e){super.updateModel(e),this.RDMSocial.canProceedByMeasurement(e).then(e=>{this.disabledSecondary=!e}),this.fetcher.experiment(e)}}return e.\u0275fac=function(t){return new(t||e)(b.Qb(o.a),b.Qb(u.a),b.Qb(h.a),b.Qb(m.a),b.Qb(f.a))},e.\u0275cmp=b.Kb({type:e,selectors:[["ng-component"]],features:[b.Bb([o.a]),b.zb],decls:12,vars:6,consts:[[3,"disabled","totalTraces","currentPage","displayParams"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","info","role","alert","dismissible","true","dismissOnTimeout","20000",1,"alert","alert-info"],["class","float-right",4,"ngIf"],[1,"clearfix"],[3,"tracesPerPlot","data",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],[3,"click"],[1,"float-right"],[1,"mr-4"],["download","","role","button","aria-label","download",1,"btn","btn-primary",2,"color","white",3,"click"],[1,"material-icons","bd-icon"],[1,"cdk-visually-hidden"],["download","","role","button",1,"btn","btn-primary",3,"href","click"],[3,"tracesPerPlot","data"]],template:function(e,t){1&e&&(b.Wb(0,"h3"),b.Jc(1,"Show timeseries"),b.Vb(),b.Rb(2,"hr"),b.Wb(3,"bd2-tsdisplay-params-rform",0),b.ec("displayParams",(function(e){return t.displayChanged(e)})),b.Vb(),b.Hc(4,S,5,0,"div",1),b.Rb(5,"hr"),b.Wb(6,"div",2),b.Jc(7," Hint: You can click on trace label box to remove it from the plot. "),b.Vb(),b.Hc(8,E,15,1,"div",3),b.Rb(9,"div",4),b.Rb(10,"hr"),b.Hc(11,D,1,2,"bd2-ts-plots",5)),2&e&&(b.Cb(3),b.oc("disabled",t.disabledSecondary)("totalTraces",t.totalTraces)("currentPage",t.currentPage),b.Cb(1),b.oc("ngIf",t.disabledSecondary),b.Cb(4),b.oc("ngIf",t.timeseries&&t.exportURL),b.Cb(3),b.oc("ngIf",t.timeseries))},directives:[W,a.m,C.a],encapsulation:2}),e})()},{path:"ts-old-import",loadChildren:()=>Promise.all([r.e(0),r.e(16)]).then(r.bind(null,"9Gw/")).then(e=>e.TsOldImportModule)},{path:"ts-import",loadChildren:()=>Promise.all([r.e(0),r.e(18)]).then(r.bind(null,"yPAH")).then(e=>e.TsImportModule)}]}];let J=(()=>{class e{}return e.\u0275mod=b.Ob({type:e}),e.\u0275inj=b.Nb({factory:function(t){return new(t||e)},imports:[[i.f.forChild(T)],i.f]}),e})();var k=r("YiFe"),M=r("a6j2"),I=r("ZTEM");r.d(t,"TsDataModule",(function(){return O}));let O=(()=>{class e{}return e.\u0275mod=b.Ob({type:e}),e.\u0275inj=b.Nb({factory:function(t){return new(t||e)},imports:[[a.c,y.j,y.x,k.a,M.a,J,I.a]]}),e})()}}]);