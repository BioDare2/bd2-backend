(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{ja10:function(t,e,i){"use strict";i.r(e),i.d(e,"RhythmicityModule",(function(){return ae}));var r=i("ofXK"),s=i("tyNb"),a=i("yYXI"),n=i("fXoL"),c=i("FjDX"),o=i("GVyA");let b=(()=>{class t extends a.a{constructor(t,e){super(e),this.rhythmicityService=t,this.titlePart=" Rhythm"}goToRhythmicityHome(t){const e=this.expHomePath(t);e.push("rhythmicity"),this.router.navigate(e)}}return t.\u0275fac=function(e){return new(e||t)(n.Nb(c.a),n.Nb(o.a))},t.\u0275dir=n.Ib({type:t,features:[n.yb]}),t})();var l=i("2Vo4"),d=i("PqYM"),h=i("B9cw"),u=i("Iab2"),p=i("7jps"),m=i("zQ7r"),f=i("Iurr"),g=i("tu3j");let S=(()=>{class t extends m.a{constructor(t,e=!1){super(e),this.rhythmicityService=t,this.finishedJob$=this.finished$,this.runningJob$=this.running$,this.allJob$=this.all$}get currentJob(){return this.currentAsset}initIntervalsKeeper(){return new g.a(1e3,3e4,6e5,2)}assayJob(t){this.input(t)}sameInput(t,e){return t[1]===e[1]&&t[0]===e[0]}fetchAsset([t,e]){return this.rhythmicityService.getJob(t,e)}hasFailed(t){return p.e.hasFailed(t)}isFinished(t){return p.e.isFinished(t)}isRunning(t){return p.e.isRunning(t)}assetToId(t){return t.jobId}assetToInput(t){return[t.parentId,t.jobId]}}return t.\u0275fac=function(e){return new(e||t)(n.Xb(c.a),n.Xb(f.a,8))},t.\u0275prov=n.Jb({token:t,factory:t.\u0275fac}),t})();var y=i("M9IT"),T=i("vkgz"),v=i("8jiw");let D=(()=>{class t extends v.a{constructor(t,e=!1){super(e),this.rhythmicityService=t,this.results$=this.data$}isClassicJob(){var t,e;return"BD2JTK"===(null===(e=null===(t=this.currentInput)||void 0===t?void 0:t.parameters)||void 0===e?void 0:e.METHOD)}sameInput(t,e){return p.e.sameJob(t,e)}assetToData(t,e){return t.results}fetchAsset(t){return this.rhythmicityService.getResults(t.parentId,t.jobId).pipe(Object(T.a)(t=>this.labelPatterns(t)))}sortingKey(t){switch(t.active){case"label":return t=>t.label;case"id":return t=>+t.id;case"empp":return t=>+t.result.empP;case"emppbh":return t=>+t.result.empPBH;case"p":return t=>+t.result.p;case"pbh":return t=>+t.result.pBH;case"tau":return t=>+t.result.tau;case"period":return t=>t.result.pattern.period;case"peak":return t=>t.result.pattern.peak;case"trough":return t=>t.result.pattern.trough;default:return console.error("Not implemented sorting for "+t.active),t=>0}}processData(t,e){return e?(this.rankResults(t,e.pValue,e.bhCorrection,this.isClassicJob()),t):t}labelPatterns(t){t.results.forEach(t=>{t.result.patternLabel=this.describePattern(t.result),t.result.pattern.shapeLabel=this.patternToShape(t.result.pattern)})}describePattern(t){const e=t.pattern,i=Math.round(10*e.period)/10,r=Math.round(100*e.peak)/100,s=Math.round(100*e.trough)/100;return`${this.patternToShape(e)}\t${i}\t${r}\t${s}`}patternToShape(t){switch(t.waveform){case"ASYM_COSINE":return.5===t.leftPortion?"COS":"ACOS";case"ASYM_COS_SPIKE":return"SPIKE";case"ASYM_COS_SPIKE_NEG":return"NPIKE";default:return t.waveform}}rankResults(t,e,i,r){t.forEach(t=>{const s=t.result;let a;a=r?i?s.pBH:s.p:i?s.empPBH:s.empP,s.rhythmic=a<e})}}return t.\u0275fac=function(e){return new(e||t)(n.Xb(c.a),n.Xb(f.a,8))},t.\u0275prov=n.Jb({token:t,factory:t.\u0275fac}),t})();var B=i("6tuW"),P=i("+0xr"),w=i("Dh3D"),I=i("bv9b");function j(t,e){1&t&&n.Ob(0,"mat-progress-bar",28)}function O(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"Id"),n.Sb())}function C(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(t.id)}}function x(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"Label"),n.Sb())}function k(t,e){if(1&t&&(n.Tb(0,"td",31),n.Dc(1),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(t.label)}}function E(t,e){1&t&&(n.Tb(0,"th",32),n.Dc(1,"Rhythmic"),n.Sb())}function R(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.Sb()),2&t){const t=e.$implicit;n.Fb("bold",t.result.rhythmic),n.Bb(1),n.Ec(t.result.rhythmic)}}function J(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"emp-p"),n.Sb())}function M(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,t.result.empP,"1.0-5"))}}function $(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"BH emp-p"),n.Sb())}function H(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,t.result.empPBH,"1.0-5"))}}function N(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"Tau"),n.Sb())}function F(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,t.result.tau,"1.0-2"))}}function A(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"p"),n.Sb())}function K(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,t.result.p,"1.0-5"))}}function z(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"BH p"),n.Sb())}function L(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,t.result.pBH,"1.0-5"))}}function Q(t,e){1&t&&(n.Tb(0,"th",32),n.Dc(1,"Pattern"),n.Sb())}function _(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(t.result.patternLabel)}}function q(t,e){1&t&&(n.Tb(0,"th",32),n.Dc(1,"P.Shape"),n.Sb())}function Z(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(t.result.pattern.shapeLabel)}}function U(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"P.Period"),n.Sb())}function G(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,t.result.pattern.period,"1.0-1"))}}function V(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"P.Peak"),n.Sb())}function X(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,t.result.pattern.peak,"1.1-1"))}}function Y(t,e){1&t&&(n.Tb(0,"th",32),n.Dc(1,"P.Peak"),n.Sb())}function W(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,24*t.result.pattern.peak/t.result.pattern.period,"1.1-1"))}}function tt(t,e){1&t&&(n.Tb(0,"th",29),n.Dc(1,"P.Trough"),n.Sb())}function et(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,t.result.pattern.trough,"1.1-1"))}}function it(t,e){1&t&&(n.Tb(0,"th",32),n.Dc(1,"P.Trough"),n.Sb())}function rt(t,e){if(1&t&&(n.Tb(0,"td",30),n.Dc(1),n.ec(2,"number"),n.Sb()),2&t){const t=e.$implicit;n.Bb(1),n.Ec(n.gc(2,1,24*t.result.pattern.trough/t.result.pattern.period,"1.1-1"))}}function st(t,e){1&t&&n.Ob(0,"tr",33)}function at(t,e){1&t&&n.Ob(0,"tr",34)}const nt=function(){return[10,25,50,100,250]};let ct=(()=>{class t{constructor(t,e){this.fetcher=t,this.feedback=e,this.normEmpPColumns=["id","label","rhythmic","empp","tau"],this.normClsPColumns=["id","label","rhythmic","p","tau"],this.bhEmpPColumns=["id","label","rhythmic","emppbh","tau"],this.bhClsPColumns=["id","label","rhythmic","pbh","tau"],this.patternColumns=["shape","period","peak","trough"],this.patternColumnsC=["shape","period","peakc","troughc"],this.displayedColumns=this.normEmpPColumns,this.disablePaginator=!1}set job(t){t&&this.fetcher.input(t)}set statTestParams(t){if(t){this.fetcher.params(t);let e=t.bhCorrection?this.bhEmpPColumns:this.normEmpPColumns;this.fetcher.isClassicJob()&&(e=t.bhCorrection?this.bhClsPColumns:this.normClsPColumns),t.showPattern&&(e=e.concat(t.circadian?this.patternColumnsC:this.patternColumns)),this.displayedColumns=e}}ngOnInit(){this.fetcher.error$.subscribe(t=>this.feedback.error(t));const t=new y.d;t.pageSize=25,t.pageIndex=0,this.fetcher.page(t),this.fetcher.on(!0)}ngOnDestroy(){this.fetcher.close()}ngAfterViewInit(){}reload(){this.fetcher.refresh()}sortData(t){this.fetcher.sort(t)}loadPage(t){this.fetcher.page(t)}}return t.\u0275fac=function(e){return new(e||t)(n.Nb(D),n.Nb(B.a))},t.\u0275cmp=n.Hb({type:t,selectors:[["bd2-rhythmicity-results-mdtable"]],inputs:{job:"job",statTestParams:"statTestParams"},features:[n.Ab([D])],decls:55,vars:18,consts:[[1,"mat-elevation-z8"],["mode","indeterminate",4,"ngIf"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["paginator",""],["mat-table","","matSort","","aria-label","Results","matSort","","matSortActive","id","matSortDirection","asc",1,"full-width-table",3,"dataSource","matSortChange"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","label"],["mat-cell","","class","word_wrapping","style","max-width: 100px",4,"matCellDef"],["matColumnDef","rhythmic"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"bold",4,"matCellDef"],["matColumnDef","empp"],["matColumnDef","emppbh"],["matColumnDef","tau"],["matColumnDef","p"],["matColumnDef","pbh"],["matColumnDef","pattern"],["matColumnDef","shape"],["matColumnDef","period"],["matColumnDef","peak"],["matColumnDef","peakc"],["matColumnDef","trough"],["matColumnDef","troughc"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["paginator2",""],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"word_wrapping",2,"max-width","100px"],["mat-header-cell",""],["mat-header-row",""],["mat-row",""]],template:function(t,e){1&t&&(n.Tb(0,"div",0),n.Bc(1,j,1,0,"mat-progress-bar",1),n.ec(2,"async"),n.Tb(3,"mat-paginator",2,3),n.Zb("page",(function(t){return e.loadPage(t)})),n.Sb(),n.Tb(5,"table",4),n.Zb("matSortChange",(function(t){return e.sortData(t)})),n.Rb(6,5),n.Bc(7,O,2,0,"th",6),n.Bc(8,C,2,1,"td",7),n.Qb(),n.Rb(9,8),n.Bc(10,x,2,0,"th",6),n.Bc(11,k,2,1,"td",9),n.Qb(),n.Rb(12,10),n.Bc(13,E,2,0,"th",11),n.Bc(14,R,2,3,"td",12),n.Qb(),n.Rb(15,13),n.Bc(16,J,2,0,"th",6),n.Bc(17,M,3,4,"td",7),n.Qb(),n.Rb(18,14),n.Bc(19,$,2,0,"th",6),n.Bc(20,H,3,4,"td",7),n.Qb(),n.Rb(21,15),n.Bc(22,N,2,0,"th",6),n.Bc(23,F,3,4,"td",7),n.Qb(),n.Rb(24,16),n.Bc(25,A,2,0,"th",6),n.Bc(26,K,3,4,"td",7),n.Qb(),n.Rb(27,17),n.Bc(28,z,2,0,"th",6),n.Bc(29,L,3,4,"td",7),n.Qb(),n.Rb(30,18),n.Bc(31,Q,2,0,"th",11),n.Bc(32,_,2,1,"td",7),n.Qb(),n.Rb(33,19),n.Bc(34,q,2,0,"th",11),n.Bc(35,Z,2,1,"td",7),n.Qb(),n.Rb(36,20),n.Bc(37,U,2,0,"th",6),n.Bc(38,G,3,4,"td",7),n.Qb(),n.Rb(39,21),n.Bc(40,V,2,0,"th",6),n.Bc(41,X,3,4,"td",7),n.Qb(),n.Rb(42,22),n.Bc(43,Y,2,0,"th",11),n.Bc(44,W,3,4,"td",7),n.Qb(),n.Rb(45,23),n.Bc(46,tt,2,0,"th",6),n.Bc(47,et,3,4,"td",7),n.Qb(),n.Rb(48,24),n.Bc(49,it,2,0,"th",11),n.Bc(50,rt,3,4,"td",7),n.Qb(),n.Bc(51,st,1,0,"tr",25),n.Bc(52,at,1,0,"tr",26),n.Sb(),n.Tb(53,"mat-paginator",2,27),n.Zb("page",(function(t){return e.loadPage(t)})),n.Sb(),n.Sb()),2&t&&(n.Bb(1),n.jc("ngIf",n.fc(2,14,e.fetcher.isBusy$)),n.Bb(2),n.jc("length",e.fetcher.dataLength)("disabled",e.disablePaginator)("pageSize",(null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageSize)||25)("pageIndex",null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageIndex)("pageSizeOptions",n.lc(16,nt)),n.Bb(2),n.jc("dataSource",e.fetcher.results$),n.Bb(46),n.jc("matHeaderRowDef",e.displayedColumns),n.Bb(1),n.jc("matRowDefColumns",e.displayedColumns),n.Bb(1),n.jc("length",e.fetcher.dataLength)("disabled",e.disablePaginator)("pageSize",(null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageSize)||25)("pageIndex",null==e.fetcher.currentPage?null:e.fetcher.currentPage.pageIndex)("pageSizeOptions",n.lc(17,nt)))},directives:[r.m,y.a,P.n,w.a,P.c,P.i,P.b,P.k,P.m,I.a,P.h,w.b,P.a,P.j,P.l],pipes:[r.b,r.f],styles:[".full-width-table[_ngcontent-%COMP%] {\n      width: 100%;\n    }"]}),t})();var ot=i("BOp5"),bt=i("9+85"),lt=i("Wp6s"),dt=i("f0Cb"),ht=i("Xa2L"),ut=i("3Pt+"),pt=i("kmnG"),mt=i("QibW");function ft(t,e){if(1&t&&(n.Tb(0,"mat-radio-button",5),n.Dc(1),n.Sb()),2&t){const t=e.$implicit;n.jc("value",t),n.Bb(1),n.Ec(t)}}let gt=(()=>{class t{constructor(){this.values=[1e-4,.001,.005,.01,.05,.1],this.pvalue=.001,this.pvalue$=new n.o}ngOnInit(){}ngAfterViewInit(){this.pvalue$.emit(this.pvalue)}selected(t){this.pvalue$.emit(t.value)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Hb({type:t,selectors:[["bd2-pvalue-form"]],outputs:{pvalue$:"pvalue$"},decls:8,vars:2,consts:[[1,"form-inline"],[1,"mx-auto","text-center"],["id","pvalues-label",1,"mb-1"],["aria-label","Select p-value","aria-labelledby","pvalues-label",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(n.Tb(0,"form",0),n.Tb(1,"div",1),n.Tb(2,"mat-label",2),n.Tb(3,"strong"),n.Dc(4,"p-value threshold:"),n.Sb(),n.Sb(),n.Tb(5,"div"),n.Tb(6,"mat-radio-group",3),n.Zb("change",(function(t){return e.selected(t)})),n.Bc(7,ft,2,2,"mat-radio-button",4),n.Sb(),n.Sb(),n.Sb(),n.Sb()),2&t&&(n.Bb(6),n.jc("value",e.pvalue),n.Bb(1),n.jc("ngForOf",e.values))},directives:[ut.D,ut.r,ut.s,pt.g,mt.b,r.l,mt.a],styles:[".mat-radio-button[_ngcontent-%COMP%]  {\n      margin-right: 15px;\n    }"]}),t})();var St=i("1jcm");let yt=(()=>{class t{constructor(){this.options=new n.o,this.currentOptions=new p.h(0,!1,!1,!1)}ngOnInit(){}pValue(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.pValue=t,this.options.next(this.currentOptions)}bhCorrection(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.bhCorrection=t,this.options.next(this.currentOptions)}circadian(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.circadian=t,this.options.next(this.currentOptions)}showPattern(t){this.currentOptions=this.currentOptions.clone(),this.currentOptions.showPattern=t,this.options.next(this.currentOptions)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Hb({type:t,selectors:[["bd2-stat-test-options-widget"]],outputs:{options:"options"},decls:14,vars:1,consts:[[3,"pvalue$"],[2,"margin-top","0.5em","text-align","center"],[3,"change"],["pattern",""],[3,"disabled","change"]],template:function(t,e){if(1&t&&(n.Tb(0,"mat-card"),n.Tb(1,"mat-card-content"),n.Tb(2,"section"),n.Tb(3,"bd2-pvalue-form",0),n.Zb("pvalue$",(function(t){return e.pValue(t)})),n.Sb(),n.Sb(),n.Tb(4,"section",1),n.Tb(5,"mat-slide-toggle",2),n.Zb("change",(function(t){return e.bhCorrection(t.checked)})),n.Dc(6,"Benjamini Hochberg correction"),n.Sb(),n.Sb(),n.Tb(7,"section",1),n.Tb(8,"mat-slide-toggle",2,3),n.Zb("change",(function(t){return e.showPattern(t.checked)})),n.Dc(10,"show pattern"),n.Sb(),n.Dc(11," \xa0 "),n.Tb(12,"mat-slide-toggle",4),n.Zb("change",(function(t){return e.circadian(t.checked)})),n.Dc(13,"circadian unit"),n.Sb(),n.Sb(),n.Sb(),n.Sb()),2&t){const t=n.qc(9);n.Bb(12),n.jc("disabled",!t.checked)}},directives:[lt.a,lt.c,gt,St.a],encapsulation:2}),t})();function Tt(t,e){if(1&t){const t=n.Ub();n.Tb(0,"div",5),n.Tb(1,"button",13),n.Zb("click",(function(){return n.sc(t),n.dc(2).delete()})),n.Tb(2,"i",4),n.Dc(3,"delete_forever"),n.Sb(),n.Sb(),n.Tb(4,"button",14),n.Zb("click",(function(){return n.sc(t),n.dc(2).export()})),n.Tb(5,"i",4),n.Dc(6,"save_alt"),n.Sb(),n.Sb(),n.Sb()}}function vt(t,e){if(1&t&&(n.Tb(0,"div",15),n.Ob(1,"br"),n.Dc(2),n.Sb()),2&t){const t=n.dc().ngIf;n.Bb(2),n.Fc("ERROR: ",t.jobStatus.message," ")}}function Dt(t,e){1&t&&(n.Tb(0,"div"),n.Tb(1,"mat-card"),n.Tb(2,"mat-card-content"),n.Ob(3,"mat-spinner",16),n.Sb(),n.Sb(),n.Sb())}function Bt(t,e){1&t&&(n.Tb(0,"div"),n.Tb(1,"mat-card"),n.Tb(2,"mat-card-content"),n.Tb(3,"div",17),n.Dc(4,"It may take up to 10 minutes to test for rhythmicity"),n.Sb(),n.Sb(),n.Sb(),n.Sb())}function Pt(t,e){if(1&t){const t=n.Ub();n.Rb(0),n.Tb(1,"bd2-stat-test-options-widget",18),n.Zb("options",(function(e){return n.sc(t),n.dc(3).statTestOptions(e)})),n.Sb(),n.Ob(2,"bd2-rhythmicity-results-mdtable",19),n.Qb()}if(2&t){const t=e.ngIf,i=n.dc(3);n.Bb(2),n.jc("statTestParams",i.statTestParams)("job",t)}}function wt(t,e){if(1&t&&(n.Tb(0,"div"),n.Ob(1,"mat-divider"),n.Bc(2,Dt,4,0,"div",12),n.ec(3,"async"),n.Bc(4,Bt,5,0,"div",12),n.Bc(5,Pt,3,2,"ng-container",12),n.ec(6,"async"),n.Sb()),2&t){const t=n.dc().ngIf,e=n.dc();n.Bb(2),n.jc("ngIf",n.fc(3,3,e.rhythmicityJobDatasource.isReloading$)),n.Bb(2),n.jc("ngIf","SUBMITTED"===t.jobStatus.state),n.Bb(1),n.jc("ngIf",n.fc(6,5,e.rhythmicityJobDatasource.finishedJob$))}}function It(t,e){if(1&t){const t=n.Ub();n.Tb(0,"div",1),n.Tb(1,"div",2),n.Tb(2,"div",3),n.Zb("click",(function(){return n.sc(t),n.dc().toggleExpanded()})),n.Tb(3,"i",4),n.Dc(4,"waves"),n.Sb(),n.Dc(5),n.ec(6,"date"),n.Ob(7,"br"),n.Dc(8),n.Sb(),n.Tb(9,"div",5),n.Dc(10),n.Tb(11,"a",6),n.Zb("click",(function(){return n.sc(t),n.dc().refresh()})),n.Tb(12,"i",7),n.Dc(13,"refresh"),n.Sb(),n.Sb(),n.Sb(),n.Sb(),n.Tb(14,"div",8),n.Tb(15,"mat-card"),n.Tb(16,"mat-card-content"),n.Tb(17,"div",9),n.Bc(18,Tt,7,0,"div",10),n.Dc(19),n.Bc(20,vt,3,1,"div",11),n.Sb(),n.Sb(),n.Sb(),n.Bc(21,wt,7,7,"div",12),n.Sb(),n.Sb()}if(2&t){const t=e.ngIf,i=n.dc();n.Bb(3),n.yc("color",i.isExpanded?"green":"red")("font-size",150,"%"),n.Bb(2),n.Gc(" \xa0",i.shortUUID(t.jobId)," (",n.fc(6,13,i.toLocalDateTime(t.jobStatus.submitted)),") "),n.Bb(3),n.Gc(" ",i.friendlyMethod(t.parameters.METHOD),"; \xa0 waveforms: ",t.parameters.PRESET," "),n.Bb(2),n.Fc(" ",t.jobStatus.state," "),n.Bb(8),n.jc("ngIf",i.assay.security.canWrite),n.Bb(1),n.Fc(" ",t.parameters.PARAMS_SUMMARY," "),n.Bb(1),n.jc("ngIf",t.jobStatus.message&&"OK"!=t.jobStatus.message),n.Bb(1),n.jc("ngIf",i.isExpanded)}}let jt=(()=>{class t{constructor(t,e,i,r){this.rhythmicityService=t,this.rhythmicityJobDatasource=e,this.feedback=i,this.dialogs=r,this.deleted=new n.o,this.isExpanded=!1,this.expandedToogleStream=new l.a(!1)}set expanded(t){this.isExpanded=t,this.expandedToogleStream.next(t)}ngOnInit(){this.initSubscriptions()}ngOnDestroy(){this.rhythmicityJobDatasource.close(),this.expandedToogleStream&&this.expandedToogleStream.complete()}ngOnChanges(t){(t.jobId||t.assay)&&this.jobId&&this.assay&&this.rhythmicityJobDatasource.assayJob([this.assay.id,this.jobId])}statTestOptions(t){const e=Object(d.a)(1).subscribe(()=>{this.statTestParams=t,e&&e.unsubscribe()})}export(){this.rhythmicityService.downloadJob(this.assay.id,this.jobId).subscribe(t=>{this.saveJobBlob(t,this.assay.id,this.jobId)},t=>this.feedback.error(t))}saveJobBlob(t,e,i){u.saveAs(t,e+"_job"+this.shortUUID(i)+".rhythmicity.csv")}refresh(){this.rhythmicityJobDatasource.refresh(),this.resultsTable&&this.resultsTable.reload()}delete(){const t=this.assay,e=this.rhythmicityJobDatasource.currentJob;this.dialogs.confirm("Do you want to delete analysis: "+e.jobId,e.parameters.PARAMS_SUMMARY).subscribe(i=>{i&&this.doDelete(t,e.jobId)})}initSubscriptions(){this.rhythmicityJobDatasource.on(!0),this.rhythmicityJobDatasource.error$.forEach(t=>this.feedback.error(t))}doDelete(t,e){this.rhythmicityService.deleteJob(t,e).subscribe(t=>{this.deleted.next(t),this.feedback.success("Job: "+this.shortUUID(e)+" deleted")},t=>{this.feedback.error(t)})}toggleExpanded(){this.expanded=!this.isExpanded}toLocalDateTime(t){return h.b.deserialize(t).date}shortUUID(t){return Object(ot.c)(t)}friendlyMethod(t){return"BD2JTK"===t?"Classic JTK":"BD2EJTK"===t?"BD2 eJTK":t}}return t.\u0275fac=function(e){return new(e||t)(n.Nb(c.a),n.Nb(S),n.Nb(B.a),n.Nb(bt.a))},t.\u0275cmp=n.Hb({type:t,selectors:[["bd2-rhythmicity-job-pane"]],viewQuery:function(t,e){var i;1&t&&n.Ic(ct,!0),2&t&&n.pc(i=n.ac())&&(e.resultsTable=i.first)},inputs:{jobId:"jobId",assay:"assay",expanded:"expanded"},outputs:{deleted:"deleted"},features:[n.Ab([S]),n.zb],decls:2,vars:3,consts:[["class","card mb-2",4,"ngIf"],[1,"card","mb-2"],[1,"card-header","clearfix"],["role","button",1,"float-left",3,"click"],[1,"material-icons","bd-icon"],[1,"float-right"],["role","button","aria-label","refresh",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"card-body"],[1,"clearfix"],["class","float-right",4,"ngIf"],["class","text-danger","style","word-wrap: break-word;",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-danger","btn-sm","mr-1",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"text-danger",2,"word-wrap","break-word"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"],[3,"options"],[3,"statTestParams","job"]],template:function(t,e){1&t&&(n.Bc(0,It,22,15,"div",0),n.ec(1,"async")),2&t&&n.jc("ngIf",n.fc(1,1,e.rhythmicityJobDatasource.allJob$))},directives:[r.m,lt.a,lt.c,dt.a,ht.b,yt,ct],pipes:[r.b,r.e],encapsulation:2}),t})();function Ot(t,e){if(1&t&&(n.Tb(0,"div"),n.Tb(1,"strong"),n.Dc(2),n.Sb(),n.Sb()),2&t){const t=n.dc(2);n.Bb(2),n.Fc("Submitted jobs: ",t.jobs.length,"")}}function Ct(t,e){1&t&&(n.Tb(0,"div"),n.Dc(1," No jobs submitted, start a new test. "),n.Sb())}const xt=function(){return["new"]};function kt(t,e){1&t&&(n.Tb(0,"a",7),n.Dc(1," New test "),n.Sb()),2&t&&n.jc("routerLink",n.lc(1,xt))}function Et(t,e){if(1&t){const t=n.Ub();n.Tb(0,"div"),n.Tb(1,"bd2-rhythmicity-job-pane",8),n.Zb("deleted",(function(e){return n.sc(t),n.dc(2).remove(e)}))("finished",(function(e){return n.sc(t),n.dc(2).refreshJob(e)})),n.Sb(),n.Sb()}if(2&t){const t=e.$implicit,i=e.index,r=n.dc(2);n.Bb(1),n.jc("assay",r.assay)("jobId",t)("expanded",r.expandAll||0==i)}}function Rt(t,e){if(1&t){const t=n.Ub();n.Tb(0,"div"),n.Tb(1,"h3"),n.Dc(2,"Rhythmicity tests"),n.Sb(),n.Ob(3,"hr"),n.Tb(4,"div",1),n.Tb(5,"div",2),n.Bc(6,Ot,3,1,"div",0),n.Bc(7,Ct,2,0,"div",0),n.Sb(),n.Tb(8,"div",3),n.Bc(9,kt,2,2,"a",4),n.Tb(10,"button",5),n.Zb("click",(function(){return n.sc(t),n.dc().refresh()})),n.Dc(11,"Refresh "),n.Sb(),n.Sb(),n.Sb(),n.Ob(12,"hr"),n.Bc(13,Et,2,3,"div",6),n.Ob(14,"hr"),n.Sb()}if(2&t){const t=n.dc();n.Bb(6),n.jc("ngIf",t.jobs&&t.jobs.length>0),n.Bb(1),n.jc("ngIf",!t.jobs||0==t.jobs.length),n.Bb(2),n.jc("ngIf",t.assay.security.canWrite),n.Bb(1),n.jc("disabled",t.blocked),n.Bb(3),n.jc("ngForOf",t.jobsIds)}}let Jt=(()=>{class t extends b{constructor(t,e){super(t,e),this.expandAll=!1,this.blocked=!1,this.titlePart=" Rhythm"}updateModel(t){super.updateModel(t),t&&this.loadJobs(t)}loadJobs(t,e=!1){this.blocked=!0,this.rhythmicityService.getJobs(t).subscribe(i=>{this.jobs=i,this.refreshJobsInfo(i),this.exportURL=this.rhythmicityService.exportURL(t),e&&this.refreshPanes(),this.blocked=!1},t=>{this.blocked=!1,this.feedback.error(t)})}refreshJobsInfo(t){this.jobsIds=t.map(t=>t.jobId)}refresh(){this.loadJobs(this.assay,!0)}refreshPanes(){this.panes&&this.panes.forEach(t=>t.refresh())}remove(t){const e=this.jobs.findIndex(e=>t.jobId===e.jobId);e>=0&&(this.jobs.splice(e,1),this.refreshJobsInfo(this.jobs))}refreshJob(t){const e=this.jobs.findIndex(e=>t.jobId===e.jobId);e>=0&&(this.jobs[e]=t,this.refreshJobsInfo(this.jobs))}calculateQueuing(t){return t.filter(t=>this.isQueueing(t.jobStatus.state)).length}isQueueing(t){switch(t){case"WAITING":case"PROCESSING":case"SUBMITTED":return!0;default:return!1}}checkFinished(t){return!!t.find(t=>this.isFinished(t.jobStatus.state))}isFinished(t){switch(t){case"SUCCESS":case"FINISHED":case"COMPLETED":return!0;default:return!1}}}return t.\u0275fac=function(e){return new(e||t)(n.Nb(c.a),n.Nb(o.a))},t.\u0275cmp=n.Hb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){var i;1&t&&n.Ic(jt,!0),2&t&&n.pc(i=n.ac())&&(e.panes=i)},features:[n.yb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-body"],["class","btn btn-primary mr-1",3,"routerLink",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","click"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary","mr-1",3,"routerLink"],[3,"assay","jobId","expanded","deleted","finished"]],template:function(t,e){1&t&&n.Bc(0,Rt,15,5,"div",0),2&t&&n.jc("ngIf",e.assay)},directives:[r.m,r.l,s.e,jt],encapsulation:2}),t})();var Mt=i("QBpm"),$t=i("Kj3r"),Ht=i("bngM"),Nt=i("ZMwR"),Ft=i("naqj"),At=i("Tl2h"),Kt=i("wcxA");function zt(t,e){if(1&t&&(n.Tb(0,"option",29),n.Dc(1),n.Sb()),2&t){const t=e.$implicit;n.jc("value",t.name),n.Bb(1),n.Ec(t.label)}}function Lt(t,e){1&t&&(n.Tb(0,"div",30),n.Tb(1,"div",31),n.Dc(2," Rhythmicity tests are generally used for short, sparse timeseries. "),n.Ob(3,"br"),n.Dc(4," The current limit is 5 or 4 days of hourly sampled data for eJTK preset and BD2 preset respectivelly."),n.Ob(5,"br"),n.Dc(6," Generally the raw data are being analysed, but we also enabled a linear detrended option. "),n.Sb(),n.Sb())}function Qt(t,e){if(1&t&&(n.Tb(0,"option",29),n.Dc(1),n.Sb()),2&t){const t=e.$implicit;n.jc("value",t.name),n.Bb(1),n.Ec(t.label)}}function _t(t,e){1&t&&(n.Tb(0,"div",30),n.Tb(1,"div",31),n.Tb(2,"p"),n.Tb(3,"b"),n.Dc(4,"Classic JTK"),n.Sb(),n.Dc(5," is the implementation of JTK_CYCLE from "),n.Tb(6,"a",32),n.Dc(7,"Michael E. Hughes et al. 2010"),n.Sb(),n.Dc(8," a standard method for detecting rhythmicity in genome-scale datasets. "),n.Ob(9,"br"),n.Dc(10,"The method is fast but it is reliable only when it tests against small set of patterns, we provide patterns of 24h cosines with different phases."),n.Sb(),n.Tb(11,"p"),n.Tb(12,"b"),n.Dc(13,"BD2 eJTK"),n.Sb(),n.Dc(14," is the BioDare2 implementation of Empirical JTK_CYCLE with asymmetry search from "),n.Tb(15,"a",33),n.Dc(16,"Alan L. Hutchison et al. 2015"),n.Sb(),n.Dc(17,". It is similar to the classic JTK method but with p values empirically calculated against set of random noise data. "),n.Ob(18,"br"),n.Dc(19,"This modification permits using larger sets of test patterns and it provides better accuracy. However, this method is much slower so it can only analyze timeseries only up to 5 days of data (though the Classic JTK method was never intended to be used with such a long data)."),n.Sb(),n.Sb(),n.Sb())}function qt(t,e){if(1&t&&(n.Tb(0,"option",29),n.Dc(1),n.Sb()),2&t){const t=e.$implicit;n.jc("value",t.name),n.Bb(1),n.Ec(t.label)}}function Zt(t,e){1&t&&(n.Tb(0,"div",30),n.Tb(1,"div",31),n.Dc(2," Presets determine set of pattern curves against the comparison test is run."),n.Ob(3,"br"),n.Tb(4,"ul"),n.Tb(5,"li"),n.Dc(6,"Cosine 24h 1/2/4h are set of cosine curves of 24h periods, and phases spread every 1, 2, or 4 hours. To be used mainly with Classic JTK."),n.Sb(),n.Tb(7,"li"),n.Dc(8,"eJTK Classic is recommended for typical omics-like data for which eJTK method was developed. "),n.Ob(9,"br"),n.Dc(10," It works well for short data (48h, 2h- 1h-sampled) when actual period is within range 22-26 hours."),n.Ob(11,"br"),n.Dc(12," The patterns are series of cosine-like waveforms with 24h period, phases by 2hours and range of asymmetries by 2h (see original paper)."),n.Ob(13,"br"),n.Sb(),n.Tb(14,"li"),n.Dc(15,"BD2 Classic can detect non 24 periods and some forms of the spikes."),n.Ob(16,"br"),n.Dc(17," As it compares against much more patterns it has a weaker power."),n.Ob(18,"br"),n.Dc(19," It should be used when there is a good reason to suspect periods outside 22-26h range."),n.Ob(20,"br"),n.Dc(21," The patterns are series of cosine-like waverforms with periods from 18-35hours, for each period there are multiple "),n.Tb(22,"b"),n.Dc(23,"circadian"),n.Sb(),n.Dc(24," phases with step 2h (so each period value generates the same number of patterns but the peaks in absolute units do not coincide) and a range of assymetries by 2h in circadian units (see original paper). The preset contains also additional some spike patterns. "),n.Sb(),n.Sb(),n.Sb(),n.Sb())}const Ut=function(){return[10,25,50,100,200]};let Gt=(()=>{class t extends Kt.a{constructor(t){super(t),this.methodOptions=p.d,this.presetOptions=p.b,this.dataHelp=!1,this.presetsHelp=!1,this.methodHelp=!1,this.rhythmicityRequests=new n.o,this.detrendingOptions=[At.b.NO_DTR,At.b.LIN_DTR],this.methodForm=this.mainForm.get("method"),this.presetForm=this.mainForm.get("preset")}buildMainForm(){return this.fb.group({displayParams:this.displayParamsForm,periodScale:this.fb.group({periodMin:[18,[ut.B.required]],periodMax:[34,[ut.B.required]]},{validator:t=>this.validPeriodScale(t.value)}),method:[p.f.BD2EJTK.name,[ut.B.required]],preset:[p.a.EJTK_CLASSIC.name,[ut.B.required]]})}ngOnInit(){super.ngOnInit(),this.methodForm.valueChanges.subscribe(t=>this.setPresetOptions(t))}ngOnDestroy(){super.ngOnDestroy()}setPresetOptions(t){t===p.f.BD2EJTK.name?(this.presetOptions=p.b,this.presetForm.setValue(p.a.EJTK_CLASSIC.name)):t===p.f.BD2JTK.name?(this.presetOptions=p.c,this.presetForm.setValue(p.a.COS_2H.name)):this.presetOptions=[]}defaultDetrending(){return At.b.NO_DTR.name}validPeriodScale(t){const e=t.periodMin,i=t.periodMax;return e<10?{validPeriodScale:"Period min must >= 10"}:i<10?{validPeriodScale:"Period max must >= 10"}:i>50?{validPeriodScale:"Period max must < 50"}:e>=i?{validPeriodScale:"Period min must be < max"}:null}analyse(){if(this.mainForm.invalid)return;const t=this.map2RhythmicityRequest(this.mainForm.value);t.isValid()&&this.rhythmicityRequests.next(t)}map2RhythmicityRequest(t){const e=new p.g;return e.detrending=At.b.get(t.displayParams.detrending),e.method=p.f.get(t.method),e.preset=p.a.get(t.preset),e.periodMax=t.periodScale.periodMax,e.periodMin=t.periodScale.periodMin,e.windowEnd=t.displayParams.timeScale.timeEnd,e.windowStart=t.displayParams.timeScale.timeStart,e}}return t.\u0275fac=function(e){return new(e||t)(n.Nb(ut.e))},t.\u0275cmp=n.Hb({type:t,selectors:[["bd2-rhythmicityjob-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams",rhythmicityRequests:"rhythmicityRequests"},features:[n.yb],decls:61,vars:15,consts:[["role","form",1,"form-horizontal",3,"formGroup"],["formGroupName","displayParams"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-sm-4"],["for","windowStart",1,"col-sm-1"],[1,"col-sm-2"],["formControlName","timeStart","id","windowStart","min","0","required","","size","5","step","any","type","number",1,"form-control"],["for","windowEnd",1,"col-sm-1"],["formControlName","timeEnd","id","windowEnd","min","0","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"form-group","row"],["for","detrending",1,"col-sm-4"],[3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"col-sm-6"],["formControlName","detrending","id","detrending","required","",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["class","col-sm-12",4,"ngIf"],["for","method",1,"col-sm-4"],["formControlName","method","id","method","required","",1,"form-control"],["formControlName","preset","id","preset","required","",1,"form-control"],["formGroupName","periodScale",1,"form-group","row",3,"hidden"],["for","periodMin",1,"col-sm-1"],["formControlName","periodMin","id","periodMin","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],["for","periodMax",1,"col-sm-1"],["formControlName","periodMax","id","periodMax","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],["type","button",1,"btn","btn-primary",3,"disabled","click"],[3,"value"],[1,"col-sm-12"],["role","alert","type","info",1,"alert","alert-info"],["href","https://dx.doi.org/10.1177%2F0748730410379711"],["href"," https://doi.org/10.1371/journal.pcbi.1004094","target","_blank"]],template:function(t,e){1&t&&(n.Tb(0,"form",0),n.Tb(1,"div",1),n.Tb(2,"div",2),n.Tb(3,"label",3),n.Dc(4,"Data window"),n.Sb(),n.Tb(5,"label",4),n.Dc(6,"from:"),n.Sb(),n.Tb(7,"div",5),n.Ob(8,"input",6),n.Sb(),n.Tb(9,"label",7),n.Dc(10,"to:"),n.Sb(),n.Tb(11,"div",5),n.Ob(12,"input",8),n.Sb(),n.Sb(),n.Tb(13,"div",9),n.Tb(14,"label",10),n.Dc(15,"Input Data "),n.Tb(16,"a",11),n.Zb("click",(function(){return e.dataHelp=!e.dataHelp})),n.Tb(17,"i",12),n.Dc(18,"help"),n.Sb(),n.Sb(),n.Sb(),n.Tb(19,"div",13),n.Tb(20,"select",14),n.Bc(21,zt,2,2,"option",15),n.Sb(),n.Sb(),n.Sb(),n.Sb(),n.Bc(22,Lt,7,0,"div",16),n.Tb(23,"div",9),n.Tb(24,"label",17),n.Dc(25,"Test Method "),n.Tb(26,"a",11),n.Zb("click",(function(){return e.methodHelp=!e.methodHelp})),n.Tb(27,"i",12),n.Dc(28,"help"),n.Sb(),n.Sb(),n.Sb(),n.Tb(29,"div",13),n.Tb(30,"select",18),n.Bc(31,Qt,2,2,"option",15),n.Sb(),n.Sb(),n.Sb(),n.Bc(32,_t,20,0,"div",16),n.Tb(33,"div",9),n.Tb(34,"label",17),n.Dc(35,"Analysis Presets "),n.Tb(36,"a",11),n.Zb("click",(function(){return e.presetsHelp=!e.presetsHelp})),n.Tb(37,"i",12),n.Dc(38,"help"),n.Sb(),n.Sb(),n.Sb(),n.Tb(39,"div",13),n.Tb(40,"select",19),n.Bc(41,qt,2,2,"option",15),n.Sb(),n.Sb(),n.Sb(),n.Bc(42,Zt,25,0,"div",16),n.Tb(43,"div",20),n.Tb(44,"label",3),n.Dc(45,"Expected periods"),n.Sb(),n.Tb(46,"label",21),n.Dc(47,"from:"),n.Sb(),n.Tb(48,"div",5),n.Ob(49,"input",22),n.Sb(),n.Tb(50,"label",23),n.Dc(51,"to:"),n.Sb(),n.Tb(52,"div",5),n.Ob(53,"input",24),n.Sb(),n.Sb(),n.Tb(54,"div",9),n.Ob(55,"label",5),n.Tb(56,"div",25),n.Tb(57,"mat-paginator",26,27),n.Zb("page",(function(t){return e.loadDataPage(t)})),n.Sb(),n.Sb(),n.Sb(),n.Tb(59,"button",28),n.Zb("click",(function(){return e.analyse()})),n.Dc(60,"Test Rhythmicity "),n.Sb(),n.Sb()),2&t&&(n.jc("formGroup",e.mainForm),n.Bb(21),n.jc("ngForOf",e.detrendingOptions),n.Bb(1),n.jc("ngIf",e.dataHelp),n.Bb(9),n.jc("ngForOf",e.methodOptions),n.Bb(1),n.jc("ngIf",e.methodHelp),n.Bb(9),n.jc("ngForOf",e.presetOptions),n.Bb(1),n.jc("ngIf",e.presetsHelp),n.Bb(1),n.jc("hidden",!0),n.Bb(14),n.jc("length",e.totalTraces)("disabled",e.disabledPagination)("pageSize",e.currentPage.pageSize)("pageIndex",e.currentPage.pageIndex)("pageSizeOptions",n.lc(14,Ut)),n.Bb(2),n.jc("disabled",e.disabled||e.mainForm.invalid))},directives:[ut.D,ut.r,ut.i,ut.j,ut.d,ut.v,ut.q,ut.h,ut.z,ut.A,r.l,r.m,y.a,ut.u,ut.C],encapsulation:2}),t})();var Vt=i("nA4b");function Xt(t,e){if(1&t&&n.Ob(0,"bd2-ts-plots",3),2&t){const t=n.dc(3);n.jc("data",t.timeseries)("tracesPerPlot",t.tracesPerPlot)}}function Yt(t,e){if(1&t){const t=n.Ub();n.Tb(0,"div"),n.Tb(1,"bd2-rhythmicityjob-params-rform",1),n.Zb("displayParams",(function(e){return n.sc(t),n.dc(2).emitDisplayParams(e)}))("rhythmicityRequests",(function(e){return n.sc(t),n.dc(2).doAnalysis(e)})),n.Sb(),n.Ob(2,"hr"),n.Bc(3,Xt,1,2,"bd2-ts-plots",2),n.Sb()}if(2&t){const t=n.dc(2);n.Bb(1),n.jc("disabled",t.blocked)("totalTraces",t.totalTraces)("currentPage",t.currentPage),n.Bb(2),n.jc("ngIf",t.timeseries)}}function Wt(t,e){if(1&t&&(n.Tb(0,"div"),n.Tb(1,"h3"),n.Dc(2,"Start rhythmicity test"),n.Sb(),n.Ob(3,"hr"),n.Bc(4,Yt,4,4,"div",0),n.Sb()),2&t){const t=n.dc();n.Bb(4),n.jc("ngIf",!t.disabled)}}const te=[{path:"",children:[{path:"new",component:(()=>{class t extends b{constructor(t,e,i,r,s){super(r,s),this.fetcher=t,this.analytics=e,this.userService=i,this.disabled=!1,this.blocked=!1,this.tracesPerPlot=5,this.totalTraces=0,this.currentPage=Ht.a.firstPage(),this.titlePart=" New Test"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object($t.a)(1e3)).subscribe(t=>{const e=t.data;this.tracesPerPlot=Math.max(5,e.length/20),this.timeseries=e,this.totalTraces=t.totalTraces,this.currentPage=t.currentPage},t=>{console.log("Error in TS subscription: "+t),this.feedback.error(t)})}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}emitDisplayParams(t){this.fetcher.changeDisplayParams(t)}doAnalysis(t){t.isValid()&&(this.blocked=!0,this.rhythmicityService.newTest(this.assay,t).subscribe(e=>{this.feedback.success("Rhythmicity test submitted"),this.analytics.rhythmicityNew(t.method.name,this.assay.id,this.userService.currentUser.login),this.refreshModel(),this.goToRhythmicityHome()},t=>{this.blocked=!1,this.feedback.error(t)}))}updateModel(t){this.fetcher.experiment(t),super.updateModel(t)}}return t.\u0275fac=function(e){return new(e||t)(n.Nb(Mt.a),n.Nb(Nt.a),n.Nb(Ft.a),n.Nb(c.a),n.Nb(o.a))},t.\u0275cmp=n.Hb({type:t,selectors:[["ng-component"]],features:[n.Ab([Mt.a]),n.yb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams","rhythmicityRequests"],[3,"data","tracesPerPlot",4,"ngIf"],[3,"data","tracesPerPlot"]],template:function(t,e){1&t&&n.Bc(0,Wt,5,1,"div",0),2&t&&n.jc("ngIf",e.assay)},directives:[r.m,Gt,Vt.a],encapsulation:2}),t})()},{path:"",component:Jt,pathMatch:"full"}]}];let ee=(()=>{class t{}return t.\u0275mod=n.Lb({type:t}),t.\u0275inj=n.Kb({factory:function(e){return new(e||t)},imports:[[s.f.forChild(te)],s.f]}),t})();var ie=i("wMBR"),re=i("a6j2"),se=i("ZTEM");let ae=(()=>{class t{}return t.\u0275mod=n.Lb({type:t}),t.\u0275inj=n.Kb({factory:function(e){return new(e||t)},imports:[[r.c,ut.k,ut.y,ie.a,re.a,se.a,ee]]}),t})()}}]);