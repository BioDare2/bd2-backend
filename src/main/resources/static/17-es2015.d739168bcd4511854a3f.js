(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{d9Wp:function(t,e,r){"use strict";r.r(e);var a=r("ofXK"),s=r("tyNb"),i=r("yYXI"),o=r("bngM"),n=r("QBpm");class c{constructor(t){this.rows=new Map,this.nextColumn=0,this.sorted=!0,null!=t&&(this.sorted=t)}get width(){return this.nextColumn}get size(){return this.rows.size}append(t,e){this.put(t,e,this.nextColumn)}put(t,e,r){this._put(t,e,r),this.nextColumn=Math.max(this.nextColumn,r+1)}putColumn(t,e,r){t.forEach((t,a)=>{this._put(t,e[a],r)}),this.nextColumn=Math.max(this.nextColumn,r+1)}appendColumn(t,e){this.putColumn(t,e,this.nextColumn)}getValue(t,e){const r=this.rows.get(t);return r?r[e]:void 0}getRow(t){return this.rows.get(t)}forEach(t){this.keys().forEach((e,r)=>{const a={key:e,columns:this.rows.get(e)};t(a,r,this)})}forEachFlat(t){this.keys().forEach((e,r)=>{const a=[e].concat(this.rows.get(e));t(a,r,this)})}keys(){return this.sorted?Array.from(this.rows.keys()).sort((t,e)=>t==e?0:t<e?-1:1):Array.from(this.rows.keys())}_put(t,e,r){let a=this.rows.get(t);a||(a=[],this.rows.set(t,a)),a[r]=e}}class l{constructor(){this.SEP=","}renderCSVTable(t,e,r){const a=this.prepareHeaders(r,e);this.appendDataLabels(a,t);const s=this.prepareDataTable(t);let i=this.mapToString(a,this.SEP);return i+=this.mapToString(s,this.SEP),i}prepareHeaders(t,e){const r=this.prepareExpHeaders(t);return this.appendDataProperties(r,e),r}prepareExpHeaders(t){const e=new c(!1);return e.put("Exp Id:",""+t.id,0),e.put("Exp URL:","https://biodare2.ed.ac.uk/experiment/"+t.id,0),e.put("Exp Name:",t.name,0),t.contributionDesc.authors.forEach((t,r)=>{e.put("Authors:",t.name,r)}),e}appendDataProperties(t,e){t.put("Detrending:",e.detrending.label,0),t.put("Normalization:",e.normalisation,0),t.put("Align:",e.align,0)}appendDataLabels(t,e){e.forEach((e,r)=>{t.put("Label:",e.label,r)})}prepareDataTable(t){const e=new c;return t.forEach(t=>{const r=t.data.map(t=>t.x),a=t.data.map(t=>t.y);e.appendColumn(r,a)}),e}mapToString(t,e){let r="";return t.forEachFlat(t=>{for(let a=0;a<t.length;a++)void 0!==t[a]&&(r+=t[a]),r+=e;r+="\n"}),r}}var d=r("Kj3r"),b=r("Iab2"),p=r("fXoL"),u=r("ZC3s"),m=r("vejM"),h=r("ZMwR"),f=r("GVyA"),g=r("wcxA"),y=r("3Pt+"),P=r("M9IT");function v(t,e){if(1&t&&(p.Wb(0,"option",19),p.Jc(1),p.Vb()),2&t){const t=e.$implicit;p.oc("value",t.name),p.Cb(1),p.Kc(t.label)}}function x(t,e){if(1&t&&(p.Wb(0,"option",19),p.Jc(1),p.Vb()),2&t){const t=e.$implicit;p.oc("value",t.name),p.Cb(1),p.Kc(t.label)}}function V(t,e){if(1&t&&(p.Wb(0,"option",19),p.Jc(1),p.Vb()),2&t){const t=e.$implicit;p.oc("value",t.name),p.Cb(1),p.Kc(t.label)}}const w=function(){return[10,25,50,100,200]};let C=(()=>{class t extends g.a{constructor(t){super(t)}}return t.\u0275fac=function(e){return new(e||t)(p.Qb(y.d))},t.\u0275cmp=p.Kb({type:t,selectors:[["bd2-tsdisplay-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},features:[p.zb],decls:37,vars:10,consts:[["role","form",1,"form-horizontal",3,"formGroup"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-sm-2"],["for","timeStart",1,"col-sm-1"],[1,"col-sm-3"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-6"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-1"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],[3,"value"]],template:function(t,e){1&t&&(p.Wb(0,"form",0),p.Wb(1,"div",1),p.Wb(2,"label",2),p.Jc(3,"Time scale"),p.Vb(),p.Wb(4,"label",3),p.Jc(5,"from:"),p.Vb(),p.Wb(6,"div",4),p.Rb(7,"input",5),p.Vb(),p.Wb(8,"label",6),p.Jc(9,"to:"),p.Vb(),p.Wb(10,"div",4),p.Rb(11,"input",7),p.Vb(),p.Vb(),p.Wb(12,"div",8),p.Wb(13,"label",9),p.Jc(14,"Processing"),p.Vb(),p.Wb(15,"label",9),p.Jc(16,"Detrending"),p.Vb(),p.Wb(17,"div",10),p.Wb(18,"select",11),p.Hc(19,v,2,2,"option",12),p.Vb(),p.Vb(),p.Vb(),p.Wb(20,"div",8),p.Rb(21,"label",2),p.Wb(22,"label",13),p.Jc(23,"Norm."),p.Vb(),p.Wb(24,"div",4),p.Wb(25,"select",14),p.Hc(26,x,2,2,"option",12),p.Vb(),p.Vb(),p.Wb(27,"label",13),p.Jc(28,"Align"),p.Vb(),p.Wb(29,"div",4),p.Wb(30,"select",15),p.Hc(31,V,2,2,"option",12),p.Vb(),p.Vb(),p.Vb(),p.Wb(32,"div",8),p.Rb(33,"label",2),p.Wb(34,"div",16),p.Wb(35,"mat-paginator",17,18),p.ec("page",(function(t){return e.loadDataPage(t)})),p.Vb(),p.Vb(),p.Vb(),p.Vb()),2&t&&(p.oc("formGroup",e.mainForm),p.Cb(19),p.oc("ngForOf",e.detrendingOptions),p.Cb(7),p.oc("ngForOf",e.normalisationOptions),p.Cb(5),p.oc("ngForOf",e.alignOptions),p.Cb(4),p.oc("length",e.totalTraces)("disabled",e.disabledPagination)("pageSize",e.currentPage.pageSize)("pageIndex",e.currentPage.pageIndex)("pageSizeOptions",p.qc(9,w)))},directives:[y.C,y.q,y.h,y.i,y.u,y.c,y.y,y.p,y.g,y.z,a.l,P.a,y.t,y.B],encapsulation:2}),t})();var W=r("nA4b");function S(t,e){if(1&t){const t=p.Xb();p.Wb(0,"div",6),p.Jc(1,"Please complete "),p.Wb(2,"a",7),p.ec("click",(function(e){p.Ac(t);const r=p.ic();return r.goToExpEdit(r.assay.id,"MeasurementSection")})),p.Jc(3,"Measurement details"),p.Vb(),p.Jc(4," to get access to the secondary data "),p.Vb()}}function E(t,e){if(1&t){const t=p.Xb();p.Wb(0,"div",8),p.Wb(1,"h5"),p.Jc(2,"export data "),p.Wb(3,"a",9),p.ec("click",(function(e){return p.Ac(t),p.ic().exportData()})),p.Wb(4,"i",10),p.Jc(5,"save_alt"),p.Vb(),p.Wb(6,"span",11),p.Jc(7,"Download"),p.Vb(),p.Vb(),p.Vb(),p.Vb()}}function T(t,e){if(1&t&&p.Rb(0,"bd2-ts-plots",12),2&t){const t=p.ic();p.oc("tracesPerPlot",t.tracesPerPlot)("data",t.timeseries)}}const D=[{path:"",children:[{path:"view/ts",component:(()=>{class t extends i.a{constructor(t,e,r,a,s){super(s),this.fetcher=t,this.tsdataService=e,this.RDMSocial=r,this.analytics=a,this.timeseries=[],this.totalTraces=0,this.currentPage=o.a.firstPage(),this.tracesPerPlot=5,this.blocked=!1,this.disabledSecondary=!1,this.csvExporter=new l,this.titlePart=" Data"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(d.a)(1e3)).subscribe(t=>{if(!this.assay)return;const e=t.data;this.currentParams=t.params,this.exportURL=this.tsdataService.exportURL(this.assay,t.params),this.timeseries=e,this.tracesPerPlot=Math.max(5,e.length/20),this.totalTraces=t.totalTraces,this.currentPage=t.currentPage,this.analytics.experimentDataViev(this.assay.id)},t=>{console.log("Error in TS subscription: "+t),this.feedback.error(t)})}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}displayChanged(t){this.fetcher.changeDisplayParams(t)}exportData(){const t=this.csvExporter.renderCSVTable(this.timeseries,this.currentParams,this.assay),e=new Blob([t],{type:"text/csv"});b.saveAs(e,this.assay.id+"_data."+this.currentParams.detrending.name+".csv"),this.recordExport()}recordExport(){this.analytics.experimentDataExport(this.assay.id)}updateModel(t){super.updateModel(t),this.RDMSocial.canProceedByMeasurement(t).then(t=>{this.disabledSecondary=!t}),this.fetcher.experiment(t)}}return t.\u0275fac=function(e){return new(e||t)(p.Qb(n.a),p.Qb(u.a),p.Qb(m.a),p.Qb(h.a),p.Qb(f.a))},t.\u0275cmp=p.Kb({type:t,selectors:[["ng-component"]],features:[p.Bb([n.a]),p.zb],decls:12,vars:6,consts:[[3,"disabled","totalTraces","currentPage","displayParams"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","info","role","alert","dismissible","true","dismissOnTimeout","20000",1,"alert","alert-info"],["class","float-right",4,"ngIf"],[1,"clearfix"],[3,"tracesPerPlot","data",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],[3,"click"],[1,"float-right"],["download","","role","button","aria-label","download",1,"btn","btn-primary",3,"click"],[1,"material-icons","bd-icon"],[1,"cdk-visually-hidden"],[3,"tracesPerPlot","data"]],template:function(t,e){1&t&&(p.Wb(0,"h3"),p.Jc(1,"Show timeseries"),p.Vb(),p.Rb(2,"hr"),p.Wb(3,"bd2-tsdisplay-params-rform",0),p.ec("displayParams",(function(t){return e.displayChanged(t)})),p.Vb(),p.Hc(4,S,5,0,"div",1),p.Rb(5,"hr"),p.Wb(6,"div",2),p.Jc(7," Hint: You can click on trace label box to remove it from the plot. "),p.Vb(),p.Hc(8,E,8,0,"div",3),p.Rb(9,"div",4),p.Rb(10,"hr"),p.Hc(11,T,1,2,"bd2-ts-plots",5)),2&t&&(p.Cb(3),p.oc("disabled",e.disabledSecondary)("totalTraces",e.totalTraces)("currentPage",e.currentPage),p.Cb(1),p.oc("ngIf",e.disabledSecondary),p.Cb(4),p.oc("ngIf",e.timeseries&&e.exportURL),p.Cb(3),p.oc("ngIf",e.timeseries))},directives:[C,a.m,W.a],encapsulation:2}),t})()},{path:"ts-old-import",loadChildren:()=>Promise.all([r.e(0),r.e(16)]).then(r.bind(null,"9Gw/")).then(t=>t.TsOldImportModule)},{path:"ts-import",loadChildren:()=>Promise.all([r.e(0),r.e(18)]).then(r.bind(null,"yPAH")).then(t=>t.TsImportModule)}]}];let J=(()=>{class t{}return t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({factory:function(e){return new(e||t)},imports:[[s.f.forChild(D)],s.f]}),t})();var M=r("YiFe"),O=r("a6j2"),k=r("ZTEM");r.d(e,"TsDataModule",(function(){return I}));let I=(()=>{class t{}return t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({factory:function(e){return new(e||t)},imports:[[a.c,y.j,y.x,M.a,O.a,J,k.a]]}),t})()}}]);