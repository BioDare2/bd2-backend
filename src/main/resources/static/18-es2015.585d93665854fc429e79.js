(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{yPAH:function(e,t,i){"use strict";i.r(t);var s=i("ofXK"),o=i("3Pt+"),a=i("tyNb"),l=i("EvUs"),r=i("yYXI"),n=i("fXoL"),c=i("UsWK"),b=i("GVyA"),m=i("KhIM"),d=i("2Vo4"),u=i("XNiG"),h=i("itXk"),p=i("pLZG"),f=i("/uUt"),g=i("eIep"),w=i("Cfvw"),C=i("5+tZ"),S=i("lJxs"),D=i("M9IT");class v{constructor(e=new D.d,t=new D.d){this.rowPage=e,this.colPage=t}static firstPage(){const e=new v;return e.rowPage.pageIndex=0,e.rowPage.pageSize=50,e.colPage.pageIndex=0,e.colPage.pageSize=50,e}static pageEquals(e,t){return e.pageIndex===t.pageIndex&&e.pageSize===t.pageSize}equals(e){return!!e&&v.pageEquals(this.rowPage,e.rowPage)&&v.pageEquals(this.colPage,e.colPage)}}let k=(()=>{class e{constructor(e){this.BD2REST=e}uploadFile(e){const t=new FormData;return t.append("file",e,e.name),this.BD2REST.fileUpload(t).then(e=>e.id)}}return e.\u0275fac=function(t){return new(t||e)(n.ac(c.a))},e.\u0275prov=n.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),L=(()=>{class e{constructor(e,t){this.uploadService=e,this.BD2REST=t}uploadFile(e,t){return Object(w.a)(this.uploadService.uploadFile(e)).pipe(Object(C.a)(e=>this.verifyFormat(t,e).pipe(Object(S.a)(t=>e))))}verifyFormat(e,t){return this.BD2REST.fileViewVerifyFormat(e,t)}getTableSlice(e,t,i){return this.BD2REST.fileViewTableSlice(e,t,i)}previewLabels(e,t,i,s){const o=new v;return s?(o.rowPage.pageSize=500,o.rowPage.pageIndex=0,o.colPage.pageSize=1,o.colPage.pageIndex=i.colIx):(o.rowPage.pageSize=1,o.rowPage.pageIndex=i.rowIx,o.colPage.pageSize=500,o.colPage.pageIndex=0),this.getTableSlice(e,t,o).pipe(Object(S.a)(e=>{const t=[];return e.data.forEach(e=>e.forEach(e=>t.push(""+e))),t}))}}return e.\u0275fac=function(t){return new(t||e)(n.ac(k),n.ac(c.a))},e.\u0275prov=n.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),W=(()=>{class e{constructor(e){this.tsFileService=e,this.tableSlice$=new d.a(void 0),this.slice$=new d.a(void 0),this.fileIdFormat$=new d.a(void 0),this.error$=new u.a,this.dataSlice$=this.tableSlice$.asObservable().pipe(Object(p.a)(e=>null!=e&&void 0!==e)),this.initDataStream()}close(){this.slice$.complete(),this.fileIdFormat$.complete(),this.tableSlice$.complete(),this.error$.complete()}slice(e){e&&this.slice$.next(e)}fileIdFormat(e){e&&e[0]&&e[1]&&this.fileIdFormat$.next(e)}sameParams([[e,t],i],[[s,o],a]){return e==s&&t==o&&i.equals(a)}initDataStream(){Object(h.a)([this.fileIdFormat$,this.slice$]).pipe(Object(p.a)(([e,t])=>e&&!!t),Object(f.a)(this.sameParams)).pipe(Object(g.a)(([e,t])=>this.tsFileService.getTableSlice(e[0],e[1],t))).subscribe(e=>this.tableSlice$.next(e),e=>this.error$.next(e))}}return e.\u0275fac=function(t){return new(t||e)(n.ac(L))},e.\u0275prov=n.Mb({token:e,factory:e.\u0275fac}),e})();var R=i("6tuW"),I=i("xHqg"),V=i("Wp6s"),N=i("kmnG"),y=i("d3UM"),T=i("vLYz"),x=i("FKr1");function B(e,t){if(1&e&&(n.Wb(0,"mat-option",9),n.Jc(1),n.Vb()),2&e){const e=t.$implicit;n.oc("value",e),n.Cb(1),n.Kc(e.label)}}function O(e,t){1&e&&(n.Wb(0,"div",10),n.Jc(1," An Excel file in which one column contains time values while other columns contain measurements taken at the corresponding times. "),n.Wb(2,"ul"),n.Wb(3,"li"),n.Jc(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes from start, seconds from start, or as image nr (1-based) which will be converted to time using interval between images. "),n.Vb(),n.Wb(5,"li"),n.Jc(6," Not all columns have to be imported. "),n.Vb(),n.Wb(7,"li"),n.Jc(8," First few rows can contain arbitrary text. "),n.Vb(),n.Wb(9,"li"),n.Jc(10," Values from one row can be used as data labels. "),n.Vb(),n.Vb(),n.Vb())}function H(e,t){1&e&&(n.Wb(0,"div",10),n.Jc(1," A coma or tab separeted file in which one column or row contains time values while other columns or rows contain measurements taken at the corresponding times. "),n.Wb(2,"ul"),n.Wb(3,"li"),n.Jc(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes or seconds from start, or as image numbers "),n.Vb(),n.Wb(5,"li"),n.Jc(6," Not all columns/rows have to be imported. "),n.Vb(),n.Wb(7,"li"),n.Jc(8," First few rows/columns can contain arbitrary text. "),n.Vb(),n.Wb(9,"li"),n.Jc(10," Values from one row/column can be used as data labels. "),n.Vb(),n.Vb(),n.Vb())}function F(e,t){1&e&&(n.Wb(0,"div",10),n.Jc(1," Topcount data can be uploaded in two forms: "),n.Wb(2,"ul"),n.Wb(3,"li"),n.Jc(4,"Individual file which contains concatenated topcount data blocks in one file"),n.Vb(),n.Wb(5,"li"),n.Jc(6,"Zip file which contains packed files from individual topcount reads"),n.Vb(),n.Vb(),n.Jc(7,' Check the Dosc section for details about suported data layouts inside tomcats file, we can currently read ASCI content with "plate map" or "column" layouts. '),n.Vb())}function J(e,t){if(1&e&&(n.Wb(0,"div",11),n.Jc(1),n.Vb()),2&e){const e=n.ic();n.Cb(1),n.Lc(" ",e.formatWarning," ")}}let P=(()=>{class e{constructor(){this.blocked=!1,this.uploadFiles=new n.o,this.importFormatOptions=l.f,this.importFormat=l.e.EXCEL_TABLE}ngOnInit(){}upload(e){this.uploadFiles.next({files:e,importFormat:this.importFormat})}formatChanged(e){this.lastFiles&&this.checkFormat(this.lastFiles)}checkFormat(e){this.lastFiles=e,this.formatWarning=void 0,e.forEach(e=>{if(this.importFormat===l.e.TOPCOUNT){const t=this.isTopCount(e);t&&(this.formatWarning="The selected file does not seem to be a topcount file/archive but rather: "+t+". If you sure it is a valid topcount file/archive you can continue upload.")}else if(this.importFormat===l.e.EXCEL_TABLE){const t=this.isExcel(e);t&&(this.formatWarning="The selected file does not seem to be an excel file but rather: "+t+". If you sure it is a valid excel file you can continue upload.")}else if(this.importFormat===l.e.TAB_SEP){const t=this.isTab(e);t&&(this.formatWarning="The selected file does not seem to be a tab-separated file but rather: "+t+". If you sure it is a valid tsv file you can continue upload.")}else if(this.importFormat===l.e.COMA_SEP){const t=this.isComa(e);t&&(this.formatWarning="The selected file does not seem to be a coma-separated file but rather: "+t+". If you sure it is a valid csv file you can continue upload.")}})}isTopCount(e){let t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")?"Excel":e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".tsv")?"tab separated":null):"Unknown"}isExcel(e){const t=e.type;return t&&e.name?e.name.endsWith(".csv")?"CSV":e.name.endsWith(".txt")?"text":e.name.endsWith(".tsv")?"tab separated":t.indexOf("excel")>=0?null:t.indexOf("sheet")>=0?null:t:"Unknown"}isTab(e){let t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")?"Excel":e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".tsv")?null:"Unrecognized"):"Unknown"}isComa(e){let t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".tsv")?"tab separated":e.name.endsWith(".xls")?"Excel":e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".csv")?null:"Unrecognized"):"Unknown"}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-upload-data-file-step"]],outputs:{uploadFiles:"uploadFiles"},decls:19,vars:9,consts:[[1,"mat-elevation-z4"],[1,""],[1,"form-group"],["required","",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["dismissible","true","style","font-size: smaller;","type","info","class","alert alert-info","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"autoReset","blocked","multiple","selectedFiles","uploadFiles"],["uploadWidget",""],[3,"value"],["dismissible","true","type","info","role","alert",1,"alert","alert-info",2,"font-size","smaller"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(e,t){1&e&&(n.Wb(0,"div"),n.Wb(1,"mat-card",0),n.Wb(2,"mat-card-title"),n.Jc(3,"Time series file"),n.Vb(),n.Wb(4,"mat-card-content"),n.Wb(5,"form",1),n.Wb(6,"div",2),n.Wb(7,"mat-form-field"),n.Wb(8,"mat-label"),n.Jc(9,"File Format"),n.Vb(),n.Wb(10,"mat-select",3),n.ec("valueChange",(function(e){return t.importFormat=e}))("selectionChange",(function(e){return t.formatChanged(e)})),n.Hc(11,B,2,2,"mat-option",4),n.Vb(),n.Vb(),n.Vb(),n.Hc(12,O,11,0,"div",5),n.Hc(13,H,11,0,"div",5),n.Hc(14,F,8,0,"div",5),n.Hc(15,J,2,1,"div",6),n.Wb(16,"div",2),n.Wb(17,"bd2-file-upload-widget",7,8),n.ec("selectedFiles",(function(e){return t.checkFormat(e)}))("uploadFiles",(function(e){return t.upload(e)})),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Vb()),2&e&&(n.Cb(10),n.oc("value",t.importFormat),n.Cb(1),n.oc("ngForOf",t.importFormatOptions),n.Cb(1),n.oc("ngIf","EXCEL_TABLE"==t.importFormat.name),n.Cb(1),n.oc("ngIf","TAB_SEP"==t.importFormat.name||"COMA_SEP"==t.importFormat.name),n.Cb(1),n.oc("ngIf","TOPCOUNT"==t.importFormat.name),n.Cb(1),n.oc("ngIf",t.formatWarning),n.Cb(2),n.oc("autoReset",!1)("blocked",t.blocked||!t.importFormat)("multiple",!1))},directives:[V.a,V.e,V.c,o.C,o.q,o.r,N.b,N.f,y.a,s.l,s.m,T.a,x.o],encapsulation:2}),e})();var A=i("f0Cb");function _(e,t){if(1&e&&(n.Wb(0,"span"),n.Wb(1,"label"),n.Jc(2,"Images every"),n.Vb(),n.Jc(3),n.Vb()),2&e){const e=n.ic(2);n.Cb(3),n.Lc(" ",e.importDetails.imgInterval,"h ")}}function M(e,t){if(1&e&&(n.Wb(0,"span"),n.Wb(1,"label"),n.Jc(2,"Time offset"),n.Vb(),n.Jc(3),n.Vb()),2&e){const e=n.ic(2);n.Cb(3),n.Lc(" ",e.importDetails.timeOffset,"h ")}}function E(e,t){if(1&e&&(n.Wb(0,"p"),n.Wb(1,"label"),n.Jc(2,"First time point:"),n.Vb(),n.Wb(3,"strong"),n.Jc(4),n.Vb(),n.Hc(5,_,4,1,"span",1),n.Hc(6,M,4,1,"span",1),n.Vb()),2&e){const e=n.ic();n.Cb(4),n.Nc("",e.firstTimeCell.value," ",null==e.importDetails.timeType?null:e.importDetails.timeType.unit," [",e.firstTimeCell.colName+":"+e.firstTimeCell.rowName,"]"),n.Cb(1),n.oc("ngIf","IMG_NUMBER"===(null==e.importDetails.timeType?null:e.importDetails.timeType.name)),n.Cb(1),n.oc("ngIf",0!=e.importDetails.timeOffset)}}function U(e,t){if(1&e&&(n.Wb(0,"p"),n.Jc(1),n.Wb(2,"strong"),n.Jc(3),n.Vb(),n.Vb()),2&e){const e=n.ic();n.Cb(1),n.Lc(" Labels in ",e.importDetails.inLabelNeg," "),n.Cb(2),n.Lc("",e.importDetails.inRows?e.labelsSelection.colName:e.labelsSelection.rowName,";")}}function K(e,t){if(1&e&&(n.Wb(0,"p"),n.Wb(1,"label"),n.Jc(2,"Selected Labels:"),n.Vb(),n.Jc(3),n.Vb()),2&e){const e=n.ic();n.Cb(3),n.Lc(" ",e.importDetails.summarizeLabels()," ")}}function z(e,t){if(1&e&&(n.Wb(0,"p"),n.Jc(1),n.Wb(2,"strong"),n.Jc(3),n.Vb(),n.Vb()),2&e){const e=n.ic();n.Cb(1),n.Lc(" Data starts in ",e.importDetails.inLabel," "),n.Cb(2),n.Lc("",e.importDetails.inRows?e.dataStart.rowName:e.dataStart.colName,";")}}function G(e,t){if(1&e&&(n.Wb(0,"p"),n.Jc(1),n.Vb()),2&e){const e=n.ic();n.Cb(1),n.Lc(" Background noise as: ",e.importDetails.backgroundsLabels.join(", ")," ")}}let X=(()=>{class e{constructor(){this.showTime=!1,this.showLabelling=!1,this.showDataStart=!1}get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-import-details-summary"]],inputs:{importDetails:"importDetails",showTime:"showTime",showLabelling:"showLabelling",showDataStart:"showDataStart"},decls:13,vars:8,consts:[[1,"mat-elevation-z4"],[4,"ngIf"]],template:function(e,t){1&e&&(n.Wb(0,"mat-card",0),n.Wb(1,"p"),n.Jc(2),n.Wb(3,"strong"),n.Jc(4),n.Vb(),n.Vb(),n.Wb(5,"p"),n.Wb(6,"label"),n.Jc(7),n.Vb(),n.Vb(),n.Hc(8,E,7,5,"p",1),n.Hc(9,U,4,2,"p",1),n.Hc(10,K,4,1,"p",1),n.Hc(11,z,4,2,"p",1),n.Hc(12,G,2,1,"p",1),n.Vb()),2&e&&(n.Cb(2),n.Lc("",null==t.importDetails?null:null==t.importDetails.importFormat?null:t.importDetails.importFormat.label,": "),n.Cb(2),n.Kc(null==t.importDetails?null:t.importDetails.fileName),n.Cb(3),n.Lc("Time series in ",(null==t.importDetails?null:t.importDetails.inLabel)+"s",""),n.Cb(1),n.oc("ngIf",t.showTime&&t.firstTimeCell),n.Cb(1),n.oc("ngIf",t.showLabelling&&t.importDetails.importLabels&&t.labelsSelection),n.Cb(1),n.oc("ngIf",t.showLabelling&&!t.importDetails.importLabels),n.Cb(1),n.oc("ngIf",t.showDataStart&&t.importDetails.importLabels&&t.dataStart),n.Cb(1),n.oc("ngIf",t.showLabelling&&t.importDetails.containsBackgrounds&&t.importDetails.backgroundsLabels))},directives:[V.a,s.m],encapsulation:2}),e})();var $=i("QibW"),Q=i("bTqV");class j{constructor(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}reset(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}setRowBackground(e,t){this.rowsBackgrounds[e]=t}rowBackground(e){return this.getOrEmptyString(this.rowsBackgrounds,e)}colBackground(e){return this.getOrEmptyString(this.colsBackgrounds,e)}setColBackground(e,t){this.colsBackgrounds[e]=t}cellBackground(e,t){return this.getOrEmptyString(this.getOrDefault(this.cellBackgrounds,t,[]),e)||this.colBackground(e)}setCellBackground(e,t,i){let s=this.cellBackgrounds[t];void 0===s&&(s=[],this.cellBackgrounds[t]=s),s[e]=i}getOrEmptyString(e,t){return this.getOrDefault(e,t,"")}getOrDefault(e,t,i){return t>=e.length||void 0===e[t]?i:e[t]}}let q=(()=>{class e{rowBackground(t){return e.MAIN_ROW_BACKGROUND}cellBackground(t){return e.MAIN_CELL_BACKGROUND}columnBackground(t){return e.MAIN_COL_BACKGROUND}}return e.MAIN_ROW_BACKGROUND="#dda0dd",e.MAIN_COL_BACKGROUND="#87cefa",e.MAIN_CELL_BACKGROUND="#ba55d3",e.TIME_BACKGROUND="#dda0dd",e.LABELS_BACKGROUND="#87cefa",e.FIRST_TIME_BACKGROUND="#ba55d3",e.FIST_DATA_BACKGROUND="lightgreen",e})();class Y{constructor(e,t){this.tableStyler=e,this.colorCycler=t,this.selectedRows=[],this.selectedCols=[],this.tableStyler=e||new j,this.colorCycler=t||new q}toggleRow(e,t=!1,i,s){const o=this.selectedRows.splice(0,this.selectedRows.length);this.selectedRows.push(e),this.uncolorRows(o),this.colorRows(this.selectedRows,i),t&&(this.uncolorCells(o),this.colorCells(this.selectedRows,s))}toggleRowSelection(e,t,i=!1,s,o){const a=this.selectedRows[e]?[this.selectedRows[e]]:[];this.selectedRows[e]=t,this.uncolorRows(a),this.colorRows([this.selectedRows[e]],s),i&&(this.uncolorCells(a),this.colorCells([this.selectedRows[e]],o))}selectRow(e,t){const i=new l.a(-1,-1,void 0,e,e,void 0,void 0),s=this.selectedRows.findIndex(t=>t.rowNumber===e);s<0?this.selectedRows.push(i):this.selectedRows[s]=i,this.colorRows([i],t)}deselectRow(e){const t=this.selectedRows.findIndex(t=>t.rowNumber===e);t>=0&&(this.selectedRows[t]=void 0);const i=new l.a(-1,-1,void 0,e,e,void 0,void 0);this.uncolorRows([i])}toggleCol(e,t=!1,i,s){const o=this.selectedCols.splice(0,this.selectedCols.length);this.selectedCols.push(e),this.uncolorCols(o),this.colorCols(this.selectedCols,i),t&&(this.uncolorCells(o),this.colorCells(this.selectedCols,s))}toggleColSelection(e,t,i=!1,s,o){const a=this.selectedCols[e]?[this.selectedCols[e]]:[];this.selectedCols[e]=t,this.uncolorCols(a),this.colorCols([this.selectedCols[e]],s),i&&(this.uncolorCells(a),this.colorCells([this.selectedCols[e]],o))}selectCol(e,t){const i=new l.a(e,e,void 0,-1,-1,void 0,void 0),s=this.selectedCols.findIndex(t=>t.colNumber===e);s<0?this.selectedCols.push(i):this.selectedCols[s]=i,this.colorCols([i],t)}deselectCol(e){const t=this.selectedCols.findIndex(t=>t.colNumber===e);t>=0&&(this.selectedCols[t]=void 0);const i=new l.a(e,e,void 0,-1,-1,void 0,void 0);this.uncolorCols([i])}reset(){this.selectedRows=[],this.selectedCols=[],this.tableStyler.reset()}colorRows(e,t){e.forEach((e,i)=>{this.tableStyler.setRowBackground(e.rowNumber,t||this.colorCycler.rowBackground(i))})}colorCols(e,t){e.forEach((e,i)=>{this.tableStyler.setColBackground(e.colNumber,t||this.colorCycler.columnBackground(i))})}colorCells(e,t){e.forEach((e,i)=>{this.tableStyler.setCellBackground(e.colNumber,e.rowNumber,t||this.colorCycler.cellBackground(i))})}uncolorRows(e){e.forEach(e=>{this.tableStyler.setRowBackground(e.rowNumber,void 0)})}uncolorCols(e){e.forEach(e=>{this.tableStyler.setColBackground(e.colNumber,void 0)})}uncolorCells(e){e.forEach(e=>{this.tableStyler.setCellBackground(e.colNumber,e.rowNumber,void 0)})}}let Z=(()=>{class e{constructor(){this.index=0,this.labelsIndexes=new Map}toColor(t){if(!t)return;this.labelsIndexes.has(t)||this.labelsIndexes.set(t,this.index++);const i=this.labelsIndexes.get(t)%e.colors.length;return e.colors[i]}setColor(e){}}return e.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"],e})(),ee=(()=>{class e{constructor(e,t){this.dataService=e,this.feedback=t,this.tableSelector=new Y,this.lastColumnSeen=0,this.lastRowSeen=0,this.firstPageSlice=v.firstPage(),this.currentPageSlice=v.firstPage()}get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}ngOnInit(){this.dataService.error$.forEach(e=>this.feedback.error(e)),this.dataSubscription=this.dataService.dataSlice$.subscribe(e=>this.setDataSlice(e),e=>this.feedback.error(e))}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe()}colNumber(e){return e<0?-1:this.dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this.dataSlice.rowsNumbers[e]}setDataSlice(e){this.dataSlice=e,this.lastColumnSeen=Math.max(this.lastColumnSeen,e.columnsNumbers[e.columnsNumbers.length-1]),this.lastRowSeen=Math.max(this.lastRowSeen,e.rowsNumbers[e.rowsNumbers.length-1]),this.currentPageSlice=new v(e.rowPage,e.colPage),this.applySelection()}loadData(){this.importDetails&&(this.lastColumnSeen=0,this.lastRowSeen=0,this.dataService.fileIdFormat([this.importDetails.fileId,this.importDetails.importFormat.name]),this.dataService.slice(this.firstPageSlice)),this.dataSlice&&this.applySelection()}applySelection(){this.tableSelector.reset(),this.markSelections(),this.applyDefaultSelections()}applyDefaultSelections(){}markSelections(){}selectFirstTime(e){this.importDetails.firstTimeCell=e,this.markFirstTime()}markFirstTime(){const e=this.firstTimeCell;e&&(this.importDetails.inRows?this.tableSelector.toggleRow(e,!0,q.TIME_BACKGROUND,q.FIRST_TIME_BACKGROUND):this.tableSelector.toggleCol(e,!0,q.TIME_BACKGROUND,q.FIRST_TIME_BACKGROUND))}selectLabels(e){this.importDetails.labelsSelection=e,this.markLabels()}markLabels(){const e=this.labelsSelection;e&&(this.importDetails.inRows?this.tableSelector.toggleCol(e,!1,q.LABELS_BACKGROUND):this.tableSelector.toggleRow(e,!1,q.LABELS_BACKGROUND))}selectDataStart(e){e?this.importDetails.inRows?this.firstTimeCell&&this.firstTimeCell.rowIx===e.rowIx||(this.importDetails.dataStart=e):this.firstTimeCell&&this.firstTimeCell.colIx===e.colIx||(this.importDetails.dataStart=e):this.importDetails.dataStart=void 0,this.markDataStart()}markDataStart(){const e=this.dataStart;e&&(this.importDetails.inRows?this.tableSelector.toggleRowSelection(1,e,!1,q.FIST_DATA_BACKGROUND):this.tableSelector.toggleColSelection(1,e,!1,q.FIST_DATA_BACKGROUND))}reselect(e){if(!this.dataSlice||!e)return;const t=this.dataSlice,i=e.colIx,s=e.rowIx;if(i>=t.columnsNumbers.length)return;if(s>=t.rowsNumbers.length)return;const o=new l.a(i,t.columnsNumbers[i],t.columnsNames[i],s,t.rowsNumbers[s],t.rowsNames[s],(s>=0?t.data[s]:[])[i]);return o.fake=e.fake,o}hasMoreTimes(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns:this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows)}hasMoreLabels(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows:this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns)}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(W),n.Qb(R.a))},e.\u0275dir=n.Lb({type:e}),e})();var te=i("+0xr");const ie=["table"];function se(e,t){1&e&&n.Rb(0,"th",10)}function oe(e,t){if(1&e){const e=n.Xb();n.Wb(0,"td",11),n.ec("click",(function(i){n.Ac(e);const s=t.index;return n.ic(2).selectCell(-1,s)})),n.Wb(1,"label"),n.Jc(2),n.Vb(),n.Vb()}if(2&e){const e=t.index,i=n.ic(2);n.Cb(2),n.Kc(i.rowsNames[e])}}function ae(e,t){if(1&e){const e=n.Xb();n.Wb(0,"th",15),n.ec("click",(function(t){n.Ac(e);const i=n.ic().index;return n.ic(2).selectCell(i,-1)})),n.Jc(1),n.Vb()}if(2&e){const e=n.ic(),t=e.index,i=e.$implicit,s=n.ic(2);n.Gc("background-color",s.colBackground(t)),n.Cb(1),n.Lc(" ",i," ")}}function le(e,t){if(1&e){const e=n.Xb();n.Wb(0,"td",16),n.ec("click",(function(i){n.Ac(e);const s=t.index,o=n.ic().index;return n.ic(2).selectCell(o,s)})),n.Jc(1),n.Vb()}if(2&e){const e=t.$implicit,i=t.index,s=n.ic().index,o=n.ic(2);n.Gc("background-color",o.cellBackground(s,i)),n.Cb(1),n.Lc(" ",e[s]," ")}}function re(e,t){1&e&&(n.Ub(0,12),n.Hc(1,ae,2,3,"th",13),n.Hc(2,le,2,3,"td",14),n.Tb()),2&e&&n.oc("matColumnDef",t.$implicit)}function ne(e,t){1&e&&n.Rb(0,"tr",17)}function ce(e,t){if(1&e&&n.Rb(0,"tr",18),2&e){const e=t.index,i=n.ic(2);n.Gc("background-color",i.rowBackground(e))}}function be(e,t){if(1&e&&(n.Wb(0,"div",1),n.Wb(1,"table",2,3),n.Ub(3,4),n.Hc(4,se,1,0,"th",5),n.Hc(5,oe,3,1,"td",6),n.Tb(),n.Hc(6,re,3,1,"ng-container",7),n.Hc(7,ne,1,0,"tr",8),n.Hc(8,ce,1,2,"tr",9),n.Vb(),n.Vb()),2&e){const e=n.ic();n.Cb(1),n.oc("dataSource",e.data),n.Cb(5),n.oc("ngForOf",e.columnsNames),n.Cb(1),n.oc("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),n.Cb(1),n.oc("matRowDefColumns",e.displayedColumns)}}let me=(()=>{class e{constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.styler=new j,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.selected=new n.o}set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.displayedColumns=["rowNr"].concat(this.columnsNames),this.data=e.data,this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}ngOnInit(){}selectCell(e,t){if(e<0&&!this.selectableRowHeader)return;if(t<0&&!this.selectableColHeader)return;const i=new l.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selected.next(i)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-data-sheet-mdtable"]],viewQuery:function(e,t){var i;1&e&&n.Pc(ie,!0),2&e&&n.wc(i=n.fc())&&(t.matTable=i.first)},inputs:{dataSlice:"dataSlice",styler:"styler",selectableColHeader:"selectableColHeader",selectableRowHeader:"selectableRowHeader"},outputs:{selected:"selected"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color","click",4,"matHeaderCellDef"],["mat-cell","","matRipple","","matRippleCentered","true",3,"background-color","click",4,"matCellDef"],["mat-header-cell","",3,"click"],["mat-cell","","matRipple","","matRippleCentered","true",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&n.Hc(0,be,9,5,"div",0),2&e&&n.oc("ngIf",t.dataSlice)},directives:[s.m,te.n,te.c,te.i,te.b,s.l,te.k,te.m,te.h,te.a,x.r,te.j,te.l],styles:[".data-sheet-container[_ngcontent-%COMP%] {\n      max-height: 300px;\n      overflow: auto;\n    }\n\n    .mat-table-sticky[_ngcontent-%COMP%]:first-child {\n      border-right: 1px solid #e0e0e0;\n      padding-right: 1em;\n    }\n\n\n    .mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%] {\n      padding-left: 0.5em;\n      padding-right: 0.5em;\n    }\n\n    label[_ngcontent-%COMP%] {\n      color: rgba(0,0,0,0.54);\n    }"]}),e})();var de=i("qFsG");function ue(e,t){if(1&e&&(n.Wb(0,"mat-option",9),n.Jc(1),n.Vb()),2&e){const e=t.$implicit;n.oc("value",e),n.Cb(1),n.Kc(e.label)}}function he(e,t){if(1&e){const e=n.Xb();n.Wb(0,"p"),n.Wb(1,"mat-form-field"),n.Wb(2,"input",10),n.ec("ngModelChange",(function(t){return n.Ac(e),n.ic(3).importDetails.imgInterval=t})),n.Vb(),n.Vb(),n.Vb()}if(2&e){const e=n.ic(3);n.Cb(2),n.oc("ngModel",e.importDetails.imgInterval)}}function pe(e,t){if(1&e&&(n.Wb(0,"div",11),n.Jc(1),n.Vb()),2&e){const e=n.ic(3);n.Cb(1),n.Lc(" The first time point value ",e.firstTimeCell.value," does not look like a number; ")}}function fe(e,t){if(1&e){const e=n.Xb();n.Wb(0,"div"),n.Wb(1,"p"),n.Jc(2),n.Wb(3,"strong"),n.Jc(4),n.Vb(),n.Jc(5,"\xa0 First time point: "),n.Wb(6,"strong"),n.Jc(7),n.Vb(),n.Jc(8),n.Vb(),n.Wb(9,"p"),n.Wb(10,"mat-form-field"),n.Wb(11,"mat-label"),n.Jc(12,"Time unit"),n.Vb(),n.Wb(13,"mat-select",5),n.ec("valueChange",(function(t){return n.Ac(e),n.ic(2).importDetails.timeType=t})),n.Hc(14,ue,2,2,"mat-option",6),n.Vb(),n.Vb(),n.Vb(),n.Wb(15,"p"),n.Wb(16,"mat-form-field"),n.Wb(17,"input",7),n.ec("ngModelChange",(function(t){return n.Ac(e),n.ic(2).importDetails.timeOffset=t})),n.Vb(),n.Vb(),n.Vb(),n.Hc(18,he,3,1,"p",2),n.Hc(19,pe,2,1,"div",8),n.Vb()}if(2&e){const e=n.ic(2);n.Cb(2),n.Lc("Times in ",e.importDetails.inLabel," "),n.Cb(2),n.Lc("",e.importDetails.inRows?e.firstTimeCell.rowName:e.firstTimeCell.colName,";"),n.Cb(3),n.Mc("",e.firstTimeCell.value," ",null==e.importDetails.timeType?null:e.importDetails.timeType.unit,""),n.Cb(1),n.Lc(" [",e.firstTimeCell.colName+":"+e.firstTimeCell.rowName,"] "),n.Cb(5),n.oc("value",e.importDetails.timeType),n.Cb(1),n.oc("ngForOf",e.timeTypeOptions),n.Cb(3),n.oc("ngModel",e.importDetails.timeOffset),n.Cb(1),n.oc("ngIf","IMG_NUMBER"==(null==e.importDetails.timeType?null:e.importDetails.timeType.name)),n.Cb(1),n.oc("ngIf",e.firstTimeNotNumber())}}function ge(e,t){if(1&e&&(n.Wb(0,"div",12),n.Jc(1),n.Vb()),2&e){const e=n.ic(2);n.Cb(1),n.Lc(" Even if only the top part of the data table is presented all times from the selected ",e.importDetails.inLabel," will be imported ")}}function we(e,t){if(1&e){const e=n.Xb();n.Wb(0,"mat-card",1),n.Wb(1,"mat-card-content"),n.Hc(2,fe,20,10,"div",2),n.Wb(3,"div"),n.Wb(4,"div"),n.Jc(5),n.Vb(),n.Vb(),n.Wb(6,"bd2-data-sheet-mdtable",3),n.ec("selected",(function(t){return n.Ac(e),n.ic().selectFirstTime(t)})),n.Vb(),n.Hc(7,ge,2,1,"div",4),n.Vb(),n.Vb()}if(2&e){const e=n.ic();n.Cb(2),n.oc("ngIf",e.firstTimeCell),n.Cb(2),n.Eb(e.firstTimeCell?"alert alert-info":"alert alert-danger"),n.Cb(1),n.Lc(" Click on the first timepoint in the time ",e.importDetails.inLabel," and then select a time unit. "),n.Cb(1),n.oc("dataSlice",e.dataSlice)("styler",e.tableSelector.tableStyler),n.Cb(1),n.oc("ngIf",e.hasMoreTimes())}}let Ce=(()=>{class e extends ee{constructor(e,t){super(e,t),this.timeTypeOptions=[m.h.TIME_IN_HOURS,m.h.TIME_IN_MINUTES,m.h.TIME_IN_SECONDS,m.h.IMG_NUMBER]}applyDefaultSelections(){if(super.applyDefaultSelections(),this.firstTimeCell&&!this.firstTimeCell.fake)this.selectFirstTime(this.reselect(this.firstTimeCell));else{let e=this.importDetails.inRows?new l.a(1,this.colNumber(1),void 0,0,this.rowNumber(0),void 0,void 0):new l.a(0,this.colNumber(0),void 0,1,this.rowNumber(1),void 0,void 0);e=this.reselect(e),e.fake=!0,this.selectFirstTime(e)}}firstTimeNotNumber(){return!!this.firstTimeCell&&isNaN(Number(this.firstTimeCell.value))}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(W),n.Qb(R.a))},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-define-time-step"]],inputs:{importDetails:"importDetails"},features:[n.zb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["required","",3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","placeholder","Time offset",3,"ngModel","ngModelChange"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"value"],["matInput","","type","number","placeholder","Images interval (hours)","required","",3,"ngModel","ngModelChange"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(e,t){1&e&&n.Hc(0,we,8,7,"mat-card",0),2&e&&n.oc("ngIf",t.importDetails)},directives:[s.m,V.a,V.c,me,N.b,N.f,y.a,s.l,de.b,o.u,o.c,o.p,o.s,x.o,o.y],encapsulation:2}),e})();var Se=i("0IaG");let De=(()=>{class e{constructor(e,t){this.dialogRef=e,this.data=t}ngOnInit(){}sendLabel(){this.dialogRef.close(this.data.label)}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(Se.g),n.Qb(Se.a))},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-edit-label-dialog"]],decls:20,vars:6,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","cdkFocusInitial","",3,"ngModel","ngModelChange","keydown.enter"],["align","start"],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-raised-button","","color","primary",3,"mat-dialog-close"],["ok",""]],template:function(e,t){1&e&&(n.Wb(0,"h1",0),n.Jc(1),n.Vb(),n.Wb(2,"div",1),n.Wb(3,"p"),n.Jc(4),n.Vb(),n.Wb(5,"mat-form-field"),n.Wb(6,"input",2),n.ec("ngModelChange",(function(e){return t.data.label=e}))("keydown.enter",(function(e){return t.sendLabel()})),n.Vb(),n.Wb(7,"mat-hint",3),n.Jc(8,"Pressing "),n.Wb(9,"strong"),n.Jc(10,"Enter"),n.Vb(),n.Jc(11," submits "),n.Vb(),n.Vb(),n.Vb(),n.Wb(12,"div",4),n.Wb(13,"button",5),n.Jc(14,"Cancel"),n.Vb(),n.Wb(15,"button",5),n.Jc(16,"Clear"),n.Vb(),n.Wb(17,"button",6,7),n.Jc(19,"Assign"),n.Vb(),n.Vb()),2&e&&(n.Cb(1),n.Kc(t.data.title),n.Cb(3),n.Lc("Write label for ",t.data.regionName,""),n.Cb(2),n.oc("ngModel",t.data.label),n.Cb(7),n.oc("mat-dialog-close",void 0),n.Cb(2),n.oc("mat-dialog-close",""),n.Cb(2),n.oc("mat-dialog-close",t.data.label))},directives:[Se.h,Se.e,N.b,de.b,o.c,o.p,o.s,N.e,Se.c,Q.a,Se.d],encapsulation:2}),e})();const ve=["table"];function ke(e,t){1&e&&n.Rb(0,"th",20)}function Le(e,t){if(1&e){const e=n.Xb();n.Wb(0,"td",21),n.ec("mousedown",(function(i){n.Ac(e);const s=t.index;return n.ic(2).startSelectCell(-1,s)}))("mouseup",(function(i){n.Ac(e);const s=t.index;return n.ic(2).endSelectCell(-1,s)})),n.Wb(1,"label"),n.Jc(2),n.Vb(),n.Vb()}if(2&e){const e=t.index,i=n.ic(2);n.Cb(2),n.Kc(i.rowsNames[e])}}function We(e,t){if(1&e){const e=n.Xb();n.Wb(0,"td",22),n.ec("click",(function(t){return n.Ac(e),n.ic(2).nextRow()})),n.Jc(1),n.Vb()}if(2&e){const e=n.ic(2);n.Cb(1),n.Kc(e.hasMoreRows?"...":"end")}}function Re(e,t){1&e&&(n.Wb(0,"th",20),n.Jc(1,"Labels"),n.Vb())}function Ie(e,t){if(1&e){const e=n.Xb();n.Wb(0,"td",21),n.ec("mousedown",(function(i){n.Ac(e);const s=t.index;return n.ic(2).startSelectCell(-1,s)}))("mouseup",(function(i){n.Ac(e);const s=t.index;return n.ic(2).endSelectCell(-1,s)})),n.Wb(1,"label",23),n.Jc(2),n.Vb(),n.Vb()}if(2&e){const e=t.index,i=n.ic(2);n.Cb(2),n.Kc(i.rowsLabels[e])}}function Ve(e,t){if(1&e){const e=n.Xb();n.Wb(0,"td",22),n.ec("click",(function(t){return n.Ac(e),n.ic(2).nextRow()})),n.Vb()}}function Ne(e,t){if(1&e){const e=n.Xb();n.Wb(0,"th",27),n.ec("mousedown",(function(t){n.Ac(e);const i=n.ic().index;return n.ic(2).startSelectCell(i,-1)}))("mouseup",(function(t){n.Ac(e);const i=n.ic().index;return n.ic(2).endSelectCell(i,-1)})),n.Jc(1),n.Vb()}if(2&e){const e=n.ic(),t=e.index,i=e.$implicit,s=n.ic(2);n.Gc("background-color",s.colBackground(t)),n.Cb(1),n.Lc(" ",i," ")}}function ye(e,t){if(1&e&&(n.Wb(0,"td",28),n.Jc(1),n.Vb()),2&e){const e=t.$implicit,i=t.index,s=n.ic().index,o=n.ic(2);n.Gc("background-color",o.cellBackground(s,i)),n.Cb(1),n.Lc(" ",e[s]," ")}}function Te(e,t){if(1&e){const e=n.Xb();n.Wb(0,"td",22),n.ec("click",(function(t){return n.Ac(e),n.ic(3).nextRow()})),n.Jc(1),n.Vb()}if(2&e){const e=n.ic(3);n.Cb(1),n.Kc(e.hasMoreRows?"...":"")}}function xe(e,t){1&e&&(n.Ub(0,24),n.Hc(1,Ne,2,3,"th",25),n.Hc(2,ye,2,3,"td",26),n.Hc(3,Te,2,1,"td",7),n.Tb()),2&e&&n.oc("matColumnDef",t.$implicit)}function Be(e,t){if(1&e){const e=n.Xb();n.Wb(0,"th",29),n.ec("click",(function(t){return n.Ac(e),n.ic(2).nextColumn()})),n.Jc(1,"..."),n.Vb()}}function Oe(e,t){if(1&e){const e=n.Xb();n.Wb(0,"td",30),n.ec("click",(function(t){return n.Ac(e),n.ic(2).nextColumn()})),n.Jc(1,"..."),n.Vb()}}function He(e,t){1&e&&n.Rb(0,"td",31)}function Fe(e,t){1&e&&(n.Wb(0,"th",20),n.Jc(1,"Labels"),n.Vb())}function Je(e,t){1&e&&n.Rb(0,"th",20)}function Pe(e,t){if(1&e){const e=n.Xb();n.Wb(0,"th",27),n.ec("mousedown",(function(t){n.Ac(e);const i=n.ic().index;return n.ic(3).startSelectCell(i,-1)}))("mouseup",(function(t){n.Ac(e);const i=n.ic().index;return n.ic(3).endSelectCell(i,-1)})),n.Wb(1,"label",23),n.Jc(2),n.Vb(),n.Vb()}if(2&e){const e=n.ic().index,t=n.ic(3);n.Gc("background-color",t.colBackground(e)),n.Cb(2),n.Kc(t.columnsLabels[e])}}function Ae(e,t){1&e&&(n.Ub(0,24),n.Hc(1,Pe,3,3,"th",25),n.Tb()),2&e&&n.oc("matColumnDef","label"+t.index)}function _e(e,t){if(1&e&&(n.Ub(0),n.Hc(1,Ae,2,1,"ng-container",9),n.Tb()),2&e){const e=n.ic(2);n.Cb(1),n.oc("ngForOf",e.columnsNames)}}function Me(e,t){1&e&&n.Rb(0,"tr",32)}function Ee(e,t){1&e&&n.Rb(0,"tr",32)}function Ue(e,t){if(1&e&&(n.Ub(0),n.Hc(1,Ee,1,0,"tr",17),n.Tb()),2&e){const e=n.ic(2);n.Cb(1),n.oc("matHeaderRowDef",e.displayedLabelsColumns)("matHeaderRowDefSticky",!0)}}function Ke(e,t){if(1&e&&n.Rb(0,"tr",33),2&e){const e=t.index,i=n.ic(2);n.Gc("background-color",i.rowBackground(e))}}function ze(e,t){1&e&&n.Rb(0,"tr",34)}function Ge(e,t){if(1&e&&(n.Wb(0,"div",1),n.Wb(1,"table",2,3),n.Ub(3,4),n.Hc(4,ke,1,0,"th",5),n.Hc(5,Le,3,1,"td",6),n.Hc(6,We,2,1,"td",7),n.Tb(),n.Ub(7,8),n.Hc(8,Re,2,0,"th",5),n.Hc(9,Ie,3,1,"td",6),n.Hc(10,Ve,1,0,"td",7),n.Tb(),n.Hc(11,xe,4,1,"ng-container",9),n.Ub(12,10),n.Hc(13,Be,2,0,"th",11),n.Hc(14,Oe,2,0,"td",12),n.Hc(15,He,1,0,"td",13),n.Tb(),n.Ub(16,14),n.Hc(17,Fe,2,0,"th",5),n.Tb(),n.Ub(18,15),n.Hc(19,Je,1,0,"th",5),n.Tb(),n.Hc(20,_e,2,1,"ng-container",16),n.Hc(21,Me,1,0,"tr",17),n.Hc(22,Ue,2,2,"ng-container",16),n.Hc(23,Ke,1,2,"tr",18),n.Hc(24,ze,1,0,"tr",19),n.Vb(),n.Vb()),2&e){const e=n.ic();n.Cb(1),n.oc("dataSource",e.data),n.Cb(10),n.oc("ngForOf",e.columnsNames),n.Cb(9),n.oc("ngIf",e.showColumnsLabels),n.Cb(1),n.oc("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),n.Cb(1),n.oc("ngIf",e.showColumnsLabels),n.Cb(1),n.oc("matRowDefColumns",e.displayedColumns),n.Cb(1),n.oc("matFooterRowDef",e.displayedColumns)}}let Xe=(()=>{class e{constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.hasMoreColumns=!1,this.hasMoreRows=!1,this._columnsLabels=[],this._rowsLabels=[],this.styler=new j,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.showColumnsLabels=!1,this.showRowsLabels=!1,this.selected=new n.o,this.moreRows=new n.o,this.moreColumns=new n.o}set columnsLabels(e){this._columnsLabels=e}get columnsLabels(){return this._columnsLabels}set rowsLabels(e){this._rowsLabels=e}get rowsLabels(){return this._rowsLabels}set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.data=e.data,this.hasMoreColumns=e.columnsNumbers[e.columnsNumbers.length-1]<e.totalColumns-1,this.hasMoreRows=e.rowsNumbers[e.rowsNumbers.length-1]<e.totalRows-1,this.decideColumns(),this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}set selectRows(e){this.selectableRowHeader=e,this.showRowsLabels=e,this.decideColumns()}set selectCols(e){this.selectableColHeader=e,this.showColumnsLabels=e,this.decideColumns()}decideColumns(){this.displayedColumns=(this.showRowsLabels?["rowNr","rowLabel"]:["rowNr"]).concat(this.columnsNames),this.displayedLabelsColumns=(this.showRowsLabels?["rowNr2","rowLabel2"]:["rowNr2"]).concat(this.columnsNames.map((e,t)=>"label"+t)),this.hasMoreColumns&&(this.displayedColumns.push("more"),this.displayedLabelsColumns.push("more"))}ngOnInit(){}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}startSelectCell(e,t){if(e<0&&!this.selectableRowHeader)return;if(t<0&&!this.selectableColHeader)return;const i=new l.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selectionStart=i}endSelectCell(e,t){if(!this.selectionStart)return;if(t<0&&this.selectionStart.rowIx>=0)return void(this.selectionStart=void 0);if(e<0&&this.selectionStart.colIx>=0)return void(this.selectionStart=void 0);if(e<0&&!this.selectableRowHeader)return;if(t<0&&!this.selectableColHeader)return;const i=new l.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selected.next([this.selectionStart,i])}nextColumn(){this.moreColumns.next(!0)}nextRow(){this.moreRows.next(!0)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-selectable-region-mdtable"]],viewQuery:function(e,t){var i;1&e&&n.Pc(ve,!0),2&e&&n.wc(i=n.fc())&&(t.matTable=i.first)},inputs:{columnsLabels:"columnsLabels",rowsLabels:"rowsLabels",dataSlice:"dataSlice",selectRows:"selectRows",selectCols:"selectCols",styler:"styler"},outputs:{selected:"selected",moreRows:"moreRows",moreColumns:"moreColumns"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"mousedown","mouseup",4,"matCellDef"],["mat-footer-cell","",3,"click",4,"matFooterCellDef"],["matColumnDef","rowLabel","sticky",""],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","more","sticky",""],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","rowNr2","sticky",""],["matColumnDef","rowLabel2","sticky",""],[4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell","","matRipple","",3,"mousedown","mouseup"],["mat-footer-cell","",3,"click"],[1,"user"],[3,"matColumnDef"],["mat-header-cell","","matRipple","",3,"background-color","mousedown","mouseup",4,"matHeaderCellDef"],["mat-cell","",3,"background-color",4,"matCellDef"],["mat-header-cell","","matRipple","",3,"mousedown","mouseup"],["mat-cell",""],["mat-header-cell","",3,"click"],["mat-cell","",3,"click"],["mat-footer-cell",""],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(e,t){1&e&&n.Hc(0,Ge,25,8,"div",0),2&e&&n.oc("ngIf",t.dataSlice)},directives:[s.m,te.n,te.c,te.i,te.b,te.e,s.l,te.k,te.m,te.g,te.h,te.a,x.r,te.d,te.j,te.l,te.f],styles:[".data-sheet-container[_ngcontent-%COMP%] {\n      max-height: 800px;\n      overflow: auto;\n    }\n\n    .mat-table-sticky[_ngcontent-%COMP%]:first-child {\n      border-right: 1px solid #e0e0e0;\n      padding-right: 1em;\n    }\n\n\n    .mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%] {\n      padding-left: 0.5em;\n      padding-right: 0.5em;\n    }\n\n    label[_ngcontent-%COMP%] {\n      color: rgba(0,0,0,0.54);\n    }\n\n    label.user[_ngcontent-%COMP%] {\n      color: black;\n    }"]}),e})();const $e=["colPaginator"],Qe=["rowPaginator"];function je(e,t){if(1&e&&(n.Wb(0,"div",9),n.Jc(1),n.Vb()),2&e){const e=n.ic();n.Cb(1),n.Lc(" You have not seen yet all the available ",null==e.importDetails?null:e.importDetails.inLabel,"s for labelling\n")}}const qe=function(){return[10,25,50,100]};let Ye=(()=>{class e extends ee{constructor(e,t,i){super(t,i),this.dialog=e,this.columnsLabels=[],this.rowsLabels=[],this.colorer=new Z}get userLabels(){return this.importDetails?this.importDetails.userLabels:void 0}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy(),this.dataService&&this.dataService.close()}ngAfterViewInit(){this.colPaginator._intl=new D.b,this.colPaginator._intl.itemsPerPageLabel="Columns per page",this.rowPaginator._intl=new D.b,this.rowPaginator._intl.itemsPerPageLabel="Rows per page"}markSelections(){super.markSelections(),this.markFirstTime(),this.loadLabels(),this.markLabels(),this.labelsSummary=this.importDetails.summarizeLabels(25),this.labelTime()}labelTime(){if(this.firstTimeCell)if(this.importDetails.inRows){const e=this.dataSlice.rowsNumbers.indexOf(this.firstTimeCell.rowNumber);e>=0&&(this.rowsLabels[e]="Time")}else{const e=this.dataSlice.columnsNumbers.indexOf(this.firstTimeCell.colNumber);e>=0&&(this.columnsLabels[e]="Time")}}loadLabels(){const e=this.dataSlice;this.importDetails.inRows?(this.rowsLabels=this.userLabels.slice(e.rowsNumbers[0],e.rowsNumbers[e.rowsNumbers.length-1]),this.columnsLabels=[]):(this.rowsLabels=[],this.columnsLabels=this.userLabels.slice(e.columnsNumbers[0],e.columnsNumbers[e.columnsNumbers.length-1]))}markLabels(){this.userLabels.forEach((e,t)=>{this.importDetails.inRows?this.tableSelector.selectRow(t,this.colorer.toColor(e)):this.tableSelector.selectCol(t,this.colorer.toColor(e))})}hasSeenAll(){return!!this.dataSlice&&(this.importDetails.inRows?this.lastRowSeen>=this.dataSlice.totalRows-1:this.lastColumnSeen>=this.dataSlice.totalColumns-1)}selected(e){e[1].isBeforeOrSame(e[0])&&(e=[e[1],e[0]]),this.importDetails.inRows?this.labelRows(e[0],e[1]):this.labelColumns(e[0],e[1])}setUserLabel(e,t){this.userLabels[e]=t||void 0,this.labelsSummary=this.importDetails.summarizeLabels(25)}askForLabel(e,t,i){let s;return s=i?{title:"Label rows",regionName:e.hasSameIx(t)?"row "+e.rowName:"rows "+e.rowName+"-"+t.rowName,label:this.userLabels[e.rowNumber]}:{title:"Label columns",regionName:e.hasSameIx(t)?"column "+e.colName:"columns "+e.colName+"-"+t.colName,label:this.userLabels[e.rowNumber]},this.dialog.open(De,{data:s}).afterClosed()}labelRows(e,t){e.rowIx<0||t.rowIx<0?console.warn("Label rows with col selection",e):this.firstTimeCell&&this.firstTimeCell.rowNumber>=e.rowNumber||this.askForLabel(e,t,!0).subscribe(i=>{void 0!==i&&(this.setRowsLabel(e,t,i),i&&this.selectNextRegion(e,t))})}setRowsLabel(e,t,i){i=i.trim();const s=this.colorer.toColor(i);for(let o=e.rowIx;o<=t.rowIx;o++){const e=this.dataSlice.rowsNumbers[o];void 0===e?console.error("No row number for index "+o):(this.rowsLabels[o]=i,this.setUserLabel(e,i),i?this.tableSelector.selectRow(e,s):this.tableSelector.deselectRow(e))}}labelColumns(e,t){e.colIx<0||t.colIx<0?console.warn("Label cols with row selection",e):this.firstTimeCell&&this.firstTimeCell.colNumber>=e.colNumber?console.log("Ignroing labelling as Time col after selection"):this.askForLabel(e,t,!1).subscribe(i=>{void 0!==i&&(this.setColumnsLabel(e,t,i),i&&this.selectNextRegion(e,t))})}setColumnsLabel(e,t,i){i=i.trim();const s=this.colorer.toColor(i);for(let o=e.colIx;o<=t.colIx;o++){const e=this.dataSlice.columnsNumbers[o];void 0===e?console.error("No col number for index "+o):(this.columnsLabels[o]=i,this.setUserLabel(e,i),i?this.tableSelector.selectCol(e,s):this.tableSelector.deselectCol(e))}}selectNextRegion(e,t){const i=[t.colIx-e.colIx,t.rowIx-e.rowIx];let s=this.moveCell(t,[1,1]),o=this.moveCell(s,i);this.isInPage(s)&&(this.isInPage(o)||(o=this.fitToPage(o)),s=this.reselect(s),o=this.reselect(o),this.selected([s,o]))}isInPage(e){return!(e.colIx>=0&&e.colIx>=this.dataSlice.columnsNumbers.length||e.rowIx>=0&&e.rowIx>=this.dataSlice.rowsNumbers.length)}fitToPage(e){return new l.a(e.colIx>=0?this.dataSlice.columnsNumbers.length-1:-1,void 0,void 0,e.rowIx>=0?this.dataSlice.rowsNumbers.length-1:-1,void 0,void 0,void 0)}moveCell(e,t){return new l.a(e.colIx>=0?e.colIx+t[0]:-1,void 0,void 0,e.rowIx>=0?e.rowIx+t[1]:-1,void 0,void 0,void 0)}loadColPage(e){this.dataService.slice(new v(this.currentPageSlice.rowPage,e))}loadRowPage(e){this.dataService.slice(new v(e,this.currentPageSlice.colPage))}moreColumns(){this.importDetails.inRows||this.colPaginator.nextPage()}moreRows(){this.importDetails.inRows&&this.rowPaginator.nextPage()}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(Se.b),n.Qb(W),n.Qb(R.a))},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-assign-labels-step"]],viewQuery:function(e,t){var i;1&e&&(n.Fc($e,!0),n.Fc(Qe,!0)),2&e&&(n.wc(i=n.fc())&&(t.colPaginator=i.first),n.wc(i=n.fc())&&(t.rowPaginator=i.first))},inputs:{importDetails:"importDetails"},features:[n.Bb([W]),n.zb],decls:14,vars:23,consts:[["role","alert","type","info",1,"alert","alert-info",3,"hidden"],[3,"hidden"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["colPaginator",""],[3,"dataSlice","columnsLabels","rowsLabels","styler","selectRows","selectCols","selected","moreColumns","moreRows"],[3,"length","disabled","pageSize","pageSizeOptions","page"],["rowPaginator",""],["type","danger","class","alert alert-danger mt-2","role","alert",4,"ngIf"],[2,"margin-top","1em"],["type","danger","role","alert",1,"alert","alert-danger","mt-2"]],template:function(e,t){1&e&&(n.Wb(0,"div",0),n.Jc(1),n.Vb(),n.Wb(2,"div",1),n.Wb(3,"mat-paginator",2,3),n.ec("page",(function(e){return t.loadColPage(e)})),n.Vb(),n.Vb(),n.Wb(5,"bd2-selectable-region-mdtable",4),n.ec("selected",(function(e){return t.selected(e)}))("moreColumns",(function(e){return t.moreColumns()}))("moreRows",(function(e){return t.moreRows()})),n.Vb(),n.Wb(6,"div",1),n.Wb(7,"mat-paginator",5,6),n.ec("page",(function(e){return t.loadRowPage(e)})),n.Vb(),n.Vb(),n.Hc(9,je,2,1,"div",7),n.Wb(10,"div",8),n.Wb(11,"label"),n.Jc(12,"Selected labels: "),n.Vb(),n.Jc(13),n.Vb()),2&e&&(n.oc("hidden",(null==t.importDetails?null:null==t.importDetails.userLabels?null:t.importDetails.userLabels.length)>1),n.Cb(1),n.Lc(" Click and drag over ",null==t.importDetails?null:t.importDetails.inLabel," headers to label the data.\n"),n.Cb(1),n.oc("hidden",null==t.importDetails?null:t.importDetails.inRows),n.Cb(1),n.oc("length",null==t.dataSlice?null:t.dataSlice.totalColumns)("disabled",null==t.importDetails?null:t.importDetails.inRows)("pageSize",t.currentPageSlice.colPage.pageSize)("pageIndex",t.currentPageSlice.colPage.pageIndex)("pageSizeOptions",n.qc(21,qe)),n.Cb(2),n.oc("dataSlice",t.dataSlice)("columnsLabels",t.columnsLabels)("rowsLabels",t.rowsLabels)("styler",t.tableSelector.tableStyler)("selectRows",null==t.importDetails?null:t.importDetails.inRows)("selectCols",!(null!=t.importDetails&&t.importDetails.inRows)),n.Cb(1),n.oc("hidden",!(null!=t.importDetails&&t.importDetails.inRows)),n.Cb(1),n.oc("length",null==t.dataSlice?null:t.dataSlice.totalRows)("disabled",!(null!=t.importDetails&&t.importDetails.inRows))("pageSize",t.firstPageSlice.rowPage.pageSize)("pageSizeOptions",n.qc(22,qe)),n.Cb(2),n.oc("ngIf",!t.hasSeenAll()),n.Cb(4),n.Lc("",t.labelsSummary,"\n"))},directives:[D.a,Xe,s.m],encapsulation:2}),e})();function Ze(e,t){if(1&e&&(n.Wb(0,"div",7),n.Jc(1),n.Vb()),2&e){const e=n.ic(3);n.Cb(1),n.Lc(" Labels ",e.importDetails.inLabelNeg," must be before first time point. ")}}function et(e,t){if(1&e&&(n.Wb(0,"div"),n.Wb(1,"p"),n.Jc(2),n.Wb(3,"strong"),n.Jc(4),n.Vb(),n.Vb(),n.Hc(5,Ze,2,1,"div",6),n.Vb()),2&e){const e=n.ic(2);n.Cb(2),n.Lc("Labels in ",e.importDetails.inLabelNeg," "),n.Cb(2),n.Lc("",e.importDetails.inRows?e.labelsSelection.colName:e.labelsSelection.rowName,";"),n.Cb(1),n.oc("ngIf",!e.importDetails.areLabelsAfterTime())}}function tt(e,t){if(1&e&&(n.Wb(0,"div",8),n.Jc(1),n.Vb()),2&e){const e=n.ic(2);n.Cb(1),n.Lc(" Even if only the top part of the data table is presented all labels from the selected ",e.importDetails.inLabelNeg," will be imported ")}}function it(e,t){if(1&e){const e=n.Xb();n.Wb(0,"mat-card",1),n.Wb(1,"mat-card-content"),n.Hc(2,et,6,3,"div",2),n.Wb(3,"div"),n.Wb(4,"div",3),n.Jc(5),n.Vb(),n.Vb(),n.Wb(6,"bd2-data-sheet-mdtable",4),n.ec("selected",(function(t){return n.Ac(e),n.ic().selectLabels(t)})),n.Vb(),n.Wb(7,"div"),n.Jc(8," \xa0 "),n.Hc(9,tt,2,1,"div",5),n.Vb(),n.Vb(),n.Vb()}if(2&e){const e=n.ic();n.Cb(2),n.oc("ngIf",e.labelsSelection),n.Cb(2),n.Eb(e.labelsSelection?"alert alert-info":"alert alert-danger"),n.Cb(1),n.Lc(" Click on the ",e.importDetails.inLabelNeg," containing labels. "),n.Cb(1),n.oc("dataSlice",e.dataSlice)("selectableColHeader",e.importDetails.inRows)("selectableRowHeader",!e.importDetails.inRows)("styler",e.tableSelector.tableStyler),n.Cb(3),n.oc("ngIf",e.hasMoreLabels())}}let st=(()=>{class e extends ee{constructor(e,t){super(e,t)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.labelsSelection&&!this.labelsSelection.fake)this.selectLabels(this.reselect(this.labelsSelection));else if(this.firstTimeCell){const e=this.reselect(new l.a(this.firstTimeCell.colIx-1,this.colNumber(this.firstTimeCell.colIx-1),void 0,this.firstTimeCell.rowIx-1,this.rowNumber(this.firstTimeCell.rowIx-1),void 0,void 0));e.fake=!0,this.selectLabels(e)}}markSelections(){super.markSelections(),this.markFirstTime()}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(W),n.Qb(R.a))},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-import-labels-step"]],inputs:{importDetails:"importDetails"},features:[n.zb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],["role","alert"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(e,t){1&e&&n.Hc(0,it,10,9,"mat-card",0),2&e&&n.oc("ngIf",t.importDetails)},directives:[s.m,V.a,V.c,me],encapsulation:2}),e})();function ot(e,t){if(1&e&&(n.Wb(0,"div",5),n.Jc(1),n.Vb()),2&e){const e=n.ic(3);n.Cb(1),n.Mc(" Data start ",e.importDetails.inLabel," must be after time ",e.importDetails.inLabel,". ")}}function at(e,t){if(1&e&&(n.Wb(0,"div"),n.Wb(1,"p"),n.Jc(2),n.Wb(3,"strong"),n.Jc(4),n.Vb(),n.Vb(),n.Hc(5,ot,2,2,"div",4),n.Vb()),2&e){const e=n.ic(2);n.Cb(2),n.Lc("Data starts in ",e.importDetails.inLabel," "),n.Cb(2),n.Lc("",e.importDetails.inRows?e.dataStart.rowName:e.dataStart.colName,";"),n.Cb(1),n.oc("ngIf",!e.importDetails.isDataAfterTime())}}function lt(e,t){if(1&e){const e=n.Xb();n.Wb(0,"mat-card",1),n.Wb(1,"mat-card-content"),n.Hc(2,at,6,3,"div",2),n.Wb(3,"div"),n.Wb(4,"div"),n.Jc(5),n.Vb(),n.Vb(),n.Wb(6,"bd2-data-sheet-mdtable",3),n.ec("selected",(function(t){return n.Ac(e),n.ic().selectDataStart(t)})),n.Vb(),n.Vb(),n.Vb()}if(2&e){const e=n.ic();n.Cb(2),n.oc("ngIf",e.dataStart),n.Cb(2),n.Eb(e.dataStart?"alert alert-info":"alert alert-danger"),n.Cb(1),n.Lc(" Click on the first data ",e.importDetails.inLabel,". "),n.Cb(1),n.oc("dataSlice",e.dataSlice)("selectableColHeader",!e.importDetails.inRows)("selectableRowHeader",e.importDetails.inRows)("styler",e.tableSelector.tableStyler)}}let rt=(()=>{class e extends ee{constructor(e,t){super(e,t)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.dataStart&&!this.dataStart.fake)this.selectDataStart(this.reselect(this.dataStart));else if(this.firstTimeCell){const e=this.reselect(new l.a(this.firstTimeCell.colIx+1,this.colNumber(this.firstTimeCell.colIx+1),void 0,this.firstTimeCell.rowIx+1,this.rowNumber(this.firstTimeCell.rowIx+1),void 0,void 0));e.fake=!0,this.selectDataStart(e)}}markSelections(){super.markSelections(),this.markFirstTime(),this.markLabels()}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(W),n.Qb(R.a))},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-select-data-start-step"]],inputs:{importDetails:"importDetails"},features:[n.zb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(e,t){1&e&&n.Hc(0,lt,7,8,"mat-card",0),2&e&&n.oc("ngIf",t.importDetails)},directives:[s.m,V.a,V.c,me],encapsulation:2}),e})();var nt=i("FtGj"),ct=i("JX91"),bt=i("A5z7"),mt=i("/1cH"),dt=i("NFeN");const ut=["backgroundInput"],ht=["auto"];function pt(e,t){1&e&&(n.Wb(0,"mat-icon",14),n.Jc(1,"cancel"),n.Vb())}function ft(e,t){if(1&e){const e=n.Xb();n.Wb(0,"mat-chip",12),n.ec("removed",(function(i){n.Ac(e);const s=t.$implicit;return n.ic(2).remove(s)})),n.Jc(1),n.Hc(2,pt,2,0,"mat-icon",13),n.Vb()}if(2&e){const e=t.$implicit,i=n.ic(2);n.oc("selectable",i.selectable)("removable",i.removable),n.Cb(1),n.Lc(" ",e," "),n.Cb(1),n.oc("ngIf",i.removable)}}function gt(e,t){if(1&e&&(n.Wb(0,"mat-option",15),n.Jc(1),n.Vb()),2&e){const e=t.$implicit;n.oc("value",e),n.Cb(1),n.Lc(" ",e," ")}}function wt(e,t){if(1&e){const e=n.Xb();n.Wb(0,"div"),n.Wb(1,"mat-card",1),n.Wb(2,"mat-card-content"),n.Wb(3,"div",2),n.Jc(4," Select labels for which data should be treated as the background noise "),n.Vb(),n.Wb(5,"mat-form-field",3),n.Wb(6,"mat-chip-list",4,5),n.Hc(8,ft,3,4,"mat-chip",6),n.Wb(9,"input",7,8),n.ec("matChipInputTokenEnd",(function(t){return n.Ac(e),n.ic().add(t)})),n.Vb(),n.Vb(),n.Wb(11,"mat-autocomplete",9,10),n.ec("optionSelected",(function(t){return n.Ac(e),n.ic().selected(t)})),n.Hc(13,gt,2,2,"mat-option",11),n.jc(14,"async"),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Vb()}if(2&e){const e=n.xc(7),t=n.xc(12),i=n.ic();n.Cb(8),n.oc("ngForOf",i.backgrounds),n.Cb(1),n.oc("formControl",i.backgroundCtrl)("matAutocomplete",t)("matChipInputFor",e)("matChipInputSeparatorKeyCodes",i.separatorKeysCodes)("matChipInputAddOnBlur",i.addOnBlur),n.Cb(4),n.oc("ngForOf",n.kc(14,7,i.filteredLabels))}}let Ct=(()=>{class e{constructor(e){this.tsFileService=e,this.selectable=!0,this.removable=!0,this.addOnBlur=!1,this.separatorKeysCodes=[nt.g,nt.c],this.backgroundCtrl=new o.e,this.allLabels=[]}get backgrounds(){return this.importDetails?this.importDetails.backgroundsLabels:[]}set backgrounds(e){this.importDetails.backgroundsLabels=e}ngOnInit(){this.filteredLabels=this.backgroundCtrl.valueChanges.pipe(Object(ct.a)(null),Object(S.a)(e=>e?this.filter(e):this.allLabels))}loadLabels(){this.importDetails&&this.importDetails.fileId?this.importDetails.importLabels?this.importDetails.labelsSelection&&this.tsFileService.previewLabels(this.importDetails.fileId,this.importDetails.importFormat.name,this.importDetails.labelsSelection,this.importDetails.inRows).subscribe(e=>{this.updateAllLabels(this.unique(e))}):this.updateAllLabels(this.unique(this.importDetails.userLabels)):this.updateAllLabels([])}updateAllLabels(e){this.allLabels=e.slice().sort();const t=this.backgrounds||[];this.backgrounds=[],t.forEach(e=>this.addBackground(e)),this.backgroundCtrl.setValue(" "),this.backgroundCtrl.setValue(null)}unique(e){return e=e.filter(e=>!!e).map(e=>e.trim()),[...new Set(e)]}addBackground(e){if((e||"").trim()){const t=this.backgrounds.indexOf(e),i=this.allLabels.indexOf(e);t<0&&i>=0&&this.backgrounds.push(e.trim())}}add(e){if(!this.matAutocomplete.isOpen){const t=e.input;this.addBackground(e.value),t&&(t.value=""),this.backgroundCtrl.setValue(null)}}remove(e){const t=this.backgrounds.indexOf(e);t>=0&&this.backgrounds.splice(t,1)}selected(e){this.addBackground(e.option.viewValue),this.backgroundInput.nativeElement.value="",this.backgroundCtrl.setValue(null)}filter(e){const t=e.toLowerCase();return this.allLabels.filter(e=>e.toLowerCase().includes(t)).slice(0,7)}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(L))},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-select-backgrounds-labels-step"]],viewQuery:function(e,t){var i;1&e&&(n.Pc(ut,!0),n.Pc(ht,!0)),2&e&&(n.wc(i=n.fc())&&(t.backgroundInput=i.first),n.wc(i=n.fc())&&(t.matAutocomplete=i.first))},inputs:{importDetails:"importDetails"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"mat-elevation-z4"],["type","info","role","alert",1,"alert","alert-info"],[2,"width","100%"],["aria-label","Backgrounds selection"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder","Type to select background label...",3,"formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["backgroundInput",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"selectable","removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"]],template:function(e,t){1&e&&n.Hc(0,wt,15,9,"div",0),2&e&&n.oc("ngIf",null==t.importDetails?null:t.importDetails.containsBackgrounds)},directives:[s.m,V.a,V.c,N.b,bt.c,s.l,o.c,mt.c,bt.b,o.p,o.f,mt.a,bt.a,dt.a,bt.d,x.o],pipes:[s.b],encapsulation:2}),e})();const St=["stepper"],Dt=["importLabelsStep"],vt=["assignLabelsStep"],kt=["selectBackgroundsStep"];function Lt(e,t){1&e&&n.Jc(0,"Upload data file")}function Wt(e,t){1&e&&n.Jc(0,"Data layout")}function Rt(e,t){if(1&e&&n.Jc(0),2&e){const e=n.ic();n.Lc("Define time ",e.importDetails.inLabel,"")}}function It(e,t){1&e&&n.Jc(0,"Label data")}function Vt(e,t){if(1&e){const e=n.Xb();n.Ub(0),n.Wb(1,"mat-step",12),n.Hc(2,It,1,0,"ng-template",2),n.Rb(3,"mat-divider"),n.Rb(4,"bd2-import-details-summary",19),n.Rb(5,"bd2-assign-labels-step",4,20),n.Wb(7,"div"),n.Wb(8,"button",10),n.Jc(9,"Back"),n.Vb(),n.Wb(10,"button",14),n.ec("click",(function(t){return n.Ac(e),n.ic().startChoosingBackgrounds()})),n.Jc(11,"Next"),n.Vb(),n.Vb(),n.Vb(),n.Tb()}if(2&e){const e=n.ic();n.Cb(1),n.oc("completed",e.importDetails.areLabelsCorrectlyAssigned()),n.Cb(3),n.oc("importDetails",e.importDetails)("showTime",!0),n.Cb(1),n.oc("importDetails",e.importDetails),n.Cb(5),n.oc("disabled",!e.importDetails.areLabelsCorrectlyAssigned())}}function Nt(e,t){if(1&e&&n.Jc(0),2&e){const e=n.ic(2);n.Lc("Select labels ",e.importDetails.inLabelNeg,"")}}function yt(e,t){1&e&&n.Jc(0,"Select data start")}function Tt(e,t){if(1&e){const e=n.Xb();n.Ub(0),n.Wb(1,"mat-step",12),n.Hc(2,Nt,1,1,"ng-template",2),n.Rb(3,"mat-divider"),n.Rb(4,"bd2-import-details-summary",19),n.Rb(5,"bd2-import-labels-step",4,21),n.Wb(7,"div"),n.Wb(8,"button",10),n.Jc(9,"Back"),n.Vb(),n.Wb(10,"button",14),n.ec("click",(function(t){n.Ac(e);const i=n.xc(17);return n.ic().loadData(i)})),n.Jc(11,"Next"),n.Vb(),n.Vb(),n.Vb(),n.Wb(12,"mat-step",12),n.Hc(13,yt,1,0,"ng-template",2),n.Rb(14,"mat-divider"),n.Rb(15,"bd2-import-details-summary",22),n.Rb(16,"bd2-select-data-start-step",4,23),n.Wb(18,"div"),n.Wb(19,"button",10),n.Jc(20,"Back"),n.Vb(),n.Wb(21,"button",14),n.ec("click",(function(t){return n.Ac(e),n.ic().startChoosingBackgrounds()})),n.Jc(22,"Next"),n.Vb(),n.Vb(),n.Vb(),n.Tb()}if(2&e){const e=n.ic();n.Cb(1),n.oc("completed",e.importDetails.areLabelsCorrectlySelected()),n.Cb(3),n.oc("importDetails",e.importDetails)("showTime",!0),n.Cb(1),n.oc("importDetails",e.importDetails),n.Cb(5),n.oc("disabled",!e.importDetails.areLabelsCorrectlySelected()),n.Cb(2),n.oc("completed",e.importDetails.areLabelsCorrectlySelected()&&e.importDetails.isDataStartCorrectlySelected()),n.Cb(3),n.oc("importDetails",e.importDetails)("showTime",!0)("showLabelling",!0),n.Cb(1),n.oc("importDetails",e.importDetails),n.Cb(5),n.oc("disabled",!e.importDetails.isDataStartCorrectlySelected())}}function xt(e,t){1&e&&n.Jc(0,"Select backgrounds labels")}function Bt(e,t){if(1&e&&(n.Ub(0),n.Wb(1,"mat-step"),n.Hc(2,xt,1,0,"ng-template",2),n.Rb(3,"mat-divider"),n.Rb(4,"bd2-import-details-summary",16),n.Rb(5,"bd2-select-backgrounds-labels-step",4,24),n.Wb(7,"div"),n.Wb(8,"button",10),n.Jc(9,"Back"),n.Vb(),n.Wb(10,"button",25),n.Jc(11,"Next"),n.Vb(),n.Vb(),n.Vb(),n.Tb()),2&e){const e=n.ic();n.Cb(4),n.oc("importDetails",e.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),n.Cb(1),n.oc("importDetails",e.importDetails)}}function Ot(e,t){1&e&&n.Jc(0,"Import timeseries")}let Ht=(()=>{class e{constructor(e,t,i){this.fileService=e,this.feedback=t,this.dataService=i,this.import=new n.o,this.oldImport=new n.o,this.blocked=!1,this.importDetails=new l.b,this.importDetails.timeType=m.h.TIME_IN_HOURS}ngOnInit(){}ngOnDestroy(){this.dataService&&this.dataService.close()}upload(e){e.files&&1===e.files.length?this.fileService.uploadFile(e.files[0],e.importFormat).subscribe(t=>{this.importDetails.fileId=t,this.importDetails.fileName=e.files[0].name,this.importDetails.importFormat=e.importFormat,this.importDetails.inRows=e.importFormat!=l.e.EXCEL_TABLE,this.stepper.next(),e.importFormat==l.e.TOPCOUNT&&this.oldImport.next(this.importDetails)},e=>{this.feedback.error(e)}):console.error("Wrong upload files size",e.files)}loadData(e){e.loadData()}startLabelling(){this.importDetails.importLabels?this.importLabelsStep?this.importLabelsStep.loadData():console.error("Missing importLabelStep"):this.assignLabelsStep?this.assignLabelsStep.loadData():console.error("Missing assignLabelsStep")}startChoosingBackgrounds(){this.importDetails.containsBackgrounds&&(this.selectBackgroundsStep?this.selectBackgroundsStep.loadLabels():console.error("Missing selectBackgroundsStep"))}importData(){this.importDetails.isComplete()&&this.import.next(this.importDetails)}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(L),n.Qb(R.a),n.Qb(W))},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-import-steps"]],viewQuery:function(e,t){var i;1&e&&(n.Pc(St,!0),n.Pc(Dt,!0),n.Pc(vt,!0),n.Pc(kt,!0)),2&e&&(n.wc(i=n.fc())&&(t.stepper=i.first),n.wc(i=n.fc())&&(t.importLabelsStep=i.first),n.wc(i=n.fc())&&(t.assignLabelsStep=i.first),n.wc(i=n.fc())&&(t.selectBackgroundsStep=i.first))},inputs:{blocked:"blocked"},outputs:{import:"import",oldImport:"oldImport"},features:[n.Bb([W])],decls:62,vars:26,consts:[[3,"linear"],["stepper",""],["matStepLabel",""],[3,"uploadFiles"],[3,"importDetails"],[1,"mat-elevation-z4"],["name","inRows",1,"spaced",3,"ngModel","ngModelChange"],[3,"value"],["name","importLabels",1,"spaced",3,"ngModel","ngModelChange"],["name","containsBackgrounds",1,"spaced",3,"ngModel","ngModelChange"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","type","button",3,"click"],[3,"completed"],["defineTimeStep",""],["mat-button","","matStepperNext","","type","button",3,"disabled","click"],[4,"ngIf"],[3,"importDetails","showTime","showLabelling","showDataStart"],["type","info","role","alert",1,"alert","alert-info"],["mat-button","",3,"disabled","click"],[3,"importDetails","showTime"],["assignLabelsStep",""],["importLabelsStep",""],[3,"importDetails","showTime","showLabelling"],["selectDataStartStep",""],["selectBackgroundsStep",""],["mat-button","","matStepperNext","","type","button"]],template:function(e,t){if(1&e){const e=n.Xb();n.Wb(0,"mat-vertical-stepper",0,1),n.Wb(2,"mat-step"),n.Hc(3,Lt,1,0,"ng-template",2),n.Wb(4,"bd2-upload-data-file-step",3),n.ec("uploadFiles",(function(e){return t.upload(e)})),n.Vb(),n.Vb(),n.Wb(5,"mat-step"),n.Wb(6,"form"),n.Hc(7,Wt,1,0,"ng-template",2),n.Rb(8,"mat-divider"),n.Rb(9,"bd2-import-details-summary",4),n.Wb(10,"mat-card",5),n.Wb(11,"mat-card-content"),n.Wb(12,"p"),n.Wb(13,"mat-radio-group",6),n.ec("ngModelChange",(function(e){return t.importDetails.inRows=e})),n.Wb(14,"mat-radio-button",7),n.Jc(15,"Data in rows"),n.Vb(),n.Wb(16,"mat-radio-button",7),n.Jc(17,"Data in columns"),n.Vb(),n.Vb(),n.Vb(),n.Wb(18,"p"),n.Wb(19,"mat-radio-group",8),n.ec("ngModelChange",(function(e){return t.importDetails.importLabels=e})),n.Wb(20,"mat-radio-button",7),n.Jc(21),n.Vb(),n.Wb(22,"mat-radio-button",7),n.Jc(23,"Manually label"),n.Vb(),n.Vb(),n.Vb(),n.Wb(24,"p"),n.Wb(25,"mat-radio-group",9),n.ec("ngModelChange",(function(e){return t.importDetails.containsBackgrounds=e})),n.Wb(26,"mat-radio-button",7),n.Jc(27,"No noise data"),n.Vb(),n.Wb(28,"mat-radio-button",7),n.Jc(29),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Wb(30,"mat-card-actions"),n.Wb(31,"button",10),n.Jc(32,"Back"),n.Vb(),n.Wb(33,"button",11),n.ec("click",(function(i){n.Ac(e);const s=n.xc(40);return t.loadData(s)})),n.Jc(34,"Next"),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Wb(35,"mat-step",12),n.Hc(36,Rt,1,1,"ng-template",2),n.Rb(37,"mat-divider"),n.Rb(38,"bd2-import-details-summary",4),n.Rb(39,"bd2-define-time-step",4,13),n.Wb(41,"div"),n.Wb(42,"button",10),n.Jc(43,"Back"),n.Vb(),n.Wb(44,"button",14),n.ec("click",(function(e){return t.startLabelling()})),n.Jc(45,"Next"),n.Vb(),n.Vb(),n.Vb(),n.Hc(46,Vt,12,5,"ng-container",15),n.Hc(47,Tt,23,11,"ng-container",15),n.Hc(48,Bt,12,5,"ng-container",15),n.Wb(49,"mat-step",12),n.Hc(50,Ot,1,0,"ng-template",2),n.Rb(51,"mat-divider"),n.Rb(52,"bd2-import-details-summary",16),n.Wb(53,"mat-card",5),n.Wb(54,"mat-card-content"),n.Wb(55,"div",17),n.Jc(56,"You can now import the timeseries"),n.Vb(),n.Vb(),n.Vb(),n.Wb(57,"div"),n.Wb(58,"button",10),n.Jc(59,"Back"),n.Vb(),n.Wb(60,"button",18),n.ec("click",(function(e){return t.importData()})),n.Jc(61,"Import data"),n.Vb(),n.Vb(),n.Vb(),n.Vb()}2&e&&(n.oc("linear",!0),n.Cb(9),n.oc("importDetails",t.importDetails),n.Cb(4),n.oc("ngModel",t.importDetails.inRows),n.Cb(1),n.oc("value",!0),n.Cb(2),n.oc("value",!1),n.Cb(3),n.oc("ngModel",t.importDetails.importLabels),n.Cb(1),n.oc("value",!0),n.Cb(1),n.Lc("Import labels from ",t.importDetails.inLabelNeg,""),n.Cb(1),n.oc("value",!1),n.Cb(3),n.oc("ngModel",t.importDetails.containsBackgrounds),n.Cb(1),n.oc("value",!1),n.Cb(2),n.oc("value",!0),n.Cb(1),n.Lc("Background noise in ",t.importDetails.inLabel,"s"),n.Cb(6),n.oc("completed",t.importDetails.isTimeDefined()),n.Cb(3),n.oc("importDetails",t.importDetails),n.Cb(1),n.oc("importDetails",t.importDetails),n.Cb(5),n.oc("disabled",!t.importDetails.isTimeDefined()),n.Cb(2),n.oc("ngIf",!t.importDetails.importLabels),n.Cb(1),n.oc("ngIf",t.importDetails.importLabels),n.Cb(1),n.oc("ngIf",t.importDetails.containsBackgrounds),n.Cb(1),n.oc("completed",t.importDetails.isComplete()),n.Cb(3),n.oc("importDetails",t.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),n.Cb(8),n.oc("disabled",t.blocked||!t.importDetails.isComplete()))},directives:[I.f,I.a,I.b,P,o.C,o.q,o.r,A.a,X,V.a,V.c,$.b,o.p,o.s,$.a,V.b,Q.a,I.e,I.d,Ce,s.m,Ye,st,rt,Ct],encapsulation:2}),e})();var Ft=i("Xa2L");function Jt(e,t){1&e&&(n.Wb(0,"mat-card"),n.Wb(1,"mat-card-content"),n.Rb(2,"mat-spinner",2),n.Wb(3,"div",3),n.Jc(4,"Importing ...."),n.Vb(),n.Vb(),n.Vb())}const Pt=[{path:"",children:[{path:"",component:(()=>{class e extends r.a{constructor(e,t){super(t),this.BD2REST=e,this.importing=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit()}importData(e){if(this.importing)return;const t=new l.d;t.fileId=e.fileId,t.importFormat=e.importFormat,t.importParameters=e,this.importing=!0,this.BD2REST.experimentImportTS(this.assay.id,t).subscribe(e=>{this.feedback.success("Imported "+e.imported+" timeseries"),this.refreshModel(),this.importing=!1,this.goToTSView()},e=>{this.importing=!1,this.feedback.error(e)})}goToTSView(){const e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}goToOldImport(e){const t=this.expHomePath();t.push("data","ts-old-import",e.importFormat.name,e.fileId),this.router.navigate(t)}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(c.a),n.Qb(b.a))},e.\u0275cmp=n.Kb({type:e,selectors:[["bd2-tsimport-dashboard"]],features:[n.zb],decls:2,vars:1,consts:[[3,"import","oldImport"],[4,"ngIf"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"]],template:function(e,t){1&e&&(n.Wb(0,"bd2-import-steps",0),n.ec("import",(function(e){return t.importData(e)}))("oldImport",(function(e){return t.goToOldImport(e)})),n.Vb(),n.Hc(1,Jt,5,0,"mat-card",1)),2&e&&(n.Cb(1),n.oc("ngIf",t.importing))},directives:[Ht,s.m,V.a,V.c,Ft.b],encapsulation:2}),e})()}]}];let At=(()=>{class e{}return e.\u0275mod=n.Ob({type:e}),e.\u0275inj=n.Nb({factory:function(t){return new(t||e)},imports:[[a.f.forChild(Pt)],a.f]}),e})();var _t=i("YiFe"),Mt=i("ZTEM");i.d(t,"TsImportModule",(function(){return Et}));let Et=(()=>{class e{}return e.\u0275mod=n.Ob({type:e}),e.\u0275inj=n.Nb({factory:function(t){return new(t||e)},imports:[[s.c,o.j,o.x,_t.a,Mt.a,At]]}),e})()}}]);