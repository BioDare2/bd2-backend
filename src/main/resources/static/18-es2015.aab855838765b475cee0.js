(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{QftV:function(t,e,i){"use strict";i.r(e),i.d(e,"TsHeatmapModule",(function(){return Ve}));var n=i("ofXK"),a=i("3Pt+"),r=i("M9IT"),o=i("tyNb"),s=i("yYXI"),c=i("Kj3r"),h=i("bngM"),l=i("QBpm"),g=i("Iab2"),u=i("e8YO"),d=i("K5d1"),p=i("fXoL"),b=i("vejM"),m=i("ZMwR"),f=i("GVyA"),x=i("wcxA"),y=i("Tl2h"),v=i("1jcm"),w=i("8LU1"),M=i("bTqV");function S(t,e){if(1&t&&(p.Wb(0,"option",16),p.Gc(1),p.Vb()),2&t){const t=e.$implicit;p.oc("value",t),p.Cb(1),p.Ic(" ",t,"")}}function O(t,e){if(1&t){const t=p.Xb();p.Wb(0,"div"),p.Wb(1,"select",14),p.ec("ngModelChange",(function(e){return p.xc(t),p.ic()._changePageSize(e)})),p.Ec(2,S,2,2,"option",15),p.Vb(),p.Vb()}if(2&t){const t=p.ic();p.Cb(1),p.oc("ngModel",t.pageSize),p.Cb(1),p.oc("ngForOf",t._displayedPageSizeOptions)}}function k(t,e){if(1&t&&(p.Wb(0,"div",17),p.Gc(1),p.Vb()),2&t){const t=p.ic();p.Cb(1),p.Ic("",t.pageSize," ")}}let P=(()=>{class t{constructor(t){this._changeDetectorRef=t,this._pageIndex=0,this._length=0,this._pageSizeOptions=[],this.disabled=!1,this.page=new p.o,this.getRangeLabel=(t,e,i)=>{if(0==i||0==e)return"0 of "+i;const n=t*e;return`${n+1} \u2013 ${n<(i=Math.max(i,0))?Math.min(n+e,i):n+e} of ${i}`}}get pageIndex(){return this._pageIndex}set pageIndex(t){this._pageIndex=Math.max(Object(w.f)(t),0),this._changeDetectorRef.markForCheck()}get length(){return this._length}set length(t){this._length=Object(w.f)(t),this._changeDetectorRef.markForCheck()}get pageSize(){return this._pageSize}set pageSize(t){this._pageSize=Math.max(Object(w.f)(t),0),this._updateDisplayedPageSizeOptions()}get pageSizeOptions(){return this._pageSizeOptions}set pageSizeOptions(t){this._pageSizeOptions=(t||[]).map(t=>Object(w.f)(t)),this._updateDisplayedPageSizeOptions()}ngOnInit(){this._updateDisplayedPageSizeOptions()}nextPage(){if(!this.hasNextPage())return;const t=this.pageIndex;this.pageIndex++,this._emitPageEvent(t)}previousPage(){if(!this.hasPreviousPage())return;const t=this.pageIndex;this.pageIndex--,this._emitPageEvent(t)}hasPreviousPage(){return this.pageIndex>=1&&0!=this.pageSize}hasNextPage(){const t=this.getNumberOfPages()-1;return this.pageIndex<t&&0!=this.pageSize}getNumberOfPages(){return this.pageSize?Math.ceil(this.length/this.pageSize):0}_nextButtonsDisabled(){return this.disabled||!this.hasNextPage()}_previousButtonsDisabled(){return this.disabled||!this.hasPreviousPage()}_updateDisplayedPageSizeOptions(){this.pageSize||(this._pageSize=0!=this.pageSizeOptions.length?this.pageSizeOptions[0]:50),this._displayedPageSizeOptions=this.pageSizeOptions.slice(),-1===this._displayedPageSizeOptions.indexOf(this.pageSize)&&this._displayedPageSizeOptions.push(this.pageSize),this._displayedPageSizeOptions.sort((t,e)=>t-e),this._changeDetectorRef.markForCheck()}_changePageSize(t){const e=this.pageIndex;this.pageIndex=Math.floor(this.pageIndex*this.pageSize/t)||0,this.pageSize=t,this._emitPageEvent(e)}_emitPageEvent(t){this.page.emit({previousPageIndex:t,pageIndex:this.pageIndex,pageSize:this.pageSize,length:this.length})}}return t.\u0275fac=function(e){return new(e||t)(p.Qb(p.h))},t.\u0275cmp=p.Kb({type:t,selectors:[["bd2-simple-paginator"]],inputs:{pageIndex:"pageIndex",length:"length",pageSize:"pageSize",pageSizeOptions:"pageSizeOptions",disabled:"disabled"},outputs:{page:"page"},decls:17,vars:7,consts:[[1,"mat-paginator"],[1,"mat-paginator-outer-container"],[1,"mat-paginator-container"],[1,"mat-paginator-page-size"],[1,"mat-paginator-page-size-label"],[4,"ngIf"],["class","mat-paginator-page-size-value",4,"ngIf"],[1,"mat-paginator-range-actions"],[1,"mat-paginator-range-label"],["mat-icon-button","","type","button",1,"mat-paginator-navigation-previous",3,"disabled","click"],["viewBox","0 0 24 24","focusable","false",1,"mat-paginator-icon"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["mat-icon-button","","type","button",1,"mat-paginator-navigation-next",3,"disabled","click"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],["required","",1,"mat-paginator-page-size-select",2,"font-size","12px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mat-paginator-page-size-value"]],template:function(t,e){1&t&&(p.Wb(0,"div",0),p.Wb(1,"div",1),p.Wb(2,"div",2),p.Wb(3,"div",3),p.Wb(4,"div",4),p.Gc(5," Items per page: "),p.Vb(),p.Ec(6,O,3,2,"div",5),p.Ec(7,k,2,1,"div",6),p.Vb(),p.Wb(8,"div",7),p.Wb(9,"div",8),p.Gc(10),p.Vb(),p.Wb(11,"button",9),p.ec("click",(function(){return e.previousPage()})),p.hc(),p.Wb(12,"svg",10),p.Rb(13,"path",11),p.Vb(),p.Vb(),p.gc(),p.Wb(14,"button",12),p.ec("click",(function(){return e.nextPage()})),p.hc(),p.Wb(15,"svg",10),p.Rb(16,"path",13),p.Vb(),p.Vb(),p.Vb(),p.Vb(),p.Vb(),p.Vb()),2&t&&(p.Cb(6),p.oc("ngIf",e._displayedPageSizeOptions.length>1),p.Cb(1),p.oc("ngIf",e._displayedPageSizeOptions.length<=1),p.Cb(3),p.Ic(" ",e.getRangeLabel(e.pageIndex,e.pageSize,e.length)," "),p.Cb(1),p.oc("disabled",e._previousButtonsDisabled()),p.Db("aria-label","previous page"),p.Cb(3),p.oc("disabled",e._nextButtonsDisabled()),p.Db("aria-label","next page"))},directives:[n.m,M.a,a.z,a.y,a.p,a.s,n.l,a.t,a.B],styles:[".mat-paginator-icon[_ngcontent-%COMP%] {\n        width: 28px;\n        fill: currentColor;\n\n      }\n\n      .mat-paginator-range-actions[_ngcontent-%COMP%] {\n        display: flex;\n        align-items: center;\n      }\n\n      .mat-paginator[_ngcontent-%COMP%] {\n        display: block;\n      }\n\n      .mat-paginator-outer-container[_ngcontent-%COMP%] {\n        display: flex;\n      }\n\n      .mat-paginator-container[_ngcontent-%COMP%] {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        min-height: 56px;\n        padding: 0 8px;\n        flex-wrap: wrap-reverse;\n        width: 100%;\n      }\n\n      .mat-paginator-page-size[_ngcontent-%COMP%] {\n        display: flex;\n        align-items: baseline;\n        margin-right: 8px;\n      }\n\n      .mat-paginator-page-size-label[_ngcontent-%COMP%] {\n        margin: 0 4px;\n      }\n\n      .mat-paginator-page-size-select[_ngcontent-%COMP%] {\n        margin: 6px 4px 0 4px;\n        width: 70px;\n\n      }\n\n      .mat-paginator-range-label[_ngcontent-%COMP%] {\n        margin:  0 32px 0 24px;\n      }"],changeDetection:0}),t})();function W(t,e){if(1&t&&(p.Wb(0,"option",28),p.Gc(1),p.Vb()),2&t){const t=e.$implicit;p.oc("value",t.name),p.Cb(1),p.Hc(t.label)}}function B(t,e){if(1&t&&(p.Wb(0,"option",28),p.Gc(1),p.Vb()),2&t){const t=e.$implicit;p.oc("value",t.name),p.Cb(1),p.Hc(t.label)}}function C(t,e){if(1&t&&(p.Wb(0,"option",28),p.Gc(1),p.Vb()),2&t){const t=e.$implicit;p.oc("value",t.name),p.Cb(1),p.Hc(t.label)}}const V=function(){return[10,25,50,100,200,500]};let D=(()=>{class t extends x.a{constructor(t){super(t),this.alignOptions=[new y.e("NONE","none"),new y.e("MEAN","mean")];const e=this.normalisationOptions.find(t=>"RANGE"===t.name);this.displayParamsForm.get("normalisation").setValue(null==e?void 0:e.name),this.displayParamsForm.get("hourly").setValue(!0)}}return t.\u0275fac=function(e){return new(e||t)(p.Qb(a.d))},t.\u0275cmp=p.Kb({type:t,selectors:[["bd2-heatmap-display-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},features:[p.zb],decls:46,vars:10,consts:[["role","form",1,"form-horizontal","container",3,"formGroup"],[1,"row"],[1,"col-md-8","col-sm-10"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-md-3","col-sm-3"],["for","timeStart",1,"col-md-1","col-sm-2"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-md-1","col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"col-md-2","col-sm-4"],["formControlName","hourly",1,"mr-3"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-3"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-1"],["for","align",1,"col-sm-1"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-2"],["for","normalisation"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],[1,"col-sm"],["formControlName","trimFirst",1,"mr-3"],["formControlName","log2"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],[3,"value"]],template:function(t,e){1&t&&(p.Wb(0,"form",0),p.Wb(1,"div",1),p.Wb(2,"div",2),p.Wb(3,"div",3),p.Wb(4,"label",4),p.Gc(5,"Time range"),p.Vb(),p.Wb(6,"label",5),p.Gc(7,"from:"),p.Vb(),p.Wb(8,"div",4),p.Rb(9,"input",6),p.Vb(),p.Wb(10,"label",7),p.Gc(11,"to:"),p.Vb(),p.Wb(12,"div",4),p.Rb(13,"input",8),p.Vb(),p.Vb(),p.Vb(),p.Wb(14,"div",9),p.Wb(15,"mat-slide-toggle",10),p.Gc(16,"hourly"),p.Vb(),p.Vb(),p.Vb(),p.Wb(17,"div",11),p.Wb(18,"label",12),p.Gc(19,"Detrending"),p.Vb(),p.Wb(20,"div",13),p.Wb(21,"select",14),p.Ec(22,W,2,2,"option",15),p.Vb(),p.Vb(),p.Rb(23,"div",16),p.Wb(24,"label",17),p.Gc(25,"Align"),p.Vb(),p.Wb(26,"div",13),p.Wb(27,"select",18),p.Ec(28,B,2,2,"option",15),p.Vb(),p.Vb(),p.Vb(),p.Wb(29,"div",11),p.Wb(30,"div",19),p.Wb(31,"label",20),p.Gc(32,"Normalize"),p.Vb(),p.Vb(),p.Wb(33,"div",13),p.Wb(34,"select",21),p.Ec(35,C,2,2,"option",15),p.Vb(),p.Vb(),p.Wb(36,"div",22),p.Wb(37,"mat-slide-toggle",23),p.Gc(38,"within range"),p.Vb(),p.Wb(39,"mat-slide-toggle",24),p.Gc(40,"log2 transf."),p.Vb(),p.Vb(),p.Vb(),p.Wb(41,"div",11),p.Rb(42,"label",19),p.Wb(43,"div",25),p.Wb(44,"bd2-simple-paginator",26,27),p.ec("page",(function(t){return e.loadDataPage(t)})),p.Vb(),p.Vb(),p.Vb(),p.Vb()),2&t&&(p.oc("formGroup",e.mainForm),p.Cb(22),p.oc("ngForOf",e.detrendingOptions),p.Cb(6),p.oc("ngForOf",e.alignOptions),p.Cb(7),p.oc("ngForOf",e.normalisationOptions),p.Cb(9),p.oc("length",e.totalTraces)("disabled",e.disabledPagination)("pageSize",e.currentPage.pageSize)("pageIndex",e.currentPage.pageIndex)("pageSizeOptions",p.qc(9,V)))},directives:[a.C,a.q,a.h,a.i,a.u,a.c,a.y,a.p,a.g,v.a,a.z,n.l,P,a.t,a.B],encapsulation:2}),t})();var I=i("7EHt"),z=i("117B"),N=i("XNiG"),T=i("PqYM"),F=Math.sqrt(50),E=Math.sqrt(10),R=Math.sqrt(2);function A(t,e,i){var n=(e-t)/Math.max(0,i),a=Math.floor(Math.log(n)/Math.LN10),r=n/Math.pow(10,a);return a>=0?(r>=F?10:r>=E?5:r>=R?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(r>=F?10:r>=E?5:r>=R?2:1)}var _,H,G=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},j=(1===(_=G).length&&(H=_,_=function(t,e){return G(H(t),e)}),{left:function(t,e,i,n){for(null==i&&(i=0),null==n&&(n=t.length);i<n;){var a=i+n>>>1;_(t[a],e)<0?i=a+1:n=a}return i},right:function(t,e,i,n){for(null==i&&(i=0),null==n&&(n=t.length);i<n;){var a=i+n>>>1;_(t[a],e)>0?n=a:i=a+1}return i}}).right,$=i("6h3Y"),L=i("4xfg"),q=i("WFeF"),K=function(t){return+t},Q=[0,1];function Z(t){return t}function Y(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:(i=isNaN(e)?NaN:.5,function(){return i});var i}function X(t,e,i){var n=t[0],a=t[1],r=e[0],o=e[1];return a<n?(n=Y(a,n),r=i(o,r)):(n=Y(n,a),r=i(r,o)),function(t){return r(n(t))}}function J(t,e,i){var n=Math.min(t.length,e.length)-1,a=new Array(n),r=new Array(n),o=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<n;)a[o]=Y(t[o],t[o+1]),r[o]=i(e[o],e[o+1]);return function(e){var i=j(t,e,1,n)-1;return r[i](a[i](e))}}function U(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function tt(){return function(){var t,e,i,n,a,r,o=Q,s=Q,c=$.a,h=Z;function l(){var t,e,i,c=Math.min(o.length,s.length);return h!==Z&&((t=o[0])>(e=o[c-1])&&(i=t,t=e,e=i),h=function(i){return Math.max(t,Math.min(e,i))}),n=c>2?J:X,a=r=null,g}function g(e){return isNaN(e=+e)?i:(a||(a=n(o.map(t),s,c)))(t(h(e)))}return g.invert=function(i){return h(e((r||(r=n(s,o.map(t),L.a)))(i)))},g.domain=function(t){return arguments.length?(o=Array.from(t,K),l()):o.slice()},g.range=function(t){return arguments.length?(s=Array.from(t),l()):s.slice()},g.rangeRound=function(t){return s=Array.from(t),c=q.a,l()},g.clamp=function(t){return arguments.length?(h=!!t||Z,l()):h!==Z},g.interpolate=function(t){return arguments.length?(c=t,l()):c},g.unknown=function(t){return arguments.length?(i=t,g):i},function(i,n){return t=i,e=n,l()}}()(Z,Z)}function et(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}var it=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nt(t){if(!(e=it.exec(t)))throw new Error("invalid format: "+t);var e;return new at({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function at(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}nt.prototype=at.prototype,at.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var rt,ot,st,ct,ht=function(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,n=t.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+t.slice(i+1)]},lt=function(t){return(t=ht(Math.abs(t)))?t[1]:NaN},gt=function(t,e){var i=ht(t,e);if(!i)return t+"";var n=i[0],a=i[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")},ut={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return gt(100*t,e)},r:gt,s:function(t,e){var i=ht(t,e);if(!i)return t+"";var n=i[0],a=i[1],r=a-(rt=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,o=n.length;return r===o?n:r>o?n+new Array(r-o+1).join("0"):r>0?n.slice(0,r)+"."+n.slice(r):"0."+new Array(1-r).join("0")+ht(t,Math.max(0,e+r-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},dt=function(t){return t},pt=Array.prototype.map,bt=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function mt(t){var e=t.domain;return t.ticks=function(t){var i=e();return function(t,e,i){var n,a,r,o,s=-1;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if((n=e<t)&&(a=t,t=e,e=a),0===(o=A(t,e,i))||!isFinite(o))return[];if(o>0)for(t=Math.ceil(t/o),e=Math.floor(e/o),r=new Array(a=Math.ceil(e-t+1));++s<a;)r[s]=(t+s)*o;else for(t=Math.floor(t*o),e=Math.ceil(e*o),r=new Array(a=Math.ceil(t-e+1));++s<a;)r[s]=(t-s)/o;return n&&r.reverse(),r}(i[0],i[i.length-1],null==t?10:t)},t.tickFormat=function(t,i){var n=e();return function(t,e,i,n){var a,r=function(t,e,i){var n=Math.abs(e-t)/Math.max(0,i),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),r=n/a;return r>=F?a*=10:r>=E?a*=5:r>=R&&(a*=2),e<t?-a:a}(t,e,i);switch((n=nt(null==n?",f":n)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=n.precision||isNaN(a=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(lt(e)/3)))-lt(Math.abs(t)))}(r,o))||(n.precision=a),ct(n,o);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(a=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,lt(e)-lt(t))+1}(r,Math.max(Math.abs(t),Math.abs(e))))||(n.precision=a-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(a=function(t){return Math.max(0,-lt(Math.abs(t)))}(r))||(n.precision=a-2*("%"===n.type))}return st(n)}(n[0],n[n.length-1],null==t?10:t,i)},t.nice=function(i){null==i&&(i=10);var n,a=e(),r=0,o=a.length-1,s=a[r],c=a[o];return c<s&&(n=s,s=c,c=n,n=r,r=o,o=n),(n=A(s,c,i))>0?n=A(s=Math.floor(s/n)*n,c=Math.ceil(c/n)*n,i):n<0&&(n=A(s=Math.ceil(s*n)/n,c=Math.floor(c*n)/n,i)),n>0?(a[r]=Math.floor(s/n)*n,a[o]=Math.ceil(c/n)*n,e(a)):n<0&&(a[r]=Math.ceil(s*n)/n,a[o]=Math.floor(c*n)/n,e(a)),t},t}function ft(){var t=tt();return t.copy=function(){return U(t,ft())},et.apply(t,arguments),mt(t)}ot=function(t){var e,i,n=void 0===t.grouping||void 0===t.thousands?dt:(e=pt.call(t.grouping,Number),i=t.thousands+"",function(t,n){for(var a=t.length,r=[],o=0,s=e[0],c=0;a>0&&s>0&&(c+s+1>n&&(s=Math.max(1,n-c)),r.push(t.substring(a-=s,a+s)),!((c+=s+1)>n));)s=e[o=(o+1)%e.length];return r.reverse().join(i)}),a=void 0===t.currency?"":t.currency[0]+"",r=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?dt:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(pt.call(t.numerals,String)),c=void 0===t.percent?"%":t.percent+"",h=void 0===t.minus?"-":t.minus+"",l=void 0===t.nan?"NaN":t.nan+"";function g(t){var e=(t=nt(t)).fill,i=t.align,g=t.sign,u=t.symbol,d=t.zero,p=t.width,b=t.comma,m=t.precision,f=t.trim,x=t.type;"n"===x?(b=!0,x="g"):ut[x]||(void 0===m&&(m=12),f=!0,x="g"),(d||"0"===e&&"="===i)&&(d=!0,e="0",i="=");var y="$"===u?a:"#"===u&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",v="$"===u?r:/[%p]/.test(x)?c:"",w=ut[x],M=/[defgprs%]/.test(x);function S(t){var a,r,c,u=y,S=v;if("c"===x)S=w(t)+S,t="";else{var O=(t=+t)<0||1/t<0;if(t=isNaN(t)?l:w(Math.abs(t),m),f&&(t=function(t){t:for(var e,i=t.length,n=1,a=-1;n<i;++n)switch(t[n]){case".":a=e=n;break;case"0":0===a&&(a=n),e=n;break;default:if(!+t[n])break t;a>0&&(a=0)}return a>0?t.slice(0,a)+t.slice(e+1):t}(t)),O&&0==+t&&"+"!==g&&(O=!1),u=(O?"("===g?g:h:"-"===g||"("===g?"":g)+u,S=("s"===x?bt[8+rt/3]:"")+S+(O&&"("===g?")":""),M)for(a=-1,r=t.length;++a<r;)if(48>(c=t.charCodeAt(a))||c>57){S=(46===c?o+t.slice(a+1):t.slice(a))+S,t=t.slice(0,a);break}}b&&!d&&(t=n(t,1/0));var k=u.length+t.length+S.length,P=k<p?new Array(p-k+1).join(e):"";switch(b&&d&&(t=n(P+t,P.length?p-S.length:1/0),P=""),i){case"<":t=u+t+S+P;break;case"=":t=u+P+t+S;break;case"^":t=P.slice(0,k=P.length>>1)+u+t+S+P.slice(k);break;default:t=P+u+t+S}return s(t)}return m=void 0===m?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),S.toString=function(){return t+""},S}return{format:g,formatPrefix:function(t,e){var i=g(((t=nt(t)).type="f",t)),n=3*Math.max(-8,Math.min(8,Math.floor(lt(e)/3))),a=Math.pow(10,-n),r=bt[8+n/3];return function(t){return i(a*t)+r}}}}({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),st=ot.format,ct=ot.formatPrefix;var xt=function(t,e,i){t=+t,e=+e,i=(a=arguments.length)<2?(e=t,t=0,1):a<3?1:+i;for(var n=-1,a=0|Math.max(0,Math.ceil((e-t)/i)),r=new Array(a);++n<a;)r[n]=t+n*i;return r};const yt=Symbol("implicit");function vt(){var t=new Map,e=[],i=[],n=yt;function a(a){var r=a+"",o=t.get(r);if(!o){if(n!==yt)return n;t.set(r,o=e.push(a))}return i[(o-1)%i.length]}return a.domain=function(i){if(!arguments.length)return e.slice();e=[],t=new Map;for(const n of i){const i=n+"";t.has(i)||t.set(i,e.push(n))}return a},a.range=function(t){return arguments.length?(i=Array.from(t),a):i.slice()},a.unknown=function(t){return arguments.length?(n=t,a):n},a.copy=function(){return vt(e,i).unknown(n)},et.apply(a,arguments),a}var wt=i("FmoU"),Mt=i("CKiT"),St=i("lJxs"),Ot=i("vkgz");function kt(t,e){if(1&t&&(p.hc(),p.Wb(0,"svg",2),p.Wb(1,"defs"),p.Wb(2,"filter",3),p.Rb(3,"feDropShadow",4),p.Vb(),p.Wb(4,"pattern",5),p.Rb(5,"line",6),p.Vb(),p.Vb(),p.Wb(6,"g",7),p.Rb(7,"g",8),p.Rb(8,"g",9),p.Rb(9,"g",10),p.Rb(10,"g",11),p.Rb(11,"g",12),p.Vb(),p.Vb()),2&t){const t=p.ic();p.Db("viewBox",t.graphic.viewBox),p.Cb(6),p.Db("transform",t.graphic.mainPaneTransform),p.Cb(1),p.oc("graphic",t.graphic),p.Cb(1),p.oc("graphic",t.graphic),p.Cb(1),p.oc("graphic",t.graphic)("series",t.series),p.Cb(1),p.oc("graphic",t.graphic)("data",t.series)("alwaysOn",t.labelsAlwaysOn),p.Cb(1),p.oc("graphic",t.graphic)}}const Pt=["text"],Wt=["bd2hm-tooltip",""];function Bt(t,e){if(1&t&&(p.hc(),p.Wb(0,"g",1),p.Wb(1,"g"),p.Rb(2,"rect"),p.Wb(3,"text",null,2),p.Wb(5,"tspan",3),p.Gc(6),p.Vb(),p.Wb(7,"tspan",4),p.Gc(8),p.Vb(),p.Vb(),p.Vb(),p.Vb()),2&t){const t=p.ic();p.Db("display",t.show?void 0:"none")("transform",t.position),p.Cb(1),p.Db("opacity",t.ready?1:0),p.Cb(1),p.Db("x",t.textBX)("width",t.textBWidth)("y",t.textBY)("height",t.textBHeight),p.Cb(4),p.Hc(t.label),p.Cb(2),p.Hc(t.values)}}const Ct=["bd2hm-labels",""];function Vt(t,e){if(1&t&&(p.hc(),p.Rb(0,"g",3)),2&t){const t=e.$implicit,i=p.ic(2);p.oc("serie",t)("yStart",i.yStart(t))("maxHeight",i.maxHeight())("alwaysOn",i.alwaysOn)}}function Dt(t,e){if(1&t&&(p.hc(),p.Wb(0,"g",1),p.Ec(1,Vt,1,4,"g",2),p.Vb()),2&t){const t=p.ic();p.Cb(1),p.oc("ngForOf",t.data)("ngForTrackBy",t.trackByIndex)}}const It=["bd2hm-label-box",""];function zt(t,e){if(1&t&&(p.hc(),p.Wb(0,"text",9),p.Gc(1),p.Vb()),2&t){const t=p.ic(2);p.Db("y",t.yMiddle)("font-size",t.fontSize()),p.Cb(1),p.Hc(t.serie.label)}}function Nt(t,e){if(1&t){const t=p.Xb();p.hc(),p.Wb(0,"g",1),p.Ec(1,zt,2,3,"text",2),p.Wb(2,"g",3),p.ec("mouseout",(function(){return p.xc(t),p.ic().toggleLabel(!1)}))("mouseover",(function(){return p.xc(t),p.ic().toggleLabel(!0)})),p.Rb(3,"rect",4),p.Wb(4,"g",5),p.Rb(5,"rect",6),p.Wb(6,"text",7,8),p.Gc(8),p.Vb(),p.Vb(),p.Vb(),p.Vb()}if(2&t){const t=p.ic();p.Cb(1),p.oc("ngIf",t.alwaysOn),p.Cb(2),p.Db("y",t.triggerY)("height",t.triggerHeight)("fill",t.color),p.Cb(1),p.Db("opacity",t.ready?1:0)("display",t.toggled?void 0:"none"),p.Cb(1),p.Db("width",t.textBWidth)("y",t.textBY)("height",t.textBHeight),p.Cb(1),p.Db("y",t.yMiddle),p.Cb(2),p.Hc(t.serie.label)}}const Tt=["bd2hm-serie-row",""];function Ft(t,e){if(1&t&&(p.hc(),p.Rb(0,"g",3)),2&t){const t=e.$implicit,i=p.ic(2);p.oc("point",t)("xScale",i.graphic.xScale)("yPosition",i.yPosition)("yHeight",i.yHeight)("colorScale",i.graphic.colorScale)("label",i.serie.label)}}function Et(t,e){if(1&t&&(p.hc(),p.Wb(0,"g",1),p.Ec(1,Ft,1,6,"g",2),p.Vb()),2&t){const t=p.ic();p.Cb(1),p.oc("ngForOf",t.serie.data)("ngForTrackBy",t.trackByIndex)}}const Rt=["box"],At=["bd2hm-data-point-box",""];function _t(t,e){if(1&t&&(p.hc(),p.Rb(0,"rect",null,1)),2&t){const t=p.ic();p.Db("x",t.xPosition)("y",t.yPosition)("width",t.xWidth)("height",t.yHeight)("fill",t.colorScale(t.point.y))("stroke",t.colorScale(t.point.y))}}const Ht=["bd2hm-series-box",""];function Gt(t,e){if(1&t&&(p.hc(),p.Rb(0,"g",1)),2&t){const t=e.$implicit,i=p.ic();p.oc("graphic",i.graphic)("serie",t)}}const jt=["bd2hm-pane-back",""],$t=["bd2hm-axis-box",""];function Lt(t,e){if(1&t&&(p.hc(),p.Wb(0,"g",1),p.Rb(1,"g",2),p.Rb(2,"g",3),p.Rb(3,"g",4),p.Rb(4,"g",5),p.Vb()),2&t){const t=p.ic();p.Cb(1),p.oc("top",!0)("xScale",t.graphic.xScale)("yPosition",0)("xDomain",t.graphic.xDomain),p.Cb(1),p.oc("top",!1)("xScale",t.graphic.xScale)("yPosition",t.graphic.workspaceHeight)("xDomain",t.graphic.xDomain),p.Cb(1),p.oc("left",!0)("yScale",t.graphic.yScale)("xPosition",0),p.Cb(1),p.oc("left",!1)("yScale",t.graphic.yScale)("xPosition",t.graphic.workspaceWidth)}}const qt=["bd2hm-y-axis",""],Kt=["bd2hm-vtick-mark",""];function Qt(t,e){if(1&t&&(p.hc(),p.Rb(0,"line",2)),2&t){const t=p.ic();p.Db("x1",t.tick.x)("x2",t.tick.x)("y2",t.marky2)}}function Zt(t,e){if(1&t&&(p.hc(),p.Wb(0,"text"),p.Gc(1),p.Vb()),2&t){const t=p.ic();p.Db("x",t.tick.x)("y",t.texty2)("dy",t.textdy),p.Cb(1),p.Hc(t.tick.label)}}const Yt=["bd2hm-num-x-axis",""];function Xt(t,e){1&t&&(p.hc(),p.Rb(0,"g",3)),2&t&&p.oc("tick",e.$implicit)}class Jt{constructor(){this.vMargin=25,this.hMargin=20,this.smallRowWidth=6,this.midRowWidth=12,this.bigRowWidth=25,this.rowGap=.05}}class Ut{}class te{constructor(t=0,e=0,i,n=!1,a=!1){this.x=t,this.y=e,this.label=i,this.top=n,this.left=a}}class ee{constructor(t,e,i,n){this.x=t,this.y=e,this.left=i,this.right=n,this.width=n-i}}class ie{}let ne=(()=>{let t=class{constructor(){this.request$=new N.a}showTooltip(t,e,i){this.request$.next([!0,t,e,i])}hideTooltip(t,e){this.request$.next([!1,void 0,t,e])}ngOnDestroy(){this.request$.complete()}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=p.Mb({token:t,factory:t.\u0275fac}),t})();class ae{seriesToBoxes(t,e=!1){return t.map(t=>this.serieToBoxes(t,e))}serieToBoxes(t,e=!1){const i=Object.assign(new ie,t);return i.data=e?this.pointsToAsymBoxes(t.data):this.pointsToSymBoxes(t.data),i}pointsToAsymBoxes(t,e=.5){if(!t||0===t.length)return[];if(1===t.length){const i=t[0];return[new ee(i.x,i.y,i.x-e,i.x+e)]}const i=[],n=t[0];i.push(new ee(n.x,n.y,(3*n.x-t[1].x)/2,(n.x+t[1].x)/2));for(let r=1;r<t.length-1;r++)i.push(this.asymBoxFromPoints(t[r],t[r-1],t[r+1]));const a=t[t.length-1];return i.push(new ee(a.x,a.y,(t[t.length-2].x+a.x)/2,(3*a.x-t[t.length-2].x)/2)),i}asymBoxFromPoints(t,e,i){return new ee(t.x,t.y,(e.x+t.x)/2,(t.x+i.x)/2)}pointsToSymBoxes(t,e=.5){if(!t||0===t.length)return[];if(1===t.length){const i=t[0];return[new ee(i.x,i.y,i.x-e,i.x+e)]}const i=[],n=t[0];i.push(new ee(n.x,n.y,(3*n.x-t[1].x)/2,(n.x+t[1].x)/2));for(let r=1;r<t.length-1;r++)i.push(this.symBoxFromPoints(t[r],t[r-1],t[r+1]));const a=t[t.length-1];return i.push(new ee(a.x,a.y,(t[t.length-2].x+a.x)/2,(3*a.x-t[t.length-2].x)/2)),i}symBoxFromPoints(t,e,i){const n=Math.min(t.x-e.x,i.x-t.x)/2;return new ee(t.x,t.y,t.x-n,t.x+n)}}class re{prepareGraphicContext(t,e,i=!1){const n=new Ut;return this.calculateDimensions(n,t,e),this.addPaneAttributes(n,e),this.addScales(n,t,e,i),this.addFormatters(n,t),n.labelsColors=this.labelsColors(t),n}calculateDimensions(t,e,i){t.pWidth=500,t.workspaceWidth=t.pWidth-3*i.hMargin,t.workspaceHeight=this.calculateWorkspaceHeight(e,i),t.pHeight=t.workspaceHeight+2*i.vMargin}calculateWorkspaceHeight(t,e){return t.length<=25?t.length*e.bigRowWidth:t.length<=100?t.length*e.midRowWidth:t.length*e.smallRowWidth}addPaneAttributes(t,e){t.viewBox="0 0 500 "+t.pHeight,t.mainPaneTransform=`translate(${2*e.hMargin}, ${e.vMargin})`}addScales(t,e,i,n){let a=this.timeDomain(e);t.xDomain=a;const r=this.timeMargin(e,a);a=[a[0]-r,a[1]+r],t.xScale=ft().clamp(!0).domain(a).range([0,t.workspaceWidth]);const o=e.map(t=>t.key);t.yDomain=o,t.yScale=function t(){var e,i,n=vt().unknown(void 0),a=n.domain,r=n.range,o=0,s=1,c=!1,h=0,l=0,g=.5;function u(){var t=a().length,n=s<o,u=n?s:o,d=n?o:s;e=(d-u)/Math.max(1,t-h+2*l),c&&(e=Math.floor(e)),u+=(d-u-e*(t-h))*g,i=e*(1-h),c&&(u=Math.round(u),i=Math.round(i));var p=xt(t).map((function(t){return u+e*t}));return r(n?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(a(t),u()):a()},n.range=function(t){return arguments.length?([o,s]=t,o=+o,s=+s,u()):[o,s]},n.rangeRound=function(t){return[o,s]=t,o=+o,s=+s,c=!0,u()},n.bandwidth=function(){return i},n.step=function(){return e},n.round=function(t){return arguments.length?(c=!!t,u()):c},n.padding=function(t){return arguments.length?(h=Math.min(1,l=+t),u()):h},n.paddingInner=function(t){return arguments.length?(h=Math.min(1,t),u()):h},n.paddingOuter=function(t){return arguments.length?(l=+t,u()):l},n.align=function(t){return arguments.length?(g=Math.max(0,Math.min(1,t)),u()):g},n.copy=function(){return t(a(),[o,s]).round(c).paddingInner(h).paddingOuter(l).align(g)},et.apply(u(),arguments)}().paddingInner(i.rowGap).paddingOuter(0).domain(o).range([0,t.workspaceHeight]),t.colorScale=this.heatmapScale(e,n)}addFormatters(t,e){const i=this.timeDomain(e);t.domainFormatter=this.formatForDomain(i);const n=this.valuesRange(e);t.valuesFormatter=this.formatForDomain(n)}timeMargin(t,e){const i=e[0];let n=.5;return t.filter(t=>t.data&&t.data.length>0&&t.data[0].x===i).forEach(t=>{const e=t.data[0];e instanceof ee&&(n=Math.max(n,e.x-e.left))}),n}timeDomain(t){let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.forEach(t=>{t.data&&t.data.length>0&&(e=Math.min(e,t.data[0].x),i=Math.max(i,t.data[t.data.length-1].x))}),e=isFinite(e)?e:0,i=isFinite(i)?i:1,[e,i]}heatmapScale(t,e){let i=this.valuesRange(t);if(e){const t=Math.max(Math.abs(i[0]),Math.abs(i[1]));i=[-t,t]}const n=function(t="#d62728",e="white",i="#1f77b4",n=.1){const a=ft().domain([-1,0,1]).range([Object(wt.g)(t),Object(wt.g)(e),Object(wt.g)(i)]);return xt(-1,1+n,n).map(t=>Object(wt.g)(a(t)).hex())}();return function t(){var e,i=0,n=1,a=1,r=[.5],o=[0,1];function s(t){return t<=t?o[j(r,t,0,a)]:e}function c(){var t=-1;for(r=new Array(a);++t<a;)r[t]=((t+1)*n-(t-a)*i)/(a+1);return s}return s.domain=function(t){return arguments.length?([i,n]=t,i=+i,n=+n,c()):[i,n]},s.range=function(t){return arguments.length?(a=(o=Array.from(t)).length-1,c()):o.slice()},s.invertExtent=function(t){var e=o.indexOf(t);return e<0?[NaN,NaN]:e<1?[i,r[0]]:e>=a?[r[a-1],n]:[r[e-1],r[e]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return r.slice()},s.copy=function(){return t().domain([i,n]).range(o).unknown(e)},et.apply(mt(s),arguments)}().domain(i).range(n)}valuesRange(t){if(0===t.length)return[NaN,NaN];let e=t[0].min,i=t[0].max;return t.forEach(t=>{e=Math.min(e,t.min),i=Math.max(i,t.max)}),[e,i]}formatForDomain([t,e]){const i=e-t;return st(i<1?".2~e":i<100?".2~f":i<1e5?"d":".2~e")}labelsColors(t){const e=t.length;return function(t){return Object(Mt.a)(t/e)}}}let oe=(()=>{let t=class{constructor(t,e){this.changeDetector=t,this.tooltip=e,this.asymmetric=!1,this.middleZero=!1,this.hidden=!1,this.labelsAlwaysOn=!0,this.lookAndFeel=new Jt,this.heatmapDataUtil=new ae,this.heatmapGraphUtil=new re}ngOnInit(){}ngOnDestroy(){this.tooltip&&this.tooltip.ngOnDestroy()}ngOnChanges(t){this.data&&this.data.length>0?(this.series=this.heatmapDataUtil.seriesToBoxes(this.data,this.asymmetric),this.graphic=this.heatmapGraphUtil.prepareGraphicContext(this.series,this.lookAndFeel,this.middleZero)):(this.graphic=void 0,this.series=void 0)}};return t.\u0275fac=function(e){return new(e||t)(p.Qb(p.h),p.Qb(ne))},t.\u0275cmp=p.Kb({type:t,selectors:[["bd2-num-heatmap"]],inputs:{asymmetric:"asymmetric",middleZero:"middleZero",hidden:"hidden",labelsAlwaysOn:"labelsAlwaysOn",lookAndFeel:"lookAndFeel",data:"data"},features:[p.Bb([ne]),p.Ab],decls:2,vars:2,consts:[[1,"bd2hm-heatmap",3,"hidden"],["width","100%",4,"ngIf"],["width","100%"],["id","bd2hm-shadow"],["dx","1","dy","1","stdDeviation","1"],["id","bd2hm-pattern-diagonal","width","10","height","10","patternTransform","rotate(45 0 0)","patternUnits","userSpaceOnUse"],["x1","0","y1","0","x2","0","y2","10",2,"stroke","lightgrey","stroke-width","1"],[1,"bd2hm-mainPane"],["bd2hm-pane-back","",1,"bd2hm-paneBack",3,"graphic"],["bd2hm-axis-box","",3,"graphic"],["bd2hm-series-box","",1,"bd2hm-seriesBox",3,"graphic","series"],["bd2hm-labels","",3,"graphic","data","alwaysOn"],["bd2hm-tooltip","",3,"graphic"]],template:function(t,e){1&t&&(p.Wb(0,"div",0),p.Ec(1,kt,12,10,"svg",1),p.Vb()),2&t&&(p.oc("hidden",e.hidden),p.Cb(1),p.oc("ngIf",e.graphic))},directives:function(){return[n.m,de,pe,ue,ce,se]},styles:[".bd2hm-paneBack rect{fill:url(#bd2hm-pattern-diagonal)}  .bd2hm-axisWrapper line{stroke:grey}  .bd2hm-axisWrapper text{fill:grey;text-anchor:middle;font-size:9px}  .bd2hm-labels text.bd2hm-onLabel{dominant-baseline:central;fill:#000;opacity:.6}  .bd2hm-labels .bd2hm-hover text{dominant-baseline:central;fill:#fff;font-size:10px}  .bd2hm-labels .bd2hm-hover rect{fill:#000;opacity:.8;-webkit-filter:url(#bd2hm-shadow);filter:url(#bd2hm-shadow)}  .bd2hm-tooltipBox text{font-size:10px;fill:#fff}  .bd2hm-tooltipBox rect{fill:#000;opacity:.8;-webkit-filter:url(#bd2hm-shadow);filter:url(#bd2hm-shadow)}"],changeDetection:0}),t})(),se=(()=>{let t=class{constructor(t,e){this.tooltip=t,this.changeDetector=e,this.boxMargin=4,this.show=!1,this.ready=!1}ngOnInit(){this.subscription=this.tooltip.request$.pipe(Object(c.a)(100)).subscribe(t=>this.handleRequest(t))}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}handleRequest([t,e,i,n]){t?this.showTooltip(e,i,n):this.hideTooltip(i,n)}showTooltip(t,e,i){this.ready=!1,this.label=this.formatLabel(t),this.values=this.formatValues(e),this.show=!0,this.changeDetector.detectChanges(),this.updateTextBBox().subscribe(t=>{this.show&&(this.position=this.translateToDataLocation(i,this.textBWidth,this.graphic.workspaceWidth),this.ready=!0),this.changeDetector.detectChanges()})}translateToDataLocation(t,e,i){let n=t.x+t.width+2*this.boxMargin;return n+e>=i&&(n=t.x-e),`translate(${n}, ${t.y})`}hideTooltip(t,e){this.show=!1,this.changeDetector.detectChanges()}formatValues(t){return`${this.graphic.domainFormatter(t.x)} : ${this.graphic.valuesFormatter(t.y)}`}updateTextBBox(){return Object(T.a)(0).pipe(Object(St.a)(t=>this.textBBox()),Object(Ot.a)(t=>this.setTextBBox(t)))}setTextBBox(t){this.textBX=t.x-this.boxMargin,this.textBY=t.y-this.boxMargin,this.textBHeight=t.height+2*this.boxMargin,this.textBWidth=t.width+2*this.boxMargin}textBBox(){return this.textNode?this.textNode.nativeElement.getBBox():{x:0,y:0,height:0,width:0}}formatLabel(t){return t?t.length<40?t:t.substring(0,38)+"...":""}};return t.\u0275fac=function(e){return new(e||t)(p.Qb(ne),p.Qb(p.h))},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-tooltip",""]],viewQuery:function(t,e){var i;1&t&&p.Mc(Pt,!0),2&t&&p.uc(i=p.fc())&&(e.textNode=i.first)},inputs:{boxMargin:"boxMargin",graphic:"graphic"},attrs:Wt,decls:1,vars:1,consts:[["class","bd2hm-tooltipBox",4,"ngIf"],[1,"bd2hm-tooltipBox"],["text",""],["x","0"],["x","0","dy","1.2em"]],template:function(t,e){1&t&&p.Ec(0,Bt,9,9,"g",0),2&t&&p.oc("ngIf",e.graphic)},directives:[n.m],encapsulation:2,changeDetection:0}),t})(),ce=(()=>{let t=class{constructor(){this.alwaysOn=!0}trackByIndex(t,e){return t}ngOnInit(){}yStart(t){return this.graphic.yScale(t.key)}maxHeight(){return this.graphic.yScale.bandwidth()}color(t){return this.graphic.labelsColors(t)}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-labels",""]],inputs:{alwaysOn:"alwaysOn",graphic:"graphic",data:"data"},attrs:Ct,decls:1,vars:1,consts:[["class","bd2hm-labels",4,"ngIf"],[1,"bd2hm-labels"],["bd2hm-label-box","",3,"serie","yStart","maxHeight","alwaysOn",4,"ngFor","ngForOf","ngForTrackBy"],["bd2hm-label-box","",3,"serie","yStart","maxHeight","alwaysOn"]],template:function(t,e){1&t&&p.Ec(0,Dt,2,2,"g",0),2&t&&p.oc("ngIf",e.graphic&&e.data)},directives:function(){return[n.m,n.l,he]},encapsulation:2,changeDetection:0}),t})(),he=(()=>{let t=class{constructor(t){this.changeDetector=t,this.alwaysOn=!0,this.color="rgb(67, 125, 179)",this.textBWidth=0,this.textBY=0,this.toggled=!1,this.ready=!1}ngOnInit(){}ngOnChanges(t){this.margin=this.marginSize(),this.triggerY=this.yStart+this.margin,this.triggerHeight=this.margin>1?this.maxHeight-2*this.margin:this.maxHeight-1,this.yMiddle=this.yStart+this.maxHeight/2}marginSize(){return this.maxHeight>=20?4:this.maxHeight>=12?2:1}fontSize(){return this.maxHeight>12?10:this.maxHeight>=6?this.maxHeight-3:0}toggleLabel(t){void 0===t&&(t=!this.toggled),this.ready=!1,this.toggled=t,this.toggled&&this.updateTextBBox().subscribe(t=>{this.toggled&&(this.ready=!0),this.changeDetector.markForCheck()})}updateTextBBox(){return Object(T.a)(0).pipe(Object(St.a)(t=>this.textBBox()),Object(Ot.a)(t=>this.setTextBBox(t)))}setTextBBox(t){this.textBY=t.y-4,this.textBHeight=t.height+8,this.textBWidth=t.x+t.width+4}textBBox(){return this.textNode?this.textNode.nativeElement.getBBox():{x:0,y:0,height:0,width:0}}};return t.\u0275fac=function(e){return new(e||t)(p.Qb(p.h))},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-label-box",""]],viewQuery:function(t,e){var i;1&t&&p.Mc(Pt,!0),2&t&&p.uc(i=p.fc())&&(e.textNode=i.first)},inputs:{alwaysOn:"alwaysOn",color:"color",serie:"serie",yStart:"yStart",maxHeight:"maxHeight"},features:[p.Ab],attrs:It,decls:1,vars:1,consts:[["class","bd2hm-label",4,"ngIf"],[1,"bd2hm-label"],["x","5","class","bd2hm-onLabel",4,"ngIf"],[3,"mouseout","mouseover"],["x","-7","width","7"],[1,"bd2hm-hover"],["x","0"],["x","5"],["text",""],["x","5",1,"bd2hm-onLabel"]],template:function(t,e){1&t&&p.Ec(0,Nt,9,11,"g",0),2&t&&p.oc("ngIf",e.serie)},directives:[n.m],encapsulation:2,changeDetection:0}),t})(),le=(()=>{let t=class{constructor(){}trackByIndex(t,e){return t}ngOnInit(){}ngOnChanges(t){this.graphic&&this.serie&&(this.yPosition=this.graphic.yScale(this.serie.key),this.yHeight=this.graphic.yScale.bandwidth())}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-serie-row",""]],inputs:{graphic:"graphic",serie:"serie"},features:[p.Ab],attrs:Tt,decls:1,vars:1,consts:[["class","bd2hm-serie",4,"ngIf"],[1,"bd2hm-serie"],["bd2hm-data-point-box","",3,"point","xScale","yPosition","yHeight","colorScale","label",4,"ngFor","ngForOf","ngForTrackBy"],["bd2hm-data-point-box","",3,"point","xScale","yPosition","yHeight","colorScale","label"]],template:function(t,e){1&t&&p.Ec(0,Et,2,2,"g",0),2&t&&p.oc("ngIf",e.graphic&&e.serie)},directives:function(){return[n.m,n.l,ge]},encapsulation:2,changeDetection:0}),t})(),ge=(()=>{let t=class{constructor(t,e){this.tooltip=t,this.zone=e}ngOnChanges(t){if(this.xScale&&this.point){this.xPosition=this.xScale(this.point.left);const t=this.xScale(this.point.right)-this.xScale(this.point.left);this.xWidth=t>=2?t-1:1}}ngAfterViewInit(){this.boxNode&&this.prevBoxNode!==this.boxNode&&(this.removeMouseListeners(this.prevBoxNode),this.zone.runOutsideAngular(()=>{this.addMouseListeners(this.boxNode)}),this.prevBoxNode=this.boxNode)}ngOnInit(){}ngOnDestroy(){this.removeMouseListeners(this.boxNode)}addMouseListeners(t){t&&(t.nativeElement.addEventListener("mouseover",this.showTooltip.bind(this)),t.nativeElement.addEventListener("mouseout",this.hideTooltip.bind(this)))}removeMouseListeners(t){t&&(t.nativeElement.removeEventListener("mouseover",this.showTooltip),t.nativeElement.removeEventListener("mouseout",this.hideTooltip))}hideTooltip(t){this.tooltip.hideTooltip(this.point,{x:this.xPosition,y:this.yPosition,width:this.xWidth})}showTooltip(t){this.tooltip.showTooltip(this.label,this.point,{x:this.xPosition,y:this.yPosition,width:this.xWidth})}};return t.\u0275fac=function(e){return new(e||t)(p.Qb(ne),p.Qb(p.A))},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-data-point-box",""]],viewQuery:function(t,e){var i;1&t&&p.Mc(Rt,!0),2&t&&p.uc(i=p.fc())&&(e.boxNode=i.first)},inputs:{point:"point",yPosition:"yPosition",yHeight:"yHeight",xScale:"xScale",colorScale:"colorScale",label:"label"},features:[p.Ab],attrs:At,decls:1,vars:1,consts:[[4,"ngIf"],["box",""]],template:function(t,e){1&t&&p.Ec(0,_t,2,6,"rect",0),2&t&&p.oc("ngIf",e.point&&e.xScale)},directives:[n.m],encapsulation:2,changeDetection:0}),t})(),ue=(()=>{let t=class{constructor(){}trackByIndex(t,e){return t}ngOnInit(){}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-series-box",""]],inputs:{series:"series",graphic:"graphic"},attrs:Ht,decls:1,vars:2,consts:[["bd2hm-serie-row","",3,"graphic","serie",4,"ngFor","ngForOf","ngForTrackBy"],["bd2hm-serie-row","",3,"graphic","serie"]],template:function(t,e){1&t&&p.Ec(0,Gt,1,2,"g",0),2&t&&p.oc("ngForOf",e.series)("ngForTrackBy",e.trackByIndex)},directives:[n.l,le],encapsulation:2,changeDetection:0}),t})(),de=(()=>{let t=class{constructor(){this.margin=2}ngOnInit(){}ngOnChanges(t){this.width=this.graphic.workspaceWidth-2*this.margin,this.height=this.graphic.workspaceHeight-2*this.margin,this.width<0&&(this.width=0),this.height<0&&(this.height=0)}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-pane-back",""]],inputs:{margin:"margin",graphic:"graphic"},features:[p.Ab],attrs:jt,decls:1,vars:4,consts:[[1,"bd2hm-dataBackground"]],template:function(t,e){1&t&&(p.hc(),p.Rb(0,"rect",0)),2&t&&p.Db("x",e.margin)("y",e.margin)("width",e.width)("height",e.height)},encapsulation:2,changeDetection:0}),t})(),pe=(()=>{let t=class{constructor(){}ngOnInit(){}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-axis-box",""]],inputs:{graphic:"graphic"},attrs:$t,decls:1,vars:1,consts:[["class","bd2hm-axisWrapper",4,"ngIf"],[1,"bd2hm-axisWrapper"],["bd2hm-num-x-axis","",1,"xTopAxis",3,"top","xScale","yPosition","xDomain"],["bd2hm-num-x-axis","",1,"xBottomAxis",3,"top","xScale","yPosition","xDomain"],["bd2hm-y-axis","",1,"yLeftAxis",3,"left","yScale","xPosition"],["bd2hm-y-axis","",1,"yRightAxis",3,"left","yScale","xPosition"]],template:function(t,e){1&t&&p.Ec(0,Lt,5,14,"g",0),2&t&&p.oc("ngIf",e.graphic)},directives:function(){return[n.m,fe,be]},encapsulation:2,changeDetection:0}),t})(),be=(()=>{let t=class{constructor(){this.left=!1}ngOnInit(){}ngOnChanges(t){var e;this.axisTransform=`translate(${this.xPosition},0)`,this.y2=null===(e=this.yScale)||void 0===e?void 0:e.range()[1]}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-y-axis",""]],inputs:{left:"left",yScale:"yScale",xPosition:"xPosition"},features:[p.Ab],attrs:qt,decls:2,vars:2,consts:[[1,"bd2hm-y-axis"],["x1","0","y1","0","x2","0"]],template:function(t,e){1&t&&(p.hc(),p.Wb(0,"g",0),p.Rb(1,"line",1),p.Vb()),2&t&&(p.Db("transform",e.axisTransform),p.Cb(1),p.Db("y2",e.y2))},encapsulation:2,changeDetection:0}),t})(),me=(()=>{let t=class{constructor(){this.length=5}ngOnInit(){this.calculatePositions()}ngOnChanges(t){this.calculatePositions()}calculatePositions(){var t,e,i;this.marky2=(null===(t=this.tick)||void 0===t?void 0:t.top)?-this.length:this.length,this.texty2=(null===(e=this.tick)||void 0===e?void 0:e.top)?-(this.length+4):this.length+4,this.textdy=(null===(i=this.tick)||void 0===i?void 0:i.top)?0:"0.6em"}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-vtick-mark",""]],inputs:{length:"length",tick:"tick"},features:[p.Ab],attrs:Kt,decls:2,vars:2,consts:[["y1","0",4,"ngIf"],[4,"ngIf"],["y1","0"]],template:function(t,e){1&t&&(p.Ec(0,Qt,1,3,"line",0),p.Ec(1,Zt,2,4,"text",1)),2&t&&(p.oc("ngIf",e.tick),p.Cb(1),p.oc("ngIf",e.tick))},directives:[n.m],encapsulation:2}),t})(),fe=(()=>{let t=class{constructor(){this.top=!1,this.ticks=[]}trackByIndex(t,e){return t}ngOnInit(){}ngOnChanges(t){var e;this.axisTransform=`translate(0,${this.yPosition})`,this.x2=null===(e=this.xScale)||void 0===e?void 0:e.range()[1],this.ticks=this.prepareTicks(this.xScale)}prepareTicks(t){return this.calculateTicksPosition(t).map(e=>new te(t(e),0,e,this.top,!1))}calculateTicksPosition(t){if(!t)return[];const e=[],i=this.xDomain||t.domain(),n=Math.round(i[0]),a=Math.round(i[1]),r=this.domainStep(a-n);for(let o=n;o<=a;o+=r)e.push(o);return e}domainStep(t){return t<=25?4:t<=73?6:t<=169?12:24}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Kb({type:t,selectors:[["","bd2hm-num-x-axis",""]],inputs:{top:"top",xScale:"xScale",xDomain:"xDomain",yPosition:"yPosition"},features:[p.Ab],attrs:Yt,decls:3,vars:4,consts:[[1,"bd2hm-x-axis"],["x1","0","y1","0","y2","0"],["bd2hm-vtick-mark","","class","bd2hm-tickMark",3,"tick",4,"ngFor","ngForOf","ngForTrackBy"],["bd2hm-vtick-mark","",1,"bd2hm-tickMark",3,"tick"]],template:function(t,e){1&t&&(p.hc(),p.Wb(0,"g",0),p.Rb(1,"line",1),p.Ec(2,Xt,1,1,"g",2),p.Vb()),2&t&&(p.Db("transform",e.axisTransform),p.Cb(1),p.Db("x2",e.x2),p.Cb(1),p.oc("ngForOf",e.ticks)("ngForTrackBy",e.trackByIndex))},directives:[n.l,me],encapsulation:2,changeDetection:0}),t})(),xe=(()=>{let t=class{};return t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({factory:function(e){return new(e||t)},imports:[[n.c]]}),t})(),ye=(()=>{let t=class{};return t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({factory:function(e){return new(e||t)},imports:[[n.c,xe],xe]}),t})(),ve=(()=>{let t=class{};return t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({factory:function(e){return new(e||t)},imports:[[n.c,ye]]}),t})(),we=(()=>{let t=class{};return t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({factory:function(e){return new(e||t)},imports:[[ve]]}),t})(),Me=(()=>{class t{constructor(){this.middleZero=!1}set traces(t){this.series=t}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Kb({type:t,selectors:[["bd2-heatmap-plot"]],inputs:{traces:"traces",middleZero:"middleZero"},decls:2,vars:2,consts:[[2,"text-align","center"],[3,"data","middleZero"]],template:function(t,e){1&t&&(p.Wb(0,"div",0),p.Rb(1,"bd2-num-heatmap",1),p.Vb()),2&t&&(p.Cb(1),p.oc("data",e.series)("middleZero",e.middleZero))},directives:[oe],encapsulation:2}),t})();function Se(t,e){if(1&t){const t=p.Xb();p.Wb(0,"div",6),p.Wb(1,"label",7),p.Wb(2,"a",8),p.ec("click",(function(){return p.xc(t),p.ic(2).exportDataView()})),p.Wb(3,"i",9),p.Gc(4,"save_alt"),p.Vb(),p.Wb(5,"span",10),p.Gc(6,"Download"),p.Vb(),p.Vb(),p.Gc(7," current view "),p.Vb(),p.Wb(8,"label",7),p.Wb(9,"a",11),p.ec("click",(function(){return p.xc(t),p.ic(2).exportFullData()})),p.Wb(10,"i",9),p.Gc(11,"save_alt"),p.Vb(),p.Wb(12,"span",10),p.Gc(13,"Download"),p.Vb(),p.Vb(),p.Gc(14," full "),p.Vb(),p.Vb()}}function Oe(t,e){if(1&t&&p.Rb(0,"bd2-heatmap-plot",12),2&t){const t=p.ic(2);p.oc("traces",t.timeseries)("middleZero",t.middleZero)}}function ke(t,e){if(1&t){const t=p.Xb();p.Wb(0,"div"),p.Wb(1,"h3"),p.Gc(2,"Data heatmap"),p.Vb(),p.Rb(3,"hr"),p.Wb(4,"bd2-heatmap-display-params-rform",1),p.ec("displayParams",(function(e){return p.xc(t),p.ic().displayChanged(e)})),p.Vb(),p.Wb(5,"mat-expansion-panel"),p.Wb(6,"mat-expansion-panel-header"),p.Wb(7,"mat-panel-title"),p.Gc(8," Sorting "),p.Vb(),p.Vb(),p.Rb(9,"bd2-tssort-params-rform",2),p.jc(10,"async"),p.jc(11,"async"),p.Vb(),p.Rb(12,"hr"),p.Wb(13,"div",3),p.Ec(14,Se,15,0,"div",4),p.Vb(),p.Rb(15,"hr"),p.Ec(16,Oe,1,2,"bd2-heatmap-plot",5),p.Vb()}if(2&t){const t=p.ic();p.Cb(4),p.oc("disabled",t.disabledSecondary)("totalTraces",t.totalTraces)("currentPage",t.currentPage),p.Cb(5),p.oc("ppaJobs",p.kc(10,7,t.analysis.ppaJobs$))("rhythmJobs",p.kc(11,9,t.analysis.rhythmJobs$)),p.Cb(5),p.oc("ngIf",t.timeseries),p.Cb(2),p.oc("ngIf",t.timeseries)}}const Pe=[{path:"",pathMatch:"full",component:(()=>{class t extends s.a{constructor(t,e,i,n,a){super(a),this.analysis=t,this.fetcher=e,this.RDMSocial=i,this.analytics=n,this.timeseries=[],this.totalTraces=0,this.currentPage=h.a.firstPage(),this.tracesPerPlot=5,this.middleZero=!1,this.blocked=!1,this.disabledSecondary=!1,this.csvExporter=new u.a,t.allowedPPAMethods=["NLLS","MESA"],e.addTraceNr=!0,e.addTraceRef=!1,this.titlePart=" Data"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(c.a)(1e3)).subscribe(t=>{if(!this.assay)return;const e=t.data;this.currentParams=t.params,this.middleZero=this.isRangeSimetrical(t.params),this.timeseries=e,this.tracesPerPlot=Math.max(5,e.length/20),this.totalTraces=t.totalTraces,this.currentPage=t.currentPage,this.analytics.experimentHeatmapView(this.assay.id)},t=>{console.log("Error in TS subscription: "+t),this.feedback.error(t)}),this.fetcher.error$.subscribe(t=>this.feedback.error(t))}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}displayChanged(t){this.fetcher.changeDisplayParams(t)}exportDataView(){this.exportSeriesPack(this.fetcher.current)}exportFullData(){this.fetcher.getFullDataSet(this.assay,this.fetcher.current.params,this.fetcher.current.sorting).subscribe(t=>{this.exportSeriesPack(t,!0)})}exportSeriesPack(t,e=!1){if(!t)return;const i=this.csvExporter.renderCSVTable(t.data,t.params,t.currentPage,t.sorting,this.assay),n=new Blob([i],{type:"text/csv"});g.saveAs(n,`${this.assay.id}_data.${t.params.detrending.name}${e?".full":".page"+(t.currentPage.pageIndex+1)}.csv`),this.recordExport()}recordExport(){this.analytics.experimentDataExport(this.assay.id)}updateModel(t){super.updateModel(t),this.RDMSocial.canProceedByMeasurement(t).then(t=>{this.disabledSecondary=!t}),this.fetcher.experiment(t),this.analysis.experiment(t)}isRangeSimetrical(t){return"RANGE"===t.normalisation||"Z_SCORE"===t.normalisation||"MEAN"===t.align}}return t.\u0275fac=function(e){return new(e||t)(p.Qb(d.a),p.Qb(l.a),p.Qb(b.a),p.Qb(m.a),p.Qb(f.a))},t.\u0275cmp=p.Kb({type:t,selectors:[["bd2-ts-heatmap-view"]],features:[p.Bb([l.a,d.a]),p.zb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams"],[3,"ppaJobs","rhythmJobs"],[1,"clearfix"],["class","float-right",4,"ngIf"],[3,"traces","middleZero",4,"ngIf"],[1,"float-right"],[1,"mr-4"],["download","","role","button","aria-label","download",1,"btn","btn-primary",2,"color","white",3,"click"],[1,"material-icons","bd-icon"],[1,"cdk-visually-hidden"],["download","","role","button","aria-label","download whole",1,"btn","btn-primary",2,"color","white",3,"click"],[3,"traces","middleZero"]],template:function(t,e){1&t&&p.Ec(0,ke,17,11,"div",0),2&t&&p.oc("ngIf",e.assay)},directives:[n.m,D,I.b,I.c,I.d,z.a,Me],pipes:[n.b],encapsulation:2}),t})()}];let We=(()=>{class t{}return t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({factory:function(e){return new(e||t)},imports:[[o.f.forChild(Pe)],o.f]}),t})();var Be=i("NFeN"),Ce=i("a6j2");let Ve=(()=>{class t{}return t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({factory:function(e){return new(e||t)},imports:[[n.c,a.x,a.j,r.c,Be.b,M.b,v.b,I.a,we,Ce.a,We]]}),t})()}}]);