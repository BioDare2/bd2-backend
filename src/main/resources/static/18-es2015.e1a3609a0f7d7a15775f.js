(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"9Gw/":function(t,e,i){"use strict";i.r(e),i.d(e,"TsOldImportModule",(function(){return V}));var o=i("ofXK"),s=i("3Pt+"),l=i("YiFe"),n=i("ZTEM"),a=i("tyNb"),c=i("yYXI"),r=i("EvUs"),b=i("fXoL"),d=i("UsWK");let h=(()=>{class t{constructor(t){this.BD2REST=t}getSimpleTableView(t){return this.BD2REST.fileViewSimpleTable(t).then(t=>t.data)}verifyFormat(t,e){return this.BD2REST.fileViewVerifyFormat(t,e).toPromise()}}return t.\u0275fac=function(e){return new(e||t)(b.Xb(d.a))},t.\u0275prov=b.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var m=i("GVyA"),u=i("KhIM");class f{constructor(t,e,i,o,s){this.rows=t,this.th=e,this.rowsLabels=i,this.specialRows=o,this.specialRowsLabels=s,this.width=f.maxLength(t),this.th=e||(t.length<1?[]:f.labelCols(this.width)),this.rowsLabels=i||f.labelRows(t.length),this.specialRows=o||[],this.specialRowsLabels=s||f.blankRows(this.specialRows.length)}static labelRows(t){const e=[];for(let i=1;i<=t;i++)e.push(""+i);return e}static blankRows(t){const e=[];for(let i=0;i<t;i++)e.push("");return e}static maxLength(t){return!t||t.length<1?0:Math.max.apply(Math,t.map(t=>t.length))}static labelCols(t){const e=[];for(let i=1;i<=t;i++)e.push(Object(u.i)(i));return e}}let g=(()=>{class t{static color(e){return t.colors[e%t.colors.length]}}return t.TIME_BG="lightyellow",t.IGNORED_BG="lightgrey",t.NOISE_BG="darkgrey",t.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"],t})();var p=i("0IaG");const T=["columnTypeForm"];function w(t,e){if(1&t){const t=b.Ub();b.Tb(0,"li"),b.Tb(1,"input",14,15),b.Zb("ngModelChange",(function(e){return b.sc(t),b.dc().cellRole=e})),b.Sb(),b.Dc(3),b.Sb()}if(2&t){const t=e.$implicit,i=b.dc();b.Bb(1),b.kc("value",t.name),b.jc("ngModel",i.cellRole),b.Bb(2),b.Fc(" ",t.label," ")}}function S(t,e){if(1&t){const t=b.Ub();b.Tb(0,"div",5),b.Tb(1,"label",16),b.Dc(2,"Propagate until block size"),b.Sb(),b.Tb(3,"input",17,18),b.Zb("ngModelChange",(function(e){return b.sc(t),b.dc().rangeSize=e})),b.Sb(),b.Sb()}if(2&t){const t=b.dc();b.Bb(3),b.jc("ngModel",t.rangeSize)}}function D(t,e){if(1&t){const t=b.Ub();b.Tb(0,"div",5),b.Tb(1,"label",19),b.Dc(2,"Label"),b.Sb(),b.Tb(3,"input",20,21),b.Zb("ngModelChange",(function(e){return b.sc(t),b.dc().dataLabel=e})),b.Sb(),b.Sb()}if(2&t){const t=b.dc();b.Bb(3),b.jc("ngModel",t.dataLabel)}}function B(t,e){if(1&t&&(b.Tb(0,"option",32),b.Dc(1),b.Sb()),2&t){const t=e.$implicit;b.kc("value",t.name),b.Bb(1),b.Fc("",t.label," ")}}function C(t,e){if(1&t){const t=b.Ub();b.Tb(0,"div",5),b.Tb(1,"label",33),b.Dc(2,"Time between images (hours)"),b.Sb(),b.Tb(3,"input",34,35),b.Zb("ngModelChange",(function(e){return b.sc(t),b.dc(2).imgInterval=e})),b.Sb(),b.Sb()}if(2&t){const t=b.dc(2);b.Bb(3),b.jc("ngModel",t.imgInterval)}}function v(t,e){if(1&t){const t=b.Ub();b.Tb(0,"div"),b.Tb(1,"div",5),b.Tb(2,"label",22),b.Dc(3,"Type of time column"),b.Sb(),b.Tb(4,"select",23,24),b.Zb("ngModelChange",(function(e){return b.sc(t),b.dc().timeType=e})),b.Bc(6,B,2,2,"option",25),b.Sb(),b.Sb(),b.Tb(7,"div",5),b.Tb(8,"label",26),b.Dc(9,"Row with first timepoint"),b.Sb(),b.Tb(10,"input",27,28),b.Zb("ngModelChange",(function(e){return b.sc(t),b.dc().firstRow=e})),b.Sb(),b.Sb(),b.Tb(12,"div",5),b.Tb(13,"label",29),b.Dc(14,"Time offset (hours)"),b.Sb(),b.Tb(15,"input",30,31),b.Zb("ngModelChange",(function(e){return b.sc(t),b.dc().timeOffset=e})),b.Sb(),b.Sb(),b.Bc(17,C,5,1,"div",8),b.Sb()}if(2&t){const t=b.dc();b.Bb(4),b.jc("ngModel",t.timeType),b.Bb(2),b.jc("ngForOf",t.timeTypeOptions),b.Bb(4),b.jc("ngModel",t.firstRow),b.Bb(5),b.jc("ngModel",t.timeOffset),b.Bb(2),b.jc("ngIf",t.isImageBased())}}function k(t,e){if(1&t&&(b.Tb(0,"div",37),b.Dc(1),b.Sb()),2&t){const t=e.$implicit;b.Bb(1),b.Ec(t)}}function y(t,e){if(1&t&&(b.Tb(0,"div"),b.Bc(1,k,2,1,"div",36),b.Sb()),2&t){const t=b.dc();b.Bb(1),b.jc("ngForOf",t.errors)}}class I{constructor(t,e,i,o){this.selectedRange=t,this.lastCol=e,this.showTime=i,this.label=o}}let M=(()=>{class t{constructor(t,e){this.myself=t,this.errors=null,this.cellRoles=[u.d.IGNORED,u.d.BACKGROUND,u.d.TIME,u.d.DATA],this.timeTypeOptions=[u.h.TIME_IN_HOURS,u.h.TIME_IN_MINUTES,u.h.TIME_IN_SECONDS,u.h.IMG_NUMBER],this.lastCol=e.lastCol,this.showTime=e.showTime,this.show(e.selectedRange,e.label)}ngOnInit(){}set showTime(t){this.cellRoles=t?[u.d.IGNORED,u.d.BACKGROUND,u.d.TIME,u.d.DATA]:[u.d.IGNORED,u.d.BACKGROUND,u.d.DATA]}isData(){return this.cellRole===u.d.DATA.name}isTime(){return this.cellRole===u.d.TIME.name}isImageBased(){return this.isTime()&&this.timeType===u.h.IMG_NUMBER.name}show(t,e){t&&(this.orgRange=t,this.rangeSize=t.range.size(),this.rangeLabel=e||t.columnRangeLabel,t.role&&(this.cellRole=t.role.name),t.role==u.d.DATA&&t.details&&(this.dataLabel=t.details.dataLabel),t.role==u.d.TIME&&t.details&&(this.timeType=t.details.timeType.name,this.timeOffset=t.details.timeOffset,this.imgInterval=t.details.imgInterval,this.firstRow=t.details.firstRow))}hide(){this.myself.close()}accepted(){this.isValid()&&this.myself.close(this.emitDescription())}acceptedAndNext(){if(!this.isValid())return;const t=this.emitDescription();if(t.range.lastCol>=this.lastCol);else{const e=this.nextRange(t.range,this.rangeSize),i=new u.c(e);i.role=u.d.DATA,i.details=t.details,t.follow=i}this.myself.close(t)}nextRange(t,e){const i=t.lastCol+1;let o=i+e-1;return o=Math.min(o,this.lastCol),new u.b(new u.a(i,t.first.row),new u.a(o,t.first.row))}emitDescription(){const t=this.recalculateRange(this.orgRange.range);let e={};if(this.isData())e=new u.f(this.dataLabel);else if(this.isTime()){const t=new u.g;t.firstRow=this.firstRow,t.timeType=u.h.get(this.timeType),t.timeOffset=this.timeOffset,this.isImageBased()&&(t.imgInterval=this.imgInterval),e=t}const i=new u.c(t,this.orgRange.content);return i.role=u.d.get(this.cellRole),i.details=e,i}isValid(){const t=[];return u.d.get(this.cellRole)||t.push("Unknown role: "+this.cellRole),this.isData()&&(this.dataLabel&&""!==this.dataLabel.trim()||(t.push("Non empty data label is required"),this.dataLabel=null)),this.isTime()?((!this.firstRow||this.firstRow<1)&&t.push("Row nr of the first time point must be >= 1"),this.isImageBased()&&(!this.imgInterval||this.imgInterval<=0)&&t.push("Image interval must be > 0")):(!this.rangeSize||this.rangeSize<1)&&t.push("Block size must be >= 1"),0===t.length&&(this.errors=null,!0)}recalculateRange(t){let e=t.first;if(this.isTime())return e=new u.a(e.col,this.firstRow),new u.b(e,e);if(this.rangeSize!==t.size()){const t=new u.a(Math.min(e.col+this.rangeSize-1,this.lastCol),e.row);return new u.b(e,t)}return t}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(p.g),b.Nb(p.a))},t.\u0275cmp=b.Hb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){var i;1&t&&b.xc(T,!0),2&t&&b.pc(i=b.ac())&&(e.columnTypeForm=i.first)},decls:28,vars:8,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],["columnTypeForm","ngForm"],[1,"form-group"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"disabled","click"],[1,"btn","btn-primary","btn-sm","m-1",3,"disabled","click"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","radio","required","","name","fCellRole",3,"value","ngModel","ngModelChange"],["fCellRole","ngModel"],["for","size"],["type","number","step","1","min","1","id","size","required","","name","fSize",1,"form-control",3,"ngModel","ngModelChange"],["fSize","ngModel"],["for","dataLabel"],["type","text","id","dataLabel","placeholder","e.g. TOC1 SD","required","","minlength","2","name","fDataLabel",1,"form-control",3,"ngModel","ngModelChange"],["fDataLabel","ngModel"],["for","timeType"],["id","timeType","required","","name","fTimeType",1,"form-control",3,"ngModel","ngModelChange"],["fTimeType","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","firstRow"],["type","number","id","firstRow","step","1","min","1","required","","placeholder","e.g. 2","name","fFirstRow",1,"form-control",3,"ngModel","ngModelChange"],["fFirstRow","ngModel"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control",3,"ngModel","ngModelChange"],["fTimeOffset","ngModel"],[3,"value"],["for","imgInterval"],["type","number","id","imgInterval","required","","step","any","min","0.01","placeholder","e.g. 1.5","name","fImgInterval",1,"form-control",3,"ngModel","ngModelChange"],["fImgInterval","ngModel"],["dismissOnTimeout","3000","dismissible","true","class","alert alert-danger","role","alert",4,"ngFor","ngForOf"],["dismissOnTimeout","3000","dismissible","true","role","alert",1,"alert","alert-danger"]],template:function(t,e){if(1&t&&(b.Tb(0,"h4",0),b.Dc(1,"Describe data column(s) "),b.Tb(2,"button",1),b.Tb(3,"span",2),b.Dc(4,"\xd7"),b.Sb(),b.Sb(),b.Sb(),b.Tb(5,"div",3),b.Tb(6,"p"),b.Dc(7," Columns "),b.Tb(8,"strong"),b.Dc(9),b.Sb(),b.Sb(),b.Tb(10,"form",null,4),b.Tb(12,"div",5),b.Tb(13,"label"),b.Dc(14,"Column type"),b.Sb(),b.Tb(15,"ul",6),b.Bc(16,w,4,3,"li",7),b.Sb(),b.Sb(),b.Bc(17,S,5,1,"div",8),b.Bc(18,D,5,1,"div",8),b.Bc(19,v,18,5,"div",9),b.Bc(20,y,2,1,"div",9),b.Sb(),b.Sb(),b.Tb(21,"div",10),b.Tb(22,"button",11),b.Zb("click",(function(){return e.acceptedAndNext()})),b.Dc(23,"OK and Next "),b.Sb(),b.Tb(24,"button",12),b.Zb("click",(function(){return e.accepted()})),b.Dc(25,"OK "),b.Sb(),b.Tb(26,"button",13),b.Zb("click",(function(){return e.hide()})),b.Dc(27,"Cancel"),b.Sb(),b.Sb()),2&t){const t=b.qc(11);b.Bb(9),b.Fc("[",e.rangeLabel,"]"),b.Bb(7),b.jc("ngForOf",e.cellRoles),b.Bb(1),b.jc("ngIf",!e.isTime()),b.Bb(1),b.jc("ngIf",e.isData()),b.Bb(1),b.jc("ngIf",e.isTime()),b.Bb(1),b.jc("ngIf",e.errors),b.Bb(2),b.jc("disabled",!t.form.valid),b.Bb(2),b.jc("disabled",!t.form.valid)}},directives:[p.h,p.d,p.e,s.D,s.r,s.s,o.l,o.m,p.c,s.x,s.d,s.z,s.q,s.t,s.v,s.m,s.A,s.u,s.C],encapsulation:2}),t})(),R=(()=>{class t{constructor(t){this.show(t)}ngOnInit(){}show(t){this.orgRange=t,this.rowNr=t.range.first.row,this.values=t.content}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(p.a))},t.\u0275cmp=b.Hb({type:t,selectors:[["ng-component"]],decls:24,vars:3,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],[1,"word_wrapping"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"mat-dialog-close"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm"]],template:function(t,e){1&t&&(b.Tb(0,"h4",0),b.Dc(1,"Use row content as data labels(s) "),b.Tb(2,"button",1),b.Tb(3,"span",2),b.Dc(4,"\xd7"),b.Sb(),b.Sb(),b.Sb(),b.Tb(5,"div",3),b.Tb(6,"div"),b.Tb(7,"p"),b.Dc(8,"Use values from row "),b.Tb(9,"strong"),b.Dc(10),b.Sb(),b.Dc(11," as data labels"),b.Sb(),b.Tb(12,"p"),b.Dc(13,"Existing labels and column types will be overwritten"),b.Sb(),b.Sb(),b.Tb(14,"div",4),b.Tb(15,"p"),b.Tb(16,"strong"),b.Dc(17,"Labels: "),b.Sb(),b.Dc(18),b.Sb(),b.Sb(),b.Sb(),b.Tb(19,"div",5),b.Tb(20,"button",6),b.Dc(21,"Copy labels"),b.Sb(),b.Tb(22,"button",7),b.Dc(23,"Cancel"),b.Sb(),b.Sb()),2&t&&(b.Bb(10),b.Fc("[",e.rowNr,"]"),b.Bb(8),b.Ec(e.values),b.Bb(2),b.jc("mat-dialog-close",e.orgRange))},directives:[p.h,p.d,p.e,p.c],encapsulation:2}),t})();var O=i("9+85");function E(t,e){1&t&&(b.Tb(0,"div",9),b.Tb(1,"strong"),b.Dc(2,"Missing data labels. Please use one of the methods:"),b.Sb(),b.Tb(3,"ul"),b.Tb(4,"li"),b.Dc(5,"Click and draw over the headers of columns to select the range and assign the data labels in the popup dialog. "),b.Sb(),b.Tb(6,"li"),b.Dc(7,"Use the form below to manually provide the column range and the data label."),b.Sb(),b.Sb(),b.Sb())}function F(t,e){if(1&t){const t=b.Ub();b.Tb(0,"div"),b.Tb(1,"div",10),b.Tb(2,"label",11),b.Dc(3,"Time parameter: offset (hours)"),b.Sb(),b.Tb(4,"input",12,13),b.Zb("ngModelChange",(function(e){return b.sc(t),b.dc(2).timeColumnDescription.details.timeOffset=e})),b.Sb(),b.Sb(),b.Sb()}if(2&t){const t=b.dc(2);b.Bb(4),b.jc("ngModel",t.timeColumnDescription.details.timeOffset)}}function L(t,e){if(1&t){const t=b.Ub();b.Tb(0,"li",17),b.Zb("click",(function(){b.sc(t);const i=e.$implicit;return b.dc(3).editBlock(i)})),b.Tb(1,"span"),b.Tb(2,"strong"),b.Dc(3),b.Sb(),b.Dc(4),b.Sb(),b.Tb(5,"a",18),b.Zb("click",(function(){b.sc(t);const i=e.$implicit;return b.dc(3).deleteBlock(i)})),b.Tb(6,"i",19),b.Dc(7,"delete_forever"),b.Sb(),b.Sb(),b.Sb()}if(2&t){const t=e.$implicit;b.Bb(3),b.Ec(t.topcountLabel),b.Bb(1),b.Fc(" : ",t.value,"")}}function j(t,e){if(1&t&&(b.Tb(0,"div"),b.Tb(1,"p"),b.Tb(2,"strong"),b.Dc(3,"Columns descriptions (select to edit)"),b.Sb(),b.Sb(),b.Tb(4,"div",14),b.Tb(5,"ul",15),b.Bc(6,L,8,2,"li",16),b.Sb(),b.Sb(),b.Sb()),2&t){const t=b.dc(2);b.Bb(6),b.jc("ngForOf",t.dataBlocks)}}function N(t,e){if(1&t){const t=b.Ub();b.Tb(0,"th",20),b.Zb("mousedown",(function(){b.sc(t);const i=e.$implicit;return b.dc(2).thSelectStart(i)}))("mouseup",(function(){b.sc(t);const i=e.$implicit;return b.dc(2).thSelectEnd(i)})),b.Dc(1),b.Sb()}if(2&t){const t=e.$implicit,i=b.dc(2);b.Bb(1),b.Fc(" ",i.dataModel.th[t]," ")}}function A(t,e){if(1&t&&(b.Tb(0,"td"),b.Dc(1),b.Sb()),2&t){const t=e.$implicit,i=b.dc().$implicit,o=b.dc(2);b.yc("background-color",o.bgColors[t]?o.bgColors[t]:"inherited"),b.Bb(1),b.Fc("",i[t]," ")}}function U(t,e){if(1&t&&(b.Tb(0,"tr"),b.Tb(1,"td",21),b.Dc(2),b.Sb(),b.Bc(3,A,2,3,"td",22),b.Sb()),2&t){const t=e.index,i=b.dc(2);b.Bb(2),b.Ec(i.dataModel.specialRowsLabels[t]),b.Bb(1),b.jc("ngForOf",i.visibleColIx)}}function x(t,e){if(1&t&&(b.Tb(0,"td"),b.Dc(1),b.Sb()),2&t){const t=e.$implicit,i=b.dc().$implicit,o=b.dc(2);b.yc("background-color",o.bgColors[t]?o.bgColors[t]:"inherited"),b.Bb(1),b.Fc("",i[t]," ")}}function G(t,e){if(1&t&&(b.Tb(0,"tr"),b.Tb(1,"td",21),b.Dc(2),b.Sb(),b.Bc(3,x,2,3,"td",22),b.Sb()),2&t){const t=e.index,i=b.dc(2);b.Bb(2),b.Ec(i.dataModel.rowsLabels[t]),b.Bb(1),b.jc("ngForOf",i.visibleColIx)}}function _(t,e){if(1&t){const t=b.Ub();b.Tb(0,"div"),b.Ob(1,"hr"),b.Tb(2,"div"),b.Tb(3,"h4"),b.Dc(4,"Current Topcount import parameters "),b.Sb(),b.Bc(5,E,8,0,"div",1),b.Bc(6,F,6,1,"div",0),b.Bc(7,j,7,1,"div",2),b.Tb(8,"div"),b.Tb(9,"button",3),b.Zb("click",(function(){return b.sc(t),b.dc().accept()})),b.Dc(10,"Import timeseries "),b.Sb(),b.Sb(),b.Sb(),b.Ob(11,"hr"),b.Tb(12,"h4"),b.Dc(13,"Data table "),b.Tb(14,"small"),b.Dc(15,"(only top rows)"),b.Sb(),b.Sb(),b.Tb(16,"p"),b.Dc(17,"Click on column headers for description options"),b.Sb(),b.Tb(18,"div",4),b.Tb(19,"table",5),b.Tb(20,"thead"),b.Tb(21,"tr",6),b.Ob(22,"th"),b.Bc(23,N,2,1,"th",7),b.Sb(),b.Sb(),b.Tb(24,"tbody"),b.Bc(25,U,4,2,"tr",8),b.Bc(26,G,4,2,"tr",8),b.Sb(),b.Sb(),b.Sb(),b.Sb()}if(2&t){const t=b.dc();b.Bb(5),b.jc("ngIf",!t.hasData()),b.Bb(1),b.jc("ngIf",t.timeColumnDescription),b.Bb(1),b.jc("ngIf",t.dataBlocks&&t.dataBlocks.length>0),b.Bb(2),b.jc("disabled",t.blocked||!t.hasTime()||!t.hasData()),b.Bb(14),b.jc("ngForOf",t.visibleColIx),b.Bb(2),b.jc("ngForOf",t.dataModel.specialRows),b.Bb(1),b.jc("ngForOf",t.dataModel.rows)}}let z=(()=>{class t{constructor(t,e){this.confDialogs=t,this.matDialog=e,this.onAccepted=new b.o,this.blocked=!1,this.confirmDataLoss=!1,this.columnBlocks=new u.e,this.dataBlocks=[],this.bgColors=[]}set dataTable(t){if(!t||t.length<1)return;const e=new f(t,this.topcountHeaders(),void 0,[[]],["L."]);this.dataModel=e,this.lastCol=e.width,this.visibleColIx=[];for(let i=0;i<e.width;i++)this.visibleColIx.push(i);this.initTime()}topcountHeaders(){const t=[];return["A","B","C","D","E","F","G","H"].forEach(e=>{for(let i=1;i<13;i++)t.push(e+i)}),t}initTime(){const t=new u.b(new u.a(0,0),new u.a(0,0)),e=new u.g;e.timeType=u.h.TIME_IN_HOURS,e.timeOffset=0,e.firstRow=1;const i=new u.c(t);i.role=u.d.TIME,i.details=e,this.timeColumnDescription=i}hasTime(){return this.timeColumnDescription&&this.timeColumnDescription.role===u.d.TIME}hasData(){return this.dataBlocks.some(t=>t.details.role===u.d.DATA)}rowSelected(t){const e=this.joinRow(t),i=new u.a(0,t+1),o=new u.b(i,i),s=new u.c(o,e);this.askCopyRow(s)}askCopyRow(t){this.matDialog.open(R,{data:t,autoFocus:!1}).afterClosed().subscribe(t=>{t&&this.copyRowAsLabels(t)})}thSelectStart(t){this.thSelectedCol=t}thSelectEnd(t){if(void 0!==this.thSelectedCol&&null!=this.thSelectedCol){const e=new u.a(this.thSelectedCol+1,1),i=new u.a(t+1,1),o=new u.b(e,i),s=new u.c(o,void 0),l=this.columnBlocks.details(e.col);l&&(s.role=l.role,s.details=l.details),this.thSelectedCol=void 0,this.askColumnsDetails(s)}}askColumnsDetails(t){const e=this.rangeToTopcountLabel(t),i=new I(t,this.lastCol,!1,e);this.matDialog.open(M,{data:i,autoFocus:!1}).afterClosed().subscribe(t=>{if(t){const e=t.follow;t.follow=void 0,this.setColumnType(t),e&&this.askColumnsDetails(e)}})}rangeToTopcountLabel(t){const e=t.range;return Object(u.j)(e.firstCol)+"-"+Object(u.j)(e.lastCol)}editBlock(t){t&&this.askColumnsDetails(t.details)}deleteBlock(t){t&&(t.details.role==u.d.TIME?this.clearTime():this.resetRegion(t.details.range),this.dataBlocks=this.columnBlocks.blocks)}accept(){if(!this.hasTime()||!this.hasData())return;let t=Promise.resolve(!0);this.containsDataGaps()&&(t=this.confDialogs.confirm("Do you want to import partial data?","Not all columns are described. Data columns without annotations will not be imported.<br>Click OK if you want to proceed.").toPromise()),t.then(t=>!!t&&(!this.confirmDataLoss||this.confDialogs.confirm("Do you want to replace the existing data?","It will also erase all analysis results. <br>Click OK if you want to proceed.").toPromise())).then(t=>{t&&this.emitParameters()}).catch(t=>console.log("Dialog error: "+t))}containsDataGaps(){if(this.dataBlocks.length<1)return!0;if(this.dataBlocks[this.dataBlocks.length-1].end<this.lastCol)return!0;let t=this.dataBlocks[0].start-1;for(let e=0;e<this.dataBlocks.length;e++){if(this.dataBlocks[e].start!==t+1)return!0;t=this.dataBlocks[e].end}return!1}emitParameters(){const t=new r.c;t.timeColumn=this.timeColumnDescription,t.dataBlocks=this.dataBlocks.map(t=>t.details),this.onAccepted.emit(t)}joinRow(t){return this.dataModel.rows[t].slice(0,10).join(" | ")+"..."}setColumnType(t){if(t&&void 0!==t.role){let e;switch(this.timeColumnDescription&&(t.role==u.d.TIME||this.timeColumnDescription.firstCol>=t.firstCol&&this.timeColumnDescription.firstCol<=t.lastCol)&&this.clearTime(),t.role){case u.d.IGNORED:e="ign.";break;case u.d.BACKGROUND:e="bcg.";break;case u.d.TIME:e="Time";break;case u.d.DATA:e=t.details.dataLabel}this.columnBlocks.insert(t,e),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks;const i=this.dataModel.specialRows[0];if(i)for(let o=t.firstCol-1;o<t.lastCol;o++)i[o]=e;t.role==u.d.TIME&&(this.timeColumnDescription=t),this.updateBackgrounds()}}copyRowAsLabels(t){if(t){this.clearTime();const e=this.dataModel.specialRows[0];this.dataModel.rows[t.range.first.row-1].forEach((t,i)=>{if(t){const o=new u.f(t),s=new u.a(i+1,0),l=new u.b(s,s),n=new u.c(l,void 0);n.details=o,n.role=u.d.DATA,this.columnBlocks.insert(n,t),e[i]=t}}),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks,this.updateBackgrounds()}}clearTime(){this.timeColumnDescription&&(this.resetRegion(this.timeColumnDescription.range),this.timeColumnDescription=void 0)}updateBackgrounds(){for(let t=0;t<this.dataBlocks.length;t++){const e=this.dataBlocks[t];let i=g.color(t);e.details.role==u.d.IGNORED&&(i=g.IGNORED_BG),e.details.role==u.d.BACKGROUND&&(i=g.NOISE_BG),e.details.role==u.d.TIME&&(i=g.TIME_BG);for(let t=e.start-1;t<e.end;t++)this.bgColors[t]=i}}resetRegion(t){this.resetLabels(t),this.resetBackground(t),this.columnBlocks.delete(t)}resetBackground(t){for(let e=t.firstCol-1;e<t.lastCol;e++)this.bgColors[e]="transparent"}resetLabels(t){const e=this.dataModel.specialRows[0];for(let i=t.firstCol-1;i<t.lastCol;i++)e[i]="-"}fakeData(){const t=[];let e=[];e.push("");for(let i=1;i<25;i++)e.push("RO "+i);t.push(e),e=[],e.push("");for(let i=1;i<25;i++)e.push("cls"+Math.round(i/3));t.push(e);for(let i=1;i<5;i++){e=[],e.push(""+i);for(let t=1;t<25;t++)e.push(""+(i+t));t.push(e)}return t}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(O.a),b.Nb(p.b))},t.\u0275cmp=b.Hb({type:t,selectors:[["bd2-describe-topcount-table"]],inputs:{blocked:"blocked",confirmDataLoss:"confirmDataLoss",dataTable:"dataTable"},outputs:{onAccepted:"onAccepted"},decls:1,vars:1,consts:[[4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["style","",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[2,"overflow-x","auto"],["role","grid",1,"table","table-bordered","excel-table",2,"width","auto"],["role","row"],[3,"mousedown","mouseup",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["type","danger","role","alert",1,"alert","alert-danger"],[1,"form-group"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control","short-input",3,"ngModel","ngModelChange"],["fTimeOffset","ngModel"],[2,"max-height","20em","overflow-y","auto","margin-bottom","1em"],[1,"list-group"],["class","list-group-item",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item",3,"click"],["role","button","aria-label","delete",1,"float-right",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[3,"mousedown","mouseup"],[1,"rowh"],[3,"background-color",4,"ngFor","ngForOf"]],template:function(t,e){1&t&&b.Bc(0,_,27,7,"div",0),2&t&&b.jc("ngIf",e.dataModel)},directives:[o.m,o.l,s.v,s.d,s.q,s.t],encapsulation:2}),t})();function Z(t,e){if(1&t){const t=b.Ub();b.Tb(0,"bd2-describe-topcount-table",1),b.Zb("onAccepted",(function(e){return b.sc(t),b.dc().import(e)})),b.Sb()}if(2&t){const t=b.dc();b.jc("dataTable",t.dataTable)("blocked",t.blocked)("confirmDataLoss",null==t.assay?null:t.assay.features.hasTSData)}}const K=[{path:"",children:[{path:":format/:fileId",component:(()=>{class t extends c.a{constructor(t,e,i){super(i),this.fileViewService=t,this.route=e,this.blocked=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit(),this.route.params.forEach(t=>{const e=t.fileId,i=t.format;e&&i?this.loadData(i,e):console.log(this.constructor.name+" null parameters")})}loadData(t,e){this.format=r.e.get(t),this.fileId=e,this.blocked=!1,this.fileViewService.getSimpleTableView(e).then(t=>{this.dataTable=t}).catch(t=>{this.feedback.error(t)})}import(t){if(t&&this.fileId&&this.format){this.blocked=!0;const e=new r.d;e.fileId=this.fileId,e.importFormat=this.format,e.importParameters=t,this.experimentService.importTimeSeries(this.assay,e).toPromise().then(t=>(this.feedback.success("Imported "+t.imported+" timeseries"),t)).then(()=>this.refreshModel()).then(t=>this.goToTSView()).catch(t=>{this.blocked=!1,this.feedback.error(t)})}}goToTSView(){const t=this.expHomePath();t.push("data"),t.push("view"),t.push("ts"),this.router.navigate(t)}}return t.\u0275fac=function(e){return new(e||t)(b.Nb(h),b.Nb(a.a),b.Nb(m.a))},t.\u0275cmp=b.Hb({type:t,selectors:[["ng-component"]],features:[b.Ab([]),b.yb],decls:3,vars:1,consts:[[3,"dataTable","blocked","confirmDataLoss","onAccepted",4,"ngIf"],[3,"dataTable","blocked","confirmDataLoss","onAccepted"]],template:function(t,e){1&t&&(b.Tb(0,"h3"),b.Dc(1,"Timeseries import"),b.Sb(),b.Bc(2,Z,1,3,"bd2-describe-topcount-table",0)),2&t&&(b.Bb(2),b.jc("ngIf","TOPCOUNT"===(null==e.format?null:e.format.name)))},directives:[o.m,z],encapsulation:2}),t})()}]}];let P=(()=>{class t{}return t.\u0275mod=b.Lb({type:t}),t.\u0275inj=b.Kb({factory:function(e){return new(e||t)},imports:[[a.f.forChild(K)],a.f]}),t})(),V=(()=>{class t{}return t.\u0275mod=b.Lb({type:t}),t.\u0275inj=b.Kb({factory:function(e){return new(e||t)},imports:[[o.c,s.k,s.y,l.a,n.a,P]]}),t})()}}]);