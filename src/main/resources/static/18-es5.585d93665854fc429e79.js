function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var a=_superPropBase(e,t);if(a){var o=Object.getOwnPropertyDescriptor(a,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var i=[],a=!0,o=!1,l=void 0;try{for(var n,r=e[Symbol.iterator]();!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(s){o=!0,l=s}finally{try{a||null==r.return||r.return()}finally{if(o)throw l}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{yPAH:function(e,t,i){"use strict";i.r(t);var a,o,l,n=i("ofXK"),r=i("3Pt+"),s=i("tyNb"),c=i("EvUs"),u=i("yYXI"),b=i("fXoL"),m=i("UsWK"),d=i("GVyA"),f=i("KhIM"),h=i("2Vo4"),p=i("XNiG"),g=i("itXk"),v=i("pLZG"),C=i("/uUt"),w=i("eIep"),y=i("Cfvw"),k=i("5+tZ"),S=i("lJxs"),D=i("M9IT"),L=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D.d,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D.d;_classCallCheck(this,e),this.rowPage=t,this.colPage=i}return _createClass(e,[{key:"equals",value:function(t){return!!t&&e.pageEquals(this.rowPage,t.rowPage)&&e.pageEquals(this.colPage,t.colPage)}}],[{key:"firstPage",value:function(){var t=new e;return t.rowPage.pageIndex=0,t.rowPage.pageSize=50,t.colPage.pageIndex=0,t.colPage.pageSize=50,t}},{key:"pageEquals",value:function(e,t){return e.pageIndex===t.pageIndex&&e.pageSize===t.pageSize}}]),e}(),R=((l=function(){function e(t){_classCallCheck(this,e),this.BD2REST=t}return _createClass(e,[{key:"uploadFile",value:function(e){var t=new FormData;return t.append("file",e,e.name),this.BD2REST.fileUpload(t).then((function(e){return e.id}))}}]),e}()).\u0275fac=function(e){return new(e||l)(b.ac(m.a))},l.\u0275prov=b.Mb({token:l,factory:l.\u0275fac,providedIn:"root"}),l),I=((o=function(){function e(t,i){_classCallCheck(this,e),this.uploadService=t,this.BD2REST=i}return _createClass(e,[{key:"uploadFile",value:function(e,t){var i=this;return Object(y.a)(this.uploadService.uploadFile(e)).pipe(Object(k.a)((function(e){return i.verifyFormat(t,e).pipe(Object(S.a)((function(t){return e})))})))}},{key:"verifyFormat",value:function(e,t){return this.BD2REST.fileViewVerifyFormat(e,t)}},{key:"getTableSlice",value:function(e,t,i){return this.BD2REST.fileViewTableSlice(e,t,i)}},{key:"previewLabels",value:function(e,t,i,a){var o=new L;return a?(o.rowPage.pageSize=500,o.rowPage.pageIndex=0,o.colPage.pageSize=1,o.colPage.pageIndex=i.colIx):(o.rowPage.pageSize=1,o.rowPage.pageIndex=i.rowIx,o.colPage.pageSize=500,o.colPage.pageIndex=0),this.getTableSlice(e,t,o).pipe(Object(S.a)((function(e){var t=[];return e.data.forEach((function(e){return e.forEach((function(e){return t.push(""+e)}))})),t})))}}]),e}()).\u0275fac=function(e){return new(e||o)(b.ac(R),b.ac(m.a))},o.\u0275prov=b.Mb({token:o,factory:o.\u0275fac,providedIn:"root"}),o),W=((a=function(){function e(t){_classCallCheck(this,e),this.tsFileService=t,this.tableSlice$=new h.a(void 0),this.slice$=new h.a(void 0),this.fileIdFormat$=new h.a(void 0),this.error$=new p.a,this.dataSlice$=this.tableSlice$.asObservable().pipe(Object(v.a)((function(e){return null!=e&&void 0!==e}))),this.initDataStream()}return _createClass(e,[{key:"close",value:function(){this.slice$.complete(),this.fileIdFormat$.complete(),this.tableSlice$.complete(),this.error$.complete()}},{key:"slice",value:function(e){e&&this.slice$.next(e)}},{key:"fileIdFormat",value:function(e){e&&e[0]&&e[1]&&this.fileIdFormat$.next(e)}},{key:"sameParams",value:function(e,t){var i=_slicedToArray(e,2),a=_slicedToArray(i[0],2),o=a[0],l=a[1],n=i[1],r=_slicedToArray(t,2),s=_slicedToArray(r[0],2),c=s[0],u=s[1],b=r[1];return o==c&&l==u&&n.equals(b)}},{key:"initDataStream",value:function(){var e=this;Object(g.a)([this.fileIdFormat$,this.slice$]).pipe(Object(v.a)((function(e){var t=_slicedToArray(e,2),i=t[0],a=t[1];return i&&!!a})),Object(C.a)(this.sameParams)).pipe(Object(w.a)((function(t){var i=_slicedToArray(t,2),a=i[0],o=i[1];return e.tsFileService.getTableSlice(a[0],a[1],o)}))).subscribe((function(t){return e.tableSlice$.next(t)}),(function(t){return e.error$.next(t)}))}}]),e}()).\u0275fac=function(e){return new(e||a)(b.ac(I))},a.\u0275prov=b.Mb({token:a,factory:a.\u0275fac}),a),V=i("6tuW"),N=i("xHqg"),_=i("Wp6s"),T=i("kmnG"),x=i("d3UM"),O=i("vLYz"),P=i("FKr1");function B(e,t){if(1&e&&(b.Wb(0,"mat-option",9),b.Jc(1),b.Vb()),2&e){var i=t.$implicit;b.oc("value",i),b.Cb(1),b.Kc(i.label)}}function H(e,t){1&e&&(b.Wb(0,"div",10),b.Jc(1," An Excel file in which one column contains time values while other columns contain measurements taken at the corresponding times. "),b.Wb(2,"ul"),b.Wb(3,"li"),b.Jc(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes from start, seconds from start, or as image nr (1-based) which will be converted to time using interval between images. "),b.Vb(),b.Wb(5,"li"),b.Jc(6," Not all columns have to be imported. "),b.Vb(),b.Wb(7,"li"),b.Jc(8," First few rows can contain arbitrary text. "),b.Vb(),b.Wb(9,"li"),b.Jc(10," Values from one row can be used as data labels. "),b.Vb(),b.Vb(),b.Vb())}function F(e,t){1&e&&(b.Wb(0,"div",10),b.Jc(1," A coma or tab separeted file in which one column or row contains time values while other columns or rows contain measurements taken at the corresponding times. "),b.Wb(2,"ul"),b.Wb(3,"li"),b.Jc(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes or seconds from start, or as image numbers "),b.Vb(),b.Wb(5,"li"),b.Jc(6," Not all columns/rows have to be imported. "),b.Vb(),b.Wb(7,"li"),b.Jc(8," First few rows/columns can contain arbitrary text. "),b.Vb(),b.Wb(9,"li"),b.Jc(10," Values from one row/column can be used as data labels. "),b.Vb(),b.Vb(),b.Vb())}function J(e,t){1&e&&(b.Wb(0,"div",10),b.Jc(1," Topcount data can be uploaded in two forms: "),b.Wb(2,"ul"),b.Wb(3,"li"),b.Jc(4,"Individual file which contains concatenated topcount data blocks in one file"),b.Vb(),b.Wb(5,"li"),b.Jc(6,"Zip file which contains packed files from individual topcount reads"),b.Vb(),b.Vb(),b.Jc(7,' Check the Dosc section for details about suported data layouts inside tomcats file, we can currently read ASCI content with "plate map" or "column" layouts. '),b.Vb())}function A(e,t){if(1&e&&(b.Wb(0,"div",11),b.Jc(1),b.Vb()),2&e){var i=b.ic();b.Cb(1),b.Lc(" ",i.formatWarning," ")}}var M,E=((M=function(){function e(){_classCallCheck(this,e),this.blocked=!1,this.uploadFiles=new b.o,this.importFormatOptions=c.f,this.importFormat=c.e.EXCEL_TABLE}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"upload",value:function(e){this.uploadFiles.next({files:e,importFormat:this.importFormat})}},{key:"formatChanged",value:function(e){this.lastFiles&&this.checkFormat(this.lastFiles)}},{key:"checkFormat",value:function(e){var t=this;this.lastFiles=e,this.formatWarning=void 0,e.forEach((function(e){if(t.importFormat===c.e.TOPCOUNT){var i=t.isTopCount(e);i&&(t.formatWarning="The selected file does not seem to be a topcount file/archive but rather: "+i+". If you sure it is a valid topcount file/archive you can continue upload.")}else if(t.importFormat===c.e.EXCEL_TABLE){var a=t.isExcel(e);a&&(t.formatWarning="The selected file does not seem to be an excel file but rather: "+a+". If you sure it is a valid excel file you can continue upload.")}else if(t.importFormat===c.e.TAB_SEP){var o=t.isTab(e);o&&(t.formatWarning="The selected file does not seem to be a tab-separated file but rather: "+o+". If you sure it is a valid tsv file you can continue upload.")}else if(t.importFormat===c.e.COMA_SEP){var l=t.isComa(e);l&&(t.formatWarning="The selected file does not seem to be a coma-separated file but rather: "+l+". If you sure it is a valid csv file you can continue upload.")}}))}},{key:"isTopCount",value:function(e){var t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")?"Excel":e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".tsv")?"tab separated":null):"Unknown"}},{key:"isExcel",value:function(e){var t=e.type;return t&&e.name?e.name.endsWith(".csv")?"CSV":e.name.endsWith(".txt")?"text":e.name.endsWith(".tsv")?"tab separated":t.indexOf("excel")>=0?null:t.indexOf("sheet")>=0?null:t:"Unknown"}},{key:"isTab",value:function(e){var t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")?"Excel":e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".tsv")?null:"Unrecognized"):"Unknown"}},{key:"isComa",value:function(e){var t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".tsv")?"tab separated":e.name.endsWith(".xls")?"Excel":e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".csv")?null:"Unrecognized"):"Unknown"}}]),e}()).\u0275fac=function(e){return new(e||M)},M.\u0275cmp=b.Kb({type:M,selectors:[["bd2-upload-data-file-step"]],outputs:{uploadFiles:"uploadFiles"},decls:19,vars:9,consts:[[1,"mat-elevation-z4"],[1,""],[1,"form-group"],["required","",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["dismissible","true","style","font-size: smaller;","type","info","class","alert alert-info","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"autoReset","blocked","multiple","selectedFiles","uploadFiles"],["uploadWidget",""],[3,"value"],["dismissible","true","type","info","role","alert",1,"alert","alert-info",2,"font-size","smaller"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(e,t){1&e&&(b.Wb(0,"div"),b.Wb(1,"mat-card",0),b.Wb(2,"mat-card-title"),b.Jc(3,"Time series file"),b.Vb(),b.Wb(4,"mat-card-content"),b.Wb(5,"form",1),b.Wb(6,"div",2),b.Wb(7,"mat-form-field"),b.Wb(8,"mat-label"),b.Jc(9,"File Format"),b.Vb(),b.Wb(10,"mat-select",3),b.ec("valueChange",(function(e){return t.importFormat=e}))("selectionChange",(function(e){return t.formatChanged(e)})),b.Hc(11,B,2,2,"mat-option",4),b.Vb(),b.Vb(),b.Vb(),b.Hc(12,H,11,0,"div",5),b.Hc(13,F,11,0,"div",5),b.Hc(14,J,8,0,"div",5),b.Hc(15,A,2,1,"div",6),b.Wb(16,"div",2),b.Wb(17,"bd2-file-upload-widget",7,8),b.ec("selectedFiles",(function(e){return t.checkFormat(e)}))("uploadFiles",(function(e){return t.upload(e)})),b.Vb(),b.Vb(),b.Vb(),b.Vb(),b.Vb(),b.Vb()),2&e&&(b.Cb(10),b.oc("value",t.importFormat),b.Cb(1),b.oc("ngForOf",t.importFormatOptions),b.Cb(1),b.oc("ngIf","EXCEL_TABLE"==t.importFormat.name),b.Cb(1),b.oc("ngIf","TAB_SEP"==t.importFormat.name||"COMA_SEP"==t.importFormat.name),b.Cb(1),b.oc("ngIf","TOPCOUNT"==t.importFormat.name),b.Cb(1),b.oc("ngIf",t.formatWarning),b.Cb(2),b.oc("autoReset",!1)("blocked",t.blocked||!t.importFormat)("multiple",!1))},directives:[_.a,_.e,_.c,r.C,r.q,r.r,T.b,T.f,x.a,n.l,n.m,O.a,P.o],encapsulation:2}),M),U=i("f0Cb");function z(e,t){if(1&e&&(b.Wb(0,"span"),b.Wb(1,"label"),b.Jc(2,"Images every"),b.Vb(),b.Jc(3),b.Vb()),2&e){var i=b.ic(2);b.Cb(3),b.Lc(" ",i.importDetails.imgInterval,"h ")}}function K(e,t){if(1&e&&(b.Wb(0,"span"),b.Wb(1,"label"),b.Jc(2,"Time offset"),b.Vb(),b.Jc(3),b.Vb()),2&e){var i=b.ic(2);b.Cb(3),b.Lc(" ",i.importDetails.timeOffset,"h ")}}function G(e,t){if(1&e&&(b.Wb(0,"p"),b.Wb(1,"label"),b.Jc(2,"First time point:"),b.Vb(),b.Wb(3,"strong"),b.Jc(4),b.Vb(),b.Hc(5,z,4,1,"span",1),b.Hc(6,K,4,1,"span",1),b.Vb()),2&e){var i=b.ic();b.Cb(4),b.Nc("",i.firstTimeCell.value," ",null==i.importDetails.timeType?null:i.importDetails.timeType.unit," [",i.firstTimeCell.colName+":"+i.firstTimeCell.rowName,"]"),b.Cb(1),b.oc("ngIf","IMG_NUMBER"===(null==i.importDetails.timeType?null:i.importDetails.timeType.name)),b.Cb(1),b.oc("ngIf",0!=i.importDetails.timeOffset)}}function j(e,t){if(1&e&&(b.Wb(0,"p"),b.Jc(1),b.Wb(2,"strong"),b.Jc(3),b.Vb(),b.Vb()),2&e){var i=b.ic();b.Cb(1),b.Lc(" Labels in ",i.importDetails.inLabelNeg," "),b.Cb(2),b.Lc("",i.importDetails.inRows?i.labelsSelection.colName:i.labelsSelection.rowName,";")}}function X(e,t){if(1&e&&(b.Wb(0,"p"),b.Wb(1,"label"),b.Jc(2,"Selected Labels:"),b.Vb(),b.Jc(3),b.Vb()),2&e){var i=b.ic();b.Cb(3),b.Lc(" ",i.importDetails.summarizeLabels()," ")}}function $(e,t){if(1&e&&(b.Wb(0,"p"),b.Jc(1),b.Wb(2,"strong"),b.Jc(3),b.Vb(),b.Vb()),2&e){var i=b.ic();b.Cb(1),b.Lc(" Data starts in ",i.importDetails.inLabel," "),b.Cb(2),b.Lc("",i.importDetails.inRows?i.dataStart.rowName:i.dataStart.colName,";")}}function Q(e,t){if(1&e&&(b.Wb(0,"p"),b.Jc(1),b.Vb()),2&e){var i=b.ic();b.Cb(1),b.Lc(" Background noise as: ",i.importDetails.backgroundsLabels.join(", ")," ")}}var q,Y,Z=((q=function(){function e(){_classCallCheck(this,e),this.showTime=!1,this.showLabelling=!1,this.showDataStart=!1}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"firstTimeCell",get:function(){return this.importDetails?this.importDetails.firstTimeCell:void 0}},{key:"labelsSelection",get:function(){return this.importDetails?this.importDetails.labelsSelection:void 0}},{key:"dataStart",get:function(){return this.importDetails?this.importDetails.dataStart:void 0}}]),e}()).\u0275fac=function(e){return new(e||q)},q.\u0275cmp=b.Kb({type:q,selectors:[["bd2-import-details-summary"]],inputs:{importDetails:"importDetails",showTime:"showTime",showLabelling:"showLabelling",showDataStart:"showDataStart"},decls:13,vars:8,consts:[[1,"mat-elevation-z4"],[4,"ngIf"]],template:function(e,t){1&e&&(b.Wb(0,"mat-card",0),b.Wb(1,"p"),b.Jc(2),b.Wb(3,"strong"),b.Jc(4),b.Vb(),b.Vb(),b.Wb(5,"p"),b.Wb(6,"label"),b.Jc(7),b.Vb(),b.Vb(),b.Hc(8,G,7,5,"p",1),b.Hc(9,j,4,2,"p",1),b.Hc(10,X,4,1,"p",1),b.Hc(11,$,4,2,"p",1),b.Hc(12,Q,2,1,"p",1),b.Vb()),2&e&&(b.Cb(2),b.Lc("",null==t.importDetails?null:null==t.importDetails.importFormat?null:t.importDetails.importFormat.label,": "),b.Cb(2),b.Kc(null==t.importDetails?null:t.importDetails.fileName),b.Cb(3),b.Lc("Time series in ",(null==t.importDetails?null:t.importDetails.inLabel)+"s",""),b.Cb(1),b.oc("ngIf",t.showTime&&t.firstTimeCell),b.Cb(1),b.oc("ngIf",t.showLabelling&&t.importDetails.importLabels&&t.labelsSelection),b.Cb(1),b.oc("ngIf",t.showLabelling&&!t.importDetails.importLabels),b.Cb(1),b.oc("ngIf",t.showDataStart&&t.importDetails.importLabels&&t.dataStart),b.Cb(1),b.oc("ngIf",t.showLabelling&&t.importDetails.containsBackgrounds&&t.importDetails.backgroundsLabels))},directives:[_.a,n.m],encapsulation:2}),q),ee=i("QibW"),te=i("bTqV"),ie=function(){function e(){_classCallCheck(this,e),this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}return _createClass(e,[{key:"reset",value:function(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}},{key:"setRowBackground",value:function(e,t){this.rowsBackgrounds[e]=t}},{key:"rowBackground",value:function(e){return this.getOrEmptyString(this.rowsBackgrounds,e)}},{key:"colBackground",value:function(e){return this.getOrEmptyString(this.colsBackgrounds,e)}},{key:"setColBackground",value:function(e,t){this.colsBackgrounds[e]=t}},{key:"cellBackground",value:function(e,t){return this.getOrEmptyString(this.getOrDefault(this.cellBackgrounds,t,[]),e)||this.colBackground(e)}},{key:"setCellBackground",value:function(e,t,i){var a=this.cellBackgrounds[t];void 0===a&&(a=[],this.cellBackgrounds[t]=a),a[e]=i}},{key:"getOrEmptyString",value:function(e,t){return this.getOrDefault(e,t,"")}},{key:"getOrDefault",value:function(e,t,i){return t>=e.length||void 0===e[t]?i:e[t]}}]),e}(),ae=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"rowBackground",value:function(t){return e.MAIN_ROW_BACKGROUND}},{key:"cellBackground",value:function(t){return e.MAIN_CELL_BACKGROUND}},{key:"columnBackground",value:function(t){return e.MAIN_COL_BACKGROUND}}]),e}();return e.MAIN_ROW_BACKGROUND="#dda0dd",e.MAIN_COL_BACKGROUND="#87cefa",e.MAIN_CELL_BACKGROUND="#ba55d3",e.TIME_BACKGROUND="#dda0dd",e.LABELS_BACKGROUND="#87cefa",e.FIRST_TIME_BACKGROUND="#ba55d3",e.FIST_DATA_BACKGROUND="lightgreen",e}(),oe=function(){function e(t,i){_classCallCheck(this,e),this.tableStyler=t,this.colorCycler=i,this.selectedRows=[],this.selectedCols=[],this.tableStyler=t||new ie,this.colorCycler=i||new ae}return _createClass(e,[{key:"toggleRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=this.selectedRows.splice(0,this.selectedRows.length);this.selectedRows.push(e),this.uncolorRows(o),this.colorRows(this.selectedRows,i),t&&(this.uncolorCells(o),this.colorCells(this.selectedRows,a))}},{key:"toggleRowSelection",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,l=this.selectedRows[e]?[this.selectedRows[e]]:[];this.selectedRows[e]=t,this.uncolorRows(l),this.colorRows([this.selectedRows[e]],a),i&&(this.uncolorCells(l),this.colorCells([this.selectedRows[e]],o))}},{key:"selectRow",value:function(e,t){var i=new c.a(-1,-1,void 0,e,e,void 0,void 0),a=this.selectedRows.findIndex((function(t){return t.rowNumber===e}));a<0?this.selectedRows.push(i):this.selectedRows[a]=i,this.colorRows([i],t)}},{key:"deselectRow",value:function(e){var t=this.selectedRows.findIndex((function(t){return t.rowNumber===e}));t>=0&&(this.selectedRows[t]=void 0);var i=new c.a(-1,-1,void 0,e,e,void 0,void 0);this.uncolorRows([i])}},{key:"toggleCol",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=this.selectedCols.splice(0,this.selectedCols.length);this.selectedCols.push(e),this.uncolorCols(o),this.colorCols(this.selectedCols,i),t&&(this.uncolorCells(o),this.colorCells(this.selectedCols,a))}},{key:"toggleColSelection",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,l=this.selectedCols[e]?[this.selectedCols[e]]:[];this.selectedCols[e]=t,this.uncolorCols(l),this.colorCols([this.selectedCols[e]],a),i&&(this.uncolorCells(l),this.colorCells([this.selectedCols[e]],o))}},{key:"selectCol",value:function(e,t){var i=new c.a(e,e,void 0,-1,-1,void 0,void 0),a=this.selectedCols.findIndex((function(t){return t.colNumber===e}));a<0?this.selectedCols.push(i):this.selectedCols[a]=i,this.colorCols([i],t)}},{key:"deselectCol",value:function(e){var t=this.selectedCols.findIndex((function(t){return t.colNumber===e}));t>=0&&(this.selectedCols[t]=void 0);var i=new c.a(e,e,void 0,-1,-1,void 0,void 0);this.uncolorCols([i])}},{key:"reset",value:function(){this.selectedRows=[],this.selectedCols=[],this.tableStyler.reset()}},{key:"colorRows",value:function(e,t){var i=this;e.forEach((function(e,a){i.tableStyler.setRowBackground(e.rowNumber,t||i.colorCycler.rowBackground(a))}))}},{key:"colorCols",value:function(e,t){var i=this;e.forEach((function(e,a){i.tableStyler.setColBackground(e.colNumber,t||i.colorCycler.columnBackground(a))}))}},{key:"colorCells",value:function(e,t){var i=this;e.forEach((function(e,a){i.tableStyler.setCellBackground(e.colNumber,e.rowNumber,t||i.colorCycler.cellBackground(a))}))}},{key:"uncolorRows",value:function(e){var t=this;e.forEach((function(e){t.tableStyler.setRowBackground(e.rowNumber,void 0)}))}},{key:"uncolorCols",value:function(e){var t=this;e.forEach((function(e){t.tableStyler.setColBackground(e.colNumber,void 0)}))}},{key:"uncolorCells",value:function(e){var t=this;e.forEach((function(e){t.tableStyler.setCellBackground(e.colNumber,e.rowNumber,void 0)}))}}]),e}(),le=function(){var e=function(){function e(){_classCallCheck(this,e),this.index=0,this.labelsIndexes=new Map}return _createClass(e,[{key:"toColor",value:function(t){if(t){this.labelsIndexes.has(t)||this.labelsIndexes.set(t,this.index++);var i=this.labelsIndexes.get(t)%e.colors.length;return e.colors[i]}}},{key:"setColor",value:function(e){}}]),e}();return e.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"],e}(),ne=((Y=function(){function e(t,i){_classCallCheck(this,e),this.dataService=t,this.feedback=i,this.tableSelector=new oe,this.lastColumnSeen=0,this.lastRowSeen=0,this.firstPageSlice=L.firstPage(),this.currentPageSlice=L.firstPage()}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.error$.forEach((function(t){return e.feedback.error(t)})),this.dataSubscription=this.dataService.dataSlice$.subscribe((function(t){return e.setDataSlice(t)}),(function(t){return e.feedback.error(t)}))}},{key:"ngOnDestroy",value:function(){this.dataSubscription&&this.dataSubscription.unsubscribe()}},{key:"colNumber",value:function(e){return e<0?-1:this.dataSlice.columnsNumbers[e]}},{key:"rowNumber",value:function(e){return e<0?-1:this.dataSlice.rowsNumbers[e]}},{key:"setDataSlice",value:function(e){this.dataSlice=e,this.lastColumnSeen=Math.max(this.lastColumnSeen,e.columnsNumbers[e.columnsNumbers.length-1]),this.lastRowSeen=Math.max(this.lastRowSeen,e.rowsNumbers[e.rowsNumbers.length-1]),this.currentPageSlice=new L(e.rowPage,e.colPage),this.applySelection()}},{key:"loadData",value:function(){this.importDetails&&(this.lastColumnSeen=0,this.lastRowSeen=0,this.dataService.fileIdFormat([this.importDetails.fileId,this.importDetails.importFormat.name]),this.dataService.slice(this.firstPageSlice)),this.dataSlice&&this.applySelection()}},{key:"applySelection",value:function(){this.tableSelector.reset(),this.markSelections(),this.applyDefaultSelections()}},{key:"applyDefaultSelections",value:function(){}},{key:"markSelections",value:function(){}},{key:"selectFirstTime",value:function(e){this.importDetails.firstTimeCell=e,this.markFirstTime()}},{key:"markFirstTime",value:function(){var e=this.firstTimeCell;e&&(this.importDetails.inRows?this.tableSelector.toggleRow(e,!0,ae.TIME_BACKGROUND,ae.FIRST_TIME_BACKGROUND):this.tableSelector.toggleCol(e,!0,ae.TIME_BACKGROUND,ae.FIRST_TIME_BACKGROUND))}},{key:"selectLabels",value:function(e){this.importDetails.labelsSelection=e,this.markLabels()}},{key:"markLabels",value:function(){var e=this.labelsSelection;e&&(this.importDetails.inRows?this.tableSelector.toggleCol(e,!1,ae.LABELS_BACKGROUND):this.tableSelector.toggleRow(e,!1,ae.LABELS_BACKGROUND))}},{key:"selectDataStart",value:function(e){e?this.importDetails.inRows?this.firstTimeCell&&this.firstTimeCell.rowIx===e.rowIx||(this.importDetails.dataStart=e):this.firstTimeCell&&this.firstTimeCell.colIx===e.colIx||(this.importDetails.dataStart=e):this.importDetails.dataStart=void 0,this.markDataStart()}},{key:"markDataStart",value:function(){var e=this.dataStart;e&&(this.importDetails.inRows?this.tableSelector.toggleRowSelection(1,e,!1,ae.FIST_DATA_BACKGROUND):this.tableSelector.toggleColSelection(1,e,!1,ae.FIST_DATA_BACKGROUND))}},{key:"reselect",value:function(e){if(this.dataSlice&&e){var t=this.dataSlice,i=e.colIx,a=e.rowIx;if(!(i>=t.columnsNumbers.length||a>=t.rowsNumbers.length)){var o=new c.a(i,t.columnsNumbers[i],t.columnsNames[i],a,t.rowsNumbers[a],t.rowsNames[a],(a>=0?t.data[a]:[])[i]);return o.fake=e.fake,o}}}},{key:"hasMoreTimes",value:function(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns:this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows)}},{key:"hasMoreLabels",value:function(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows:this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns)}},{key:"firstTimeCell",get:function(){return this.importDetails?this.importDetails.firstTimeCell:void 0}},{key:"labelsSelection",get:function(){return this.importDetails?this.importDetails.labelsSelection:void 0}},{key:"dataStart",get:function(){return this.importDetails?this.importDetails.dataStart:void 0}}]),e}()).\u0275fac=function(e){return new(e||Y)(b.Qb(W),b.Qb(V.a))},Y.\u0275dir=b.Lb({type:Y}),Y),re=i("+0xr"),se=["table"];function ce(e,t){1&e&&b.Rb(0,"th",10)}function ue(e,t){if(1&e){var i=b.Xb();b.Wb(0,"td",11),b.ec("click",(function(e){b.Ac(i);var a=t.index;return b.ic(2).selectCell(-1,a)})),b.Wb(1,"label"),b.Jc(2),b.Vb(),b.Vb()}if(2&e){var a=t.index,o=b.ic(2);b.Cb(2),b.Kc(o.rowsNames[a])}}function be(e,t){if(1&e){var i=b.Xb();b.Wb(0,"th",15),b.ec("click",(function(e){b.Ac(i);var t=b.ic().index;return b.ic(2).selectCell(t,-1)})),b.Jc(1),b.Vb()}if(2&e){var a=b.ic(),o=a.index,l=a.$implicit,n=b.ic(2);b.Gc("background-color",n.colBackground(o)),b.Cb(1),b.Lc(" ",l," ")}}function me(e,t){if(1&e){var i=b.Xb();b.Wb(0,"td",16),b.ec("click",(function(e){b.Ac(i);var a=t.index,o=b.ic().index;return b.ic(2).selectCell(o,a)})),b.Jc(1),b.Vb()}if(2&e){var a=t.$implicit,o=t.index,l=b.ic().index,n=b.ic(2);b.Gc("background-color",n.cellBackground(l,o)),b.Cb(1),b.Lc(" ",a[l]," ")}}function de(e,t){1&e&&(b.Ub(0,12),b.Hc(1,be,2,3,"th",13),b.Hc(2,me,2,3,"td",14),b.Tb()),2&e&&b.oc("matColumnDef",t.$implicit)}function fe(e,t){1&e&&b.Rb(0,"tr",17)}function he(e,t){if(1&e&&b.Rb(0,"tr",18),2&e){var i=t.index,a=b.ic(2);b.Gc("background-color",a.rowBackground(i))}}function pe(e,t){if(1&e&&(b.Wb(0,"div",1),b.Wb(1,"table",2,3),b.Ub(3,4),b.Hc(4,ce,1,0,"th",5),b.Hc(5,ue,3,1,"td",6),b.Tb(),b.Hc(6,de,3,1,"ng-container",7),b.Hc(7,fe,1,0,"tr",8),b.Hc(8,he,1,2,"tr",9),b.Vb(),b.Vb()),2&e){var i=b.ic();b.Cb(1),b.oc("dataSource",i.data),b.Cb(5),b.oc("ngForOf",i.columnsNames),b.Cb(1),b.oc("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),b.Cb(1),b.oc("matRowDefColumns",i.displayedColumns)}}var ge,ve=((ge=function(){function e(){_classCallCheck(this,e),this.columnsNames=[],this.rowsNames=[],this.data=[],this.styler=new ie,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.selected=new b.o}return _createClass(e,[{key:"colNumber",value:function(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}},{key:"rowNumber",value:function(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}},{key:"colBackground",value:function(e){return this.styler.colBackground(this.colNumber(e))}},{key:"rowBackground",value:function(e){return this.styler.rowBackground(this.rowNumber(e))}},{key:"cellBackground",value:function(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}},{key:"ngOnInit",value:function(){}},{key:"selectCell",value:function(e,t){if((!(e<0)||this.selectableRowHeader)&&(!(t<0)||this.selectableColHeader)){var i=new c.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selected.next(i)}}},{key:"dataSlice",set:function(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.displayedColumns=["rowNr"].concat(this.columnsNames),this.data=e.data,this.matTable&&this.matTable.renderRows())},get:function(){return this._dataSlice}}]),e}()).\u0275fac=function(e){return new(e||ge)},ge.\u0275cmp=b.Kb({type:ge,selectors:[["bd2-data-sheet-mdtable"]],viewQuery:function(e,t){var i;1&e&&b.Pc(se,!0),2&e&&b.wc(i=b.fc())&&(t.matTable=i.first)},inputs:{dataSlice:"dataSlice",styler:"styler",selectableColHeader:"selectableColHeader",selectableRowHeader:"selectableRowHeader"},outputs:{selected:"selected"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color","click",4,"matHeaderCellDef"],["mat-cell","","matRipple","","matRippleCentered","true",3,"background-color","click",4,"matCellDef"],["mat-header-cell","",3,"click"],["mat-cell","","matRipple","","matRippleCentered","true",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&b.Hc(0,pe,9,5,"div",0),2&e&&b.oc("ngIf",t.dataSlice)},directives:[n.m,re.n,re.c,re.i,re.b,n.l,re.k,re.m,re.h,re.a,P.r,re.j,re.l],styles:[".data-sheet-container[_ngcontent-%COMP%] {\n      max-height: 300px;\n      overflow: auto;\n    }\n\n    .mat-table-sticky[_ngcontent-%COMP%]:first-child {\n      border-right: 1px solid #e0e0e0;\n      padding-right: 1em;\n    }\n\n\n    .mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%] {\n      padding-left: 0.5em;\n      padding-right: 0.5em;\n    }\n\n    label[_ngcontent-%COMP%] {\n      color: rgba(0,0,0,0.54);\n    }"]}),ge),Ce=i("qFsG");function we(e,t){if(1&e&&(b.Wb(0,"mat-option",9),b.Jc(1),b.Vb()),2&e){var i=t.$implicit;b.oc("value",i),b.Cb(1),b.Kc(i.label)}}function ye(e,t){if(1&e){var i=b.Xb();b.Wb(0,"p"),b.Wb(1,"mat-form-field"),b.Wb(2,"input",10),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic(3).importDetails.imgInterval=e})),b.Vb(),b.Vb(),b.Vb()}if(2&e){var a=b.ic(3);b.Cb(2),b.oc("ngModel",a.importDetails.imgInterval)}}function ke(e,t){if(1&e&&(b.Wb(0,"div",11),b.Jc(1),b.Vb()),2&e){var i=b.ic(3);b.Cb(1),b.Lc(" The first time point value ",i.firstTimeCell.value," does not look like a number; ")}}function Se(e,t){if(1&e){var i=b.Xb();b.Wb(0,"div"),b.Wb(1,"p"),b.Jc(2),b.Wb(3,"strong"),b.Jc(4),b.Vb(),b.Jc(5,"\xa0 First time point: "),b.Wb(6,"strong"),b.Jc(7),b.Vb(),b.Jc(8),b.Vb(),b.Wb(9,"p"),b.Wb(10,"mat-form-field"),b.Wb(11,"mat-label"),b.Jc(12,"Time unit"),b.Vb(),b.Wb(13,"mat-select",5),b.ec("valueChange",(function(e){return b.Ac(i),b.ic(2).importDetails.timeType=e})),b.Hc(14,we,2,2,"mat-option",6),b.Vb(),b.Vb(),b.Vb(),b.Wb(15,"p"),b.Wb(16,"mat-form-field"),b.Wb(17,"input",7),b.ec("ngModelChange",(function(e){return b.Ac(i),b.ic(2).importDetails.timeOffset=e})),b.Vb(),b.Vb(),b.Vb(),b.Hc(18,ye,3,1,"p",2),b.Hc(19,ke,2,1,"div",8),b.Vb()}if(2&e){var a=b.ic(2);b.Cb(2),b.Lc("Times in ",a.importDetails.inLabel," "),b.Cb(2),b.Lc("",a.importDetails.inRows?a.firstTimeCell.rowName:a.firstTimeCell.colName,";"),b.Cb(3),b.Mc("",a.firstTimeCell.value," ",null==a.importDetails.timeType?null:a.importDetails.timeType.unit,""),b.Cb(1),b.Lc(" [",a.firstTimeCell.colName+":"+a.firstTimeCell.rowName,"] "),b.Cb(5),b.oc("value",a.importDetails.timeType),b.Cb(1),b.oc("ngForOf",a.timeTypeOptions),b.Cb(3),b.oc("ngModel",a.importDetails.timeOffset),b.Cb(1),b.oc("ngIf","IMG_NUMBER"==(null==a.importDetails.timeType?null:a.importDetails.timeType.name)),b.Cb(1),b.oc("ngIf",a.firstTimeNotNumber())}}function De(e,t){if(1&e&&(b.Wb(0,"div",12),b.Jc(1),b.Vb()),2&e){var i=b.ic(2);b.Cb(1),b.Lc(" Even if only the top part of the data table is presented all times from the selected ",i.importDetails.inLabel," will be imported ")}}function Le(e,t){if(1&e){var i=b.Xb();b.Wb(0,"mat-card",1),b.Wb(1,"mat-card-content"),b.Hc(2,Se,20,10,"div",2),b.Wb(3,"div"),b.Wb(4,"div"),b.Jc(5),b.Vb(),b.Vb(),b.Wb(6,"bd2-data-sheet-mdtable",3),b.ec("selected",(function(e){return b.Ac(i),b.ic().selectFirstTime(e)})),b.Vb(),b.Hc(7,De,2,1,"div",4),b.Vb(),b.Vb()}if(2&e){var a=b.ic();b.Cb(2),b.oc("ngIf",a.firstTimeCell),b.Cb(2),b.Eb(a.firstTimeCell?"alert alert-info":"alert alert-danger"),b.Cb(1),b.Lc(" Click on the first timepoint in the time ",a.importDetails.inLabel," and then select a time unit. "),b.Cb(1),b.oc("dataSlice",a.dataSlice)("styler",a.tableSelector.tableStyler),b.Cb(1),b.oc("ngIf",a.hasMoreTimes())}}var Re,Ie,We=((Re=function(e){function t(e,i){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,i))).timeTypeOptions=[f.h.TIME_IN_HOURS,f.h.TIME_IN_MINUTES,f.h.TIME_IN_SECONDS,f.h.IMG_NUMBER],a}return _inherits(t,e),_createClass(t,[{key:"applyDefaultSelections",value:function(){if(_get(_getPrototypeOf(t.prototype),"applyDefaultSelections",this).call(this),this.firstTimeCell&&!this.firstTimeCell.fake)this.selectFirstTime(this.reselect(this.firstTimeCell));else{var e=this.importDetails.inRows?new c.a(1,this.colNumber(1),void 0,0,this.rowNumber(0),void 0,void 0):new c.a(0,this.colNumber(0),void 0,1,this.rowNumber(1),void 0,void 0);(e=this.reselect(e)).fake=!0,this.selectFirstTime(e)}}},{key:"firstTimeNotNumber",value:function(){return!!this.firstTimeCell&&isNaN(Number(this.firstTimeCell.value))}}]),t}(ne)).\u0275fac=function(e){return new(e||Re)(b.Qb(W),b.Qb(V.a))},Re.\u0275cmp=b.Kb({type:Re,selectors:[["bd2-define-time-step"]],inputs:{importDetails:"importDetails"},features:[b.zb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["required","",3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","placeholder","Time offset",3,"ngModel","ngModelChange"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"value"],["matInput","","type","number","placeholder","Images interval (hours)","required","",3,"ngModel","ngModelChange"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(e,t){1&e&&b.Hc(0,Le,8,7,"mat-card",0),2&e&&b.oc("ngIf",t.importDetails)},directives:[n.m,_.a,_.c,ve,T.b,T.f,x.a,n.l,Ce.b,r.u,r.c,r.p,r.s,P.o,r.y],encapsulation:2}),Re),Ve=i("0IaG"),Ne=((Ie=function(){function e(t,i){_classCallCheck(this,e),this.dialogRef=t,this.data=i}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"sendLabel",value:function(){this.dialogRef.close(this.data.label)}}]),e}()).\u0275fac=function(e){return new(e||Ie)(b.Qb(Ve.g),b.Qb(Ve.a))},Ie.\u0275cmp=b.Kb({type:Ie,selectors:[["bd2-edit-label-dialog"]],decls:20,vars:6,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","cdkFocusInitial","",3,"ngModel","ngModelChange","keydown.enter"],["align","start"],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-raised-button","","color","primary",3,"mat-dialog-close"],["ok",""]],template:function(e,t){1&e&&(b.Wb(0,"h1",0),b.Jc(1),b.Vb(),b.Wb(2,"div",1),b.Wb(3,"p"),b.Jc(4),b.Vb(),b.Wb(5,"mat-form-field"),b.Wb(6,"input",2),b.ec("ngModelChange",(function(e){return t.data.label=e}))("keydown.enter",(function(e){return t.sendLabel()})),b.Vb(),b.Wb(7,"mat-hint",3),b.Jc(8,"Pressing "),b.Wb(9,"strong"),b.Jc(10,"Enter"),b.Vb(),b.Jc(11," submits "),b.Vb(),b.Vb(),b.Vb(),b.Wb(12,"div",4),b.Wb(13,"button",5),b.Jc(14,"Cancel"),b.Vb(),b.Wb(15,"button",5),b.Jc(16,"Clear"),b.Vb(),b.Wb(17,"button",6,7),b.Jc(19,"Assign"),b.Vb(),b.Vb()),2&e&&(b.Cb(1),b.Kc(t.data.title),b.Cb(3),b.Lc("Write label for ",t.data.regionName,""),b.Cb(2),b.oc("ngModel",t.data.label),b.Cb(7),b.oc("mat-dialog-close",void 0),b.Cb(2),b.oc("mat-dialog-close",""),b.Cb(2),b.oc("mat-dialog-close",t.data.label))},directives:[Ve.h,Ve.e,T.b,Ce.b,r.c,r.p,r.s,T.e,Ve.c,te.a,Ve.d],encapsulation:2}),Ie),_e=["table"];function Te(e,t){1&e&&b.Rb(0,"th",20)}function xe(e,t){if(1&e){var i=b.Xb();b.Wb(0,"td",21),b.ec("mousedown",(function(e){b.Ac(i);var a=t.index;return b.ic(2).startSelectCell(-1,a)}))("mouseup",(function(e){b.Ac(i);var a=t.index;return b.ic(2).endSelectCell(-1,a)})),b.Wb(1,"label"),b.Jc(2),b.Vb(),b.Vb()}if(2&e){var a=t.index,o=b.ic(2);b.Cb(2),b.Kc(o.rowsNames[a])}}function Oe(e,t){if(1&e){var i=b.Xb();b.Wb(0,"td",22),b.ec("click",(function(e){return b.Ac(i),b.ic(2).nextRow()})),b.Jc(1),b.Vb()}if(2&e){var a=b.ic(2);b.Cb(1),b.Kc(a.hasMoreRows?"...":"end")}}function Pe(e,t){1&e&&(b.Wb(0,"th",20),b.Jc(1,"Labels"),b.Vb())}function Be(e,t){if(1&e){var i=b.Xb();b.Wb(0,"td",21),b.ec("mousedown",(function(e){b.Ac(i);var a=t.index;return b.ic(2).startSelectCell(-1,a)}))("mouseup",(function(e){b.Ac(i);var a=t.index;return b.ic(2).endSelectCell(-1,a)})),b.Wb(1,"label",23),b.Jc(2),b.Vb(),b.Vb()}if(2&e){var a=t.index,o=b.ic(2);b.Cb(2),b.Kc(o.rowsLabels[a])}}function He(e,t){if(1&e){var i=b.Xb();b.Wb(0,"td",22),b.ec("click",(function(e){return b.Ac(i),b.ic(2).nextRow()})),b.Vb()}}function Fe(e,t){if(1&e){var i=b.Xb();b.Wb(0,"th",27),b.ec("mousedown",(function(e){b.Ac(i);var t=b.ic().index;return b.ic(2).startSelectCell(t,-1)}))("mouseup",(function(e){b.Ac(i);var t=b.ic().index;return b.ic(2).endSelectCell(t,-1)})),b.Jc(1),b.Vb()}if(2&e){var a=b.ic(),o=a.index,l=a.$implicit,n=b.ic(2);b.Gc("background-color",n.colBackground(o)),b.Cb(1),b.Lc(" ",l," ")}}function Je(e,t){if(1&e&&(b.Wb(0,"td",28),b.Jc(1),b.Vb()),2&e){var i=t.$implicit,a=t.index,o=b.ic().index,l=b.ic(2);b.Gc("background-color",l.cellBackground(o,a)),b.Cb(1),b.Lc(" ",i[o]," ")}}function Ae(e,t){if(1&e){var i=b.Xb();b.Wb(0,"td",22),b.ec("click",(function(e){return b.Ac(i),b.ic(3).nextRow()})),b.Jc(1),b.Vb()}if(2&e){var a=b.ic(3);b.Cb(1),b.Kc(a.hasMoreRows?"...":"")}}function Me(e,t){1&e&&(b.Ub(0,24),b.Hc(1,Fe,2,3,"th",25),b.Hc(2,Je,2,3,"td",26),b.Hc(3,Ae,2,1,"td",7),b.Tb()),2&e&&b.oc("matColumnDef",t.$implicit)}function Ee(e,t){if(1&e){var i=b.Xb();b.Wb(0,"th",29),b.ec("click",(function(e){return b.Ac(i),b.ic(2).nextColumn()})),b.Jc(1,"..."),b.Vb()}}function Ue(e,t){if(1&e){var i=b.Xb();b.Wb(0,"td",30),b.ec("click",(function(e){return b.Ac(i),b.ic(2).nextColumn()})),b.Jc(1,"..."),b.Vb()}}function ze(e,t){1&e&&b.Rb(0,"td",31)}function Ke(e,t){1&e&&(b.Wb(0,"th",20),b.Jc(1,"Labels"),b.Vb())}function Ge(e,t){1&e&&b.Rb(0,"th",20)}function je(e,t){if(1&e){var i=b.Xb();b.Wb(0,"th",27),b.ec("mousedown",(function(e){b.Ac(i);var t=b.ic().index;return b.ic(3).startSelectCell(t,-1)}))("mouseup",(function(e){b.Ac(i);var t=b.ic().index;return b.ic(3).endSelectCell(t,-1)})),b.Wb(1,"label",23),b.Jc(2),b.Vb(),b.Vb()}if(2&e){var a=b.ic().index,o=b.ic(3);b.Gc("background-color",o.colBackground(a)),b.Cb(2),b.Kc(o.columnsLabels[a])}}function Xe(e,t){1&e&&(b.Ub(0,24),b.Hc(1,je,3,3,"th",25),b.Tb()),2&e&&b.oc("matColumnDef","label"+t.index)}function $e(e,t){if(1&e&&(b.Ub(0),b.Hc(1,Xe,2,1,"ng-container",9),b.Tb()),2&e){var i=b.ic(2);b.Cb(1),b.oc("ngForOf",i.columnsNames)}}function Qe(e,t){1&e&&b.Rb(0,"tr",32)}function qe(e,t){1&e&&b.Rb(0,"tr",32)}function Ye(e,t){if(1&e&&(b.Ub(0),b.Hc(1,qe,1,0,"tr",17),b.Tb()),2&e){var i=b.ic(2);b.Cb(1),b.oc("matHeaderRowDef",i.displayedLabelsColumns)("matHeaderRowDefSticky",!0)}}function Ze(e,t){if(1&e&&b.Rb(0,"tr",33),2&e){var i=t.index,a=b.ic(2);b.Gc("background-color",a.rowBackground(i))}}function et(e,t){1&e&&b.Rb(0,"tr",34)}function tt(e,t){if(1&e&&(b.Wb(0,"div",1),b.Wb(1,"table",2,3),b.Ub(3,4),b.Hc(4,Te,1,0,"th",5),b.Hc(5,xe,3,1,"td",6),b.Hc(6,Oe,2,1,"td",7),b.Tb(),b.Ub(7,8),b.Hc(8,Pe,2,0,"th",5),b.Hc(9,Be,3,1,"td",6),b.Hc(10,He,1,0,"td",7),b.Tb(),b.Hc(11,Me,4,1,"ng-container",9),b.Ub(12,10),b.Hc(13,Ee,2,0,"th",11),b.Hc(14,Ue,2,0,"td",12),b.Hc(15,ze,1,0,"td",13),b.Tb(),b.Ub(16,14),b.Hc(17,Ke,2,0,"th",5),b.Tb(),b.Ub(18,15),b.Hc(19,Ge,1,0,"th",5),b.Tb(),b.Hc(20,$e,2,1,"ng-container",16),b.Hc(21,Qe,1,0,"tr",17),b.Hc(22,Ye,2,2,"ng-container",16),b.Hc(23,Ze,1,2,"tr",18),b.Hc(24,et,1,0,"tr",19),b.Vb(),b.Vb()),2&e){var i=b.ic();b.Cb(1),b.oc("dataSource",i.data),b.Cb(10),b.oc("ngForOf",i.columnsNames),b.Cb(9),b.oc("ngIf",i.showColumnsLabels),b.Cb(1),b.oc("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),b.Cb(1),b.oc("ngIf",i.showColumnsLabels),b.Cb(1),b.oc("matRowDefColumns",i.displayedColumns),b.Cb(1),b.oc("matFooterRowDef",i.displayedColumns)}}var it,at=((it=function(){function e(){_classCallCheck(this,e),this.columnsNames=[],this.rowsNames=[],this.data=[],this.hasMoreColumns=!1,this.hasMoreRows=!1,this._columnsLabels=[],this._rowsLabels=[],this.styler=new ie,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.showColumnsLabels=!1,this.showRowsLabels=!1,this.selected=new b.o,this.moreRows=new b.o,this.moreColumns=new b.o}return _createClass(e,[{key:"decideColumns",value:function(){this.displayedColumns=(this.showRowsLabels?["rowNr","rowLabel"]:["rowNr"]).concat(this.columnsNames),this.displayedLabelsColumns=(this.showRowsLabels?["rowNr2","rowLabel2"]:["rowNr2"]).concat(this.columnsNames.map((function(e,t){return"label"+t}))),this.hasMoreColumns&&(this.displayedColumns.push("more"),this.displayedLabelsColumns.push("more"))}},{key:"ngOnInit",value:function(){}},{key:"colNumber",value:function(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}},{key:"rowNumber",value:function(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}},{key:"colBackground",value:function(e){return this.styler.colBackground(this.colNumber(e))}},{key:"rowBackground",value:function(e){return this.styler.rowBackground(this.rowNumber(e))}},{key:"cellBackground",value:function(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}},{key:"startSelectCell",value:function(e,t){if((!(e<0)||this.selectableRowHeader)&&(!(t<0)||this.selectableColHeader)){var i=new c.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selectionStart=i}}},{key:"endSelectCell",value:function(e,t){if(this.selectionStart)if(t<0&&this.selectionStart.rowIx>=0)this.selectionStart=void 0;else if(e<0&&this.selectionStart.colIx>=0)this.selectionStart=void 0;else if((!(e<0)||this.selectableRowHeader)&&(!(t<0)||this.selectableColHeader)){var i=new c.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selected.next([this.selectionStart,i])}}},{key:"nextColumn",value:function(){this.moreColumns.next(!0)}},{key:"nextRow",value:function(){this.moreRows.next(!0)}},{key:"columnsLabels",set:function(e){this._columnsLabels=e},get:function(){return this._columnsLabels}},{key:"rowsLabels",set:function(e){this._rowsLabels=e},get:function(){return this._rowsLabels}},{key:"dataSlice",set:function(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.data=e.data,this.hasMoreColumns=e.columnsNumbers[e.columnsNumbers.length-1]<e.totalColumns-1,this.hasMoreRows=e.rowsNumbers[e.rowsNumbers.length-1]<e.totalRows-1,this.decideColumns(),this.matTable&&this.matTable.renderRows())},get:function(){return this._dataSlice}},{key:"selectRows",set:function(e){this.selectableRowHeader=e,this.showRowsLabels=e,this.decideColumns()}},{key:"selectCols",set:function(e){this.selectableColHeader=e,this.showColumnsLabels=e,this.decideColumns()}}]),e}()).\u0275fac=function(e){return new(e||it)},it.\u0275cmp=b.Kb({type:it,selectors:[["bd2-selectable-region-mdtable"]],viewQuery:function(e,t){var i;1&e&&b.Pc(_e,!0),2&e&&b.wc(i=b.fc())&&(t.matTable=i.first)},inputs:{columnsLabels:"columnsLabels",rowsLabels:"rowsLabels",dataSlice:"dataSlice",selectRows:"selectRows",selectCols:"selectCols",styler:"styler"},outputs:{selected:"selected",moreRows:"moreRows",moreColumns:"moreColumns"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"mousedown","mouseup",4,"matCellDef"],["mat-footer-cell","",3,"click",4,"matFooterCellDef"],["matColumnDef","rowLabel","sticky",""],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","more","sticky",""],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","rowNr2","sticky",""],["matColumnDef","rowLabel2","sticky",""],[4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell","","matRipple","",3,"mousedown","mouseup"],["mat-footer-cell","",3,"click"],[1,"user"],[3,"matColumnDef"],["mat-header-cell","","matRipple","",3,"background-color","mousedown","mouseup",4,"matHeaderCellDef"],["mat-cell","",3,"background-color",4,"matCellDef"],["mat-header-cell","","matRipple","",3,"mousedown","mouseup"],["mat-cell",""],["mat-header-cell","",3,"click"],["mat-cell","",3,"click"],["mat-footer-cell",""],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(e,t){1&e&&b.Hc(0,tt,25,8,"div",0),2&e&&b.oc("ngIf",t.dataSlice)},directives:[n.m,re.n,re.c,re.i,re.b,re.e,n.l,re.k,re.m,re.g,re.h,re.a,P.r,re.d,re.j,re.l,re.f],styles:[".data-sheet-container[_ngcontent-%COMP%] {\n      max-height: 800px;\n      overflow: auto;\n    }\n\n    .mat-table-sticky[_ngcontent-%COMP%]:first-child {\n      border-right: 1px solid #e0e0e0;\n      padding-right: 1em;\n    }\n\n\n    .mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%] {\n      padding-left: 0.5em;\n      padding-right: 0.5em;\n    }\n\n    label[_ngcontent-%COMP%] {\n      color: rgba(0,0,0,0.54);\n    }\n\n    label.user[_ngcontent-%COMP%] {\n      color: black;\n    }"]}),it),ot=["colPaginator"],lt=["rowPaginator"];function nt(e,t){if(1&e&&(b.Wb(0,"div",9),b.Jc(1),b.Vb()),2&e){var i=b.ic();b.Cb(1),b.Lc(" You have not seen yet all the available ",null==i.importDetails?null:i.importDetails.inLabel,"s for labelling\n")}}var rt,st=function(){return[10,25,50,100]},ct=((rt=function(e){function t(e,i,a){var o;return _classCallCheck(this,t),(o=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,i,a))).dialog=e,o.columnsLabels=[],o.rowsLabels=[],o.colorer=new le,o}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){_get(_getPrototypeOf(t.prototype),"ngOnInit",this).call(this)}},{key:"ngOnDestroy",value:function(){_get(_getPrototypeOf(t.prototype),"ngOnDestroy",this).call(this),this.dataService&&this.dataService.close()}},{key:"ngAfterViewInit",value:function(){this.colPaginator._intl=new D.b,this.colPaginator._intl.itemsPerPageLabel="Columns per page",this.rowPaginator._intl=new D.b,this.rowPaginator._intl.itemsPerPageLabel="Rows per page"}},{key:"markSelections",value:function(){_get(_getPrototypeOf(t.prototype),"markSelections",this).call(this),this.markFirstTime(),this.loadLabels(),this.markLabels(),this.labelsSummary=this.importDetails.summarizeLabels(25),this.labelTime()}},{key:"labelTime",value:function(){if(this.firstTimeCell)if(this.importDetails.inRows){var e=this.dataSlice.rowsNumbers.indexOf(this.firstTimeCell.rowNumber);e>=0&&(this.rowsLabels[e]="Time")}else{var t=this.dataSlice.columnsNumbers.indexOf(this.firstTimeCell.colNumber);t>=0&&(this.columnsLabels[t]="Time")}}},{key:"loadLabels",value:function(){var e=this.dataSlice;this.importDetails.inRows?(this.rowsLabels=this.userLabels.slice(e.rowsNumbers[0],e.rowsNumbers[e.rowsNumbers.length-1]),this.columnsLabels=[]):(this.rowsLabels=[],this.columnsLabels=this.userLabels.slice(e.columnsNumbers[0],e.columnsNumbers[e.columnsNumbers.length-1]))}},{key:"markLabels",value:function(){var e=this;this.userLabels.forEach((function(t,i){e.importDetails.inRows?e.tableSelector.selectRow(i,e.colorer.toColor(t)):e.tableSelector.selectCol(i,e.colorer.toColor(t))}))}},{key:"hasSeenAll",value:function(){return!!this.dataSlice&&(this.importDetails.inRows?this.lastRowSeen>=this.dataSlice.totalRows-1:this.lastColumnSeen>=this.dataSlice.totalColumns-1)}},{key:"selected",value:function(e){e[1].isBeforeOrSame(e[0])&&(e=[e[1],e[0]]),this.importDetails.inRows?this.labelRows(e[0],e[1]):this.labelColumns(e[0],e[1])}},{key:"setUserLabel",value:function(e,t){this.userLabels[e]=t||void 0,this.labelsSummary=this.importDetails.summarizeLabels(25)}},{key:"askForLabel",value:function(e,t,i){var a;return a=i?{title:"Label rows",regionName:e.hasSameIx(t)?"row "+e.rowName:"rows "+e.rowName+"-"+t.rowName,label:this.userLabels[e.rowNumber]}:{title:"Label columns",regionName:e.hasSameIx(t)?"column "+e.colName:"columns "+e.colName+"-"+t.colName,label:this.userLabels[e.rowNumber]},this.dialog.open(Ne,{data:a}).afterClosed()}},{key:"labelRows",value:function(e,t){var i=this;e.rowIx<0||t.rowIx<0?console.warn("Label rows with col selection",e):this.firstTimeCell&&this.firstTimeCell.rowNumber>=e.rowNumber||this.askForLabel(e,t,!0).subscribe((function(a){void 0!==a&&(i.setRowsLabel(e,t,a),a&&i.selectNextRegion(e,t))}))}},{key:"setRowsLabel",value:function(e,t,i){i=i.trim();for(var a=this.colorer.toColor(i),o=e.rowIx;o<=t.rowIx;o++){var l=this.dataSlice.rowsNumbers[o];void 0===l?console.error("No row number for index "+o):(this.rowsLabels[o]=i,this.setUserLabel(l,i),i?this.tableSelector.selectRow(l,a):this.tableSelector.deselectRow(l))}}},{key:"labelColumns",value:function(e,t){var i=this;e.colIx<0||t.colIx<0?console.warn("Label cols with row selection",e):this.firstTimeCell&&this.firstTimeCell.colNumber>=e.colNumber?console.log("Ignroing labelling as Time col after selection"):this.askForLabel(e,t,!1).subscribe((function(a){void 0!==a&&(i.setColumnsLabel(e,t,a),a&&i.selectNextRegion(e,t))}))}},{key:"setColumnsLabel",value:function(e,t,i){i=i.trim();for(var a=this.colorer.toColor(i),o=e.colIx;o<=t.colIx;o++){var l=this.dataSlice.columnsNumbers[o];void 0===l?console.error("No col number for index "+o):(this.columnsLabels[o]=i,this.setUserLabel(l,i),i?this.tableSelector.selectCol(l,a):this.tableSelector.deselectCol(l))}}},{key:"selectNextRegion",value:function(e,t){var i=[t.colIx-e.colIx,t.rowIx-e.rowIx],a=this.moveCell(t,[1,1]),o=this.moveCell(a,i);this.isInPage(a)&&(this.isInPage(o)||(o=this.fitToPage(o)),a=this.reselect(a),o=this.reselect(o),this.selected([a,o]))}},{key:"isInPage",value:function(e){return!(e.colIx>=0&&e.colIx>=this.dataSlice.columnsNumbers.length||e.rowIx>=0&&e.rowIx>=this.dataSlice.rowsNumbers.length)}},{key:"fitToPage",value:function(e){return new c.a(e.colIx>=0?this.dataSlice.columnsNumbers.length-1:-1,void 0,void 0,e.rowIx>=0?this.dataSlice.rowsNumbers.length-1:-1,void 0,void 0,void 0)}},{key:"moveCell",value:function(e,t){return new c.a(e.colIx>=0?e.colIx+t[0]:-1,void 0,void 0,e.rowIx>=0?e.rowIx+t[1]:-1,void 0,void 0,void 0)}},{key:"loadColPage",value:function(e){this.dataService.slice(new L(this.currentPageSlice.rowPage,e))}},{key:"loadRowPage",value:function(e){this.dataService.slice(new L(e,this.currentPageSlice.colPage))}},{key:"moreColumns",value:function(){this.importDetails.inRows||this.colPaginator.nextPage()}},{key:"moreRows",value:function(){this.importDetails.inRows&&this.rowPaginator.nextPage()}},{key:"userLabels",get:function(){return this.importDetails?this.importDetails.userLabels:void 0}}]),t}(ne)).\u0275fac=function(e){return new(e||rt)(b.Qb(Ve.b),b.Qb(W),b.Qb(V.a))},rt.\u0275cmp=b.Kb({type:rt,selectors:[["bd2-assign-labels-step"]],viewQuery:function(e,t){var i;1&e&&(b.Fc(ot,!0),b.Fc(lt,!0)),2&e&&(b.wc(i=b.fc())&&(t.colPaginator=i.first),b.wc(i=b.fc())&&(t.rowPaginator=i.first))},inputs:{importDetails:"importDetails"},features:[b.Bb([W]),b.zb],decls:14,vars:23,consts:[["role","alert","type","info",1,"alert","alert-info",3,"hidden"],[3,"hidden"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["colPaginator",""],[3,"dataSlice","columnsLabels","rowsLabels","styler","selectRows","selectCols","selected","moreColumns","moreRows"],[3,"length","disabled","pageSize","pageSizeOptions","page"],["rowPaginator",""],["type","danger","class","alert alert-danger mt-2","role","alert",4,"ngIf"],[2,"margin-top","1em"],["type","danger","role","alert",1,"alert","alert-danger","mt-2"]],template:function(e,t){1&e&&(b.Wb(0,"div",0),b.Jc(1),b.Vb(),b.Wb(2,"div",1),b.Wb(3,"mat-paginator",2,3),b.ec("page",(function(e){return t.loadColPage(e)})),b.Vb(),b.Vb(),b.Wb(5,"bd2-selectable-region-mdtable",4),b.ec("selected",(function(e){return t.selected(e)}))("moreColumns",(function(e){return t.moreColumns()}))("moreRows",(function(e){return t.moreRows()})),b.Vb(),b.Wb(6,"div",1),b.Wb(7,"mat-paginator",5,6),b.ec("page",(function(e){return t.loadRowPage(e)})),b.Vb(),b.Vb(),b.Hc(9,nt,2,1,"div",7),b.Wb(10,"div",8),b.Wb(11,"label"),b.Jc(12,"Selected labels: "),b.Vb(),b.Jc(13),b.Vb()),2&e&&(b.oc("hidden",(null==t.importDetails?null:null==t.importDetails.userLabels?null:t.importDetails.userLabels.length)>1),b.Cb(1),b.Lc(" Click and drag over ",null==t.importDetails?null:t.importDetails.inLabel," headers to label the data.\n"),b.Cb(1),b.oc("hidden",null==t.importDetails?null:t.importDetails.inRows),b.Cb(1),b.oc("length",null==t.dataSlice?null:t.dataSlice.totalColumns)("disabled",null==t.importDetails?null:t.importDetails.inRows)("pageSize",t.currentPageSlice.colPage.pageSize)("pageIndex",t.currentPageSlice.colPage.pageIndex)("pageSizeOptions",b.qc(21,st)),b.Cb(2),b.oc("dataSlice",t.dataSlice)("columnsLabels",t.columnsLabels)("rowsLabels",t.rowsLabels)("styler",t.tableSelector.tableStyler)("selectRows",null==t.importDetails?null:t.importDetails.inRows)("selectCols",!(null!=t.importDetails&&t.importDetails.inRows)),b.Cb(1),b.oc("hidden",!(null!=t.importDetails&&t.importDetails.inRows)),b.Cb(1),b.oc("length",null==t.dataSlice?null:t.dataSlice.totalRows)("disabled",!(null!=t.importDetails&&t.importDetails.inRows))("pageSize",t.firstPageSlice.rowPage.pageSize)("pageSizeOptions",b.qc(22,st)),b.Cb(2),b.oc("ngIf",!t.hasSeenAll()),b.Cb(4),b.Lc("",t.labelsSummary,"\n"))},directives:[D.a,at,n.m],encapsulation:2}),rt);function ut(e,t){if(1&e&&(b.Wb(0,"div",7),b.Jc(1),b.Vb()),2&e){var i=b.ic(3);b.Cb(1),b.Lc(" Labels ",i.importDetails.inLabelNeg," must be before first time point. ")}}function bt(e,t){if(1&e&&(b.Wb(0,"div"),b.Wb(1,"p"),b.Jc(2),b.Wb(3,"strong"),b.Jc(4),b.Vb(),b.Vb(),b.Hc(5,ut,2,1,"div",6),b.Vb()),2&e){var i=b.ic(2);b.Cb(2),b.Lc("Labels in ",i.importDetails.inLabelNeg," "),b.Cb(2),b.Lc("",i.importDetails.inRows?i.labelsSelection.colName:i.labelsSelection.rowName,";"),b.Cb(1),b.oc("ngIf",!i.importDetails.areLabelsAfterTime())}}function mt(e,t){if(1&e&&(b.Wb(0,"div",8),b.Jc(1),b.Vb()),2&e){var i=b.ic(2);b.Cb(1),b.Lc(" Even if only the top part of the data table is presented all labels from the selected ",i.importDetails.inLabelNeg," will be imported ")}}function dt(e,t){if(1&e){var i=b.Xb();b.Wb(0,"mat-card",1),b.Wb(1,"mat-card-content"),b.Hc(2,bt,6,3,"div",2),b.Wb(3,"div"),b.Wb(4,"div",3),b.Jc(5),b.Vb(),b.Vb(),b.Wb(6,"bd2-data-sheet-mdtable",4),b.ec("selected",(function(e){return b.Ac(i),b.ic().selectLabels(e)})),b.Vb(),b.Wb(7,"div"),b.Jc(8," \xa0 "),b.Hc(9,mt,2,1,"div",5),b.Vb(),b.Vb(),b.Vb()}if(2&e){var a=b.ic();b.Cb(2),b.oc("ngIf",a.labelsSelection),b.Cb(2),b.Eb(a.labelsSelection?"alert alert-info":"alert alert-danger"),b.Cb(1),b.Lc(" Click on the ",a.importDetails.inLabelNeg," containing labels. "),b.Cb(1),b.oc("dataSlice",a.dataSlice)("selectableColHeader",a.importDetails.inRows)("selectableRowHeader",!a.importDetails.inRows)("styler",a.tableSelector.tableStyler),b.Cb(3),b.oc("ngIf",a.hasMoreLabels())}}var ft,ht=((ft=function(e){function t(e,i){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,i))}return _inherits(t,e),_createClass(t,[{key:"applyDefaultSelections",value:function(){if(_get(_getPrototypeOf(t.prototype),"applyDefaultSelections",this).call(this),this.labelsSelection&&!this.labelsSelection.fake)this.selectLabels(this.reselect(this.labelsSelection));else if(this.firstTimeCell){var e=this.reselect(new c.a(this.firstTimeCell.colIx-1,this.colNumber(this.firstTimeCell.colIx-1),void 0,this.firstTimeCell.rowIx-1,this.rowNumber(this.firstTimeCell.rowIx-1),void 0,void 0));e.fake=!0,this.selectLabels(e)}}},{key:"markSelections",value:function(){_get(_getPrototypeOf(t.prototype),"markSelections",this).call(this),this.markFirstTime()}}]),t}(ne)).\u0275fac=function(e){return new(e||ft)(b.Qb(W),b.Qb(V.a))},ft.\u0275cmp=b.Kb({type:ft,selectors:[["bd2-import-labels-step"]],inputs:{importDetails:"importDetails"},features:[b.zb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],["role","alert"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(e,t){1&e&&b.Hc(0,dt,10,9,"mat-card",0),2&e&&b.oc("ngIf",t.importDetails)},directives:[n.m,_.a,_.c,ve],encapsulation:2}),ft);function pt(e,t){if(1&e&&(b.Wb(0,"div",5),b.Jc(1),b.Vb()),2&e){var i=b.ic(3);b.Cb(1),b.Mc(" Data start ",i.importDetails.inLabel," must be after time ",i.importDetails.inLabel,". ")}}function gt(e,t){if(1&e&&(b.Wb(0,"div"),b.Wb(1,"p"),b.Jc(2),b.Wb(3,"strong"),b.Jc(4),b.Vb(),b.Vb(),b.Hc(5,pt,2,2,"div",4),b.Vb()),2&e){var i=b.ic(2);b.Cb(2),b.Lc("Data starts in ",i.importDetails.inLabel," "),b.Cb(2),b.Lc("",i.importDetails.inRows?i.dataStart.rowName:i.dataStart.colName,";"),b.Cb(1),b.oc("ngIf",!i.importDetails.isDataAfterTime())}}function vt(e,t){if(1&e){var i=b.Xb();b.Wb(0,"mat-card",1),b.Wb(1,"mat-card-content"),b.Hc(2,gt,6,3,"div",2),b.Wb(3,"div"),b.Wb(4,"div"),b.Jc(5),b.Vb(),b.Vb(),b.Wb(6,"bd2-data-sheet-mdtable",3),b.ec("selected",(function(e){return b.Ac(i),b.ic().selectDataStart(e)})),b.Vb(),b.Vb(),b.Vb()}if(2&e){var a=b.ic();b.Cb(2),b.oc("ngIf",a.dataStart),b.Cb(2),b.Eb(a.dataStart?"alert alert-info":"alert alert-danger"),b.Cb(1),b.Lc(" Click on the first data ",a.importDetails.inLabel,". "),b.Cb(1),b.oc("dataSlice",a.dataSlice)("selectableColHeader",!a.importDetails.inRows)("selectableRowHeader",a.importDetails.inRows)("styler",a.tableSelector.tableStyler)}}var Ct,wt=((Ct=function(e){function t(e,i){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,i))}return _inherits(t,e),_createClass(t,[{key:"applyDefaultSelections",value:function(){if(_get(_getPrototypeOf(t.prototype),"applyDefaultSelections",this).call(this),this.dataStart&&!this.dataStart.fake)this.selectDataStart(this.reselect(this.dataStart));else if(this.firstTimeCell){var e=this.reselect(new c.a(this.firstTimeCell.colIx+1,this.colNumber(this.firstTimeCell.colIx+1),void 0,this.firstTimeCell.rowIx+1,this.rowNumber(this.firstTimeCell.rowIx+1),void 0,void 0));e.fake=!0,this.selectDataStart(e)}}},{key:"markSelections",value:function(){_get(_getPrototypeOf(t.prototype),"markSelections",this).call(this),this.markFirstTime(),this.markLabels()}}]),t}(ne)).\u0275fac=function(e){return new(e||Ct)(b.Qb(W),b.Qb(V.a))},Ct.\u0275cmp=b.Kb({type:Ct,selectors:[["bd2-select-data-start-step"]],inputs:{importDetails:"importDetails"},features:[b.zb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(e,t){1&e&&b.Hc(0,vt,7,8,"mat-card",0),2&e&&b.oc("ngIf",t.importDetails)},directives:[n.m,_.a,_.c,ve],encapsulation:2}),Ct),yt=i("FtGj"),kt=i("JX91"),St=i("A5z7"),Dt=i("/1cH"),Lt=i("NFeN"),Rt=["backgroundInput"],It=["auto"];function Wt(e,t){1&e&&(b.Wb(0,"mat-icon",14),b.Jc(1,"cancel"),b.Vb())}function Vt(e,t){if(1&e){var i=b.Xb();b.Wb(0,"mat-chip",12),b.ec("removed",(function(e){b.Ac(i);var a=t.$implicit;return b.ic(2).remove(a)})),b.Jc(1),b.Hc(2,Wt,2,0,"mat-icon",13),b.Vb()}if(2&e){var a=t.$implicit,o=b.ic(2);b.oc("selectable",o.selectable)("removable",o.removable),b.Cb(1),b.Lc(" ",a," "),b.Cb(1),b.oc("ngIf",o.removable)}}function Nt(e,t){if(1&e&&(b.Wb(0,"mat-option",15),b.Jc(1),b.Vb()),2&e){var i=t.$implicit;b.oc("value",i),b.Cb(1),b.Lc(" ",i," ")}}function _t(e,t){if(1&e){var i=b.Xb();b.Wb(0,"div"),b.Wb(1,"mat-card",1),b.Wb(2,"mat-card-content"),b.Wb(3,"div",2),b.Jc(4," Select labels for which data should be treated as the background noise "),b.Vb(),b.Wb(5,"mat-form-field",3),b.Wb(6,"mat-chip-list",4,5),b.Hc(8,Vt,3,4,"mat-chip",6),b.Wb(9,"input",7,8),b.ec("matChipInputTokenEnd",(function(e){return b.Ac(i),b.ic().add(e)})),b.Vb(),b.Vb(),b.Wb(11,"mat-autocomplete",9,10),b.ec("optionSelected",(function(e){return b.Ac(i),b.ic().selected(e)})),b.Hc(13,Nt,2,2,"mat-option",11),b.jc(14,"async"),b.Vb(),b.Vb(),b.Vb(),b.Vb(),b.Vb()}if(2&e){var a=b.xc(7),o=b.xc(12),l=b.ic();b.Cb(8),b.oc("ngForOf",l.backgrounds),b.Cb(1),b.oc("formControl",l.backgroundCtrl)("matAutocomplete",o)("matChipInputFor",a)("matChipInputSeparatorKeyCodes",l.separatorKeysCodes)("matChipInputAddOnBlur",l.addOnBlur),b.Cb(4),b.oc("ngForOf",b.kc(14,7,l.filteredLabels))}}var Tt,xt=((Tt=function(){function e(t){_classCallCheck(this,e),this.tsFileService=t,this.selectable=!0,this.removable=!0,this.addOnBlur=!1,this.separatorKeysCodes=[yt.g,yt.c],this.backgroundCtrl=new r.e,this.allLabels=[]}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.filteredLabels=this.backgroundCtrl.valueChanges.pipe(Object(kt.a)(null),Object(S.a)((function(t){return t?e.filter(t):e.allLabels})))}},{key:"loadLabels",value:function(){var e=this;this.importDetails&&this.importDetails.fileId?this.importDetails.importLabels?this.importDetails.labelsSelection&&this.tsFileService.previewLabels(this.importDetails.fileId,this.importDetails.importFormat.name,this.importDetails.labelsSelection,this.importDetails.inRows).subscribe((function(t){e.updateAllLabels(e.unique(t))})):this.updateAllLabels(this.unique(this.importDetails.userLabels)):this.updateAllLabels([])}},{key:"updateAllLabels",value:function(e){var t=this;this.allLabels=e.slice().sort();var i=this.backgrounds||[];this.backgrounds=[],i.forEach((function(e){return t.addBackground(e)})),this.backgroundCtrl.setValue(" "),this.backgroundCtrl.setValue(null)}},{key:"unique",value:function(e){return e=e.filter((function(e){return!!e})).map((function(e){return e.trim()})),_toConsumableArray(new Set(e))}},{key:"addBackground",value:function(e){if((e||"").trim()){var t=this.backgrounds.indexOf(e),i=this.allLabels.indexOf(e);t<0&&i>=0&&this.backgrounds.push(e.trim())}}},{key:"add",value:function(e){if(!this.matAutocomplete.isOpen){var t=e.input;this.addBackground(e.value),t&&(t.value=""),this.backgroundCtrl.setValue(null)}}},{key:"remove",value:function(e){var t=this.backgrounds.indexOf(e);t>=0&&this.backgrounds.splice(t,1)}},{key:"selected",value:function(e){this.addBackground(e.option.viewValue),this.backgroundInput.nativeElement.value="",this.backgroundCtrl.setValue(null)}},{key:"filter",value:function(e){var t=e.toLowerCase();return this.allLabels.filter((function(e){return e.toLowerCase().includes(t)})).slice(0,7)}},{key:"backgrounds",get:function(){return this.importDetails?this.importDetails.backgroundsLabels:[]},set:function(e){this.importDetails.backgroundsLabels=e}}]),e}()).\u0275fac=function(e){return new(e||Tt)(b.Qb(I))},Tt.\u0275cmp=b.Kb({type:Tt,selectors:[["bd2-select-backgrounds-labels-step"]],viewQuery:function(e,t){var i;1&e&&(b.Pc(Rt,!0),b.Pc(It,!0)),2&e&&(b.wc(i=b.fc())&&(t.backgroundInput=i.first),b.wc(i=b.fc())&&(t.matAutocomplete=i.first))},inputs:{importDetails:"importDetails"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"mat-elevation-z4"],["type","info","role","alert",1,"alert","alert-info"],[2,"width","100%"],["aria-label","Backgrounds selection"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder","Type to select background label...",3,"formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["backgroundInput",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"selectable","removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"]],template:function(e,t){1&e&&b.Hc(0,_t,15,9,"div",0),2&e&&b.oc("ngIf",null==t.importDetails?null:t.importDetails.containsBackgrounds)},directives:[n.m,_.a,_.c,T.b,St.c,n.l,r.c,Dt.c,St.b,r.p,r.f,Dt.a,St.a,Lt.a,St.d,P.o],pipes:[n.b],encapsulation:2}),Tt),Ot=["stepper"],Pt=["importLabelsStep"],Bt=["assignLabelsStep"],Ht=["selectBackgroundsStep"];function Ft(e,t){1&e&&b.Jc(0,"Upload data file")}function Jt(e,t){1&e&&b.Jc(0,"Data layout")}function At(e,t){if(1&e&&b.Jc(0),2&e){var i=b.ic();b.Lc("Define time ",i.importDetails.inLabel,"")}}function Mt(e,t){1&e&&b.Jc(0,"Label data")}function Et(e,t){if(1&e){var i=b.Xb();b.Ub(0),b.Wb(1,"mat-step",12),b.Hc(2,Mt,1,0,"ng-template",2),b.Rb(3,"mat-divider"),b.Rb(4,"bd2-import-details-summary",19),b.Rb(5,"bd2-assign-labels-step",4,20),b.Wb(7,"div"),b.Wb(8,"button",10),b.Jc(9,"Back"),b.Vb(),b.Wb(10,"button",14),b.ec("click",(function(e){return b.Ac(i),b.ic().startChoosingBackgrounds()})),b.Jc(11,"Next"),b.Vb(),b.Vb(),b.Vb(),b.Tb()}if(2&e){var a=b.ic();b.Cb(1),b.oc("completed",a.importDetails.areLabelsCorrectlyAssigned()),b.Cb(3),b.oc("importDetails",a.importDetails)("showTime",!0),b.Cb(1),b.oc("importDetails",a.importDetails),b.Cb(5),b.oc("disabled",!a.importDetails.areLabelsCorrectlyAssigned())}}function Ut(e,t){if(1&e&&b.Jc(0),2&e){var i=b.ic(2);b.Lc("Select labels ",i.importDetails.inLabelNeg,"")}}function zt(e,t){1&e&&b.Jc(0,"Select data start")}function Kt(e,t){if(1&e){var i=b.Xb();b.Ub(0),b.Wb(1,"mat-step",12),b.Hc(2,Ut,1,1,"ng-template",2),b.Rb(3,"mat-divider"),b.Rb(4,"bd2-import-details-summary",19),b.Rb(5,"bd2-import-labels-step",4,21),b.Wb(7,"div"),b.Wb(8,"button",10),b.Jc(9,"Back"),b.Vb(),b.Wb(10,"button",14),b.ec("click",(function(e){b.Ac(i);var t=b.xc(17);return b.ic().loadData(t)})),b.Jc(11,"Next"),b.Vb(),b.Vb(),b.Vb(),b.Wb(12,"mat-step",12),b.Hc(13,zt,1,0,"ng-template",2),b.Rb(14,"mat-divider"),b.Rb(15,"bd2-import-details-summary",22),b.Rb(16,"bd2-select-data-start-step",4,23),b.Wb(18,"div"),b.Wb(19,"button",10),b.Jc(20,"Back"),b.Vb(),b.Wb(21,"button",14),b.ec("click",(function(e){return b.Ac(i),b.ic().startChoosingBackgrounds()})),b.Jc(22,"Next"),b.Vb(),b.Vb(),b.Vb(),b.Tb()}if(2&e){var a=b.ic();b.Cb(1),b.oc("completed",a.importDetails.areLabelsCorrectlySelected()),b.Cb(3),b.oc("importDetails",a.importDetails)("showTime",!0),b.Cb(1),b.oc("importDetails",a.importDetails),b.Cb(5),b.oc("disabled",!a.importDetails.areLabelsCorrectlySelected()),b.Cb(2),b.oc("completed",a.importDetails.areLabelsCorrectlySelected()&&a.importDetails.isDataStartCorrectlySelected()),b.Cb(3),b.oc("importDetails",a.importDetails)("showTime",!0)("showLabelling",!0),b.Cb(1),b.oc("importDetails",a.importDetails),b.Cb(5),b.oc("disabled",!a.importDetails.isDataStartCorrectlySelected())}}function Gt(e,t){1&e&&b.Jc(0,"Select backgrounds labels")}function jt(e,t){if(1&e&&(b.Ub(0),b.Wb(1,"mat-step"),b.Hc(2,Gt,1,0,"ng-template",2),b.Rb(3,"mat-divider"),b.Rb(4,"bd2-import-details-summary",16),b.Rb(5,"bd2-select-backgrounds-labels-step",4,24),b.Wb(7,"div"),b.Wb(8,"button",10),b.Jc(9,"Back"),b.Vb(),b.Wb(10,"button",25),b.Jc(11,"Next"),b.Vb(),b.Vb(),b.Vb(),b.Tb()),2&e){var i=b.ic();b.Cb(4),b.oc("importDetails",i.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),b.Cb(1),b.oc("importDetails",i.importDetails)}}function Xt(e,t){1&e&&b.Jc(0,"Import timeseries")}var $t,Qt=(($t=function(){function e(t,i,a){_classCallCheck(this,e),this.fileService=t,this.feedback=i,this.dataService=a,this.import=new b.o,this.oldImport=new b.o,this.blocked=!1,this.importDetails=new c.b,this.importDetails.timeType=f.h.TIME_IN_HOURS}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnDestroy",value:function(){this.dataService&&this.dataService.close()}},{key:"upload",value:function(e){var t=this;e.files&&1===e.files.length?this.fileService.uploadFile(e.files[0],e.importFormat).subscribe((function(i){t.importDetails.fileId=i,t.importDetails.fileName=e.files[0].name,t.importDetails.importFormat=e.importFormat,t.importDetails.inRows=e.importFormat!=c.e.EXCEL_TABLE,t.stepper.next(),e.importFormat==c.e.TOPCOUNT&&t.oldImport.next(t.importDetails)}),(function(e){t.feedback.error(e)})):console.error("Wrong upload files size",e.files)}},{key:"loadData",value:function(e){e.loadData()}},{key:"startLabelling",value:function(){this.importDetails.importLabels?this.importLabelsStep?this.importLabelsStep.loadData():console.error("Missing importLabelStep"):this.assignLabelsStep?this.assignLabelsStep.loadData():console.error("Missing assignLabelsStep")}},{key:"startChoosingBackgrounds",value:function(){this.importDetails.containsBackgrounds&&(this.selectBackgroundsStep?this.selectBackgroundsStep.loadLabels():console.error("Missing selectBackgroundsStep"))}},{key:"importData",value:function(){this.importDetails.isComplete()&&this.import.next(this.importDetails)}}]),e}()).\u0275fac=function(e){return new(e||$t)(b.Qb(I),b.Qb(V.a),b.Qb(W))},$t.\u0275cmp=b.Kb({type:$t,selectors:[["bd2-import-steps"]],viewQuery:function(e,t){var i;1&e&&(b.Pc(Ot,!0),b.Pc(Pt,!0),b.Pc(Bt,!0),b.Pc(Ht,!0)),2&e&&(b.wc(i=b.fc())&&(t.stepper=i.first),b.wc(i=b.fc())&&(t.importLabelsStep=i.first),b.wc(i=b.fc())&&(t.assignLabelsStep=i.first),b.wc(i=b.fc())&&(t.selectBackgroundsStep=i.first))},inputs:{blocked:"blocked"},outputs:{import:"import",oldImport:"oldImport"},features:[b.Bb([W])],decls:62,vars:26,consts:[[3,"linear"],["stepper",""],["matStepLabel",""],[3,"uploadFiles"],[3,"importDetails"],[1,"mat-elevation-z4"],["name","inRows",1,"spaced",3,"ngModel","ngModelChange"],[3,"value"],["name","importLabels",1,"spaced",3,"ngModel","ngModelChange"],["name","containsBackgrounds",1,"spaced",3,"ngModel","ngModelChange"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","type","button",3,"click"],[3,"completed"],["defineTimeStep",""],["mat-button","","matStepperNext","","type","button",3,"disabled","click"],[4,"ngIf"],[3,"importDetails","showTime","showLabelling","showDataStart"],["type","info","role","alert",1,"alert","alert-info"],["mat-button","",3,"disabled","click"],[3,"importDetails","showTime"],["assignLabelsStep",""],["importLabelsStep",""],[3,"importDetails","showTime","showLabelling"],["selectDataStartStep",""],["selectBackgroundsStep",""],["mat-button","","matStepperNext","","type","button"]],template:function(e,t){if(1&e){var i=b.Xb();b.Wb(0,"mat-vertical-stepper",0,1),b.Wb(2,"mat-step"),b.Hc(3,Ft,1,0,"ng-template",2),b.Wb(4,"bd2-upload-data-file-step",3),b.ec("uploadFiles",(function(e){return t.upload(e)})),b.Vb(),b.Vb(),b.Wb(5,"mat-step"),b.Wb(6,"form"),b.Hc(7,Jt,1,0,"ng-template",2),b.Rb(8,"mat-divider"),b.Rb(9,"bd2-import-details-summary",4),b.Wb(10,"mat-card",5),b.Wb(11,"mat-card-content"),b.Wb(12,"p"),b.Wb(13,"mat-radio-group",6),b.ec("ngModelChange",(function(e){return t.importDetails.inRows=e})),b.Wb(14,"mat-radio-button",7),b.Jc(15,"Data in rows"),b.Vb(),b.Wb(16,"mat-radio-button",7),b.Jc(17,"Data in columns"),b.Vb(),b.Vb(),b.Vb(),b.Wb(18,"p"),b.Wb(19,"mat-radio-group",8),b.ec("ngModelChange",(function(e){return t.importDetails.importLabels=e})),b.Wb(20,"mat-radio-button",7),b.Jc(21),b.Vb(),b.Wb(22,"mat-radio-button",7),b.Jc(23,"Manually label"),b.Vb(),b.Vb(),b.Vb(),b.Wb(24,"p"),b.Wb(25,"mat-radio-group",9),b.ec("ngModelChange",(function(e){return t.importDetails.containsBackgrounds=e})),b.Wb(26,"mat-radio-button",7),b.Jc(27,"No noise data"),b.Vb(),b.Wb(28,"mat-radio-button",7),b.Jc(29),b.Vb(),b.Vb(),b.Vb(),b.Vb(),b.Wb(30,"mat-card-actions"),b.Wb(31,"button",10),b.Jc(32,"Back"),b.Vb(),b.Wb(33,"button",11),b.ec("click",(function(e){b.Ac(i);var a=b.xc(40);return t.loadData(a)})),b.Jc(34,"Next"),b.Vb(),b.Vb(),b.Vb(),b.Vb(),b.Vb(),b.Wb(35,"mat-step",12),b.Hc(36,At,1,1,"ng-template",2),b.Rb(37,"mat-divider"),b.Rb(38,"bd2-import-details-summary",4),b.Rb(39,"bd2-define-time-step",4,13),b.Wb(41,"div"),b.Wb(42,"button",10),b.Jc(43,"Back"),b.Vb(),b.Wb(44,"button",14),b.ec("click",(function(e){return t.startLabelling()})),b.Jc(45,"Next"),b.Vb(),b.Vb(),b.Vb(),b.Hc(46,Et,12,5,"ng-container",15),b.Hc(47,Kt,23,11,"ng-container",15),b.Hc(48,jt,12,5,"ng-container",15),b.Wb(49,"mat-step",12),b.Hc(50,Xt,1,0,"ng-template",2),b.Rb(51,"mat-divider"),b.Rb(52,"bd2-import-details-summary",16),b.Wb(53,"mat-card",5),b.Wb(54,"mat-card-content"),b.Wb(55,"div",17),b.Jc(56,"You can now import the timeseries"),b.Vb(),b.Vb(),b.Vb(),b.Wb(57,"div"),b.Wb(58,"button",10),b.Jc(59,"Back"),b.Vb(),b.Wb(60,"button",18),b.ec("click",(function(e){return t.importData()})),b.Jc(61,"Import data"),b.Vb(),b.Vb(),b.Vb(),b.Vb()}2&e&&(b.oc("linear",!0),b.Cb(9),b.oc("importDetails",t.importDetails),b.Cb(4),b.oc("ngModel",t.importDetails.inRows),b.Cb(1),b.oc("value",!0),b.Cb(2),b.oc("value",!1),b.Cb(3),b.oc("ngModel",t.importDetails.importLabels),b.Cb(1),b.oc("value",!0),b.Cb(1),b.Lc("Import labels from ",t.importDetails.inLabelNeg,""),b.Cb(1),b.oc("value",!1),b.Cb(3),b.oc("ngModel",t.importDetails.containsBackgrounds),b.Cb(1),b.oc("value",!1),b.Cb(2),b.oc("value",!0),b.Cb(1),b.Lc("Background noise in ",t.importDetails.inLabel,"s"),b.Cb(6),b.oc("completed",t.importDetails.isTimeDefined()),b.Cb(3),b.oc("importDetails",t.importDetails),b.Cb(1),b.oc("importDetails",t.importDetails),b.Cb(5),b.oc("disabled",!t.importDetails.isTimeDefined()),b.Cb(2),b.oc("ngIf",!t.importDetails.importLabels),b.Cb(1),b.oc("ngIf",t.importDetails.importLabels),b.Cb(1),b.oc("ngIf",t.importDetails.containsBackgrounds),b.Cb(1),b.oc("completed",t.importDetails.isComplete()),b.Cb(3),b.oc("importDetails",t.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),b.Cb(8),b.oc("disabled",t.blocked||!t.importDetails.isComplete()))},directives:[N.f,N.a,N.b,E,r.C,r.q,r.r,U.a,Z,_.a,_.c,ee.b,r.p,r.s,ee.a,_.b,te.a,N.e,N.d,We,n.m,ct,ht,wt,xt],encapsulation:2}),$t),qt=i("Xa2L");function Yt(e,t){1&e&&(b.Wb(0,"mat-card"),b.Wb(1,"mat-card-content"),b.Rb(2,"mat-spinner",2),b.Wb(3,"div",3),b.Jc(4,"Importing ...."),b.Vb(),b.Vb(),b.Vb())}var Zt,ei,ti=[{path:"",children:[{path:"",component:(Zt=function(e){function t(e,i){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,i))).BD2REST=e,a.importing=!1,a.titlePart=" Import Data",a}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){_get(_getPrototypeOf(t.prototype),"ngOnInit",this).call(this)}},{key:"importData",value:function(e){var t=this;if(!this.importing){var i=new c.d;i.fileId=e.fileId,i.importFormat=e.importFormat,i.importParameters=e,this.importing=!0,this.BD2REST.experimentImportTS(this.assay.id,i).subscribe((function(e){t.feedback.success("Imported "+e.imported+" timeseries"),t.refreshModel(),t.importing=!1,t.goToTSView()}),(function(e){t.importing=!1,t.feedback.error(e)}))}}},{key:"goToTSView",value:function(){var e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}},{key:"goToOldImport",value:function(e){var t=this.expHomePath();t.push("data","ts-old-import",e.importFormat.name,e.fileId),this.router.navigate(t)}}]),t}(u.a),Zt.\u0275fac=function(e){return new(e||Zt)(b.Qb(m.a),b.Qb(d.a))},Zt.\u0275cmp=b.Kb({type:Zt,selectors:[["bd2-tsimport-dashboard"]],features:[b.zb],decls:2,vars:1,consts:[[3,"import","oldImport"],[4,"ngIf"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"]],template:function(e,t){1&e&&(b.Wb(0,"bd2-import-steps",0),b.ec("import",(function(e){return t.importData(e)}))("oldImport",(function(e){return t.goToOldImport(e)})),b.Vb(),b.Hc(1,Yt,5,0,"mat-card",1)),2&e&&(b.Cb(1),b.oc("ngIf",t.importing))},directives:[Qt,n.m,_.a,_.c,qt.b],encapsulation:2}),Zt)}]}],ii=((ei=function e(){_classCallCheck(this,e)}).\u0275mod=b.Ob({type:ei}),ei.\u0275inj=b.Nb({factory:function(e){return new(e||ei)},imports:[[s.f.forChild(ti)],s.f]}),ei),ai=i("YiFe"),oi=i("ZTEM");i.d(t,"TsImportModule",(function(){return ni}));var li,ni=((li=function e(){_classCallCheck(this,e)}).\u0275mod=b.Ob({type:li}),li.\u0275inj=b.Nb({factory:function(e){return new(e||li)},imports:[[n.c,r.j,r.x,ai.a,oi.a,ii]]}),li)}}]);