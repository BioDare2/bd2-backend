function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=_superPropBase(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(r):a.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _createSuper(e){return function(){var t,r=_getPrototypeOf(e);if(_isNativeReflectConstruct()){var n=_getPrototypeOf(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{d9Wp:function(e,t,r){"use strict";r.r(t),r.d(t,"TsDataModule",(function(){return A}));var n=r("ofXK"),a=r("tyNb"),o=r("yYXI"),i=r("bngM"),c=r("QBpm"),s=function(){function e(t){_classCallCheck(this,e),this.rows=new Map,this.nextColumn=0,this.sorted=!0,null!=t&&(this.sorted=t)}return _createClass(e,[{key:"append",value:function(e,t){this.put(e,t,this.nextColumn)}},{key:"put",value:function(e,t,r){this._put(e,t,r),this.nextColumn=Math.max(this.nextColumn,r+1)}},{key:"putColumn",value:function(e,t,r){var n=this;e.forEach((function(e,a){n._put(e,t[a],r)})),this.nextColumn=Math.max(this.nextColumn,r+1)}},{key:"appendColumn",value:function(e,t){this.putColumn(e,t,this.nextColumn)}},{key:"getValue",value:function(e,t){var r=this.rows.get(e);return r?r[t]:void 0}},{key:"getRow",value:function(e){return this.rows.get(e)}},{key:"forEach",value:function(e){var t=this;this.keys().forEach((function(r,n){var a={key:r,columns:t.rows.get(r)};e(a,n,t)}))}},{key:"forEachFlat",value:function(e){var t=this;this.keys().forEach((function(r,n){var a=[r].concat(t.rows.get(r));e(a,n,t)}))}},{key:"keys",value:function(){return this.sorted?Array.from(this.rows.keys()).sort((function(e,t){return e==t?0:e<t?-1:1})):Array.from(this.rows.keys())}},{key:"_put",value:function(e,t,r){var n=this.rows.get(e);n||(n=[],this.rows.set(e,n)),n[r]=t}},{key:"width",get:function(){return this.nextColumn}},{key:"size",get:function(){return this.rows.size}}]),e}(),l=function(){function e(){_classCallCheck(this,e),this.SEP=","}return _createClass(e,[{key:"renderCSVTable",value:function(e,t,r,n){var a=this.prepareHeaders(n,t,r,e.length);this.appendDataLabels(a,e);var o=this.prepareDataTable(e),i=this.mapToString(a,this.SEP);return i+=this.mapToString(o,this.SEP)}},{key:"prepareHeaders",value:function(e,t,r,n){var a=this.prepareExpHeaders(e);return this.appendDisplayProperties(a,t),this.appendDataProperties(a,n,r),a}},{key:"prepareExpHeaders",value:function(e){var t=new s(!1);return t.put("Exp Id:",""+e.id,0),t.put("Exp URL:","https://biodare2.ed.ac.uk/experiment/"+e.id,0),t.put("Exp Name:",e.name,0),e.contributionDesc.authors.forEach((function(e,r){t.put("Authors:",e.name,r)})),t}},{key:"appendDisplayProperties",value:function(e,t){e.put("Detrending:",t.detrending.label,0),e.put("Normalization:",t.normalisation,0),e.put("Align:",t.align,0)}},{key:"appendDataProperties",value:function(e,t,r){e.put("Traces",t+" of "+r.length,0);var n=Math.floor(r.length/r.pageSize)+(r.length%r.pageSize==0?0:1);e.put("Data Page",r.pageIndex+1+" of "+n,0)}},{key:"appendDataLabels",value:function(e,t){t.forEach((function(t,r){e.put("Label:",t.label,r)}))}},{key:"prepareDataTable",value:function(e){var t=new s;return e.forEach((function(e){var r=e.data.map((function(e){return e.x})),n=e.data.map((function(e){return e.y}));t.appendColumn(r,n)})),t}},{key:"mapToString",value:function(e,t){var r="";return e.forEachFlat((function(e){for(var n=0;n<e.length;n++)void 0!==e[n]&&(r+=e[n]),r+=t;r+="\n"})),r}}]),e}(),u=r("Kj3r"),p=r("Iab2"),f=r("fXoL"),b=r("ZC3s"),d=r("vejM"),h=r("ZMwR"),m=r("GVyA"),g=r("wcxA"),y=r("3Pt+"),v=r("M9IT");function P(e,t){if(1&e&&(f.Wb(0,"option",19),f.Jc(1),f.Vb()),2&e){var r=t.$implicit;f.oc("value",r.name),f.Cb(1),f.Kc(r.label)}}function C(e,t){if(1&e&&(f.Wb(0,"option",19),f.Jc(1),f.Vb()),2&e){var r=t.$implicit;f.oc("value",r.name),f.Cb(1),f.Kc(r.label)}}function _(e,t){if(1&e&&(f.Wb(0,"option",19),f.Jc(1),f.Vb()),2&e){var r=t.$implicit;f.oc("value",r.name),f.Cb(1),f.Kc(r.label)}}var k,w=function(){return[10,25,50,100,200]},V=((k=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,e)}return r}(g.a)).\u0275fac=function(e){return new(e||k)(f.Qb(y.d))},k.\u0275cmp=f.Kb({type:k,selectors:[["bd2-tsdisplay-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},features:[f.zb],decls:37,vars:10,consts:[["role","form",1,"form-horizontal",3,"formGroup"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-sm-2"],["for","timeStart",1,"col-sm-1"],[1,"col-sm-3"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-6"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-1"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],[3,"value"]],template:function(e,t){1&e&&(f.Wb(0,"form",0),f.Wb(1,"div",1),f.Wb(2,"label",2),f.Jc(3,"Time scale"),f.Vb(),f.Wb(4,"label",3),f.Jc(5,"from:"),f.Vb(),f.Wb(6,"div",4),f.Rb(7,"input",5),f.Vb(),f.Wb(8,"label",6),f.Jc(9,"to:"),f.Vb(),f.Wb(10,"div",4),f.Rb(11,"input",7),f.Vb(),f.Vb(),f.Wb(12,"div",8),f.Wb(13,"label",9),f.Jc(14,"Processing"),f.Vb(),f.Wb(15,"label",9),f.Jc(16,"Detrending"),f.Vb(),f.Wb(17,"div",10),f.Wb(18,"select",11),f.Hc(19,P,2,2,"option",12),f.Vb(),f.Vb(),f.Vb(),f.Wb(20,"div",8),f.Rb(21,"label",2),f.Wb(22,"label",13),f.Jc(23,"Norm."),f.Vb(),f.Wb(24,"div",4),f.Wb(25,"select",14),f.Hc(26,C,2,2,"option",12),f.Vb(),f.Vb(),f.Wb(27,"label",13),f.Jc(28,"Align"),f.Vb(),f.Wb(29,"div",4),f.Wb(30,"select",15),f.Hc(31,_,2,2,"option",12),f.Vb(),f.Vb(),f.Vb(),f.Wb(32,"div",8),f.Rb(33,"label",2),f.Wb(34,"div",16),f.Wb(35,"mat-paginator",17,18),f.ec("page",(function(e){return t.loadDataPage(e)})),f.Vb(),f.Vb(),f.Vb(),f.Vb()),2&e&&(f.oc("formGroup",t.mainForm),f.Cb(19),f.oc("ngForOf",t.detrendingOptions),f.Cb(7),f.oc("ngForOf",t.normalisationOptions),f.Cb(5),f.oc("ngForOf",t.alignOptions),f.Cb(4),f.oc("length",t.totalTraces)("disabled",t.disabledPagination)("pageSize",t.currentPage.pageSize)("pageIndex",t.currentPage.pageIndex)("pageSizeOptions",f.qc(9,w)))},directives:[y.C,y.q,y.h,y.i,y.u,y.c,y.y,y.p,y.g,y.z,n.l,v.a,y.t,y.B],encapsulation:2}),k),x=r("nA4b");function O(e,t){if(1&e){var r=f.Xb();f.Wb(0,"div",7),f.Jc(1,"Please complete "),f.Wb(2,"a",8),f.ec("click",(function(){f.Ac(r);var e=f.ic(2);return e.goToExpEdit(e.assay.id,"MeasurementSection")})),f.Jc(3,"Measurement details"),f.Vb(),f.Jc(4," to get access to the secondary data "),f.Vb()}}function S(e,t){if(1&e){var r=f.Xb();f.Wb(0,"div",9),f.Wb(1,"label",10),f.Wb(2,"a",11),f.ec("click",(function(){return f.Ac(r),f.ic(2).exportData()})),f.Wb(3,"i",12),f.Jc(4,"save_alt"),f.Vb(),f.Wb(5,"span",13),f.Jc(6,"Download"),f.Vb(),f.Vb(),f.Jc(7," the current view "),f.Vb(),f.Wb(8,"label"),f.Wb(9,"a",14),f.ec("click",(function(){return f.Ac(r),f.ic(2).recordExport()})),f.Wb(10,"i",12),f.Jc(11,"save_alt"),f.Vb(),f.Wb(12,"span",13),f.Jc(13,"Download"),f.Vb(),f.Vb(),f.Jc(14," the detrended dataset "),f.Vb(),f.Vb()}if(2&e){var n=f.ic(2);f.Cb(9),f.pc("href",n.exportURL,f.Cc)}}function W(e,t){if(1&e&&f.Rb(0,"bd2-ts-plots",15),2&e){var r=f.ic(2);f.oc("tracesPerPlot",r.tracesPerPlot)("data",r.timeseries)}}function E(e,t){if(1&e){var r=f.Xb();f.Wb(0,"div"),f.Wb(1,"h3"),f.Jc(2,"Show timeseries"),f.Vb(),f.Rb(3,"hr"),f.Wb(4,"bd2-tsdisplay-params-rform",1),f.ec("displayParams",(function(e){return f.Ac(r),f.ic().displayChanged(e)})),f.Vb(),f.Hc(5,O,5,0,"div",2),f.Rb(6,"hr"),f.Wb(7,"div",3),f.Jc(8," Hint: You can click on trace label box to remove it from the plot. "),f.Vb(),f.Wb(9,"div",4),f.Hc(10,S,15,1,"div",5),f.Vb(),f.Rb(11,"hr"),f.Hc(12,W,1,2,"bd2-ts-plots",6),f.Vb()}if(2&e){var n=f.ic();f.Cb(4),f.oc("disabled",n.disabledSecondary)("totalTraces",n.totalTraces)("currentPage",n.currentPage),f.Cb(1),f.oc("ngIf",n.disabledSecondary),f.Cb(5),f.oc("ngIf",n.timeseries&&n.exportURL),f.Cb(2),f.oc("ngIf",n.timeseries)}}var T,D,R,I=[{path:"",children:[{path:"view/ts",component:(T=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,a,o,c){var s;return _classCallCheck(this,r),(s=t.call(this,c)).fetcher=e,s.tsdataService=n,s.RDMSocial=a,s.analytics=o,s.timeseries=[],s.totalTraces=0,s.currentPage=i.a.firstPage(),s.tracesPerPlot=5,s.blocked=!1,s.disabledSecondary=!1,s.csvExporter=new l,s.titlePart=" Data",s}return _createClass(r,[{key:"ngOnInit",value:function(){var e=this;_get(_getPrototypeOf(r.prototype),"ngOnInit",this).call(this),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(u.a)(1e3)).subscribe((function(t){if(e.assay){var r=t.data;e.currentParams=t.params,e.exportURL=e.tsdataService.exportURL(e.assay,t.params),e.timeseries=r,e.tracesPerPlot=Math.max(5,r.length/20),e.totalTraces=t.totalTraces,e.currentPage=t.currentPage,e.analytics.experimentDataViev(e.assay.id)}}),(function(t){console.log("Error in TS subscription: "+t),e.feedback.error(t)}))}},{key:"ngOnDestroy",value:function(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),_get(_getPrototypeOf(r.prototype),"ngOnDestroy",this).call(this)}},{key:"displayChanged",value:function(e){this.fetcher.changeDisplayParams(e)}},{key:"exportData",value:function(){var e=this.fetcher.current;if(e){var t=this.csvExporter.renderCSVTable(e.data,e.params,e.currentPage,this.assay),r=new Blob([t],{type:"text/csv"});p.saveAs(r,this.assay.id+"_data."+this.currentParams.detrending.name+".page"+(e.currentPage.pageIndex+1)+".csv"),this.recordExport()}}},{key:"recordExport",value:function(){this.analytics.experimentDataExport(this.assay.id)}},{key:"updateModel",value:function(e){var t=this;_get(_getPrototypeOf(r.prototype),"updateModel",this).call(this,e),this.RDMSocial.canProceedByMeasurement(e).then((function(e){t.disabledSecondary=!e})),this.fetcher.experiment(e)}}]),r}(o.a),T.\u0275fac=function(e){return new(e||T)(f.Qb(c.a),f.Qb(b.a),f.Qb(d.a),f.Qb(h.a),f.Qb(m.a))},T.\u0275cmp=f.Kb({type:T,selectors:[["ng-component"]],features:[f.Bb([c.a]),f.zb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","info","role","alert","dismissible","true","dismissOnTimeout","20000",1,"alert","alert-info"],[1,"clearfix"],["class","float-right",4,"ngIf"],[3,"tracesPerPlot","data",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],[3,"click"],[1,"float-right"],[1,"mr-4"],["download","","role","button","aria-label","download",1,"btn","btn-primary",2,"color","white",3,"click"],[1,"material-icons","bd-icon"],[1,"cdk-visually-hidden"],["download","","role","button",1,"btn","btn-primary",3,"href","click"],[3,"tracesPerPlot","data"]],template:function(e,t){1&e&&f.Hc(0,E,13,6,"div",0),2&e&&f.oc("ngIf",t.assay)},directives:[n.m,V,x.a],encapsulation:2}),T)},{path:"view/heatmap",loadChildren:function(){return r.e(12).then(r.bind(null,"QftV")).then((function(e){return e.TsHeatmapModule}))}},{path:"ts-old-import",loadChildren:function(){return Promise.all([r.e(0),r.e(17)]).then(r.bind(null,"9Gw/")).then((function(e){return e.TsOldImportModule}))}},{path:"ts-import",loadChildren:function(){return Promise.all([r.e(0),r.e(19)]).then(r.bind(null,"yPAH")).then((function(e){return e.TsImportModule}))}}]}],J=((D=function e(){_classCallCheck(this,e)}).\u0275mod=f.Ob({type:D}),D.\u0275inj=f.Nb({factory:function(e){return new(e||D)},imports:[[a.f.forChild(I)],a.f]}),D),M=r("YiFe"),z=r("a6j2"),j=r("ZTEM"),A=((R=function e(){_classCallCheck(this,e)}).\u0275mod=f.Ob({type:R}),R.\u0275inj=f.Nb({factory:function(e){return new(e||R)},imports:[[n.c,y.j,y.x,M.a,z.a,J,j.a]]}),R)}}]);