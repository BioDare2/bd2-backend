(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{QftV:function(t,e,i){"use strict";i.r(e),i.d(e,"TsHeatmapModule",(function(){return Jt}));var a=i("ofXK"),n=i("3Pt+"),s=i("M9IT"),o=i("tyNb"),r=i("yYXI"),c=i("Kj3r"),h=i("bngM"),l=i("QBpm"),b=i("Iab2"),d=i("e8YO"),g=i("K5d1"),p=i("fXoL"),m=i("vejM"),u=i("ZMwR"),x=i("GVyA"),f=i("wcxA"),y=i("Tl2h"),S=i("1jcm"),v=i("8LU1"),O=i("bTqV");function B(t,e){if(1&t&&(p.Tb(0,"option",16),p.Dc(1),p.Sb()),2&t){const t=e.$implicit;p.jc("value",t),p.Bb(1),p.Fc(" ",t,"")}}function w(t,e){if(1&t){const t=p.Ub();p.Tb(0,"div"),p.Tb(1,"select",14),p.Zb("ngModelChange",(function(e){return p.sc(t),p.dc()._changePageSize(e)})),p.Bc(2,B,2,2,"option",15),p.Sb(),p.Sb()}if(2&t){const t=p.dc();p.Bb(1),p.jc("ngModel",t.pageSize),p.Bb(1),p.jc("ngForOf",t._displayedPageSizeOptions)}}function T(t,e){if(1&t&&(p.Tb(0,"div",17),p.Dc(1),p.Sb()),2&t){const t=p.dc();p.Bb(1),p.Fc("",t.pageSize," ")}}let P=(()=>{class t{constructor(t){this._changeDetectorRef=t,this._pageIndex=0,this._length=0,this._pageSizeOptions=[],this.disabled=!1,this.page=new p.o,this.getRangeLabel=(t,e,i)=>{if(0==i||0==e)return"0 of "+i;const a=t*e;return`${a+1} \u2013 ${a<(i=Math.max(i,0))?Math.min(a+e,i):a+e} of ${i}`}}get pageIndex(){return this._pageIndex}set pageIndex(t){this._pageIndex=Math.max(Object(v.f)(t),0),this._changeDetectorRef.markForCheck()}get length(){return this._length}set length(t){this._length=Object(v.f)(t),this._changeDetectorRef.markForCheck()}get pageSize(){return this._pageSize}set pageSize(t){this._pageSize=Math.max(Object(v.f)(t),0),this._updateDisplayedPageSizeOptions()}get pageSizeOptions(){return this._pageSizeOptions}set pageSizeOptions(t){this._pageSizeOptions=(t||[]).map(t=>Object(v.f)(t)),this._updateDisplayedPageSizeOptions()}ngOnInit(){this._updateDisplayedPageSizeOptions()}nextPage(){if(!this.hasNextPage())return;const t=this.pageIndex;this.pageIndex++,this._emitPageEvent(t)}previousPage(){if(!this.hasPreviousPage())return;const t=this.pageIndex;this.pageIndex--,this._emitPageEvent(t)}hasPreviousPage(){return this.pageIndex>=1&&0!=this.pageSize}hasNextPage(){const t=this.getNumberOfPages()-1;return this.pageIndex<t&&0!=this.pageSize}getNumberOfPages(){return this.pageSize?Math.ceil(this.length/this.pageSize):0}_nextButtonsDisabled(){return this.disabled||!this.hasNextPage()}_previousButtonsDisabled(){return this.disabled||!this.hasPreviousPage()}_updateDisplayedPageSizeOptions(){this.pageSize||(this._pageSize=0!=this.pageSizeOptions.length?this.pageSizeOptions[0]:50),this._displayedPageSizeOptions=this.pageSizeOptions.slice(),-1===this._displayedPageSizeOptions.indexOf(this.pageSize)&&this._displayedPageSizeOptions.push(this.pageSize),this._displayedPageSizeOptions.sort((t,e)=>t-e),this._changeDetectorRef.markForCheck()}_changePageSize(t){const e=this.pageIndex;this.pageIndex=Math.floor(this.pageIndex*this.pageSize/t)||0,this.pageSize=t,this._emitPageEvent(e)}_emitPageEvent(t){this.page.emit({previousPageIndex:t,pageIndex:this.pageIndex,pageSize:this.pageSize,length:this.length})}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(p.h))},t.\u0275cmp=p.Hb({type:t,selectors:[["bd2-simple-paginator"]],inputs:{pageIndex:"pageIndex",length:"length",pageSize:"pageSize",pageSizeOptions:"pageSizeOptions",disabled:"disabled"},outputs:{page:"page"},decls:17,vars:7,consts:[[1,"mat-paginator"],[1,"mat-paginator-outer-container"],[1,"mat-paginator-container"],[1,"mat-paginator-page-size"],[1,"mat-paginator-page-size-label"],[4,"ngIf"],["class","mat-paginator-page-size-value",4,"ngIf"],[1,"mat-paginator-range-actions"],[1,"mat-paginator-range-label"],["mat-icon-button","","type","button",1,"mat-paginator-navigation-previous",3,"disabled","click"],["viewBox","0 0 24 24","focusable","false",1,"mat-paginator-icon"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["mat-icon-button","","type","button",1,"mat-paginator-navigation-next",3,"disabled","click"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],["required","",1,"mat-paginator-page-size-select",2,"font-size","12px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mat-paginator-page-size-value"]],template:function(t,e){1&t&&(p.Tb(0,"div",0),p.Tb(1,"div",1),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Dc(5," Items per page: "),p.Sb(),p.Bc(6,w,3,2,"div",5),p.Bc(7,T,2,1,"div",6),p.Sb(),p.Tb(8,"div",7),p.Tb(9,"div",8),p.Dc(10),p.Sb(),p.Tb(11,"button",9),p.Zb("click",(function(){return e.previousPage()})),p.cc(),p.Tb(12,"svg",10),p.Ob(13,"path",11),p.Sb(),p.Sb(),p.bc(),p.Tb(14,"button",12),p.Zb("click",(function(){return e.nextPage()})),p.cc(),p.Tb(15,"svg",10),p.Ob(16,"path",13),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&t&&(p.Bb(6),p.jc("ngIf",e._displayedPageSizeOptions.length>1),p.Bb(1),p.jc("ngIf",e._displayedPageSizeOptions.length<=1),p.Bb(3),p.Fc(" ",e.getRangeLabel(e.pageIndex,e.pageSize,e.length)," "),p.Bb(1),p.jc("disabled",e._previousButtonsDisabled()),p.Cb("aria-label","previous page"),p.Bb(3),p.jc("disabled",e._nextButtonsDisabled()),p.Cb("aria-label","next page"))},directives:[a.m,O.a,n.A,n.z,n.q,n.t,a.l,n.u,n.C],styles:[".mat-paginator-icon[_ngcontent-%COMP%] {\n        width: 28px;\n        fill: currentColor;\n\n      }\n\n      .mat-paginator-range-actions[_ngcontent-%COMP%] {\n        display: flex;\n        align-items: center;\n      }\n\n      .mat-paginator[_ngcontent-%COMP%] {\n        display: block;\n      }\n\n      .mat-paginator-outer-container[_ngcontent-%COMP%] {\n        display: flex;\n      }\n\n      .mat-paginator-container[_ngcontent-%COMP%] {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        min-height: 56px;\n        padding: 0 8px;\n        flex-wrap: wrap-reverse;\n        width: 100%;\n      }\n\n      .mat-paginator-page-size[_ngcontent-%COMP%] {\n        display: flex;\n        align-items: baseline;\n        margin-right: 8px;\n      }\n\n      .mat-paginator-page-size-label[_ngcontent-%COMP%] {\n        margin: 0 4px;\n      }\n\n      .mat-paginator-page-size-select[_ngcontent-%COMP%] {\n        margin: 6px 4px 0 4px;\n        width: 70px;\n\n      }\n\n      .mat-paginator-range-label[_ngcontent-%COMP%] {\n        margin:  0 32px 0 24px;\n      }"],changeDetection:0}),t})();function k(t,e){if(1&t&&(p.Tb(0,"option",28),p.Dc(1),p.Sb()),2&t){const t=e.$implicit;p.jc("value",t.name),p.Bb(1),p.Ec(t.label)}}function D(t,e){if(1&t&&(p.Tb(0,"option",28),p.Dc(1),p.Sb()),2&t){const t=e.$implicit;p.jc("value",t.name),p.Bb(1),p.Ec(t.label)}}function I(t,e){if(1&t&&(p.Tb(0,"option",28),p.Dc(1),p.Sb()),2&t){const t=e.$implicit;p.jc("value",t.name),p.Bb(1),p.Ec(t.label)}}const j=function(){return[10,25,50,100,200,500]};let z=(()=>{class t extends f.a{constructor(t){super(t),this.alignOptions=[new y.e("NONE","none"),new y.e("MEAN","mean")];const e=this.normalisationOptions.find(t=>"RANGE"===t.name);this.displayParamsForm.get("normalisation").setValue(null==e?void 0:e.name),this.displayParamsForm.get("hourly").setValue(!0)}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(n.e))},t.\u0275cmp=p.Hb({type:t,selectors:[["bd2-heatmap-display-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},features:[p.yb],decls:46,vars:10,consts:[["role","form",1,"form-horizontal","container",3,"formGroup"],[1,"row"],[1,"col-md-8","col-sm-10"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-md-3","col-sm-3"],["for","timeStart",1,"col-md-1","col-sm-2"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-md-1","col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"col-md-2","col-sm-4"],["formControlName","hourly",1,"mr-3"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-3"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-1"],["for","align",1,"col-sm-1"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-2"],["for","normalisation"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],[1,"col-sm"],["formControlName","trimFirst",1,"mr-3"],["formControlName","log2"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],[3,"value"]],template:function(t,e){1&t&&(p.Tb(0,"form",0),p.Tb(1,"div",1),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Tb(4,"label",4),p.Dc(5,"Time range"),p.Sb(),p.Tb(6,"label",5),p.Dc(7,"from:"),p.Sb(),p.Tb(8,"div",4),p.Ob(9,"input",6),p.Sb(),p.Tb(10,"label",7),p.Dc(11,"to:"),p.Sb(),p.Tb(12,"div",4),p.Ob(13,"input",8),p.Sb(),p.Sb(),p.Sb(),p.Tb(14,"div",9),p.Tb(15,"mat-slide-toggle",10),p.Dc(16,"hourly"),p.Sb(),p.Sb(),p.Sb(),p.Tb(17,"div",11),p.Tb(18,"label",12),p.Dc(19,"Detrending"),p.Sb(),p.Tb(20,"div",13),p.Tb(21,"select",14),p.Bc(22,k,2,2,"option",15),p.Sb(),p.Sb(),p.Ob(23,"div",16),p.Tb(24,"label",17),p.Dc(25,"Align"),p.Sb(),p.Tb(26,"div",13),p.Tb(27,"select",18),p.Bc(28,D,2,2,"option",15),p.Sb(),p.Sb(),p.Sb(),p.Tb(29,"div",11),p.Tb(30,"div",19),p.Tb(31,"label",20),p.Dc(32,"Normalize"),p.Sb(),p.Sb(),p.Tb(33,"div",13),p.Tb(34,"select",21),p.Bc(35,I,2,2,"option",15),p.Sb(),p.Sb(),p.Tb(36,"div",22),p.Tb(37,"mat-slide-toggle",23),p.Dc(38,"within range"),p.Sb(),p.Tb(39,"mat-slide-toggle",24),p.Dc(40,"log2 transf."),p.Sb(),p.Sb(),p.Sb(),p.Tb(41,"div",11),p.Ob(42,"label",19),p.Tb(43,"div",25),p.Tb(44,"bd2-simple-paginator",26,27),p.Zb("page",(function(t){return e.loadDataPage(t)})),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&t&&(p.jc("formGroup",e.mainForm),p.Bb(22),p.jc("ngForOf",e.detrendingOptions),p.Bb(6),p.jc("ngForOf",e.alignOptions),p.Bb(7),p.jc("ngForOf",e.normalisationOptions),p.Bb(9),p.jc("length",e.totalTraces)("disabled",e.disabledPagination)("pageSize",e.currentPage.pageSize)("pageIndex",e.currentPage.pageIndex)("pageSizeOptions",p.lc(9,j)))},directives:[n.D,n.r,n.i,n.j,n.v,n.d,n.z,n.q,n.h,S.a,n.A,a.l,P,n.u,n.C],encapsulation:2}),t})();var M=i("7EHt"),C=i("117B"),N=i("XNiG"),F=i("PqYM"),H=i("VIqg"),_=i("sCaM"),E=i("f4CH"),L=i("FmoU"),A=i("NltA"),$=i("EjHT"),W=i("CKiT"),R=i("lJxs"),Z=i("vkgz");function q(t,e){if(1&t&&(p.cc(),p.Tb(0,"svg",2),p.Tb(1,"defs"),p.Tb(2,"filter",3),p.Ob(3,"feDropShadow",4),p.Sb(),p.Tb(4,"pattern",5),p.Ob(5,"line",6),p.Sb(),p.Sb(),p.Tb(6,"g",7),p.Ob(7,"g",8),p.Ob(8,"g",9),p.Ob(9,"g",10),p.Ob(10,"g",11),p.Ob(11,"g",12),p.Sb(),p.Sb()),2&t){const t=p.dc();p.Cb("viewBox",t.graphic.viewBox),p.Bb(6),p.Cb("transform",t.graphic.mainPaneTransform),p.Bb(1),p.jc("graphic",t.graphic),p.Bb(1),p.jc("graphic",t.graphic),p.Bb(1),p.jc("graphic",t.graphic)("series",t.series),p.Bb(1),p.jc("graphic",t.graphic)("data",t.series)("alwaysOn",t.labelsAlwaysOn),p.Bb(1),p.jc("graphic",t.graphic)}}const V=["text"],G=["bd2hm-tooltip",""];function U(t,e){if(1&t&&(p.cc(),p.Tb(0,"g",1),p.Tb(1,"g"),p.Ob(2,"rect"),p.Tb(3,"text",null,2),p.Tb(5,"tspan",3),p.Dc(6),p.Sb(),p.Tb(7,"tspan",4),p.Dc(8),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&t){const t=p.dc();p.Cb("display",t.show?void 0:"none")("transform",t.position),p.Bb(1),p.Cb("opacity",t.ready?1:0),p.Bb(1),p.Cb("x",t.textBX)("width",t.textBWidth)("y",t.textBY)("height",t.textBHeight),p.Bb(4),p.Ec(t.label),p.Bb(2),p.Ec(t.values)}}const Y=["bd2hm-labels",""];function J(t,e){if(1&t&&(p.cc(),p.Ob(0,"g",3)),2&t){const t=e.$implicit,i=p.dc(2);p.jc("serie",t)("yStart",i.yStart(t))("maxHeight",i.maxHeight())("alwaysOn",i.alwaysOn)}}function K(t,e){if(1&t&&(p.cc(),p.Tb(0,"g",1),p.Bc(1,J,1,4,"g",2),p.Sb()),2&t){const t=p.dc();p.Bb(1),p.jc("ngForOf",t.data)("ngForTrackBy",t.trackByIndex)}}const X=["bd2hm-label-box",""];function Q(t,e){if(1&t&&(p.cc(),p.Tb(0,"text",9),p.Dc(1),p.Sb()),2&t){const t=p.dc(2);p.Cb("y",t.yMiddle)("font-size",t.fontSize()),p.Bb(1),p.Ec(t.serie.label)}}function tt(t,e){if(1&t){const t=p.Ub();p.cc(),p.Tb(0,"g",1),p.Bc(1,Q,2,3,"text",2),p.Tb(2,"g",3),p.Zb("mouseout",(function(){return p.sc(t),p.dc().toggleLabel(!1)}))("mouseover",(function(){return p.sc(t),p.dc().toggleLabel(!0)})),p.Ob(3,"rect",4),p.Tb(4,"g",5),p.Ob(5,"rect",6),p.Tb(6,"text",7,8),p.Dc(8),p.Sb(),p.Sb(),p.Sb(),p.Sb()}if(2&t){const t=p.dc();p.Bb(1),p.jc("ngIf",t.alwaysOn),p.Bb(2),p.Cb("y",t.triggerY)("height",t.triggerHeight)("fill",t.color),p.Bb(1),p.Cb("opacity",t.ready?1:0)("display",t.toggled?void 0:"none"),p.Bb(1),p.Cb("width",t.textBWidth)("y",t.textBY)("height",t.textBHeight),p.Bb(1),p.Cb("y",t.yMiddle),p.Bb(2),p.Ec(t.serie.label)}}const et=["bd2hm-serie-row",""];function it(t,e){if(1&t&&(p.cc(),p.Ob(0,"g",3)),2&t){const t=e.$implicit,i=p.dc(2);p.jc("point",t)("xScale",i.graphic.xScale)("yPosition",i.yPosition)("yHeight",i.yHeight)("colorScale",i.graphic.colorScale)("label",i.serie.label)}}function at(t,e){if(1&t&&(p.cc(),p.Tb(0,"g",1),p.Bc(1,it,1,6,"g",2),p.Sb()),2&t){const t=p.dc();p.Bb(1),p.jc("ngForOf",t.serie.data)("ngForTrackBy",t.trackByIndex)}}const nt=["box"],st=["bd2hm-data-point-box",""];function ot(t,e){if(1&t&&(p.cc(),p.Ob(0,"rect",null,1)),2&t){const t=p.dc();p.Cb("x",t.xPosition)("y",t.yPosition)("width",t.xWidth)("height",t.yHeight)("fill",t.colorScale(t.point.y))("stroke",t.colorScale(t.point.y))}}const rt=["bd2hm-series-box",""];function ct(t,e){if(1&t&&(p.cc(),p.Ob(0,"g",1)),2&t){const t=e.$implicit,i=p.dc();p.jc("graphic",i.graphic)("serie",t)}}const ht=["bd2hm-pane-back",""],lt=["bd2hm-axis-box",""];function bt(t,e){if(1&t&&(p.cc(),p.Tb(0,"g",1),p.Ob(1,"g",2),p.Ob(2,"g",3),p.Ob(3,"g",4),p.Ob(4,"g",5),p.Sb()),2&t){const t=p.dc();p.Bb(1),p.jc("top",!0)("xScale",t.graphic.xScale)("yPosition",0)("xDomain",t.graphic.xDomain),p.Bb(1),p.jc("top",!1)("xScale",t.graphic.xScale)("yPosition",t.graphic.workspaceHeight)("xDomain",t.graphic.xDomain),p.Bb(1),p.jc("left",!0)("yScale",t.graphic.yScale)("xPosition",0),p.Bb(1),p.jc("left",!1)("yScale",t.graphic.yScale)("xPosition",t.graphic.workspaceWidth)}}const dt=["bd2hm-y-axis",""],gt=["bd2hm-vtick-mark",""];function pt(t,e){if(1&t&&(p.cc(),p.Ob(0,"line",2)),2&t){const t=p.dc();p.Cb("x1",t.tick.x)("x2",t.tick.x)("y2",t.marky2)}}function mt(t,e){if(1&t&&(p.cc(),p.Tb(0,"text"),p.Dc(1),p.Sb()),2&t){const t=p.dc();p.Cb("x",t.tick.x)("y",t.texty2)("dy",t.textdy),p.Bb(1),p.Ec(t.tick.label)}}const ut=["bd2hm-num-x-axis",""];function xt(t,e){1&t&&(p.cc(),p.Ob(0,"g",3)),2&t&&p.jc("tick",e.$implicit)}class ft{constructor(){this.vMargin=25,this.hMargin=20,this.smallRowWidth=6,this.midRowWidth=12,this.bigRowWidth=25,this.rowGap=.05}}class yt{}class St{constructor(t=0,e=0,i,a=!1,n=!1){this.x=t,this.y=e,this.label=i,this.top=a,this.left=n}}class vt{constructor(t,e,i,a){this.x=t,this.y=e,this.left=i,this.right=a,this.width=a-i}}class Ot{}let Bt=(()=>{class t{constructor(){this.request$=new N.a}showTooltip(t,e,i){this.request$.next([!0,t,e,i])}hideTooltip(t,e){this.request$.next([!1,void 0,t,e])}ngOnDestroy(){this.request$.complete()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=p.Jb({token:t,factory:t.\u0275fac}),t})();class wt{seriesToBoxes(t,e=!1){return t.map(t=>this.serieToBoxes(t,e))}serieToBoxes(t,e=!1){const i=Object.assign(new Ot,t);return i.data=e?this.pointsToAsymBoxes(t.data):this.pointsToSymBoxes(t.data),i}pointsToAsymBoxes(t,e=.5){if(!t||0===t.length)return[];if(1===t.length){const i=t[0];return[new vt(i.x,i.y,i.x-e,i.x+e)]}const i=[],a=t[0];i.push(new vt(a.x,a.y,(3*a.x-t[1].x)/2,(a.x+t[1].x)/2));for(let s=1;s<t.length-1;s++)i.push(this.asymBoxFromPoints(t[s],t[s-1],t[s+1]));const n=t[t.length-1];return i.push(new vt(n.x,n.y,(t[t.length-2].x+n.x)/2,(3*n.x-t[t.length-2].x)/2)),i}asymBoxFromPoints(t,e,i){return new vt(t.x,t.y,(e.x+t.x)/2,(t.x+i.x)/2)}pointsToSymBoxes(t,e=.5){if(!t||0===t.length)return[];if(1===t.length){const i=t[0];return[new vt(i.x,i.y,i.x-e,i.x+e)]}const i=[],a=t[0];i.push(new vt(a.x,a.y,(3*a.x-t[1].x)/2,(a.x+t[1].x)/2));for(let s=1;s<t.length-1;s++)i.push(this.symBoxFromPoints(t[s],t[s-1],t[s+1]));const n=t[t.length-1];return i.push(new vt(n.x,n.y,(t[t.length-2].x+n.x)/2,(3*n.x-t[t.length-2].x)/2)),i}symBoxFromPoints(t,e,i){const a=Math.min(t.x-e.x,i.x-t.x)/2;return new vt(t.x,t.y,t.x-a,t.x+a)}}class Tt{prepareGraphicContext(t,e,i=!1){const a=new yt;return this.calculateDimensions(a,t,e),this.addPaneAttributes(a,e),this.addScales(a,t,e,i),this.addFormatters(a,t),a.labelsColors=this.labelsColors(t),a}calculateDimensions(t,e,i){t.pWidth=500,t.workspaceWidth=t.pWidth-3*i.hMargin,t.workspaceHeight=this.calculateWorkspaceHeight(e,i),t.pHeight=t.workspaceHeight+2*i.vMargin}calculateWorkspaceHeight(t,e){return t.length<=25?t.length*e.bigRowWidth:t.length<=100?t.length*e.midRowWidth:t.length*e.smallRowWidth}addPaneAttributes(t,e){t.viewBox="0 0 500 "+t.pHeight,t.mainPaneTransform=`translate(${2*e.hMargin}, ${e.vMargin})`}addScales(t,e,i,a){let n=this.timeDomain(e);t.xDomain=n;const s=this.timeMargin(e,n);n=[n[0]-s,n[1]+s],t.xScale=Object(H.a)().clamp(!0).domain(n).range([0,t.workspaceWidth]);const o=e.map(t=>t.key);t.yDomain=o,t.yScale=Object(_.a)().paddingInner(i.rowGap).paddingOuter(0).domain(o).range([0,t.workspaceHeight]),t.colorScale=this.heatmapScale(e,a)}addFormatters(t,e){const i=this.timeDomain(e);t.domainFormatter=this.formatForDomain(i);const a=this.valuesRange(e);t.valuesFormatter=this.formatForDomain(a)}timeMargin(t,e){const i=e[0];let a=.5;return t.filter(t=>t.data&&t.data.length>0&&t.data[0].x===i).forEach(t=>{const e=t.data[0];e instanceof vt&&(a=Math.max(a,e.x-e.left))}),a}timeDomain(t){let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.forEach(t=>{t.data&&t.data.length>0&&(e=Math.min(e,t.data[0].x),i=Math.max(i,t.data[t.data.length-1].x))}),e=isFinite(e)?e:0,i=isFinite(i)?i:1,[e,i]}heatmapScale(t,e){let i=this.valuesRange(t);if(e){const t=Math.max(Math.abs(i[0]),Math.abs(i[1]));i=[-t,t]}const a=function(t="#d62728",e="white",i="#1f77b4",a=.1){const n=Object(H.a)().domain([-1,0,1]).range([Object(L.g)(t),Object(L.g)(e),Object(L.g)(i)]);return Object(A.a)(-1,1+a,a).map(t=>Object(L.g)(n(t)).hex())}();return Object(E.a)().domain(i).range(a)}valuesRange(t){if(0===t.length)return[NaN,NaN];let e=t[0].min,i=t[0].max;return t.forEach(t=>{e=Math.min(e,t.min),i=Math.max(i,t.max)}),[e,i]}formatForDomain([t,e]){const i=e-t;return i<1?Object($.b)(".2~e"):i<100?Object($.b)(".2~f"):i<1e5?Object($.b)("d"):Object($.b)(".2~e")}labelsColors(t){const e=t.length;return function(t){return Object(W.a)(t/e)}}}let Pt=(()=>{class t{constructor(t,e){this.changeDetector=t,this.tooltip=e,this.asymmetric=!1,this.middleZero=!1,this.hidden=!1,this.labelsAlwaysOn=!0,this.lookAndFeel=new ft,this.heatmapDataUtil=new wt,this.heatmapGraphUtil=new Tt}ngOnInit(){}ngOnDestroy(){this.tooltip&&this.tooltip.ngOnDestroy()}ngOnChanges(t){this.data&&this.data.length>0?(this.series=this.heatmapDataUtil.seriesToBoxes(this.data,this.asymmetric),this.graphic=this.heatmapGraphUtil.prepareGraphicContext(this.series,this.lookAndFeel,this.middleZero)):(this.graphic=void 0,this.series=void 0)}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(p.h),p.Nb(Bt))},t.\u0275cmp=p.Hb({type:t,selectors:[["bd2-num-heatmap"]],inputs:{asymmetric:"asymmetric",middleZero:"middleZero",hidden:"hidden",labelsAlwaysOn:"labelsAlwaysOn",lookAndFeel:"lookAndFeel",data:"data"},features:[p.Ab([Bt]),p.zb],decls:2,vars:2,consts:[[1,"bd2hm-heatmap",3,"hidden"],["width","100%",4,"ngIf"],["width","100%"],["id","bd2hm-shadow"],["dx","1","dy","1","stdDeviation","1"],["id","bd2hm-pattern-diagonal","width","10","height","10","patternTransform","rotate(45 0 0)","patternUnits","userSpaceOnUse"],["x1","0","y1","0","x2","0","y2","10",2,"stroke","lightgrey","stroke-width","1"],[1,"bd2hm-mainPane"],["bd2hm-pane-back","",1,"bd2hm-paneBack",3,"graphic"],["bd2hm-axis-box","",3,"graphic"],["bd2hm-series-box","",1,"bd2hm-seriesBox",3,"graphic","series"],["bd2hm-labels","",3,"graphic","data","alwaysOn"],["bd2hm-tooltip","",3,"graphic"]],template:function(t,e){1&t&&(p.Tb(0,"div",0),p.Bc(1,q,12,10,"svg",1),p.Sb()),2&t&&(p.jc("hidden",e.hidden),p.Bb(1),p.jc("ngIf",e.graphic))},directives:function(){return[a.m,Ct,Nt,Mt,Dt,kt]},styles:[".bd2hm-paneBack rect{fill:url(#bd2hm-pattern-diagonal)}  .bd2hm-axisWrapper line{stroke:grey}  .bd2hm-axisWrapper text{fill:grey;font-size:9px;text-anchor:middle}  .bd2hm-labels text.bd2hm-onLabel{dominant-baseline:central;fill:#000;opacity:.6}  .bd2hm-labels .bd2hm-hover text{dominant-baseline:central;fill:#fff;font-size:10px}  .bd2hm-labels .bd2hm-hover rect{fill:#000;filter:url(#bd2hm-shadow);opacity:.8}  .bd2hm-tooltipBox text{fill:#fff;font-size:10px}  .bd2hm-tooltipBox rect{fill:#000;filter:url(#bd2hm-shadow);opacity:.8}"],changeDetection:0}),t})(),kt=(()=>{class t{constructor(t,e){this.tooltip=t,this.changeDetector=e,this.boxMargin=4,this.show=!1,this.ready=!1}ngOnInit(){this.subscription=this.tooltip.request$.pipe(Object(c.a)(100)).subscribe(t=>this.handleRequest(t))}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}handleRequest([t,e,i,a]){t?this.showTooltip(e,i,a):this.hideTooltip(i,a)}showTooltip(t,e,i){this.ready=!1,this.label=this.formatLabel(t),this.values=this.formatValues(e),this.show=!0,this.changeDetector.detectChanges(),this.updateTextBBox().subscribe(t=>{this.show&&(this.position=this.translateToDataLocation(i,this.textBWidth,this.graphic.workspaceWidth),this.ready=!0),this.changeDetector.detectChanges()})}translateToDataLocation(t,e,i){let a=t.x+t.width+2*this.boxMargin;return a+e>=i&&(a=t.x-e),`translate(${a}, ${t.y})`}hideTooltip(t,e){this.show=!1,this.changeDetector.detectChanges()}formatValues(t){return`${this.graphic.domainFormatter(t.x)} : ${this.graphic.valuesFormatter(t.y)}`}updateTextBBox(){return Object(F.a)(0).pipe(Object(R.a)(t=>this.textBBox()),Object(Z.a)(t=>this.setTextBBox(t)))}setTextBBox(t){this.textBX=t.x-this.boxMargin,this.textBY=t.y-this.boxMargin,this.textBHeight=t.height+2*this.boxMargin,this.textBWidth=t.width+2*this.boxMargin}textBBox(){return this.textNode?this.textNode.nativeElement.getBBox():{x:0,y:0,height:0,width:0}}formatLabel(t){return t?t.length<40?t:t.substring(0,38)+"...":""}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(Bt),p.Nb(p.h))},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-tooltip",""]],viewQuery:function(t,e){var i;1&t&&p.Ic(V,!0),2&t&&p.pc(i=p.ac())&&(e.textNode=i.first)},inputs:{boxMargin:"boxMargin",graphic:"graphic"},attrs:G,decls:1,vars:1,consts:[["class","bd2hm-tooltipBox",4,"ngIf"],[1,"bd2hm-tooltipBox"],["text",""],["x","0"],["x","0","dy","1.2em"]],template:function(t,e){1&t&&p.Bc(0,U,9,9,"g",0),2&t&&p.jc("ngIf",e.graphic)},directives:[a.m],encapsulation:2,changeDetection:0}),t})(),Dt=(()=>{class t{constructor(){this.alwaysOn=!0}trackByIndex(t,e){return t}ngOnInit(){}yStart(t){return this.graphic.yScale(t.key)}maxHeight(){return this.graphic.yScale.bandwidth()}color(t){return this.graphic.labelsColors(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-labels",""]],inputs:{alwaysOn:"alwaysOn",graphic:"graphic",data:"data"},attrs:Y,decls:1,vars:1,consts:[["class","bd2hm-labels",4,"ngIf"],[1,"bd2hm-labels"],["bd2hm-label-box","",3,"serie","yStart","maxHeight","alwaysOn",4,"ngFor","ngForOf","ngForTrackBy"],["bd2hm-label-box","",3,"serie","yStart","maxHeight","alwaysOn"]],template:function(t,e){1&t&&p.Bc(0,K,2,2,"g",0),2&t&&p.jc("ngIf",e.graphic&&e.data)},directives:function(){return[a.m,a.l,It]},encapsulation:2,changeDetection:0}),t})(),It=(()=>{class t{constructor(t){this.changeDetector=t,this.alwaysOn=!0,this.color="rgb(67, 125, 179)",this.textBWidth=0,this.textBY=0,this.toggled=!1,this.ready=!1}ngOnInit(){}ngOnChanges(t){this.margin=this.marginSize(),this.triggerY=this.yStart+this.margin,this.triggerHeight=this.margin>1?this.maxHeight-2*this.margin:this.maxHeight-1,this.yMiddle=this.yStart+this.maxHeight/2}marginSize(){return this.maxHeight>=20?4:this.maxHeight>=12?2:1}fontSize(){return this.maxHeight>12?10:this.maxHeight>=6?this.maxHeight-3:0}toggleLabel(t){void 0===t&&(t=!this.toggled),this.ready=!1,this.toggled=t,this.toggled&&this.updateTextBBox().subscribe(t=>{this.toggled&&(this.ready=!0),this.changeDetector.markForCheck()})}updateTextBBox(){return Object(F.a)(0).pipe(Object(R.a)(t=>this.textBBox()),Object(Z.a)(t=>this.setTextBBox(t)))}setTextBBox(t){this.textBY=t.y-4,this.textBHeight=t.height+8,this.textBWidth=t.x+t.width+4}textBBox(){return this.textNode?this.textNode.nativeElement.getBBox():{x:0,y:0,height:0,width:0}}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(p.h))},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-label-box",""]],viewQuery:function(t,e){var i;1&t&&p.Ic(V,!0),2&t&&p.pc(i=p.ac())&&(e.textNode=i.first)},inputs:{alwaysOn:"alwaysOn",color:"color",serie:"serie",yStart:"yStart",maxHeight:"maxHeight"},features:[p.zb],attrs:X,decls:1,vars:1,consts:[["class","bd2hm-label",4,"ngIf"],[1,"bd2hm-label"],["x","5","class","bd2hm-onLabel",4,"ngIf"],[3,"mouseout","mouseover"],["x","-7","width","7"],[1,"bd2hm-hover"],["x","0"],["x","5"],["text",""],["x","5",1,"bd2hm-onLabel"]],template:function(t,e){1&t&&p.Bc(0,tt,9,11,"g",0),2&t&&p.jc("ngIf",e.serie)},directives:[a.m],encapsulation:2,changeDetection:0}),t})(),jt=(()=>{class t{constructor(){}trackByIndex(t,e){return t}ngOnInit(){}ngOnChanges(t){this.graphic&&this.serie&&(this.yPosition=this.graphic.yScale(this.serie.key),this.yHeight=this.graphic.yScale.bandwidth())}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-serie-row",""]],inputs:{graphic:"graphic",serie:"serie"},features:[p.zb],attrs:et,decls:1,vars:1,consts:[["class","bd2hm-serie",4,"ngIf"],[1,"bd2hm-serie"],["bd2hm-data-point-box","",3,"point","xScale","yPosition","yHeight","colorScale","label",4,"ngFor","ngForOf","ngForTrackBy"],["bd2hm-data-point-box","",3,"point","xScale","yPosition","yHeight","colorScale","label"]],template:function(t,e){1&t&&p.Bc(0,at,2,2,"g",0),2&t&&p.jc("ngIf",e.graphic&&e.serie)},directives:function(){return[a.m,a.l,zt]},encapsulation:2,changeDetection:0}),t})(),zt=(()=>{class t{constructor(t,e){this.tooltip=t,this.zone=e}ngOnChanges(t){if(this.xScale&&this.point){this.xPosition=this.xScale(this.point.left);const t=this.xScale(this.point.right)-this.xScale(this.point.left);this.xWidth=t>=2?t-1:1}}ngAfterViewInit(){this.boxNode&&this.prevBoxNode!==this.boxNode&&(this.removeMouseListeners(this.prevBoxNode),this.zone.runOutsideAngular(()=>{this.addMouseListeners(this.boxNode)}),this.prevBoxNode=this.boxNode)}ngOnInit(){}ngOnDestroy(){this.removeMouseListeners(this.boxNode)}addMouseListeners(t){t&&(t.nativeElement.addEventListener("mouseover",this.showTooltip.bind(this)),t.nativeElement.addEventListener("mouseout",this.hideTooltip.bind(this)))}removeMouseListeners(t){t&&(t.nativeElement.removeEventListener("mouseover",this.showTooltip),t.nativeElement.removeEventListener("mouseout",this.hideTooltip))}hideTooltip(t){this.tooltip.hideTooltip(this.point,{x:this.xPosition,y:this.yPosition,width:this.xWidth})}showTooltip(t){this.tooltip.showTooltip(this.label,this.point,{x:this.xPosition,y:this.yPosition,width:this.xWidth})}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(Bt),p.Nb(p.B))},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-data-point-box",""]],viewQuery:function(t,e){var i;1&t&&p.Ic(nt,!0),2&t&&p.pc(i=p.ac())&&(e.boxNode=i.first)},inputs:{point:"point",yPosition:"yPosition",yHeight:"yHeight",xScale:"xScale",colorScale:"colorScale",label:"label"},features:[p.zb],attrs:st,decls:1,vars:1,consts:[[4,"ngIf"],["box",""]],template:function(t,e){1&t&&p.Bc(0,ot,2,6,"rect",0),2&t&&p.jc("ngIf",e.point&&e.xScale)},directives:[a.m],encapsulation:2,changeDetection:0}),t})(),Mt=(()=>{class t{constructor(){}trackByIndex(t,e){return t}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-series-box",""]],inputs:{series:"series",graphic:"graphic"},attrs:rt,decls:1,vars:2,consts:[["bd2hm-serie-row","",3,"graphic","serie",4,"ngFor","ngForOf","ngForTrackBy"],["bd2hm-serie-row","",3,"graphic","serie"]],template:function(t,e){1&t&&p.Bc(0,ct,1,2,"g",0),2&t&&p.jc("ngForOf",e.series)("ngForTrackBy",e.trackByIndex)},directives:[a.l,jt],encapsulation:2,changeDetection:0}),t})(),Ct=(()=>{class t{constructor(){this.margin=2}ngOnInit(){}ngOnChanges(t){this.width=this.graphic.workspaceWidth-2*this.margin,this.height=this.graphic.workspaceHeight-2*this.margin,this.width<0&&(this.width=0),this.height<0&&(this.height=0)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-pane-back",""]],inputs:{margin:"margin",graphic:"graphic"},features:[p.zb],attrs:ht,decls:1,vars:4,consts:[[1,"bd2hm-dataBackground"]],template:function(t,e){1&t&&(p.cc(),p.Ob(0,"rect",0)),2&t&&p.Cb("x",e.margin)("y",e.margin)("width",e.width)("height",e.height)},encapsulation:2,changeDetection:0}),t})(),Nt=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-axis-box",""]],inputs:{graphic:"graphic"},attrs:lt,decls:1,vars:1,consts:[["class","bd2hm-axisWrapper",4,"ngIf"],[1,"bd2hm-axisWrapper"],["bd2hm-num-x-axis","",1,"xTopAxis",3,"top","xScale","yPosition","xDomain"],["bd2hm-num-x-axis","",1,"xBottomAxis",3,"top","xScale","yPosition","xDomain"],["bd2hm-y-axis","",1,"yLeftAxis",3,"left","yScale","xPosition"],["bd2hm-y-axis","",1,"yRightAxis",3,"left","yScale","xPosition"]],template:function(t,e){1&t&&p.Bc(0,bt,5,14,"g",0),2&t&&p.jc("ngIf",e.graphic)},directives:function(){return[a.m,_t,Ft]},encapsulation:2,changeDetection:0}),t})(),Ft=(()=>{class t{constructor(){this.left=!1}ngOnInit(){}ngOnChanges(t){var e;this.axisTransform=`translate(${this.xPosition},0)`,this.y2=null===(e=this.yScale)||void 0===e?void 0:e.range()[1]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-y-axis",""]],inputs:{left:"left",yScale:"yScale",xPosition:"xPosition"},features:[p.zb],attrs:dt,decls:2,vars:2,consts:[[1,"bd2hm-y-axis"],["x1","0","y1","0","x2","0"]],template:function(t,e){1&t&&(p.cc(),p.Tb(0,"g",0),p.Ob(1,"line",1),p.Sb()),2&t&&(p.Cb("transform",e.axisTransform),p.Bb(1),p.Cb("y2",e.y2))},encapsulation:2,changeDetection:0}),t})(),Ht=(()=>{class t{constructor(){this.length=5}ngOnInit(){this.calculatePositions()}ngOnChanges(t){this.calculatePositions()}calculatePositions(){var t,e,i;this.marky2=(null===(t=this.tick)||void 0===t?void 0:t.top)?-this.length:this.length,this.texty2=(null===(e=this.tick)||void 0===e?void 0:e.top)?-(this.length+4):this.length+4,this.textdy=(null===(i=this.tick)||void 0===i?void 0:i.top)?0:"0.6em"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-vtick-mark",""]],inputs:{length:"length",tick:"tick"},features:[p.zb],attrs:gt,decls:2,vars:2,consts:[["y1","0",4,"ngIf"],[4,"ngIf"],["y1","0"]],template:function(t,e){1&t&&(p.Bc(0,pt,1,3,"line",0),p.Bc(1,mt,2,4,"text",1)),2&t&&(p.jc("ngIf",e.tick),p.Bb(1),p.jc("ngIf",e.tick))},directives:[a.m],encapsulation:2}),t})(),_t=(()=>{class t{constructor(){this.top=!1,this.ticks=[]}trackByIndex(t,e){return t}ngOnInit(){}ngOnChanges(t){var e;this.axisTransform=`translate(0,${this.yPosition})`,this.x2=null===(e=this.xScale)||void 0===e?void 0:e.range()[1],this.ticks=this.prepareTicks(this.xScale)}prepareTicks(t){return this.calculateTicksPosition(t).map(e=>new St(t(e),0,e,this.top,!1))}calculateTicksPosition(t){if(!t)return[];const e=[],i=this.xDomain||t.domain(),a=Math.round(i[0]),n=Math.round(i[1]),s=this.domainStep(n-a);for(let o=a;o<=n;o+=s)e.push(o);return e}domainStep(t){return t<=25?4:t<=73?6:t<=169?12:24}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Hb({type:t,selectors:[["","bd2hm-num-x-axis",""]],inputs:{top:"top",xScale:"xScale",xDomain:"xDomain",yPosition:"yPosition"},features:[p.zb],attrs:ut,decls:3,vars:4,consts:[[1,"bd2hm-x-axis"],["x1","0","y1","0","y2","0"],["bd2hm-vtick-mark","","class","bd2hm-tickMark",3,"tick",4,"ngFor","ngForOf","ngForTrackBy"],["bd2hm-vtick-mark","",1,"bd2hm-tickMark",3,"tick"]],template:function(t,e){1&t&&(p.cc(),p.Tb(0,"g",0),p.Ob(1,"line",1),p.Bc(2,xt,1,1,"g",2),p.Sb()),2&t&&(p.Cb("transform",e.axisTransform),p.Bb(1),p.Cb("x2",e.x2),p.Bb(1),p.jc("ngForOf",e.ticks)("ngForTrackBy",e.trackByIndex))},directives:[a.l,Ht],encapsulation:2,changeDetection:0}),t})(),Et=(()=>{class t{}return t.\u0275mod=p.Lb({type:t}),t.\u0275inj=p.Kb({factory:function(e){return new(e||t)},imports:[[a.c]]}),t})(),Lt=(()=>{class t{}return t.\u0275mod=p.Lb({type:t}),t.\u0275inj=p.Kb({factory:function(e){return new(e||t)},imports:[[a.c,Et],Et]}),t})(),At=(()=>{class t{}return t.\u0275mod=p.Lb({type:t}),t.\u0275inj=p.Kb({factory:function(e){return new(e||t)},imports:[[a.c,Lt]]}),t})(),$t=(()=>{class t{}return t.\u0275mod=p.Lb({type:t}),t.\u0275inj=p.Kb({factory:function(e){return new(e||t)},imports:[[At]]}),t})(),Wt=(()=>{class t{constructor(){this.middleZero=!1}set traces(t){this.series=t}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p.Hb({type:t,selectors:[["bd2-heatmap-plot"]],inputs:{traces:"traces",middleZero:"middleZero"},decls:2,vars:2,consts:[[2,"text-align","center"],[3,"data","middleZero"]],template:function(t,e){1&t&&(p.Tb(0,"div",0),p.Ob(1,"bd2-num-heatmap",1),p.Sb()),2&t&&(p.Bb(1),p.jc("data",e.series)("middleZero",e.middleZero))},directives:[Pt],encapsulation:2}),t})();function Rt(t,e){if(1&t){const t=p.Ub();p.Tb(0,"div",6),p.Tb(1,"label",7),p.Tb(2,"a",8),p.Zb("click",(function(){return p.sc(t),p.dc(2).exportDataView()})),p.Tb(3,"i",9),p.Dc(4,"save_alt"),p.Sb(),p.Tb(5,"span",10),p.Dc(6,"Download"),p.Sb(),p.Sb(),p.Dc(7," current view "),p.Sb(),p.Tb(8,"label",7),p.Tb(9,"a",11),p.Zb("click",(function(){return p.sc(t),p.dc(2).exportFullData()})),p.Tb(10,"i",9),p.Dc(11,"save_alt"),p.Sb(),p.Tb(12,"span",10),p.Dc(13,"Download"),p.Sb(),p.Sb(),p.Dc(14," full "),p.Sb(),p.Sb()}}function Zt(t,e){if(1&t&&p.Ob(0,"bd2-heatmap-plot",12),2&t){const t=p.dc(2);p.jc("traces",t.timeseries)("middleZero",t.middleZero)}}function qt(t,e){if(1&t){const t=p.Ub();p.Tb(0,"div"),p.Tb(1,"h3"),p.Dc(2,"Data heatmap"),p.Sb(),p.Ob(3,"hr"),p.Tb(4,"bd2-heatmap-display-params-rform",1),p.Zb("displayParams",(function(e){return p.sc(t),p.dc().displayChanged(e)})),p.Sb(),p.Tb(5,"mat-expansion-panel"),p.Tb(6,"mat-expansion-panel-header"),p.Tb(7,"mat-panel-title"),p.Dc(8," Sorting "),p.Sb(),p.Sb(),p.Ob(9,"bd2-tssort-params-rform",2),p.ec(10,"async"),p.ec(11,"async"),p.Sb(),p.Ob(12,"hr"),p.Tb(13,"div",3),p.Bc(14,Rt,15,0,"div",4),p.Sb(),p.Ob(15,"hr"),p.Bc(16,Zt,1,2,"bd2-heatmap-plot",5),p.Sb()}if(2&t){const t=p.dc();p.Bb(4),p.jc("disabled",t.disabledSecondary)("totalTraces",t.totalTraces)("currentPage",t.currentPage),p.Bb(5),p.jc("ppaJobs",p.fc(10,7,t.analysis.ppaJobs$))("rhythmJobs",p.fc(11,9,t.analysis.rhythmJobs$)),p.Bb(5),p.jc("ngIf",t.timeseries),p.Bb(2),p.jc("ngIf",t.timeseries)}}const Vt=[{path:"",pathMatch:"full",component:(()=>{class t extends r.a{constructor(t,e,i,a,n){super(n),this.analysis=t,this.fetcher=e,this.RDMSocial=i,this.analytics=a,this.timeseries=[],this.totalTraces=0,this.currentPage=h.a.firstPage(),this.tracesPerPlot=5,this.middleZero=!1,this.blocked=!1,this.disabledSecondary=!1,this.csvExporter=new d.a,t.allowedPPAMethods=["NLLS","MESA"],e.addTraceNr=!0,e.addTraceRef=!1,this.titlePart=" Data"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(Object(c.a)(1e3)).subscribe(t=>{if(!this.assay)return;const e=t.data;this.currentParams=t.params,this.middleZero=this.isRangeSimetrical(t.params),this.timeseries=e,this.tracesPerPlot=Math.max(5,e.length/20),this.totalTraces=t.totalTraces,this.currentPage=t.currentPage,this.analytics.experimentHeatmapView(this.assay.id)},t=>{console.log("Error in TS subscription: "+t),this.feedback.error(t)}),this.fetcher.error$.subscribe(t=>this.feedback.error(t))}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}displayChanged(t){this.fetcher.changeDisplayParams(t)}exportDataView(){this.exportSeriesPack(this.fetcher.current)}exportFullData(){this.fetcher.getFullDataSet(this.assay,this.fetcher.current.params,this.fetcher.current.sorting).subscribe(t=>{this.exportSeriesPack(t,!0)})}exportSeriesPack(t,e=!1){if(!t)return;const i=this.csvExporter.renderCSVTable(t.data,t.params,t.currentPage,t.sorting,this.assay),a=new Blob([i],{type:"text/csv"});b.saveAs(a,`${this.assay.id}_data.${t.params.detrending.name}${e?".full":".page"+(t.currentPage.pageIndex+1)}.csv`),this.recordExport()}recordExport(){this.analytics.experimentDataExport(this.assay.id)}updateModel(t){super.updateModel(t),this.RDMSocial.canProceedByMeasurement(t).then(t=>{this.disabledSecondary=!t}),this.fetcher.experiment(t),this.analysis.experiment(t)}isRangeSimetrical(t){return"RANGE"===t.normalisation||"Z_SCORE"===t.normalisation||"MEAN"===t.align}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(g.a),p.Nb(l.a),p.Nb(m.a),p.Nb(u.a),p.Nb(x.a))},t.\u0275cmp=p.Hb({type:t,selectors:[["bd2-ts-heatmap-view"]],features:[p.Ab([l.a,g.a]),p.yb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams"],[3,"ppaJobs","rhythmJobs"],[1,"clearfix"],["class","float-right",4,"ngIf"],[3,"traces","middleZero",4,"ngIf"],[1,"float-right"],[1,"mr-4"],["download","","role","button","aria-label","download",1,"btn","btn-primary",2,"color","white",3,"click"],[1,"material-icons","bd-icon"],[1,"cdk-visually-hidden"],["download","","role","button","aria-label","download whole",1,"btn","btn-primary",2,"color","white",3,"click"],[3,"traces","middleZero"]],template:function(t,e){1&t&&p.Bc(0,qt,17,11,"div",0),2&t&&p.jc("ngIf",e.assay)},directives:[a.m,z,M.b,M.c,M.d,C.a,Wt],pipes:[a.b],encapsulation:2}),t})()}];let Gt=(()=>{class t{}return t.\u0275mod=p.Lb({type:t}),t.\u0275inj=p.Kb({factory:function(e){return new(e||t)},imports:[[o.f.forChild(Vt)],o.f]}),t})();var Ut=i("NFeN"),Yt=i("a6j2");let Jt=(()=>{class t{}return t.\u0275mod=p.Lb({type:t}),t.\u0275inj=p.Kb({factory:function(e){return new(e||t)},imports:[[a.c,n.y,n.k,s.c,Ut.b,O.b,S.b,M.a,$t,Yt.a,Gt]]}),t})()}}]);