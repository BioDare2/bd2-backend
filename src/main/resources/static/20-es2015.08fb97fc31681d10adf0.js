(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{yPAH:function(e,t,i){"use strict";i.r(t),i.d(t,"TsImportModule",(function(){return zt}));var s=i("ofXK"),a=i("3Pt+"),l=i("tyNb"),o=i("EvUs"),r=i("yYXI"),n=i("fXoL"),c=i("UsWK"),b=i("GVyA"),m=i("KhIM"),d=i("2Vo4"),u=i("XNiG"),h=i("itXk"),p=i("pLZG"),f=i("/uUt"),g=i("eIep"),S=i("Cfvw"),w=i("5+tZ"),D=i("lJxs"),T=i("M9IT");class B{constructor(e=new T.d,t=new T.d){this.rowPage=e,this.colPage=t}static firstPage(){const e=new B;return e.rowPage.pageIndex=0,e.rowPage.pageSize=50,e.colPage.pageIndex=0,e.colPage.pageSize=50,e}static pageEquals(e,t){return e.pageIndex===t.pageIndex&&e.pageSize===t.pageSize}equals(e){return!!e&&B.pageEquals(this.rowPage,e.rowPage)&&B.pageEquals(this.colPage,e.colPage)}}let C=(()=>{class e{constructor(e){this.BD2REST=e}uploadFile(e){const t=new FormData;return t.append("file",e,e.name),this.BD2REST.fileUpload(t).then(e=>e.id)}}return e.\u0275fac=function(t){return new(t||e)(n.Xb(c.a))},e.\u0275prov=n.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),v=(()=>{class e{constructor(e,t){this.uploadService=e,this.BD2REST=t}uploadFile(e,t){return Object(S.a)(this.uploadService.uploadFile(e)).pipe(Object(w.a)(e=>this.verifyFormat(t,e).pipe(Object(D.a)(t=>e))))}verifyFormat(e,t){return this.BD2REST.fileViewVerifyFormat(e,t)}getTableSlice(e,t,i){return this.BD2REST.fileViewTableSlice(e,t,i)}previewLabels(e,t,i,s){const a=new B;return s?(a.rowPage.pageSize=500,a.rowPage.pageIndex=0,a.colPage.pageSize=1,a.colPage.pageIndex=i.colIx):(a.rowPage.pageSize=1,a.rowPage.pageIndex=i.rowIx,a.colPage.pageSize=500,a.colPage.pageIndex=0),this.getTableSlice(e,t,a).pipe(Object(D.a)(e=>{const t=[];return e.data.forEach(e=>e.forEach(e=>t.push(""+e))),t}))}}return e.\u0275fac=function(t){return new(t||e)(n.Xb(C),n.Xb(c.a))},e.\u0275prov=n.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),k=(()=>{class e{constructor(e){this.tsFileService=e,this.tableSlice$=new d.a(void 0),this.slice$=new d.a(void 0),this.fileIdFormat$=new d.a(void 0),this.error$=new u.a,this.dataSlice$=this.tableSlice$.asObservable().pipe(Object(p.a)(e=>null!=e&&void 0!==e)),this.initDataStream()}close(){this.slice$.complete(),this.fileIdFormat$.complete(),this.tableSlice$.complete(),this.error$.complete()}slice(e){e&&this.slice$.next(e)}fileIdFormat(e){e&&e[0]&&e[1]&&this.fileIdFormat$.next(e)}sameParams([[e,t],i],[[s,a],l]){return e==s&&t==a&&i.equals(l)}initDataStream(){Object(h.a)([this.fileIdFormat$,this.slice$]).pipe(Object(p.a)(([e,t])=>e&&!!t),Object(f.a)(this.sameParams)).pipe(Object(g.a)(([e,t])=>this.tsFileService.getTableSlice(e[0],e[1],t))).subscribe(e=>this.tableSlice$.next(e),e=>this.error$.next(e))}}return e.\u0275fac=function(t){return new(t||e)(n.Xb(v))},e.\u0275prov=n.Jb({token:e,factory:e.\u0275fac}),e})();var I=i("6tuW"),N=i("xHqg"),y=i("Wp6s"),R=i("kmnG"),L=i("d3UM"),x=i("vLYz"),F=i("FKr1");function O(e,t){if(1&e&&(n.Tb(0,"mat-option",9),n.Dc(1),n.Sb()),2&e){const e=t.$implicit;n.jc("value",e),n.Bb(1),n.Ec(e.label)}}function j(e,t){1&e&&(n.Tb(0,"div",10),n.Dc(1," An Excel file in which one column contains time values while other columns contain measurements taken at the corresponding times. "),n.Tb(2,"ul"),n.Tb(3,"li"),n.Dc(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes from start, seconds from start, or as image nr (1-based) which will be converted to time using interval between images. "),n.Sb(),n.Tb(5,"li"),n.Dc(6," Not all columns have to be imported. "),n.Sb(),n.Tb(7,"li"),n.Dc(8," First few rows can contain arbitrary text. "),n.Sb(),n.Tb(9,"li"),n.Dc(10," Values from one row can be used as data labels. "),n.Sb(),n.Sb(),n.Sb())}function P(e,t){1&e&&(n.Tb(0,"div",10),n.Dc(1," A coma or tab separeted file in which one column or row contains time values while other columns or rows contain measurements taken at the corresponding times. "),n.Tb(2,"ul"),n.Tb(3,"li"),n.Dc(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes or seconds from start, or as image numbers "),n.Sb(),n.Tb(5,"li"),n.Dc(6," Not all columns/rows have to be imported. "),n.Sb(),n.Tb(7,"li"),n.Dc(8," First few rows/columns can contain arbitrary text. "),n.Sb(),n.Tb(9,"li"),n.Dc(10," Values from one row/column can be used as data labels. "),n.Sb(),n.Sb(),n.Sb())}function _(e,t){1&e&&(n.Tb(0,"div",10),n.Dc(1," Topcount data can be uploaded in two forms: "),n.Tb(2,"ul"),n.Tb(3,"li"),n.Dc(4,"Individual file which contains concatenated topcount data blocks in one file"),n.Sb(),n.Tb(5,"li"),n.Dc(6,"Zip file which contains packed files from individual topcount reads"),n.Sb(),n.Sb(),n.Dc(7,' Check the Dosc section for details about suported data layouts inside tomcats file, we can currently read ASCI content with "plate map" or "column" layouts. '),n.Sb())}function E(e,t){if(1&e&&(n.Tb(0,"div",11),n.Dc(1),n.Sb()),2&e){const e=n.dc();n.Bb(1),n.Fc(" ",e.formatWarning," ")}}let M=(()=>{class e{constructor(){this.blocked=!1,this.uploadFiles=new n.o,this.importFormatOptions=o.f,this.importFormat=o.e.EXCEL_TABLE}ngOnInit(){}upload(e){this.uploadFiles.next({files:e,importFormat:this.importFormat})}formatChanged(e){this.lastFiles&&this.checkFormat(this.lastFiles)}checkFormat(e){this.lastFiles=e,this.formatWarning=void 0,e.forEach(e=>{if(this.importFormat===o.e.TOPCOUNT){const t=this.isTopCount(e);t&&(this.formatWarning="The selected file does not seem to be a topcount file/archive but rather: "+t+". If you sure it is a valid topcount file/archive you can continue upload.")}else if(this.importFormat===o.e.EXCEL_TABLE){const t=this.isExcel(e);t&&(this.formatWarning="The selected file does not seem to be an excel file but rather: "+t+". If you sure it is a valid excel file you can continue upload.")}else if(this.importFormat===o.e.TAB_SEP){const t=this.isTab(e);t&&(this.formatWarning="The selected file does not seem to be a tab-separated file but rather: "+t+". If you sure it is a valid tsv file you can continue upload.")}else if(this.importFormat===o.e.COMA_SEP){const t=this.isComa(e);t&&(this.formatWarning="The selected file does not seem to be a coma-separated file but rather: "+t+". If you sure it is a valid csv file you can continue upload.")}})}isTopCount(e){let t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".tsv")?"tab separated":null):"Unknown"}isExcel(e){const t=e.type;return t&&e.name?e.name.endsWith(".csv")?"CSV":e.name.endsWith(".txt")?"text":e.name.endsWith(".tsv")?"tab separated":t.indexOf("excel")>=0||t.indexOf("sheet")>=0?null:t:"Unknown"}isTab(e){let t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".tsv")?null:"Unrecognized"):"Unknown"}isComa(e){let t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".tsv")?"tab separated":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".csv")?null:"Unrecognized"):"Unknown"}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-upload-data-file-step"]],outputs:{uploadFiles:"uploadFiles"},decls:19,vars:9,consts:[[1,"mat-elevation-z4"],[1,""],[1,"form-group"],["required","",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["dismissible","true","style","font-size: smaller;","type","info","class","alert alert-info","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"autoReset","blocked","multiple","selectedFiles","uploadFiles"],["uploadWidget",""],[3,"value"],["dismissible","true","type","info","role","alert",1,"alert","alert-info",2,"font-size","smaller"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(e,t){1&e&&(n.Tb(0,"div"),n.Tb(1,"mat-card",0),n.Tb(2,"mat-card-title"),n.Dc(3,"Time series file"),n.Sb(),n.Tb(4,"mat-card-content"),n.Tb(5,"form",1),n.Tb(6,"div",2),n.Tb(7,"mat-form-field"),n.Tb(8,"mat-label"),n.Dc(9,"File Format"),n.Sb(),n.Tb(10,"mat-select",3),n.Zb("valueChange",(function(e){return t.importFormat=e}))("selectionChange",(function(e){return t.formatChanged(e)})),n.Bc(11,O,2,2,"mat-option",4),n.Sb(),n.Sb(),n.Sb(),n.Bc(12,j,11,0,"div",5),n.Bc(13,P,11,0,"div",5),n.Bc(14,_,8,0,"div",5),n.Bc(15,E,2,1,"div",6),n.Tb(16,"div",2),n.Tb(17,"bd2-file-upload-widget",7,8),n.Zb("selectedFiles",(function(e){return t.checkFormat(e)}))("uploadFiles",(function(e){return t.upload(e)})),n.Sb(),n.Sb(),n.Sb(),n.Sb(),n.Sb(),n.Sb()),2&e&&(n.Bb(10),n.jc("value",t.importFormat),n.Bb(1),n.jc("ngForOf",t.importFormatOptions),n.Bb(1),n.jc("ngIf","EXCEL_TABLE"==t.importFormat.name),n.Bb(1),n.jc("ngIf","TAB_SEP"==t.importFormat.name||"COMA_SEP"==t.importFormat.name),n.Bb(1),n.jc("ngIf","TOPCOUNT"==t.importFormat.name),n.Bb(1),n.jc("ngIf",t.formatWarning),n.Bb(2),n.jc("autoReset",!1)("blocked",t.blocked||!t.importFormat)("multiple",!1))},directives:[y.a,y.e,y.c,a.D,a.r,a.s,R.c,R.g,L.a,s.l,s.m,x.a,F.o],encapsulation:2}),e})();var A=i("f0Cb");function U(e,t){if(1&e&&(n.Tb(0,"span"),n.Tb(1,"label"),n.Dc(2,"Images every"),n.Sb(),n.Dc(3),n.Sb()),2&e){const e=n.dc(2);n.Bb(3),n.Fc(" ",e.importDetails.imgInterval,"h ")}}function H(e,t){if(1&e&&(n.Tb(0,"span"),n.Tb(1,"label"),n.Dc(2,"Time offset"),n.Sb(),n.Dc(3),n.Sb()),2&e){const e=n.dc(2);n.Bb(3),n.Fc(" ",e.importDetails.timeOffset,"h ")}}function z(e,t){if(1&e&&(n.Tb(0,"p"),n.Tb(1,"label"),n.Dc(2,"First time point:"),n.Sb(),n.Tb(3,"strong"),n.Dc(4),n.Sb(),n.Bc(5,U,4,1,"span",1),n.Bc(6,H,4,1,"span",1),n.Sb()),2&e){const e=n.dc();n.Bb(4),n.Hc("",e.firstTimeCell.value," ",null==e.importDetails.timeType?null:e.importDetails.timeType.unit," [",e.firstTimeCell.colName+":"+e.firstTimeCell.rowName,"]"),n.Bb(1),n.jc("ngIf","IMG_NUMBER"===(null==e.importDetails.timeType?null:e.importDetails.timeType.name)),n.Bb(1),n.jc("ngIf",0!=e.importDetails.timeOffset)}}function Z(e,t){if(1&e&&(n.Tb(0,"p"),n.Dc(1),n.Tb(2,"strong"),n.Dc(3),n.Sb(),n.Sb()),2&e){const e=n.dc();n.Bb(1),n.Fc(" Labels in ",e.importDetails.inLabelNeg," "),n.Bb(2),n.Fc("",e.importDetails.inRows?e.labelsSelection.colName:e.labelsSelection.rowName,";")}}function W(e,t){if(1&e&&(n.Tb(0,"p"),n.Tb(1,"label"),n.Dc(2,"Selected Labels:"),n.Sb(),n.Dc(3),n.Sb()),2&e){const e=n.dc();n.Bb(3),n.Fc(" ",e.importDetails.summarizeLabels()," ")}}function G(e,t){if(1&e&&(n.Tb(0,"p"),n.Dc(1),n.Tb(2,"strong"),n.Dc(3),n.Sb(),n.Sb()),2&e){const e=n.dc();n.Bb(1),n.Fc(" Data starts in ",e.importDetails.inLabel," "),n.Bb(2),n.Fc("",e.importDetails.inRows?e.dataStart.rowName:e.dataStart.colName,";")}}function $(e,t){if(1&e&&(n.Tb(0,"p"),n.Dc(1),n.Sb()),2&e){const e=n.dc();n.Bb(1),n.Fc(" Background noise as: ",e.importDetails.backgroundsLabels.join(", ")," ")}}let K=(()=>{class e{constructor(){this.showTime=!1,this.showLabelling=!1,this.showDataStart=!1}get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-import-details-summary"]],inputs:{importDetails:"importDetails",showTime:"showTime",showLabelling:"showLabelling",showDataStart:"showDataStart"},decls:13,vars:8,consts:[[1,"mat-elevation-z4"],[4,"ngIf"]],template:function(e,t){1&e&&(n.Tb(0,"mat-card",0),n.Tb(1,"p"),n.Dc(2),n.Tb(3,"strong"),n.Dc(4),n.Sb(),n.Sb(),n.Tb(5,"p"),n.Tb(6,"label"),n.Dc(7),n.Sb(),n.Sb(),n.Bc(8,z,7,5,"p",1),n.Bc(9,Z,4,2,"p",1),n.Bc(10,W,4,1,"p",1),n.Bc(11,G,4,2,"p",1),n.Bc(12,$,2,1,"p",1),n.Sb()),2&e&&(n.Bb(2),n.Fc("",null==t.importDetails||null==t.importDetails.importFormat?null:t.importDetails.importFormat.label,": "),n.Bb(2),n.Ec(null==t.importDetails?null:t.importDetails.fileName),n.Bb(3),n.Fc("Time series in ",(null==t.importDetails?null:t.importDetails.inLabel)+"s",""),n.Bb(1),n.jc("ngIf",t.showTime&&t.firstTimeCell),n.Bb(1),n.jc("ngIf",t.showLabelling&&t.importDetails.importLabels&&t.labelsSelection),n.Bb(1),n.jc("ngIf",t.showLabelling&&!t.importDetails.importLabels),n.Bb(1),n.jc("ngIf",t.showDataStart&&t.importDetails.importLabels&&t.dataStart),n.Bb(1),n.jc("ngIf",t.showLabelling&&t.importDetails.containsBackgrounds&&t.importDetails.backgroundsLabels))},directives:[y.a,s.m],encapsulation:2}),e})();var q=i("QibW"),Q=i("bTqV");class V{constructor(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}reset(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}setRowBackground(e,t){this.rowsBackgrounds[e]=t}rowBackground(e){return this.getOrEmptyString(this.rowsBackgrounds,e)}colBackground(e){return this.getOrEmptyString(this.colsBackgrounds,e)}setColBackground(e,t){this.colsBackgrounds[e]=t}cellBackground(e,t){return this.getOrEmptyString(this.getOrDefault(this.cellBackgrounds,t,[]),e)||this.colBackground(e)}setCellBackground(e,t,i){let s=this.cellBackgrounds[t];void 0===s&&(s=[],this.cellBackgrounds[t]=s),s[e]=i}getOrEmptyString(e,t){return this.getOrDefault(e,t,"")}getOrDefault(e,t,i){return t>=e.length||void 0===e[t]?i:e[t]}}let X=(()=>{class e{rowBackground(t){return e.MAIN_ROW_BACKGROUND}cellBackground(t){return e.MAIN_CELL_BACKGROUND}columnBackground(t){return e.MAIN_COL_BACKGROUND}}return e.MAIN_ROW_BACKGROUND="#dda0dd",e.MAIN_COL_BACKGROUND="#87cefa",e.MAIN_CELL_BACKGROUND="#ba55d3",e.TIME_BACKGROUND="#dda0dd",e.LABELS_BACKGROUND="#87cefa",e.FIRST_TIME_BACKGROUND="#ba55d3",e.FIST_DATA_BACKGROUND="lightgreen",e})();class J{constructor(e,t){this.tableStyler=e,this.colorCycler=t,this.selectedRows=[],this.selectedCols=[],this.tableStyler=e||new V,this.colorCycler=t||new X}toggleRow(e,t=!1,i,s){const a=this.selectedRows.splice(0,this.selectedRows.length);this.selectedRows.push(e),this.uncolorRows(a),this.colorRows(this.selectedRows,i),t&&(this.uncolorCells(a),this.colorCells(this.selectedRows,s))}toggleRowSelection(e,t,i=!1,s,a){const l=this.selectedRows[e]?[this.selectedRows[e]]:[];this.selectedRows[e]=t,this.uncolorRows(l),this.colorRows([this.selectedRows[e]],s),i&&(this.uncolorCells(l),this.colorCells([this.selectedRows[e]],a))}selectRow(e,t){const i=new o.a(-1,-1,void 0,e,e,void 0,void 0),s=this.selectedRows.findIndex(t=>t.rowNumber===e);s<0?this.selectedRows.push(i):this.selectedRows[s]=i,this.colorRows([i],t)}deselectRow(e){const t=this.selectedRows.findIndex(t=>t.rowNumber===e);t>=0&&(this.selectedRows[t]=void 0);const i=new o.a(-1,-1,void 0,e,e,void 0,void 0);this.uncolorRows([i])}toggleCol(e,t=!1,i,s){const a=this.selectedCols.splice(0,this.selectedCols.length);this.selectedCols.push(e),this.uncolorCols(a),this.colorCols(this.selectedCols,i),t&&(this.uncolorCells(a),this.colorCells(this.selectedCols,s))}toggleColSelection(e,t,i=!1,s,a){const l=this.selectedCols[e]?[this.selectedCols[e]]:[];this.selectedCols[e]=t,this.uncolorCols(l),this.colorCols([this.selectedCols[e]],s),i&&(this.uncolorCells(l),this.colorCells([this.selectedCols[e]],a))}selectCol(e,t){const i=new o.a(e,e,void 0,-1,-1,void 0,void 0),s=this.selectedCols.findIndex(t=>t.colNumber===e);s<0?this.selectedCols.push(i):this.selectedCols[s]=i,this.colorCols([i],t)}deselectCol(e){const t=this.selectedCols.findIndex(t=>t.colNumber===e);t>=0&&(this.selectedCols[t]=void 0);const i=new o.a(e,e,void 0,-1,-1,void 0,void 0);this.uncolorCols([i])}reset(){this.selectedRows=[],this.selectedCols=[],this.tableStyler.reset()}colorRows(e,t){e.forEach((e,i)=>{this.tableStyler.setRowBackground(e.rowNumber,t||this.colorCycler.rowBackground(i))})}colorCols(e,t){e.forEach((e,i)=>{this.tableStyler.setColBackground(e.colNumber,t||this.colorCycler.columnBackground(i))})}colorCells(e,t){e.forEach((e,i)=>{this.tableStyler.setCellBackground(e.colNumber,e.rowNumber,t||this.colorCycler.cellBackground(i))})}uncolorRows(e){e.forEach(e=>{this.tableStyler.setRowBackground(e.rowNumber,void 0)})}uncolorCols(e){e.forEach(e=>{this.tableStyler.setColBackground(e.colNumber,void 0)})}uncolorCells(e){e.forEach(e=>{this.tableStyler.setCellBackground(e.colNumber,e.rowNumber,void 0)})}}let Y=(()=>{class e{constructor(){this.index=0,this.labelsIndexes=new Map}toColor(t){if(!t)return;this.labelsIndexes.has(t)||this.labelsIndexes.set(t,this.index++);const i=this.labelsIndexes.get(t)%e.colors.length;return e.colors[i]}setColor(e){}}return e.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"],e})(),ee=(()=>{class e{constructor(e,t){this.dataService=e,this.feedback=t,this.tableSelector=new J,this.lastColumnSeen=0,this.lastRowSeen=0,this.firstPageSlice=B.firstPage(),this.currentPageSlice=B.firstPage()}get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}ngOnInit(){this.dataService.error$.forEach(e=>this.feedback.error(e)),this.dataSubscription=this.dataService.dataSlice$.subscribe(e=>this.setDataSlice(e),e=>this.feedback.error(e))}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe()}colNumber(e){return e<0?-1:this.dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this.dataSlice.rowsNumbers[e]}setDataSlice(e){this.dataSlice=e,this.lastColumnSeen=Math.max(this.lastColumnSeen,e.columnsNumbers[e.columnsNumbers.length-1]),this.lastRowSeen=Math.max(this.lastRowSeen,e.rowsNumbers[e.rowsNumbers.length-1]),this.currentPageSlice=new B(e.rowPage,e.colPage),this.applySelection()}loadData(){this.importDetails&&(this.lastColumnSeen=0,this.lastRowSeen=0,this.dataService.fileIdFormat([this.importDetails.fileId,this.importDetails.importFormat.name]),this.dataService.slice(this.firstPageSlice)),this.dataSlice&&this.applySelection()}applySelection(){this.tableSelector.reset(),this.markSelections(),this.applyDefaultSelections()}applyDefaultSelections(){}markSelections(){}selectFirstTime(e){this.importDetails.firstTimeCell=e,this.markFirstTime()}markFirstTime(){const e=this.firstTimeCell;e&&(this.importDetails.inRows?this.tableSelector.toggleRow(e,!0,X.TIME_BACKGROUND,X.FIRST_TIME_BACKGROUND):this.tableSelector.toggleCol(e,!0,X.TIME_BACKGROUND,X.FIRST_TIME_BACKGROUND))}selectLabels(e){this.importDetails.labelsSelection=e,this.markLabels()}markLabels(){const e=this.labelsSelection;e&&(this.importDetails.inRows?this.tableSelector.toggleCol(e,!1,X.LABELS_BACKGROUND):this.tableSelector.toggleRow(e,!1,X.LABELS_BACKGROUND))}selectDataStart(e){e?this.importDetails.inRows?this.firstTimeCell&&this.firstTimeCell.rowIx===e.rowIx||(this.importDetails.dataStart=e):this.firstTimeCell&&this.firstTimeCell.colIx===e.colIx||(this.importDetails.dataStart=e):this.importDetails.dataStart=void 0,this.markDataStart()}markDataStart(){const e=this.dataStart;e&&(this.importDetails.inRows?this.tableSelector.toggleRowSelection(1,e,!1,X.FIST_DATA_BACKGROUND):this.tableSelector.toggleColSelection(1,e,!1,X.FIST_DATA_BACKGROUND))}reselect(e){if(!this.dataSlice||!e)return;const t=this.dataSlice,i=e.colIx,s=e.rowIx;if(i>=t.columnsNumbers.length)return;if(s>=t.rowsNumbers.length)return;const a=new o.a(i,t.columnsNumbers[i],t.columnsNames[i],s,t.rowsNumbers[s],t.rowsNames[s],(s>=0?t.data[s]:[])[i]);return a.fake=e.fake,a}hasMoreTimes(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns:this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows)}hasMoreLabels(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows:this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns)}}return e.\u0275fac=function(t){return new(t||e)(n.Nb(k),n.Nb(I.a))},e.\u0275dir=n.Ib({type:e}),e})();var te=i("+0xr");const ie=["table"];function se(e,t){1&e&&n.Ob(0,"th",10)}function ae(e,t){if(1&e){const e=n.Ub();n.Tb(0,"td",11),n.Zb("click",(function(){n.sc(e);const i=t.index;return n.dc(2).selectCell(-1,i)})),n.Tb(1,"label"),n.Dc(2),n.Sb(),n.Sb()}if(2&e){const e=t.index,i=n.dc(2);n.Bb(2),n.Ec(i.rowsNames[e])}}function le(e,t){if(1&e){const e=n.Ub();n.Tb(0,"th",15),n.Zb("click",(function(){n.sc(e);const t=n.dc().index;return n.dc(2).selectCell(t,-1)})),n.Dc(1),n.Sb()}if(2&e){const e=n.dc(),t=e.index,i=e.$implicit,s=n.dc(2);n.yc("background-color",s.colBackground(t)),n.Bb(1),n.Fc(" ",i," ")}}function oe(e,t){if(1&e){const e=n.Ub();n.Tb(0,"td",16),n.Zb("click",(function(){n.sc(e);const i=t.index,s=n.dc().index;return n.dc(2).selectCell(s,i)})),n.Dc(1),n.Sb()}if(2&e){const e=t.$implicit,i=t.index,s=n.dc().index,a=n.dc(2);n.yc("background-color",a.cellBackground(s,i)),n.Bb(1),n.Fc(" ",e[s]," ")}}function re(e,t){1&e&&(n.Rb(0,12),n.Bc(1,le,2,3,"th",13),n.Bc(2,oe,2,3,"td",14),n.Qb()),2&e&&n.jc("matColumnDef",t.$implicit)}function ne(e,t){1&e&&n.Ob(0,"tr",17)}function ce(e,t){if(1&e&&n.Ob(0,"tr",18),2&e){const e=t.index,i=n.dc(2);n.yc("background-color",i.rowBackground(e))}}function be(e,t){if(1&e&&(n.Tb(0,"div",1),n.Tb(1,"table",2,3),n.Rb(3,4),n.Bc(4,se,1,0,"th",5),n.Bc(5,ae,3,1,"td",6),n.Qb(),n.Bc(6,re,3,1,"ng-container",7),n.Bc(7,ne,1,0,"tr",8),n.Bc(8,ce,1,2,"tr",9),n.Sb(),n.Sb()),2&e){const e=n.dc();n.Bb(1),n.jc("dataSource",e.data),n.Bb(5),n.jc("ngForOf",e.columnsNames),n.Bb(1),n.jc("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),n.Bb(1),n.jc("matRowDefColumns",e.displayedColumns)}}let me=(()=>{class e{constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.styler=new V,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.selected=new n.o}set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.displayedColumns=["rowNr"].concat(this.columnsNames),this.data=e.data,this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}ngOnInit(){}selectCell(e,t){if(e<0&&!this.selectableRowHeader)return;if(t<0&&!this.selectableColHeader)return;const i=new o.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selected.next(i)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-data-sheet-mdtable"]],viewQuery:function(e,t){var i;1&e&&n.Ic(ie,!0),2&e&&n.pc(i=n.ac())&&(t.matTable=i.first)},inputs:{dataSlice:"dataSlice",styler:"styler",selectableColHeader:"selectableColHeader",selectableRowHeader:"selectableRowHeader"},outputs:{selected:"selected"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color","click",4,"matHeaderCellDef"],["mat-cell","","matRipple","","matRippleCentered","true",3,"background-color","click",4,"matCellDef"],["mat-header-cell","",3,"click"],["mat-cell","","matRipple","","matRippleCentered","true",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&n.Bc(0,be,9,5,"div",0),2&e&&n.jc("ngIf",t.dataSlice)},directives:[s.m,te.n,te.c,te.i,te.b,s.l,te.k,te.m,te.h,te.a,F.r,te.j,te.l],styles:[".data-sheet-container[_ngcontent-%COMP%] {\n      max-height: 300px;\n      overflow: auto;\n    }\n\n    .mat-table-sticky[_ngcontent-%COMP%]:first-child {\n      border-right: 1px solid #e0e0e0;\n      padding-right: 1em;\n    }\n\n\n    .mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%] {\n      padding-left: 0.5em;\n      padding-right: 0.5em;\n    }\n\n    label[_ngcontent-%COMP%] {\n      color: rgba(0,0,0,0.54);\n    }"]}),e})();var de=i("qFsG");function ue(e,t){if(1&e&&(n.Tb(0,"mat-option",9),n.Dc(1),n.Sb()),2&e){const e=t.$implicit;n.jc("value",e),n.Bb(1),n.Ec(e.label)}}function he(e,t){if(1&e){const e=n.Ub();n.Tb(0,"p"),n.Tb(1,"mat-form-field"),n.Tb(2,"input",10),n.Zb("ngModelChange",(function(t){return n.sc(e),n.dc(3).importDetails.imgInterval=t})),n.Sb(),n.Sb(),n.Sb()}if(2&e){const e=n.dc(3);n.Bb(2),n.jc("ngModel",e.importDetails.imgInterval)}}function pe(e,t){if(1&e&&(n.Tb(0,"div",11),n.Dc(1),n.Sb()),2&e){const e=n.dc(3);n.Bb(1),n.Fc(" The first time point value ",e.firstTimeCell.value," does not look like a number; ")}}function fe(e,t){if(1&e){const e=n.Ub();n.Tb(0,"div"),n.Tb(1,"p"),n.Dc(2),n.Tb(3,"strong"),n.Dc(4),n.Sb(),n.Dc(5,"\xa0 First time point: "),n.Tb(6,"strong"),n.Dc(7),n.Sb(),n.Dc(8),n.Sb(),n.Tb(9,"p"),n.Tb(10,"mat-form-field"),n.Tb(11,"mat-label"),n.Dc(12,"Time unit"),n.Sb(),n.Tb(13,"mat-select",5),n.Zb("valueChange",(function(t){return n.sc(e),n.dc(2).importDetails.timeType=t})),n.Bc(14,ue,2,2,"mat-option",6),n.Sb(),n.Sb(),n.Sb(),n.Tb(15,"p"),n.Tb(16,"mat-form-field"),n.Tb(17,"input",7),n.Zb("ngModelChange",(function(t){return n.sc(e),n.dc(2).importDetails.timeOffset=t})),n.Sb(),n.Sb(),n.Sb(),n.Bc(18,he,3,1,"p",2),n.Bc(19,pe,2,1,"div",8),n.Sb()}if(2&e){const e=n.dc(2);n.Bb(2),n.Fc("Times in ",e.importDetails.inLabel," "),n.Bb(2),n.Fc("",e.importDetails.inRows?e.firstTimeCell.rowName:e.firstTimeCell.colName,";"),n.Bb(3),n.Gc("",e.firstTimeCell.value," ",null==e.importDetails.timeType?null:e.importDetails.timeType.unit,""),n.Bb(1),n.Fc(" [",e.firstTimeCell.colName+":"+e.firstTimeCell.rowName,"] "),n.Bb(5),n.jc("value",e.importDetails.timeType),n.Bb(1),n.jc("ngForOf",e.timeTypeOptions),n.Bb(3),n.jc("ngModel",e.importDetails.timeOffset),n.Bb(1),n.jc("ngIf","IMG_NUMBER"==(null==e.importDetails.timeType?null:e.importDetails.timeType.name)),n.Bb(1),n.jc("ngIf",e.firstTimeNotNumber())}}function ge(e,t){if(1&e&&(n.Tb(0,"div",12),n.Dc(1),n.Sb()),2&e){const e=n.dc(2);n.Bb(1),n.Fc(" Even if only the top part of the data table is presented all times from the selected ",e.importDetails.inLabel," will be imported ")}}function Se(e,t){if(1&e){const e=n.Ub();n.Tb(0,"mat-card",1),n.Tb(1,"mat-card-content"),n.Bc(2,fe,20,10,"div",2),n.Tb(3,"div"),n.Tb(4,"div"),n.Dc(5),n.Sb(),n.Sb(),n.Tb(6,"bd2-data-sheet-mdtable",3),n.Zb("selected",(function(t){return n.sc(e),n.dc().selectFirstTime(t)})),n.Sb(),n.Bc(7,ge,2,1,"div",4),n.Sb(),n.Sb()}if(2&e){const e=n.dc();n.Bb(2),n.jc("ngIf",e.firstTimeCell),n.Bb(2),n.Db(e.firstTimeCell?"alert alert-info":"alert alert-danger"),n.Bb(1),n.Fc(" Click on the first timepoint in the time ",e.importDetails.inLabel," and then select a time unit. "),n.Bb(1),n.jc("dataSlice",e.dataSlice)("styler",e.tableSelector.tableStyler),n.Bb(1),n.jc("ngIf",e.hasMoreTimes())}}let we=(()=>{class e extends ee{constructor(e,t){super(e,t),this.timeTypeOptions=[m.h.TIME_IN_HOURS,m.h.TIME_IN_MINUTES,m.h.TIME_IN_SECONDS,m.h.IMG_NUMBER]}applyDefaultSelections(){if(super.applyDefaultSelections(),this.firstTimeCell&&!this.firstTimeCell.fake)this.selectFirstTime(this.reselect(this.firstTimeCell));else{let e=this.importDetails.inRows?new o.a(1,this.colNumber(1),void 0,0,this.rowNumber(0),void 0,void 0):new o.a(0,this.colNumber(0),void 0,1,this.rowNumber(1),void 0,void 0);e=this.reselect(e),e.fake=!0,this.selectFirstTime(e)}}firstTimeNotNumber(){return!!this.firstTimeCell&&isNaN(Number(this.firstTimeCell.value))}}return e.\u0275fac=function(t){return new(t||e)(n.Nb(k),n.Nb(I.a))},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-define-time-step"]],inputs:{importDetails:"importDetails"},features:[n.yb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["required","",3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","placeholder","Time offset",3,"ngModel","ngModelChange"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"value"],["matInput","","type","number","placeholder","Images interval (hours)","required","",3,"ngModel","ngModelChange"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(e,t){1&e&&n.Bc(0,Se,8,7,"mat-card",0),2&e&&n.jc("ngIf",t.importDetails)},directives:[s.m,y.a,y.c,me,R.c,R.g,L.a,s.l,de.b,a.v,a.d,a.q,a.t,F.o,a.z],encapsulation:2}),e})();var De=i("0IaG");let Te=(()=>{class e{constructor(e,t){this.dialogRef=e,this.data=t}ngOnInit(){}sendLabel(){this.dialogRef.close(this.data.label)}}return e.\u0275fac=function(t){return new(t||e)(n.Nb(De.g),n.Nb(De.a))},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-edit-label-dialog"]],decls:20,vars:6,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","cdkFocusInitial","",3,"ngModel","ngModelChange","keydown.enter"],["align","start"],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-raised-button","","color","primary",3,"mat-dialog-close"],["ok",""]],template:function(e,t){1&e&&(n.Tb(0,"h1",0),n.Dc(1),n.Sb(),n.Tb(2,"div",1),n.Tb(3,"p"),n.Dc(4),n.Sb(),n.Tb(5,"mat-form-field"),n.Tb(6,"input",2),n.Zb("ngModelChange",(function(e){return t.data.label=e}))("keydown.enter",(function(){return t.sendLabel()})),n.Sb(),n.Tb(7,"mat-hint",3),n.Dc(8,"Pressing "),n.Tb(9,"strong"),n.Dc(10,"Enter"),n.Sb(),n.Dc(11," submits "),n.Sb(),n.Sb(),n.Sb(),n.Tb(12,"div",4),n.Tb(13,"button",5),n.Dc(14,"Cancel"),n.Sb(),n.Tb(15,"button",5),n.Dc(16,"Clear"),n.Sb(),n.Tb(17,"button",6,7),n.Dc(19,"Assign"),n.Sb(),n.Sb()),2&e&&(n.Bb(1),n.Ec(t.data.title),n.Bb(3),n.Fc("Write label for ",t.data.regionName,""),n.Bb(2),n.jc("ngModel",t.data.label),n.Bb(7),n.jc("mat-dialog-close",void 0),n.Bb(2),n.jc("mat-dialog-close",""),n.Bb(2),n.jc("mat-dialog-close",t.data.label))},directives:[De.h,De.e,R.c,de.b,a.d,a.q,a.t,R.f,De.c,Q.a,De.d],encapsulation:2}),e})();const Be=["table"];function Ce(e,t){1&e&&n.Ob(0,"th",20)}function ve(e,t){if(1&e){const e=n.Ub();n.Tb(0,"td",21),n.Zb("mousedown",(function(){n.sc(e);const i=t.index;return n.dc(2).startSelectCell(-1,i)}))("mouseup",(function(){n.sc(e);const i=t.index;return n.dc(2).endSelectCell(-1,i)})),n.Tb(1,"label"),n.Dc(2),n.Sb(),n.Sb()}if(2&e){const e=t.index,i=n.dc(2);n.Bb(2),n.Ec(i.rowsNames[e])}}function ke(e,t){if(1&e){const e=n.Ub();n.Tb(0,"td",22),n.Zb("click",(function(){return n.sc(e),n.dc(2).nextRow()})),n.Dc(1),n.Sb()}if(2&e){const e=n.dc(2);n.Bb(1),n.Ec(e.hasMoreRows?"...":"end")}}function Ie(e,t){1&e&&(n.Tb(0,"th",20),n.Dc(1,"Labels"),n.Sb())}function Ne(e,t){if(1&e){const e=n.Ub();n.Tb(0,"td",21),n.Zb("mousedown",(function(){n.sc(e);const i=t.index;return n.dc(2).startSelectCell(-1,i)}))("mouseup",(function(){n.sc(e);const i=t.index;return n.dc(2).endSelectCell(-1,i)})),n.Tb(1,"label",23),n.Dc(2),n.Sb(),n.Sb()}if(2&e){const e=t.index,i=n.dc(2);n.Bb(2),n.Ec(i.rowsLabels[e])}}function ye(e,t){if(1&e){const e=n.Ub();n.Tb(0,"td",22),n.Zb("click",(function(){return n.sc(e),n.dc(2).nextRow()})),n.Sb()}}function Re(e,t){if(1&e){const e=n.Ub();n.Tb(0,"th",27),n.Zb("mousedown",(function(){n.sc(e);const t=n.dc().index;return n.dc(2).startSelectCell(t,-1)}))("mouseup",(function(){n.sc(e);const t=n.dc().index;return n.dc(2).endSelectCell(t,-1)})),n.Dc(1),n.Sb()}if(2&e){const e=n.dc(),t=e.index,i=e.$implicit,s=n.dc(2);n.yc("background-color",s.colBackground(t)),n.Bb(1),n.Fc(" ",i," ")}}function Le(e,t){if(1&e&&(n.Tb(0,"td",28),n.Dc(1),n.Sb()),2&e){const e=t.$implicit,i=t.index,s=n.dc().index,a=n.dc(2);n.yc("background-color",a.cellBackground(s,i)),n.Bb(1),n.Fc(" ",e[s]," ")}}function xe(e,t){if(1&e){const e=n.Ub();n.Tb(0,"td",22),n.Zb("click",(function(){return n.sc(e),n.dc(3).nextRow()})),n.Dc(1),n.Sb()}if(2&e){const e=n.dc(3);n.Bb(1),n.Ec(e.hasMoreRows?"...":"")}}function Fe(e,t){1&e&&(n.Rb(0,24),n.Bc(1,Re,2,3,"th",25),n.Bc(2,Le,2,3,"td",26),n.Bc(3,xe,2,1,"td",7),n.Qb()),2&e&&n.jc("matColumnDef",t.$implicit)}function Oe(e,t){if(1&e){const e=n.Ub();n.Tb(0,"th",29),n.Zb("click",(function(){return n.sc(e),n.dc(2).nextColumn()})),n.Dc(1,"..."),n.Sb()}}function je(e,t){if(1&e){const e=n.Ub();n.Tb(0,"td",30),n.Zb("click",(function(){return n.sc(e),n.dc(2).nextColumn()})),n.Dc(1,"..."),n.Sb()}}function Pe(e,t){1&e&&n.Ob(0,"td",31)}function _e(e,t){1&e&&(n.Tb(0,"th",20),n.Dc(1,"Labels"),n.Sb())}function Ee(e,t){1&e&&n.Ob(0,"th",20)}function Me(e,t){if(1&e){const e=n.Ub();n.Tb(0,"th",27),n.Zb("mousedown",(function(){n.sc(e);const t=n.dc().index;return n.dc(3).startSelectCell(t,-1)}))("mouseup",(function(){n.sc(e);const t=n.dc().index;return n.dc(3).endSelectCell(t,-1)})),n.Tb(1,"label",23),n.Dc(2),n.Sb(),n.Sb()}if(2&e){const e=n.dc().index,t=n.dc(3);n.yc("background-color",t.colBackground(e)),n.Bb(2),n.Ec(t.columnsLabels[e])}}function Ae(e,t){1&e&&(n.Rb(0,24),n.Bc(1,Me,3,3,"th",25),n.Qb()),2&e&&n.jc("matColumnDef","label"+t.index)}function Ue(e,t){if(1&e&&(n.Rb(0),n.Bc(1,Ae,2,1,"ng-container",9),n.Qb()),2&e){const e=n.dc(2);n.Bb(1),n.jc("ngForOf",e.columnsNames)}}function He(e,t){1&e&&n.Ob(0,"tr",32)}function ze(e,t){1&e&&n.Ob(0,"tr",32)}function Ze(e,t){if(1&e&&(n.Rb(0),n.Bc(1,ze,1,0,"tr",17),n.Qb()),2&e){const e=n.dc(2);n.Bb(1),n.jc("matHeaderRowDef",e.displayedLabelsColumns)("matHeaderRowDefSticky",!0)}}function We(e,t){if(1&e&&n.Ob(0,"tr",33),2&e){const e=t.index,i=n.dc(2);n.yc("background-color",i.rowBackground(e))}}function Ge(e,t){1&e&&n.Ob(0,"tr",34)}function $e(e,t){if(1&e&&(n.Tb(0,"div",1),n.Tb(1,"table",2,3),n.Rb(3,4),n.Bc(4,Ce,1,0,"th",5),n.Bc(5,ve,3,1,"td",6),n.Bc(6,ke,2,1,"td",7),n.Qb(),n.Rb(7,8),n.Bc(8,Ie,2,0,"th",5),n.Bc(9,Ne,3,1,"td",6),n.Bc(10,ye,1,0,"td",7),n.Qb(),n.Bc(11,Fe,4,1,"ng-container",9),n.Rb(12,10),n.Bc(13,Oe,2,0,"th",11),n.Bc(14,je,2,0,"td",12),n.Bc(15,Pe,1,0,"td",13),n.Qb(),n.Rb(16,14),n.Bc(17,_e,2,0,"th",5),n.Qb(),n.Rb(18,15),n.Bc(19,Ee,1,0,"th",5),n.Qb(),n.Bc(20,Ue,2,1,"ng-container",16),n.Bc(21,He,1,0,"tr",17),n.Bc(22,Ze,2,2,"ng-container",16),n.Bc(23,We,1,2,"tr",18),n.Bc(24,Ge,1,0,"tr",19),n.Sb(),n.Sb()),2&e){const e=n.dc();n.Bb(1),n.jc("dataSource",e.data),n.Bb(10),n.jc("ngForOf",e.columnsNames),n.Bb(9),n.jc("ngIf",e.showColumnsLabels),n.Bb(1),n.jc("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),n.Bb(1),n.jc("ngIf",e.showColumnsLabels),n.Bb(1),n.jc("matRowDefColumns",e.displayedColumns),n.Bb(1),n.jc("matFooterRowDef",e.displayedColumns)}}let Ke=(()=>{class e{constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.hasMoreColumns=!1,this.hasMoreRows=!1,this._columnsLabels=[],this._rowsLabels=[],this.styler=new V,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.showColumnsLabels=!1,this.showRowsLabels=!1,this.selected=new n.o,this.moreRows=new n.o,this.moreColumns=new n.o}set columnsLabels(e){this._columnsLabels=e}get columnsLabels(){return this._columnsLabels}set rowsLabels(e){this._rowsLabels=e}get rowsLabels(){return this._rowsLabels}set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.data=e.data,this.hasMoreColumns=e.columnsNumbers[e.columnsNumbers.length-1]<e.totalColumns-1,this.hasMoreRows=e.rowsNumbers[e.rowsNumbers.length-1]<e.totalRows-1,this.decideColumns(),this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}set selectRows(e){this.selectableRowHeader=e,this.showRowsLabels=e,this.decideColumns()}set selectCols(e){this.selectableColHeader=e,this.showColumnsLabels=e,this.decideColumns()}decideColumns(){this.displayedColumns=(this.showRowsLabels?["rowNr","rowLabel"]:["rowNr"]).concat(this.columnsNames),this.displayedLabelsColumns=(this.showRowsLabels?["rowNr2","rowLabel2"]:["rowNr2"]).concat(this.columnsNames.map((e,t)=>"label"+t)),this.hasMoreColumns&&(this.displayedColumns.push("more"),this.displayedLabelsColumns.push("more"))}ngOnInit(){}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}startSelectCell(e,t){if(e<0&&!this.selectableRowHeader)return;if(t<0&&!this.selectableColHeader)return;const i=new o.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selectionStart=i}endSelectCell(e,t){if(!this.selectionStart)return;if(t<0&&this.selectionStart.rowIx>=0)return void(this.selectionStart=void 0);if(e<0&&this.selectionStart.colIx>=0)return void(this.selectionStart=void 0);if(e<0&&!this.selectableRowHeader)return;if(t<0&&!this.selectableColHeader)return;const i=new o.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selected.next([this.selectionStart,i])}nextColumn(){this.moreColumns.next(!0)}nextRow(){this.moreRows.next(!0)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-selectable-region-mdtable"]],viewQuery:function(e,t){var i;1&e&&n.Ic(Be,!0),2&e&&n.pc(i=n.ac())&&(t.matTable=i.first)},inputs:{columnsLabels:"columnsLabels",rowsLabels:"rowsLabels",dataSlice:"dataSlice",selectRows:"selectRows",selectCols:"selectCols",styler:"styler"},outputs:{selected:"selected",moreRows:"moreRows",moreColumns:"moreColumns"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"mousedown","mouseup",4,"matCellDef"],["mat-footer-cell","",3,"click",4,"matFooterCellDef"],["matColumnDef","rowLabel","sticky",""],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","more","sticky",""],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","rowNr2","sticky",""],["matColumnDef","rowLabel2","sticky",""],[4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell","","matRipple","",3,"mousedown","mouseup"],["mat-footer-cell","",3,"click"],[1,"user"],[3,"matColumnDef"],["mat-header-cell","","matRipple","",3,"background-color","mousedown","mouseup",4,"matHeaderCellDef"],["mat-cell","",3,"background-color",4,"matCellDef"],["mat-header-cell","","matRipple","",3,"mousedown","mouseup"],["mat-cell",""],["mat-header-cell","",3,"click"],["mat-cell","",3,"click"],["mat-footer-cell",""],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(e,t){1&e&&n.Bc(0,$e,25,8,"div",0),2&e&&n.jc("ngIf",t.dataSlice)},directives:[s.m,te.n,te.c,te.i,te.b,te.e,s.l,te.k,te.m,te.g,te.h,te.a,F.r,te.d,te.j,te.l,te.f],styles:[".data-sheet-container[_ngcontent-%COMP%] {\n      max-height: 800px;\n      overflow: auto;\n    }\n\n    .mat-table-sticky[_ngcontent-%COMP%]:first-child {\n      border-right: 1px solid #e0e0e0;\n      padding-right: 1em;\n    }\n\n\n    .mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%] {\n      padding-left: 0.5em;\n      padding-right: 0.5em;\n    }\n\n    label[_ngcontent-%COMP%] {\n      color: rgba(0,0,0,0.54);\n    }\n\n    label.user[_ngcontent-%COMP%] {\n      color: black;\n    }"]}),e})();const qe=["colPaginator"],Qe=["rowPaginator"];function Ve(e,t){if(1&e&&(n.Tb(0,"div",9),n.Dc(1),n.Sb()),2&e){const e=n.dc();n.Bb(1),n.Fc(" You have not seen yet all the available ",null==e.importDetails?null:e.importDetails.inLabel,"s for labelling\n")}}const Xe=function(){return[10,25,50,100]};let Je=(()=>{class e extends ee{constructor(e,t,i){super(t,i),this.dialog=e,this.columnsLabels=[],this.rowsLabels=[],this.colorer=new Y}get userLabels(){return this.importDetails?this.importDetails.userLabels:void 0}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy(),this.dataService&&this.dataService.close()}ngAfterViewInit(){this.colPaginator._intl=new T.b,this.colPaginator._intl.itemsPerPageLabel="Columns per page",this.rowPaginator._intl=new T.b,this.rowPaginator._intl.itemsPerPageLabel="Rows per page"}markSelections(){super.markSelections(),this.markFirstTime(),this.loadLabels(),this.markLabels(),this.labelsSummary=this.importDetails.summarizeLabels(25),this.labelTime()}labelTime(){if(this.firstTimeCell)if(this.importDetails.inRows){const e=this.dataSlice.rowsNumbers.indexOf(this.firstTimeCell.rowNumber);e>=0&&(this.rowsLabels[e]="Time")}else{const e=this.dataSlice.columnsNumbers.indexOf(this.firstTimeCell.colNumber);e>=0&&(this.columnsLabels[e]="Time")}}loadLabels(){const e=this.dataSlice;this.importDetails.inRows?(this.rowsLabels=this.userLabels.slice(e.rowsNumbers[0],e.rowsNumbers[e.rowsNumbers.length-1]),this.columnsLabels=[]):(this.rowsLabels=[],this.columnsLabels=this.userLabels.slice(e.columnsNumbers[0],e.columnsNumbers[e.columnsNumbers.length-1]))}markLabels(){this.userLabels.forEach((e,t)=>{this.importDetails.inRows?this.tableSelector.selectRow(t,this.colorer.toColor(e)):this.tableSelector.selectCol(t,this.colorer.toColor(e))})}hasSeenAll(){return!!this.dataSlice&&(this.importDetails.inRows?this.lastRowSeen>=this.dataSlice.totalRows-1:this.lastColumnSeen>=this.dataSlice.totalColumns-1)}selected(e){e[1].isBeforeOrSame(e[0])&&(e=[e[1],e[0]]),this.importDetails.inRows?this.labelRows(e[0],e[1]):this.labelColumns(e[0],e[1])}setUserLabel(e,t){this.userLabels[e]=t||void 0,this.labelsSummary=this.importDetails.summarizeLabels(25)}askForLabel(e,t,i){let s;return s=i?{title:"Label rows",regionName:e.hasSameIx(t)?"row "+e.rowName:"rows "+e.rowName+"-"+t.rowName,label:this.userLabels[e.rowNumber]}:{title:"Label columns",regionName:e.hasSameIx(t)?"column "+e.colName:"columns "+e.colName+"-"+t.colName,label:this.userLabels[e.rowNumber]},this.dialog.open(Te,{data:s}).afterClosed()}labelRows(e,t){e.rowIx<0||t.rowIx<0?console.warn("Label rows with col selection",e):this.firstTimeCell&&this.firstTimeCell.rowNumber>=e.rowNumber||this.askForLabel(e,t,!0).subscribe(i=>{void 0!==i&&(this.setRowsLabel(e,t,i),i&&this.selectNextRegion(e,t))})}setRowsLabel(e,t,i){i=i.trim();const s=this.colorer.toColor(i);for(let a=e.rowIx;a<=t.rowIx;a++){const e=this.dataSlice.rowsNumbers[a];void 0===e?console.error("No row number for index "+a):(this.rowsLabels[a]=i,this.setUserLabel(e,i),i?this.tableSelector.selectRow(e,s):this.tableSelector.deselectRow(e))}}labelColumns(e,t){e.colIx<0||t.colIx<0?console.warn("Label cols with row selection",e):this.firstTimeCell&&this.firstTimeCell.colNumber>=e.colNumber?console.log("Ignroing labelling as Time col after selection"):this.askForLabel(e,t,!1).subscribe(i=>{void 0!==i&&(this.setColumnsLabel(e,t,i),i&&this.selectNextRegion(e,t))})}setColumnsLabel(e,t,i){i=i.trim();const s=this.colorer.toColor(i);for(let a=e.colIx;a<=t.colIx;a++){const e=this.dataSlice.columnsNumbers[a];void 0===e?console.error("No col number for index "+a):(this.columnsLabels[a]=i,this.setUserLabel(e,i),i?this.tableSelector.selectCol(e,s):this.tableSelector.deselectCol(e))}}selectNextRegion(e,t){const i=[t.colIx-e.colIx,t.rowIx-e.rowIx];let s=this.moveCell(t,[1,1]),a=this.moveCell(s,i);this.isInPage(s)&&(this.isInPage(a)||(a=this.fitToPage(a)),s=this.reselect(s),a=this.reselect(a),this.selected([s,a]))}isInPage(e){return!(e.colIx>=0&&e.colIx>=this.dataSlice.columnsNumbers.length||e.rowIx>=0&&e.rowIx>=this.dataSlice.rowsNumbers.length)}fitToPage(e){return new o.a(e.colIx>=0?this.dataSlice.columnsNumbers.length-1:-1,void 0,void 0,e.rowIx>=0?this.dataSlice.rowsNumbers.length-1:-1,void 0,void 0,void 0)}moveCell(e,t){return new o.a(e.colIx>=0?e.colIx+t[0]:-1,void 0,void 0,e.rowIx>=0?e.rowIx+t[1]:-1,void 0,void 0,void 0)}loadColPage(e){this.dataService.slice(new B(this.currentPageSlice.rowPage,e))}loadRowPage(e){this.dataService.slice(new B(e,this.currentPageSlice.colPage))}moreColumns(){this.importDetails.inRows||this.colPaginator.nextPage()}moreRows(){this.importDetails.inRows&&this.rowPaginator.nextPage()}}return e.\u0275fac=function(t){return new(t||e)(n.Nb(De.b),n.Nb(k),n.Nb(I.a))},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-assign-labels-step"]],viewQuery:function(e,t){var i;1&e&&(n.xc(qe,!0),n.xc(Qe,!0)),2&e&&(n.pc(i=n.ac())&&(t.colPaginator=i.first),n.pc(i=n.ac())&&(t.rowPaginator=i.first))},inputs:{importDetails:"importDetails"},features:[n.Ab([k]),n.yb],decls:14,vars:23,consts:[["role","alert","type","info",1,"alert","alert-info",3,"hidden"],[3,"hidden"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["colPaginator",""],[3,"dataSlice","columnsLabels","rowsLabels","styler","selectRows","selectCols","selected","moreColumns","moreRows"],[3,"length","disabled","pageSize","pageSizeOptions","page"],["rowPaginator",""],["type","danger","class","alert alert-danger mt-2","role","alert",4,"ngIf"],[2,"margin-top","1em"],["type","danger","role","alert",1,"alert","alert-danger","mt-2"]],template:function(e,t){1&e&&(n.Tb(0,"div",0),n.Dc(1),n.Sb(),n.Tb(2,"div",1),n.Tb(3,"mat-paginator",2,3),n.Zb("page",(function(e){return t.loadColPage(e)})),n.Sb(),n.Sb(),n.Tb(5,"bd2-selectable-region-mdtable",4),n.Zb("selected",(function(e){return t.selected(e)}))("moreColumns",(function(){return t.moreColumns()}))("moreRows",(function(){return t.moreRows()})),n.Sb(),n.Tb(6,"div",1),n.Tb(7,"mat-paginator",5,6),n.Zb("page",(function(e){return t.loadRowPage(e)})),n.Sb(),n.Sb(),n.Bc(9,Ve,2,1,"div",7),n.Tb(10,"div",8),n.Tb(11,"label"),n.Dc(12,"Selected labels: "),n.Sb(),n.Dc(13),n.Sb()),2&e&&(n.jc("hidden",(null==t.importDetails||null==t.importDetails.userLabels?null:t.importDetails.userLabels.length)>1),n.Bb(1),n.Fc(" Click and drag over ",null==t.importDetails?null:t.importDetails.inLabel," headers to label the data.\n"),n.Bb(1),n.jc("hidden",null==t.importDetails?null:t.importDetails.inRows),n.Bb(1),n.jc("length",null==t.dataSlice?null:t.dataSlice.totalColumns)("disabled",null==t.importDetails?null:t.importDetails.inRows)("pageSize",t.currentPageSlice.colPage.pageSize)("pageIndex",t.currentPageSlice.colPage.pageIndex)("pageSizeOptions",n.lc(21,Xe)),n.Bb(2),n.jc("dataSlice",t.dataSlice)("columnsLabels",t.columnsLabels)("rowsLabels",t.rowsLabels)("styler",t.tableSelector.tableStyler)("selectRows",null==t.importDetails?null:t.importDetails.inRows)("selectCols",!(null!=t.importDetails&&t.importDetails.inRows)),n.Bb(1),n.jc("hidden",!(null!=t.importDetails&&t.importDetails.inRows)),n.Bb(1),n.jc("length",null==t.dataSlice?null:t.dataSlice.totalRows)("disabled",!(null!=t.importDetails&&t.importDetails.inRows))("pageSize",t.firstPageSlice.rowPage.pageSize)("pageSizeOptions",n.lc(22,Xe)),n.Bb(2),n.jc("ngIf",!t.hasSeenAll()),n.Bb(4),n.Fc("",t.labelsSummary,"\n"))},directives:[T.a,Ke,s.m],encapsulation:2}),e})();function Ye(e,t){if(1&e&&(n.Tb(0,"div",7),n.Dc(1),n.Sb()),2&e){const e=n.dc(3);n.Bb(1),n.Fc(" Labels ",e.importDetails.inLabelNeg," must be before first time point. ")}}function et(e,t){if(1&e&&(n.Tb(0,"div"),n.Tb(1,"p"),n.Dc(2),n.Tb(3,"strong"),n.Dc(4),n.Sb(),n.Sb(),n.Bc(5,Ye,2,1,"div",6),n.Sb()),2&e){const e=n.dc(2);n.Bb(2),n.Fc("Labels in ",e.importDetails.inLabelNeg," "),n.Bb(2),n.Fc("",e.importDetails.inRows?e.labelsSelection.colName:e.labelsSelection.rowName,";"),n.Bb(1),n.jc("ngIf",!e.importDetails.areLabelsAfterTime())}}function tt(e,t){if(1&e&&(n.Tb(0,"div",8),n.Dc(1),n.Sb()),2&e){const e=n.dc(2);n.Bb(1),n.Fc(" Even if only the top part of the data table is presented all labels from the selected ",e.importDetails.inLabelNeg," will be imported ")}}function it(e,t){if(1&e){const e=n.Ub();n.Tb(0,"mat-card",1),n.Tb(1,"mat-card-content"),n.Bc(2,et,6,3,"div",2),n.Tb(3,"div"),n.Tb(4,"div",3),n.Dc(5),n.Sb(),n.Sb(),n.Tb(6,"bd2-data-sheet-mdtable",4),n.Zb("selected",(function(t){return n.sc(e),n.dc().selectLabels(t)})),n.Sb(),n.Tb(7,"div"),n.Dc(8," \xa0 "),n.Bc(9,tt,2,1,"div",5),n.Sb(),n.Sb(),n.Sb()}if(2&e){const e=n.dc();n.Bb(2),n.jc("ngIf",e.labelsSelection),n.Bb(2),n.Db(e.labelsSelection?"alert alert-info":"alert alert-danger"),n.Bb(1),n.Fc(" Click on the ",e.importDetails.inLabelNeg," containing labels. "),n.Bb(1),n.jc("dataSlice",e.dataSlice)("selectableColHeader",e.importDetails.inRows)("selectableRowHeader",!e.importDetails.inRows)("styler",e.tableSelector.tableStyler),n.Bb(3),n.jc("ngIf",e.hasMoreLabels())}}let st=(()=>{class e extends ee{constructor(e,t){super(e,t)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.labelsSelection&&!this.labelsSelection.fake)this.selectLabels(this.reselect(this.labelsSelection));else if(this.firstTimeCell){const e=this.reselect(new o.a(this.firstTimeCell.colIx-1,this.colNumber(this.firstTimeCell.colIx-1),void 0,this.firstTimeCell.rowIx-1,this.rowNumber(this.firstTimeCell.rowIx-1),void 0,void 0));e.fake=!0,this.selectLabels(e)}}markSelections(){super.markSelections(),this.markFirstTime()}}return e.\u0275fac=function(t){return new(t||e)(n.Nb(k),n.Nb(I.a))},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-import-labels-step"]],inputs:{importDetails:"importDetails"},features:[n.yb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],["role","alert"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(e,t){1&e&&n.Bc(0,it,10,9,"mat-card",0),2&e&&n.jc("ngIf",t.importDetails)},directives:[s.m,y.a,y.c,me],encapsulation:2}),e})();function at(e,t){if(1&e&&(n.Tb(0,"div",5),n.Dc(1),n.Sb()),2&e){const e=n.dc(3);n.Bb(1),n.Gc(" Data start ",e.importDetails.inLabel," must be after time ",e.importDetails.inLabel,". ")}}function lt(e,t){if(1&e&&(n.Tb(0,"div"),n.Tb(1,"p"),n.Dc(2),n.Tb(3,"strong"),n.Dc(4),n.Sb(),n.Sb(),n.Bc(5,at,2,2,"div",4),n.Sb()),2&e){const e=n.dc(2);n.Bb(2),n.Fc("Data starts in ",e.importDetails.inLabel," "),n.Bb(2),n.Fc("",e.importDetails.inRows?e.dataStart.rowName:e.dataStart.colName,";"),n.Bb(1),n.jc("ngIf",!e.importDetails.isDataAfterTime())}}function ot(e,t){if(1&e){const e=n.Ub();n.Tb(0,"mat-card",1),n.Tb(1,"mat-card-content"),n.Bc(2,lt,6,3,"div",2),n.Tb(3,"div"),n.Tb(4,"div"),n.Dc(5),n.Sb(),n.Sb(),n.Tb(6,"bd2-data-sheet-mdtable",3),n.Zb("selected",(function(t){return n.sc(e),n.dc().selectDataStart(t)})),n.Sb(),n.Sb(),n.Sb()}if(2&e){const e=n.dc();n.Bb(2),n.jc("ngIf",e.dataStart),n.Bb(2),n.Db(e.dataStart?"alert alert-info":"alert alert-danger"),n.Bb(1),n.Fc(" Click on the first data ",e.importDetails.inLabel,". "),n.Bb(1),n.jc("dataSlice",e.dataSlice)("selectableColHeader",!e.importDetails.inRows)("selectableRowHeader",e.importDetails.inRows)("styler",e.tableSelector.tableStyler)}}let rt=(()=>{class e extends ee{constructor(e,t){super(e,t)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.dataStart&&!this.dataStart.fake)this.selectDataStart(this.reselect(this.dataStart));else if(this.firstTimeCell){const e=this.reselect(new o.a(this.firstTimeCell.colIx+1,this.colNumber(this.firstTimeCell.colIx+1),void 0,this.firstTimeCell.rowIx+1,this.rowNumber(this.firstTimeCell.rowIx+1),void 0,void 0));e.fake=!0,this.selectDataStart(e)}}markSelections(){super.markSelections(),this.markFirstTime(),this.markLabels()}}return e.\u0275fac=function(t){return new(t||e)(n.Nb(k),n.Nb(I.a))},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-select-data-start-step"]],inputs:{importDetails:"importDetails"},features:[n.yb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(e,t){1&e&&n.Bc(0,ot,7,8,"mat-card",0),2&e&&n.jc("ngIf",t.importDetails)},directives:[s.m,y.a,y.c,me],encapsulation:2}),e})();var nt=i("FtGj"),ct=i("JX91"),bt=i("A5z7"),mt=i("/1cH"),dt=i("NFeN");const ut=["backgroundInput"],ht=["auto"];function pt(e,t){1&e&&(n.Tb(0,"mat-icon",14),n.Dc(1,"cancel"),n.Sb())}function ft(e,t){if(1&e){const e=n.Ub();n.Tb(0,"mat-chip",12),n.Zb("removed",(function(){n.sc(e);const i=t.$implicit;return n.dc(2).remove(i)})),n.Dc(1),n.Bc(2,pt,2,0,"mat-icon",13),n.Sb()}if(2&e){const e=t.$implicit,i=n.dc(2);n.jc("selectable",i.selectable)("removable",i.removable),n.Bb(1),n.Fc(" ",e," "),n.Bb(1),n.jc("ngIf",i.removable)}}function gt(e,t){if(1&e&&(n.Tb(0,"mat-option",15),n.Dc(1),n.Sb()),2&e){const e=t.$implicit;n.jc("value",e),n.Bb(1),n.Fc(" ",e," ")}}function St(e,t){if(1&e){const e=n.Ub();n.Tb(0,"div"),n.Tb(1,"mat-card",1),n.Tb(2,"mat-card-content"),n.Tb(3,"div",2),n.Dc(4," Select labels for which data should be treated as the background noise "),n.Sb(),n.Tb(5,"mat-form-field",3),n.Tb(6,"mat-chip-list",4,5),n.Bc(8,ft,3,4,"mat-chip",6),n.Tb(9,"input",7,8),n.Zb("matChipInputTokenEnd",(function(t){return n.sc(e),n.dc().add(t)})),n.Sb(),n.Sb(),n.Tb(11,"mat-autocomplete",9,10),n.Zb("optionSelected",(function(t){return n.sc(e),n.dc().selected(t)})),n.Bc(13,gt,2,2,"mat-option",11),n.ec(14,"async"),n.Sb(),n.Sb(),n.Sb(),n.Sb(),n.Sb()}if(2&e){const e=n.qc(7),t=n.qc(12),i=n.dc();n.Bb(8),n.jc("ngForOf",i.backgrounds),n.Bb(1),n.jc("formControl",i.backgroundCtrl)("matAutocomplete",t)("matChipInputFor",e)("matChipInputSeparatorKeyCodes",i.separatorKeysCodes)("matChipInputAddOnBlur",i.addOnBlur),n.Bb(4),n.jc("ngForOf",n.fc(14,7,i.filteredLabels))}}let wt=(()=>{class e{constructor(e){this.tsFileService=e,this.selectable=!0,this.removable=!0,this.addOnBlur=!1,this.separatorKeysCodes=[nt.g,nt.c],this.backgroundCtrl=new a.f,this.allLabels=[]}get backgrounds(){return this.importDetails?this.importDetails.backgroundsLabels:[]}set backgrounds(e){this.importDetails.backgroundsLabels=e}ngOnInit(){this.filteredLabels=this.backgroundCtrl.valueChanges.pipe(Object(ct.a)(null),Object(D.a)(e=>e?this.filter(e):this.allLabels))}loadLabels(){this.importDetails&&this.importDetails.fileId?this.importDetails.importLabels?this.importDetails.labelsSelection&&this.tsFileService.previewLabels(this.importDetails.fileId,this.importDetails.importFormat.name,this.importDetails.labelsSelection,this.importDetails.inRows).subscribe(e=>{this.updateAllLabels(this.unique(e))}):this.updateAllLabels(this.unique(this.importDetails.userLabels)):this.updateAllLabels([])}updateAllLabels(e){this.allLabels=e.slice().sort();const t=this.backgrounds||[];this.backgrounds=[],t.forEach(e=>this.addBackground(e)),this.backgroundCtrl.setValue(" "),this.backgroundCtrl.setValue(null)}unique(e){return e=e.filter(e=>!!e).map(e=>e.trim()),[...new Set(e)]}addBackground(e){if((e||"").trim()){const t=this.backgrounds.indexOf(e),i=this.allLabels.indexOf(e);t<0&&i>=0&&this.backgrounds.push(e.trim())}}add(e){if(!this.matAutocomplete.isOpen){const t=e.input;this.addBackground(e.value),t&&(t.value=""),this.backgroundCtrl.setValue(null)}}remove(e){const t=this.backgrounds.indexOf(e);t>=0&&this.backgrounds.splice(t,1)}selected(e){this.addBackground(e.option.viewValue),this.backgroundInput.nativeElement.value="",this.backgroundCtrl.setValue(null)}filter(e){const t=e.toLowerCase();return this.allLabels.filter(e=>e.toLowerCase().includes(t)).slice(0,7)}}return e.\u0275fac=function(t){return new(t||e)(n.Nb(v))},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-select-backgrounds-labels-step"]],viewQuery:function(e,t){var i;1&e&&(n.Ic(ut,!0),n.Ic(ht,!0)),2&e&&(n.pc(i=n.ac())&&(t.backgroundInput=i.first),n.pc(i=n.ac())&&(t.matAutocomplete=i.first))},inputs:{importDetails:"importDetails"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"mat-elevation-z4"],["type","info","role","alert",1,"alert","alert-info"],[2,"width","100%"],["aria-label","Backgrounds selection"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder","Type to select background label...",3,"formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["backgroundInput",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"selectable","removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"]],template:function(e,t){1&e&&n.Bc(0,St,15,9,"div",0),2&e&&n.jc("ngIf",null==t.importDetails?null:t.importDetails.containsBackgrounds)},directives:[s.m,y.a,y.c,R.c,bt.c,s.l,a.d,mt.c,bt.b,a.q,a.g,mt.a,bt.a,dt.a,bt.d,F.o],pipes:[s.b],encapsulation:2}),e})();const Dt=["stepper"],Tt=["importLabelsStep"],Bt=["assignLabelsStep"],Ct=["selectBackgroundsStep"];function vt(e,t){1&e&&n.Dc(0,"Upload data file")}function kt(e,t){1&e&&n.Dc(0,"Data layout")}function It(e,t){if(1&e&&n.Dc(0),2&e){const e=n.dc();n.Fc("Define time ",e.importDetails.inLabel,"")}}function Nt(e,t){1&e&&n.Dc(0,"Label data")}function yt(e,t){if(1&e){const e=n.Ub();n.Rb(0),n.Tb(1,"mat-step",12),n.Bc(2,Nt,1,0,"ng-template",2),n.Ob(3,"mat-divider"),n.Ob(4,"bd2-import-details-summary",19),n.Ob(5,"bd2-assign-labels-step",4,20),n.Tb(7,"div"),n.Tb(8,"button",10),n.Dc(9,"Back"),n.Sb(),n.Tb(10,"button",14),n.Zb("click",(function(){return n.sc(e),n.dc().startChoosingBackgrounds()})),n.Dc(11,"Next"),n.Sb(),n.Sb(),n.Sb(),n.Qb()}if(2&e){const e=n.dc();n.Bb(1),n.jc("completed",e.importDetails.areLabelsCorrectlyAssigned()),n.Bb(3),n.jc("importDetails",e.importDetails)("showTime",!0),n.Bb(1),n.jc("importDetails",e.importDetails),n.Bb(5),n.jc("disabled",!e.importDetails.areLabelsCorrectlyAssigned())}}function Rt(e,t){if(1&e&&n.Dc(0),2&e){const e=n.dc(2);n.Fc("Select labels ",e.importDetails.inLabelNeg,"")}}function Lt(e,t){1&e&&n.Dc(0,"Select data start")}function xt(e,t){if(1&e){const e=n.Ub();n.Rb(0),n.Tb(1,"mat-step",12),n.Bc(2,Rt,1,1,"ng-template",2),n.Ob(3,"mat-divider"),n.Ob(4,"bd2-import-details-summary",19),n.Ob(5,"bd2-import-labels-step",4,21),n.Tb(7,"div"),n.Tb(8,"button",10),n.Dc(9,"Back"),n.Sb(),n.Tb(10,"button",14),n.Zb("click",(function(){n.sc(e);const t=n.qc(17);return n.dc().loadData(t)})),n.Dc(11,"Next"),n.Sb(),n.Sb(),n.Sb(),n.Tb(12,"mat-step",12),n.Bc(13,Lt,1,0,"ng-template",2),n.Ob(14,"mat-divider"),n.Ob(15,"bd2-import-details-summary",22),n.Ob(16,"bd2-select-data-start-step",4,23),n.Tb(18,"div"),n.Tb(19,"button",10),n.Dc(20,"Back"),n.Sb(),n.Tb(21,"button",14),n.Zb("click",(function(){return n.sc(e),n.dc().startChoosingBackgrounds()})),n.Dc(22,"Next"),n.Sb(),n.Sb(),n.Sb(),n.Qb()}if(2&e){const e=n.dc();n.Bb(1),n.jc("completed",e.importDetails.areLabelsCorrectlySelected()),n.Bb(3),n.jc("importDetails",e.importDetails)("showTime",!0),n.Bb(1),n.jc("importDetails",e.importDetails),n.Bb(5),n.jc("disabled",!e.importDetails.areLabelsCorrectlySelected()),n.Bb(2),n.jc("completed",e.importDetails.areLabelsCorrectlySelected()&&e.importDetails.isDataStartCorrectlySelected()),n.Bb(3),n.jc("importDetails",e.importDetails)("showTime",!0)("showLabelling",!0),n.Bb(1),n.jc("importDetails",e.importDetails),n.Bb(5),n.jc("disabled",!e.importDetails.isDataStartCorrectlySelected())}}function Ft(e,t){1&e&&n.Dc(0,"Select backgrounds labels")}function Ot(e,t){if(1&e&&(n.Rb(0),n.Tb(1,"mat-step"),n.Bc(2,Ft,1,0,"ng-template",2),n.Ob(3,"mat-divider"),n.Ob(4,"bd2-import-details-summary",16),n.Ob(5,"bd2-select-backgrounds-labels-step",4,24),n.Tb(7,"div"),n.Tb(8,"button",10),n.Dc(9,"Back"),n.Sb(),n.Tb(10,"button",25),n.Dc(11,"Next"),n.Sb(),n.Sb(),n.Sb(),n.Qb()),2&e){const e=n.dc();n.Bb(4),n.jc("importDetails",e.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),n.Bb(1),n.jc("importDetails",e.importDetails)}}function jt(e,t){1&e&&n.Dc(0,"Import timeseries")}let Pt=(()=>{class e{constructor(e,t,i){this.fileService=e,this.feedback=t,this.dataService=i,this.import=new n.o,this.oldImport=new n.o,this.blocked=!1,this.importDetails=new o.b,this.importDetails.timeType=m.h.TIME_IN_HOURS}ngOnInit(){}ngOnDestroy(){this.dataService&&this.dataService.close()}upload(e){e.files&&1===e.files.length?this.fileService.uploadFile(e.files[0],e.importFormat).subscribe(t=>{this.importDetails.fileId=t,this.importDetails.fileName=e.files[0].name,this.importDetails.importFormat=e.importFormat,this.importDetails.inRows=e.importFormat!=o.e.EXCEL_TABLE,this.stepper.next(),e.importFormat==o.e.TOPCOUNT&&this.oldImport.next(this.importDetails)},e=>{this.feedback.error(e)}):console.error("Wrong upload files size",e.files)}loadData(e){e.loadData()}startLabelling(){this.importDetails.importLabels?this.importLabelsStep?this.importLabelsStep.loadData():console.error("Missing importLabelStep"):this.assignLabelsStep?this.assignLabelsStep.loadData():console.error("Missing assignLabelsStep")}startChoosingBackgrounds(){this.importDetails.containsBackgrounds&&(this.selectBackgroundsStep?this.selectBackgroundsStep.loadLabels():console.error("Missing selectBackgroundsStep"))}importData(){this.importDetails.isComplete()&&this.import.next(this.importDetails)}}return e.\u0275fac=function(t){return new(t||e)(n.Nb(v),n.Nb(I.a),n.Nb(k))},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-import-steps"]],viewQuery:function(e,t){var i;1&e&&(n.Ic(Dt,!0),n.Ic(Tt,!0),n.Ic(Bt,!0),n.Ic(Ct,!0)),2&e&&(n.pc(i=n.ac())&&(t.stepper=i.first),n.pc(i=n.ac())&&(t.importLabelsStep=i.first),n.pc(i=n.ac())&&(t.assignLabelsStep=i.first),n.pc(i=n.ac())&&(t.selectBackgroundsStep=i.first))},inputs:{blocked:"blocked"},outputs:{import:"import",oldImport:"oldImport"},features:[n.Ab([k])],decls:62,vars:26,consts:[[3,"linear"],["stepper",""],["matStepLabel",""],[3,"uploadFiles"],[3,"importDetails"],[1,"mat-elevation-z4"],["name","inRows",1,"spaced",3,"ngModel","ngModelChange"],[3,"value"],["name","importLabels",1,"spaced",3,"ngModel","ngModelChange"],["name","containsBackgrounds",1,"spaced",3,"ngModel","ngModelChange"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","type","button",3,"click"],[3,"completed"],["defineTimeStep",""],["mat-button","","matStepperNext","","type","button",3,"disabled","click"],[4,"ngIf"],[3,"importDetails","showTime","showLabelling","showDataStart"],["type","info","role","alert",1,"alert","alert-info"],["mat-button","",3,"disabled","click"],[3,"importDetails","showTime"],["assignLabelsStep",""],["importLabelsStep",""],[3,"importDetails","showTime","showLabelling"],["selectDataStartStep",""],["selectBackgroundsStep",""],["mat-button","","matStepperNext","","type","button"]],template:function(e,t){if(1&e){const e=n.Ub();n.Tb(0,"mat-vertical-stepper",0,1),n.Tb(2,"mat-step"),n.Bc(3,vt,1,0,"ng-template",2),n.Tb(4,"bd2-upload-data-file-step",3),n.Zb("uploadFiles",(function(e){return t.upload(e)})),n.Sb(),n.Sb(),n.Tb(5,"mat-step"),n.Tb(6,"form"),n.Bc(7,kt,1,0,"ng-template",2),n.Ob(8,"mat-divider"),n.Ob(9,"bd2-import-details-summary",4),n.Tb(10,"mat-card",5),n.Tb(11,"mat-card-content"),n.Tb(12,"p"),n.Tb(13,"mat-radio-group",6),n.Zb("ngModelChange",(function(e){return t.importDetails.inRows=e})),n.Tb(14,"mat-radio-button",7),n.Dc(15,"Data in rows"),n.Sb(),n.Tb(16,"mat-radio-button",7),n.Dc(17,"Data in columns"),n.Sb(),n.Sb(),n.Sb(),n.Tb(18,"p"),n.Tb(19,"mat-radio-group",8),n.Zb("ngModelChange",(function(e){return t.importDetails.importLabels=e})),n.Tb(20,"mat-radio-button",7),n.Dc(21),n.Sb(),n.Tb(22,"mat-radio-button",7),n.Dc(23,"Manually label"),n.Sb(),n.Sb(),n.Sb(),n.Tb(24,"p"),n.Tb(25,"mat-radio-group",9),n.Zb("ngModelChange",(function(e){return t.importDetails.containsBackgrounds=e})),n.Tb(26,"mat-radio-button",7),n.Dc(27,"No noise data"),n.Sb(),n.Tb(28,"mat-radio-button",7),n.Dc(29),n.Sb(),n.Sb(),n.Sb(),n.Sb(),n.Tb(30,"mat-card-actions"),n.Tb(31,"button",10),n.Dc(32,"Back"),n.Sb(),n.Tb(33,"button",11),n.Zb("click",(function(){n.sc(e);const i=n.qc(40);return t.loadData(i)})),n.Dc(34,"Next"),n.Sb(),n.Sb(),n.Sb(),n.Sb(),n.Sb(),n.Tb(35,"mat-step",12),n.Bc(36,It,1,1,"ng-template",2),n.Ob(37,"mat-divider"),n.Ob(38,"bd2-import-details-summary",4),n.Ob(39,"bd2-define-time-step",4,13),n.Tb(41,"div"),n.Tb(42,"button",10),n.Dc(43,"Back"),n.Sb(),n.Tb(44,"button",14),n.Zb("click",(function(){return t.startLabelling()})),n.Dc(45,"Next"),n.Sb(),n.Sb(),n.Sb(),n.Bc(46,yt,12,5,"ng-container",15),n.Bc(47,xt,23,11,"ng-container",15),n.Bc(48,Ot,12,5,"ng-container",15),n.Tb(49,"mat-step",12),n.Bc(50,jt,1,0,"ng-template",2),n.Ob(51,"mat-divider"),n.Ob(52,"bd2-import-details-summary",16),n.Tb(53,"mat-card",5),n.Tb(54,"mat-card-content"),n.Tb(55,"div",17),n.Dc(56,"You can now import the timeseries"),n.Sb(),n.Sb(),n.Sb(),n.Tb(57,"div"),n.Tb(58,"button",10),n.Dc(59,"Back"),n.Sb(),n.Tb(60,"button",18),n.Zb("click",(function(){return t.importData()})),n.Dc(61,"Import data"),n.Sb(),n.Sb(),n.Sb(),n.Sb()}2&e&&(n.jc("linear",!0),n.Bb(9),n.jc("importDetails",t.importDetails),n.Bb(4),n.jc("ngModel",t.importDetails.inRows),n.Bb(1),n.jc("value",!0),n.Bb(2),n.jc("value",!1),n.Bb(3),n.jc("ngModel",t.importDetails.importLabels),n.Bb(1),n.jc("value",!0),n.Bb(1),n.Fc("Import labels from ",t.importDetails.inLabelNeg,""),n.Bb(1),n.jc("value",!1),n.Bb(3),n.jc("ngModel",t.importDetails.containsBackgrounds),n.Bb(1),n.jc("value",!1),n.Bb(2),n.jc("value",!0),n.Bb(1),n.Fc("Background noise in ",t.importDetails.inLabel,"s"),n.Bb(6),n.jc("completed",t.importDetails.isTimeDefined()),n.Bb(3),n.jc("importDetails",t.importDetails),n.Bb(1),n.jc("importDetails",t.importDetails),n.Bb(5),n.jc("disabled",!t.importDetails.isTimeDefined()),n.Bb(2),n.jc("ngIf",!t.importDetails.importLabels),n.Bb(1),n.jc("ngIf",t.importDetails.importLabels),n.Bb(1),n.jc("ngIf",t.importDetails.containsBackgrounds),n.Bb(1),n.jc("completed",t.importDetails.isComplete()),n.Bb(3),n.jc("importDetails",t.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),n.Bb(8),n.jc("disabled",t.blocked||!t.importDetails.isComplete()))},directives:[N.f,N.a,N.b,M,a.D,a.r,a.s,A.a,K,y.a,y.c,q.b,a.q,a.t,q.a,y.b,Q.a,N.e,N.d,we,s.m,Je,st,rt,wt],encapsulation:2}),e})();var _t=i("Xa2L");function Et(e,t){1&e&&(n.Tb(0,"mat-card"),n.Tb(1,"mat-card-content"),n.Ob(2,"mat-spinner",2),n.Tb(3,"div",3),n.Dc(4,"Importing ...."),n.Sb(),n.Sb(),n.Sb())}const Mt=[{path:"",children:[{path:"",component:(()=>{class e extends r.a{constructor(e,t){super(t),this.BD2REST=e,this.importing=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit()}importData(e){if(this.importing)return;const t=new o.d;t.fileId=e.fileId,t.importFormat=e.importFormat,t.importParameters=e,this.importing=!0,this.BD2REST.experimentImportTS(this.assay.id,t).subscribe(e=>{this.feedback.success("Imported "+e.imported+" timeseries"),this.refreshModel(),this.importing=!1,this.goToTSView()},e=>{this.importing=!1,this.feedback.error(e)})}goToTSView(){const e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}goToOldImport(e){const t=this.expHomePath();t.push("data","ts-old-import",e.importFormat.name,e.fileId),this.router.navigate(t)}}return e.\u0275fac=function(t){return new(t||e)(n.Nb(c.a),n.Nb(b.a))},e.\u0275cmp=n.Hb({type:e,selectors:[["bd2-tsimport-dashboard"]],features:[n.yb],decls:2,vars:1,consts:[[3,"import","oldImport"],[4,"ngIf"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"]],template:function(e,t){1&e&&(n.Tb(0,"bd2-import-steps",0),n.Zb("import",(function(e){return t.importData(e)}))("oldImport",(function(e){return t.goToOldImport(e)})),n.Sb(),n.Bc(1,Et,5,0,"mat-card",1)),2&e&&(n.Bb(1),n.jc("ngIf",t.importing))},directives:[Pt,s.m,y.a,y.c,_t.b],encapsulation:2}),e})()}]}];let At=(()=>{class e{}return e.\u0275mod=n.Lb({type:e}),e.\u0275inj=n.Kb({factory:function(t){return new(t||e)},imports:[[l.f.forChild(Mt)],l.f]}),e})();var Ut=i("YiFe"),Ht=i("ZTEM");let zt=(()=>{class e{}return e.\u0275mod=n.Lb({type:e}),e.\u0275inj=n.Kb({factory:function(t){return new(t||e)},imports:[[s.c,a.k,a.y,Ut.a,Ht.a,At]]}),e})()}}]);