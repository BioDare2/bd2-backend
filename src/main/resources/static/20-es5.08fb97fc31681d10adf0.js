!function(){function e(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,i,a){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var a=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}(e,t);if(a){var l=Object.getOwnPropertyDescriptor(a,t);return l.get?l.get.call(i):l.value}})(e,i,a||e)}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,a=n(e);if(t){var l=n(this).constructor;i=Reflect.construct(a,arguments,l)}else i=a.apply(this,arguments);return o(this,i)}}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],a=!0,l=!1,o=void 0;try{for(var n,r=e[Symbol.iterator]();!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(l)throw o}}return i}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function m(e,t,i){return t&&b(e.prototype,t),i&&b(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{yPAH:function(a,o,s){"use strict";s.r(o),s.d(o,"TsImportModule",(function(){return fi}));var c,b,d,f=s("ofXK"),h=s("3Pt+"),p=s("tyNb"),g=s("EvUs"),v=s("yYXI"),S=s("fXoL"),w=s("UsWK"),D=s("GVyA"),y=s("KhIM"),k=s("2Vo4"),T=s("XNiG"),C=s("itXk"),B=s("pLZG"),I=s("/uUt"),N=s("eIep"),R=s("Cfvw"),L=s("5+tZ"),x=s("lJxs"),O=s("M9IT"),F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new O.d,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.d;u(this,e),this.rowPage=t,this.colPage=i}return m(e,[{key:"equals",value:function(t){return!!t&&e.pageEquals(this.rowPage,t.rowPage)&&e.pageEquals(this.colPage,t.colPage)}}],[{key:"firstPage",value:function(){var t=new e;return t.rowPage.pageIndex=0,t.rowPage.pageSize=50,t.colPage.pageIndex=0,t.colPage.pageSize=50,t}},{key:"pageEquals",value:function(e,t){return e.pageIndex===t.pageIndex&&e.pageSize===t.pageSize}}]),e}(),j=((d=function(){function e(t){u(this,e),this.BD2REST=t}return m(e,[{key:"uploadFile",value:function(e){var t=new FormData;return t.append("file",e,e.name),this.BD2REST.fileUpload(t).then((function(e){return e.id}))}}]),e}()).\u0275fac=function(e){return new(e||d)(S.Xb(w.a))},d.\u0275prov=S.Jb({token:d,factory:d.\u0275fac,providedIn:"root"}),d),P=((b=function(){function e(t,i){u(this,e),this.uploadService=t,this.BD2REST=i}return m(e,[{key:"uploadFile",value:function(e,t){var i=this;return Object(R.a)(this.uploadService.uploadFile(e)).pipe(Object(L.a)((function(e){return i.verifyFormat(t,e).pipe(Object(x.a)((function(t){return e})))})))}},{key:"verifyFormat",value:function(e,t){return this.BD2REST.fileViewVerifyFormat(e,t)}},{key:"getTableSlice",value:function(e,t,i){return this.BD2REST.fileViewTableSlice(e,t,i)}},{key:"previewLabels",value:function(e,t,i,a){var l=new F;return a?(l.rowPage.pageSize=500,l.rowPage.pageIndex=0,l.colPage.pageSize=1,l.colPage.pageIndex=i.colIx):(l.rowPage.pageSize=1,l.rowPage.pageIndex=i.rowIx,l.colPage.pageSize=500,l.colPage.pageIndex=0),this.getTableSlice(e,t,l).pipe(Object(x.a)((function(e){var t=[];return e.data.forEach((function(e){return e.forEach((function(e){return t.push(""+e)}))})),t})))}}]),e}()).\u0275fac=function(e){return new(e||b)(S.Xb(j),S.Xb(w.a))},b.\u0275prov=S.Jb({token:b,factory:b.\u0275fac,providedIn:"root"}),b),_=((c=function(){function e(t){u(this,e),this.tsFileService=t,this.tableSlice$=new k.a(void 0),this.slice$=new k.a(void 0),this.fileIdFormat$=new k.a(void 0),this.error$=new T.a,this.dataSlice$=this.tableSlice$.asObservable().pipe(Object(B.a)((function(e){return null!=e&&void 0!==e}))),this.initDataStream()}return m(e,[{key:"close",value:function(){this.slice$.complete(),this.fileIdFormat$.complete(),this.tableSlice$.complete(),this.error$.complete()}},{key:"slice",value:function(e){e&&this.slice$.next(e)}},{key:"fileIdFormat",value:function(e){e&&e[0]&&e[1]&&this.fileIdFormat$.next(e)}},{key:"sameParams",value:function(e,t){var i=r(e,2),a=r(i[0],2),l=a[0],o=a[1],n=i[1],s=r(t,2),c=r(s[0],2),u=c[0],b=c[1],m=s[1];return l==u&&o==b&&n.equals(m)}},{key:"initDataStream",value:function(){var e=this;Object(C.a)([this.fileIdFormat$,this.slice$]).pipe(Object(B.a)((function(e){var t=r(e,2),i=t[0],a=t[1];return i&&!!a})),Object(I.a)(this.sameParams)).pipe(Object(N.a)((function(t){var i=r(t,2),a=i[0],l=i[1];return e.tsFileService.getTableSlice(a[0],a[1],l)}))).subscribe((function(t){return e.tableSlice$.next(t)}),(function(t){return e.error$.next(t)}))}}]),e}()).\u0275fac=function(e){return new(e||c)(S.Xb(P))},c.\u0275prov=S.Jb({token:c,factory:c.\u0275fac}),c),E=s("6tuW"),M=s("xHqg"),A=s("Wp6s"),U=s("kmnG"),H=s("d3UM"),z=s("vLYz"),Z=s("FKr1");function W(e,t){if(1&e&&(S.Tb(0,"mat-option",9),S.Dc(1),S.Sb()),2&e){var i=t.$implicit;S.jc("value",i),S.Bb(1),S.Ec(i.label)}}function G(e,t){1&e&&(S.Tb(0,"div",10),S.Dc(1," An Excel file in which one column contains time values while other columns contain measurements taken at the corresponding times. "),S.Tb(2,"ul"),S.Tb(3,"li"),S.Dc(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes from start, seconds from start, or as image nr (1-based) which will be converted to time using interval between images. "),S.Sb(),S.Tb(5,"li"),S.Dc(6," Not all columns have to be imported. "),S.Sb(),S.Tb(7,"li"),S.Dc(8," First few rows can contain arbitrary text. "),S.Sb(),S.Tb(9,"li"),S.Dc(10," Values from one row can be used as data labels. "),S.Sb(),S.Sb(),S.Sb())}function $(e,t){1&e&&(S.Tb(0,"div",10),S.Dc(1," A coma or tab separeted file in which one column or row contains time values while other columns or rows contain measurements taken at the corresponding times. "),S.Tb(2,"ul"),S.Tb(3,"li"),S.Dc(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes or seconds from start, or as image numbers "),S.Sb(),S.Tb(5,"li"),S.Dc(6," Not all columns/rows have to be imported. "),S.Sb(),S.Tb(7,"li"),S.Dc(8," First few rows/columns can contain arbitrary text. "),S.Sb(),S.Tb(9,"li"),S.Dc(10," Values from one row/column can be used as data labels. "),S.Sb(),S.Sb(),S.Sb())}function K(e,t){1&e&&(S.Tb(0,"div",10),S.Dc(1," Topcount data can be uploaded in two forms: "),S.Tb(2,"ul"),S.Tb(3,"li"),S.Dc(4,"Individual file which contains concatenated topcount data blocks in one file"),S.Sb(),S.Tb(5,"li"),S.Dc(6,"Zip file which contains packed files from individual topcount reads"),S.Sb(),S.Sb(),S.Dc(7,' Check the Dosc section for details about suported data layouts inside tomcats file, we can currently read ASCI content with "plate map" or "column" layouts. '),S.Sb())}function q(e,t){if(1&e&&(S.Tb(0,"div",11),S.Dc(1),S.Sb()),2&e){var i=S.dc();S.Bb(1),S.Fc(" ",i.formatWarning," ")}}var Q,V=((Q=function(){function e(){u(this,e),this.blocked=!1,this.uploadFiles=new S.o,this.importFormatOptions=g.f,this.importFormat=g.e.EXCEL_TABLE}return m(e,[{key:"ngOnInit",value:function(){}},{key:"upload",value:function(e){this.uploadFiles.next({files:e,importFormat:this.importFormat})}},{key:"formatChanged",value:function(e){this.lastFiles&&this.checkFormat(this.lastFiles)}},{key:"checkFormat",value:function(e){var t=this;this.lastFiles=e,this.formatWarning=void 0,e.forEach((function(e){if(t.importFormat===g.e.TOPCOUNT){var i=t.isTopCount(e);i&&(t.formatWarning="The selected file does not seem to be a topcount file/archive but rather: "+i+". If you sure it is a valid topcount file/archive you can continue upload.")}else if(t.importFormat===g.e.EXCEL_TABLE){var a=t.isExcel(e);a&&(t.formatWarning="The selected file does not seem to be an excel file but rather: "+a+". If you sure it is a valid excel file you can continue upload.")}else if(t.importFormat===g.e.TAB_SEP){var l=t.isTab(e);l&&(t.formatWarning="The selected file does not seem to be a tab-separated file but rather: "+l+". If you sure it is a valid tsv file you can continue upload.")}else if(t.importFormat===g.e.COMA_SEP){var o=t.isComa(e);o&&(t.formatWarning="The selected file does not seem to be a coma-separated file but rather: "+o+". If you sure it is a valid csv file you can continue upload.")}}))}},{key:"isTopCount",value:function(e){var t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".tsv")?"tab separated":null):"Unknown"}},{key:"isExcel",value:function(e){var t=e.type;return t&&e.name?e.name.endsWith(".csv")?"CSV":e.name.endsWith(".txt")?"text":e.name.endsWith(".tsv")?"tab separated":t.indexOf("excel")>=0||t.indexOf("sheet")>=0?null:t:"Unknown"}},{key:"isTab",value:function(e){var t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".tsv")?null:"Unrecognized"):"Unknown"}},{key:"isComa",value:function(e){var t=e.type;return e.name?(t||(t="Unknown"),e.name.endsWith(".tsv")?"tab separated":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".csv")?null:"Unrecognized"):"Unknown"}}]),e}()).\u0275fac=function(e){return new(e||Q)},Q.\u0275cmp=S.Hb({type:Q,selectors:[["bd2-upload-data-file-step"]],outputs:{uploadFiles:"uploadFiles"},decls:19,vars:9,consts:[[1,"mat-elevation-z4"],[1,""],[1,"form-group"],["required","",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["dismissible","true","style","font-size: smaller;","type","info","class","alert alert-info","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"autoReset","blocked","multiple","selectedFiles","uploadFiles"],["uploadWidget",""],[3,"value"],["dismissible","true","type","info","role","alert",1,"alert","alert-info",2,"font-size","smaller"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(e,t){1&e&&(S.Tb(0,"div"),S.Tb(1,"mat-card",0),S.Tb(2,"mat-card-title"),S.Dc(3,"Time series file"),S.Sb(),S.Tb(4,"mat-card-content"),S.Tb(5,"form",1),S.Tb(6,"div",2),S.Tb(7,"mat-form-field"),S.Tb(8,"mat-label"),S.Dc(9,"File Format"),S.Sb(),S.Tb(10,"mat-select",3),S.Zb("valueChange",(function(e){return t.importFormat=e}))("selectionChange",(function(e){return t.formatChanged(e)})),S.Bc(11,W,2,2,"mat-option",4),S.Sb(),S.Sb(),S.Sb(),S.Bc(12,G,11,0,"div",5),S.Bc(13,$,11,0,"div",5),S.Bc(14,K,8,0,"div",5),S.Bc(15,q,2,1,"div",6),S.Tb(16,"div",2),S.Tb(17,"bd2-file-upload-widget",7,8),S.Zb("selectedFiles",(function(e){return t.checkFormat(e)}))("uploadFiles",(function(e){return t.upload(e)})),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&e&&(S.Bb(10),S.jc("value",t.importFormat),S.Bb(1),S.jc("ngForOf",t.importFormatOptions),S.Bb(1),S.jc("ngIf","EXCEL_TABLE"==t.importFormat.name),S.Bb(1),S.jc("ngIf","TAB_SEP"==t.importFormat.name||"COMA_SEP"==t.importFormat.name),S.Bb(1),S.jc("ngIf","TOPCOUNT"==t.importFormat.name),S.Bb(1),S.jc("ngIf",t.formatWarning),S.Bb(2),S.jc("autoReset",!1)("blocked",t.blocked||!t.importFormat)("multiple",!1))},directives:[A.a,A.e,A.c,h.D,h.r,h.s,U.c,U.g,H.a,f.l,f.m,z.a,Z.o],encapsulation:2}),Q),X=s("f0Cb");function J(e,t){if(1&e&&(S.Tb(0,"span"),S.Tb(1,"label"),S.Dc(2,"Images every"),S.Sb(),S.Dc(3),S.Sb()),2&e){var i=S.dc(2);S.Bb(3),S.Fc(" ",i.importDetails.imgInterval,"h ")}}function Y(e,t){if(1&e&&(S.Tb(0,"span"),S.Tb(1,"label"),S.Dc(2,"Time offset"),S.Sb(),S.Dc(3),S.Sb()),2&e){var i=S.dc(2);S.Bb(3),S.Fc(" ",i.importDetails.timeOffset,"h ")}}function ee(e,t){if(1&e&&(S.Tb(0,"p"),S.Tb(1,"label"),S.Dc(2,"First time point:"),S.Sb(),S.Tb(3,"strong"),S.Dc(4),S.Sb(),S.Bc(5,J,4,1,"span",1),S.Bc(6,Y,4,1,"span",1),S.Sb()),2&e){var i=S.dc();S.Bb(4),S.Hc("",i.firstTimeCell.value," ",null==i.importDetails.timeType?null:i.importDetails.timeType.unit," [",i.firstTimeCell.colName+":"+i.firstTimeCell.rowName,"]"),S.Bb(1),S.jc("ngIf","IMG_NUMBER"===(null==i.importDetails.timeType?null:i.importDetails.timeType.name)),S.Bb(1),S.jc("ngIf",0!=i.importDetails.timeOffset)}}function te(e,t){if(1&e&&(S.Tb(0,"p"),S.Dc(1),S.Tb(2,"strong"),S.Dc(3),S.Sb(),S.Sb()),2&e){var i=S.dc();S.Bb(1),S.Fc(" Labels in ",i.importDetails.inLabelNeg," "),S.Bb(2),S.Fc("",i.importDetails.inRows?i.labelsSelection.colName:i.labelsSelection.rowName,";")}}function ie(e,t){if(1&e&&(S.Tb(0,"p"),S.Tb(1,"label"),S.Dc(2,"Selected Labels:"),S.Sb(),S.Dc(3),S.Sb()),2&e){var i=S.dc();S.Bb(3),S.Fc(" ",i.importDetails.summarizeLabels()," ")}}function ae(e,t){if(1&e&&(S.Tb(0,"p"),S.Dc(1),S.Tb(2,"strong"),S.Dc(3),S.Sb(),S.Sb()),2&e){var i=S.dc();S.Bb(1),S.Fc(" Data starts in ",i.importDetails.inLabel," "),S.Bb(2),S.Fc("",i.importDetails.inRows?i.dataStart.rowName:i.dataStart.colName,";")}}function le(e,t){if(1&e&&(S.Tb(0,"p"),S.Dc(1),S.Sb()),2&e){var i=S.dc();S.Bb(1),S.Fc(" Background noise as: ",i.importDetails.backgroundsLabels.join(", ")," ")}}var oe,ne,re=((oe=function(){function e(){u(this,e),this.showTime=!1,this.showLabelling=!1,this.showDataStart=!1}return m(e,[{key:"ngOnInit",value:function(){}},{key:"firstTimeCell",get:function(){return this.importDetails?this.importDetails.firstTimeCell:void 0}},{key:"labelsSelection",get:function(){return this.importDetails?this.importDetails.labelsSelection:void 0}},{key:"dataStart",get:function(){return this.importDetails?this.importDetails.dataStart:void 0}}]),e}()).\u0275fac=function(e){return new(e||oe)},oe.\u0275cmp=S.Hb({type:oe,selectors:[["bd2-import-details-summary"]],inputs:{importDetails:"importDetails",showTime:"showTime",showLabelling:"showLabelling",showDataStart:"showDataStart"},decls:13,vars:8,consts:[[1,"mat-elevation-z4"],[4,"ngIf"]],template:function(e,t){1&e&&(S.Tb(0,"mat-card",0),S.Tb(1,"p"),S.Dc(2),S.Tb(3,"strong"),S.Dc(4),S.Sb(),S.Sb(),S.Tb(5,"p"),S.Tb(6,"label"),S.Dc(7),S.Sb(),S.Sb(),S.Bc(8,ee,7,5,"p",1),S.Bc(9,te,4,2,"p",1),S.Bc(10,ie,4,1,"p",1),S.Bc(11,ae,4,2,"p",1),S.Bc(12,le,2,1,"p",1),S.Sb()),2&e&&(S.Bb(2),S.Fc("",null==t.importDetails||null==t.importDetails.importFormat?null:t.importDetails.importFormat.label,": "),S.Bb(2),S.Ec(null==t.importDetails?null:t.importDetails.fileName),S.Bb(3),S.Fc("Time series in ",(null==t.importDetails?null:t.importDetails.inLabel)+"s",""),S.Bb(1),S.jc("ngIf",t.showTime&&t.firstTimeCell),S.Bb(1),S.jc("ngIf",t.showLabelling&&t.importDetails.importLabels&&t.labelsSelection),S.Bb(1),S.jc("ngIf",t.showLabelling&&!t.importDetails.importLabels),S.Bb(1),S.jc("ngIf",t.showDataStart&&t.importDetails.importLabels&&t.dataStart),S.Bb(1),S.jc("ngIf",t.showLabelling&&t.importDetails.containsBackgrounds&&t.importDetails.backgroundsLabels))},directives:[A.a,f.m],encapsulation:2}),oe),se=s("QibW"),ce=s("bTqV"),ue=function(){function e(){u(this,e),this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}return m(e,[{key:"reset",value:function(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}},{key:"setRowBackground",value:function(e,t){this.rowsBackgrounds[e]=t}},{key:"rowBackground",value:function(e){return this.getOrEmptyString(this.rowsBackgrounds,e)}},{key:"colBackground",value:function(e){return this.getOrEmptyString(this.colsBackgrounds,e)}},{key:"setColBackground",value:function(e,t){this.colsBackgrounds[e]=t}},{key:"cellBackground",value:function(e,t){return this.getOrEmptyString(this.getOrDefault(this.cellBackgrounds,t,[]),e)||this.colBackground(e)}},{key:"setCellBackground",value:function(e,t,i){var a=this.cellBackgrounds[t];void 0===a&&(a=[],this.cellBackgrounds[t]=a),a[e]=i}},{key:"getOrEmptyString",value:function(e,t){return this.getOrDefault(e,t,"")}},{key:"getOrDefault",value:function(e,t,i){return t>=e.length||void 0===e[t]?i:e[t]}}]),e}(),be=function(){var e=function(){function e(){u(this,e)}return m(e,[{key:"rowBackground",value:function(t){return e.MAIN_ROW_BACKGROUND}},{key:"cellBackground",value:function(t){return e.MAIN_CELL_BACKGROUND}},{key:"columnBackground",value:function(t){return e.MAIN_COL_BACKGROUND}}]),e}();return e.MAIN_ROW_BACKGROUND="#dda0dd",e.MAIN_COL_BACKGROUND="#87cefa",e.MAIN_CELL_BACKGROUND="#ba55d3",e.TIME_BACKGROUND="#dda0dd",e.LABELS_BACKGROUND="#87cefa",e.FIRST_TIME_BACKGROUND="#ba55d3",e.FIST_DATA_BACKGROUND="lightgreen",e}(),me=function(){function e(t,i){u(this,e),this.tableStyler=t,this.colorCycler=i,this.selectedRows=[],this.selectedCols=[],this.tableStyler=t||new ue,this.colorCycler=i||new be}return m(e,[{key:"toggleRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,l=this.selectedRows.splice(0,this.selectedRows.length);this.selectedRows.push(e),this.uncolorRows(l),this.colorRows(this.selectedRows,i),t&&(this.uncolorCells(l),this.colorCells(this.selectedRows,a))}},{key:"toggleRowSelection",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,o=this.selectedRows[e]?[this.selectedRows[e]]:[];this.selectedRows[e]=t,this.uncolorRows(o),this.colorRows([this.selectedRows[e]],a),i&&(this.uncolorCells(o),this.colorCells([this.selectedRows[e]],l))}},{key:"selectRow",value:function(e,t){var i=new g.a(-1,-1,void 0,e,e,void 0,void 0),a=this.selectedRows.findIndex((function(t){return t.rowNumber===e}));a<0?this.selectedRows.push(i):this.selectedRows[a]=i,this.colorRows([i],t)}},{key:"deselectRow",value:function(e){var t=this.selectedRows.findIndex((function(t){return t.rowNumber===e}));t>=0&&(this.selectedRows[t]=void 0);var i=new g.a(-1,-1,void 0,e,e,void 0,void 0);this.uncolorRows([i])}},{key:"toggleCol",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,l=this.selectedCols.splice(0,this.selectedCols.length);this.selectedCols.push(e),this.uncolorCols(l),this.colorCols(this.selectedCols,i),t&&(this.uncolorCells(l),this.colorCells(this.selectedCols,a))}},{key:"toggleColSelection",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,o=this.selectedCols[e]?[this.selectedCols[e]]:[];this.selectedCols[e]=t,this.uncolorCols(o),this.colorCols([this.selectedCols[e]],a),i&&(this.uncolorCells(o),this.colorCells([this.selectedCols[e]],l))}},{key:"selectCol",value:function(e,t){var i=new g.a(e,e,void 0,-1,-1,void 0,void 0),a=this.selectedCols.findIndex((function(t){return t.colNumber===e}));a<0?this.selectedCols.push(i):this.selectedCols[a]=i,this.colorCols([i],t)}},{key:"deselectCol",value:function(e){var t=this.selectedCols.findIndex((function(t){return t.colNumber===e}));t>=0&&(this.selectedCols[t]=void 0);var i=new g.a(e,e,void 0,-1,-1,void 0,void 0);this.uncolorCols([i])}},{key:"reset",value:function(){this.selectedRows=[],this.selectedCols=[],this.tableStyler.reset()}},{key:"colorRows",value:function(e,t){var i=this;e.forEach((function(e,a){i.tableStyler.setRowBackground(e.rowNumber,t||i.colorCycler.rowBackground(a))}))}},{key:"colorCols",value:function(e,t){var i=this;e.forEach((function(e,a){i.tableStyler.setColBackground(e.colNumber,t||i.colorCycler.columnBackground(a))}))}},{key:"colorCells",value:function(e,t){var i=this;e.forEach((function(e,a){i.tableStyler.setCellBackground(e.colNumber,e.rowNumber,t||i.colorCycler.cellBackground(a))}))}},{key:"uncolorRows",value:function(e){var t=this;e.forEach((function(e){t.tableStyler.setRowBackground(e.rowNumber,void 0)}))}},{key:"uncolorCols",value:function(e){var t=this;e.forEach((function(e){t.tableStyler.setColBackground(e.colNumber,void 0)}))}},{key:"uncolorCells",value:function(e){var t=this;e.forEach((function(e){t.tableStyler.setCellBackground(e.colNumber,e.rowNumber,void 0)}))}}]),e}(),de=function(){var e=function(){function e(){u(this,e),this.index=0,this.labelsIndexes=new Map}return m(e,[{key:"toColor",value:function(t){if(t){this.labelsIndexes.has(t)||this.labelsIndexes.set(t,this.index++);var i=this.labelsIndexes.get(t)%e.colors.length;return e.colors[i]}}},{key:"setColor",value:function(e){}}]),e}();return e.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"],e}(),fe=((ne=function(){function e(t,i){u(this,e),this.dataService=t,this.feedback=i,this.tableSelector=new me,this.lastColumnSeen=0,this.lastRowSeen=0,this.firstPageSlice=F.firstPage(),this.currentPageSlice=F.firstPage()}return m(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.error$.forEach((function(t){return e.feedback.error(t)})),this.dataSubscription=this.dataService.dataSlice$.subscribe((function(t){return e.setDataSlice(t)}),(function(t){return e.feedback.error(t)}))}},{key:"ngOnDestroy",value:function(){this.dataSubscription&&this.dataSubscription.unsubscribe()}},{key:"colNumber",value:function(e){return e<0?-1:this.dataSlice.columnsNumbers[e]}},{key:"rowNumber",value:function(e){return e<0?-1:this.dataSlice.rowsNumbers[e]}},{key:"setDataSlice",value:function(e){this.dataSlice=e,this.lastColumnSeen=Math.max(this.lastColumnSeen,e.columnsNumbers[e.columnsNumbers.length-1]),this.lastRowSeen=Math.max(this.lastRowSeen,e.rowsNumbers[e.rowsNumbers.length-1]),this.currentPageSlice=new F(e.rowPage,e.colPage),this.applySelection()}},{key:"loadData",value:function(){this.importDetails&&(this.lastColumnSeen=0,this.lastRowSeen=0,this.dataService.fileIdFormat([this.importDetails.fileId,this.importDetails.importFormat.name]),this.dataService.slice(this.firstPageSlice)),this.dataSlice&&this.applySelection()}},{key:"applySelection",value:function(){this.tableSelector.reset(),this.markSelections(),this.applyDefaultSelections()}},{key:"applyDefaultSelections",value:function(){}},{key:"markSelections",value:function(){}},{key:"selectFirstTime",value:function(e){this.importDetails.firstTimeCell=e,this.markFirstTime()}},{key:"markFirstTime",value:function(){var e=this.firstTimeCell;e&&(this.importDetails.inRows?this.tableSelector.toggleRow(e,!0,be.TIME_BACKGROUND,be.FIRST_TIME_BACKGROUND):this.tableSelector.toggleCol(e,!0,be.TIME_BACKGROUND,be.FIRST_TIME_BACKGROUND))}},{key:"selectLabels",value:function(e){this.importDetails.labelsSelection=e,this.markLabels()}},{key:"markLabels",value:function(){var e=this.labelsSelection;e&&(this.importDetails.inRows?this.tableSelector.toggleCol(e,!1,be.LABELS_BACKGROUND):this.tableSelector.toggleRow(e,!1,be.LABELS_BACKGROUND))}},{key:"selectDataStart",value:function(e){e?this.importDetails.inRows?this.firstTimeCell&&this.firstTimeCell.rowIx===e.rowIx||(this.importDetails.dataStart=e):this.firstTimeCell&&this.firstTimeCell.colIx===e.colIx||(this.importDetails.dataStart=e):this.importDetails.dataStart=void 0,this.markDataStart()}},{key:"markDataStart",value:function(){var e=this.dataStart;e&&(this.importDetails.inRows?this.tableSelector.toggleRowSelection(1,e,!1,be.FIST_DATA_BACKGROUND):this.tableSelector.toggleColSelection(1,e,!1,be.FIST_DATA_BACKGROUND))}},{key:"reselect",value:function(e){if(this.dataSlice&&e){var t=this.dataSlice,i=e.colIx,a=e.rowIx;if(!(i>=t.columnsNumbers.length||a>=t.rowsNumbers.length)){var l=new g.a(i,t.columnsNumbers[i],t.columnsNames[i],a,t.rowsNumbers[a],t.rowsNames[a],(a>=0?t.data[a]:[])[i]);return l.fake=e.fake,l}}}},{key:"hasMoreTimes",value:function(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns:this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows)}},{key:"hasMoreLabels",value:function(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows:this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns)}},{key:"firstTimeCell",get:function(){return this.importDetails?this.importDetails.firstTimeCell:void 0}},{key:"labelsSelection",get:function(){return this.importDetails?this.importDetails.labelsSelection:void 0}},{key:"dataStart",get:function(){return this.importDetails?this.importDetails.dataStart:void 0}}]),e}()).\u0275fac=function(e){return new(e||ne)(S.Nb(_),S.Nb(E.a))},ne.\u0275dir=S.Ib({type:ne}),ne),he=s("+0xr"),pe=["table"];function ge(e,t){1&e&&S.Ob(0,"th",10)}function ve(e,t){if(1&e){var i=S.Ub();S.Tb(0,"td",11),S.Zb("click",(function(){S.sc(i);var e=t.index;return S.dc(2).selectCell(-1,e)})),S.Tb(1,"label"),S.Dc(2),S.Sb(),S.Sb()}if(2&e){var a=t.index,l=S.dc(2);S.Bb(2),S.Ec(l.rowsNames[a])}}function Se(e,t){if(1&e){var i=S.Ub();S.Tb(0,"th",15),S.Zb("click",(function(){S.sc(i);var e=S.dc().index;return S.dc(2).selectCell(e,-1)})),S.Dc(1),S.Sb()}if(2&e){var a=S.dc(),l=a.index,o=a.$implicit,n=S.dc(2);S.yc("background-color",n.colBackground(l)),S.Bb(1),S.Fc(" ",o," ")}}function we(e,t){if(1&e){var i=S.Ub();S.Tb(0,"td",16),S.Zb("click",(function(){S.sc(i);var e=t.index,a=S.dc().index;return S.dc(2).selectCell(a,e)})),S.Dc(1),S.Sb()}if(2&e){var a=t.$implicit,l=t.index,o=S.dc().index,n=S.dc(2);S.yc("background-color",n.cellBackground(o,l)),S.Bb(1),S.Fc(" ",a[o]," ")}}function De(e,t){1&e&&(S.Rb(0,12),S.Bc(1,Se,2,3,"th",13),S.Bc(2,we,2,3,"td",14),S.Qb()),2&e&&S.jc("matColumnDef",t.$implicit)}function ye(e,t){1&e&&S.Ob(0,"tr",17)}function ke(e,t){if(1&e&&S.Ob(0,"tr",18),2&e){var i=t.index,a=S.dc(2);S.yc("background-color",a.rowBackground(i))}}function Te(e,t){if(1&e&&(S.Tb(0,"div",1),S.Tb(1,"table",2,3),S.Rb(3,4),S.Bc(4,ge,1,0,"th",5),S.Bc(5,ve,3,1,"td",6),S.Qb(),S.Bc(6,De,3,1,"ng-container",7),S.Bc(7,ye,1,0,"tr",8),S.Bc(8,ke,1,2,"tr",9),S.Sb(),S.Sb()),2&e){var i=S.dc();S.Bb(1),S.jc("dataSource",i.data),S.Bb(5),S.jc("ngForOf",i.columnsNames),S.Bb(1),S.jc("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),S.Bb(1),S.jc("matRowDefColumns",i.displayedColumns)}}var Ce,Be=((Ce=function(){function e(){u(this,e),this.columnsNames=[],this.rowsNames=[],this.data=[],this.styler=new ue,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.selected=new S.o}return m(e,[{key:"colNumber",value:function(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}},{key:"rowNumber",value:function(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}},{key:"colBackground",value:function(e){return this.styler.colBackground(this.colNumber(e))}},{key:"rowBackground",value:function(e){return this.styler.rowBackground(this.rowNumber(e))}},{key:"cellBackground",value:function(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}},{key:"ngOnInit",value:function(){}},{key:"selectCell",value:function(e,t){if((!(e<0)||this.selectableRowHeader)&&(!(t<0)||this.selectableColHeader)){var i=new g.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selected.next(i)}}},{key:"dataSlice",set:function(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.displayedColumns=["rowNr"].concat(this.columnsNames),this.data=e.data,this.matTable&&this.matTable.renderRows())},get:function(){return this._dataSlice}}]),e}()).\u0275fac=function(e){return new(e||Ce)},Ce.\u0275cmp=S.Hb({type:Ce,selectors:[["bd2-data-sheet-mdtable"]],viewQuery:function(e,t){var i;1&e&&S.Ic(pe,!0),2&e&&S.pc(i=S.ac())&&(t.matTable=i.first)},inputs:{dataSlice:"dataSlice",styler:"styler",selectableColHeader:"selectableColHeader",selectableRowHeader:"selectableRowHeader"},outputs:{selected:"selected"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color","click",4,"matHeaderCellDef"],["mat-cell","","matRipple","","matRippleCentered","true",3,"background-color","click",4,"matCellDef"],["mat-header-cell","",3,"click"],["mat-cell","","matRipple","","matRippleCentered","true",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&S.Bc(0,Te,9,5,"div",0),2&e&&S.jc("ngIf",t.dataSlice)},directives:[f.m,he.n,he.c,he.i,he.b,f.l,he.k,he.m,he.h,he.a,Z.r,he.j,he.l],styles:[".data-sheet-container[_ngcontent-%COMP%] {\n      max-height: 300px;\n      overflow: auto;\n    }\n\n    .mat-table-sticky[_ngcontent-%COMP%]:first-child {\n      border-right: 1px solid #e0e0e0;\n      padding-right: 1em;\n    }\n\n\n    .mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%] {\n      padding-left: 0.5em;\n      padding-right: 0.5em;\n    }\n\n    label[_ngcontent-%COMP%] {\n      color: rgba(0,0,0,0.54);\n    }"]}),Ce),Ie=s("qFsG");function Ne(e,t){if(1&e&&(S.Tb(0,"mat-option",9),S.Dc(1),S.Sb()),2&e){var i=t.$implicit;S.jc("value",i),S.Bb(1),S.Ec(i.label)}}function Re(e,t){if(1&e){var i=S.Ub();S.Tb(0,"p"),S.Tb(1,"mat-form-field"),S.Tb(2,"input",10),S.Zb("ngModelChange",(function(e){return S.sc(i),S.dc(3).importDetails.imgInterval=e})),S.Sb(),S.Sb(),S.Sb()}if(2&e){var a=S.dc(3);S.Bb(2),S.jc("ngModel",a.importDetails.imgInterval)}}function Le(e,t){if(1&e&&(S.Tb(0,"div",11),S.Dc(1),S.Sb()),2&e){var i=S.dc(3);S.Bb(1),S.Fc(" The first time point value ",i.firstTimeCell.value," does not look like a number; ")}}function xe(e,t){if(1&e){var i=S.Ub();S.Tb(0,"div"),S.Tb(1,"p"),S.Dc(2),S.Tb(3,"strong"),S.Dc(4),S.Sb(),S.Dc(5,"\xa0 First time point: "),S.Tb(6,"strong"),S.Dc(7),S.Sb(),S.Dc(8),S.Sb(),S.Tb(9,"p"),S.Tb(10,"mat-form-field"),S.Tb(11,"mat-label"),S.Dc(12,"Time unit"),S.Sb(),S.Tb(13,"mat-select",5),S.Zb("valueChange",(function(e){return S.sc(i),S.dc(2).importDetails.timeType=e})),S.Bc(14,Ne,2,2,"mat-option",6),S.Sb(),S.Sb(),S.Sb(),S.Tb(15,"p"),S.Tb(16,"mat-form-field"),S.Tb(17,"input",7),S.Zb("ngModelChange",(function(e){return S.sc(i),S.dc(2).importDetails.timeOffset=e})),S.Sb(),S.Sb(),S.Sb(),S.Bc(18,Re,3,1,"p",2),S.Bc(19,Le,2,1,"div",8),S.Sb()}if(2&e){var a=S.dc(2);S.Bb(2),S.Fc("Times in ",a.importDetails.inLabel," "),S.Bb(2),S.Fc("",a.importDetails.inRows?a.firstTimeCell.rowName:a.firstTimeCell.colName,";"),S.Bb(3),S.Gc("",a.firstTimeCell.value," ",null==a.importDetails.timeType?null:a.importDetails.timeType.unit,""),S.Bb(1),S.Fc(" [",a.firstTimeCell.colName+":"+a.firstTimeCell.rowName,"] "),S.Bb(5),S.jc("value",a.importDetails.timeType),S.Bb(1),S.jc("ngForOf",a.timeTypeOptions),S.Bb(3),S.jc("ngModel",a.importDetails.timeOffset),S.Bb(1),S.jc("ngIf","IMG_NUMBER"==(null==a.importDetails.timeType?null:a.importDetails.timeType.name)),S.Bb(1),S.jc("ngIf",a.firstTimeNotNumber())}}function Oe(e,t){if(1&e&&(S.Tb(0,"div",12),S.Dc(1),S.Sb()),2&e){var i=S.dc(2);S.Bb(1),S.Fc(" Even if only the top part of the data table is presented all times from the selected ",i.importDetails.inLabel," will be imported ")}}function Fe(e,t){if(1&e){var i=S.Ub();S.Tb(0,"mat-card",1),S.Tb(1,"mat-card-content"),S.Bc(2,xe,20,10,"div",2),S.Tb(3,"div"),S.Tb(4,"div"),S.Dc(5),S.Sb(),S.Sb(),S.Tb(6,"bd2-data-sheet-mdtable",3),S.Zb("selected",(function(e){return S.sc(i),S.dc().selectFirstTime(e)})),S.Sb(),S.Bc(7,Oe,2,1,"div",4),S.Sb(),S.Sb()}if(2&e){var a=S.dc();S.Bb(2),S.jc("ngIf",a.firstTimeCell),S.Bb(2),S.Db(a.firstTimeCell?"alert alert-info":"alert alert-danger"),S.Bb(1),S.Fc(" Click on the first timepoint in the time ",a.importDetails.inLabel," and then select a time unit. "),S.Bb(1),S.jc("dataSlice",a.dataSlice)("styler",a.tableSelector.tableStyler),S.Bb(1),S.jc("ngIf",a.hasMoreTimes())}}var je,Pe,_e=((je=function(e){i(o,e);var a=l(o);function o(e,t){var i;return u(this,o),(i=a.call(this,e,t)).timeTypeOptions=[y.h.TIME_IN_HOURS,y.h.TIME_IN_MINUTES,y.h.TIME_IN_SECONDS,y.h.IMG_NUMBER],i}return m(o,[{key:"applyDefaultSelections",value:function(){if(t(n(o.prototype),"applyDefaultSelections",this).call(this),this.firstTimeCell&&!this.firstTimeCell.fake)this.selectFirstTime(this.reselect(this.firstTimeCell));else{var e=this.importDetails.inRows?new g.a(1,this.colNumber(1),void 0,0,this.rowNumber(0),void 0,void 0):new g.a(0,this.colNumber(0),void 0,1,this.rowNumber(1),void 0,void 0);(e=this.reselect(e)).fake=!0,this.selectFirstTime(e)}}},{key:"firstTimeNotNumber",value:function(){return!!this.firstTimeCell&&isNaN(Number(this.firstTimeCell.value))}}]),o}(fe)).\u0275fac=function(e){return new(e||je)(S.Nb(_),S.Nb(E.a))},je.\u0275cmp=S.Hb({type:je,selectors:[["bd2-define-time-step"]],inputs:{importDetails:"importDetails"},features:[S.yb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["required","",3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","placeholder","Time offset",3,"ngModel","ngModelChange"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"value"],["matInput","","type","number","placeholder","Images interval (hours)","required","",3,"ngModel","ngModelChange"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(e,t){1&e&&S.Bc(0,Fe,8,7,"mat-card",0),2&e&&S.jc("ngIf",t.importDetails)},directives:[f.m,A.a,A.c,Be,U.c,U.g,H.a,f.l,Ie.b,h.v,h.d,h.q,h.t,Z.o,h.z],encapsulation:2}),je),Ee=s("0IaG"),Me=((Pe=function(){function e(t,i){u(this,e),this.dialogRef=t,this.data=i}return m(e,[{key:"ngOnInit",value:function(){}},{key:"sendLabel",value:function(){this.dialogRef.close(this.data.label)}}]),e}()).\u0275fac=function(e){return new(e||Pe)(S.Nb(Ee.g),S.Nb(Ee.a))},Pe.\u0275cmp=S.Hb({type:Pe,selectors:[["bd2-edit-label-dialog"]],decls:20,vars:6,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","cdkFocusInitial","",3,"ngModel","ngModelChange","keydown.enter"],["align","start"],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-raised-button","","color","primary",3,"mat-dialog-close"],["ok",""]],template:function(e,t){1&e&&(S.Tb(0,"h1",0),S.Dc(1),S.Sb(),S.Tb(2,"div",1),S.Tb(3,"p"),S.Dc(4),S.Sb(),S.Tb(5,"mat-form-field"),S.Tb(6,"input",2),S.Zb("ngModelChange",(function(e){return t.data.label=e}))("keydown.enter",(function(){return t.sendLabel()})),S.Sb(),S.Tb(7,"mat-hint",3),S.Dc(8,"Pressing "),S.Tb(9,"strong"),S.Dc(10,"Enter"),S.Sb(),S.Dc(11," submits "),S.Sb(),S.Sb(),S.Sb(),S.Tb(12,"div",4),S.Tb(13,"button",5),S.Dc(14,"Cancel"),S.Sb(),S.Tb(15,"button",5),S.Dc(16,"Clear"),S.Sb(),S.Tb(17,"button",6,7),S.Dc(19,"Assign"),S.Sb(),S.Sb()),2&e&&(S.Bb(1),S.Ec(t.data.title),S.Bb(3),S.Fc("Write label for ",t.data.regionName,""),S.Bb(2),S.jc("ngModel",t.data.label),S.Bb(7),S.jc("mat-dialog-close",void 0),S.Bb(2),S.jc("mat-dialog-close",""),S.Bb(2),S.jc("mat-dialog-close",t.data.label))},directives:[Ee.h,Ee.e,U.c,Ie.b,h.d,h.q,h.t,U.f,Ee.c,ce.a,Ee.d],encapsulation:2}),Pe),Ae=["table"];function Ue(e,t){1&e&&S.Ob(0,"th",20)}function He(e,t){if(1&e){var i=S.Ub();S.Tb(0,"td",21),S.Zb("mousedown",(function(){S.sc(i);var e=t.index;return S.dc(2).startSelectCell(-1,e)}))("mouseup",(function(){S.sc(i);var e=t.index;return S.dc(2).endSelectCell(-1,e)})),S.Tb(1,"label"),S.Dc(2),S.Sb(),S.Sb()}if(2&e){var a=t.index,l=S.dc(2);S.Bb(2),S.Ec(l.rowsNames[a])}}function ze(e,t){if(1&e){var i=S.Ub();S.Tb(0,"td",22),S.Zb("click",(function(){return S.sc(i),S.dc(2).nextRow()})),S.Dc(1),S.Sb()}if(2&e){var a=S.dc(2);S.Bb(1),S.Ec(a.hasMoreRows?"...":"end")}}function Ze(e,t){1&e&&(S.Tb(0,"th",20),S.Dc(1,"Labels"),S.Sb())}function We(e,t){if(1&e){var i=S.Ub();S.Tb(0,"td",21),S.Zb("mousedown",(function(){S.sc(i);var e=t.index;return S.dc(2).startSelectCell(-1,e)}))("mouseup",(function(){S.sc(i);var e=t.index;return S.dc(2).endSelectCell(-1,e)})),S.Tb(1,"label",23),S.Dc(2),S.Sb(),S.Sb()}if(2&e){var a=t.index,l=S.dc(2);S.Bb(2),S.Ec(l.rowsLabels[a])}}function Ge(e,t){if(1&e){var i=S.Ub();S.Tb(0,"td",22),S.Zb("click",(function(){return S.sc(i),S.dc(2).nextRow()})),S.Sb()}}function $e(e,t){if(1&e){var i=S.Ub();S.Tb(0,"th",27),S.Zb("mousedown",(function(){S.sc(i);var e=S.dc().index;return S.dc(2).startSelectCell(e,-1)}))("mouseup",(function(){S.sc(i);var e=S.dc().index;return S.dc(2).endSelectCell(e,-1)})),S.Dc(1),S.Sb()}if(2&e){var a=S.dc(),l=a.index,o=a.$implicit,n=S.dc(2);S.yc("background-color",n.colBackground(l)),S.Bb(1),S.Fc(" ",o," ")}}function Ke(e,t){if(1&e&&(S.Tb(0,"td",28),S.Dc(1),S.Sb()),2&e){var i=t.$implicit,a=t.index,l=S.dc().index,o=S.dc(2);S.yc("background-color",o.cellBackground(l,a)),S.Bb(1),S.Fc(" ",i[l]," ")}}function qe(e,t){if(1&e){var i=S.Ub();S.Tb(0,"td",22),S.Zb("click",(function(){return S.sc(i),S.dc(3).nextRow()})),S.Dc(1),S.Sb()}if(2&e){var a=S.dc(3);S.Bb(1),S.Ec(a.hasMoreRows?"...":"")}}function Qe(e,t){1&e&&(S.Rb(0,24),S.Bc(1,$e,2,3,"th",25),S.Bc(2,Ke,2,3,"td",26),S.Bc(3,qe,2,1,"td",7),S.Qb()),2&e&&S.jc("matColumnDef",t.$implicit)}function Ve(e,t){if(1&e){var i=S.Ub();S.Tb(0,"th",29),S.Zb("click",(function(){return S.sc(i),S.dc(2).nextColumn()})),S.Dc(1,"..."),S.Sb()}}function Xe(e,t){if(1&e){var i=S.Ub();S.Tb(0,"td",30),S.Zb("click",(function(){return S.sc(i),S.dc(2).nextColumn()})),S.Dc(1,"..."),S.Sb()}}function Je(e,t){1&e&&S.Ob(0,"td",31)}function Ye(e,t){1&e&&(S.Tb(0,"th",20),S.Dc(1,"Labels"),S.Sb())}function et(e,t){1&e&&S.Ob(0,"th",20)}function tt(e,t){if(1&e){var i=S.Ub();S.Tb(0,"th",27),S.Zb("mousedown",(function(){S.sc(i);var e=S.dc().index;return S.dc(3).startSelectCell(e,-1)}))("mouseup",(function(){S.sc(i);var e=S.dc().index;return S.dc(3).endSelectCell(e,-1)})),S.Tb(1,"label",23),S.Dc(2),S.Sb(),S.Sb()}if(2&e){var a=S.dc().index,l=S.dc(3);S.yc("background-color",l.colBackground(a)),S.Bb(2),S.Ec(l.columnsLabels[a])}}function it(e,t){1&e&&(S.Rb(0,24),S.Bc(1,tt,3,3,"th",25),S.Qb()),2&e&&S.jc("matColumnDef","label"+t.index)}function at(e,t){if(1&e&&(S.Rb(0),S.Bc(1,it,2,1,"ng-container",9),S.Qb()),2&e){var i=S.dc(2);S.Bb(1),S.jc("ngForOf",i.columnsNames)}}function lt(e,t){1&e&&S.Ob(0,"tr",32)}function ot(e,t){1&e&&S.Ob(0,"tr",32)}function nt(e,t){if(1&e&&(S.Rb(0),S.Bc(1,ot,1,0,"tr",17),S.Qb()),2&e){var i=S.dc(2);S.Bb(1),S.jc("matHeaderRowDef",i.displayedLabelsColumns)("matHeaderRowDefSticky",!0)}}function rt(e,t){if(1&e&&S.Ob(0,"tr",33),2&e){var i=t.index,a=S.dc(2);S.yc("background-color",a.rowBackground(i))}}function st(e,t){1&e&&S.Ob(0,"tr",34)}function ct(e,t){if(1&e&&(S.Tb(0,"div",1),S.Tb(1,"table",2,3),S.Rb(3,4),S.Bc(4,Ue,1,0,"th",5),S.Bc(5,He,3,1,"td",6),S.Bc(6,ze,2,1,"td",7),S.Qb(),S.Rb(7,8),S.Bc(8,Ze,2,0,"th",5),S.Bc(9,We,3,1,"td",6),S.Bc(10,Ge,1,0,"td",7),S.Qb(),S.Bc(11,Qe,4,1,"ng-container",9),S.Rb(12,10),S.Bc(13,Ve,2,0,"th",11),S.Bc(14,Xe,2,0,"td",12),S.Bc(15,Je,1,0,"td",13),S.Qb(),S.Rb(16,14),S.Bc(17,Ye,2,0,"th",5),S.Qb(),S.Rb(18,15),S.Bc(19,et,1,0,"th",5),S.Qb(),S.Bc(20,at,2,1,"ng-container",16),S.Bc(21,lt,1,0,"tr",17),S.Bc(22,nt,2,2,"ng-container",16),S.Bc(23,rt,1,2,"tr",18),S.Bc(24,st,1,0,"tr",19),S.Sb(),S.Sb()),2&e){var i=S.dc();S.Bb(1),S.jc("dataSource",i.data),S.Bb(10),S.jc("ngForOf",i.columnsNames),S.Bb(9),S.jc("ngIf",i.showColumnsLabels),S.Bb(1),S.jc("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),S.Bb(1),S.jc("ngIf",i.showColumnsLabels),S.Bb(1),S.jc("matRowDefColumns",i.displayedColumns),S.Bb(1),S.jc("matFooterRowDef",i.displayedColumns)}}var ut,bt=((ut=function(){function e(){u(this,e),this.columnsNames=[],this.rowsNames=[],this.data=[],this.hasMoreColumns=!1,this.hasMoreRows=!1,this._columnsLabels=[],this._rowsLabels=[],this.styler=new ue,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.showColumnsLabels=!1,this.showRowsLabels=!1,this.selected=new S.o,this.moreRows=new S.o,this.moreColumns=new S.o}return m(e,[{key:"decideColumns",value:function(){this.displayedColumns=(this.showRowsLabels?["rowNr","rowLabel"]:["rowNr"]).concat(this.columnsNames),this.displayedLabelsColumns=(this.showRowsLabels?["rowNr2","rowLabel2"]:["rowNr2"]).concat(this.columnsNames.map((function(e,t){return"label"+t}))),this.hasMoreColumns&&(this.displayedColumns.push("more"),this.displayedLabelsColumns.push("more"))}},{key:"ngOnInit",value:function(){}},{key:"colNumber",value:function(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}},{key:"rowNumber",value:function(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}},{key:"colBackground",value:function(e){return this.styler.colBackground(this.colNumber(e))}},{key:"rowBackground",value:function(e){return this.styler.rowBackground(this.rowNumber(e))}},{key:"cellBackground",value:function(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}},{key:"startSelectCell",value:function(e,t){if((!(e<0)||this.selectableRowHeader)&&(!(t<0)||this.selectableColHeader)){var i=new g.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selectionStart=i}}},{key:"endSelectCell",value:function(e,t){if(this.selectionStart)if(t<0&&this.selectionStart.rowIx>=0)this.selectionStart=void 0;else if(e<0&&this.selectionStart.colIx>=0)this.selectionStart=void 0;else if((!(e<0)||this.selectableRowHeader)&&(!(t<0)||this.selectableColHeader)){var i=new g.a(e,this._dataSlice.columnsNumbers[e],this._dataSlice.columnsNames[e],t,this._dataSlice.rowsNumbers[t],this._dataSlice.rowsNames[t],(t>=0?this.data[t]:[])[e]);this.selected.next([this.selectionStart,i])}}},{key:"nextColumn",value:function(){this.moreColumns.next(!0)}},{key:"nextRow",value:function(){this.moreRows.next(!0)}},{key:"columnsLabels",set:function(e){this._columnsLabels=e},get:function(){return this._columnsLabels}},{key:"rowsLabels",set:function(e){this._rowsLabels=e},get:function(){return this._rowsLabels}},{key:"dataSlice",set:function(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.data=e.data,this.hasMoreColumns=e.columnsNumbers[e.columnsNumbers.length-1]<e.totalColumns-1,this.hasMoreRows=e.rowsNumbers[e.rowsNumbers.length-1]<e.totalRows-1,this.decideColumns(),this.matTable&&this.matTable.renderRows())},get:function(){return this._dataSlice}},{key:"selectRows",set:function(e){this.selectableRowHeader=e,this.showRowsLabels=e,this.decideColumns()}},{key:"selectCols",set:function(e){this.selectableColHeader=e,this.showColumnsLabels=e,this.decideColumns()}}]),e}()).\u0275fac=function(e){return new(e||ut)},ut.\u0275cmp=S.Hb({type:ut,selectors:[["bd2-selectable-region-mdtable"]],viewQuery:function(e,t){var i;1&e&&S.Ic(Ae,!0),2&e&&S.pc(i=S.ac())&&(t.matTable=i.first)},inputs:{columnsLabels:"columnsLabels",rowsLabels:"rowsLabels",dataSlice:"dataSlice",selectRows:"selectRows",selectCols:"selectCols",styler:"styler"},outputs:{selected:"selected",moreRows:"moreRows",moreColumns:"moreColumns"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"mousedown","mouseup",4,"matCellDef"],["mat-footer-cell","",3,"click",4,"matFooterCellDef"],["matColumnDef","rowLabel","sticky",""],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","more","sticky",""],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","rowNr2","sticky",""],["matColumnDef","rowLabel2","sticky",""],[4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell","","matRipple","",3,"mousedown","mouseup"],["mat-footer-cell","",3,"click"],[1,"user"],[3,"matColumnDef"],["mat-header-cell","","matRipple","",3,"background-color","mousedown","mouseup",4,"matHeaderCellDef"],["mat-cell","",3,"background-color",4,"matCellDef"],["mat-header-cell","","matRipple","",3,"mousedown","mouseup"],["mat-cell",""],["mat-header-cell","",3,"click"],["mat-cell","",3,"click"],["mat-footer-cell",""],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(e,t){1&e&&S.Bc(0,ct,25,8,"div",0),2&e&&S.jc("ngIf",t.dataSlice)},directives:[f.m,he.n,he.c,he.i,he.b,he.e,f.l,he.k,he.m,he.g,he.h,he.a,Z.r,he.d,he.j,he.l,he.f],styles:[".data-sheet-container[_ngcontent-%COMP%] {\n      max-height: 800px;\n      overflow: auto;\n    }\n\n    .mat-table-sticky[_ngcontent-%COMP%]:first-child {\n      border-right: 1px solid #e0e0e0;\n      padding-right: 1em;\n    }\n\n\n    .mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%] {\n      padding-left: 0.5em;\n      padding-right: 0.5em;\n    }\n\n    label[_ngcontent-%COMP%] {\n      color: rgba(0,0,0,0.54);\n    }\n\n    label.user[_ngcontent-%COMP%] {\n      color: black;\n    }"]}),ut),mt=["colPaginator"],dt=["rowPaginator"];function ft(e,t){if(1&e&&(S.Tb(0,"div",9),S.Dc(1),S.Sb()),2&e){var i=S.dc();S.Bb(1),S.Fc(" You have not seen yet all the available ",null==i.importDetails?null:i.importDetails.inLabel,"s for labelling\n")}}var ht,pt=function(){return[10,25,50,100]},gt=((ht=function(e){i(o,e);var a=l(o);function o(e,t,i){var l;return u(this,o),(l=a.call(this,t,i)).dialog=e,l.columnsLabels=[],l.rowsLabels=[],l.colorer=new de,l}return m(o,[{key:"ngOnInit",value:function(){t(n(o.prototype),"ngOnInit",this).call(this)}},{key:"ngOnDestroy",value:function(){t(n(o.prototype),"ngOnDestroy",this).call(this),this.dataService&&this.dataService.close()}},{key:"ngAfterViewInit",value:function(){this.colPaginator._intl=new O.b,this.colPaginator._intl.itemsPerPageLabel="Columns per page",this.rowPaginator._intl=new O.b,this.rowPaginator._intl.itemsPerPageLabel="Rows per page"}},{key:"markSelections",value:function(){t(n(o.prototype),"markSelections",this).call(this),this.markFirstTime(),this.loadLabels(),this.markLabels(),this.labelsSummary=this.importDetails.summarizeLabels(25),this.labelTime()}},{key:"labelTime",value:function(){if(this.firstTimeCell)if(this.importDetails.inRows){var e=this.dataSlice.rowsNumbers.indexOf(this.firstTimeCell.rowNumber);e>=0&&(this.rowsLabels[e]="Time")}else{var t=this.dataSlice.columnsNumbers.indexOf(this.firstTimeCell.colNumber);t>=0&&(this.columnsLabels[t]="Time")}}},{key:"loadLabels",value:function(){var e=this.dataSlice;this.importDetails.inRows?(this.rowsLabels=this.userLabels.slice(e.rowsNumbers[0],e.rowsNumbers[e.rowsNumbers.length-1]),this.columnsLabels=[]):(this.rowsLabels=[],this.columnsLabels=this.userLabels.slice(e.columnsNumbers[0],e.columnsNumbers[e.columnsNumbers.length-1]))}},{key:"markLabels",value:function(){var e=this;this.userLabels.forEach((function(t,i){e.importDetails.inRows?e.tableSelector.selectRow(i,e.colorer.toColor(t)):e.tableSelector.selectCol(i,e.colorer.toColor(t))}))}},{key:"hasSeenAll",value:function(){return!!this.dataSlice&&(this.importDetails.inRows?this.lastRowSeen>=this.dataSlice.totalRows-1:this.lastColumnSeen>=this.dataSlice.totalColumns-1)}},{key:"selected",value:function(e){e[1].isBeforeOrSame(e[0])&&(e=[e[1],e[0]]),this.importDetails.inRows?this.labelRows(e[0],e[1]):this.labelColumns(e[0],e[1])}},{key:"setUserLabel",value:function(e,t){this.userLabels[e]=t||void 0,this.labelsSummary=this.importDetails.summarizeLabels(25)}},{key:"askForLabel",value:function(e,t,i){var a;return a=i?{title:"Label rows",regionName:e.hasSameIx(t)?"row "+e.rowName:"rows "+e.rowName+"-"+t.rowName,label:this.userLabels[e.rowNumber]}:{title:"Label columns",regionName:e.hasSameIx(t)?"column "+e.colName:"columns "+e.colName+"-"+t.colName,label:this.userLabels[e.rowNumber]},this.dialog.open(Me,{data:a}).afterClosed()}},{key:"labelRows",value:function(e,t){var i=this;e.rowIx<0||t.rowIx<0?console.warn("Label rows with col selection",e):this.firstTimeCell&&this.firstTimeCell.rowNumber>=e.rowNumber||this.askForLabel(e,t,!0).subscribe((function(a){void 0!==a&&(i.setRowsLabel(e,t,a),a&&i.selectNextRegion(e,t))}))}},{key:"setRowsLabel",value:function(e,t,i){i=i.trim();for(var a=this.colorer.toColor(i),l=e.rowIx;l<=t.rowIx;l++){var o=this.dataSlice.rowsNumbers[l];void 0===o?console.error("No row number for index "+l):(this.rowsLabels[l]=i,this.setUserLabel(o,i),i?this.tableSelector.selectRow(o,a):this.tableSelector.deselectRow(o))}}},{key:"labelColumns",value:function(e,t){var i=this;e.colIx<0||t.colIx<0?console.warn("Label cols with row selection",e):this.firstTimeCell&&this.firstTimeCell.colNumber>=e.colNumber?console.log("Ignroing labelling as Time col after selection"):this.askForLabel(e,t,!1).subscribe((function(a){void 0!==a&&(i.setColumnsLabel(e,t,a),a&&i.selectNextRegion(e,t))}))}},{key:"setColumnsLabel",value:function(e,t,i){i=i.trim();for(var a=this.colorer.toColor(i),l=e.colIx;l<=t.colIx;l++){var o=this.dataSlice.columnsNumbers[l];void 0===o?console.error("No col number for index "+l):(this.columnsLabels[l]=i,this.setUserLabel(o,i),i?this.tableSelector.selectCol(o,a):this.tableSelector.deselectCol(o))}}},{key:"selectNextRegion",value:function(e,t){var i=[t.colIx-e.colIx,t.rowIx-e.rowIx],a=this.moveCell(t,[1,1]),l=this.moveCell(a,i);this.isInPage(a)&&(this.isInPage(l)||(l=this.fitToPage(l)),a=this.reselect(a),l=this.reselect(l),this.selected([a,l]))}},{key:"isInPage",value:function(e){return!(e.colIx>=0&&e.colIx>=this.dataSlice.columnsNumbers.length||e.rowIx>=0&&e.rowIx>=this.dataSlice.rowsNumbers.length)}},{key:"fitToPage",value:function(e){return new g.a(e.colIx>=0?this.dataSlice.columnsNumbers.length-1:-1,void 0,void 0,e.rowIx>=0?this.dataSlice.rowsNumbers.length-1:-1,void 0,void 0,void 0)}},{key:"moveCell",value:function(e,t){return new g.a(e.colIx>=0?e.colIx+t[0]:-1,void 0,void 0,e.rowIx>=0?e.rowIx+t[1]:-1,void 0,void 0,void 0)}},{key:"loadColPage",value:function(e){this.dataService.slice(new F(this.currentPageSlice.rowPage,e))}},{key:"loadRowPage",value:function(e){this.dataService.slice(new F(e,this.currentPageSlice.colPage))}},{key:"moreColumns",value:function(){this.importDetails.inRows||this.colPaginator.nextPage()}},{key:"moreRows",value:function(){this.importDetails.inRows&&this.rowPaginator.nextPage()}},{key:"userLabels",get:function(){return this.importDetails?this.importDetails.userLabels:void 0}}]),o}(fe)).\u0275fac=function(e){return new(e||ht)(S.Nb(Ee.b),S.Nb(_),S.Nb(E.a))},ht.\u0275cmp=S.Hb({type:ht,selectors:[["bd2-assign-labels-step"]],viewQuery:function(e,t){var i;1&e&&(S.xc(mt,!0),S.xc(dt,!0)),2&e&&(S.pc(i=S.ac())&&(t.colPaginator=i.first),S.pc(i=S.ac())&&(t.rowPaginator=i.first))},inputs:{importDetails:"importDetails"},features:[S.Ab([_]),S.yb],decls:14,vars:23,consts:[["role","alert","type","info",1,"alert","alert-info",3,"hidden"],[3,"hidden"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["colPaginator",""],[3,"dataSlice","columnsLabels","rowsLabels","styler","selectRows","selectCols","selected","moreColumns","moreRows"],[3,"length","disabled","pageSize","pageSizeOptions","page"],["rowPaginator",""],["type","danger","class","alert alert-danger mt-2","role","alert",4,"ngIf"],[2,"margin-top","1em"],["type","danger","role","alert",1,"alert","alert-danger","mt-2"]],template:function(e,t){1&e&&(S.Tb(0,"div",0),S.Dc(1),S.Sb(),S.Tb(2,"div",1),S.Tb(3,"mat-paginator",2,3),S.Zb("page",(function(e){return t.loadColPage(e)})),S.Sb(),S.Sb(),S.Tb(5,"bd2-selectable-region-mdtable",4),S.Zb("selected",(function(e){return t.selected(e)}))("moreColumns",(function(){return t.moreColumns()}))("moreRows",(function(){return t.moreRows()})),S.Sb(),S.Tb(6,"div",1),S.Tb(7,"mat-paginator",5,6),S.Zb("page",(function(e){return t.loadRowPage(e)})),S.Sb(),S.Sb(),S.Bc(9,ft,2,1,"div",7),S.Tb(10,"div",8),S.Tb(11,"label"),S.Dc(12,"Selected labels: "),S.Sb(),S.Dc(13),S.Sb()),2&e&&(S.jc("hidden",(null==t.importDetails||null==t.importDetails.userLabels?null:t.importDetails.userLabels.length)>1),S.Bb(1),S.Fc(" Click and drag over ",null==t.importDetails?null:t.importDetails.inLabel," headers to label the data.\n"),S.Bb(1),S.jc("hidden",null==t.importDetails?null:t.importDetails.inRows),S.Bb(1),S.jc("length",null==t.dataSlice?null:t.dataSlice.totalColumns)("disabled",null==t.importDetails?null:t.importDetails.inRows)("pageSize",t.currentPageSlice.colPage.pageSize)("pageIndex",t.currentPageSlice.colPage.pageIndex)("pageSizeOptions",S.lc(21,pt)),S.Bb(2),S.jc("dataSlice",t.dataSlice)("columnsLabels",t.columnsLabels)("rowsLabels",t.rowsLabels)("styler",t.tableSelector.tableStyler)("selectRows",null==t.importDetails?null:t.importDetails.inRows)("selectCols",!(null!=t.importDetails&&t.importDetails.inRows)),S.Bb(1),S.jc("hidden",!(null!=t.importDetails&&t.importDetails.inRows)),S.Bb(1),S.jc("length",null==t.dataSlice?null:t.dataSlice.totalRows)("disabled",!(null!=t.importDetails&&t.importDetails.inRows))("pageSize",t.firstPageSlice.rowPage.pageSize)("pageSizeOptions",S.lc(22,pt)),S.Bb(2),S.jc("ngIf",!t.hasSeenAll()),S.Bb(4),S.Fc("",t.labelsSummary,"\n"))},directives:[O.a,bt,f.m],encapsulation:2}),ht);function vt(e,t){if(1&e&&(S.Tb(0,"div",7),S.Dc(1),S.Sb()),2&e){var i=S.dc(3);S.Bb(1),S.Fc(" Labels ",i.importDetails.inLabelNeg," must be before first time point. ")}}function St(e,t){if(1&e&&(S.Tb(0,"div"),S.Tb(1,"p"),S.Dc(2),S.Tb(3,"strong"),S.Dc(4),S.Sb(),S.Sb(),S.Bc(5,vt,2,1,"div",6),S.Sb()),2&e){var i=S.dc(2);S.Bb(2),S.Fc("Labels in ",i.importDetails.inLabelNeg," "),S.Bb(2),S.Fc("",i.importDetails.inRows?i.labelsSelection.colName:i.labelsSelection.rowName,";"),S.Bb(1),S.jc("ngIf",!i.importDetails.areLabelsAfterTime())}}function wt(e,t){if(1&e&&(S.Tb(0,"div",8),S.Dc(1),S.Sb()),2&e){var i=S.dc(2);S.Bb(1),S.Fc(" Even if only the top part of the data table is presented all labels from the selected ",i.importDetails.inLabelNeg," will be imported ")}}function Dt(e,t){if(1&e){var i=S.Ub();S.Tb(0,"mat-card",1),S.Tb(1,"mat-card-content"),S.Bc(2,St,6,3,"div",2),S.Tb(3,"div"),S.Tb(4,"div",3),S.Dc(5),S.Sb(),S.Sb(),S.Tb(6,"bd2-data-sheet-mdtable",4),S.Zb("selected",(function(e){return S.sc(i),S.dc().selectLabels(e)})),S.Sb(),S.Tb(7,"div"),S.Dc(8," \xa0 "),S.Bc(9,wt,2,1,"div",5),S.Sb(),S.Sb(),S.Sb()}if(2&e){var a=S.dc();S.Bb(2),S.jc("ngIf",a.labelsSelection),S.Bb(2),S.Db(a.labelsSelection?"alert alert-info":"alert alert-danger"),S.Bb(1),S.Fc(" Click on the ",a.importDetails.inLabelNeg," containing labels. "),S.Bb(1),S.jc("dataSlice",a.dataSlice)("selectableColHeader",a.importDetails.inRows)("selectableRowHeader",!a.importDetails.inRows)("styler",a.tableSelector.tableStyler),S.Bb(3),S.jc("ngIf",a.hasMoreLabels())}}var yt,kt=((yt=function(e){i(o,e);var a=l(o);function o(e,t){return u(this,o),a.call(this,e,t)}return m(o,[{key:"applyDefaultSelections",value:function(){if(t(n(o.prototype),"applyDefaultSelections",this).call(this),this.labelsSelection&&!this.labelsSelection.fake)this.selectLabels(this.reselect(this.labelsSelection));else if(this.firstTimeCell){var e=this.reselect(new g.a(this.firstTimeCell.colIx-1,this.colNumber(this.firstTimeCell.colIx-1),void 0,this.firstTimeCell.rowIx-1,this.rowNumber(this.firstTimeCell.rowIx-1),void 0,void 0));e.fake=!0,this.selectLabels(e)}}},{key:"markSelections",value:function(){t(n(o.prototype),"markSelections",this).call(this),this.markFirstTime()}}]),o}(fe)).\u0275fac=function(e){return new(e||yt)(S.Nb(_),S.Nb(E.a))},yt.\u0275cmp=S.Hb({type:yt,selectors:[["bd2-import-labels-step"]],inputs:{importDetails:"importDetails"},features:[S.yb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],["role","alert"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(e,t){1&e&&S.Bc(0,Dt,10,9,"mat-card",0),2&e&&S.jc("ngIf",t.importDetails)},directives:[f.m,A.a,A.c,Be],encapsulation:2}),yt);function Tt(e,t){if(1&e&&(S.Tb(0,"div",5),S.Dc(1),S.Sb()),2&e){var i=S.dc(3);S.Bb(1),S.Gc(" Data start ",i.importDetails.inLabel," must be after time ",i.importDetails.inLabel,". ")}}function Ct(e,t){if(1&e&&(S.Tb(0,"div"),S.Tb(1,"p"),S.Dc(2),S.Tb(3,"strong"),S.Dc(4),S.Sb(),S.Sb(),S.Bc(5,Tt,2,2,"div",4),S.Sb()),2&e){var i=S.dc(2);S.Bb(2),S.Fc("Data starts in ",i.importDetails.inLabel," "),S.Bb(2),S.Fc("",i.importDetails.inRows?i.dataStart.rowName:i.dataStart.colName,";"),S.Bb(1),S.jc("ngIf",!i.importDetails.isDataAfterTime())}}function Bt(e,t){if(1&e){var i=S.Ub();S.Tb(0,"mat-card",1),S.Tb(1,"mat-card-content"),S.Bc(2,Ct,6,3,"div",2),S.Tb(3,"div"),S.Tb(4,"div"),S.Dc(5),S.Sb(),S.Sb(),S.Tb(6,"bd2-data-sheet-mdtable",3),S.Zb("selected",(function(e){return S.sc(i),S.dc().selectDataStart(e)})),S.Sb(),S.Sb(),S.Sb()}if(2&e){var a=S.dc();S.Bb(2),S.jc("ngIf",a.dataStart),S.Bb(2),S.Db(a.dataStart?"alert alert-info":"alert alert-danger"),S.Bb(1),S.Fc(" Click on the first data ",a.importDetails.inLabel,". "),S.Bb(1),S.jc("dataSlice",a.dataSlice)("selectableColHeader",!a.importDetails.inRows)("selectableRowHeader",a.importDetails.inRows)("styler",a.tableSelector.tableStyler)}}var It,Nt=((It=function(e){i(o,e);var a=l(o);function o(e,t){return u(this,o),a.call(this,e,t)}return m(o,[{key:"applyDefaultSelections",value:function(){if(t(n(o.prototype),"applyDefaultSelections",this).call(this),this.dataStart&&!this.dataStart.fake)this.selectDataStart(this.reselect(this.dataStart));else if(this.firstTimeCell){var e=this.reselect(new g.a(this.firstTimeCell.colIx+1,this.colNumber(this.firstTimeCell.colIx+1),void 0,this.firstTimeCell.rowIx+1,this.rowNumber(this.firstTimeCell.rowIx+1),void 0,void 0));e.fake=!0,this.selectDataStart(e)}}},{key:"markSelections",value:function(){t(n(o.prototype),"markSelections",this).call(this),this.markFirstTime(),this.markLabels()}}]),o}(fe)).\u0275fac=function(e){return new(e||It)(S.Nb(_),S.Nb(E.a))},It.\u0275cmp=S.Hb({type:It,selectors:[["bd2-select-data-start-step"]],inputs:{importDetails:"importDetails"},features:[S.yb],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(e,t){1&e&&S.Bc(0,Bt,7,8,"mat-card",0),2&e&&S.jc("ngIf",t.importDetails)},directives:[f.m,A.a,A.c,Be],encapsulation:2}),It),Rt=s("FtGj"),Lt=s("JX91"),xt=s("A5z7"),Ot=s("/1cH"),Ft=s("NFeN"),jt=["backgroundInput"],Pt=["auto"];function _t(e,t){1&e&&(S.Tb(0,"mat-icon",14),S.Dc(1,"cancel"),S.Sb())}function Et(e,t){if(1&e){var i=S.Ub();S.Tb(0,"mat-chip",12),S.Zb("removed",(function(){S.sc(i);var e=t.$implicit;return S.dc(2).remove(e)})),S.Dc(1),S.Bc(2,_t,2,0,"mat-icon",13),S.Sb()}if(2&e){var a=t.$implicit,l=S.dc(2);S.jc("selectable",l.selectable)("removable",l.removable),S.Bb(1),S.Fc(" ",a," "),S.Bb(1),S.jc("ngIf",l.removable)}}function Mt(e,t){if(1&e&&(S.Tb(0,"mat-option",15),S.Dc(1),S.Sb()),2&e){var i=t.$implicit;S.jc("value",i),S.Bb(1),S.Fc(" ",i," ")}}function At(e,t){if(1&e){var i=S.Ub();S.Tb(0,"div"),S.Tb(1,"mat-card",1),S.Tb(2,"mat-card-content"),S.Tb(3,"div",2),S.Dc(4," Select labels for which data should be treated as the background noise "),S.Sb(),S.Tb(5,"mat-form-field",3),S.Tb(6,"mat-chip-list",4,5),S.Bc(8,Et,3,4,"mat-chip",6),S.Tb(9,"input",7,8),S.Zb("matChipInputTokenEnd",(function(e){return S.sc(i),S.dc().add(e)})),S.Sb(),S.Sb(),S.Tb(11,"mat-autocomplete",9,10),S.Zb("optionSelected",(function(e){return S.sc(i),S.dc().selected(e)})),S.Bc(13,Mt,2,2,"mat-option",11),S.ec(14,"async"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()}if(2&e){var a=S.qc(7),l=S.qc(12),o=S.dc();S.Bb(8),S.jc("ngForOf",o.backgrounds),S.Bb(1),S.jc("formControl",o.backgroundCtrl)("matAutocomplete",l)("matChipInputFor",a)("matChipInputSeparatorKeyCodes",o.separatorKeysCodes)("matChipInputAddOnBlur",o.addOnBlur),S.Bb(4),S.jc("ngForOf",S.fc(14,7,o.filteredLabels))}}var Ut,Ht=((Ut=function(){function t(e){u(this,t),this.tsFileService=e,this.selectable=!0,this.removable=!0,this.addOnBlur=!1,this.separatorKeysCodes=[Rt.g,Rt.c],this.backgroundCtrl=new h.f,this.allLabels=[]}return m(t,[{key:"ngOnInit",value:function(){var e=this;this.filteredLabels=this.backgroundCtrl.valueChanges.pipe(Object(Lt.a)(null),Object(x.a)((function(t){return t?e.filter(t):e.allLabels})))}},{key:"loadLabels",value:function(){var e=this;this.importDetails&&this.importDetails.fileId?this.importDetails.importLabels?this.importDetails.labelsSelection&&this.tsFileService.previewLabels(this.importDetails.fileId,this.importDetails.importFormat.name,this.importDetails.labelsSelection,this.importDetails.inRows).subscribe((function(t){e.updateAllLabels(e.unique(t))})):this.updateAllLabels(this.unique(this.importDetails.userLabels)):this.updateAllLabels([])}},{key:"updateAllLabels",value:function(e){var t=this;this.allLabels=e.slice().sort();var i=this.backgrounds||[];this.backgrounds=[],i.forEach((function(e){return t.addBackground(e)})),this.backgroundCtrl.setValue(" "),this.backgroundCtrl.setValue(null)}},{key:"unique",value:function(t){return t=t.filter((function(e){return!!e})).map((function(e){return e.trim()})),e(new Set(t))}},{key:"addBackground",value:function(e){if((e||"").trim()){var t=this.backgrounds.indexOf(e),i=this.allLabels.indexOf(e);t<0&&i>=0&&this.backgrounds.push(e.trim())}}},{key:"add",value:function(e){if(!this.matAutocomplete.isOpen){var t=e.input;this.addBackground(e.value),t&&(t.value=""),this.backgroundCtrl.setValue(null)}}},{key:"remove",value:function(e){var t=this.backgrounds.indexOf(e);t>=0&&this.backgrounds.splice(t,1)}},{key:"selected",value:function(e){this.addBackground(e.option.viewValue),this.backgroundInput.nativeElement.value="",this.backgroundCtrl.setValue(null)}},{key:"filter",value:function(e){var t=e.toLowerCase();return this.allLabels.filter((function(e){return e.toLowerCase().includes(t)})).slice(0,7)}},{key:"backgrounds",get:function(){return this.importDetails?this.importDetails.backgroundsLabels:[]},set:function(e){this.importDetails.backgroundsLabels=e}}]),t}()).\u0275fac=function(e){return new(e||Ut)(S.Nb(P))},Ut.\u0275cmp=S.Hb({type:Ut,selectors:[["bd2-select-backgrounds-labels-step"]],viewQuery:function(e,t){var i;1&e&&(S.Ic(jt,!0),S.Ic(Pt,!0)),2&e&&(S.pc(i=S.ac())&&(t.backgroundInput=i.first),S.pc(i=S.ac())&&(t.matAutocomplete=i.first))},inputs:{importDetails:"importDetails"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"mat-elevation-z4"],["type","info","role","alert",1,"alert","alert-info"],[2,"width","100%"],["aria-label","Backgrounds selection"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder","Type to select background label...",3,"formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["backgroundInput",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"selectable","removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"]],template:function(e,t){1&e&&S.Bc(0,At,15,9,"div",0),2&e&&S.jc("ngIf",null==t.importDetails?null:t.importDetails.containsBackgrounds)},directives:[f.m,A.a,A.c,U.c,xt.c,f.l,h.d,Ot.c,xt.b,h.q,h.g,Ot.a,xt.a,Ft.a,xt.d,Z.o],pipes:[f.b],encapsulation:2}),Ut),zt=["stepper"],Zt=["importLabelsStep"],Wt=["assignLabelsStep"],Gt=["selectBackgroundsStep"];function $t(e,t){1&e&&S.Dc(0,"Upload data file")}function Kt(e,t){1&e&&S.Dc(0,"Data layout")}function qt(e,t){if(1&e&&S.Dc(0),2&e){var i=S.dc();S.Fc("Define time ",i.importDetails.inLabel,"")}}function Qt(e,t){1&e&&S.Dc(0,"Label data")}function Vt(e,t){if(1&e){var i=S.Ub();S.Rb(0),S.Tb(1,"mat-step",12),S.Bc(2,Qt,1,0,"ng-template",2),S.Ob(3,"mat-divider"),S.Ob(4,"bd2-import-details-summary",19),S.Ob(5,"bd2-assign-labels-step",4,20),S.Tb(7,"div"),S.Tb(8,"button",10),S.Dc(9,"Back"),S.Sb(),S.Tb(10,"button",14),S.Zb("click",(function(){return S.sc(i),S.dc().startChoosingBackgrounds()})),S.Dc(11,"Next"),S.Sb(),S.Sb(),S.Sb(),S.Qb()}if(2&e){var a=S.dc();S.Bb(1),S.jc("completed",a.importDetails.areLabelsCorrectlyAssigned()),S.Bb(3),S.jc("importDetails",a.importDetails)("showTime",!0),S.Bb(1),S.jc("importDetails",a.importDetails),S.Bb(5),S.jc("disabled",!a.importDetails.areLabelsCorrectlyAssigned())}}function Xt(e,t){if(1&e&&S.Dc(0),2&e){var i=S.dc(2);S.Fc("Select labels ",i.importDetails.inLabelNeg,"")}}function Jt(e,t){1&e&&S.Dc(0,"Select data start")}function Yt(e,t){if(1&e){var i=S.Ub();S.Rb(0),S.Tb(1,"mat-step",12),S.Bc(2,Xt,1,1,"ng-template",2),S.Ob(3,"mat-divider"),S.Ob(4,"bd2-import-details-summary",19),S.Ob(5,"bd2-import-labels-step",4,21),S.Tb(7,"div"),S.Tb(8,"button",10),S.Dc(9,"Back"),S.Sb(),S.Tb(10,"button",14),S.Zb("click",(function(){S.sc(i);var e=S.qc(17);return S.dc().loadData(e)})),S.Dc(11,"Next"),S.Sb(),S.Sb(),S.Sb(),S.Tb(12,"mat-step",12),S.Bc(13,Jt,1,0,"ng-template",2),S.Ob(14,"mat-divider"),S.Ob(15,"bd2-import-details-summary",22),S.Ob(16,"bd2-select-data-start-step",4,23),S.Tb(18,"div"),S.Tb(19,"button",10),S.Dc(20,"Back"),S.Sb(),S.Tb(21,"button",14),S.Zb("click",(function(){return S.sc(i),S.dc().startChoosingBackgrounds()})),S.Dc(22,"Next"),S.Sb(),S.Sb(),S.Sb(),S.Qb()}if(2&e){var a=S.dc();S.Bb(1),S.jc("completed",a.importDetails.areLabelsCorrectlySelected()),S.Bb(3),S.jc("importDetails",a.importDetails)("showTime",!0),S.Bb(1),S.jc("importDetails",a.importDetails),S.Bb(5),S.jc("disabled",!a.importDetails.areLabelsCorrectlySelected()),S.Bb(2),S.jc("completed",a.importDetails.areLabelsCorrectlySelected()&&a.importDetails.isDataStartCorrectlySelected()),S.Bb(3),S.jc("importDetails",a.importDetails)("showTime",!0)("showLabelling",!0),S.Bb(1),S.jc("importDetails",a.importDetails),S.Bb(5),S.jc("disabled",!a.importDetails.isDataStartCorrectlySelected())}}function ei(e,t){1&e&&S.Dc(0,"Select backgrounds labels")}function ti(e,t){if(1&e&&(S.Rb(0),S.Tb(1,"mat-step"),S.Bc(2,ei,1,0,"ng-template",2),S.Ob(3,"mat-divider"),S.Ob(4,"bd2-import-details-summary",16),S.Ob(5,"bd2-select-backgrounds-labels-step",4,24),S.Tb(7,"div"),S.Tb(8,"button",10),S.Dc(9,"Back"),S.Sb(),S.Tb(10,"button",25),S.Dc(11,"Next"),S.Sb(),S.Sb(),S.Sb(),S.Qb()),2&e){var i=S.dc();S.Bb(4),S.jc("importDetails",i.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),S.Bb(1),S.jc("importDetails",i.importDetails)}}function ii(e,t){1&e&&S.Dc(0,"Import timeseries")}var ai,li=((ai=function(){function e(t,i,a){u(this,e),this.fileService=t,this.feedback=i,this.dataService=a,this.import=new S.o,this.oldImport=new S.o,this.blocked=!1,this.importDetails=new g.b,this.importDetails.timeType=y.h.TIME_IN_HOURS}return m(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnDestroy",value:function(){this.dataService&&this.dataService.close()}},{key:"upload",value:function(e){var t=this;e.files&&1===e.files.length?this.fileService.uploadFile(e.files[0],e.importFormat).subscribe((function(i){t.importDetails.fileId=i,t.importDetails.fileName=e.files[0].name,t.importDetails.importFormat=e.importFormat,t.importDetails.inRows=e.importFormat!=g.e.EXCEL_TABLE,t.stepper.next(),e.importFormat==g.e.TOPCOUNT&&t.oldImport.next(t.importDetails)}),(function(e){t.feedback.error(e)})):console.error("Wrong upload files size",e.files)}},{key:"loadData",value:function(e){e.loadData()}},{key:"startLabelling",value:function(){this.importDetails.importLabels?this.importLabelsStep?this.importLabelsStep.loadData():console.error("Missing importLabelStep"):this.assignLabelsStep?this.assignLabelsStep.loadData():console.error("Missing assignLabelsStep")}},{key:"startChoosingBackgrounds",value:function(){this.importDetails.containsBackgrounds&&(this.selectBackgroundsStep?this.selectBackgroundsStep.loadLabels():console.error("Missing selectBackgroundsStep"))}},{key:"importData",value:function(){this.importDetails.isComplete()&&this.import.next(this.importDetails)}}]),e}()).\u0275fac=function(e){return new(e||ai)(S.Nb(P),S.Nb(E.a),S.Nb(_))},ai.\u0275cmp=S.Hb({type:ai,selectors:[["bd2-import-steps"]],viewQuery:function(e,t){var i;1&e&&(S.Ic(zt,!0),S.Ic(Zt,!0),S.Ic(Wt,!0),S.Ic(Gt,!0)),2&e&&(S.pc(i=S.ac())&&(t.stepper=i.first),S.pc(i=S.ac())&&(t.importLabelsStep=i.first),S.pc(i=S.ac())&&(t.assignLabelsStep=i.first),S.pc(i=S.ac())&&(t.selectBackgroundsStep=i.first))},inputs:{blocked:"blocked"},outputs:{import:"import",oldImport:"oldImport"},features:[S.Ab([_])],decls:62,vars:26,consts:[[3,"linear"],["stepper",""],["matStepLabel",""],[3,"uploadFiles"],[3,"importDetails"],[1,"mat-elevation-z4"],["name","inRows",1,"spaced",3,"ngModel","ngModelChange"],[3,"value"],["name","importLabels",1,"spaced",3,"ngModel","ngModelChange"],["name","containsBackgrounds",1,"spaced",3,"ngModel","ngModelChange"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","type","button",3,"click"],[3,"completed"],["defineTimeStep",""],["mat-button","","matStepperNext","","type","button",3,"disabled","click"],[4,"ngIf"],[3,"importDetails","showTime","showLabelling","showDataStart"],["type","info","role","alert",1,"alert","alert-info"],["mat-button","",3,"disabled","click"],[3,"importDetails","showTime"],["assignLabelsStep",""],["importLabelsStep",""],[3,"importDetails","showTime","showLabelling"],["selectDataStartStep",""],["selectBackgroundsStep",""],["mat-button","","matStepperNext","","type","button"]],template:function(e,t){if(1&e){var i=S.Ub();S.Tb(0,"mat-vertical-stepper",0,1),S.Tb(2,"mat-step"),S.Bc(3,$t,1,0,"ng-template",2),S.Tb(4,"bd2-upload-data-file-step",3),S.Zb("uploadFiles",(function(e){return t.upload(e)})),S.Sb(),S.Sb(),S.Tb(5,"mat-step"),S.Tb(6,"form"),S.Bc(7,Kt,1,0,"ng-template",2),S.Ob(8,"mat-divider"),S.Ob(9,"bd2-import-details-summary",4),S.Tb(10,"mat-card",5),S.Tb(11,"mat-card-content"),S.Tb(12,"p"),S.Tb(13,"mat-radio-group",6),S.Zb("ngModelChange",(function(e){return t.importDetails.inRows=e})),S.Tb(14,"mat-radio-button",7),S.Dc(15,"Data in rows"),S.Sb(),S.Tb(16,"mat-radio-button",7),S.Dc(17,"Data in columns"),S.Sb(),S.Sb(),S.Sb(),S.Tb(18,"p"),S.Tb(19,"mat-radio-group",8),S.Zb("ngModelChange",(function(e){return t.importDetails.importLabels=e})),S.Tb(20,"mat-radio-button",7),S.Dc(21),S.Sb(),S.Tb(22,"mat-radio-button",7),S.Dc(23,"Manually label"),S.Sb(),S.Sb(),S.Sb(),S.Tb(24,"p"),S.Tb(25,"mat-radio-group",9),S.Zb("ngModelChange",(function(e){return t.importDetails.containsBackgrounds=e})),S.Tb(26,"mat-radio-button",7),S.Dc(27,"No noise data"),S.Sb(),S.Tb(28,"mat-radio-button",7),S.Dc(29),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(30,"mat-card-actions"),S.Tb(31,"button",10),S.Dc(32,"Back"),S.Sb(),S.Tb(33,"button",11),S.Zb("click",(function(){S.sc(i);var e=S.qc(40);return t.loadData(e)})),S.Dc(34,"Next"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(35,"mat-step",12),S.Bc(36,qt,1,1,"ng-template",2),S.Ob(37,"mat-divider"),S.Ob(38,"bd2-import-details-summary",4),S.Ob(39,"bd2-define-time-step",4,13),S.Tb(41,"div"),S.Tb(42,"button",10),S.Dc(43,"Back"),S.Sb(),S.Tb(44,"button",14),S.Zb("click",(function(){return t.startLabelling()})),S.Dc(45,"Next"),S.Sb(),S.Sb(),S.Sb(),S.Bc(46,Vt,12,5,"ng-container",15),S.Bc(47,Yt,23,11,"ng-container",15),S.Bc(48,ti,12,5,"ng-container",15),S.Tb(49,"mat-step",12),S.Bc(50,ii,1,0,"ng-template",2),S.Ob(51,"mat-divider"),S.Ob(52,"bd2-import-details-summary",16),S.Tb(53,"mat-card",5),S.Tb(54,"mat-card-content"),S.Tb(55,"div",17),S.Dc(56,"You can now import the timeseries"),S.Sb(),S.Sb(),S.Sb(),S.Tb(57,"div"),S.Tb(58,"button",10),S.Dc(59,"Back"),S.Sb(),S.Tb(60,"button",18),S.Zb("click",(function(){return t.importData()})),S.Dc(61,"Import data"),S.Sb(),S.Sb(),S.Sb(),S.Sb()}2&e&&(S.jc("linear",!0),S.Bb(9),S.jc("importDetails",t.importDetails),S.Bb(4),S.jc("ngModel",t.importDetails.inRows),S.Bb(1),S.jc("value",!0),S.Bb(2),S.jc("value",!1),S.Bb(3),S.jc("ngModel",t.importDetails.importLabels),S.Bb(1),S.jc("value",!0),S.Bb(1),S.Fc("Import labels from ",t.importDetails.inLabelNeg,""),S.Bb(1),S.jc("value",!1),S.Bb(3),S.jc("ngModel",t.importDetails.containsBackgrounds),S.Bb(1),S.jc("value",!1),S.Bb(2),S.jc("value",!0),S.Bb(1),S.Fc("Background noise in ",t.importDetails.inLabel,"s"),S.Bb(6),S.jc("completed",t.importDetails.isTimeDefined()),S.Bb(3),S.jc("importDetails",t.importDetails),S.Bb(1),S.jc("importDetails",t.importDetails),S.Bb(5),S.jc("disabled",!t.importDetails.isTimeDefined()),S.Bb(2),S.jc("ngIf",!t.importDetails.importLabels),S.Bb(1),S.jc("ngIf",t.importDetails.importLabels),S.Bb(1),S.jc("ngIf",t.importDetails.containsBackgrounds),S.Bb(1),S.jc("completed",t.importDetails.isComplete()),S.Bb(3),S.jc("importDetails",t.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),S.Bb(8),S.jc("disabled",t.blocked||!t.importDetails.isComplete()))},directives:[M.f,M.a,M.b,V,h.D,h.r,h.s,X.a,re,A.a,A.c,se.b,h.q,h.t,se.a,A.b,ce.a,M.e,M.d,_e,f.m,gt,kt,Nt,Ht],encapsulation:2}),ai),oi=s("Xa2L");function ni(e,t){1&e&&(S.Tb(0,"mat-card"),S.Tb(1,"mat-card-content"),S.Ob(2,"mat-spinner",2),S.Tb(3,"div",3),S.Dc(4,"Importing ...."),S.Sb(),S.Sb(),S.Sb())}var ri,si,ci,ui=[{path:"",children:[{path:"",component:(ri=function(e){i(o,e);var a=l(o);function o(e,t){var i;return u(this,o),(i=a.call(this,t)).BD2REST=e,i.importing=!1,i.titlePart=" Import Data",i}return m(o,[{key:"ngOnInit",value:function(){t(n(o.prototype),"ngOnInit",this).call(this)}},{key:"importData",value:function(e){var t=this;if(!this.importing){var i=new g.d;i.fileId=e.fileId,i.importFormat=e.importFormat,i.importParameters=e,this.importing=!0,this.BD2REST.experimentImportTS(this.assay.id,i).subscribe((function(e){t.feedback.success("Imported "+e.imported+" timeseries"),t.refreshModel(),t.importing=!1,t.goToTSView()}),(function(e){t.importing=!1,t.feedback.error(e)}))}}},{key:"goToTSView",value:function(){var e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}},{key:"goToOldImport",value:function(e){var t=this.expHomePath();t.push("data","ts-old-import",e.importFormat.name,e.fileId),this.router.navigate(t)}}]),o}(v.a),ri.\u0275fac=function(e){return new(e||ri)(S.Nb(w.a),S.Nb(D.a))},ri.\u0275cmp=S.Hb({type:ri,selectors:[["bd2-tsimport-dashboard"]],features:[S.yb],decls:2,vars:1,consts:[[3,"import","oldImport"],[4,"ngIf"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"]],template:function(e,t){1&e&&(S.Tb(0,"bd2-import-steps",0),S.Zb("import",(function(e){return t.importData(e)}))("oldImport",(function(e){return t.goToOldImport(e)})),S.Sb(),S.Bc(1,ni,5,0,"mat-card",1)),2&e&&(S.Bb(1),S.jc("ngIf",t.importing))},directives:[li,f.m,A.a,A.c,oi.b],encapsulation:2}),ri)}]}],bi=((si=function e(){u(this,e)}).\u0275mod=S.Lb({type:si}),si.\u0275inj=S.Kb({factory:function(e){return new(e||si)},imports:[[p.f.forChild(ui)],p.f]}),si),mi=s("YiFe"),di=s("ZTEM"),fi=((ci=function e(){u(this,e)}).\u0275mod=S.Lb({type:ci}),ci.\u0275inj=S.Kb({factory:function(e){return new(e||ci)},imports:[[f.c,h.k,h.y,mi.a,di.a,bi]]}),ci)}}])}();