"use strict";(self.webpackChunkbiodare2_ui=self.webpackChunkbiodare2_ui||[]).push([[340],{272:(M,Z,c)=>{c.d(Z,{i:()=>f});var r=c(1135),l=c(4650);let _=1;class f{constructor(){this.experimentStream=new r.X(null),this.id=_++}close(){this.experimentStream.complete()}experiment(){return this.experimentStream}push(h){this.experimentStream.next(h)}}f.\u0275fac=function(h){return new(h||f)},f.\u0275prov=l.Yz7({token:f,factory:f.\u0275fac})},471:(M,Z,c)=>{c.d(Z,{w:()=>p});var r=c(7139),l=c(9300),_=c(4650),f=c(2110);class p extends r.X{constructor(e){super(),this.serviceDependencies=e,this.experimentService=e.experimentService,this.currentExperiment=e.currentExperiment,this.feedback=e.feedback,this.router=e.router,this.titleSetter=e.titleSetter,this.titlePart=""}ngOnInit(){this.subscribeToExperiment()}ngOnDestroy(){this.unsubscribeFromExperiment()}getModel(){return this.assay}updateModel(e){this.assay=e,this.setTitle()}setTitle(){this.titleSetter.setTitle("Exp "+this.assay.id+this.titlePart)}subscribeToExperiment(){this.expSubscription=this.currentExperiment.experiment().pipe((0,l.h)(e=>!!e)).subscribe(e=>{this.updateModel(e)},e=>this.feedback.error(e),()=>console.log(this.constructor.name+" expSubscription completed"))}refreshModel(){return this.experimentService.getExperiment(this.assay.id).then(e=>(this.currentExperiment.push(e),e))}unsubscribeFromExperiment(){this.expSubscription&&this.expSubscription.unsubscribe()}expHomePath(e){return["/experiment",e=e||this.assay.id]}goToExpHome(e){this.router.navigate(this.expHomePath(e))}goToExpEdit(e,A){const g=this.expHomePath(e);g.push("edit"),A?this.router.navigate(g,{fragment:A}):this.router.navigate(g)}}p.\u0275fac=function(e){return new(e||p)(_.Y36(f.L))},p.\u0275dir=_.lG2({type:p,features:[_.qOj]})},2110:(M,Z,c)=>{c.d(Z,{L:()=>e});var r=c(4650),l=c(8926),_=c(272),f=c(2160),p=c(7424),h=c(9299);class e{constructor(g,T,x,u,m){this.experimentService=g,this.currentExperiment=T,this.feedback=x,this.titleSetter=u,this.router=m}}e.\u0275fac=function(g){return new(g||e)(r.LFG(l.$),r.LFG(_.i),r.LFG(f.T),r.LFG(p.T),r.LFG(h.F0))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac})},9340:(M,Z,c)=>{c.r(Z),c.d(Z,{ExperimentModule:()=>B});var r=c(6895),l=c(9299),_=c(9300),f=c(7246),p=c(272),h=c(2110),e=c(4650),A=c(8926),g=c(9174),T=c(2160),x=c(2724),u=c(7032);const m=function(){return["edit"]},C=function(){return{exact:!0}};function y(i,t){1&i&&(e.TgZ(0,"a",6),e._uU(1,"Edit"),e.qZA()),2&i&&e.Q6J("routerLink",e.DdM(2,m))("routerLinkActiveOptions",e.DdM(3,C))}const w=function(){return[".","data","view","ts"]};function ce(i,t){1&i&&(e.TgZ(0,"a",6),e._uU(1,"Show data"),e.qZA()),2&i&&e.Q6J("routerLink",e.DdM(2,w))("routerLinkActiveOptions",e.DdM(3,C))}const Ne=function(){return[".","data","view","heatmap"]};function Ue(i,t){1&i&&(e.TgZ(0,"a",6),e._uU(1,"Heatmap"),e.qZA()),2&i&&e.Q6J("routerLink",e.DdM(2,Ne))("routerLinkActiveOptions",e.DdM(3,C))}const Je=function(){return["ppa/new"]};function Ie(i,t){1&i&&(e.TgZ(0,"a",6),e._uU(1,"Period analysis"),e.qZA()),2&i&&e.Q6J("routerLink",e.DdM(2,Je))("routerLinkActiveOptions",e.DdM(3,C))}const Oe=function(){return["ppa"]},Te=function(){return{exact:!1}};function Se(i,t){1&i&&(e.TgZ(0,"a",6),e._uU(1,"Period analysis"),e.qZA()),2&i&&e.Q6J("routerLink",e.DdM(2,Oe))("routerLinkActiveOptions",e.DdM(3,Te))}const Qe=function(){return["rhythmicity"]};function ke(i,t){1&i&&(e.TgZ(0,"a",6),e._uU(1,"Rhythmicity"),e.qZA()),2&i&&e.Q6J("routerLink",e.DdM(2,Qe))("routerLinkActiveOptions",e.DdM(3,Te))}const Ye=function(){return[".","data","ts-import"]};function Ge(i,t){if(1&i&&(e.TgZ(0,"a",6),e._uU(1),e.qZA()),2&i){const n=e.oxw(2);e.Q6J("routerLink",e.DdM(3,Ye))("routerLinkActiveOptions",e.DdM(4,C)),e.xp6(1),e.hij(" ",n.experiment.features.hasTSData?"Replace data":"Import data","")}}const Pe=function(){return["publish"]};function Le(i,t){1&i&&(e.TgZ(0,"a",6)(1,"i",8),e._uU(2,"lock_open"),e.qZA()()),2&i&&e.Q6J("routerLink",e.DdM(2,Pe))("routerLinkActiveOptions",e.DdM(3,C))}const Ke=function(){return["/experiments"]},Re=function(){return["."]},Be=function(){return["file"]};function He(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div",1)(1,"nav",2)(2,"a",3)(3,"i",4),e._uU(4,"fast_rewind"),e.qZA()(),e.TgZ(5,"a",5),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.back())}),e.TgZ(6,"i",4),e._uU(7,"arrow_left"),e.qZA()(),e.TgZ(8,"a",5),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.refresh())}),e.TgZ(9,"i",4),e._uU(10,"refresh"),e.qZA()(),e.TgZ(11,"a",6),e._uU(12,"Overview"),e.qZA(),e.YNc(13,y,2,4,"a",7),e.YNc(14,ce,2,4,"a",7),e.YNc(15,Ue,2,4,"a",7),e.YNc(16,Ie,2,4,"a",7),e.YNc(17,Se,2,4,"a",7),e.YNc(18,ke,2,4,"a",7),e.YNc(19,Ge,2,5,"a",7),e.TgZ(20,"a",6),e._uU(21,"Files"),e.qZA(),e.YNc(22,Le,3,4,"a",7),e.qZA()()}if(2&i){const n=e.oxw();e.xp6(2),e.Q6J("routerLink",e.DdM(13,Ke)),e.xp6(9),e.Q6J("routerLink",e.DdM(14,Re))("routerLinkActiveOptions",e.DdM(15,C)),e.xp6(2),e.Q6J("ngIf",n.experiment.security.canWrite),e.xp6(1),e.Q6J("ngIf",n.experiment.features.hasTSData),e.xp6(1),e.Q6J("ngIf",n.experiment.features.hasTSData),e.xp6(1),e.Q6J("ngIf",n.experiment.security.canWrite&&n.experiment.features.hasTSData&&!n.experiment.features.hasPPAJobs),e.xp6(1),e.Q6J("ngIf",n.experiment.features.hasPPAJobs),e.xp6(1),e.Q6J("ngIf",n.experiment.security.canWrite&&n.experiment.features.hasTSData||n.experiment.features.hasRhythmicityJobs),e.xp6(1),e.Q6J("ngIf",n.experiment.security.canWrite),e.xp6(1),e.Q6J("routerLink",e.DdM(16,Be))("routerLinkActiveOptions",e.DdM(17,C)),e.xp6(2),e.Q6J("ngIf",n.experiment.security.isOwner||n.experiment.security.isSuperOwner)}}class H{constructor(){this.onRefresh=new e.vpe}refresh(){this.onRefresh.emit(!0)}back(){window.history.back()}}function Ve(i,t){if(1&i&&(e.TgZ(0,"div",2)(1,"strong"),e._uU(2,"Open Access: "),e.qZA(),e._uU(3," under "),e.TgZ(4,"strong"),e._uU(5),e.qZA(),e._uU(6," license "),e.qZA()),2&i){const n=e.oxw(2);e.xp6(5),e.Oqu(n.model.features.licence)}}function We(i,t){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.xp6(1),e.hij("",n.name,", ")}}function ze(i,t){if(1&i&&(e.TgZ(0,"div",2)(1,"strong"),e._uU(2,"Authors: "),e.qZA(),e.YNc(3,We,2,1,"span",5),e.qZA()),2&i){const n=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",n.model.contributionDesc.authors)}}function je(i,t){if(1&i&&(e.TgZ(0,"div",1)(1,"div",2)(2,"strong"),e._uU(3,"Purpose: "),e.qZA(),e._uU(4),e.qZA(),e.YNc(5,Ve,7,1,"div",3),e.YNc(6,ze,4,1,"div",3),e.TgZ(7,"div",4)(8,"strong"),e._uU(9,"Data category: "),e.qZA(),e._uU(10),e.qZA()()),2&i){const n=e.oxw();e.xp6(4),e.hij(" ",n.model.generalDesc.purpose," "),e.xp6(1),e.Q6J("ngIf",n.model.features.isOpenAccess),e.xp6(1),e.Q6J("ngIf",n.model.contributionDesc.authors),e.xp6(4),e.hij(" ",null==n.model.dataCategory?null:n.model.dataCategory.longName," ")}}H.\u0275fac=function(t){return new(t||H)},H.\u0275cmp=e.Xpm({type:H,selectors:[["bd2-experiment-navigation"]],inputs:{experiment:"experiment"},outputs:{onRefresh:"onRefresh"},features:[e._Bn([])],decls:1,vars:1,consts:[["style","margin-bottom: 2em;",4,"ngIf"],[2,"margin-bottom","2em"],[1,"secondary"],[3,"routerLink"],[1,"material-icons","bd-icon"],["role","button",1,"shade",3,"click"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions",4,"ngIf"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(t,n){1&t&&e.YNc(0,He,23,18,"div",0),2&t&&e.Q6J("ngIf",n.experiment)},dependencies:[r.O5,l.rH,l.Od],encapsulation:2});class V{}function Xe(i,t){1&i&&(e.TgZ(0,"i",7),e._uU(1,"lock_open"),e.qZA())}function $e(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"h3"),e.YNc(4,Xe,2,0,"i",3),e._uU(5),e._UZ(6,"br"),e.TgZ(7,"small"),e._uU(8),e.qZA()()(),e.TgZ(9,"div",4),e._UZ(10,"bd2-experiment-basic-info-view",5),e.qZA()(),e.TgZ(11,"bd2-experiment-navigation",6),e.NdJ("onRefresh",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.refresh())}),e.qZA()()}if(2&i){const n=e.oxw();e.xp6(4),e.Q6J("ngIf",n.model.features.isOpenAccess),e.xp6(1),e.hij(" Experiment: ",n.model.id,""),e.xp6(3),e.Oqu(n.model.name),e.xp6(2),e.Q6J("model",n.model),e.xp6(1),e.Q6J("experiment",n.model)}}function et(i,t){1&i&&(e.TgZ(0,"div"),e._uU(1," ... loading experiment "),e.TgZ(2,"p"),e._uU(3,"If just logged in try to refresh the window if the experiment is not loading."),e.qZA()())}function tt(i,t){1&i&&(e.TgZ(0,"div")(1,"h4"),e._uU(2,"You don't have sufficient permissions to see the experiment"),e.qZA(),e.TgZ(3,"p"),e._uU(4,"Try to login"),e.qZA()())}V.\u0275fac=function(t){return new(t||V)},V.\u0275cmp=e.Xpm({type:V,selectors:[["bd2-experiment-basic-info-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[["class","summary-box",4,"ngIf"],[1,"summary-box"],[1,"item"],["class","item",4,"ngIf"],[1,"item","item-last"],[4,"ngFor","ngForOf"]],template:function(t,n){1&t&&e.YNc(0,je,11,4,"div",0),2&t&&e.Q6J("ngIf",n.model)},dependencies:[r.sg,r.O5],encapsulation:2});class W{constructor(t,n,s,o,a,b,ge,I){this.experimentService=t,this.RDMSocial=n,this.currentExperiment=s,this.feedback=o,this.analytics=a,this.route=b,this.router=ge,this.dialogs=I,this.isUnauthorised=!1}ngOnInit(){this.expSubscription=this.currentExperiment.experiment().pipe((0,_.h)(t=>!!t)).subscribe(t=>{this.model=t,this.analytics.experimentView(t.id),this.RDMSocial.shouldShowMeasurementWarning(t).then(n=>{n&&this.showMetadataWarning()})},t=>this.feedback.error(t),()=>console.log("currentExperimentStream completed")),this.paramsSubscription=this.route.paramMap.pipe((0,f.U)(t=>t.get("id")),(0,_.h)(t=>!!t)).subscribe(t=>this.loadExperiment(+t))}ngOnDestroy(){this.paramsSubscription&&this.paramsSubscription.unsubscribe(),this.expSubscription&&this.expSubscription.unsubscribe(),this.currentExperiment&&this.currentExperiment.close()}refresh(){this.model&&this.loadExperiment(this.model.id)}loadExperiment(t){this.experimentService.getExperiment(t).then(n=>{this.currentExperiment.push(n),this.isUnauthorised=!1}).catch(n=>{this.isUnauthorised=n.isUnauthorised,this.feedback.error(n)})}handleWarningResponse(t){console.log("Dialog: "+t)}showMetadataWarning(){this.dialogs.confirm("Metadata reminder","\n        <p>\n        Please add measurements details, like technique, equipment and short description.\n        </p>\n        <p>\n        It will improve the metadata quality and it will help you when searching for the data.\n        </p>\n","Not now").subscribe(t=>{this.RDMSocial.registerMeasurementWarning(this.model),t&&this.router.navigate(["edit"],{relativeTo:this.route,fragment:"MeasurementSection"})})}}W.\u0275fac=function(t){return new(t||W)(e.Y36(A.$),e.Y36(g.C),e.Y36(p.i),e.Y36(T.T),e.Y36(x.y),e.Y36(l.gz),e.Y36(l.F0),e.Y36(u.d))},W.\u0275cmp=e.Xpm({type:W,selectors:[["ng-component"]],features:[e._Bn([p.i,h.L])],decls:5,vars:3,consts:[[4,"ngIf"],[1,"card","asset-card"],[1,"card-header"],["class","material-icons bd-icon","style","color: green; font-size: 1.5em;",4,"ngIf"],[1,"card-body"],[3,"model"],[3,"experiment","onRefresh"],[1,"material-icons","bd-icon",2,"color","green","font-size","1.5em"]],template:function(t,n){1&t&&(e.TgZ(0,"div"),e.YNc(1,$e,12,5,"div",0),e.YNc(2,et,4,0,"div",0),e.YNc(3,tt,5,0,"div",0),e._UZ(4,"router-outlet"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.model),e.xp6(1),e.Q6J("ngIf",!n.model&&!n.isUnauthorised),e.xp6(1),e.Q6J("ngIf",!n.model&&n.isUnauthorised))},dependencies:[r.O5,l.lC,H,V],encapsulation:2});var ie=c(471);function nt(i,t){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Description"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.qZA()()),2&i){const n=e.oxw(2);e.xp6(5),e.Oqu(n.model.description)}}function it(i,t){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Comments"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.qZA()()),2&i){const n=e.oxw(2);e.xp6(5),e.Oqu(n.model.comments)}}function ot(i,t){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Execution date"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"date"),e.qZA()()),2&i){const n=e.oxw(2);e.xp6(5),e.Oqu(e.lcZ(6,1,n.model.executionDate.date))}}function st(i,t){if(1&i&&(e.TgZ(0,"div")(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"div"),e._UZ(4,"hr"),e.TgZ(5,"strong"),e._uU(6,"Purpose/Hypothesis"),e.qZA(),e.TgZ(7,"div"),e._uU(8),e.qZA()(),e.YNc(9,nt,6,1,"div",0),e.YNc(10,it,6,1,"div",0),e.YNc(11,ot,7,3,"div",0),e.qZA()),2&i){const n=e.oxw();e.xp6(2),e.Oqu(n.model.name),e.xp6(6),e.Oqu(n.model.purpose),e.xp6(1),e.Q6J("ngIf",n.model.description),e.xp6(1),e.Q6J("ngIf",n.model.comments),e.xp6(1),e.Q6J("ngIf",n.model.executionDate)}}class q{}function rt(i,t){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.xp6(1),e.hij("",n.name,", ")}}function at(i,t){if(1&i&&(e.TgZ(0,"h4"),e.YNc(1,rt,2,1,"span",1),e.qZA()),2&i){const n=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",n.model.authors)}}function ct(i,t){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.xp6(1),e.hij("",n.name,", ")}}function lt(i,t){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Data curators: "),e.qZA(),e.YNc(4,ct,2,1,"span",1),e.qZA()),2&i){const n=e.oxw(2);e.xp6(4),e.Q6J("ngForOf",n.model.curators)}}function dt(i,t){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.xp6(1),e.hij("",n.name,", ")}}function mt(i,t){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.xp6(1),e.hij("",n.name,", ")}}function ut(i,t){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Institutions/Fundings: "),e.qZA(),e.YNc(4,dt,2,1,"span",1),e.YNc(5,mt,2,1,"span",1),e.qZA()),2&i){const n=e.oxw(2);e.xp6(4),e.Q6J("ngForOf",n.model.institutions),e.xp6(1),e.Q6J("ngForOf",n.model.fundings)}}function pt(i,t){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,at,2,1,"h4",0),e.YNc(2,lt,5,1,"div",0),e.YNc(3,ut,6,2,"div",0),e.qZA()),2&i){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.model.authors.length>0),e.xp6(1),e.Q6J("ngIf",n.model.curators.length>0),e.xp6(1),e.Q6J("ngIf",n.model.institutions.length>0||n.model.fundings.length>0)}}q.\u0275fac=function(t){return new(t||q)},q.\u0275cmp=e.Xpm({type:q,selectors:[["bd2-general-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(t,n){1&t&&e.YNc(0,st,12,5,"div",0),2&t&&e.Q6J("ngIf",n.model)},dependencies:[r.O5,r.uU],encapsulation:2});class N{}function _t(i,t){if(1&i&&(e.TgZ(0,"div")(1,"p")(2,"strong"),e._uU(3,"Species: "),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"p")(6,"strong"),e._uU(7,"Data category: "),e.qZA(),e._uU(8),e.qZA()()),2&i){const n=e.oxw();e.xp6(4),e.hij(" ",n.model.species," "),e.xp6(4),e.hij(" ",null==n.model.dataCategory?null:n.model.dataCategory.longName," ")}}N.\u0275fac=function(t){return new(t||N)},N.\u0275cmp=e.Xpm({type:N,selectors:[["bd2-contr-desc-view"]],inputs:{model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(t,n){1&t&&e.YNc(0,pt,4,3,"div",0),2&t&&e.Q6J("ngIf",n.model)},dependencies:[r.sg,r.O5],encapsulation:2});class U{}function ft(i,t){if(1&i&&(e.TgZ(0,"div")(1,"strong"),e._uU(2,"Details"),e.qZA(),e.TgZ(3,"div"),e._uU(4),e.qZA()()),2&i){const n=e.oxw(3);e.xp6(4),e.Oqu(n.model.description)}}function ht(i,t){if(1&i&&(e.TgZ(0,"div")(1,"strong"),e._uU(2,"Technique:"),e.qZA(),e._uU(3),e.YNc(4,ft,5,1,"div",0),e.qZA()),2&i){const n=e.oxw(2);e.xp6(3),e.AsE(" ",n.model.technique," ",n.model.equipment?"("+n.model.equipment+")":""," "),e.xp6(1),e.Q6J("ngIf",n.model.description)}}function gt(i,t){1&i&&(e.TgZ(0,"div"),e._uU(1," Unspecified "),e.qZA())}function vt(i,t){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,ht,5,3,"div",0),e.YNc(2,gt,2,0,"div",0),e.qZA()),2&i){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.model.technique),e.xp6(1),e.Q6J("ngIf",!n.model.technique)}}U.\u0275fac=function(t){return new(t||U)},U.\u0275cmp=e.Xpm({type:U,selectors:[["bd2-simple-bio-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(t,n){1&t&&e.YNc(0,_t,9,2,"div",0),2&t&&e.Q6J("ngIf",n.model)},dependencies:[r.O5],encapsulation:2});class J{constructor(){}ngOnInit(){}}function xt(i,t){if(1&i&&(e.TgZ(0,"div")(1,"h3"),e._uU(2,"Overview of experimental details"),e.qZA(),e.TgZ(3,"div",1)(4,"div",2),e._uU(5,"General description"),e.qZA(),e.TgZ(6,"div",3),e._UZ(7,"bd2-general-desc-view",4),e.qZA()(),e.TgZ(8,"div",1)(9,"div",2),e._uU(10,"Contributions"),e.qZA(),e.TgZ(11,"div",3),e._UZ(12,"bd2-contr-desc-view",4),e.qZA()(),e.TgZ(13,"div",1)(14,"div",2),e._uU(15,"Biological details"),e.qZA(),e.TgZ(16,"div",3),e._UZ(17,"bd2-simple-bio-desc-view",4),e.qZA()(),e.TgZ(18,"div",1)(19,"div",2),e._uU(20,"Measurement details"),e.qZA(),e.TgZ(21,"div",3),e._UZ(22,"bd2-measurement-desc-view",4),e.qZA()()()),2&i){const n=e.oxw();e.xp6(7),e.Q6J("model",n.assay.generalDesc),e.xp6(5),e.Q6J("model",n.assay.contributionDesc),e.xp6(5),e.Q6J("model",n.assay),e.xp6(5),e.Q6J("model",n.assay.experimentalDetails.measurementDesc)}}J.\u0275fac=function(t){return new(t||J)},J.\u0275cmp=e.Xpm({type:J,selectors:[["bd2-measurement-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(t,n){1&t&&e.YNc(0,vt,3,2,"div",0),2&t&&e.Q6J("ngIf",n.model)},dependencies:[r.O5],encapsulation:2});class z extends ie.w{constructor(t){super(t)}}z.\u0275fac=function(t){return new(t||z)(e.Y36(h.L))},z.\u0275cmp=e.Xpm({type:z,selectors:[["ng-component"]],features:[e._Bn([]),e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"model"]],template:function(t,n){1&t&&e.YNc(0,xt,23,4,"div",0),2&t&&e.Q6J("ngIf",n.assay)},dependencies:[r.O5,q,N,U,J],encapsulation:2});class oe{validate(t){const n=[];return t?((!t.name||""==t.name.trim())&&n.push("Non empty name is required"),(!t.purpose||""==t.purpose.trim())&&n.push("Purpose is required"),t.purpose&&t.purpose.trim().length<20&&n.push("Purpose is too short"),n):["General description cannot be empty"]}GeneralDescValidator(){}}oe.INSTANCE=new oe;class se{validate(t){return t?t.authors.length<1?["At least one author is required"]:[]:["Contribution cannot be empty"]}ContributionDescValidator(){}}se.INSTANCE=new se;class le{constructor(){}validate(t){const n=[];return t?((!t.species||""==t.species.trim())&&n.push("Non empty species is required"),(!t.dataCategory||"NONE"==t.dataCategory.name)&&n.push("Data category is required"),n):["Cannot validate null object"]}}le.INSTANCE=new le;class re{constructor(){this.generalV=oe.INSTANCE,this.contribV=se.INSTANCE,this.bioV=le.INSTANCE}validate(t){let n=[];return n=n.concat(this.generalV.validate(t.generalDesc),this.contribV.validate(t.contributionDesc),this.bioV.validate(t)),n}}re.INSTANCE=new re;var de=c(7139);class be extends de.X{constructor(t){super(t),this.onAccepted=new e.vpe,this.onCancelled=new e.vpe}cancel(){this.clearErrors(),this.onCancelled.emit(!0)}save(){this._orgModel&&this.triggerValidation()&&(this._orgModel.setAll(this._model),this.onAccepted.emit(this._orgModel))}getModel(){return this._model}setModel(t){this._orgModel=t,t&&(this._model=t.clone())}}class Ct{constructor(t){this.text=t||"",this.nextPosition=0,this.limit=this.text.length,this.currentWorld=""}next(){if(this.nextPosition>=this.limit)return"";for(;this.nextPosition<this.limit;this.nextPosition++){const t=this.text.charAt(this.nextPosition);if(" "===t||"\t"===t||"\n"===t){if(this.currentWorld){const n=this.currentWorld.toLowerCase();return this.currentWorld="",n}}else{if("."===t||","===t||":"===t||"'"===t)continue;this.currentWorld=this.currentWorld+t}}return this.currentWorld.toLowerCase()}}class D{static initBannedWords(){const t=new Set;return t.add("sensible"),t.add("description"),t.add("with"),t.add("more"),t.add("words"),t.add("required"),t.add("purpose"),t.add("hypothesis"),t}static removeLetterChain(t){if(!t)return"";const n=t.length;let s=t.charAt(0),o=t.charAt(0);for(let a=1;a<n;a++){const b=t.charAt(a);b!==o&&(o=b,s+=b)}return s}static removePairChain(t){if(!t)return"";if(t.length<4)return t;const n=t.length-1;let s=t.substring(0,2),o=s,a=2;for(;a<n;){const b=t.substring(a,a+2);b!==o?(o=o.charAt(1)+b.charAt(0),s+=b.charAt(0),a++):a+=2}return a==n&&(s+=t.charAt(t.length-1)),s}static simplifyWorld(t){let n=D.removeLetterChain(t);return n=D.removePairChain(n),n}static countDistinctCharacters(t){if(!t)return 0;const n=new Set;for(let s=0;s<t.length;s++)n.add(t.charAt(s));return n.size}static isSensibleWorld(t){if(!t||t.length>6&&D.countDistinctCharacters(t)<=4||D.bannedWords.has(t))return!1;const n=D.simplifyWorld(t);let s=4;return 4===t.length&&(s=3),t.length>10&&(s=.6*t.length),n.length>=s}}D.bannedWords=D.initBannedWords();class Tt{constructor(t){this.minWords=5,this.previouslyValid="",this.minWords=t||5}validateText(t){if(t&&this.previouslyValid&&t.startsWith(this.previouslyValid))return null;const n=this.countWords(t,this.minWords);return n<this.minWords?{minWords:"required "+this.minWords+" found: "+n}:(this.previouslyValid=t,null)}countWords(t,n){const s=new Ct(t),o=new Set;for(let a=s.next();a&&o.size<n;a=s.next())D.isSensibleWorld(a)&&o.add(a);return o.size}}var Ze=c(7467),d=c(4006),me=c(9602),F=c(9549),ue=c(4144);function bt(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div")(1,"form",null,1)(3,"div",2)(4,"mat-form-field",3)(5,"mat-label",4),e._uU(6,"Name"),e.qZA(),e.TgZ(7,"input",5,6),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.model.name=o)}),e.qZA(),e.TgZ(9,"mat-hint"),e._uU(10,"Good name hints the data content"),e.qZA(),e.TgZ(11,"mat-error"),e._uU(12,"Descriptive name is required"),e.qZA()()(),e.TgZ(13,"div",2)(14,"mat-form-field",3)(15,"mat-label",7),e._uU(16,"Purpose/Hypothesis"),e.qZA(),e.TgZ(17,"textarea",8,9),e.NdJ("input",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.checkPurpose())})("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.model.purpose=o)}),e._uU(19,"                   "),e.qZA(),e.TgZ(20,"mat-hint"),e._uU(21,"Sensible description with more than few words is required"),e.qZA()()(),e.TgZ(22,"div",2)(23,"mat-form-field",3)(24,"mat-label",10),e._uU(25,"Description"),e.qZA(),e.TgZ(26,"textarea",11,12),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.model.description=o)}),e._uU(28,"                 "),e.qZA()()(),e.TgZ(29,"div",2)(30,"mat-form-field",3)(31,"mat-label",13),e._uU(32,"Comments"),e.qZA(),e.TgZ(33,"textarea",14,15),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.model.comments=o)}),e._uU(35,"                "),e.qZA()()(),e.TgZ(36,"div",2)(37,"mat-form-field")(38,"input",16,17),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.executionDate=o)}),e.qZA(),e._UZ(40,"mat-datepicker-toggle",18)(41,"mat-datepicker",null,19),e.TgZ(43,"mat-error"),e._uU(44,"Date is required and cannot be much in the future"),e.qZA()(),e._UZ(45,"br"),e.qZA(),e.TgZ(46,"button",20),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.save())}),e._uU(47),e.qZA(),e.TgZ(48,"button",21),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.cancel())}),e._uU(49,"Cancel"),e.qZA()()()}if(2&i){const n=e.MAs(2),s=e.MAs(18),o=e.MAs(42),a=e.oxw();e.xp6(7),e.Q6J("ngModel",a.model.name),e.xp6(10),e.Q6J("ngModel",a.model.purpose),e.xp6(3),e.Udp("color",a.sufficientPurpose||s.pristine?"":"red"),e.xp6(6),e.Q6J("ngModel",a.model.description),e.xp6(7),e.Q6J("ngModel",a.model.comments),e.xp6(5),e.Q6J("matDatepicker",o)("ngModel",a.executionDate)("max",a.maxDate)("min",a.minDate),e.xp6(2),e.Q6J("for",o),e.xp6(6),e.Q6J("disabled",a.blocked||!n.form.valid||!a.sufficientPurpose),e.xp6(1),e.Oqu(a.okLabel)}}class O extends be{constructor(){super(oe.INSTANCE),this.okLabel="Save",this.sufficientPurpose=!1,this.purposeWorldValidator=new Tt(5),this.maxDate=new Date,this.maxDate.setDate(this.maxDate.getDate()+21),this.minDate=new Date,this.minDate.setFullYear(this.minDate.getFullYear()-10)}get model(){return this._model}set model(t){this.setModel(t),this.executionDate=t.executionDate.date,this.checkPurpose()}checkPurpose(){this.sufficientPurpose=null===this.purposeWorldValidator.validateText(this.model.purpose)}save(){this.model.executionDate=Ze.h.fromDate(this.executionDate),super.save()}}O.\u0275fac=function(t){return new(t||O)},O.\u0275cmp=e.Xpm({type:O,selectors:[["bd2-general-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["gDescForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","gName"],["matInput","","id","gName","maxlength","100","minlength","6","name","gName","placeholder","e.g. Testing robustness in low light (E12)","required","","type","text",1,"",3,"ngModel","ngModelChange"],["gName","ngModel"],["for","gPurpose"],["matInput","","id","gPurpose","minlength","55","name","gPurpose","placeholder","Describe the main aim of the experiment. What you tried to achieve, test, verify, on what kind of samples.","required","","rows","4","type","text",1,"",3,"ngModel","input","ngModelChange"],["gPurpose","ngModel"],["for","gDescription"],["matInput","","id","gDescription","name","gDescription","placeholder","Describe how the experiment was conducted, what environmental conditions, sampling procedure.\nFor example: seedlings were exposed to short day light regime (LD 6:18) at two temperatures 15 and 25. Samples where harvested every 4 hours for 3 days and the genes levels measured with RT PCR","rows","5","type","text",1,"",3,"ngModel","ngModelChange"],["gDescription","ngModel"],["for","gComments"],["matInput","","id","gComments","name","gComments","placeholder","Optional remarks, for example technical issues during the experiment, discrepancies/simplifications of in the following sections","type","text",1,"",3,"ngModel","ngModelChange"],["gComments","ngModel"],["matInput","","name","executionDate","placeholder","Exp. execution date","required","",3,"matDatepicker","ngModel","max","min","ngModelChange"],["gDate","ngModel"],["matSuffix","",3,"for"],["picker",""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(t,n){1&t&&e.YNc(0,bt,50,13,"div",0),2&t&&e.Q6J("ngIf",n.model)},dependencies:[r.O5,d._Y,d.Fj,d.JJ,d.JL,d.Q7,d.wO,d.nD,d.On,d.F,me.Mq,me.hl,me.nW,F.TO,F.KE,F.bx,F.hX,F.R9,ue.Nt],encapsulation:2});var Zt=c(906),Ae=c(8545),At=c(1412),j=c(7045),pe=c(7331),Ft=c(7392),yt=c(4850),Fe=c(3546);const Et=["persForm"],Dt=["instForm"],Mt=["fundForm"];function wt(i,t){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.xp6(1),e.Oqu(n)}}function qt(i,t){if(1&i&&(e.TgZ(0,"div",35)(1,"ul",36),e.YNc(2,wt,2,1,"li",37),e.qZA()()),2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.errors)}}function Nt(i,t){1&i&&(e.TgZ(0,"p"),e._uU(1,"Please add an author"),e.qZA())}function Ut(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"mat-chip",38),e.NdJ("removed",function(){const a=e.CHM(n).$implicit,b=e.oxw(2);return e.KtG(b.removeAuthor(a))}),e._uU(1),e.TgZ(2,"mat-icon",39),e._uU(3,"cancel"),e.qZA()()}if(2&i){const n=t.$implicit;e.xp6(1),e.hij(" ",n.name," ")}}function Jt(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"mat-chip",38),e.NdJ("removed",function(){const a=e.CHM(n).$implicit,b=e.oxw(3);return e.KtG(b.removeCurator(a))}),e._uU(1),e.TgZ(2,"mat-icon",39),e._uU(3,"cancel"),e.qZA()()}if(2&i){const n=t.$implicit;e.xp6(1),e.hij(" ",n.name," ")}}function It(i,t){if(1&i&&(e.TgZ(0,"div",2)(1,"label")(2,"strong"),e._uU(3,"Data curators"),e.qZA()(),e.TgZ(4,"mat-chip-list"),e.YNc(5,Jt,4,1,"mat-chip",3),e.qZA(),e._UZ(6,"mat-divider",4),e.qZA()),2&i){const n=e.oxw(2);e.xp6(5),e.Q6J("ngForOf",n.model.curators)}}function Ot(i,t){1&i&&(e.TgZ(0,"p"),e._uU(1,"Please add an institution"),e.qZA())}function St(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"mat-chip",38),e.NdJ("removed",function(){const a=e.CHM(n).$implicit,b=e.oxw(2);return e.KtG(b.removeInstitution(a))}),e._uU(1),e.TgZ(2,"mat-icon",39),e._uU(3,"cancel"),e.qZA()()}if(2&i){const n=t.$implicit;e.xp6(1),e.hij(" ",n.name," ")}}function Qt(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"mat-chip",38),e.NdJ("removed",function(){const a=e.CHM(n).$implicit,b=e.oxw(3);return e.KtG(b.removeFunding(a))}),e._uU(1),e.TgZ(2,"mat-icon",39),e._uU(3,"cancel"),e.qZA()()}if(2&i){const n=t.$implicit;e.xp6(1),e.hij(" ",n.name," ")}}function kt(i,t){if(1&i&&(e.TgZ(0,"div",2)(1,"label")(2,"strong"),e._uU(3,"Fundings"),e.qZA()(),e.TgZ(4,"mat-chip-list"),e.YNc(5,Qt,4,1,"mat-chip",3),e.qZA(),e._UZ(6,"mat-divider",4),e.qZA()),2&i){const n=e.oxw(2);e.xp6(5),e.Q6J("ngForOf",n.model.fundings)}}function Yt(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div"),e.YNc(1,qt,3,1,"div",1),e.TgZ(2,"mat-card")(3,"mat-card-content")(4,"div",2)(5,"label")(6,"strong"),e._uU(7,"Authors"),e.qZA()(),e.YNc(8,Nt,2,0,"p",0),e.TgZ(9,"mat-chip-list"),e.YNc(10,Ut,4,1,"mat-chip",3),e.qZA(),e._UZ(11,"mat-divider",4),e.qZA(),e.YNc(12,It,7,1,"div",5),e.TgZ(13,"form",6,7)(15,"div",8)(16,"mat-form-field")(17,"mat-label",9),e._uU(18,"Name"),e.qZA(),e.TgZ(19,"input",10,11),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.firstName=o)}),e.qZA()()(),e.TgZ(21,"div",2)(22,"mat-form-field")(23,"mat-label",12),e._uU(24,"Surname"),e.qZA(),e.TgZ(25,"input",13,14),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.lastName=o)}),e.qZA()()(),e.TgZ(27,"button",15),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.addAuthor())}),e._uU(28,"New Author "),e.qZA(),e.TgZ(29,"button",16),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.addCurator())}),e._uU(30,"New Curator "),e.qZA()()()(),e._UZ(31,"mat-divider",17),e.TgZ(32,"mat-card")(33,"mat-card-content")(34,"div",2)(35,"label")(36,"strong"),e._uU(37,"Institutions"),e.qZA()(),e.YNc(38,Ot,2,0,"p",0),e.TgZ(39,"mat-chip-list"),e.YNc(40,St,4,1,"mat-chip",3),e.qZA(),e._UZ(41,"mat-divider",4),e.qZA(),e.TgZ(42,"form",6,18)(44,"div",2)(45,"mat-form-field")(46,"mat-label",19),e._uU(47,"Institution"),e.qZA(),e.TgZ(48,"input",20,21),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.institutionName=o)}),e.qZA()()(),e.TgZ(50,"button",22),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.addInstitution())}),e._uU(51," Add Institution "),e.qZA(),e._UZ(52,"mat-divider",23),e.qZA(),e.YNc(53,kt,7,1,"div",5),e.TgZ(54,"form",6,24)(56,"div",2)(57,"mat-form-field",25)(58,"mat-label",26),e._uU(59,"Funder"),e.qZA(),e.TgZ(60,"input",27,28),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.funderName=o)}),e.qZA()()(),e.TgZ(62,"div",2)(63,"mat-form-field")(64,"mat-label",29),e._uU(65,"Grant"),e.qZA(),e.TgZ(66,"input",30,31),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.grantNr=o)}),e.qZA()()(),e.TgZ(68,"button",22),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.addFunding())}),e._uU(69," Add Funding "),e.qZA()()()(),e.TgZ(70,"div",32)(71,"button",33),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.save())}),e._uU(72),e.qZA(),e.TgZ(73,"button",34),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.cancel())}),e._uU(74,"Cancel"),e.qZA()()()}if(2&i){const n=e.MAs(14),s=e.MAs(43),o=e.MAs(55),a=e.oxw();e.xp6(1),e.Q6J("ngIf",a.errors),e.xp6(7),e.Q6J("ngIf",!a.model.authors||a.model.authors.length<1),e.xp6(2),e.Q6J("ngForOf",a.model.authors),e.xp6(2),e.Q6J("ngIf",a.model.curators.length>0),e.xp6(7),e.Q6J("ngModel",a.firstName),e.xp6(6),e.Q6J("ngModel",a.lastName),e.xp6(2),e.Q6J("disabled",!n.form.valid),e.xp6(2),e.Q6J("disabled",!n.form.valid),e.xp6(9),e.Q6J("ngIf",!a.model.institutions||a.model.institutions.length<1),e.xp6(2),e.Q6J("ngForOf",a.model.institutions),e.xp6(8),e.Q6J("ngModel",a.institutionName),e.xp6(2),e.Q6J("disabled",!s.form.valid),e.xp6(3),e.Q6J("ngIf",a.model.fundings.length>0),e.xp6(7),e.Q6J("ngModel",a.funderName),e.xp6(6),e.Q6J("ngModel",a.grantNr),e.xp6(2),e.Q6J("disabled",!o.form.valid),e.xp6(3),e.Q6J("disabled",a.blocked||a.errors),e.xp6(1),e.Oqu(a.okLabel)}}class S extends be{constructor(){super(se.INSTANCE),this.okLabel="Save",this.blocked=!1}get model(){return this._model}set model(t){this.setModel(t)}addAuthor(){const t=this.selectedPerson();t&&(this._model.authors.push(t),this.resetPerson(),this.triggerValidation())}addCurator(){const t=this.selectedPerson();t&&(this._model.curators.push(t),this.resetPerson())}removeAuthor(t){(0,j.d2)(t,this._model.authors),this.triggerValidation()}removeCurator(t){(0,j.d2)(t,this._model.curators)}addInstitution(){const t=this.selectedInstitution();if(t){if(this.hasInstitution(t,this._model))return;this._model.institutions.push(t),this.resetInstitution()}}hasInstitution(t,n){return n.institutions.findIndex(s=>s.name===t.name)>=0}removeInstitution(t){(0,j.d2)(t,this.model.institutions)}addFunding(){const t=this.selectedFunding();if(t){if(this.hasFunding(t,this._model))return;this._model.fundings.push(t),this.resetFunding()}}hasFunding(t,n){return n.fundings.findIndex(s=>s.name===t.name)>=0}removeFunding(t){(0,j.d2)(t,this._model.fundings)}resetPerson(){this.firstName=void 0,this.lastName=void 0,this.persForm.reset()}selectedPerson(){return this.firstName&&this.lastName?new At.F(this.firstName,this.lastName):null}resetInstitution(){this.institutionName=void 0,this.instForm.reset()}selectedInstitution(){return this.institutionName?new Ae.v(this.institutionName):null}resetFunding(){this.funderName=void 0,this.grantNr=void 0,this.fundForm.reset()}selectedFunding(){if(this.funderName){const t=new Ae.v(this.funderName),n=new Zt.e;return n.institution=t,n.grantNr=this.grantNr,n}return null}}S.\u0275fac=function(t){return new(t||S)},S.\u0275cmp=e.Xpm({type:S,selectors:[["bd2-contr-desc-form"]],viewQuery:function(t,n){if(1&t&&(e.Gf(Et,5),e.Gf(Dt,5),e.Gf(Mt,5)),2&t){let s;e.iGM(s=e.CRH())&&(n.persForm=s.first),e.iGM(s=e.CRH())&&(n.instForm=s.first),e.iGM(s=e.CRH())&&(n.fundForm=s.first)}},inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"form-group"],[3,"removed",4,"ngFor","ngForOf"],["inset","",1,"mt-2"],["class","form-group",4,"ngIf"],[1,"form-inline"],["persForm","ngForm"],[1,"form-group","mr-1"],["for","pFirst"],["matInput","","id","pFirst","maxlength","100","minlength","2","name","pFirst","placeholder","e.g. John)","required","","type","text",3,"ngModel","ngModelChange"],["pFirst","ngModel"],["for","pLast"],["matInput","","id","pLast","maxlength","100","minlength","2","name","pLast","placeholder","e.g. Smith","required","","type","text",3,"ngModel","ngModelChange"],["pLast","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","mr-1","ml-1",3,"disabled","click"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"mb-1"],["instForm","ngForm"],["for","iName"],["matInput","","id","iName","maxlength","100","minlength","3","name","iName","placeholder","e.g. University of Edinburgh","required","","type","text",1,"",3,"ngModel","ngModelChange"],["iName","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","ml-1",3,"disabled","click"],["inset","",1,"mt-1","mb-2"],["fundForm","ngForm"],[1,"mr-1"],["for","fName"],["matInput","","id","fName","maxlength","100","minlength","3","name","fName","placeholder","e.g. BBSRC","required","","type","text",1,"",3,"ngModel","ngModelChange"],["fName","ngModel"],["for","fGrant"],["matInput","","id","fGrant","maxlength","100","minlength","3","name","fGrant","placeholder","e.g. EC2014","type","text",1,"",3,"ngModel","ngModelChange"],["fGrant","ngModel"],[1,"mt-2"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"alert","alert-danger"],[1,"mb-0"],[4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""]],template:function(t,n){1&t&&e.YNc(0,Yt,75,18,"div",0),2&t&&e.Q6J("ngIf",n.model)},dependencies:[r.sg,r.O5,d._Y,d.Fj,d.JJ,d.JL,d.Q7,d.wO,d.nD,d.On,d.F,F.KE,F.hX,ue.Nt,pe.qn,pe.HS,pe.qH,Ft.Hw,yt.d,Fe.a8,Fe.dn],encapsulation:2});var _e=c(7762),Gt=c(4986),Pt=c(1165),Lt=c(4482),Kt=c(8421),Rt=c(3888),Bt=c(5403),Ht=c(9672);const Vt=(0,Rt.d)(i=>function(n=null){i(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=n});function zt(i){throw new Vt(i)}var jt=c(8505),Xt=c(262),fe=c(9646),ye=c(5716);class Q{constructor(t){this.BD2REST=t,this.popularSpecies=["Arabidopsis thaliana","Brassica rapa","Danio rerio","Drosophila melanogaster","Glycine max","Homo sapiens","Lemna gibba","Lemna minor","Marchantia polymorpha","Medicago truncatula","Mus musculus","Nannochloropsis","Neurospora crassa","Oryza sativa","Ostreococcus tauri","Phaeodactylum tricornutum","Physcometrella patens","Picea abies","Rattus norvegicus","Saccharomyces cerevisiae","Synechococcus elongatus","Synthetic data"],this.fetchedSpecies=void 0,console.log("Species Service")}species(){return this.fetchedSpecies?Promise.resolve(this.fetchedSpecies):this.fetchSpecies().toPromise()}fetchSpecies(){return this.BD2REST.species().pipe(function Wt(i,t){const{first:n,each:s,with:o=zt,scheduler:a=t??Gt.z,meta:b=null}=(0,Pt.q)(i)?{first:i}:"number"==typeof i?{each:i}:i;if(null==n&&null==s)throw new TypeError("No timeout provided.");return(0,Lt.e)((ge,I)=>{let we,E,ve=null,xe=0;const qe=Ce=>{E=(0,Ht.f)(I,a,()=>{try{we.unsubscribe(),(0,Kt.Xf)(o({meta:b,lastValue:ve,seen:xe})).subscribe(I)}catch(di){I.error(di)}},Ce)};we=ge.subscribe((0,Bt.x)(I,Ce=>{E?.unsubscribe(),xe++,I.next(ve=Ce),s>0&&qe(s)},void 0,void 0,()=>{E?.closed||E?.unsubscribe(),ve=null})),!xe&&qe(null!=n?"number"==typeof n?n:+n-a.now():s)})}(5e3),(0,jt.b)(t=>{if(!(t&&t.length>0))throw new Error("Retrieved empty species falls back to default");this.fetchedSpecies=t}),(0,Xt.K)(t=>(console.log(" Could not fetch species",t),(0,fe.of)(this.popularSpecies))))}}Q.\u0275fac=function(t){return new(t||Q)(e.LFG(ye.q))},Q.\u0275prov=e.Yz7({token:Q,factory:Q.\u0275fac,providedIn:"root"});var $t=c(4385),Ee=c(3238);function en(i,t){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.Q6J("value",n),e.xp6(1),e.hij("",n," ")}}function tn(i,t){if(1&i&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.Q6J("value",n.name),e.xp6(1),e.hij(" ",n.longName," ")}}function nn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div")(1,"form",null,1)(3,"div",2)(4,"mat-form-field",3)(5,"mat-label",4),e._uU(6,"Species"),e.qZA(),e.TgZ(7,"mat-select",5,6),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a._model.species=o)}),e.YNc(9,en,2,2,"mat-option",7),e.qZA(),e.TgZ(10,"mat-hint"),e._uU(11,"Please email us if you don't see suitable terms in the value lists"),e.qZA()()(),e.TgZ(12,"div",2)(13,"mat-form-field",3)(14,"mat-label",8),e._uU(15,"Data category"),e.qZA(),e.TgZ(16,"mat-select",9,10),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a._model.category=o)}),e.YNc(18,tn,2,2,"mat-option",7),e.qZA(),e.TgZ(19,"mat-hint"),e._uU(20,"Please email us if you don't see suitable terms in the value lists"),e.qZA()()(),e.TgZ(21,"button",11),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.save())}),e._uU(22),e.qZA(),e.TgZ(23,"button",12),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.cancel())}),e._uU(24,"Cancel"),e.qZA()()()}if(2&i){const n=e.MAs(2),s=e.oxw();e.xp6(7),e.Q6J("ngModel",s._model.species),e.xp6(2),e.Q6J("ngForOf",s.knownSpecies),e.xp6(7),e.Q6J("ngModel",s._model.category),e.xp6(2),e.Q6J("ngForOf",s.categories),e.xp6(3),e.Q6J("disabled",s.blocked||!n.form.valid),e.xp6(1),e.Oqu(s.okLabel)}}class k extends de.X{constructor(t){super(),this.speciesService=t,this.okLabel="Save",this.blocked=!1,this.onAccepted=new e.vpe,this.onCancelled=new e.vpe,this.categories=[],this.knownSpecies=[],this._model={species:null,category:null}}set model(t){t&&(this.experiment=t,this._model.species=t.species,this._model.category=t.dataCategory?t.dataCategory.name:null)}getModel(){return this._model}ngOnInit(){this.speciesService.species().then(t=>this.knownSpecies=t),this.categories=this.initCategories()}cancel(){this.clearErrors(),this.onCancelled.emit(!0)}save(){this.triggerValidation()&&(this.experiment.dataCategory=_e.c.get(this._model.category),this.experiment.species=this._model.species,this.onAccepted.emit(this.experiment))}validate(t){const n=[];return(!t.species||""===t.species.trim())&&n.push("Species cannot be empty"),t.species&&this.knownSpecies.indexOf(t.species)<0&&n.push("Unknown species: "+t.species),(!t.category||"NONE"===t.category)&&n.push("Data category is required"),0===n.length?null:n}initCategories(){const t=_e.c.getValidOptions().slice();return(0,j.d2)(_e.c.get("NONE"),t),t}}k.\u0275fac=function(t){return new(t||k)(e.Y36(Q))},k.\u0275cmp=e.Xpm({type:k,selectors:[["bd2-simple-bio-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["sBioForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","species"],["id","species","required","","placeholder","Select species","name","species",1,"",3,"ngModel","ngModelChange"],["species","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","dataCategory"],["id","dataCategory","required","","placeholder","Select category","name","dataCategory",1,"",3,"ngModel","ngModelChange"],["dataCategory","ngModel"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(t,n){1&t&&e.YNc(0,nn,25,6,"div",0),2&t&&e.Q6J("ngIf",n.experiment)},dependencies:[r.sg,r.O5,d._Y,d.JJ,d.JL,d.Q7,d.On,d.F,F.KE,F.bx,F.hX,$t.gD,Ee.ey],encapsulation:2});var De=c(8675),he=c(7271);class Y{constructor(){this.equipments=new Map,this.parameters=new Map,this.initTechniques()}getTechniques(){return Promise.resolve(this.techniques)}getEquipments(t){return this.equipments.has(t)?Promise.resolve(this.equipments.get(t)):Promise.reject(new Error("Unknown technique: "+t))}getParameters(t){return this.parameters.has(t)?Promise.resolve(this.parameters.get(t)):Promise.reject(new Error("Unknown technique: "+t))}registerEquipment(t,n){return this.equipments.has(t)?(this.equipments.get(t).indexOf(n)<0&&this.equipments.get(t).push(n),Promise.resolve(n)):Promise.reject(new Error("Unknown technique: "+t))}initTechniques(){const t=["Luciferase luminescence","Bioluminescence","(G)FP fluorescence","Delayed fluorescence","Endogenous fluorescence","Leaf movement","General imaging"];this.techniques=t.concat(["Computer simulation","qRT-PCR","RNA microarray","RNA-Seq","Northern blot","Western blot","Protein array","Mass Spectrometry","Flow cytometry","Spectrophotometry","Immunoprecipitation","Biomass Assay","Gas exchange","Oxygen concentration","Other"]);const n=["","Luminometer","Tecan Infinite 200 PRO","Topcount 1","Topcount 2","Topcount 3","Topcount 4","HAM 1","HAM 2","HAM 3","Unknown"];this.equipments=new Map,this.techniques.forEach(o=>this.equipments.set(o,["","Unknown"])),t.forEach(o=>this.equipments.set(o,n)),this.equipments.set("qRT-PCR",["","Robot + Light Cycler 480","Light Cycler 480","Unknown"]),this.equipments.set("Oxygen concentration",["","Galvanic Clarck's probe","Unknown"]);const s=[];s.push(new he.d("exposure_time",void 0,"Exposure time","min")),s.push(new he.d("interval",void 0,"Img interval","h")),s.push(new he.d("start_time",void 0,"Start time","h")),this.parameters=new Map,this.techniques.forEach(o=>this.parameters.set(o,[])),t.forEach(o=>this.parameters.set(o,s))}}Y.\u0275fac=function(t){return new(t||Y)},Y.\u0275prov=e.Yz7({token:Y,factory:Y.\u0275fac,providedIn:"root"});var Me=c(3805);function on(i,t){1&i&&(e.TgZ(0,"mat-error"),e._uU(1,"Known technique must be selected"),e.qZA())}function sn(i,t){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n," ")}}function rn(i,t){if(1&i&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.Q6J("value",n),e.xp6(1),e.hij(" ",n," ")}}function an(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div")(1,"form",1)(2,"mat-hint",2),e._uU(3,"Please email us if you don't see suitable terms in the value lists"),e.qZA(),e.TgZ(4,"div",3)(5,"mat-form-field",4)(6,"mat-label",5),e._uU(7,"Technique"),e.qZA(),e._UZ(8,"input",6,7),e.TgZ(10,"mat-hint"),e._uU(11,"Type to select technique (backspace for all available)"),e.qZA(),e.YNc(12,on,2,0,"mat-error",0),e.qZA(),e.TgZ(13,"mat-autocomplete",8,9),e.NdJ("optionSelected",function(o){e.CHM(n);const a=e.oxw();return e.KtG(a.techniqueSelected(o))}),e.YNc(15,sn,2,2,"mat-option",10),e.ALo(16,"async"),e.qZA()(),e.TgZ(17,"div",3)(18,"mat-form-field",4)(19,"mat-label",11),e._uU(20,"Equipment"),e.qZA(),e._UZ(21,"input",12,13),e.TgZ(23,"mat-hint"),e._uU(24,"Type define your equipment or choose from the list (backspace for all known)"),e.qZA()(),e.TgZ(25,"mat-autocomplete",null,14),e.YNc(27,rn,2,2,"mat-option",10),e.ALo(28,"async"),e.qZA()(),e.TgZ(29,"div",3)(30,"mat-form-field",4)(31,"mat-label",15),e._uU(32,"Description"),e.qZA(),e.TgZ(33,"textarea",16),e._uU(34,"     "),e.qZA(),e.TgZ(35,"mat-hint"),e._uU(36,"Describe how the measurement was conducted"),e.qZA()()(),e.TgZ(37,"button",17),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.save())}),e._uU(38),e.qZA(),e.TgZ(39,"button",18),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.cancel())}),e._uU(40,"Cancel"),e.qZA()()()}if(2&i){const n=e.MAs(14),s=e.MAs(26),o=e.oxw();e.xp6(1),e.Q6J("formGroup",o.formModel),e.xp6(7),e.Q6J("matAutocomplete",n),e.xp6(4),e.Q6J("ngIf",null==o.formModel.get("technique").errors?null:o.formModel.get("technique").errors.validTechnique),e.xp6(3),e.Q6J("ngForOf",e.lcZ(16,8,o.filteredTechniques)),e.xp6(6),e.Q6J("matAutocomplete",s),e.xp6(6),e.Q6J("ngForOf",e.lcZ(28,10,o.filteredEquipments)),e.xp6(10),e.Q6J("disabled",o.blocked||!o.formModel.valid),e.xp6(1),e.Oqu(o.okLabel)}}class G{constructor(t,n,s){this.techniqueService=t,this.feedback=n,this.fb=s,this.okLabel="Save",this.onAccepted=new e.vpe,this.onCancelled=new e.vpe,this.techniques=[],this.filteredTechniques=(0,fe.of)([]),this.equipments=[],this.filteredEquipments=(0,fe.of)([])}set model(t){this.setModel(t),this.updateTechniques().then(n=>this.updateEquipments(t.technique)).then(n=>this.formModel=this.buildMainForm(t)).then(n=>{this.filteredTechniques=this.formModel.get("technique").valueChanges.pipe((0,De.O)(""),(0,f.U)(s=>this.filter(this.techniques,s))),this.filteredEquipments=this.formModel.get("equipment").valueChanges.pipe((0,De.O)(""),(0,f.U)(s=>this.filter(this.equipments,s)))})}setModel(t){this._orgModel=t}ngOnInit(){this.updateTechniques()}filter(t,n){const s=n.toLowerCase();return t.filter(o=>o.toLowerCase().includes(s))}buildMainForm(t){return this.fb.group({technique:[t.technique,[d.kI.required,n=>this.knownTechnique(n.value)]],equipment:[t.equipment],description:[t.description],parameters:[]})}knownTechnique(t){return t?this.techniques.find(n=>n===t)?null:{validTechnique:"Unknown technique: "+t}:{validTechnique:"Empty value"}}techniqueSelected(t){t.option.value&&this.updateEquipments(t.option.value)}updateTechniques(){return this.techniqueService.getTechniques().then(t=>(this.techniques=t||[],t)).catch(t=>(this.feedback.error(t),Promise.reject(t)))}updateEquipments(t){return t?this.techniqueService.getEquipments(t).then(n=>(this.equipments=n||[],n)).catch(n=>(this.feedback.error(n),Promise.reject(n))):(this.equipments=[],Promise.resolve([]))}cancel(){this.onCancelled.emit(!0)}save(){this.formModel.valid&&(this._orgModel.setAll(this.formModel.value),this.onAccepted.emit(this._orgModel))}}function cn(i,t){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.xp6(1),e.Oqu(n)}}function ln(i,t){if(1&i&&(e.TgZ(0,"div",8)(1,"ul"),e.YNc(2,cn,2,1,"li",9),e.qZA()()),2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.errors)}}function dn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"bd2-general-desc-form",10),e.NdJ("onAccepted",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.saveEdits(o))})("onCancelled",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))}),e.qZA()}if(2&i){const n=e.oxw(2);e.Q6J("blocked",n.blocked)("model",n.assay.generalDesc)}}function mn(i,t){if(1&i&&e._UZ(0,"bd2-general-desc-view",11),2&i){const n=e.oxw(2);e.Q6J("model",n.assay.generalDesc)}}function un(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",12),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(2);return e.KtG(o.activeGeneralDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("disabled",n.activeGeneralDescForm)}}function pn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"bd2-contr-desc-form",10),e.NdJ("onAccepted",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.saveEdits(o))})("onCancelled",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))}),e.qZA()}if(2&i){const n=e.oxw(2);e.Q6J("blocked",n.blocked)("model",n.assay.contributionDesc)}}function _n(i,t){if(1&i&&e._UZ(0,"bd2-contr-desc-view",11),2&i){const n=e.oxw(2);e.Q6J("model",n.assay.contributionDesc)}}function fn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",12),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(2);return e.KtG(o.activeContributionDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("disabled",n.activeContributionDescForm)}}function hn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"bd2-simple-bio-desc-form",10),e.NdJ("onAccepted",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.saveEdits(o))})("onCancelled",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))}),e.qZA()}if(2&i){const n=e.oxw(2);e.Q6J("blocked",n.blocked)("model",n.assay)}}function gn(i,t){if(1&i&&e._UZ(0,"bd2-simple-bio-desc-view",11),2&i){const n=e.oxw(2);e.Q6J("model",n.assay)}}function vn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",12),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(2);return e.KtG(o.activeSimpleBioDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("disabled",n.activeSimpleBioDescForm)}}function xn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"bd2-measurement-desc-rform",10),e.NdJ("onAccepted",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.saveEdits(o))})("onCancelled",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))}),e.qZA()}if(2&i){const n=e.oxw(2);e.Q6J("blocked",n.blocked)("model",n.assay.experimentalDetails.measurementDesc)}}function Cn(i,t){if(1&i&&e._UZ(0,"bd2-measurement-desc-view",11),2&i){const n=e.oxw(2);e.Q6J("model",n.assay.experimentalDetails.measurementDesc)}}function Tn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",12),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(2);return e.KtG(o.activeMeasurementDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("disabled",n.activeMeasurementDescForm)}}function bn(i,t){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.xp6(1),e.Oqu(n)}}function Zn(i,t){if(1&i&&(e.TgZ(0,"div",8)(1,"ul"),e.YNc(2,bn,2,1,"li",9),e.qZA()()),2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.errors)}}function An(i,t){if(1&i&&(e.TgZ(0,"div")(1,"h3"),e._uU(2,"Modify experiment description"),e.qZA(),e.YNc(3,ln,3,1,"div",1),e.TgZ(4,"div",2)(5,"div",3),e._uU(6,"General description"),e.qZA(),e.TgZ(7,"div",4),e.YNc(8,dn,1,2,"bd2-general-desc-form",5),e.YNc(9,mn,1,1,"bd2-general-desc-view",6),e.YNc(10,un,4,1,"div",0),e.qZA()(),e.TgZ(11,"div",2)(12,"div",3),e._uU(13,"Contributions"),e.qZA(),e.TgZ(14,"div",4),e.YNc(15,pn,1,2,"bd2-contr-desc-form",5),e.YNc(16,_n,1,1,"bd2-contr-desc-view",6),e.YNc(17,fn,4,1,"div",0),e.qZA()(),e.TgZ(18,"div",2)(19,"div",3),e._uU(20,"Biological details"),e.qZA(),e.TgZ(21,"div",4),e.YNc(22,hn,1,2,"bd2-simple-bio-desc-form",5),e.YNc(23,gn,1,1,"bd2-simple-bio-desc-view",6),e.YNc(24,vn,4,1,"div",0),e.qZA()(),e.TgZ(25,"div",7)(26,"div",3),e._uU(27,"Measurement details"),e.qZA(),e.TgZ(28,"div",4),e.YNc(29,xn,1,2,"bd2-measurement-desc-rform",5),e.YNc(30,Cn,1,1,"bd2-measurement-desc-view",6),e.YNc(31,Tn,4,1,"div",0),e.qZA()(),e.YNc(32,Zn,3,1,"div",1),e.qZA()),2&i){const n=e.oxw();e.xp6(3),e.Q6J("ngIf",n.errors),e.xp6(5),e.Q6J("ngIf",n.activeGeneralDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeGeneralDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeGeneralDescForm),e.xp6(5),e.Q6J("ngIf",n.activeContributionDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeContributionDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeContributionDescForm),e.xp6(5),e.Q6J("ngIf",n.activeSimpleBioDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeSimpleBioDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeSimpleBioDescForm),e.xp6(5),e.Q6J("ngIf",n.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",n.errors)}}G.\u0275fac=function(t){return new(t||G)(e.Y36(Y),e.Y36(T.T),e.Y36(d.QS))},G.\u0275cmp=e.Xpm({type:G,selectors:[["bd2-measurement-desc-rform"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"formGroup"],[1,"mb-2"],[1,"form-group"],[1,"w-100"],["for","mTechNameA"],["matInput","","formControlName","technique","id","mTechNameA","placeholder","Type to select technique (backspace for all available)","required","",1,"",3,"matAutocomplete"],["mTechNameA",""],[3,"optionSelected"],["techniqueAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["for","mEquipNameA"],["matInput","","formControlName","equipment","id","mEquipNameA","placeholder","Type to choose or define equipment",1,"",3,"matAutocomplete"],["mEquipNameA",""],["equipmentAuto","matAutocomplete"],["for","mDescription"],["matInput","","formControlName","description","id","mDescription","placeholder","Describe how the measurement was conducted, used technical tricks etc...\nFor example: plants were sprayed with luciferase two ours before measurement. Images were taken every two ours.","rows","5","type","text",1,""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(t,n){1&t&&e.YNc(0,an,41,12,"div",0),2&t&&e.Q6J("ngIf",n.formModel)},dependencies:[r.sg,r.O5,d._Y,d.Fj,d.JJ,d.JL,d.Q7,d.sg,d.u,F.TO,F.KE,F.bx,F.hX,ue.Nt,Ee.ey,Me.XC,Me.ZL,r.Ov],encapsulation:2});class X extends ie.w{constructor(t,n){super(n),this.route=t,this.blocked=!1,this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.titlePart=" Edit",this.validator=re.INSTANCE}ngOnInit(){super.ngOnInit(),this.route.fragment.subscribe(t=>{this.requestedSection=t,this.focusOnSection(t)})}ngAfterViewInit(){this.focusOnSection(this.requestedSection)}focusOnSection(t){if(!t)return;const n=document.getElementById(t);n&&n.scrollIntoView(),"MeasurementSection"===t&&(this.activeMeasurementDescForm=!0)}saveEdits(t){this.assay&&t&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.save(this.assay).then(n=>(this.feedback.success('Experiment: "'+n.name+'" updated.'),n)).then(n=>(this.currentExperiment.push(n),n)).then(n=>{this.blocked=!1,this.hideEdits(t)}).catch(n=>{this.blocked=!1,this.feedback.error(n)}))}hideEdits(t){this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiment",this.assay.id])}updateModel(t){this._orgModel=t,this.assay=t?t.clone():null,this.setTitle()}}X.\u0275fac=function(t){return new(t||X)(e.Y36(l.gz),e.Y36(h.L))},X.\u0275cmp=e.Xpm({type:X,selectors:[["ng-component"]],features:[e._Bn([]),e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"blocked","model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["id","MeasurementSection",1,"card","mb-2"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"],[3,"blocked","model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,n){1&t&&e.YNc(0,An,33,14,"div",0),2&t&&e.Q6J("ngIf",n.assay)},dependencies:[r.sg,r.O5,O,q,S,N,k,U,G,J],encapsulation:2});class v{constructor(t){this.name=t}static deserialize(t){if(null==t)return null;const n=v.valuesMap.get(t);if(n)return n;const s=+t;if(s<0||s>=v.values.length||Number.isNaN(s))throw new RangeError("Uknown AssetType "+t);return v.values[s]}static initValuesMap(){const t=new Map;return v.values.forEach(n=>t.set(n.name,n)),t}equals(t){return this.name===t.name}toJSON(){return this.name}}v.NONE=new v("NONE"),v.FILE=new v("FILE"),v.MEDIA=new v("MEDIA"),v.DATA=new v("DATA"),v.TS_DATA=new v("TS_DATA"),v.values=[v.NONE,v.FILE,v.MEDIA,v.DATA,v.TS_DATA],v.valuesMap=v.initValuesMap();class Fn{static deserialize(t){return t.created=Ze.h.deserialize(t.created),t}}class ae{constructor(){this.assetType=v.NONE,this.versions=[]}get last(){return this.versions[0]}static deserialize(t){const n=new ae;return n.id=t.id,n.originalName=t.originalName,n.url=t.url,n.assetType=v.deserialize(t.assetType),t.versions&&(n.versions=t.versions.map(s=>Fn.deserialize(s))),n}setAll(t){this.id=t.id,this.originalName=t.originalName,this.assetType=t.assetType,this.url=t.url,this.versions=t.versions}}class P{constructor(t){this.BD2REST=t}upload(t,n){const s=new FormData;for(let o=0;o<n.length;o++)s.append("file",n[o],n[o].name);return this.BD2REST.expFileUpload(t.id,s).then(o=>o.data)}getFiles(t){return this.BD2REST.files(t.id).then(n=>n.data).then(n=>this.json2AssetsList(n)).then(n=>this.fillURLs(n,t))}fillURLs(t,n){return t.map(s=>this.fillURL(s,n))}fillURL(t,n){const s=this.BD2REST.fileURL(n.id,t.id);return t.url=s,t.versions.forEach(o=>{o.url=s+"/"+o.versionId}),t}json2AssetsList(t){return t.map(n=>ae.deserialize(n))}}function yn(i,t){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&i){const n=e.oxw(2);e.xp6(1),e.Oqu(n.file.last.description)}}function En(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"li"),e._uU(1),e.ALo(2,"date"),e.TgZ(3,"strong")(4,"a",4),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(3);return e.KtG(o.recordDownload())}),e._uU(5),e.qZA()(),e._UZ(6,"br"),e._uU(7),e.qZA()}if(2&i){const n=t.$implicit;e.xp6(1),e.AsE(" Version ",n.versionId,". ",e.xi3(2,6,n.created.date,"shortDate")," "),e.xp6(3),e.s9C("href",n.url,e.LSH),e.s9C("download",n.originalName),e.xp6(1),e.Oqu(n.originalName),e.xp6(2),e.hij("",n.description," ")}}function Dn(i,t){if(1&i&&(e.TgZ(0,"div")(1,"ul",5),e.YNc(2,En,8,9,"li",6),e.qZA()()),2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.file.versions)}}function Mn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div")(1,"div",1),e._uU(2),e.TgZ(3,"a",2),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.showVersions=!o.showVersions)}),e.TgZ(4,"i",3),e._uU(5,"expand_more"),e.qZA()()(),e.TgZ(6,"h5")(7,"a",4),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.recordDownload())}),e._uU(8),e.qZA()(),e.YNc(9,yn,2,1,"div",0),e.YNc(10,Dn,3,1,"div",0),e.qZA()}if(2&i){const n=e.oxw();e.xp6(2),e.hij(" ",n.file.versions.length," versions "),e.xp6(5),e.s9C("href",n.file.url,e.LSH),e.s9C("download",n.file.last.originalName),e.xp6(1),e.Oqu(n.file.last.originalName),e.xp6(1),e.Q6J("ngIf",n.file.last.description),e.xp6(1),e.Q6J("ngIf",n.showVersions)}}P.\u0275fac=function(t){return new(t||P)(e.LFG(ye.q))},P.\u0275prov=e.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"});class ${constructor(t){this.analytics=t,this.canEdit=!0,this.showVersions=!1,this.edit=!1,this.model=this.fakeFileAsset()}set model(t){this.file=t}ngOnInit(){}fakeFileAsset(){const n=JSON.parse('{\n      "id" : 2,\n      "originalName" : "f2",\n      "assetType" : "TS_DATA",\n      "versions" : [ {\n        "versionId" : 2,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : "Some description",\n        "created" : [ 2016, 12, 8 ]\n      }, {\n        "versionId" : 1,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : null,\n        "created" : [ 2016, 12, 8 ]\n      } ]\n    }');return ae.deserialize(n)}recordDownload(){this.analytics.fileDownload(this.parentId.toString(),this.file.id)}}$.\u0275fac=function(t){return new(t||$)(e.Y36(x.y))},$.\u0275cmp=e.Xpm({type:$,selectors:[["bd2-file-asset-view"]],inputs:{canEdit:"canEdit",parentId:"parentId",model:"model"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"float-right"],["role","button","aria-label","expand",3,"click"],[1,"material-icons","bd-icon"],[3,"href","download","click"],[1,"list-unstyled"],[4,"ngFor","ngForOf"]],template:function(t,n){1&t&&e.YNc(0,Mn,11,6,"div",0),2&t&&e.Q6J("ngIf",n.file&&n.file.last)},dependencies:[r.sg,r.O5,r.uU],encapsulation:2});var wn=c(910);const qn=["uploadWidget"];function Nn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div")(1,"bd2-file-upload-widget",2,3),e.NdJ("uploadFiles",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.upload(o))}),e.qZA(),e._UZ(3,"hr"),e.qZA()}if(2&i){const n=e.oxw(2);e.xp6(1),e.Q6J("autoReset",!1)("blocked",n.blocked)}}function Un(i,t){if(1&i&&e._UZ(0,"bd2-file-asset-view",5),2&i){const n=t.$implicit,s=e.oxw(3);e.Q6J("model",n)("parentId",s.assay.id)}}function Jn(i,t){1&i&&(e.TgZ(0,"div",6),e._uU(1,' Use "Replace data" to change timeseries files. '),e.qZA())}function In(i,t){if(1&i&&(e.TgZ(0,"div")(1,"h4"),e._uU(2,"Timeseries files"),e.qZA(),e.YNc(3,Un,1,2,"bd2-file-asset-view",4),e.YNc(4,Jn,2,0,"div",1),e._UZ(5,"hr"),e.qZA()),2&i){const n=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",n.tsData),e.xp6(1),e.Q6J("ngIf",n.assay.security.canWrite)}}function On(i,t){1&i&&(e.TgZ(0,"div",6),e._uU(1,' Use "Import data" to add timeseries files. '),e.qZA())}function Sn(i,t){if(1&i&&e._UZ(0,"bd2-file-asset-view",5),2&i){const n=t.$implicit,s=e.oxw(3);e.Q6J("model",n)("parentId",s.assay.id)}}function Qn(i,t){if(1&i&&(e.TgZ(0,"div")(1,"h4"),e._uU(2,"Attachments"),e.qZA(),e.YNc(3,Sn,1,2,"bd2-file-asset-view",4),e.qZA()),2&i){const n=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",n.attachments)}}function kn(i,t){1&i&&(e.TgZ(0,"div",6),e._uU(1," Drag and upload files using the upload area in order to update the attachments. "),e.qZA())}function Yn(i,t){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Nn,4,2,"div",0),e.YNc(2,In,6,2,"div",0),e.YNc(3,On,2,0,"div",1),e.YNc(4,Qn,4,1,"div",0),e.YNc(5,kn,2,0,"div",1),e.qZA()),2&i){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.assay.security.canWrite),e.xp6(1),e.Q6J("ngIf",n.tsData&&n.tsData.length>0),e.xp6(1),e.Q6J("ngIf",!n.tsData||0===n.tsData.length),e.xp6(1),e.Q6J("ngIf",n.attachments&&n.attachments.length>0),e.xp6(1),e.Q6J("ngIf",n.assay.security.canWrite)}}class ee extends ie.w{constructor(t,n){super(n),this.attachmentsService=t,this.attachments=[],this.tsData=[],this.blocked=!1,this.titlePart=" Files"}updateModel(t){super.updateModel(t),this.refreshAttachments()}refreshAttachments(){this.attachmentsService.getFiles(this.assay).then(t=>this.setFiles(t)).catch(t=>{this.feedback.error(t)})}setFiles(t){this.tsData=t.filter(n=>n.assetType.equals(v.TS_DATA)),this.attachments=t.filter(n=>!n.assetType.equals(v.TS_DATA))}upload(t){console.log("Uploading "+t.length),t&&0!==t.length&&(this.blocked=!0,this.attachmentsService.upload(this.assay,t).then(n=>{this.uploadWidget.reset(),this.blocked=!1,this.feedback.success(n.length+" files uploaded")}).then(()=>this.refreshModel()).catch(n=>{this.blocked=!1,this.feedback.error(n)}))}}function Gn(i,t){if(1&i&&(e.TgZ(0,"div")(1,"div",1),e._uU(2," Experiment is already publicly available under "),e.TgZ(3,"strong"),e._uU(4),e.qZA(),e._uU(5," licence. "),e.qZA()()),2&i){const n=e.oxw(2);e.xp6(4),e.Oqu(n.assay.features.licence)}}function Pn(i,t){if(1&i&&(e.TgZ(0,"option",12),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.Q6J("value",n),e.xp6(1),e.hij("",n," ")}}function Ln(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div")(1,"div",2),e._uU(2," You are about to make the data public. Once they are public they cannot be made private again. "),e.TgZ(3,"ul")(4,"li"),e._uU(5,"make sure you know what you are doing"),e.qZA(),e.TgZ(6,"li"),e._uU(7,"make sure all contributors agree to public sharing"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"double check the description is correct, not all changes will be possible after the publishing"),e.qZA()()(),e.TgZ(10,"form",null,3)(12,"div",4)(13,"label",5),e._uU(14,"Licence"),e.qZA(),e.TgZ(15,"select",6,7),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.licence=o)}),e.YNc(17,Pn,2,2,"option",8),e.qZA()(),e.TgZ(18,"div",4)(19,"label")(20,"input",9,10),e.NdJ("ngModelChange",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.terms=o)}),e.qZA(),e._uU(22," I understand that I cannot undo this operation "),e.qZA()(),e.TgZ(23,"button",11),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(2);return e.KtG(o.publish())}),e._uU(24," Publish "),e.qZA()()()}if(2&i){const n=e.MAs(11),s=e.oxw(2);e.xp6(15),e.Q6J("ngModel",s.licence),e.xp6(2),e.Q6J("ngForOf",s.licences),e.xp6(3),e.Q6J("ngModel",s.terms),e.xp6(3),e.Q6J("disabled",!n.form.valid)}}function Kn(i,t){if(1&i&&(e.TgZ(0,"div")(1,"h3"),e._uU(2,"Publish experiment"),e.qZA(),e.YNc(3,Gn,6,1,"div",0),e.YNc(4,Ln,25,4,"div",0),e.qZA()),2&i){const n=e.oxw();e.xp6(3),e.Q6J("ngIf",n.assay.features.isOpenAccess),e.xp6(1),e.Q6J("ngIf",!n.assay.features.isOpenAccess)}}ee.\u0275fac=function(t){return new(t||ee)(e.Y36(P),e.Y36(h.L))},ee.\u0275cmp=e.Xpm({type:ee,selectors:[["ng-component"]],viewQuery:function(t,n){if(1&t&&e.Gf(qn,5),2&t){let s;e.iGM(s=e.CRH())&&(n.uploadWidget=s.first)}},features:[e.qOj],decls:4,vars:1,consts:[[4,"ngIf"],["type","info","class","alert alert-info","role","alert",4,"ngIf"],[3,"autoReset","blocked","uploadFiles"],["uploadWidget",""],[3,"model","parentId",4,"ngFor","ngForOf"],[3,"model","parentId"],["type","info","role","alert",1,"alert","alert-info"]],template:function(t,n){1&t&&(e.TgZ(0,"h3"),e._uU(1,"Attached files"),e.qZA(),e._UZ(2,"hr"),e.YNc(3,Yn,6,5,"div",0)),2&t&&(e.xp6(3),e.Q6J("ngIf",n.assay))},dependencies:[r.sg,r.O5,$,wn.F]});class te extends ie.w{constructor(t){super(t),this.licences=["CC_BY"]}ngOnInit(){super.ngOnInit(),this.licence=this.licences[0]}publish(){this.terms&&this.licence&&this.experimentService.publish(this.assay,this.licence).then(t=>(this.feedback.success('Experiment: "'+t.name+'" published.'),t)).then(t=>(this.currentExperiment.push(t),t)).then(t=>{this.goToExpHome(t.id)}).catch(t=>{this.feedback.error(t)})}}function Rn(i,t){1&i&&(e.TgZ(0,"div")(1,"h4"),e._uU(2,"You don't have permission to create experiment"),e.qZA(),e.TgZ(3,"p"),e._uU(4,"Try to login"),e.qZA()())}function Bn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"bd2-general-desc-form",9),e.NdJ("onAccepted",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))})("onCancelled",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))}),e.qZA()}if(2&i){const n=e.oxw(2);e.Q6J("model",n.assay.generalDesc)}}function Hn(i,t){if(1&i&&e._UZ(0,"bd2-general-desc-view",10),2&i){const n=e.oxw(2);e.Q6J("model",n.assay.generalDesc)}}function Vn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",11),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(2);return e.KtG(o.activeGeneralDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("disabled",n.activeGeneralDescForm)}}function Wn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"bd2-simple-bio-desc-form",9),e.NdJ("onAccepted",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))})("onCancelled",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))}),e.qZA()}if(2&i){const n=e.oxw(2);e.Q6J("model",n.assay)}}function zn(i,t){if(1&i&&e._UZ(0,"bd2-simple-bio-desc-view",10),2&i){const n=e.oxw(2);e.Q6J("model",n.assay)}}function jn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",11),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(2);return e.KtG(o.activeSimpleBioDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("disabled",n.activeSimpleBioDescForm)}}function Xn(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"bd2-contr-desc-form",9),e.NdJ("onAccepted",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))})("onCancelled",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))}),e.qZA()}if(2&i){const n=e.oxw(2);e.Q6J("model",n.assay.contributionDesc)}}function $n(i,t){if(1&i&&e._UZ(0,"bd2-contr-desc-view",10),2&i){const n=e.oxw(2);e.Q6J("model",n.assay.contributionDesc)}}function ei(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",11),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(2);return e.KtG(o.activeContributionDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("disabled",n.activeContributionDescForm)}}function ti(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"bd2-measurement-desc-rform",9),e.NdJ("onAccepted",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))})("onCancelled",function(o){e.CHM(n);const a=e.oxw(2);return e.KtG(a.hideEdits(o))}),e.qZA()}if(2&i){const n=e.oxw(2);e.Q6J("model",n.assay.experimentalDetails.measurementDesc)}}function ni(i,t){if(1&i&&e._UZ(0,"bd2-measurement-desc-view",10),2&i){const n=e.oxw(2);e.Q6J("model",n.assay.experimentalDetails.measurementDesc)}}function ii(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",11),e.NdJ("click",function(){e.CHM(n);const o=e.oxw(2);return e.KtG(o.activeMeasurementDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("disabled",n.activeMeasurementDescForm)}}function oi(i,t){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const n=t.$implicit;e.xp6(1),e.Oqu(n)}}function si(i,t){if(1&i&&(e.TgZ(0,"div",12)(1,"ul"),e.YNc(2,oi,2,1,"li",13),e.qZA()()),2&i){const n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.errors)}}function ri(i,t){if(1&i){const n=e.EpF();e.TgZ(0,"div")(1,"h3"),e._uU(2,"Create experiment"),e.qZA(),e.TgZ(3,"div",1)(4,"div",2),e._uU(5,"General description"),e.qZA(),e.TgZ(6,"div",3),e.YNc(7,Bn,1,1,"bd2-general-desc-form",4),e.YNc(8,Hn,1,1,"bd2-general-desc-view",5),e.YNc(9,Vn,4,1,"div",0),e.qZA()(),e.TgZ(10,"div",1)(11,"div",2),e._uU(12,"Biological details"),e.qZA(),e.TgZ(13,"div",3),e.YNc(14,Wn,1,1,"bd2-simple-bio-desc-form",4),e.YNc(15,zn,1,1,"bd2-simple-bio-desc-view",5),e.YNc(16,jn,4,1,"div",0),e.qZA()(),e.TgZ(17,"div",1)(18,"div",2),e._uU(19,"Contributions"),e.qZA(),e.TgZ(20,"div",3),e.YNc(21,Xn,1,1,"bd2-contr-desc-form",4),e.YNc(22,$n,1,1,"bd2-contr-desc-view",5),e.YNc(23,ei,4,1,"div",0),e.qZA()(),e.TgZ(24,"div",1)(25,"div",2),e._uU(26,"Measurement details"),e.qZA(),e.TgZ(27,"div",3),e.YNc(28,ti,1,1,"bd2-measurement-desc-rform",4),e.YNc(29,ni,1,1,"bd2-measurement-desc-view",5),e.YNc(30,ii,4,1,"div",0),e.qZA()(),e.YNc(31,si,3,1,"div",6),e.TgZ(32,"button",7),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.save())}),e._uU(33,"Create"),e.qZA(),e.TgZ(34,"button",8),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.cancel())}),e._uU(35,"Cancel"),e.qZA()()}if(2&i){const n=e.oxw();e.xp6(7),e.Q6J("ngIf",n.activeGeneralDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeGeneralDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeGeneralDescForm),e.xp6(5),e.Q6J("ngIf",n.activeSimpleBioDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeSimpleBioDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeSimpleBioDescForm),e.xp6(5),e.Q6J("ngIf",n.activeContributionDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeContributionDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeContributionDescForm),e.xp6(5),e.Q6J("ngIf",n.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",!n.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",n.errors),e.xp6(1),e.Q6J("disabled",n.blocked||n.errors)}}te.\u0275fac=function(t){return new(t||te)(e.Y36(h.L))},te.\u0275cmp=e.Xpm({type:te,selectors:[["bd2-publish-form"]],features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["type","info","role","alert",1,"alert","alert-info"],["type","danger","role","alert",1,"alert","alert-danger"],["publishForm","ngForm"],[1,"form-group"],["for","licence"],["id","licence","required","","placeholder","Select licence","name","licence",1,"form-control",3,"ngModel","ngModelChange"],["licenceF","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","checkbox","required","","id","terms","name","fTerms",3,"ngModel","ngModelChange"],["fTerms","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[3,"value"]],template:function(t,n){1&t&&e.YNc(0,Kn,5,2,"div",0),2&t&&e.Q6J("ngIf",n.assay)},dependencies:[r.sg,r.O5,d._Y,d.YN,d.Kr,d.Wl,d.EJ,d.JJ,d.JL,d.Q7,d.Zs,d.On,d.F],encapsulation:2});class ne extends de.X{constructor(t,n,s,o){super(re.INSTANCE),this.experimentService=t,this.RDMSocial=n,this.feedback=s,this.router=o,this.isUnauthorised=!1,this.blocked=!1,this.activeGeneralDescForm=!0,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!0,this.activeMeasurementDescForm=!1}ngOnInit(){this.experimentService.newDraft().then(t=>{this.assay=t}).catch(t=>{this.isUnauthorised=t.isUnauthorised,this.feedback.error(t)})}hideEdits(t){this.activeGeneralDescForm=!this.assay.generalDesc.name,this.activeSimpleBioDescForm=!this.assay.species||!this.assay.dataCategory,this.activeContributionDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiments"])}save(){this.assay&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.newExperiment(this.assay).then(t=>(this.feedback.success('Experiment: "'+t.name+'" created.'),t)).then(t=>this.router.navigate(["/experiment",t.id])).catch(t=>{this.blocked=!1,this.feedback.error(t)}))}getModel(){return this.assay}}ne.\u0275fac=function(t){return new(t||ne)(e.Y36(A.$),e.Y36(g.C),e.Y36(T.T),e.Y36(l.F0))},ne.\u0275cmp=e.Xpm({type:ne,selectors:[["ng-component"]],features:[e.qOj],decls:2,vars:2,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],["okLabel","Accept",3,"model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["okLabel","Accept",3,"model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"]],template:function(t,n){1&t&&(e.YNc(0,Rn,5,0,"div",0),e.YNc(1,ri,36,14,"div",0)),2&t&&(e.Q6J("ngIf",n.isUnauthorised),e.xp6(1),e.Q6J("ngIf",n.assay))},dependencies:[r.sg,r.O5,O,q,S,N,k,U,G,J],encapsulation:2});const ai=[{path:"new",pathMatch:"full",component:ne},{path:":id",component:W,children:[{path:"",pathMatch:"full",component:z},{path:"edit",component:X},{path:"file",component:ee},{path:"publish",component:te},{path:"data",loadChildren:()=>Promise.all([c.e(326),c.e(709),c.e(319),c.e(592),c.e(402)]).then(c.bind(c,3402)).then(i=>i.TsDataModule)},{path:"ppa",loadChildren:()=>Promise.all([c.e(326),c.e(709),c.e(319),c.e(926),c.e(592),c.e(110)]).then(c.bind(c,8103)).then(i=>i.PPAModule)},{path:"rhythmicity",loadChildren:()=>Promise.all([c.e(326),c.e(709),c.e(319),c.e(592),c.e(411)]).then(c.bind(c,411)).then(i=>i.RhythmicityModule)}]}];class L{}L.\u0275fac=function(t){return new(t||L)},L.\u0275mod=e.oAB({type:L}),L.\u0275inj=e.cJS({imports:[l.Bz.forChild(ai),l.Bz]});var ci=c(9120),li=c(2929);class K{}K.\u0275fac=function(t){return new(t||K)},K.\u0275mod=e.oAB({type:K}),K.\u0275inj=e.cJS({imports:[r.ez,li.Q]});class R{}R.\u0275fac=function(t){return new(t||R)},R.\u0275mod=e.oAB({type:R}),R.\u0275inj=e.cJS({imports:[r.ez,d.u5]});class B{}B.\u0275fac=function(t){return new(t||B)},B.\u0275mod=e.oAB({type:B}),B.\u0275inj=e.cJS({imports:[r.ez,ci.C,K,R,L]})},2929:(M,Z,c)=>{c.d(Z,{Q:()=>f});var r=c(6895),l=c(4006),_=c(4650);class f{}f.\u0275fac=function(h){return new(h||f)},f.\u0275mod=_.oAB({type:f}),f.\u0275inj=_.cJS({imports:[r.ez,l.u5]})},910:(M,Z,c)=>{c.d(Z,{F:()=>T});var r=c(4650),l=c(7045),_=c(6895);const f=["inputFieldM"];function p(x,u){if(1&x){const m=r.EpF();r.TgZ(0,"div",11),r._uU(1),r.TgZ(2,"button",12),r.NdJ("click",function(){const w=r.CHM(m).$implicit,ce=r.oxw(2);return r.KtG(ce.remove(w))}),r.TgZ(3,"span",13),r._uU(4,"\xd7"),r.qZA()()()}if(2&x){const m=u.$implicit;r.xp6(1),r.hij(" ",m.name," ")}}function h(x,u){if(1&x&&(r.TgZ(0,"div",8)(1,"div",9)(2,"label"),r._uU(3,"Files:"),r.qZA()(),r.YNc(4,p,5,1,"div",10),r.qZA()),2&x){const m=r.oxw();r.xp6(4),r.Q6J("ngForOf",m.files)}}function e(x,u){if(1&x){const m=r.EpF();r.TgZ(0,"input",14,15),r.NdJ("change",function(y){r.CHM(m);const w=r.oxw();return r.KtG(w.handleFileSelect(y))}),r.qZA()}}function A(x,u){if(1&x){const m=r.EpF();r.TgZ(0,"input",16,15),r.NdJ("change",function(y){r.CHM(m);const w=r.oxw();return r.KtG(w.handleFileSelect(y))}),r.qZA()}}function g(x,u){if(1&x&&(r.TgZ(0,"div",17),r._uU(1),r.qZA()),2&x){const m=r.oxw();r.xp6(1),r.hij(" Maximum upload size is ",m.sizeLimit,"MB ")}}class T{constructor(){this.activeColor="green",this.baseColor="#ccc",this.overlayColor="rgba(255,255,255,0.5)",this.blocked=!1,this.multiple=!0,this.noDuplicates=!0,this.autoReset=!1,this.sizeLimit=50,this.uploadFiles=new r.vpe,this.selectedFiles=new r.vpe,this.dragging=!1,this.loaded=!1,this.sizeError=!1,this.files=[]}ngOnInit(){}reset(){this.files=[],this.inputField&&this.inputField.nativeElement&&(this.inputField.nativeElement.value="")}handleDragEnter(){this.dragging=!0}handleDragLeave(){this.dragging=!1}handleDrop(u){u.preventDefault(),this.dragging=!1,u.dataTransfer&&this.handleFileChange(u.dataTransfer.files)}handleFileSelect(u){u.target&&this.handleFileChange(u.target.files)}handleFileChange(u){const m=this.multiple?u.length:Math.min(1,u.length);this.multiple||(this.files=[]);for(let C=0;C<m;C++){const y=u[C];this.noDuplicates&&this.removeDuplicate(y),this.files.push(y)}this.checkSize(),this.selectedFiles.next(this.files)}remove(u){(0,l.d2)(u,this.files),this.checkSize()}removeDuplicate(u){const m=this.files.find(C=>C.name===u.name);this.remove(m)}checkSize(){let u=0;this.files.map(m=>m.size).forEach(m=>u+=m),u/=1048576,this.sizeError=u>this.sizeLimit}upload(){this.uploadFiles.next(this.files),this.autoReset&&this.reset()}}T.\u0275fac=function(u){return new(u||T)},T.\u0275cmp=r.Xpm({type:T,selectors:[["bd2-file-upload-widget"]],viewQuery:function(u,m){if(1&u&&r.Gf(f,5),2&u){let C;r.iGM(C=r.CRH())&&(m.inputField=C.first)}},inputs:{activeColor:"activeColor",baseColor:"baseColor",overlayColor:"overlayColor",blocked:"blocked",multiple:"multiple",noDuplicates:"noDuplicates",autoReset:"autoReset",sizeLimit:"sizeLimit"},outputs:{uploadFiles:"uploadFiles",selectedFiles:"selectedFiles"},decls:13,vars:9,consts:[["class","clearfix","style","margin-bottom: 1em;",4,"ngIf"],[2,"margin-bottom","1em"],["ondragover","return false;",1,"uploader-zone",3,"dragenter","dragleave","drop"],[1,"material-icons","bd-icon","bd-primary",2,"font-size","400%"],["multiple","","name","inputField","type","file",3,"change",4,"ngIf"],["name","inputField","type","file",3,"change",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"clearfix",2,"margin-bottom","1em"],[1,""],["class","float-left fileitem",4,"ngFor","ngForOf"],[1,"float-left","fileitem"],["aria-label","Close","type","button",1,"close",2,"margin-left","0.5em",3,"click"],["aria-hidden","true"],["multiple","","name","inputField","type","file",3,"change"],["inputField",""],["name","inputField","type","file",3,"change"],[1,"alert","alert-danger"]],template:function(u,m){1&u&&(r.TgZ(0,"div"),r.YNc(1,h,5,1,"div",0),r.TgZ(2,"div",1)(3,"label",2),r.NdJ("dragenter",function(){return m.handleDragEnter()})("dragleave",function(){return m.handleDragLeave()})("drop",function(y){return m.handleDrop(y)}),r.TgZ(4,"i",3),r._uU(5,"cloud_upload"),r.qZA(),r.TgZ(6,"p"),r._uU(7," Drag file(s) or click to select"),r.qZA(),r.YNc(8,e,2,0,"input",4),r.YNc(9,A,2,0,"input",5),r.qZA()(),r.YNc(10,g,2,1,"div",6),r.TgZ(11,"button",7),r.NdJ("click",function(){return m.upload()}),r._uU(12,"Upload selected "),r.qZA()()),2&u&&(r.xp6(1),r.Q6J("ngIf",m.files.length>0),r.xp6(2),r.Udp("outline-color",m.dragging?m.activeColor:m.baseColor),r.ekj("loaded",m.loaded),r.xp6(5),r.Q6J("ngIf",m.multiple),r.xp6(1),r.Q6J("ngIf",!m.multiple),r.xp6(1),r.Q6J("ngIf",m.sizeError),r.xp6(1),r.Q6J("disabled",m.blocked||m.files.length<1||m.sizeError))},dependencies:[_.sg,_.O5],styles:[".uploader-zone[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.uploader-zone[_ngcontent-%COMP%]{font-weight:400;align-items:center;background-color:#efefef;background-color:#00000005;cursor:pointer;display:flex;height:100px;justify-content:center;outline:3px dashed #ccc}div.fileitem[_ngcontent-%COMP%]{margin:2px;padding:2px;border:1px solid #efefef;border-radius:4px}"]})},9174:(M,Z,c)=>{c.d(Z,{C:()=>_});var r=c(4650),l=c(5716);class _{constructor(p){this.BD2REST=p,this.visited=new Set,console.log("RDMSocialServiceService created")}getAssayGuiAspects(p){return this.BD2REST.rdmAssayGuiAspects(p.id).then(h=>(this.visited.add(p.id),h))}shouldShowMeasurementWarning(p){return!p.security.isOwner||this.visited.has(p.id)?Promise.resolve(!1):this.getAssayGuiAspects(p).then(h=>h.showMeasurementWarning)}registerNewAssay(p){this.visited.add(p.id)}registerMeasurementWarning(p){this.BD2REST.rdmRegisterWarning(p.id,"MEASUREMENT").then(h=>!0)}canProceedByMeasurement(p){return p.security.isOwner?this.getAssayGuiAspects(p).then(h=>h.canProceedByMeasurement):Promise.resolve(!0)}}_.\u0275fac=function(p){return new(p||_)(r.LFG(l.q))},_.\u0275prov=r.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"})},7032:(M,Z,c)=>{c.d(Z,{d:()=>e});var r=c(5412),l=c(4650),_=c(6895);function f(A,g){if(1&A&&l._UZ(0,"div",5),2&A){const T=l.oxw();l.Q6J("innerHTML",T.question.details,l.oJD)}}class p{constructor(g,T,x="Cancel",u="OK"){this.question=g,this.details=T,this.cancelLabel=x,this.okLabel=u}}class h{constructor(g){this.question=g||new p("Missing question")}ngOnInit(){}}h.\u0275fac=function(g){return new(g||h)(l.Y36(r.WI))},h.\u0275cmp=l.Xpm({type:h,selectors:[["ng-component"]],decls:10,vars:5,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-content","",1,"modal-body"],[3,"innerHTML",4,"ngIf"],["mat-dialog-close","",1,"btn","btn-primary","btn-sm","mr-2"],[1,"btn","btn-primary","btn-sm",3,"mat-dialog-close"],[3,"innerHTML"]],template:function(g,T){1&g&&(l.TgZ(0,"h4",0),l._uU(1),l.qZA(),l.TgZ(2,"div",1),l.YNc(3,f,1,1,"div",2),l.qZA(),l._UZ(4,"hr"),l.TgZ(5,"div")(6,"button",3),l._uU(7),l.qZA(),l.TgZ(8,"button",4),l._uU(9),l.qZA()()),2&g&&(l.xp6(1),l.hij("",T.question.question," "),l.xp6(2),l.Q6J("ngIf",T.question.details),l.xp6(4),l.Oqu(T.question.cancelLabel),l.xp6(1),l.Q6J("mat-dialog-close",!0),l.xp6(1),l.Oqu(T.question.okLabel))},dependencies:[_.O5,r.ZT,r.uh,r.xY],encapsulation:2});class e{constructor(g){this.dialogs=g}confirm(g,T,x="Cancel",u="OK"){const m=new p(g,T,x,u);return this.dialogs.open(h,{data:m,autoFocus:!1}).afterClosed()}}e.\u0275fac=function(g){return new(g||e)(l.LFG(r.uw))},e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},7139:(M,Z,c)=>{c.d(Z,{X:()=>r});class r{constructor(_){this.validator=_,this.errors=void 0}triggerValidation(){const _=this.validate(this.getModel());return _?(this.showErrors(_),!1):(this.clearErrors(),!0)}clearErrors(){this.errors=void 0}showErrors(_){this.errors=_}validate(_){if(this.validator){const f=this.validator.validate(_);return 0===f.length?null:f}return null}}}}]);