"use strict";(self.webpackChunkbiodare2_ui=self.webpackChunkbiodare2_ui||[]).push([[446],{9446:(eo,X,l)=>{l.r(X),l.d(X,{TsImportModule:()=>k});var u=l(6895),p=l(4006),W=l(9299),c=l(1945),ne=l(471),e=l(4650),G=l(5716),le=l(2110),re=l(1572),_=l(3546),I=l(4200),K=l(1135),ce=l(7579),me=l(9841),$=l(9300),pe=l(1884),de=l(3900),ue=l(2076);const he=l(5577).z;var j=l(7246),R=l(8739);class g{constructor(t=new R.kl,o=new R.kl){this.rowPage=t,this.colPage=o}static firstPage(){const t=new g;return t.rowPage.pageIndex=0,t.rowPage.pageSize=50,t.colPage.pageIndex=0,t.colPage.pageSize=50,t}static pageEquals(t,o){return t.pageIndex===o.pageIndex&&t.pageSize===o.pageSize}equals(t){return!!t&&g.pageEquals(this.rowPage,t.rowPage)&&g.pageEquals(this.colPage,t.colPage)}}class v{constructor(t){this.BD2REST=t}uploadFile(t){const o=new FormData;return o.append("file",t,t.name),this.BD2REST.fileUpload(o).then(a=>a.id)}}v.\u0275fac=function(t){return new(t||v)(e.LFG(G.q))},v.\u0275prov=e.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"});class b{constructor(t,o){this.uploadService=t,this.BD2REST=o}uploadFile(t,o){return(0,ue.D)(this.uploadService.uploadFile(t)).pipe(he(a=>this.verifyFormat(o,a).pipe((0,j.U)(s=>a))))}verifyFormat(t,o){return this.BD2REST.fileViewVerifyFormat(t,o)}getTableSlice(t,o,a){return this.BD2REST.fileViewTableSlice(t,o,a)}previewLabels(t,o,a,s){const n=new g;return s?(n.rowPage.pageSize=500,n.rowPage.pageIndex=0,n.colPage.pageSize=1,n.colPage.pageIndex=a.colIx):(n.rowPage.pageSize=1,n.rowPage.pageIndex=a.rowIx,n.colPage.pageSize=500,n.colPage.pageIndex=0),this.getTableSlice(t,o,n).pipe((0,j.U)(r=>{const f=[];return r.data.forEach(D=>D.forEach(x=>f.push(""+x))),f}))}}b.\u0275fac=function(t){return new(t||b)(e.LFG(v),e.LFG(G.q))},b.\u0275prov=e.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"});class h{constructor(t){this.tsFileService=t,this.tableSlice$=new K.X(void 0),this.slice$=new K.X(void 0),this.fileIdFormat$=new K.X(void 0),this.error$=new ce.x,this.dataSlice$=this.tableSlice$.asObservable().pipe((0,$.h)(o=>null!=o&&void 0!==o)),this.initDataStream()}close(){this.slice$.complete(),this.fileIdFormat$.complete(),this.tableSlice$.complete(),this.error$.complete()}slice(t){t&&this.slice$.next(t)}fileIdFormat(t){t&&t[0]&&t[1]&&this.fileIdFormat$.next(t)}sameParams([[t,o],a],[[s,n],r]){return t==s&&o==n&&a.equals(r)}initDataStream(){(0,me.a)([this.fileIdFormat$,this.slice$]).pipe((0,$.h)(([o,a])=>o&&!!a),(0,pe.x)(this.sameParams)).pipe((0,de.w)(([o,a])=>this.tsFileService.getTableSlice(o[0],o[1],a))).subscribe(o=>this.tableSlice$.next(o),o=>this.error$.next(o))}}h.\u0275fac=function(t){return new(t||h)(e.LFG(b))},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac});var N=l(2160),V=l(1948),fe=l(4850),y=l(6257),ee=l(4859),ge=l(910),w=l(9549),te=l(4385),L=l(3238);function be(i,t){if(1&i&&(e.TgZ(0,"mat-option",9),e._uU(1),e.qZA()),2&i){const o=t.$implicit;e.Q6J("value",o),e.xp6(1),e.Oqu(o.label)}}function Ce(i,t){1&i&&(e.TgZ(0,"div",10),e._uU(1," An Excel file in which one column contains time values while other columns contain measurements taken at the corresponding times. "),e.TgZ(2,"ul")(3,"li"),e._uU(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes from start, seconds from start, or as image nr (1-based) which will be converted to time using interval between images. "),e.qZA(),e.TgZ(5,"li"),e._uU(6," Not all columns have to be imported. "),e.qZA(),e.TgZ(7,"li"),e._uU(8," First few rows can contain arbitrary text. "),e.qZA(),e.TgZ(9,"li"),e._uU(10," Values from one row can be used as data labels. "),e.qZA()()())}function we(i,t){1&i&&(e.TgZ(0,"div",10),e._uU(1," A coma or tab separeted file in which one column or row contains time values while other columns or rows contain measurements taken at the corresponding times. "),e.TgZ(2,"ul")(3,"li"),e._uU(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes or seconds from start, or as image numbers "),e.qZA(),e.TgZ(5,"li"),e._uU(6," Not all columns/rows have to be imported. "),e.qZA(),e.TgZ(7,"li"),e._uU(8," First few rows/columns can contain arbitrary text. "),e.qZA(),e.TgZ(9,"li"),e._uU(10," Values from one row/column can be used as data labels. "),e.qZA()()())}function Te(i,t){1&i&&(e.TgZ(0,"div",10),e._uU(1," Topcount data can be uploaded in two forms: "),e.TgZ(2,"ul")(3,"li"),e._uU(4,"Individual file which contains concatenated topcount data blocks in one file"),e.qZA(),e.TgZ(5,"li"),e._uU(6,"Zip file which contains packed files from individual topcount reads"),e.qZA()(),e._uU(7,' Check the Dosc section for details about suported data layouts inside tomcats file, we can currently read ASCI content with "plate map" or "column" layouts. '),e.qZA())}function Se(i,t){if(1&i&&(e.TgZ(0,"div",11),e._uU(1),e.qZA()),2&i){const o=e.oxw();e.xp6(1),e.hij(" ",o.formatWarning," ")}}class A{constructor(){this.blocked=!1,this.uploadFiles=new e.vpe,this.importFormatOptions=c.Kw,this.importFormat=c.kk.EXCEL_TABLE}ngOnInit(){}upload(t){this.uploadFiles.next({files:t,importFormat:this.importFormat})}formatChanged(t){this.lastFiles&&this.checkFormat(this.lastFiles)}checkFormat(t){this.lastFiles=t,this.formatWarning=void 0,t.forEach(o=>{if(this.importFormat===c.kk.TOPCOUNT){const a=this.isTopCount(o);a&&(this.formatWarning="The selected file does not seem to be a topcount file/archive but rather: "+a+". If you sure it is a valid topcount file/archive you can continue upload.")}else if(this.importFormat===c.kk.EXCEL_TABLE){const a=this.isExcel(o);a&&(this.formatWarning="The selected file does not seem to be an excel file but rather: "+a+". If you sure it is a valid excel file you can continue upload.")}else if(this.importFormat===c.kk.TAB_SEP){const a=this.isTab(o);a&&(this.formatWarning="The selected file does not seem to be a tab-separated file but rather: "+a+". If you sure it is a valid tsv file you can continue upload.")}else if(this.importFormat===c.kk.COMA_SEP){const a=this.isComa(o);a&&(this.formatWarning="The selected file does not seem to be a coma-separated file but rather: "+a+". If you sure it is a valid csv file you can continue upload.")}})}isTopCount(t){let a=t.type;return t.name?(a||(a="Unknown"),t.name.endsWith(".csv")?"CSV":t.name.endsWith(".xls")||t.name.endsWith(".xlsx")?"Excel":t.name.endsWith(".tsv")?"tab separated":null):"Unknown"}isExcel(t){const a=t.type;return a&&t.name?t.name.endsWith(".csv")?"CSV":t.name.endsWith(".txt")?"text":t.name.endsWith(".tsv")?"tab separated":a.indexOf("excel")>=0||a.indexOf("sheet")>=0?null:a:"Unknown"}isTab(t){let a=t.type;return t.name?(a||(a="Unknown"),t.name.endsWith(".csv")?"CSV":t.name.endsWith(".xls")||t.name.endsWith(".xlsx")?"Excel":t.name.endsWith(".txt")?"Text":t.name.endsWith(".tsv")?null:"Unrecognized"):"Unknown"}isComa(t){let a=t.type;return t.name?(a||(a="Unknown"),t.name.endsWith(".tsv")?"tab separated":t.name.endsWith(".xls")||t.name.endsWith(".xlsx")?"Excel":t.name.endsWith(".txt")?"Text":t.name.endsWith(".csv")?null:"Unrecognized"):"Unknown"}}function De(i,t){if(1&i&&(e.TgZ(0,"span")(1,"label"),e._uU(2,"Images every"),e.qZA(),e._uU(3),e.qZA()),2&i){const o=e.oxw(2);e.xp6(3),e.hij(" ",o.importDetails.imgInterval,"h ")}}function xe(i,t){if(1&i&&(e.TgZ(0,"span")(1,"label"),e._uU(2,"Time offset"),e.qZA(),e._uU(3),e.qZA()),2&i){const o=e.oxw(2);e.xp6(3),e.hij(" ",o.importDetails.timeOffset,"h ")}}function ve(i,t){if(1&i&&(e.TgZ(0,"p")(1,"label"),e._uU(2,"First time point:"),e.qZA(),e.TgZ(3,"strong"),e._uU(4),e.qZA(),e.YNc(5,De,4,1,"span",1),e.YNc(6,xe,4,1,"span",1),e.qZA()),2&i){const o=e.oxw();e.xp6(4),e.lnq("",o.firstTimeCell.value," ",null==o.importDetails.timeType?null:o.importDetails.timeType.unit," [",o.firstTimeCell.colName+":"+o.firstTimeCell.rowName,"]"),e.xp6(1),e.Q6J("ngIf","IMG_NUMBER"===(null==o.importDetails.timeType?null:o.importDetails.timeType.name)),e.xp6(1),e.Q6J("ngIf",0!=o.importDetails.timeOffset)}}function Ne(i,t){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.TgZ(2,"strong"),e._uU(3),e.qZA()()),2&i){const o=e.oxw();e.xp6(1),e.hij(" Labels in ",o.importDetails.inLabelNeg," "),e.xp6(2),e.hij("",o.importDetails.inRows?o.labelsSelection.colName:o.labelsSelection.rowName,";")}}function Ze(i,t){if(1&i&&(e.TgZ(0,"p")(1,"label"),e._uU(2,"Selected Labels:"),e.qZA(),e._uU(3),e.qZA()),2&i){const o=e.oxw();e.xp6(3),e.hij(" ",o.importDetails.summarizeLabels()," ")}}function ke(i,t){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.TgZ(2,"strong"),e._uU(3),e.qZA()()),2&i){const o=e.oxw();e.xp6(1),e.hij(" Data starts in ",o.importDetails.inLabel," "),e.xp6(2),e.hij("",o.importDetails.inRows?o.dataStart.rowName:o.dataStart.colName,";")}}function Ie(i,t){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const o=e.oxw();e.xp6(1),e.hij(" Background noise as: ",o.importDetails.backgroundsLabels.join(", ")," ")}}A.\u0275fac=function(t){return new(t||A)},A.\u0275cmp=e.Xpm({type:A,selectors:[["bd2-upload-data-file-step"]],outputs:{uploadFiles:"uploadFiles"},decls:19,vars:9,consts:[[1,"mat-elevation-z4"],[1,""],[1,"form-group"],["required","",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["dismissible","true","style","font-size: smaller;","type","info","class","alert alert-info","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"autoReset","blocked","multiple","selectedFiles","uploadFiles"],["uploadWidget",""],[3,"value"],["dismissible","true","type","info","role","alert",1,"alert","alert-info",2,"font-size","smaller"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(t,o){1&t&&(e.TgZ(0,"div")(1,"mat-card",0)(2,"mat-card-title"),e._uU(3,"Time series file"),e.qZA(),e.TgZ(4,"mat-card-content")(5,"form",1)(6,"div",2)(7,"mat-form-field")(8,"mat-label"),e._uU(9,"File Format"),e.qZA(),e.TgZ(10,"mat-select",3),e.NdJ("valueChange",function(s){return o.importFormat=s})("selectionChange",function(s){return o.formatChanged(s)}),e.YNc(11,be,2,2,"mat-option",4),e.qZA()()(),e.YNc(12,Ce,11,0,"div",5),e.YNc(13,we,11,0,"div",5),e.YNc(14,Te,8,0,"div",5),e.YNc(15,Se,2,1,"div",6),e.TgZ(16,"div",2)(17,"bd2-file-upload-widget",7,8),e.NdJ("selectedFiles",function(s){return o.checkFormat(s)})("uploadFiles",function(s){return o.upload(s)}),e.qZA()()()()()()),2&t&&(e.xp6(10),e.Q6J("value",o.importFormat),e.xp6(1),e.Q6J("ngForOf",o.importFormatOptions),e.xp6(1),e.Q6J("ngIf","EXCEL_TABLE"==o.importFormat.name),e.xp6(1),e.Q6J("ngIf","TAB_SEP"==o.importFormat.name||"COMA_SEP"==o.importFormat.name),e.xp6(1),e.Q6J("ngIf","TOPCOUNT"==o.importFormat.name),e.xp6(1),e.Q6J("ngIf",o.formatWarning),e.xp6(2),e.Q6J("autoReset",!1)("blocked",o.blocked||!o.importFormat)("multiple",!1))},dependencies:[u.sg,u.O5,p._Y,p.JL,p.F,ge.F,w.KE,w.hX,te.gD,L.ey,_.a8,_.dn,_.n5],encapsulation:2});class U{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(){this.showTime=!1,this.showLabelling=!1,this.showDataStart=!1}ngOnInit(){}}U.\u0275fac=function(t){return new(t||U)},U.\u0275cmp=e.Xpm({type:U,selectors:[["bd2-import-details-summary"]],inputs:{importDetails:"importDetails",showTime:"showTime",showLabelling:"showLabelling",showDataStart:"showDataStart"},decls:13,vars:8,consts:[[1,"mat-elevation-z4"],[4,"ngIf"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card",0)(1,"p"),e._uU(2),e.TgZ(3,"strong"),e._uU(4),e.qZA()(),e.TgZ(5,"p")(6,"label"),e._uU(7),e.qZA()(),e.YNc(8,ve,7,5,"p",1),e.YNc(9,Ne,4,2,"p",1),e.YNc(10,Ze,4,1,"p",1),e.YNc(11,ke,4,2,"p",1),e.YNc(12,Ie,2,1,"p",1),e.qZA()),2&t&&(e.xp6(2),e.hij("",null==o.importDetails||null==o.importDetails.importFormat?null:o.importDetails.importFormat.label,": "),e.xp6(2),e.Oqu(null==o.importDetails?null:o.importDetails.fileName),e.xp6(3),e.hij("Time series in ",(null==o.importDetails?null:o.importDetails.inLabel)+"s",""),e.xp6(1),e.Q6J("ngIf",o.showTime&&o.firstTimeCell),e.xp6(1),e.Q6J("ngIf",o.showLabelling&&o.importDetails.importLabels&&o.labelsSelection),e.xp6(1),e.Q6J("ngIf",o.showLabelling&&!o.importDetails.importLabels),e.xp6(1),e.Q6J("ngIf",o.showDataStart&&o.importDetails.importLabels&&o.dataStart),e.xp6(1),e.Q6J("ngIf",o.showLabelling&&o.importDetails.containsBackgrounds&&o.importDetails.backgroundsLabels))},dependencies:[u.O5,_.a8],encapsulation:2});class z{constructor(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}reset(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}setRowBackground(t,o){this.rowsBackgrounds[t]=o}rowBackground(t){return this.getOrEmptyString(this.rowsBackgrounds,t)}colBackground(t){return this.getOrEmptyString(this.colsBackgrounds,t)}setColBackground(t,o){this.colsBackgrounds[t]=o}cellBackground(t,o){return this.getOrEmptyString(this.getOrDefault(this.cellBackgrounds,o,[]),t)||this.colBackground(t)}setCellBackground(t,o,a){let s=this.cellBackgrounds[o];void 0===s&&(s=[],this.cellBackgrounds[o]=s),s[t]=a}getOrEmptyString(t,o){return this.getOrDefault(t,o,"")}getOrDefault(t,o,a){return o>=t.length||void 0===t[o]?a:t[o]}}class d{rowBackground(t){return d.MAIN_ROW_BACKGROUND}cellBackground(t){return d.MAIN_CELL_BACKGROUND}columnBackground(t){return d.MAIN_COL_BACKGROUND}}d.MAIN_ROW_BACKGROUND="#dda0dd",d.MAIN_COL_BACKGROUND="#87cefa",d.MAIN_CELL_BACKGROUND="#ba55d3",d.TIME_BACKGROUND="#dda0dd",d.LABELS_BACKGROUND="#87cefa",d.FIRST_TIME_BACKGROUND="#ba55d3",d.FIST_DATA_BACKGROUND="lightgreen";class Re{constructor(t,o){this.tableStyler=t,this.colorCycler=o,this.selectedRows=[],this.selectedCols=[],this.tableStyler=t||new z,this.colorCycler=o||new d}toggleRow(t,o=!1,a,s){const n=this.selectedRows.splice(0,this.selectedRows.length);this.selectedRows.push(t),this.uncolorRows(n),this.colorRows(this.selectedRows,a),o&&(this.uncolorCells(n),this.colorCells(this.selectedRows,s))}toggleRowSelection(t,o,a=!1,s,n){const r=this.selectedRows[t]?[this.selectedRows[t]]:[];this.selectedRows[t]=o,this.uncolorRows(r),this.colorRows([this.selectedRows[t]],s),a&&(this.uncolorCells(r),this.colorCells([this.selectedRows[t]],n))}selectRow(t,o){const a=new c.Xc(-1,-1,void 0,t,t,void 0,void 0),s=this.selectedRows.findIndex(n=>n.rowNumber===t);s<0?this.selectedRows.push(a):this.selectedRows[s]=a,this.colorRows([a],o)}deselectRow(t){const o=this.selectedRows.findIndex(s=>s.rowNumber===t);o>=0&&(this.selectedRows[o]=void 0);const a=new c.Xc(-1,-1,void 0,t,t,void 0,void 0);this.uncolorRows([a])}toggleCol(t,o=!1,a,s){const n=this.selectedCols.splice(0,this.selectedCols.length);this.selectedCols.push(t),this.uncolorCols(n),this.colorCols(this.selectedCols,a),o&&(this.uncolorCells(n),this.colorCells(this.selectedCols,s))}toggleColSelection(t,o,a=!1,s,n){const r=this.selectedCols[t]?[this.selectedCols[t]]:[];this.selectedCols[t]=o,this.uncolorCols(r),this.colorCols([this.selectedCols[t]],s),a&&(this.uncolorCells(r),this.colorCells([this.selectedCols[t]],n))}selectCol(t,o){const a=new c.Xc(t,t,void 0,-1,-1,void 0,void 0),s=this.selectedCols.findIndex(n=>n.colNumber===t);s<0?this.selectedCols.push(a):this.selectedCols[s]=a,this.colorCols([a],o)}deselectCol(t){const o=this.selectedCols.findIndex(s=>s.colNumber===t);o>=0&&(this.selectedCols[o]=void 0);const a=new c.Xc(t,t,void 0,-1,-1,void 0,void 0);this.uncolorCols([a])}reset(){this.selectedRows=[],this.selectedCols=[],this.tableStyler.reset()}colorRows(t,o){t.forEach((a,s)=>{this.tableStyler.setRowBackground(a.rowNumber,o||this.colorCycler.rowBackground(s))})}colorCols(t,o){t.forEach((a,s)=>{this.tableStyler.setColBackground(a.colNumber,o||this.colorCycler.columnBackground(s))})}colorCells(t,o){t.forEach((a,s)=>{this.tableStyler.setCellBackground(a.colNumber,a.rowNumber,o||this.colorCycler.cellBackground(s))})}uncolorRows(t){t.forEach(o=>{this.tableStyler.setRowBackground(o.rowNumber,void 0)})}uncolorCols(t){t.forEach(o=>{this.tableStyler.setColBackground(o.colNumber,void 0)})}uncolorCells(t){t.forEach(o=>{this.tableStyler.setCellBackground(o.colNumber,o.rowNumber,void 0)})}}class M{constructor(){this.index=0,this.labelsIndexes=new Map}toColor(t){if(!t)return;this.labelsIndexes.has(t)||this.labelsIndexes.set(t,this.index++);const o=this.labelsIndexes.get(t)%M.colors.length;return M.colors[o]}setColor(t){}}M.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"];class C{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(t,o){this.dataService=t,this.feedback=o,this.tableSelector=new Re,this.lastColumnSeen=0,this.lastRowSeen=0,this.firstPageSlice=g.firstPage(),this.currentPageSlice=g.firstPage()}ngOnInit(){this.dataService.error$.forEach(t=>this.feedback.error(t)),this.dataSubscription=this.dataService.dataSlice$.subscribe(t=>this.setDataSlice(t),t=>this.feedback.error(t))}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe()}colNumber(t){return t<0?-1:this.dataSlice.columnsNumbers[t]}rowNumber(t){return t<0?-1:this.dataSlice.rowsNumbers[t]}setDataSlice(t){this.dataSlice=t,this.lastColumnSeen=Math.max(this.lastColumnSeen,t.columnsNumbers[t.columnsNumbers.length-1]),this.lastRowSeen=Math.max(this.lastRowSeen,t.rowsNumbers[t.rowsNumbers.length-1]),this.currentPageSlice=new g(t.rowPage,t.colPage),this.applySelection()}loadData(){this.importDetails&&(this.lastColumnSeen=0,this.lastRowSeen=0,this.dataService.fileIdFormat([this.importDetails.fileId,this.importDetails.importFormat.name]),this.dataService.slice(this.firstPageSlice)),this.dataSlice&&this.applySelection()}applySelection(){this.tableSelector.reset(),this.markSelections(),this.applyDefaultSelections()}applyDefaultSelections(){}markSelections(){}selectFirstTime(t){this.importDetails.firstTimeCell=t,this.markFirstTime()}markFirstTime(){const t=this.firstTimeCell;t&&(this.importDetails.inRows?this.tableSelector.toggleRow(t,!0,d.TIME_BACKGROUND,d.FIRST_TIME_BACKGROUND):this.tableSelector.toggleCol(t,!0,d.TIME_BACKGROUND,d.FIRST_TIME_BACKGROUND))}selectLabels(t){this.importDetails.labelsSelection=t,this.markLabels()}markLabels(){const t=this.labelsSelection;t&&(this.importDetails.inRows?this.tableSelector.toggleCol(t,!1,d.LABELS_BACKGROUND):this.tableSelector.toggleRow(t,!1,d.LABELS_BACKGROUND))}selectDataStart(t){t?this.importDetails.inRows?(!this.firstTimeCell||this.firstTimeCell.rowIx!==t.rowIx)&&(this.importDetails.dataStart=t):(!this.firstTimeCell||this.firstTimeCell.colIx!==t.colIx)&&(this.importDetails.dataStart=t):this.importDetails.dataStart=void 0,this.markDataStart()}markDataStart(){const t=this.dataStart;t&&(this.importDetails.inRows?this.tableSelector.toggleRowSelection(1,t,!1,d.FIST_DATA_BACKGROUND):this.tableSelector.toggleColSelection(1,t,!1,d.FIST_DATA_BACKGROUND))}reselect(t){if(!this.dataSlice||!t)return;const o=this.dataSlice,a=t.colIx,s=t.rowIx;if(a>=o.columnsNumbers.length||s>=o.rowsNumbers.length)return;const f=new c.Xc(a,o.columnsNumbers[a],o.columnsNames[a],s,o.rowsNumbers[s],o.rowsNames[s],(s>=0?o.data[s]:[])[a]);return f.fake=t.fake,f}hasMoreTimes(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns:this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows)}hasMoreLabels(){return!(!this.importDetails||!this.dataSlice)&&(this.importDetails.inRows?this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows:this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns)}}C.\u0275fac=function(t){return new(t||C)(e.Y36(h),e.Y36(N.T))},C.\u0275dir=e.lG2({type:C});var oe=l(4144),m=l(7155);const ye=["table"];function Le(i,t){1&i&&e._UZ(0,"th",10)}function Ae(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"td",11),e.NdJ("click",function(){const n=e.CHM(o).index,r=e.oxw(2);return e.KtG(r.selectCell(-1,n))}),e.TgZ(1,"label"),e._uU(2),e.qZA()()}if(2&i){const o=t.index,a=e.oxw(2);e.xp6(2),e.Oqu(a.rowsNames[o])}}function Ue(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"th",15),e.NdJ("click",function(){e.CHM(o);const s=e.oxw().index,n=e.oxw(2);return e.KtG(n.selectCell(s,-1))}),e._uU(1),e.qZA()}if(2&i){const o=e.oxw(),a=o.index,s=o.$implicit,n=e.oxw(2);e.Udp("background-color",n.colBackground(a)),e.xp6(1),e.hij(" ",s," ")}}function Me(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"td",16),e.NdJ("click",function(){const n=e.CHM(o).index,r=e.oxw().index,f=e.oxw(2);return e.KtG(f.selectCell(r,n))}),e._uU(1),e.qZA()}if(2&i){const o=t.$implicit,a=t.index,s=e.oxw().index,n=e.oxw(2);e.Udp("background-color",n.cellBackground(s,a)),e.Q6J("matRippleCentered",!0),e.xp6(1),e.hij(" ",o[s]," ")}}function Fe(i,t){1&i&&(e.ynx(0,12),e.YNc(1,Ue,2,3,"th",13),e.YNc(2,Me,2,4,"td",14),e.BQk()),2&i&&e.Q6J("matColumnDef",t.$implicit)}function Je(i,t){1&i&&e._UZ(0,"tr",17)}function Be(i,t){if(1&i&&e._UZ(0,"tr",18),2&i){const o=t.index,a=e.oxw(2);e.Udp("background-color",a.rowBackground(o))}}function Oe(i,t){if(1&i&&(e.TgZ(0,"div",1)(1,"table",2,3),e.ynx(3,4),e.YNc(4,Le,1,0,"th",5),e.YNc(5,Ae,3,1,"td",6),e.BQk(),e.YNc(6,Fe,3,1,"ng-container",7),e.YNc(7,Je,1,0,"tr",8),e.YNc(8,Be,1,2,"tr",9),e.qZA()()),2&i){const o=e.oxw();e.xp6(1),e.Q6J("dataSource",o.data),e.xp6(5),e.Q6J("ngForOf",o.columnsNames),e.xp6(1),e.Q6J("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns)}}class T{set dataSlice(t){t&&(this._dataSlice=t,this.columnsNames=t.columnsNames,this.rowsNames=t.rowsNames,this.displayedColumns=["rowNr"].concat(this.columnsNames),this.data=t.data,this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.styler=new z,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.selected=new e.vpe}colNumber(t){return t<0?-1:this._dataSlice.columnsNumbers[t]}rowNumber(t){return t<0?-1:this._dataSlice.rowsNumbers[t]}colBackground(t){return this.styler.colBackground(this.colNumber(t))}rowBackground(t){return this.styler.rowBackground(this.rowNumber(t))}cellBackground(t,o){return this.styler.cellBackground(this.colNumber(t),this.rowNumber(o))}ngOnInit(){}selectCell(t,o){if(t<0&&!this.selectableRowHeader||o<0&&!this.selectableColHeader)return;const x=new c.Xc(t,this._dataSlice.columnsNumbers[t],this._dataSlice.columnsNames[t],o,this._dataSlice.rowsNumbers[o],this._dataSlice.rowsNames[o],(o>=0?this.data[o]:[])[t]);this.selected.next(x)}}function Qe(i,t){if(1&i&&(e.TgZ(0,"mat-option",9),e._uU(1),e.qZA()),2&i){const o=t.$implicit;e.Q6J("value",o),e.xp6(1),e.Oqu(o.label)}}function Ee(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"p")(1,"mat-form-field")(2,"input",10),e.NdJ("ngModelChange",function(s){e.CHM(o);const n=e.oxw(3);return e.KtG(n.importDetails.imgInterval=s)}),e.qZA()()()}if(2&i){const o=e.oxw(3);e.xp6(2),e.Q6J("ngModel",o.importDetails.imgInterval)}}function qe(i,t){if(1&i&&(e.TgZ(0,"div",11),e._uU(1),e.qZA()),2&i){const o=e.oxw(3);e.xp6(1),e.hij(" The first time point value ",o.firstTimeCell.value," does not look like a number; ")}}function Ye(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"div")(1,"p"),e._uU(2),e.TgZ(3,"strong"),e._uU(4),e.qZA(),e._uU(5,"\xa0 First time point: "),e.TgZ(6,"strong"),e._uU(7),e.qZA(),e._uU(8),e.qZA(),e.TgZ(9,"p")(10,"mat-form-field")(11,"mat-label"),e._uU(12,"Time unit"),e.qZA(),e.TgZ(13,"mat-select",5),e.NdJ("valueChange",function(s){e.CHM(o);const n=e.oxw(2);return e.KtG(n.importDetails.timeType=s)}),e.YNc(14,Qe,2,2,"mat-option",6),e.qZA()()(),e.TgZ(15,"p")(16,"mat-form-field")(17,"input",7),e.NdJ("ngModelChange",function(s){e.CHM(o);const n=e.oxw(2);return e.KtG(n.importDetails.timeOffset=s)}),e.qZA()()(),e.YNc(18,Ee,3,1,"p",2),e.YNc(19,qe,2,1,"div",8),e.qZA()}if(2&i){const o=e.oxw(2);e.xp6(2),e.hij("Times in ",o.importDetails.inLabel," "),e.xp6(2),e.hij("",o.importDetails.inRows?o.firstTimeCell.rowName:o.firstTimeCell.colName,";"),e.xp6(3),e.AsE("",o.firstTimeCell.value," ",null==o.importDetails.timeType?null:o.importDetails.timeType.unit,""),e.xp6(1),e.hij(" [",o.firstTimeCell.colName+":"+o.firstTimeCell.rowName,"] "),e.xp6(5),e.Q6J("value",o.importDetails.timeType),e.xp6(1),e.Q6J("ngForOf",o.timeTypeOptions),e.xp6(3),e.Q6J("ngModel",o.importDetails.timeOffset),e.xp6(1),e.Q6J("ngIf","IMG_NUMBER"==(null==o.importDetails.timeType?null:o.importDetails.timeType.name)),e.xp6(1),e.Q6J("ngIf",o.firstTimeNotNumber())}}function Pe(i,t){if(1&i&&(e.TgZ(0,"div",12),e._uU(1),e.qZA()),2&i){const o=e.oxw(2);e.xp6(1),e.hij(" Even if only the top part of the data table is presented all times from the selected ",o.importDetails.inLabel," will be imported ")}}function He(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"mat-card",1)(1,"mat-card-content"),e.YNc(2,Ye,20,10,"div",2),e.TgZ(3,"div")(4,"div"),e._uU(5),e.qZA()(),e.TgZ(6,"bd2-data-sheet-mdtable",3),e.NdJ("selected",function(s){e.CHM(o);const n=e.oxw();return e.KtG(n.selectFirstTime(s))}),e.qZA(),e.YNc(7,Pe,2,1,"div",4),e.qZA()()}if(2&i){const o=e.oxw();e.xp6(2),e.Q6J("ngIf",o.firstTimeCell),e.xp6(2),e.Tol(o.firstTimeCell?"alert alert-info":"alert alert-danger"),e.xp6(1),e.hij(" Click on the first timepoint in the time ",o.importDetails.inLabel," and then select a time unit. "),e.xp6(1),e.Q6J("dataSlice",o.dataSlice)("styler",o.tableSelector.tableStyler),e.xp6(1),e.Q6J("ngIf",o.hasMoreTimes())}}T.\u0275fac=function(t){return new(t||T)},T.\u0275cmp=e.Xpm({type:T,selectors:[["bd2-data-sheet-mdtable"]],viewQuery:function(t,o){if(1&t&&e.Gf(ye,5),2&t){let a;e.iGM(a=e.CRH())&&(o.matTable=a.first)}},inputs:{dataSlice:"dataSlice",styler:"styler",selectableColHeader:"selectableColHeader",selectableRowHeader:"selectableRowHeader"},outputs:{selected:"selected"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color","click",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"matRippleCentered","background-color","click",4,"matCellDef"],["mat-header-cell","",3,"click"],["mat-cell","","matRipple","",3,"matRippleCentered","click"],["mat-header-row",""],["mat-row",""]],template:function(t,o){1&t&&e.YNc(0,Oe,9,5,"div",0),2&t&&e.Q6J("ngIf",o.dataSlice)},dependencies:[u.sg,u.O5,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.ge,m.ev,m.XQ,m.Gk,L.wG],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:300px;overflow:auto}.mat-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}"]});class F extends C{constructor(t,o){super(t,o),this.timeTypeOptions=[I.ET.TIME_IN_HOURS,I.ET.TIME_IN_MINUTES,I.ET.TIME_IN_SECONDS,I.ET.IMG_NUMBER]}applyDefaultSelections(){if(super.applyDefaultSelections(),this.firstTimeCell&&!this.firstTimeCell.fake)this.selectFirstTime(this.reselect(this.firstTimeCell));else{let t=this.importDetails.inRows?new c.Xc(1,this.colNumber(1),void 0,0,this.rowNumber(0),void 0,void 0):new c.Xc(0,this.colNumber(0),void 0,1,this.rowNumber(1),void 0,void 0);t=this.reselect(t),t.fake=!0,this.selectFirstTime(t)}}firstTimeNotNumber(){return!!this.firstTimeCell&&isNaN(Number(this.firstTimeCell.value))}}function Ge(i,t){if(1&i&&(e.TgZ(0,"div",7),e._uU(1),e.qZA()),2&i){const o=e.oxw(3);e.xp6(1),e.hij(" Labels ",o.importDetails.inLabelNeg," must be before first time point. ")}}function Ke(i,t){if(1&i&&(e.TgZ(0,"div")(1,"p"),e._uU(2),e.TgZ(3,"strong"),e._uU(4),e.qZA()(),e.YNc(5,Ge,2,1,"div",6),e.qZA()),2&i){const o=e.oxw(2);e.xp6(2),e.hij("Labels in ",o.importDetails.inLabelNeg," "),e.xp6(2),e.hij("",o.importDetails.inRows?o.labelsSelection.colName:o.labelsSelection.rowName,";"),e.xp6(1),e.Q6J("ngIf",!o.importDetails.areLabelsAfterTime())}}function je(i,t){if(1&i&&(e.TgZ(0,"div",8),e._uU(1),e.qZA()),2&i){const o=e.oxw(2);e.xp6(1),e.hij(" Even if only the top part of the data table is presented all labels from the selected ",o.importDetails.inLabelNeg," will be imported ")}}function ze(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"mat-card",1)(1,"mat-card-content"),e.YNc(2,Ke,6,3,"div",2),e.TgZ(3,"div")(4,"div",3),e._uU(5),e.qZA()(),e.TgZ(6,"bd2-data-sheet-mdtable",4),e.NdJ("selected",function(s){e.CHM(o);const n=e.oxw();return e.KtG(n.selectLabels(s))}),e.qZA(),e.TgZ(7,"div"),e._uU(8," \xa0 "),e.YNc(9,je,2,1,"div",5),e.qZA()()()}if(2&i){const o=e.oxw();e.xp6(2),e.Q6J("ngIf",o.labelsSelection),e.xp6(2),e.Tol(o.labelsSelection?"alert alert-info":"alert alert-danger"),e.xp6(1),e.hij(" Click on the ",o.importDetails.inLabelNeg," containing labels. "),e.xp6(1),e.Q6J("dataSlice",o.dataSlice)("selectableColHeader",o.importDetails.inRows)("selectableRowHeader",!o.importDetails.inRows)("styler",o.tableSelector.tableStyler),e.xp6(3),e.Q6J("ngIf",o.hasMoreLabels())}}F.\u0275fac=function(t){return new(t||F)(e.Y36(h),e.Y36(N.T))},F.\u0275cmp=e.Xpm({type:F,selectors:[["bd2-define-time-step"]],inputs:{importDetails:"importDetails"},features:[e.qOj],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["required","",3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","placeholder","Time offset",3,"ngModel","ngModelChange"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"value"],["matInput","","type","number","placeholder","Images interval (hours)","required","",3,"ngModel","ngModelChange"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(t,o){1&t&&e.YNc(0,He,8,7,"mat-card",0),2&t&&e.Q6J("ngIf",o.importDetails)},dependencies:[u.sg,u.O5,p.Fj,p.wV,p.JJ,p.Q7,p.On,w.KE,w.hX,te.gD,L.ey,_.a8,_.dn,oe.Nt,T],encapsulation:2});class J extends C{constructor(t,o){super(t,o)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.labelsSelection&&!this.labelsSelection.fake)this.selectLabels(this.reselect(this.labelsSelection));else if(this.firstTimeCell){const t=this.reselect(new c.Xc(this.firstTimeCell.colIx-1,this.colNumber(this.firstTimeCell.colIx-1),void 0,this.firstTimeCell.rowIx-1,this.rowNumber(this.firstTimeCell.rowIx-1),void 0,void 0));t.fake=!0,this.selectLabels(t)}}markSelections(){super.markSelections(),this.markFirstTime()}}function Xe(i,t){if(1&i&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&i){const o=e.oxw(3);e.xp6(1),e.AsE(" Data start ",o.importDetails.inLabel," must be after time ",o.importDetails.inLabel,". ")}}function We(i,t){if(1&i&&(e.TgZ(0,"div")(1,"p"),e._uU(2),e.TgZ(3,"strong"),e._uU(4),e.qZA()(),e.YNc(5,Xe,2,2,"div",4),e.qZA()),2&i){const o=e.oxw(2);e.xp6(2),e.hij("Data starts in ",o.importDetails.inLabel," "),e.xp6(2),e.hij("",o.importDetails.inRows?o.dataStart.rowName:o.dataStart.colName,";"),e.xp6(1),e.Q6J("ngIf",!o.importDetails.isDataAfterTime())}}function $e(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"mat-card",1)(1,"mat-card-content"),e.YNc(2,We,6,3,"div",2),e.TgZ(3,"div")(4,"div"),e._uU(5),e.qZA()(),e.TgZ(6,"bd2-data-sheet-mdtable",3),e.NdJ("selected",function(s){e.CHM(o);const n=e.oxw();return e.KtG(n.selectDataStart(s))}),e.qZA()()()}if(2&i){const o=e.oxw();e.xp6(2),e.Q6J("ngIf",o.dataStart),e.xp6(2),e.Tol(o.dataStart?"alert alert-info":"alert alert-danger"),e.xp6(1),e.hij(" Click on the first data ",o.importDetails.inLabel,". "),e.xp6(1),e.Q6J("dataSlice",o.dataSlice)("selectableColHeader",!o.importDetails.inRows)("selectableRowHeader",o.importDetails.inRows)("styler",o.tableSelector.tableStyler)}}J.\u0275fac=function(t){return new(t||J)(e.Y36(h),e.Y36(N.T))},J.\u0275cmp=e.Xpm({type:J,selectors:[["bd2-import-labels-step"]],inputs:{importDetails:"importDetails"},features:[e.qOj],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],["role","alert"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(t,o){1&t&&e.YNc(0,ze,10,9,"mat-card",0),2&t&&e.Q6J("ngIf",o.importDetails)},dependencies:[u.O5,_.a8,_.dn,T],encapsulation:2});class B extends C{constructor(t,o){super(t,o)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.dataStart&&!this.dataStart.fake)this.selectDataStart(this.reselect(this.dataStart));else if(this.firstTimeCell){const t=this.reselect(new c.Xc(this.firstTimeCell.colIx+1,this.colNumber(this.firstTimeCell.colIx+1),void 0,this.firstTimeCell.rowIx+1,this.rowNumber(this.firstTimeCell.rowIx+1),void 0,void 0));t.fake=!0,this.selectDataStart(t)}}markSelections(){super.markSelections(),this.markFirstTime(),this.markLabels()}}B.\u0275fac=function(t){return new(t||B)(e.Y36(h),e.Y36(N.T))},B.\u0275cmp=e.Xpm({type:B,selectors:[["bd2-select-data-start-step"]],inputs:{importDetails:"importDetails"},features:[e.qOj],decls:1,vars:1,consts:[["class","mat-elevation-z4",4,"ngIf"],[1,"mat-elevation-z4"],[4,"ngIf"],[3,"dataSlice","selectableColHeader","selectableRowHeader","styler","selected"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(t,o){1&t&&e.YNc(0,$e,7,8,"mat-card",0),2&t&&e.Q6J("ngIf",o.importDetails)},dependencies:[u.O5,_.a8,_.dn,T],encapsulation:2});var S=l(5412);class O{constructor(t,o){this.dialogRef=t,this.data=o}ngOnInit(){}sendLabel(){this.dialogRef.close(this.data.label)}}O.\u0275fac=function(t){return new(t||O)(e.Y36(S.so),e.Y36(S.WI))},O.\u0275cmp=e.Xpm({type:O,selectors:[["bd2-edit-label-dialog"]],decls:20,vars:6,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","cdkFocusInitial","",3,"ngModel","ngModelChange","keydown.enter"],["align","start"],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-raised-button","","color","primary",3,"mat-dialog-close"],["ok",""]],template:function(t,o){1&t&&(e.TgZ(0,"h1",0),e._uU(1),e.qZA(),e.TgZ(2,"div",1)(3,"p"),e._uU(4),e.qZA(),e.TgZ(5,"mat-form-field")(6,"input",2),e.NdJ("ngModelChange",function(s){return o.data.label=s})("keydown.enter",function(){return o.sendLabel()}),e.qZA(),e.TgZ(7,"mat-hint",3),e._uU(8,"Pressing "),e.TgZ(9,"strong"),e._uU(10,"Enter"),e.qZA(),e._uU(11," submits "),e.qZA()()(),e.TgZ(12,"div",4)(13,"button",5),e._uU(14,"Cancel"),e.qZA(),e.TgZ(15,"button",5),e._uU(16,"Clear"),e.qZA(),e.TgZ(17,"button",6,7),e._uU(19,"Assign"),e.qZA()()),2&t&&(e.xp6(1),e.Oqu(o.data.title),e.xp6(3),e.hij("Write label for ",o.data.regionName,""),e.xp6(2),e.Q6J("ngModel",o.data.label),e.xp6(7),e.Q6J("mat-dialog-close",void 0),e.xp6(2),e.Q6J("mat-dialog-close",""),e.xp6(2),e.Q6J("mat-dialog-close",o.data.label))},dependencies:[p.Fj,p.JJ,p.On,w.KE,w.bx,oe.Nt,ee.lW,S.ZT,S.uh,S.xY,S.H8],encapsulation:2});const Ve=["table"];function et(i,t){1&i&&e._UZ(0,"th",20)}function tt(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"td",21),e.NdJ("mousedown",function(){const n=e.CHM(o).index,r=e.oxw(2);return e.KtG(r.startSelectCell(-1,n))})("mouseup",function(){const n=e.CHM(o).index,r=e.oxw(2);return e.KtG(r.endSelectCell(-1,n))}),e.TgZ(1,"label"),e._uU(2),e.qZA()()}if(2&i){const o=t.index,a=e.oxw(2);e.xp6(2),e.Oqu(a.rowsNames[o])}}function ot(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"td",22),e.NdJ("click",function(){e.CHM(o);const s=e.oxw(2);return e.KtG(s.nextRow())}),e._uU(1),e.qZA()}if(2&i){const o=e.oxw(2);e.xp6(1),e.Oqu(o.hasMoreRows?"...":"end")}}function it(i,t){1&i&&(e.TgZ(0,"th",20),e._uU(1,"Labels"),e.qZA())}function at(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"td",21),e.NdJ("mousedown",function(){const n=e.CHM(o).index,r=e.oxw(2);return e.KtG(r.startSelectCell(-1,n))})("mouseup",function(){const n=e.CHM(o).index,r=e.oxw(2);return e.KtG(r.endSelectCell(-1,n))}),e.TgZ(1,"label",23),e._uU(2),e.qZA()()}if(2&i){const o=t.index,a=e.oxw(2);e.xp6(2),e.Oqu(a.rowsLabels[o])}}function st(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"td",22),e.NdJ("click",function(){e.CHM(o);const s=e.oxw(2);return e.KtG(s.nextRow())}),e.qZA()}}function nt(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"th",27),e.NdJ("mousedown",function(){e.CHM(o);const s=e.oxw().index,n=e.oxw(2);return e.KtG(n.startSelectCell(s,-1))})("mouseup",function(){e.CHM(o);const s=e.oxw().index,n=e.oxw(2);return e.KtG(n.endSelectCell(s,-1))}),e._uU(1),e.qZA()}if(2&i){const o=e.oxw(),a=o.index,s=o.$implicit,n=e.oxw(2);e.Udp("background-color",n.colBackground(a)),e.xp6(1),e.hij(" ",s," ")}}function lt(i,t){if(1&i&&(e.TgZ(0,"td",28),e._uU(1),e.qZA()),2&i){const o=t.$implicit,a=t.index,s=e.oxw().index,n=e.oxw(2);e.Udp("background-color",n.cellBackground(s,a)),e.xp6(1),e.hij(" ",o[s]," ")}}function rt(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"td",22),e.NdJ("click",function(){e.CHM(o);const s=e.oxw(3);return e.KtG(s.nextRow())}),e._uU(1),e.qZA()}if(2&i){const o=e.oxw(3);e.xp6(1),e.Oqu(o.hasMoreRows?"...":"")}}function ct(i,t){1&i&&(e.ynx(0,24),e.YNc(1,nt,2,3,"th",25),e.YNc(2,lt,2,3,"td",26),e.YNc(3,rt,2,1,"td",7),e.BQk()),2&i&&e.Q6J("matColumnDef",t.$implicit)}function mt(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"th",29),e.NdJ("click",function(){e.CHM(o);const s=e.oxw(2);return e.KtG(s.nextColumn())}),e._uU(1,"..."),e.qZA()}}function pt(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"td",30),e.NdJ("click",function(){e.CHM(o);const s=e.oxw(2);return e.KtG(s.nextColumn())}),e._uU(1,"..."),e.qZA()}}function dt(i,t){1&i&&e._UZ(0,"td",31)}function ut(i,t){1&i&&(e.TgZ(0,"th",20),e._uU(1,"Labels"),e.qZA())}function _t(i,t){1&i&&e._UZ(0,"th",20)}function ht(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"th",27),e.NdJ("mousedown",function(){e.CHM(o);const s=e.oxw().index,n=e.oxw(3);return e.KtG(n.startSelectCell(s,-1))})("mouseup",function(){e.CHM(o);const s=e.oxw().index,n=e.oxw(3);return e.KtG(n.endSelectCell(s,-1))}),e.TgZ(1,"label",23),e._uU(2),e.qZA()()}if(2&i){const o=e.oxw().index,a=e.oxw(3);e.Udp("background-color",a.colBackground(o)),e.xp6(2),e.Oqu(a.columnsLabels[o])}}function ft(i,t){1&i&&(e.ynx(0,24),e.YNc(1,ht,3,3,"th",25),e.BQk()),2&i&&e.Q6J("matColumnDef","label"+t.index)}function gt(i,t){if(1&i&&(e.ynx(0),e.YNc(1,ft,2,1,"ng-container",9),e.BQk()),2&i){const o=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",o.columnsNames)}}function bt(i,t){1&i&&e._UZ(0,"tr",32)}function Ct(i,t){1&i&&e._UZ(0,"tr",32)}function wt(i,t){if(1&i&&(e.ynx(0),e.YNc(1,Ct,1,0,"tr",17),e.BQk()),2&i){const o=e.oxw(2);e.xp6(1),e.Q6J("matHeaderRowDef",o.displayedLabelsColumns)("matHeaderRowDefSticky",!0)}}function Tt(i,t){if(1&i&&e._UZ(0,"tr",33),2&i){const o=t.index,a=e.oxw(2);e.Udp("background-color",a.rowBackground(o))}}function St(i,t){1&i&&e._UZ(0,"tr",34)}function Dt(i,t){if(1&i&&(e.TgZ(0,"div",1)(1,"table",2,3),e.ynx(3,4),e.YNc(4,et,1,0,"th",5),e.YNc(5,tt,3,1,"td",6),e.YNc(6,ot,2,1,"td",7),e.BQk(),e.ynx(7,8),e.YNc(8,it,2,0,"th",5),e.YNc(9,at,3,1,"td",6),e.YNc(10,st,1,0,"td",7),e.BQk(),e.YNc(11,ct,4,1,"ng-container",9),e.ynx(12,10),e.YNc(13,mt,2,0,"th",11),e.YNc(14,pt,2,0,"td",12),e.YNc(15,dt,1,0,"td",13),e.BQk(),e.ynx(16,14),e.YNc(17,ut,2,0,"th",5),e.BQk(),e.ynx(18,15),e.YNc(19,_t,1,0,"th",5),e.BQk(),e.YNc(20,gt,2,1,"ng-container",16),e.YNc(21,bt,1,0,"tr",17),e.YNc(22,wt,2,2,"ng-container",16),e.YNc(23,Tt,1,2,"tr",18),e.YNc(24,St,1,0,"tr",19),e.qZA()()),2&i){const o=e.oxw();e.xp6(1),e.Q6J("dataSource",o.data),e.xp6(10),e.Q6J("ngForOf",o.columnsNames),e.xp6(9),e.Q6J("ngIf",o.showColumnsLabels),e.xp6(1),e.Q6J("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("ngIf",o.showColumnsLabels),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns),e.xp6(1),e.Q6J("matFooterRowDef",o.displayedColumns)}}class Q{set columnsLabels(t){this._columnsLabels=t}get columnsLabels(){return this._columnsLabels}set rowsLabels(t){this._rowsLabels=t}get rowsLabels(){return this._rowsLabels}set dataSlice(t){t&&(this._dataSlice=t,this.columnsNames=t.columnsNames,this.rowsNames=t.rowsNames,this.data=t.data,this.hasMoreColumns=t.columnsNumbers[t.columnsNumbers.length-1]<t.totalColumns-1,this.hasMoreRows=t.rowsNumbers[t.rowsNumbers.length-1]<t.totalRows-1,this.decideColumns(),this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}set selectRows(t){this.selectableRowHeader=t,this.showRowsLabels=t,this.decideColumns()}set selectCols(t){this.selectableColHeader=t,this.showColumnsLabels=t,this.decideColumns()}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.hasMoreColumns=!1,this.hasMoreRows=!1,this._columnsLabels=[],this._rowsLabels=[],this.styler=new z,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.showColumnsLabels=!1,this.showRowsLabels=!1,this.selected=new e.vpe,this.moreRows=new e.vpe,this.moreColumns=new e.vpe}decideColumns(){this.displayedColumns=(this.showRowsLabels?["rowNr","rowLabel"]:["rowNr"]).concat(this.columnsNames),this.displayedLabelsColumns=(this.showRowsLabels?["rowNr2","rowLabel2"]:["rowNr2"]).concat(this.columnsNames.map((t,o)=>"label"+o)),this.hasMoreColumns&&(this.displayedColumns.push("more"),this.displayedLabelsColumns.push("more"))}ngOnInit(){}colNumber(t){return t<0?-1:this._dataSlice.columnsNumbers[t]}rowNumber(t){return t<0?-1:this._dataSlice.rowsNumbers[t]}colBackground(t){return this.styler.colBackground(this.colNumber(t))}rowBackground(t){return this.styler.rowBackground(this.rowNumber(t))}cellBackground(t,o){return this.styler.cellBackground(this.colNumber(t),this.rowNumber(o))}startSelectCell(t,o){if(t<0&&!this.selectableRowHeader||o<0&&!this.selectableColHeader)return;const x=new c.Xc(t,this._dataSlice.columnsNumbers[t],this._dataSlice.columnsNames[t],o,this._dataSlice.rowsNumbers[o],this._dataSlice.rowsNames[o],(o>=0?this.data[o]:[])[t]);this.selectionStart=x}endSelectCell(t,o){if(!this.selectionStart)return;if(o<0&&this.selectionStart.rowIx>=0)return void(this.selectionStart=void 0);if(t<0&&this.selectionStart.colIx>=0)return void(this.selectionStart=void 0);if(t<0&&!this.selectableRowHeader||o<0&&!this.selectableColHeader)return;const x=new c.Xc(t,this._dataSlice.columnsNumbers[t],this._dataSlice.columnsNames[t],o,this._dataSlice.rowsNumbers[o],this._dataSlice.rowsNames[o],(o>=0?this.data[o]:[])[t]);this.selected.next([this.selectionStart,x])}nextColumn(){this.moreColumns.next(!0)}nextRow(){this.moreRows.next(!0)}}Q.\u0275fac=function(t){return new(t||Q)},Q.\u0275cmp=e.Xpm({type:Q,selectors:[["bd2-selectable-region-mdtable"]],viewQuery:function(t,o){if(1&t&&e.Gf(Ve,5),2&t){let a;e.iGM(a=e.CRH())&&(o.matTable=a.first)}},inputs:{columnsLabels:"columnsLabels",rowsLabels:"rowsLabels",dataSlice:"dataSlice",selectRows:"selectRows",selectCols:"selectCols",styler:"styler"},outputs:{selected:"selected",moreRows:"moreRows",moreColumns:"moreColumns"},decls:1,vars:1,consts:[["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["table",""],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"mousedown","mouseup",4,"matCellDef"],["mat-footer-cell","",3,"click",4,"matFooterCellDef"],["matColumnDef","rowLabel","sticky",""],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","more","sticky",""],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","rowNr2","sticky",""],["matColumnDef","rowLabel2","sticky",""],[4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell","","matRipple","",3,"mousedown","mouseup"],["mat-footer-cell","",3,"click"],[1,"user"],[3,"matColumnDef"],["mat-header-cell","","matRipple","",3,"background-color","mousedown","mouseup",4,"matHeaderCellDef"],["mat-cell","",3,"background-color",4,"matCellDef"],["mat-header-cell","","matRipple","",3,"mousedown","mouseup"],["mat-cell",""],["mat-header-cell","",3,"click"],["mat-cell","",3,"click"],["mat-footer-cell",""],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(t,o){1&t&&e.YNc(0,Dt,25,8,"div",0),2&t&&e.Q6J("ngIf",o.dataSlice)},dependencies:[u.sg,u.O5,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.mD,m.Ke,m.ge,m.ev,m.yh,m.XQ,m.Gk,m.Q2,L.wG],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:800px;overflow:auto}.mat-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-header-cell[_ngcontent-%COMP%], .mat-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}label.user[_ngcontent-%COMP%]{color:#000}"]});const xt=["colPaginator"],vt=["rowPaginator"];function Nt(i,t){if(1&i&&(e.TgZ(0,"div",9),e._uU(1),e.qZA()),2&i){const o=e.oxw();e.xp6(1),e.hij(" You have not seen yet all the available ",null==o.importDetails?null:o.importDetails.inLabel,"s for labelling\n")}}const ie=function(){return[10,25,50,100]};class E extends C{get userLabels(){return this.importDetails?this.importDetails.userLabels:void 0}constructor(t,o,a){super(o,a),this.dialog=t,this.columnsLabels=[],this.rowsLabels=[],this.colorer=new M}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy(),this.dataService&&this.dataService.close()}ngAfterViewInit(){this.colPaginator._intl=new R.ye,this.colPaginator._intl.itemsPerPageLabel="Columns per page",this.rowPaginator._intl=new R.ye,this.rowPaginator._intl.itemsPerPageLabel="Rows per page"}markSelections(){super.markSelections(),this.markFirstTime(),this.loadLabels(),this.markLabels(),this.labelsSummary=this.importDetails.summarizeLabels(25),this.labelTime()}labelTime(){if(this.firstTimeCell)if(this.importDetails.inRows){const t=this.dataSlice.rowsNumbers.indexOf(this.firstTimeCell.rowNumber);t>=0&&(this.rowsLabels[t]="Time")}else{const t=this.dataSlice.columnsNumbers.indexOf(this.firstTimeCell.colNumber);t>=0&&(this.columnsLabels[t]="Time")}}loadLabels(){const t=this.dataSlice;this.importDetails.inRows?(this.rowsLabels=this.userLabels.slice(t.rowsNumbers[0],t.rowsNumbers[t.rowsNumbers.length-1]),this.columnsLabels=[]):(this.rowsLabels=[],this.columnsLabels=this.userLabels.slice(t.columnsNumbers[0],t.columnsNumbers[t.columnsNumbers.length-1]))}markLabels(){this.userLabels.forEach((t,o)=>{this.importDetails.inRows?this.tableSelector.selectRow(o,this.colorer.toColor(t)):this.tableSelector.selectCol(o,this.colorer.toColor(t))})}hasSeenAll(){return!!this.dataSlice&&(this.importDetails.inRows?this.lastRowSeen>=this.dataSlice.totalRows-1:this.lastColumnSeen>=this.dataSlice.totalColumns-1)}selected(t){t[1].isBeforeOrSame(t[0])&&(t=[t[1],t[0]]),this.importDetails.inRows?this.labelRows(t[0],t[1]):this.labelColumns(t[0],t[1])}setUserLabel(t,o){this.userLabels[t]=o||void 0,this.labelsSummary=this.importDetails.summarizeLabels(25)}askForLabel(t,o,a){let s;return s=a?{title:"Label rows",regionName:t.hasSameIx(o)?"row "+t.rowName:"rows "+t.rowName+"-"+o.rowName,label:this.userLabels[t.rowNumber]}:{title:"Label columns",regionName:t.hasSameIx(o)?"column "+t.colName:"columns "+t.colName+"-"+o.colName,label:this.userLabels[t.rowNumber]},this.dialog.open(O,{data:s}).afterClosed()}labelRows(t,o){t.rowIx<0||o.rowIx<0?console.warn("Label rows with col selection",t):this.firstTimeCell&&this.firstTimeCell.rowNumber>=t.rowNumber||this.askForLabel(t,o,!0).subscribe(a=>{void 0!==a&&(this.setRowsLabel(t,o,a),a&&this.selectNextRegion(t,o))})}setRowsLabel(t,o,a){a=a.trim();const s=this.colorer.toColor(a);for(let n=t.rowIx;n<=o.rowIx;n++){const r=this.dataSlice.rowsNumbers[n];void 0===r?console.error("No row number for index "+n):(this.rowsLabels[n]=a,this.setUserLabel(r,a),a?this.tableSelector.selectRow(r,s):this.tableSelector.deselectRow(r))}}labelColumns(t,o){t.colIx<0||o.colIx<0?console.warn("Label cols with row selection",t):this.firstTimeCell&&this.firstTimeCell.colNumber>=t.colNumber?console.log("Ignroing labelling as Time col after selection"):this.askForLabel(t,o,!1).subscribe(a=>{void 0!==a&&(this.setColumnsLabel(t,o,a),a&&this.selectNextRegion(t,o))})}setColumnsLabel(t,o,a){a=a.trim();const s=this.colorer.toColor(a);for(let n=t.colIx;n<=o.colIx;n++){const r=this.dataSlice.columnsNumbers[n];void 0===r?console.error("No col number for index "+n):(this.columnsLabels[n]=a,this.setUserLabel(r,a),a?this.tableSelector.selectCol(r,s):this.tableSelector.deselectCol(r))}}selectNextRegion(t,o){const a=[o.colIx-t.colIx,o.rowIx-t.rowIx];let s=this.moveCell(o,[1,1]),n=this.moveCell(s,a);this.isInPage(s)&&(this.isInPage(n)||(n=this.fitToPage(n)),s=this.reselect(s),n=this.reselect(n),this.selected([s,n]))}isInPage(t){return!(t.colIx>=0&&t.colIx>=this.dataSlice.columnsNumbers.length||t.rowIx>=0&&t.rowIx>=this.dataSlice.rowsNumbers.length)}fitToPage(t){return new c.Xc(t.colIx>=0?this.dataSlice.columnsNumbers.length-1:-1,void 0,void 0,t.rowIx>=0?this.dataSlice.rowsNumbers.length-1:-1,void 0,void 0,void 0)}moveCell(t,o){return new c.Xc(t.colIx>=0?t.colIx+o[0]:-1,void 0,void 0,t.rowIx>=0?t.rowIx+o[1]:-1,void 0,void 0,void 0)}loadColPage(t){this.dataService.slice(new g(this.currentPageSlice.rowPage,t))}loadRowPage(t){this.dataService.slice(new g(t,this.currentPageSlice.colPage))}moreColumns(){this.importDetails.inRows||this.colPaginator.nextPage()}moreRows(){this.importDetails.inRows&&this.rowPaginator.nextPage()}}E.\u0275fac=function(t){return new(t||E)(e.Y36(S.uw),e.Y36(h),e.Y36(N.T))},E.\u0275cmp=e.Xpm({type:E,selectors:[["bd2-assign-labels-step"]],viewQuery:function(t,o){if(1&t&&(e.Gf(xt,7),e.Gf(vt,7)),2&t){let a;e.iGM(a=e.CRH())&&(o.colPaginator=a.first),e.iGM(a=e.CRH())&&(o.rowPaginator=a.first)}},inputs:{importDetails:"importDetails"},features:[e._Bn([h]),e.qOj],decls:14,vars:23,consts:[["role","alert","type","info",1,"alert","alert-info",3,"hidden"],[3,"hidden"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["colPaginator",""],[3,"dataSlice","columnsLabels","rowsLabels","styler","selectRows","selectCols","selected","moreColumns","moreRows"],[3,"length","disabled","pageSize","pageSizeOptions","page"],["rowPaginator",""],["type","danger","class","alert alert-danger mt-2","role","alert",4,"ngIf"],[2,"margin-top","1em"],["type","danger","role","alert",1,"alert","alert-danger","mt-2"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._uU(1),e.qZA(),e.TgZ(2,"div",1)(3,"mat-paginator",2,3),e.NdJ("page",function(s){return o.loadColPage(s)}),e.qZA()(),e.TgZ(5,"bd2-selectable-region-mdtable",4),e.NdJ("selected",function(s){return o.selected(s)})("moreColumns",function(){return o.moreColumns()})("moreRows",function(){return o.moreRows()}),e.qZA(),e.TgZ(6,"div",1)(7,"mat-paginator",5,6),e.NdJ("page",function(s){return o.loadRowPage(s)}),e.qZA()(),e.YNc(9,Nt,2,1,"div",7),e.TgZ(10,"div",8)(11,"label"),e._uU(12,"Selected labels: "),e.qZA(),e._uU(13),e.qZA()),2&t&&(e.Q6J("hidden",(null==o.importDetails||null==o.importDetails.userLabels?null:o.importDetails.userLabels.length)>1),e.xp6(1),e.hij(" Click and drag over ",null==o.importDetails?null:o.importDetails.inLabel," headers to label the data.\n"),e.xp6(1),e.Q6J("hidden",null==o.importDetails?null:o.importDetails.inRows),e.xp6(1),e.Q6J("length",null==o.dataSlice?null:o.dataSlice.totalColumns)("disabled",null==o.importDetails?null:o.importDetails.inRows)("pageSize",o.currentPageSlice.colPage.pageSize)("pageIndex",o.currentPageSlice.colPage.pageIndex)("pageSizeOptions",e.DdM(21,ie)),e.xp6(2),e.Q6J("dataSlice",o.dataSlice)("columnsLabels",o.columnsLabels)("rowsLabels",o.rowsLabels)("styler",o.tableSelector.tableStyler)("selectRows",null==o.importDetails?null:o.importDetails.inRows)("selectCols",!(null!=o.importDetails&&o.importDetails.inRows)),e.xp6(1),e.Q6J("hidden",!(null!=o.importDetails&&o.importDetails.inRows)),e.xp6(1),e.Q6J("length",null==o.dataSlice?null:o.dataSlice.totalRows)("disabled",!(null!=o.importDetails&&o.importDetails.inRows))("pageSize",o.firstPageSlice.rowPage.pageSize)("pageSizeOptions",e.DdM(22,ie)),e.xp6(2),e.Q6J("ngIf",!o.hasSeenAll()),e.xp6(4),e.hij("",o.labelsSummary,"\n"))},dependencies:[u.O5,R.NW,Q],encapsulation:2});var ae=l(9521),Zt=l(8675),H=l(7331),kt=l(7392),se=l(3805);const It=["backgroundInput"],Rt=["auto"];function yt(i,t){1&i&&(e.TgZ(0,"mat-icon",14),e._uU(1,"cancel"),e.qZA())}function Lt(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"mat-chip",12),e.NdJ("removed",function(){const n=e.CHM(o).$implicit,r=e.oxw(2);return e.KtG(r.remove(n))}),e._uU(1),e.YNc(2,yt,2,0,"mat-icon",13),e.qZA()}if(2&i){const o=t.$implicit,a=e.oxw(2);e.Q6J("selectable",a.selectable)("removable",a.removable),e.xp6(1),e.hij(" ",o," "),e.xp6(1),e.Q6J("ngIf",a.removable)}}function At(i,t){if(1&i&&(e.TgZ(0,"mat-option",15),e._uU(1),e.qZA()),2&i){const o=t.$implicit;e.Q6J("value",o),e.xp6(1),e.hij(" ",o," ")}}function Ut(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"div")(1,"mat-card",1)(2,"mat-card-content")(3,"div",2),e._uU(4," Select labels for which data should be treated as the background noise "),e.qZA(),e.TgZ(5,"mat-form-field",3)(6,"mat-chip-list",4,5),e.YNc(8,Lt,3,4,"mat-chip",6),e.TgZ(9,"input",7,8),e.NdJ("matChipInputTokenEnd",function(s){e.CHM(o);const n=e.oxw();return e.KtG(n.add(s))}),e.qZA()(),e.TgZ(11,"mat-autocomplete",9,10),e.NdJ("optionSelected",function(s){e.CHM(o);const n=e.oxw();return e.KtG(n.selected(s))}),e.YNc(13,At,2,2,"mat-option",11),e.ALo(14,"async"),e.qZA()()()()()}if(2&i){const o=e.MAs(7),a=e.MAs(12),s=e.oxw();e.xp6(8),e.Q6J("ngForOf",s.backgrounds),e.xp6(1),e.Q6J("formControl",s.backgroundCtrl)("matAutocomplete",a)("matChipInputFor",o)("matChipInputSeparatorKeyCodes",s.separatorKeysCodes)("matChipInputAddOnBlur",s.addOnBlur),e.xp6(4),e.Q6J("ngForOf",e.lcZ(14,7,s.filteredLabels))}}class q{get backgrounds(){return this.importDetails?this.importDetails.backgroundsLabels:[]}set backgrounds(t){this.importDetails.backgroundsLabels=t}constructor(t){this.tsFileService=t,this.selectable=!0,this.removable=!0,this.addOnBlur=!1,this.separatorKeysCodes=[ae.K5,ae.OC],this.backgroundCtrl=new p.p4,this.allLabels=[]}ngOnInit(){this.filteredLabels=this.backgroundCtrl.valueChanges.pipe((0,Zt.O)(null),(0,j.U)(t=>t?this.filter(t):this.allLabels))}loadLabels(){this.importDetails&&this.importDetails.fileId?this.importDetails.importLabels?this.importDetails.labelsSelection&&this.tsFileService.previewLabels(this.importDetails.fileId,this.importDetails.importFormat.name,this.importDetails.labelsSelection,this.importDetails.inRows).subscribe(t=>{this.updateAllLabels(this.unique(t))}):this.updateAllLabels(this.unique(this.importDetails.userLabels)):this.updateAllLabels([])}updateAllLabels(t){this.allLabels=t.slice().sort();const o=this.backgrounds||[];this.backgrounds=[],o.forEach(a=>this.addBackground(a)),this.backgroundCtrl.setValue(" "),this.backgroundCtrl.setValue(null)}unique(t){return t=t.filter(a=>!!a).map(a=>a.trim()),[...new Set(t)]}addBackground(t){if((t||"").trim()){const o=this.backgrounds.indexOf(t),a=this.allLabels.indexOf(t);o<0&&a>=0&&this.backgrounds.push(t.trim())}}add(t){if(!this.matAutocomplete.isOpen){const o=t.input;this.addBackground(t.value),o&&(o.value=""),this.backgroundCtrl.setValue(null)}}remove(t){const o=this.backgrounds.indexOf(t);o>=0&&this.backgrounds.splice(o,1)}selected(t){this.addBackground(t.option.viewValue),this.backgroundInput.nativeElement.value="",this.backgroundCtrl.setValue(null)}filter(t){const o=t.toLowerCase();return this.allLabels.filter(a=>a.toLowerCase().includes(o)).slice(0,7)}}q.\u0275fac=function(t){return new(t||q)(e.Y36(b))},q.\u0275cmp=e.Xpm({type:q,selectors:[["bd2-select-backgrounds-labels-step"]],viewQuery:function(t,o){if(1&t&&(e.Gf(It,5),e.Gf(Rt,5)),2&t){let a;e.iGM(a=e.CRH())&&(o.backgroundInput=a.first),e.iGM(a=e.CRH())&&(o.matAutocomplete=a.first)}},inputs:{importDetails:"importDetails"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"mat-elevation-z4"],["type","info","role","alert",1,"alert","alert-info"],[2,"width","100%"],["aria-label","Backgrounds selection"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder","Type to select background label...",3,"formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["backgroundInput",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"selectable","removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"]],template:function(t,o){1&t&&e.YNc(0,Ut,15,9,"div",0),2&t&&e.Q6J("ngIf",null==o.importDetails?null:o.importDetails.containsBackgrounds)},dependencies:[u.sg,u.O5,p.Fj,p.JJ,p.oH,w.KE,L.ey,_.a8,_.dn,H.qn,H.HS,H.oH,H.qH,kt.Hw,se.XC,se.ZL,u.Ov],encapsulation:2});const Mt=["stepper"],Ft=["importLabelsStep"],Jt=["assignLabelsStep"],Bt=["selectBackgroundsStep"];function Ot(i,t){1&i&&e._uU(0,"Upload data file")}function Qt(i,t){1&i&&e._uU(0,"Data layout")}function Et(i,t){if(1&i&&e._uU(0),2&i){const o=e.oxw();e.hij("Define time ",o.importDetails.inLabel,"")}}function qt(i,t){1&i&&e._uU(0,"Label data")}function Yt(i,t){if(1&i){const o=e.EpF();e.ynx(0),e.TgZ(1,"mat-step",12),e.YNc(2,qt,1,0,"ng-template",2),e._UZ(3,"mat-divider")(4,"bd2-import-details-summary",19)(5,"bd2-assign-labels-step",4,20),e.TgZ(7,"div")(8,"button",10),e._uU(9,"Back"),e.qZA(),e.TgZ(10,"button",14),e.NdJ("click",function(){e.CHM(o);const s=e.oxw();return e.KtG(s.startChoosingBackgrounds())}),e._uU(11,"Next"),e.qZA()()(),e.BQk()}if(2&i){const o=e.oxw();e.xp6(1),e.Q6J("completed",o.importDetails.areLabelsCorrectlyAssigned()),e.xp6(3),e.Q6J("importDetails",o.importDetails)("showTime",!0),e.xp6(1),e.Q6J("importDetails",o.importDetails),e.xp6(5),e.Q6J("disabled",!o.importDetails.areLabelsCorrectlyAssigned())}}function Pt(i,t){if(1&i&&e._uU(0),2&i){const o=e.oxw(2);e.hij("Select labels ",o.importDetails.inLabelNeg,"")}}function Ht(i,t){1&i&&e._uU(0,"Select data start")}function Gt(i,t){if(1&i){const o=e.EpF();e.ynx(0),e.TgZ(1,"mat-step",12),e.YNc(2,Pt,1,1,"ng-template",2),e._UZ(3,"mat-divider")(4,"bd2-import-details-summary",19)(5,"bd2-import-labels-step",4,21),e.TgZ(7,"div")(8,"button",10),e._uU(9,"Back"),e.qZA(),e.TgZ(10,"button",14),e.NdJ("click",function(){e.CHM(o);const s=e.MAs(17),n=e.oxw();return e.KtG(n.loadData(s))}),e._uU(11,"Next"),e.qZA()()(),e.TgZ(12,"mat-step",12),e.YNc(13,Ht,1,0,"ng-template",2),e._UZ(14,"mat-divider")(15,"bd2-import-details-summary",22)(16,"bd2-select-data-start-step",4,23),e.TgZ(18,"div")(19,"button",10),e._uU(20,"Back"),e.qZA(),e.TgZ(21,"button",14),e.NdJ("click",function(){e.CHM(o);const s=e.oxw();return e.KtG(s.startChoosingBackgrounds())}),e._uU(22,"Next"),e.qZA()()(),e.BQk()}if(2&i){const o=e.oxw();e.xp6(1),e.Q6J("completed",o.importDetails.areLabelsCorrectlySelected()),e.xp6(3),e.Q6J("importDetails",o.importDetails)("showTime",!0),e.xp6(1),e.Q6J("importDetails",o.importDetails),e.xp6(5),e.Q6J("disabled",!o.importDetails.areLabelsCorrectlySelected()),e.xp6(2),e.Q6J("completed",o.importDetails.areLabelsCorrectlySelected()&&o.importDetails.isDataStartCorrectlySelected()),e.xp6(3),e.Q6J("importDetails",o.importDetails)("showTime",!0)("showLabelling",!0),e.xp6(1),e.Q6J("importDetails",o.importDetails),e.xp6(5),e.Q6J("disabled",!o.importDetails.isDataStartCorrectlySelected())}}function Kt(i,t){1&i&&e._uU(0,"Select backgrounds labels")}function jt(i,t){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-step"),e.YNc(2,Kt,1,0,"ng-template",2),e._UZ(3,"mat-divider")(4,"bd2-import-details-summary",16)(5,"bd2-select-backgrounds-labels-step",4,24),e.TgZ(7,"div")(8,"button",10),e._uU(9,"Back"),e.qZA(),e.TgZ(10,"button",25),e._uU(11,"Next"),e.qZA()()(),e.BQk()),2&i){const o=e.oxw();e.xp6(4),e.Q6J("importDetails",o.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),e.xp6(1),e.Q6J("importDetails",o.importDetails)}}function zt(i,t){1&i&&e._uU(0,"Import timeseries")}class Y{constructor(t,o,a){this.fileService=t,this.feedback=o,this.dataService=a,this.import=new e.vpe,this.oldImport=new e.vpe,this.blocked=!1,this.importDetails=new c.Jt,this.importDetails.timeType=I.ET.TIME_IN_HOURS}ngOnInit(){}ngOnDestroy(){this.dataService&&this.dataService.close()}upload(t){t.files&&1===t.files.length?this.fileService.uploadFile(t.files[0],t.importFormat).subscribe(o=>{this.importDetails.fileId=o,this.importDetails.fileName=t.files[0].name,this.importDetails.importFormat=t.importFormat,this.importDetails.inRows=t.importFormat!=c.kk.EXCEL_TABLE,this.stepper.next(),t.importFormat==c.kk.TOPCOUNT&&this.oldImport.next(this.importDetails)},o=>{this.feedback.error(o)}):console.error("Wrong upload files size",t.files)}loadData(t){t.loadData()}startLabelling(){this.importDetails.importLabels?this.importLabelsStep?this.importLabelsStep.loadData():console.error("Missing importLabelStep"):this.assignLabelsStep?this.assignLabelsStep.loadData():console.error("Missing assignLabelsStep")}startChoosingBackgrounds(){this.importDetails.containsBackgrounds&&(this.selectBackgroundsStep?this.selectBackgroundsStep.loadLabels():console.error("Missing selectBackgroundsStep"))}importData(){this.importDetails.isComplete()&&this.import.next(this.importDetails)}}function Xt(i,t){1&i&&(e.TgZ(0,"mat-card")(1,"mat-card-content"),e._UZ(2,"mat-spinner",2),e.TgZ(3,"div",3),e._uU(4,"Importing ...."),e.qZA()()())}Y.\u0275fac=function(t){return new(t||Y)(e.Y36(b),e.Y36(N.T),e.Y36(h))},Y.\u0275cmp=e.Xpm({type:Y,selectors:[["bd2-import-steps"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Mt,5),e.Gf(Ft,5),e.Gf(Jt,5),e.Gf(Bt,5)),2&t){let a;e.iGM(a=e.CRH())&&(o.stepper=a.first),e.iGM(a=e.CRH())&&(o.importLabelsStep=a.first),e.iGM(a=e.CRH())&&(o.assignLabelsStep=a.first),e.iGM(a=e.CRH())&&(o.selectBackgroundsStep=a.first)}},inputs:{blocked:"blocked"},outputs:{import:"import",oldImport:"oldImport"},features:[e._Bn([h])],decls:62,vars:26,consts:[[3,"linear"],["stepper",""],["matStepLabel",""],[3,"uploadFiles"],[3,"importDetails"],[1,"mat-elevation-z4"],["name","inRows",1,"spaced",3,"ngModel","ngModelChange"],[3,"value"],["name","importLabels",1,"spaced",3,"ngModel","ngModelChange"],["name","containsBackgrounds",1,"spaced",3,"ngModel","ngModelChange"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","type","button",3,"click"],[3,"completed"],["defineTimeStep",""],["mat-button","","matStepperNext","","type","button",3,"disabled","click"],[4,"ngIf"],[3,"importDetails","showTime","showLabelling","showDataStart"],["type","info","role","alert",1,"alert","alert-info"],["mat-button","",3,"disabled","click"],[3,"importDetails","showTime"],["assignLabelsStep",""],["importLabelsStep",""],[3,"importDetails","showTime","showLabelling"],["selectDataStartStep",""],["selectBackgroundsStep",""],["mat-button","","matStepperNext","","type","button"]],template:function(t,o){if(1&t){const a=e.EpF();e.TgZ(0,"mat-vertical-stepper",0,1)(2,"mat-step"),e.YNc(3,Ot,1,0,"ng-template",2),e.TgZ(4,"bd2-upload-data-file-step",3),e.NdJ("uploadFiles",function(n){return o.upload(n)}),e.qZA()(),e.TgZ(5,"mat-step")(6,"form"),e.YNc(7,Qt,1,0,"ng-template",2),e._UZ(8,"mat-divider")(9,"bd2-import-details-summary",4),e.TgZ(10,"mat-card",5)(11,"mat-card-content")(12,"p")(13,"mat-radio-group",6),e.NdJ("ngModelChange",function(n){return o.importDetails.inRows=n}),e.TgZ(14,"mat-radio-button",7),e._uU(15,"Data in rows"),e.qZA(),e.TgZ(16,"mat-radio-button",7),e._uU(17,"Data in columns"),e.qZA()()(),e.TgZ(18,"p")(19,"mat-radio-group",8),e.NdJ("ngModelChange",function(n){return o.importDetails.importLabels=n}),e.TgZ(20,"mat-radio-button",7),e._uU(21),e.qZA(),e.TgZ(22,"mat-radio-button",7),e._uU(23,"Manually label"),e.qZA()()(),e.TgZ(24,"p")(25,"mat-radio-group",9),e.NdJ("ngModelChange",function(n){return o.importDetails.containsBackgrounds=n}),e.TgZ(26,"mat-radio-button",7),e._uU(27,"No noise data"),e.qZA(),e.TgZ(28,"mat-radio-button",7),e._uU(29),e.qZA()()()(),e.TgZ(30,"mat-card-actions")(31,"button",10),e._uU(32,"Back"),e.qZA(),e.TgZ(33,"button",11),e.NdJ("click",function(){e.CHM(a);const n=e.MAs(40);return e.KtG(o.loadData(n))}),e._uU(34,"Next"),e.qZA()()()()(),e.TgZ(35,"mat-step",12),e.YNc(36,Et,1,1,"ng-template",2),e._UZ(37,"mat-divider")(38,"bd2-import-details-summary",4)(39,"bd2-define-time-step",4,13),e.TgZ(41,"div")(42,"button",10),e._uU(43,"Back"),e.qZA(),e.TgZ(44,"button",14),e.NdJ("click",function(){return o.startLabelling()}),e._uU(45,"Next"),e.qZA()()(),e.YNc(46,Yt,12,5,"ng-container",15),e.YNc(47,Gt,23,11,"ng-container",15),e.YNc(48,jt,12,5,"ng-container",15),e.TgZ(49,"mat-step",12),e.YNc(50,zt,1,0,"ng-template",2),e._UZ(51,"mat-divider")(52,"bd2-import-details-summary",16),e.TgZ(53,"mat-card",5)(54,"mat-card-content")(55,"div",17),e._uU(56,"You can now import the timeseries"),e.qZA()()(),e.TgZ(57,"div")(58,"button",10),e._uU(59,"Back"),e.qZA(),e.TgZ(60,"button",18),e.NdJ("click",function(){return o.importData()}),e._uU(61,"Import data"),e.qZA()()()()}2&t&&(e.Q6J("linear",!0),e.xp6(9),e.Q6J("importDetails",o.importDetails),e.xp6(4),e.Q6J("ngModel",o.importDetails.inRows),e.xp6(1),e.Q6J("value",!0),e.xp6(2),e.Q6J("value",!1),e.xp6(3),e.Q6J("ngModel",o.importDetails.importLabels),e.xp6(1),e.Q6J("value",!0),e.xp6(1),e.hij("Import labels from ",o.importDetails.inLabelNeg,""),e.xp6(1),e.Q6J("value",!1),e.xp6(3),e.Q6J("ngModel",o.importDetails.containsBackgrounds),e.xp6(1),e.Q6J("value",!1),e.xp6(2),e.Q6J("value",!0),e.xp6(1),e.hij("Background noise in ",o.importDetails.inLabel,"s"),e.xp6(6),e.Q6J("completed",o.importDetails.isTimeDefined()),e.xp6(3),e.Q6J("importDetails",o.importDetails),e.xp6(1),e.Q6J("importDetails",o.importDetails),e.xp6(5),e.Q6J("disabled",!o.importDetails.isTimeDefined()),e.xp6(2),e.Q6J("ngIf",!o.importDetails.importLabels),e.xp6(1),e.Q6J("ngIf",o.importDetails.importLabels),e.xp6(1),e.Q6J("ngIf",o.importDetails.containsBackgrounds),e.xp6(1),e.Q6J("completed",o.importDetails.isComplete()),e.xp6(3),e.Q6J("importDetails",o.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),e.xp6(8),e.Q6J("disabled",o.blocked||!o.importDetails.isComplete()))},dependencies:[u.O5,p._Y,p.JJ,p.JL,p.On,p.F,V.VQ,V.U0,_.a8,_.dn,_.hq,fe.d,y.C0,y.VY,y.Vq,y.Ic,y.fd,ee.lW,A,U,F,J,B,E,q],encapsulation:2});class P extends ne.w{constructor(t,o){super(o),this.BD2REST=t,this.importing=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit()}importData(t){if(this.importing)return;const o=new c.nl;o.fileId=t.fileId,o.importFormat=t.importFormat,o.importParameters=t,this.importing=!0,this.BD2REST.experimentImportTS(this.assay.id,o).subscribe(a=>{this.feedback.success("Imported "+a.imported+" timeseries"),this.refreshModel(),this.importing=!1,this.goToTSView()},a=>{this.importing=!1,this.feedback.error(a)})}goToTSView(){const t=this.expHomePath();t.push("data"),t.push("view"),t.push("ts"),this.router.navigate(t)}goToOldImport(t){const o=this.expHomePath();o.push("data","ts-old-import",t.importFormat.name,t.fileId),this.router.navigate(o)}}P.\u0275fac=function(t){return new(t||P)(e.Y36(G.q),e.Y36(le.L))},P.\u0275cmp=e.Xpm({type:P,selectors:[["bd2-tsimport-dashboard"]],features:[e.qOj],decls:2,vars:1,consts:[[3,"import","oldImport"],[4,"ngIf"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"]],template:function(t,o){1&t&&(e.TgZ(0,"bd2-import-steps",0),e.NdJ("import",function(s){return o.importData(s)})("oldImport",function(s){return o.goToOldImport(s)}),e.qZA(),e.YNc(1,Xt,5,0,"mat-card",1)),2&t&&(e.xp6(1),e.Q6J("ngIf",o.importing))},dependencies:[u.O5,re.Ou,_.a8,_.dn,Y],encapsulation:2});const Wt=[{path:"",children:[{path:"",component:P}]}];class Z{}Z.\u0275fac=function(t){return new(t||Z)},Z.\u0275mod=e.oAB({type:Z}),Z.\u0275inj=e.cJS({imports:[W.Bz.forChild(Wt),W.Bz]});var $t=l(2929),Vt=l(6397);class k{}k.\u0275fac=function(t){return new(t||k)},k.\u0275mod=e.oAB({type:k}),k.\u0275inj=e.cJS({imports:[u.ez,p.u5,p.UX,$t.Q,Vt.O,Z]})}}]);