"use strict";(self.webpackChunkbiodare2_ui=self.webpackChunkbiodare2_ui||[]).push([[459],{6459:(ue,v,r)=>{r.r(v),r.d(v,{RhythmicityModule:()=>pe});var h=r(6814),_=r(1896),O=r(4621),t=r(5879),p=r(7469),b=r(6444);let Z=(()=>{class i extends O.w{constructor(e,n){super(n),this.rhythmicityService=e,this.titlePart=" Rhythm"}goToRhythmicityHome(e){const n=this.expHomePath(e);n.push("rhythmicity"),this.router.navigate(n)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.o),t.Y36(b.L))},i.\u0275dir=t.lG2({type:i,features:[t.qOj]}),i})();var w=r(5619),M=r(9080),N=r(8790),q=r(6849),l=r(1301),j=r(7439),R=r(8172),Y=r(6828);let C=(()=>{class i extends j.S{get currentJob(){return this.currentAsset}constructor(e,n=!1){super(n),this.rhythmicityService=e,this.finishedJob$=this.finished$,this.runningJob$=this.running$,this.allJob$=this.all$}initIntervalsKeeper(){return new Y.i(1e3,3e4,6e5,2)}assayJob(e){this.input(e)}sameInput(e,n){return e[1]===n[1]&&e[0]===n[0]}fetchAsset([e,n]){return this.rhythmicityService.getJob(e,n)}hasFailed(e){return l.GJ.hasFailed(e)}isFinished(e){return l.GJ.isFinished(e)}isRunning(e){return l.GJ.isRunning(e)}assetToId(e){return e.jobId}assetToInput(e){return[e.parentId,e.jobId]}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(p.o),t.LFG(R.I,8))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac}),i})();var g=r(4900),F=r(9397),Q=r(5323);let x=(()=>{class i extends Q.v{constructor(e,n=!1){super(n),this.rhythmicityService=e,this.results$=this.data$}isClassicJob(){return"BD2JTK"===this.currentInput?.parameters?.METHOD}sameInput(e,n){return l.GJ.sameJob(e,n)}assetToData(e,n){return e.results}fetchAsset(e){return this.rhythmicityService.getResults(e.parentId,e.jobId).pipe((0,F.b)(n=>this.labelPatterns(n)))}sortingKey(e){switch(e.active){case"label":return n=>n.label;case"id":return n=>+n.id;case"empp":return n=>+n.result.empP;case"emppbh":return n=>+n.result.empPBH;case"p":return n=>+n.result.p;case"pbh":return n=>+n.result.pBH;case"tau":return n=>+n.result.tau;case"period":return n=>n.result.pattern.period;case"peak":return n=>n.result.pattern.peak;case"trough":return n=>n.result.pattern.trough;default:return console.error("Not implemented sorting for "+e.active),n=>0}}processData(e,n){return n&&this.rankResults(e,n.pValue,n.bhCorrection,this.isClassicJob()),e}labelPatterns(e){e.results.forEach(n=>{n.result.patternLabel=this.describePattern(n.result),n.result.pattern.shapeLabel=this.patternToShape(n.result.pattern)})}describePattern(e){const n=e.pattern,s=Math.round(10*n.period)/10,a=Math.round(100*n.peak)/100,d=Math.round(100*n.trough)/100;return`${this.patternToShape(n)}\t${s}\t${a}\t${d}`}patternToShape(e){switch(e.waveform){case"ASYM_COSINE":return.5===e.leftPortion?"COS":"ACOS";case"ASYM_COS_SPIKE":return"SPIKE";case"ASYM_COS_SPIKE_NEG":return"NPIKE";default:return e.waveform}}rankResults(e,n,s,a){e.forEach(d=>{const u=d.result;let T;T=a?s?u.pBH:u.p:s?u.empPBH:u.empP,u.rhythmic=T<n})}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(p.o),t.LFG(R.I,8))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac}),i})();var P=r(1574),J=r(337),m=r(2396),k=r(3139);function E(i,o){1&i&&t._UZ(0,"mat-progress-bar",28)}function B(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"Id"),t.qZA())}function H(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(e.id)}}function L(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"Label"),t.qZA())}function $(i,o){if(1&i&&(t.TgZ(0,"td",31),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(e.label)}}function K(i,o){1&i&&(t.TgZ(0,"th",32),t._uU(1,"Rhythmic"),t.qZA())}function G(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.ekj("bold",e.result.rhythmic),t.xp6(1),t.Oqu(e.result.rhythmic)}}function z(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"emp-p"),t.qZA())}function V(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.result.empP,"1.0-5"))}}function W(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"BH emp-p"),t.qZA())}function X(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.result.empPBH,"1.0-5"))}}function tt(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"Tau"),t.qZA())}function et(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.result.tau,"1.0-2"))}}function it(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"p"),t.qZA())}function nt(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.result.p,"1.0-5"))}}function ot(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"BH p"),t.qZA())}function st(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.result.pBH,"1.0-5"))}}function rt(i,o){1&i&&(t.TgZ(0,"th",32),t._uU(1,"Pattern"),t.qZA())}function at(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(e.result.patternLabel)}}function ct(i,o){1&i&&(t.TgZ(0,"th",32),t._uU(1,"P.Shape"),t.qZA())}function lt(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(e.result.pattern.shapeLabel)}}function ht(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"P.Period"),t.qZA())}function mt(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.result.pattern.period,"1.0-1"))}}function dt(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"P.Peak"),t.qZA())}function pt(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.result.pattern.peak,"1.1-1"))}}function ut(i,o){1&i&&(t.TgZ(0,"th",32),t._uU(1,"P.Peak"),t.qZA())}function ft(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,24*e.result.pattern.peak/e.result.pattern.period,"1.1-1"))}}function yt(i,o){1&i&&(t.TgZ(0,"th",29),t._uU(1,"P.Trough"),t.qZA())}function _t(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.result.pattern.trough,"1.1-1"))}}function bt(i,o){1&i&&(t.TgZ(0,"th",32),t._uU(1,"P.Trough"),t.qZA())}function gt(i,o){if(1&i&&(t.TgZ(0,"td",30),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,24*e.result.pattern.trough/e.result.pattern.period,"1.1-1"))}}function Tt(i,o){1&i&&t._UZ(0,"tr",33)}function vt(i,o){1&i&&t._UZ(0,"tr",34)}const A=function(){return[10,25,50,100,250]};let U=(()=>{class i{set job(e){e&&this.fetcher.input(e)}set statTestParams(e){if(e){this.fetcher.params(e);let n=e.bhCorrection?this.bhEmpPColumns:this.normEmpPColumns;this.fetcher.isClassicJob()&&(n=e.bhCorrection?this.bhClsPColumns:this.normClsPColumns),e.showPattern&&(n=n.concat(e.circadian?this.patternColumnsC:this.patternColumns)),this.displayedColumns=n}}constructor(e,n){this.fetcher=e,this.feedback=n,this.normEmpPColumns=["id","label","rhythmic","empp","tau"],this.normClsPColumns=["id","label","rhythmic","p","tau"],this.bhEmpPColumns=["id","label","rhythmic","emppbh","tau"],this.bhClsPColumns=["id","label","rhythmic","pbh","tau"],this.patternColumns=["shape","period","peak","trough"],this.patternColumnsC=["shape","period","peakc","troughc"],this.displayedColumns=this.normEmpPColumns,this.disablePaginator=!1}ngOnInit(){this.fetcher.error$.subscribe(n=>this.feedback.error(n));const e=new g.kl;e.pageSize=25,e.pageIndex=0,this.fetcher.page(e),this.fetcher.on(!0)}ngOnDestroy(){this.fetcher.close()}ngAfterViewInit(){}reload(){this.fetcher.refresh()}sortData(e){this.fetcher.sort(e)}loadPage(e){this.fetcher.page(e)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(x),t.Y36(P.T))},i.\u0275cmp=t.Xpm({type:i,selectors:[["bd2-rhythmicity-results-mdtable"]],inputs:{job:"job",statTestParams:"statTestParams"},features:[t._Bn([x])],decls:55,vars:18,consts:[[1,"mat-elevation-z8"],["mode","indeterminate",4,"ngIf"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["paginator",""],["mat-table","","matSort","","aria-label","Results","matSort","","matSortActive","id","matSortDirection","asc",1,"full-width-table",3,"dataSource","matSortChange"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","label"],["mat-cell","","class","word_wrapping","style","max-width: 100px",4,"matCellDef"],["matColumnDef","rhythmic"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"bold",4,"matCellDef"],["matColumnDef","empp"],["matColumnDef","emppbh"],["matColumnDef","tau"],["matColumnDef","p"],["matColumnDef","pbh"],["matColumnDef","pattern"],["matColumnDef","shape"],["matColumnDef","period"],["matColumnDef","peak"],["matColumnDef","peakc"],["matColumnDef","trough"],["matColumnDef","troughc"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["paginator2",""],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"word_wrapping",2,"max-width","100px"],["mat-header-cell",""],["mat-header-row",""],["mat-row",""]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,E,1,0,"mat-progress-bar",1),t.ALo(2,"async"),t.TgZ(3,"mat-paginator",2,3),t.NdJ("page",function(a){return n.loadPage(a)}),t.qZA(),t.TgZ(5,"table",4),t.NdJ("matSortChange",function(a){return n.sortData(a)}),t.ynx(6,5),t.YNc(7,B,2,0,"th",6),t.YNc(8,H,2,1,"td",7),t.BQk(),t.ynx(9,8),t.YNc(10,L,2,0,"th",6),t.YNc(11,$,2,1,"td",9),t.BQk(),t.ynx(12,10),t.YNc(13,K,2,0,"th",11),t.YNc(14,G,2,3,"td",12),t.BQk(),t.ynx(15,13),t.YNc(16,z,2,0,"th",6),t.YNc(17,V,3,4,"td",7),t.BQk(),t.ynx(18,14),t.YNc(19,W,2,0,"th",6),t.YNc(20,X,3,4,"td",7),t.BQk(),t.ynx(21,15),t.YNc(22,tt,2,0,"th",6),t.YNc(23,et,3,4,"td",7),t.BQk(),t.ynx(24,16),t.YNc(25,it,2,0,"th",6),t.YNc(26,nt,3,4,"td",7),t.BQk(),t.ynx(27,17),t.YNc(28,ot,2,0,"th",6),t.YNc(29,st,3,4,"td",7),t.BQk(),t.ynx(30,18),t.YNc(31,rt,2,0,"th",11),t.YNc(32,at,2,1,"td",7),t.BQk(),t.ynx(33,19),t.YNc(34,ct,2,0,"th",11),t.YNc(35,lt,2,1,"td",7),t.BQk(),t.ynx(36,20),t.YNc(37,ht,2,0,"th",6),t.YNc(38,mt,3,4,"td",7),t.BQk(),t.ynx(39,21),t.YNc(40,dt,2,0,"th",6),t.YNc(41,pt,3,4,"td",7),t.BQk(),t.ynx(42,22),t.YNc(43,ut,2,0,"th",11),t.YNc(44,ft,3,4,"td",7),t.BQk(),t.ynx(45,23),t.YNc(46,yt,2,0,"th",6),t.YNc(47,_t,3,4,"td",7),t.BQk(),t.ynx(48,24),t.YNc(49,bt,2,0,"th",11),t.YNc(50,gt,3,4,"td",7),t.BQk(),t.YNc(51,Tt,1,0,"tr",25),t.YNc(52,vt,1,0,"tr",26),t.qZA(),t.TgZ(53,"mat-paginator",2,27),t.NdJ("page",function(a){return n.loadPage(a)}),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("ngIf",t.lcZ(2,14,n.fetcher.isBusy$)),t.xp6(2),t.Q6J("length",n.fetcher.dataLength)("disabled",n.disablePaginator)("pageSize",(null==n.fetcher.currentPage?null:n.fetcher.currentPage.pageSize)||25)("pageIndex",null==n.fetcher.currentPage?null:n.fetcher.currentPage.pageIndex)("pageSizeOptions",t.DdM(16,A)),t.xp6(2),t.Q6J("dataSource",n.fetcher.results$),t.xp6(46),t.Q6J("matHeaderRowDef",n.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",n.displayedColumns),t.xp6(1),t.Q6J("length",n.fetcher.dataLength)("disabled",n.disablePaginator)("pageSize",(null==n.fetcher.currentPage?null:n.fetcher.currentPage.pageSize)||25)("pageIndex",null==n.fetcher.currentPage?null:n.fetcher.currentPage.pageIndex)("pageSizeOptions",t.DdM(17,A)))},dependencies:[h.O5,g.NW,J.YE,J.nU,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.ge,m.ev,m.XQ,m.Gk,k.pW,h.Ov,h.JJ],styles:[".full-width-table[_ngcontent-%COMP%]{width:100%}"]}),i})();var Zt=r(1344),Rt=r(1009),Ct=r(7937),f=r(7452),xt=r(2468),Pt=r(1933),c=r(6223),Jt=r(6005),D=r(8285);function At(i,o){if(1&i&&(t.TgZ(0,"mat-radio-button",5),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}let Ut=(()=>{class i{constructor(){this.values=[1e-4,.001,.005,.01,.05,.1],this.pvalue=.001,this.pvalue$=new t.vpe}ngOnInit(){}ngAfterViewInit(){this.pvalue$.emit(this.pvalue)}selected(e){this.pvalue$.emit(e.value)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["bd2-pvalue-form"]],outputs:{pvalue$:"pvalue$"},decls:8,vars:2,consts:[[1,"form-inline"],[1,"mx-auto","text-center"],["id","pvalues-label",1,"mb-1"],["aria-label","Select p-value","aria-labelledby","pvalues-label",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,n){1&e&&(t.TgZ(0,"form",0)(1,"div",1)(2,"mat-label",2)(3,"strong"),t._uU(4,"p-value threshold:"),t.qZA()(),t.TgZ(5,"div")(6,"mat-radio-group",3),t.NdJ("change",function(a){return n.selected(a)}),t.YNc(7,At,2,2,"mat-radio-button",4),t.qZA()()()()),2&e&&(t.xp6(6),t.Q6J("value",n.pvalue),t.xp6(1),t.Q6J("ngForOf",n.values))},dependencies:[h.sg,c._Y,c.JL,c.F,Jt.hX,D.VQ,D.U0],styles:[".mat-radio-button[_ngcontent-%COMP%]{margin-right:15px}"]}),i})(),Dt=(()=>{class i{constructor(){this.options=new t.vpe,this.currentOptions=new l.Mn(0,!1,!1,!1)}ngOnInit(){}pValue(e){this.currentOptions=this.currentOptions.clone(),this.currentOptions.pValue=e,this.options.next(this.currentOptions)}bhCorrection(e){this.currentOptions=this.currentOptions.clone(),this.currentOptions.bhCorrection=e,this.options.next(this.currentOptions)}circadian(e){this.currentOptions=this.currentOptions.clone(),this.currentOptions.circadian=e,this.options.next(this.currentOptions)}showPattern(e){this.currentOptions=this.currentOptions.clone(),this.currentOptions.showPattern=e,this.options.next(this.currentOptions)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["bd2-stat-test-options-widget"]],outputs:{options:"options"},decls:14,vars:1,consts:[[3,"pvalue$"],[2,"margin-top","0.5em","text-align","center"],[3,"change"],["pattern",""],[3,"disabled","change"]],template:function(e,n){if(1&e&&(t.TgZ(0,"mat-card")(1,"mat-card-content")(2,"section")(3,"bd2-pvalue-form",0),t.NdJ("pvalue$",function(a){return n.pValue(a)}),t.qZA()(),t.TgZ(4,"section",1)(5,"mat-slide-toggle",2),t.NdJ("change",function(a){return n.bhCorrection(a.checked)}),t._uU(6,"Benjamini Hochberg correction"),t.qZA()(),t.TgZ(7,"section",1)(8,"mat-slide-toggle",2,3),t.NdJ("change",function(a){return n.showPattern(a.checked)}),t._uU(10,"show pattern"),t.qZA(),t._uU(11," \xa0 "),t.TgZ(12,"mat-slide-toggle",4),t.NdJ("change",function(a){return n.circadian(a.checked)}),t._uU(13,"circadian unit"),t.qZA()()()()),2&e){const s=t.MAs(9);t.xp6(12),t.Q6J("disabled",!s.checked)}},dependencies:[Pt.Rr,f.a8,f.dn,Ut],encapsulation:2}),i})();function St(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",13),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.delete())}),t.TgZ(2,"i",4),t._uU(3,"delete_forever"),t.qZA()(),t.TgZ(4,"button",14),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.export())}),t.TgZ(5,"i",4),t._uU(6,"save_alt"),t.qZA()()()}}function It(i,o){if(1&i&&(t.TgZ(0,"div",15),t._UZ(1,"br"),t._uU(2),t.qZA()),2&i){const e=t.oxw().ngIf;t.xp6(2),t.hij("ERROR: ",e.jobStatus.message," ")}}function Ot(i,o){1&i&&(t.TgZ(0,"div")(1,"mat-card")(2,"mat-card-content"),t._UZ(3,"mat-spinner",16),t.qZA()()())}function wt(i,o){1&i&&(t.TgZ(0,"div")(1,"mat-card")(2,"mat-card-content")(3,"div",17),t._uU(4,"It may take up to 10 minutes to test for rhythmicity"),t.qZA()()()())}function Mt(i,o){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"bd2-stat-test-options-widget",18),t.NdJ("options",function(s){t.CHM(e);const a=t.oxw(3);return t.KtG(a.statTestOptions(s))}),t.qZA(),t._UZ(2,"bd2-rhythmicity-results-mdtable",19),t.BQk()}if(2&i){const e=o.ngIf,n=t.oxw(3);t.xp6(2),t.Q6J("statTestParams",n.statTestParams)("job",e)}}function Nt(i,o){if(1&i&&(t.TgZ(0,"div"),t._UZ(1,"mat-divider"),t.YNc(2,Ot,4,0,"div",12),t.ALo(3,"async"),t.YNc(4,wt,5,0,"div",12),t.YNc(5,Mt,3,2,"ng-container",12),t.ALo(6,"async"),t.qZA()),2&i){const e=t.oxw().ngIf,n=t.oxw();t.xp6(2),t.Q6J("ngIf",t.lcZ(3,3,n.rhythmicityJobDatasource.isReloading$)),t.xp6(2),t.Q6J("ngIf","SUBMITTED"===e.jobStatus.state),t.xp6(1),t.Q6J("ngIf",t.lcZ(6,5,n.rhythmicityJobDatasource.finishedJob$))}}function qt(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.toggleExpanded())}),t.TgZ(3,"i",4),t._uU(4,"waves"),t.qZA(),t._uU(5),t.ALo(6,"date"),t._UZ(7,"br"),t._uU(8),t.qZA(),t.TgZ(9,"div",5),t._uU(10),t.TgZ(11,"a",6),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.refresh())}),t.TgZ(12,"i",7),t._uU(13,"refresh"),t.qZA()()()(),t.TgZ(14,"div",8)(15,"mat-card")(16,"mat-card-content")(17,"div",9),t.YNc(18,St,7,0,"div",10),t._uU(19),t.YNc(20,It,3,1,"div",11),t.qZA()()(),t.YNc(21,Nt,7,7,"div",12),t.qZA()()}if(2&i){const e=o.ngIf,n=t.oxw();t.xp6(3),t.Udp("color",n.isExpanded?"green":"red")("font-size",150,"%"),t.xp6(2),t.AsE(" \xa0",n.shortUUID(e.jobId)," (",t.lcZ(6,13,n.toLocalDateTime(e.jobStatus.submitted)),") "),t.xp6(3),t.AsE(" ",n.friendlyMethod(e.parameters.METHOD),"; \xa0 waveforms: ",e.parameters.PRESET," "),t.xp6(2),t.hij(" ",e.jobStatus.state," "),t.xp6(8),t.Q6J("ngIf",n.assay.security.canWrite),t.xp6(1),t.hij(" ",e.parameters.PARAMS_SUMMARY," "),t.xp6(1),t.Q6J("ngIf",e.jobStatus.message&&"OK"!=e.jobStatus.message),t.xp6(1),t.Q6J("ngIf",n.isExpanded)}}let S=(()=>{class i{set expanded(e){this.isExpanded=e,this.expandedToogleStream.next(e)}constructor(e,n,s,a){this.rhythmicityService=e,this.rhythmicityJobDatasource=n,this.feedback=s,this.dialogs=a,this.deleted=new t.vpe,this.isExpanded=!1,this.expandedToogleStream=new w.X(!1)}ngOnInit(){this.initSubscriptions()}ngOnDestroy(){this.rhythmicityJobDatasource.close(),this.expandedToogleStream&&this.expandedToogleStream.complete()}ngOnChanges(e){(e.jobId||e.assay)&&this.jobId&&this.assay&&this.rhythmicityJobDatasource.assayJob([this.assay.id,this.jobId])}statTestOptions(e){const n=(0,M.H)(1).subscribe(()=>{this.statTestParams=e,n&&n.unsubscribe()})}export(){this.rhythmicityService.downloadJob(this.assay.id,this.jobId).subscribe(e=>{this.saveJobBlob(e,this.assay.id,this.jobId)},e=>this.feedback.error(e))}saveJobBlob(e,n,s){const a={fileName:n+"_job"+this.shortUUID(s)+".rhythmicity.csv",extensions:[".csv"]};(0,q.NL)(e,a).then(d=>{}).catch(d=>console.log("could not save export",d))}refresh(){this.rhythmicityJobDatasource.refresh(),this.resultsTable&&this.resultsTable.reload()}delete(){const e=this.assay,n=this.rhythmicityJobDatasource.currentJob;this.dialogs.confirm("Do you want to delete analysis: "+n.jobId,n.parameters.PARAMS_SUMMARY).subscribe(s=>{s&&this.doDelete(e,n.jobId)})}initSubscriptions(){this.rhythmicityJobDatasource.on(!0),this.rhythmicityJobDatasource.error$.forEach(e=>this.feedback.error(e))}doDelete(e,n){this.rhythmicityService.deleteJob(e,n).subscribe(s=>{this.deleted.next(s),this.feedback.success("Job: "+this.shortUUID(n)+" deleted")},s=>{this.feedback.error(s)})}toggleExpanded(){this.expanded=!this.isExpanded}toLocalDateTime(e){return N.a.deserialize(e).date}shortUUID(e){return(0,Zt.tm)(e)}friendlyMethod(e){return"BD2JTK"===e?"Classic JTK":"BD2EJTK"===e?"BD2 eJTK":e}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.o),t.Y36(C),t.Y36(P.T),t.Y36(Rt.d))},i.\u0275cmp=t.Xpm({type:i,selectors:[["bd2-rhythmicity-job-pane"]],viewQuery:function(e,n){if(1&e&&t.Gf(U,5),2&e){let s;t.iGM(s=t.CRH())&&(n.resultsTable=s.first)}},inputs:{jobId:"jobId",assay:"assay",expanded:"expanded"},outputs:{deleted:"deleted"},features:[t._Bn([C]),t.TTD],decls:2,vars:3,consts:[["class","card mb-2",4,"ngIf"],[1,"card","mb-2"],[1,"card-header","clearfix"],["role","button",1,"float-left",3,"click"],[1,"material-icons","bd-icon"],[1,"float-right"],["role","button","aria-label","refresh",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"card-body"],[1,"clearfix"],["class","float-right",4,"ngIf"],["class","text-danger","style","word-wrap: break-word;",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-danger","btn-sm","mr-1",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"text-danger",2,"word-wrap","break-word"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"],[3,"options"],[3,"statTestParams","job"]],template:function(e,n){1&e&&(t.YNc(0,qt,22,15,"div",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,n.rhythmicityJobDatasource.allJob$))},dependencies:[h.O5,Ct.Ou,f.a8,f.dn,xt.d,U,Dt,h.Ov,h.uU],encapsulation:2}),i})();function jt(i,o){if(1&i&&(t.TgZ(0,"div")(1,"strong"),t._uU(2),t.qZA()()),2&i){const e=t.oxw(2);t.xp6(2),t.hij("Submitted jobs: ",e.jobs.length,"")}}function Yt(i,o){1&i&&(t.TgZ(0,"div"),t._uU(1," No jobs submitted, start a new test. "),t.qZA())}const Ft=function(){return["new"]};function Qt(i,o){1&i&&(t.TgZ(0,"a",7),t._uU(1," New test "),t.qZA()),2&i&&t.Q6J("routerLink",t.DdM(1,Ft))}function kt(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"bd2-rhythmicity-job-pane",8),t.NdJ("deleted",function(s){t.CHM(e);const a=t.oxw(2);return t.KtG(a.remove(s))}),t.qZA()()}if(2&i){const e=o.$implicit,n=o.index,s=t.oxw(2);t.xp6(1),t.Q6J("assay",s.assay)("jobId",e)("expanded",s.expandAll||0==n)}}function Et(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"h3"),t._uU(2,"Rhythmicity tests"),t.qZA(),t._UZ(3,"hr"),t.TgZ(4,"div",1)(5,"div",2),t.YNc(6,jt,3,1,"div",0),t.YNc(7,Yt,2,0,"div",0),t.qZA(),t.TgZ(8,"div",3),t.YNc(9,Qt,2,2,"a",4),t.TgZ(10,"button",5),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.refresh())}),t._uU(11,"Refresh "),t.qZA()()(),t._UZ(12,"hr"),t.YNc(13,kt,2,3,"div",6),t._UZ(14,"hr"),t.qZA()}if(2&i){const e=t.oxw();t.xp6(6),t.Q6J("ngIf",e.jobs&&e.jobs.length>0),t.xp6(1),t.Q6J("ngIf",!e.jobs||0==e.jobs.length),t.xp6(2),t.Q6J("ngIf",e.assay.security.canWrite),t.xp6(1),t.Q6J("disabled",e.blocked),t.xp6(3),t.Q6J("ngForOf",e.jobsIds)}}let Bt=(()=>{class i extends Z{constructor(e,n){super(e,n),this.expandAll=!1,this.blocked=!1,this.titlePart=" Rhythm"}updateModel(e){super.updateModel(e),e&&this.loadJobs(e)}loadJobs(e,n=!1){this.blocked=!0,this.rhythmicityService.getJobs(e).subscribe(s=>{this.jobs=s,this.refreshJobsInfo(s),this.exportURL=this.rhythmicityService.exportURL(e),n&&this.refreshPanes(),this.blocked=!1},s=>{this.blocked=!1,this.feedback.error(s)})}refreshJobsInfo(e){this.jobsIds=e.map(n=>n.jobId)}refresh(){this.loadJobs(this.assay,!0)}refreshPanes(){this.panes&&this.panes.forEach(e=>e.refresh())}remove(e){const n=this.jobs.findIndex(s=>e.jobId===s.jobId);n>=0&&(this.jobs.splice(n,1),this.refreshJobsInfo(this.jobs))}refreshJob(e){const n=this.jobs.findIndex(s=>e.jobId===s.jobId);n>=0&&(this.jobs[n]=e,this.refreshJobsInfo(this.jobs))}calculateQueuing(e){return e.filter(n=>this.isQueueing(n.jobStatus.state)).length}isQueueing(e){switch(e){case"WAITING":case"PROCESSING":case"SUBMITTED":return!0;default:return!1}}checkFinished(e){return!!e.find(n=>this.isFinished(n.jobStatus.state))}isFinished(e){switch(e){case"SUCCESS":case"FINISHED":case"COMPLETED":return!0;default:return!1}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.o),t.Y36(b.L))},i.\u0275cmp=t.Xpm({type:i,selectors:[["ng-component"]],viewQuery:function(e,n){if(1&e&&t.Gf(S,5),2&e){let s;t.iGM(s=t.CRH())&&(n.panes=s)}},features:[t.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-body"],["class","btn btn-primary mr-1",3,"routerLink",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","click"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary","mr-1",3,"routerLink"],[3,"assay","jobId","expanded","deleted"]],template:function(e,n){1&e&&t.YNc(0,Et,15,5,"div",0),2&e&&t.Q6J("ngIf",n.assay)},dependencies:[h.sg,h.O5,_.rH,S],encapsulation:2}),i})();var I=r(7857),Ht=r(3620),Lt=r(5550),$t=r(930),Kt=r(4294),Gt=r(1882),y=r(4352),zt=r(114);function Vt(i,o){if(1&i&&(t.TgZ(0,"option",29),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.name),t.xp6(1),t.Oqu(e.label)}}function Wt(i,o){1&i&&(t.TgZ(0,"div",30)(1,"div",31),t._uU(2," Rhythmicity tests are generally used for short, sparse timeseries. "),t._UZ(3,"br"),t._uU(4," The current limit is 5 or 4 days of hourly sampled data for eJTK preset and BD2 preset respectivelly."),t._UZ(5,"br"),t._uU(6," Generally the raw data are being analysed, but we also enabled a linear detrended option. "),t.qZA()())}function Xt(i,o){if(1&i&&(t.TgZ(0,"option",29),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.name),t.xp6(1),t.Oqu(e.label)}}function te(i,o){1&i&&(t.TgZ(0,"div",30)(1,"div",31)(2,"p")(3,"b"),t._uU(4,"Classic JTK"),t.qZA(),t._uU(5," is the implementation of JTK_CYCLE from "),t.TgZ(6,"a",32),t._uU(7,"Michael E. Hughes et al. 2010"),t.qZA(),t._uU(8," a standard method for detecting rhythmicity in genome-scale datasets. "),t._UZ(9,"br"),t._uU(10,"The method is fast but it is reliable only when it tests against small set of patterns, we provide patterns of 24h cosines with different phases."),t.qZA(),t.TgZ(11,"p")(12,"b"),t._uU(13,"BD2 eJTK"),t.qZA(),t._uU(14," is the BioDare2 implementation of Empirical JTK_CYCLE with asymmetry search from "),t.TgZ(15,"a",33),t._uU(16,"Alan L. Hutchison et al. 2015"),t.qZA(),t._uU(17,". It is similar to the classic JTK method but with p values empirically calculated against set of random noise data. "),t._UZ(18,"br"),t._uU(19,"This modification permits using larger sets of test patterns and it provides better accuracy. However, this method is much slower so it can only analyze timeseries only up to 5 days of data (though the Classic JTK method was never intended to be used with such a long data)."),t.qZA()()())}function ee(i,o){if(1&i&&(t.TgZ(0,"option",29),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.name),t.xp6(1),t.Oqu(e.label)}}function ie(i,o){1&i&&(t.TgZ(0,"div",30)(1,"div",31),t._uU(2," Presets determine set of pattern curves against the comparison test is run."),t._UZ(3,"br"),t.TgZ(4,"ul")(5,"li"),t._uU(6,"Cosine 24h 1/2/4h are set of cosine curves of 24h periods, and phases spread every 1, 2, or 4 hours. To be used mainly with Classic JTK."),t.qZA(),t.TgZ(7,"li"),t._uU(8,"eJTK Classic is recommended for typical omics-like data for which eJTK method was developed. "),t._UZ(9,"br"),t._uU(10," It works well for short data (48h, 2h- 1h-sampled) when actual period is within range 22-26 hours."),t._UZ(11,"br"),t._uU(12," The patterns are series of cosine-like waveforms with 24h period, phases by 2hours and range of asymmetries by 2h (see original paper)."),t._UZ(13,"br"),t.qZA(),t.TgZ(14,"li"),t._uU(15,"BD2 Classic can detect non 24 periods and some forms of the spikes."),t._UZ(16,"br"),t._uU(17," As it compares against much more patterns it has a weaker power."),t._UZ(18,"br"),t._uU(19," It should be used when there is a good reason to suspect periods outside 22-26h range."),t._UZ(20,"br"),t._uU(21," The patterns are series of cosine-like waverforms with periods from 18-35hours, for each period there are multiple "),t.TgZ(22,"b"),t._uU(23,"circadian"),t.qZA(),t._uU(24," phases with step 2h (so each period value generates the same number of patterns but the peaks in absolute units do not coincide) and a range of assymetries by 2h in circadian units (see original paper). The preset contains also additional some spike patterns. "),t.qZA()()()())}const ne=function(){return[10,25,50,100,200]};let oe=(()=>{class i extends zt.P{constructor(e){super(e),this.methodOptions=l.RX,this.presetOptions=l.mM,this.dataHelp=!1,this.presetsHelp=!1,this.methodHelp=!1,this.rhythmicityRequests=new t.vpe,this.detrendingOptions=[y.QK.NO_DTR,y.QK.LIN_DTR],this.methodForm=this.mainForm.get("method"),this.presetForm=this.mainForm.get("preset")}buildMainForm(){return this.fb.group({displayParams:this.displayParamsForm,periodScale:this.fb.group({periodMin:[18,[c.kI.required]],periodMax:[34,[c.kI.required]]},{validator:n=>this.validPeriodScale(n.value)}),method:[l.v6.BD2EJTK.name,[c.kI.required]],preset:[l.Ah.EJTK_CLASSIC.name,[c.kI.required]]})}ngOnInit(){super.ngOnInit(),this.methodForm.valueChanges.subscribe(e=>this.setPresetOptions(e))}ngOnDestroy(){super.ngOnDestroy()}setPresetOptions(e){e===l.v6.BD2EJTK.name?(this.presetOptions=l.mM,this.presetForm.setValue(l.Ah.EJTK_CLASSIC.name)):e===l.v6.BD2JTK.name?(this.presetOptions=l.pd,this.presetForm.setValue(l.Ah.COS_2H.name)):this.presetOptions=[]}defaultDetrending(){return y.QK.NO_DTR.name}validPeriodScale(e){const n=e.periodMin,s=e.periodMax;return n<10?{validPeriodScale:"Period min must >= 10"}:s<10?{validPeriodScale:"Period max must >= 10"}:s>50?{validPeriodScale:"Period max must < 50"}:n>=s?{validPeriodScale:"Period min must be < max"}:null}analyse(){if(this.mainForm.invalid)return;const e=this.map2RhythmicityRequest(this.mainForm.value);e.isValid()&&this.rhythmicityRequests.next(e)}map2RhythmicityRequest(e){const n=new l.T9;return n.detrending=y.QK.get(e.displayParams.detrending),n.method=l.v6.get(e.method),n.preset=l.Ah.get(e.preset),n.periodMax=e.periodScale.periodMax,n.periodMin=e.periodScale.periodMin,n.windowEnd=e.displayParams.timeScale.timeEnd,n.windowStart=e.displayParams.timeScale.timeStart,n}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(c.QS))},i.\u0275cmp=t.Xpm({type:i,selectors:[["bd2-rhythmicityjob-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams",rhythmicityRequests:"rhythmicityRequests"},features:[t.qOj],decls:61,vars:15,consts:[["role","form",1,"form-horizontal",3,"formGroup"],["formGroupName","displayParams"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-sm-4"],["for","windowStart",1,"col-sm-1"],[1,"col-sm-2"],["formControlName","timeStart","id","windowStart","min","0","required","","size","5","step","any","type","number",1,"form-control"],["for","windowEnd",1,"col-sm-1"],["formControlName","timeEnd","id","windowEnd","min","0","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"form-group","row"],["for","detrending",1,"col-sm-4"],[3,"click"],[1,"material-icons","bd-icon","bd-primary"],[1,"col-sm-6"],["formControlName","detrending","id","detrending","required","",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["class","col-sm-12",4,"ngIf"],["for","method",1,"col-sm-4"],["formControlName","method","id","method","required","",1,"form-control"],["formControlName","preset","id","preset","required","",1,"form-control"],["formGroupName","periodScale",1,"form-group","row",3,"hidden"],["for","periodMin",1,"col-sm-1"],["formControlName","periodMin","id","periodMin","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],["for","periodMax",1,"col-sm-1"],["formControlName","periodMax","id","periodMax","max","50","min","10","placeholder","","required","","size","5","step","any","type","number",1,"form-control"],[1,"col-sm-8"],[3,"length","disabled","pageSize","pageIndex","pageSizeOptions","page"],["dataPaginator",""],["type","button",1,"btn","btn-primary",3,"disabled","click"],[3,"value"],[1,"col-sm-12"],["role","alert","type","info",1,"alert","alert-info"],["href","https://dx.doi.org/10.1177%2F0748730410379711"],["href"," https://doi.org/10.1371/journal.pcbi.1004094","target","_blank"]],template:function(e,n){1&e&&(t.TgZ(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),t._uU(4,"Data window"),t.qZA(),t.TgZ(5,"label",4),t._uU(6,"from:"),t.qZA(),t.TgZ(7,"div",5),t._UZ(8,"input",6),t.qZA(),t.TgZ(9,"label",7),t._uU(10,"to:"),t.qZA(),t.TgZ(11,"div",5),t._UZ(12,"input",8),t.qZA()(),t.TgZ(13,"div",9)(14,"label",10),t._uU(15,"Input Data "),t.TgZ(16,"a",11),t.NdJ("click",function(){return n.dataHelp=!n.dataHelp}),t.TgZ(17,"i",12),t._uU(18,"help"),t.qZA()()(),t.TgZ(19,"div",13)(20,"select",14),t.YNc(21,Vt,2,2,"option",15),t.qZA()()()(),t.YNc(22,Wt,7,0,"div",16),t.TgZ(23,"div",9)(24,"label",17),t._uU(25,"Test Method "),t.TgZ(26,"a",11),t.NdJ("click",function(){return n.methodHelp=!n.methodHelp}),t.TgZ(27,"i",12),t._uU(28,"help"),t.qZA()()(),t.TgZ(29,"div",13)(30,"select",18),t.YNc(31,Xt,2,2,"option",15),t.qZA()()(),t.YNc(32,te,20,0,"div",16),t.TgZ(33,"div",9)(34,"label",17),t._uU(35,"Analysis Presets "),t.TgZ(36,"a",11),t.NdJ("click",function(){return n.presetsHelp=!n.presetsHelp}),t.TgZ(37,"i",12),t._uU(38,"help"),t.qZA()()(),t.TgZ(39,"div",13)(40,"select",19),t.YNc(41,ee,2,2,"option",15),t.qZA()()(),t.YNc(42,ie,25,0,"div",16),t.TgZ(43,"div",20)(44,"label",3),t._uU(45,"Expected periods"),t.qZA(),t.TgZ(46,"label",21),t._uU(47,"from:"),t.qZA(),t.TgZ(48,"div",5),t._UZ(49,"input",22),t.qZA(),t.TgZ(50,"label",23),t._uU(51,"to:"),t.qZA(),t.TgZ(52,"div",5),t._UZ(53,"input",24),t.qZA()(),t.TgZ(54,"div",9),t._UZ(55,"label",5),t.TgZ(56,"div",25)(57,"mat-paginator",26,27),t.NdJ("page",function(a){return n.loadDataPage(a)}),t.qZA()()(),t.TgZ(59,"button",28),t.NdJ("click",function(){return n.analyse()}),t._uU(60,"Test Rhythmicity "),t.qZA()()),2&e&&(t.Q6J("formGroup",n.mainForm),t.xp6(21),t.Q6J("ngForOf",n.detrendingOptions),t.xp6(1),t.Q6J("ngIf",n.dataHelp),t.xp6(9),t.Q6J("ngForOf",n.methodOptions),t.xp6(1),t.Q6J("ngIf",n.methodHelp),t.xp6(9),t.Q6J("ngForOf",n.presetOptions),t.xp6(1),t.Q6J("ngIf",n.presetsHelp),t.xp6(1),t.Q6J("hidden",!0),t.xp6(14),t.Q6J("length",n.totalTraces)("disabled",n.disabledPagination)("pageSize",n.currentPage.pageSize)("pageIndex",n.currentPage.pageIndex)("pageSizeOptions",t.DdM(14,ne)),t.xp6(2),t.Q6J("disabled",n.disabled||n.mainForm.invalid))},dependencies:[h.sg,h.O5,c._Y,c.YN,c.Kr,c.Fj,c.wV,c.EJ,c.JJ,c.JL,c.Q7,c.qQ,c.Fd,c.sg,c.u,c.x0,g.NW],encapsulation:2}),i})();function se(i,o){if(1&i&&t._UZ(0,"bd2-ts-plots",3),2&i){const e=t.oxw(3);t.Q6J("data",e.timeseries)("tracesPerPlot",e.tracesPerPlot)}}function re(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"bd2-rhythmicityjob-params-rform",1),t.NdJ("displayParams",function(s){t.CHM(e);const a=t.oxw(2);return t.KtG(a.emitDisplayParams(s))})("rhythmicityRequests",function(s){t.CHM(e);const a=t.oxw(2);return t.KtG(a.doAnalysis(s))}),t.qZA(),t._UZ(2,"hr"),t.YNc(3,se,1,2,"bd2-ts-plots",2),t.qZA()}if(2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("disabled",e.blocked)("totalTraces",e.totalTraces)("currentPage",e.currentPage),t.xp6(2),t.Q6J("ngIf",e.timeseries)}}function ae(i,o){if(1&i&&(t.TgZ(0,"div")(1,"h3"),t._uU(2,"Start rhythmicity test"),t.qZA(),t._UZ(3,"hr"),t.YNc(4,re,4,4,"div",0),t.qZA()),2&i){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",!e.disabled)}}const ce=[{path:"",children:[{path:"new",component:(()=>{class i extends Z{constructor(e,n,s,a,d){super(a,d),this.fetcher=e,this.analytics=n,this.userService=s,this.disabled=!1,this.blocked=!1,this.tracesPerPlot=5,this.totalTraces=0,this.currentPage=Lt.U.firstPage(),this.titlePart=" New Test"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe((0,Ht.b)(1e3)).subscribe(e=>{const n=e.data;this.tracesPerPlot=Math.max(5,n.length/20),this.timeseries=n,this.totalTraces=e.totalTraces,this.currentPage=e.currentPage},e=>{console.log("Error in TS subscription: "+e),this.feedback.error(e)})}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}emitDisplayParams(e){this.fetcher.changeDisplayParams(e)}doAnalysis(e){e.isValid()&&(this.blocked=!0,this.rhythmicityService.newTest(this.assay,e).subscribe(n=>{this.feedback.success("Rhythmicity test submitted"),this.analytics.rhythmicityNew(e.method.name,this.assay.id,this.userService.currentUser.login),this.refreshModel(),this.goToRhythmicityHome()},n=>{this.blocked=!1,this.feedback.error(n)}))}updateModel(e){this.fetcher.experiment(e),super.updateModel(e)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(I.C),t.Y36($t.y),t.Y36(Kt.K),t.Y36(p.o),t.Y36(b.L))},i.\u0275cmp=t.Xpm({type:i,selectors:[["ng-component"]],features:[t._Bn([I.C]),t.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[3,"disabled","totalTraces","currentPage","displayParams","rhythmicityRequests"],[3,"data","tracesPerPlot",4,"ngIf"],[3,"data","tracesPerPlot"]],template:function(e,n){1&e&&t.YNc(0,ae,5,1,"div",0),2&e&&t.Q6J("ngIf",n.assay)},dependencies:[h.O5,Gt.x,oe],encapsulation:2}),i})()},{path:"",component:Bt,pathMatch:"full"}]}];let le=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[_.Bz.forChild(ce),_.Bz]}),i})();var he=r(8066),me=r(5394),de=r(8345);let pe=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[h.ez,c.u5,c.UX,he.i,me.G,de.O,le]}),i})()}}]);