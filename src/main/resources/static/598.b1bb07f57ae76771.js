"use strict";(self.webpackChunkbiodare2_ui=self.webpackChunkbiodare2_ui||[]).push([[598],{9598:(re,Z,r)=>{r.r(Z),r.d(Z,{ExperimentsModule:()=>se});var h=r(6814),m=r(1896),g=r(4900),S=r(2181),d=r(7398),P=r(8645),p=r(5619),y=r(2096),l=r(2572),L=r(3019),$=r(8180),b=r(3620),f=r(9397),J=r(6306),w=r(3997),M=r(4664);let D=(()=>{class i{constructor(t=!1){this.removeDebounce=t,this.error$=new P.x,this.isFetching$=new p.X(!1),this.isProcessing$=new p.X(!1),this.dataLength=0,this.page$=new p.X(void 0),this.sort$=new p.X(void 0),this.on$=new p.X(!1),this.refresh$=new P.x,this.input$=new p.X(void 0),this.params$=new p.X(void 0),this.asset$=new p.X(void 0),this.DEBUG=!1,this.dataInputsDebounce=10,this.assetInputsDebounce=200,this.busyDebounce=50,this.id=i.ids++,this.logMe("created"),this.initAssetsStream(),this.isBusy$=this.initBusyStream(),this.data$=this.initDataStream()}logMe(t,n){this.DEBUG&&(t=this.constructor.name+":"+this.id+" "+t,n?console.log(t,n):console.log(t))}input(t){t&&(this.input$.next(t),this.resetPage())}params(t){this.params$.next(t)}on(t=!0){this.on$.next(t)}refresh(){this.refresh$.next(!0)}page(t){this.page$.next(t)}sort(t){this.sort$.next(t),this.resetPage()}close(){this.asset$.complete(),this.error$.complete(),this.isFetching$.complete(),this.isProcessing$.complete(),this.input$.complete(),this.params$.complete(),this.on$.complete(),this.refresh$.complete(),this.page$.complete(),this.sort$.complete()}errorToData(t){return(0,y.of)(void 0)}assetToSort(t){}assetToPage(t){}resetPage(){this.page$.pipe((0,$.q)(1)).subscribe(t=>{if(t){const n=new g.kl;n.pageIndex=0,n.pageSize=t.pageSize,this.page(n)}})}initBusyStream(){return this.removeDebounce?(0,l.a)([this.isFetching$,this.isProcessing$]).pipe((0,d.U)(([t,n])=>t||n)):(0,l.a)([this.isFetching$,this.isProcessing$]).pipe((0,b.b)(this.busyDebounce),(0,d.U)(([t,n])=>t||n))}initDataStream(){const t=this.dataMutators();let n;return n=this.removeDebounce?(0,l.a)(t):(0,l.a)(t).pipe((0,b.b)(this.dataInputsDebounce)),n.pipe((0,f.b)(s=>this.logMe("Input for data stream",s)),(0,f.b)(s=>this.isProcessing$.next(!0)),(0,d.U)(([s,a])=>{const c=this.processData(s,a);return this.currentParams=a,this.currentData=c,c}),(0,J.K)(s=>(this.error$.next(s),this.errorToData(s))),(0,f.b)(s=>this.isProcessing$.next(!1)))}dataMutators(){return[this.asset$.pipe((0,S.h)(t=>!!t)),this.params$]}assetsMutators(){return[this.initAssetsInput(),this.sort$,this.page$.pipe((0,S.h)(n=>!!n))]}initAssetsStream(){const t=this.assetsMutators();let n;n=this.removeDebounce?(0,l.a)(t):(0,l.a)(t).pipe((0,b.b)(this.assetInputsDebounce)),n.pipe((0,f.b)(s=>this.logMe("Input for asset stream",s))).subscribe(([s,a,c])=>this.loadAsset(s,a,c),s=>this.error$.next(s))}loadAsset(t,n,s){this.isFetching$.next(!0),this.fetchAsset(t,n,s).subscribe(a=>{this.isFetching$.next(!1),this.setAsset(a,t,n,s)},a=>{this.isFetching$.next(!1),this.error$.next(a)})}setAsset(t,n,s,a){this.currentInput=n,this.currentAsset=t,this.currentSort=this.assetToSort(t)||s,this.currentPage=this.assetToPage(t)||a,this.dataLength=this.assetToDataLength(t),this.asset$.next(t)}initAssetsInput(){const n=(0,l.a)([this.input$,this.on$]).pipe((0,S.h)(([c,x])=>c&&x),(0,d.U)(([c,x])=>c)).pipe((0,w.x)((c,x)=>this.sameInput(c,x))),s=this.refresh$.pipe((0,M.w)(c=>n.pipe((0,$.q)(1))));return(0,L.T)(n,s).pipe((0,f.b)(c=>this.logMe("Assets input",c)))}}return i.ids=0,i})();var O=r(8172),e=r(5879),A=r(4403);let C=(()=>{class i extends D{constructor(t,n=!1){super(n),this.experimentService=t,this.experiment$=this.data$}fetchAsset(t,n,s){const a=(t.query||"").trim();return""===a?this.experimentService.getExperiments(t.showPublic,n,s):this.experimentService.searchExperiments(a,t.showPublic,n,s)}processData(t,n){return t.data}sameInput(t,n){return t.showPublic===n.showPublic&&t.query===n.query}assetToDataLength(t){return t.currentPage.length}assetToPage(t){return t.currentPage}errorToData(t){return(0,y.of)([])}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(A.$),e.LFG(O.I,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var _=r(1574),z=r(4294),I=r(3139);function q(i,o){1&i&&(e.TgZ(0,"i",5),e._uU(1,"lock_open"),e.qZA())}const Q=function(i){return["/experiment",i]};let N=(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-experiment-summary"]],inputs:{exp:"exp"},decls:24,vars:14,consts:[[1,"list-group-item","list-group-item-action",3,"routerLink"],[1,"list-group-item-heading"],["class","material-icons bd-icon","style","color: green",4,"ngIf"],[1,"list-group-item-text"],[1,"mb-1"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(t,n){1&t&&(e.TgZ(0,"a",0)(1,"h5",1),e.YNc(2,q,2,0,"i",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3)(5,"div",4),e._uU(6),e.qZA(),e.TgZ(7,"div")(8,"strong"),e._uU(9,"Authors:"),e.qZA(),e._uU(10),e.qZA(),e.TgZ(11,"div")(12,"small")(13,"strong"),e._uU(14,"Id:"),e.qZA(),e._uU(15),e.TgZ(16,"strong"),e._uU(17,"Executed:"),e.qZA(),e._uU(18),e.ALo(19,"date"),e.TgZ(20,"strong"),e._uU(21,"Modified:"),e.qZA(),e._uU(22),e.ALo(23,"date"),e.qZA()()()()),2&t&&(e.Q6J("routerLink",e.VKq(12,Q,n.exp.id)),e.xp6(2),e.Q6J("ngIf",n.exp.features.isOpenAccess),e.xp6(1),e.hij(" ",n.exp.name," "),e.xp6(3),e.Oqu(n.exp.generalDesc.purpose),e.xp6(4),e.hij(" ",n.exp.authors,""),e.xp6(5),e.hij(" ",n.exp.id," "),e.xp6(3),e.hij(" ",e.lcZ(19,8,n.exp.generalDesc.executionDate.date)," "),e.xp6(4),e.hij(" ",e.lcZ(23,10,n.exp.provenance.modified.date)," "))},dependencies:[h.O5,m.rH,h.uU],encapsulation:2}),i})();var u=r(6223),v=r(1075),T=r(146),U=r(1933);function Y(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"i",3),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.select("desc"))}),e._uU(1,"sort"),e.qZA()}}function k(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"i",4),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.select(""))}),e._uU(1,"sort"),e.qZA()}}function B(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"i",4),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.select("asc"))}),e._uU(1,"more_horiz"),e.qZA()}}const X={provide:u.JU,useExisting:(0,e.Gpc)(()=>E),multi:!0};let E=(()=>{class i{constructor(){this.value="",this.disabled=!1,this.onChange=t=>{},this.onTouched=()=>{}}ngOnInit(){}select(t){this.disabled||(this.value=t,this.onChange(this.value),this.onTouched())}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}writeValue(t){this.value=t}setDisabledState(t){this.disabled=t}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-sort-switch"]],features:[e._Bn([X])],decls:4,vars:4,consts:[["mat-mini-fab","","aria-label","sorting",3,"disabled"],["class","material-icons  icon-flipped-h",3,"click",4,"ngIf"],["class","material-icons",3,"click",4,"ngIf"],[1,"material-icons","icon-flipped-h",3,"click"],[1,"material-icons",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"button",0),e.YNc(1,Y,2,0,"i",1),e.YNc(2,k,2,0,"i",2),e.YNc(3,B,2,0,"i",2),e.qZA()),2&t&&(e.Q6J("disabled",n.disabled),e.xp6(1),e.Q6J("ngIf","asc"===n.value),e.xp6(1),e.Q6J("ngIf","desc"===n.value),e.xp6(1),e.Q6J("ngIf",""===n.value))},dependencies:[h.O5,v.lW],encapsulation:2}),i})(),G=(()=>{class i{set options(t){t&&(this.currentQuery=t.query,this.currentShowPublic=t.showPublic,this.currentSort=t.sorting)}constructor(t){this.fb=t,this.search=new e.vpe,this.sort=new e.vpe,this.currentSort={active:"id",direction:"asc"},this.currentQuery="",this.currentShowPublic=!1}ngOnInit(){this.sortOptionsF=this.fb.group({sorting:[this.currentSort.active],direction:[this.currentSort.direction]}),this.showPublicF=this.fb.control(this.currentShowPublic),this.queryF=this.fb.control(this.currentQuery,[u.kI.required,u.kI.minLength(3)]),this.sortOptionsF.valueChanges.subscribe(t=>this.updateSort(t.sorting,t.direction)),this.showPublicF.valueChanges.subscribe(t=>{this.currentShowPublic=t,this.emitSearch()})}updateSort(t,n){const s={active:t,direction:n};this.currentSort=s,this.sort.next(s)}emitSearch(){this.search.next({showPublic:this.currentShowPublic,query:this.currentQuery})}find(){this.queryF.valid&&(this.currentQuery=this.queryF.value,this.emitSearch())}all(){this.queryF.setValue(""),this.currentQuery="",this.emitSearch()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(u.QS))},i.\u0275cmp=e.Xpm({type:i,selectors:[["bd2-search-and-sort-panel"]],inputs:{options:"options"},outputs:{search:"search",sort:"sort"},decls:25,vars:4,consts:[[1,"pb-1","pt-1","searchpanel"],[1,"float-left",3,"formGroup"],["formControlName","direction",1,"mr-1"],["name","sorting","aria-label","sorting","formControlName","sorting",1,"mr-4"],["value","id"],["value","name"],["value","author"],["value","executed"],["value","modified"],[1,"mr-2",3,"formControl"],[1,"no-clues","float-right"],["name","search","minlength","3","placeholder","e.g. prr9 temp*",1,"form-control-sm","mr-1",3,"formControl","keydown.enter"],["mat-mini-fab","","mat-icon-button","","aria-label","search",1,"mr-2",3,"disabled","click"],[1,"material-icons"],["mat-mini-fab","","color","primary","aria-label","all",3,"click"],[1,"clearfix"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"small")(2,"div",1),e._UZ(3,"bd2-sort-switch",2),e.TgZ(4,"mat-button-toggle-group",3)(5,"mat-button-toggle",4),e._uU(6,"Id"),e.qZA(),e.TgZ(7,"mat-button-toggle",5),e._uU(8,"Title"),e.qZA(),e.TgZ(9,"mat-button-toggle",6),e._uU(10,"Author"),e.qZA(),e.TgZ(11,"mat-button-toggle",7),e._uU(12,"Exec."),e.qZA(),e.TgZ(13,"mat-button-toggle",8),e._uU(14,"Mod."),e.qZA()()(),e.TgZ(15,"mat-slide-toggle",9),e._uU(16,"Show public"),e.qZA(),e.TgZ(17,"div",10)(18,"input",11),e.NdJ("keydown.enter",function(){return n.find()}),e.qZA(),e.TgZ(19,"button",12),e.NdJ("click",function(){return n.find()}),e.TgZ(20,"i",13),e._uU(21,"search"),e.qZA()(),e.TgZ(22,"button",14),e.NdJ("click",function(){return n.all()}),e._uU(23,"all"),e.qZA()()(),e._UZ(24,"div",15),e.qZA()),2&t&&(e.xp6(2),e.Q6J("formGroup",n.sortOptionsF),e.xp6(13),e.Q6J("formControl",n.showPublicF),e.xp6(3),e.Q6J("formControl",n.queryF),e.xp6(1),e.Q6J("disabled",n.queryF.invalid))},dependencies:[u.Fj,u.JJ,u.JL,u.wO,u.oH,u.sg,u.u,v.lW,T.A9,T.Yi,U.Rr,E],encapsulation:2}),i})();function j(i,o){1&i&&(e.TgZ(0,"div",14),e._uU(1," There are no visible experiments matching the criteria. "),e.qZA())}function R(i,o){1&i&&e._UZ(0,"mat-progress-bar",15)}function H(i,o){1&i&&e._UZ(0,"bd2-experiment-summary",16),2&i&&e.Q6J("exp",o.$implicit)}const K=function(){return[]},V=function(i,o){return{pageIndex:i,pageSize:o}};function W(i,o){if(1&i&&(e.TgZ(0,"a",17),e._uU(1,"Next"),e.qZA()),2&i){const t=e.oxw();e.Q6J("routerLink",e.DdM(2,K))("queryParams",e.WLB(3,V,(null==t.fetcher.currentPage?null:t.fetcher.currentPage.pageIndex)+1,null==t.fetcher.currentPage?null:t.fetcher.currentPage.pageSize))}}const F=function(){return[10,25,50,100,200]},ee=[{path:"",children:[{path:"",component:(()=>{class i{constructor(t,n,s,a,c){this.experimentService=t,this.fetcher=n,this.feedback=s,this.userService=a,this.route=c}ngOnInit(){this.firstPage(),this.initialSearchOptions={sorting:{active:"modified",direction:"desc"},showPublic:!this.userService.isLoggedIn(),query:""},this.subscribeRoute(),this.fetcher.experiment$.subscribe(n=>this.experiments=n),this.fetcher.error$.subscribe(n=>this.feedback.error(n)),this.fetcher.on(!0),this.sort(this.initialSearchOptions.sorting),this.search(this.initialSearchOptions),this.page(this.firstPage())}ngOnDestroy(){this.routeSubscription&&this.routeSubscription.unsubscribe(),this.fetcher&&this.fetcher.close()}search(t){this.fetcher.input(t)}sort(t){this.fetcher.sort(t)}page(t){this.fetcher.page(t)}firstPage(){const t=+this.route.snapshot.queryParamMap.get("pageIndex")||0,n=+this.route.snapshot.queryParamMap.get("pageSize")||25,s=new g.kl;return s.pageIndex=t,s.pageSize=n,s}subscribeRoute(){this.routeSubscription=this.route.queryParamMap.pipe((0,S.h)(t=>t.has("pageIndex")&&t.has("pageSize")),(0,d.U)(t=>{const n=new g.kl;return n.pageSize=+t.get("pageSize"),n.pageIndex=+t.get("pageIndex"),n})).subscribe(t=>this.page(t))}refresh(){this.fetcher.refresh()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(A.$),e.Y36(C),e.Y36(_.T),e.Y36(z.K),e.Y36(m.gz))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ng-component"]],features:[e._Bn([C])],decls:20,vars:18,consts:[[1,"float-left"],["role","button","aria-label","refresh",3,"click"],[1,"material-icons","bd-icon-inh","bd-primary",2,"font-size","larger"],[1,"clearfix"],["class","alert alert-info",4,"ngIf"],[3,"options","search","sort"],[3,"length","pageSize","pageIndex","pageSizeOptions","page"],["paginator",""],["mode","indeterminate",4,"ngIf"],[1,"list-group"],[3,"exp",4,"ngFor","ngForOf"],[3,"hidden","length","pageSize","pageIndex","pageSizeOptions","page"],["paginator2",""],["style","color: rgba(0,0,0,.54);",3,"routerLink","queryParams",4,"ngIf"],[1,"alert","alert-info"],["mode","indeterminate"],[3,"exp"],[2,"color","rgba(0,0,0,.54)",3,"routerLink","queryParams"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div")(1,"h2",0),e._uU(2,"Experiments "),e.TgZ(3,"a",1),e.NdJ("click",function(){return n.refresh()}),e.TgZ(4,"i",2),e._uU(5,"refresh"),e.qZA()()(),e._UZ(6,"div",3),e.YNc(7,j,2,0,"div",4),e.TgZ(8,"div")(9,"bd2-search-and-sort-panel",5),e.NdJ("search",function(a){return n.search(a)})("sort",function(a){return n.sort(a)}),e.qZA(),e.TgZ(10,"mat-paginator",6,7),e.NdJ("page",function(a){return n.page(a)}),e.qZA(),e.YNc(12,R,1,0,"mat-progress-bar",8),e.ALo(13,"async"),e.TgZ(14,"div",9),e.YNc(15,H,1,1,"bd2-experiment-summary",10),e.qZA(),e.TgZ(16,"mat-paginator",11,12),e.NdJ("page",function(a){return n.page(a)}),e.qZA(),e.TgZ(18,"div",0),e.YNc(19,W,2,6,"a",13),e.qZA()()()),2&t){const s=e.MAs(11);e.xp6(7),e.Q6J("ngIf",!n.experiments||n.experiments.length<1),e.xp6(2),e.Q6J("options",n.initialSearchOptions),e.xp6(1),e.Q6J("length",n.fetcher.dataLength)("pageSize",(null==n.fetcher.currentPage?null:n.fetcher.currentPage.pageSize)||25)("pageIndex",null==n.fetcher.currentPage?null:n.fetcher.currentPage.pageIndex)("pageSizeOptions",e.DdM(16,F)),e.xp6(2),e.Q6J("ngIf",e.lcZ(13,14,n.fetcher.isBusy$)),e.xp6(3),e.Q6J("ngForOf",n.experiments),e.xp6(1),e.Q6J("hidden",(null==n.experiments?null:n.experiments.length)<1)("length",n.fetcher.dataLength)("pageSize",(null==n.fetcher.currentPage?null:n.fetcher.currentPage.pageSize)||25)("pageIndex",null==n.fetcher.currentPage?null:n.fetcher.currentPage.pageIndex)("pageSizeOptions",e.DdM(17,F)),e.xp6(3),e.Q6J("ngIf",s.hasNextPage())}},dependencies:[h.sg,h.O5,g.NW,I.pW,m.rH,N,G,h.Ov],encapsulation:2}),i})(),pathMatch:"full"}]}];let te=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[m.Bz.forChild(ee),m.Bz]}),i})();var ne=r(1690),ie=r(2396);let se=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.ez,u.u5,u.UX,v.ot,T.vV,U.rP,g.TU,ie.p0,I.Cv,ne.C,te]}),i})()}}]);