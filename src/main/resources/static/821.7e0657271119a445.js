"use strict";(self.webpackChunkbiodare2_ui=self.webpackChunkbiodare2_ui||[]).push([[821],{6738:(w,A,c)=>{c.d(A,{i:()=>C});var a=c(5619),d=c(5879);let g=1,C=(()=>{class v{constructor(){this.experimentStream=new a.X(null),this.id=g++}close(){this.experimentStream.complete()}experiment(){return this.experimentStream}push(e){this.experimentStream.next(e)}}return v.\u0275fac=function(e){return new(e||v)},v.\u0275prov=d.Yz7({token:v,factory:v.\u0275fac}),v})()},4621:(w,A,c)=>{c.d(A,{w:()=>v});var a=c(8782),d=c(2181),g=c(5879),C=c(6444);let v=(()=>{class _ extends a.X{constructor(l){super(),this.serviceDependencies=l,this.experimentService=l.experimentService,this.currentExperiment=l.currentExperiment,this.feedback=l.feedback,this.router=l.router,this.titleSetter=l.titleSetter,this.titlePart=""}ngOnInit(){this.subscribeToExperiment()}ngOnDestroy(){this.unsubscribeFromExperiment()}getModel(){return this.assay}updateModel(l){this.assay=l,this.setTitle()}setTitle(){this.titleSetter.setTitle("Exp "+this.assay.id+this.titlePart)}subscribeToExperiment(){this.expSubscription=this.currentExperiment.experiment().pipe((0,d.h)(l=>!!l)).subscribe(l=>{this.updateModel(l)},l=>this.feedback.error(l),()=>console.log(this.constructor.name+" expSubscription completed"))}refreshModel(){return this.experimentService.getExperiment(this.assay.id).then(l=>(this.currentExperiment.push(l),l))}unsubscribeFromExperiment(){this.expSubscription&&this.expSubscription.unsubscribe()}expHomePath(l){return["/experiment",l=l||this.assay.id]}goToExpHome(l){this.router.navigate(this.expHomePath(l))}goToExpEdit(l,Z){const h=this.expHomePath(l);h.push("edit"),Z?this.router.navigate(h,{fragment:Z}):this.router.navigate(h)}}return _.\u0275fac=function(l){return new(l||_)(g.Y36(C.L))},_.\u0275dir=g.lG2({type:_,features:[g.qOj]}),_})()},6444:(w,A,c)=>{c.d(A,{L:()=>e});var a=c(5879),d=c(4403),g=c(6738),C=c(1574),v=c(7521),_=c(1896);let e=(()=>{class l{constructor(h,f,F,m,p){this.experimentService=h,this.currentExperiment=f,this.feedback=F,this.titleSetter=m,this.router=p}}return l.\u0275fac=function(h){return new(h||l)(a.LFG(d.$),a.LFG(g.i),a.LFG(C.T),a.LFG(v.T),a.LFG(_.F0))},l.\u0275prov=a.Yz7({token:l,factory:l.\u0275fac}),l})()},821:(w,A,c)=>{c.r(A),c.d(A,{ExperimentModule:()=>ci});var a=c(6814),d=c(1896),g=c(2181),C=c(7398),v=c(6738),_=c(6444),e=c(5879),l=c(4403),Z=c(6753),h=c(1574),f=c(930),F=c(1009);const m=function(){return["edit"]},p=function(){return{exact:!0}};function T(n,i){1&n&&(e.TgZ(0,"a",6),e._uU(1,"Edit"),e.qZA()),2&n&&e.Q6J("routerLink",e.DdM(2,m))("routerLinkActiveOptions",e.DdM(3,p))}const E=function(){return[".","data","view","ts"]};function k(n,i){1&n&&(e.TgZ(0,"a",6),e._uU(1,"Show data"),e.qZA()),2&n&&e.Q6J("routerLink",e.DdM(2,E))("routerLinkActiveOptions",e.DdM(3,p))}const he=function(){return[".","data","view","heatmap"]};function ge(n,i){1&n&&(e.TgZ(0,"a",6),e._uU(1,"Heatmap"),e.qZA()),2&n&&e.Q6J("routerLink",e.DdM(2,he))("routerLinkActiveOptions",e.DdM(3,p))}const ve=function(){return["ppa/new"]};function xe(n,i){1&n&&(e.TgZ(0,"a",6),e._uU(1,"Period analysis"),e.qZA()),2&n&&e.Q6J("routerLink",e.DdM(2,ve))("routerLinkActiveOptions",e.DdM(3,p))}const Ce=function(){return["ppa"]},ne=function(){return{exact:!1}};function Te(n,i){1&n&&(e.TgZ(0,"a",6),e._uU(1,"Period analysis"),e.qZA()),2&n&&e.Q6J("routerLink",e.DdM(2,Ce))("routerLinkActiveOptions",e.DdM(3,ne))}const be=function(){return["rhythmicity"]};function Ae(n,i){1&n&&(e.TgZ(0,"a",6),e._uU(1,"Rhythmicity"),e.qZA()),2&n&&e.Q6J("routerLink",e.DdM(2,be))("routerLinkActiveOptions",e.DdM(3,ne))}const Ze=function(){return[".","data","ts-import"]};function Fe(n,i){if(1&n&&(e.TgZ(0,"a",6),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("routerLink",e.DdM(3,Ze))("routerLinkActiveOptions",e.DdM(4,p)),e.xp6(1),e.hij(" ",t.experiment.features.hasTSData?"Replace data":"Import data","")}}const ye=function(){return["publish"]};function Ee(n,i){1&n&&(e.TgZ(0,"a",6)(1,"i",8),e._uU(2,"lock_open"),e.qZA()()),2&n&&e.Q6J("routerLink",e.DdM(2,ye))("routerLinkActiveOptions",e.DdM(3,p))}const De=function(){return["/experiments"]},Me=function(){return["."]},we=function(){return["file"]};function qe(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",1)(1,"nav",2)(2,"a",3)(3,"i",4),e._uU(4,"fast_rewind"),e.qZA()(),e.TgZ(5,"a",5),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.back())}),e.TgZ(6,"i",4),e._uU(7,"arrow_left"),e.qZA()(),e.TgZ(8,"a",5),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.refresh())}),e.TgZ(9,"i",4),e._uU(10,"refresh"),e.qZA()(),e.TgZ(11,"a",6),e._uU(12,"Overview"),e.qZA(),e.YNc(13,T,2,4,"a",7),e.YNc(14,k,2,4,"a",7),e.YNc(15,ge,2,4,"a",7),e.YNc(16,xe,2,4,"a",7),e.YNc(17,Te,2,4,"a",7),e.YNc(18,Ae,2,4,"a",7),e.YNc(19,Fe,2,5,"a",7),e.TgZ(20,"a",6),e._uU(21,"Files"),e.qZA(),e.YNc(22,Ee,3,4,"a",7),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("routerLink",e.DdM(13,De)),e.xp6(9),e.Q6J("routerLink",e.DdM(14,Me))("routerLinkActiveOptions",e.DdM(15,p)),e.xp6(2),e.Q6J("ngIf",t.experiment.security.canWrite),e.xp6(1),e.Q6J("ngIf",t.experiment.features.hasTSData),e.xp6(1),e.Q6J("ngIf",t.experiment.features.hasTSData),e.xp6(1),e.Q6J("ngIf",t.experiment.security.canWrite&&t.experiment.features.hasTSData&&!t.experiment.features.hasPPAJobs),e.xp6(1),e.Q6J("ngIf",t.experiment.features.hasPPAJobs),e.xp6(1),e.Q6J("ngIf",t.experiment.security.canWrite&&t.experiment.features.hasTSData||t.experiment.features.hasRhythmicityJobs),e.xp6(1),e.Q6J("ngIf",t.experiment.security.canWrite),e.xp6(1),e.Q6J("routerLink",e.DdM(16,we))("routerLinkActiveOptions",e.DdM(17,p)),e.xp6(2),e.Q6J("ngIf",t.experiment.security.isOwner||t.experiment.security.isSuperOwner)}}let Ne=(()=>{class n{constructor(){this.onRefresh=new e.vpe}refresh(){this.onRefresh.emit(!0)}back(){window.history.back()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-experiment-navigation"]],inputs:{experiment:"experiment"},outputs:{onRefresh:"onRefresh"},features:[e._Bn([])],decls:1,vars:1,consts:[["style","margin-bottom: 2em;",4,"ngIf"],[2,"margin-bottom","2em"],[1,"secondary"],[3,"routerLink"],[1,"material-icons","bd-icon"],["role","button",1,"shade",3,"click"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions",4,"ngIf"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(t,o){1&t&&e.YNc(0,qe,23,18,"div",0),2&t&&e.Q6J("ngIf",o.experiment)},dependencies:[a.O5,d.rH,d.Od],encapsulation:2}),n})();function Ue(n,i){if(1&n&&(e.TgZ(0,"div",2)(1,"strong"),e._uU(2,"Open Access: "),e.qZA(),e._uU(3," under "),e.TgZ(4,"strong"),e._uU(5),e.qZA(),e._uU(6," license "),e.qZA()),2&n){const t=e.oxw(2);e.xp6(5),e.Oqu(t.model.features.licence)}}function Je(n,i){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.hij("",t.name,", ")}}function Ie(n,i){if(1&n&&(e.TgZ(0,"div",2)(1,"strong"),e._uU(2,"Authors: "),e.qZA(),e.YNc(3,Je,2,1,"span",5),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.model.contributionDesc.authors)}}function Se(n,i){if(1&n&&(e.TgZ(0,"div",1)(1,"div",2)(2,"strong"),e._uU(3,"Purpose: "),e.qZA(),e._uU(4),e.qZA(),e.YNc(5,Ue,7,1,"div",3),e.YNc(6,Ie,4,1,"div",3),e.TgZ(7,"div",4)(8,"strong"),e._uU(9,"Data category: "),e.qZA(),e._uU(10),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.hij(" ",t.model.generalDesc.purpose," "),e.xp6(1),e.Q6J("ngIf",t.model.features.isOpenAccess),e.xp6(1),e.Q6J("ngIf",t.model.contributionDesc.authors),e.xp6(4),e.hij(" ",null==t.model.dataCategory?null:t.model.dataCategory.longName," ")}}let Oe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-experiment-basic-info-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[["class","summary-box",4,"ngIf"],[1,"summary-box"],[1,"item"],["class","item",4,"ngIf"],[1,"item","item-last"],[4,"ngFor","ngForOf"]],template:function(t,o){1&t&&e.YNc(0,Se,11,4,"div",0),2&t&&e.Q6J("ngIf",o.model)},dependencies:[a.sg,a.O5],encapsulation:2}),n})();function Qe(n,i){1&n&&(e.TgZ(0,"i",7),e._uU(1,"lock_open"),e.qZA())}function ke(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"h3"),e.YNc(4,Qe,2,0,"i",3),e._uU(5),e._UZ(6,"br"),e.TgZ(7,"small"),e._uU(8),e.qZA()()(),e.TgZ(9,"div",4),e._UZ(10,"bd2-experiment-basic-info-view",5),e.qZA()(),e.TgZ(11,"bd2-experiment-navigation",6),e.NdJ("onRefresh",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.refresh())}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(4),e.Q6J("ngIf",t.model.features.isOpenAccess),e.xp6(1),e.hij(" Experiment: ",t.model.id,""),e.xp6(3),e.Oqu(t.model.name),e.xp6(2),e.Q6J("model",t.model),e.xp6(1),e.Q6J("experiment",t.model)}}function Ye(n,i){1&n&&(e.TgZ(0,"div"),e._uU(1," ... loading experiment "),e.TgZ(2,"p"),e._uU(3,"If just logged in try to refresh the window if the experiment is not loading."),e.qZA()())}function Ge(n,i){1&n&&(e.TgZ(0,"div")(1,"h4"),e._uU(2,"You don't have sufficient permissions to see the experiment"),e.qZA(),e.TgZ(3,"p"),e._uU(4,"Try to login"),e.qZA()())}let Pe=(()=>{class n{constructor(t,o,s,r,b,X,q,Q){this.experimentService=t,this.RDMSocial=o,this.currentExperiment=s,this.feedback=r,this.analytics=b,this.route=X,this.router=q,this.dialogs=Q,this.isUnauthorised=!1}ngOnInit(){this.expSubscription=this.currentExperiment.experiment().pipe((0,g.h)(t=>!!t)).subscribe(t=>{this.model=t,this.analytics.experimentView(t.id),this.RDMSocial.shouldShowMeasurementWarning(t).then(o=>{o&&this.showMetadataWarning()})},t=>this.feedback.error(t),()=>console.log("currentExperimentStream completed")),this.paramsSubscription=this.route.paramMap.pipe((0,C.U)(t=>t.get("id")),(0,g.h)(t=>!!t)).subscribe(t=>this.loadExperiment(+t))}ngOnDestroy(){this.paramsSubscription&&this.paramsSubscription.unsubscribe(),this.expSubscription&&this.expSubscription.unsubscribe(),this.currentExperiment&&this.currentExperiment.close()}refresh(){this.model&&this.loadExperiment(this.model.id)}loadExperiment(t){this.experimentService.getExperiment(t).then(o=>{this.currentExperiment.push(o),this.isUnauthorised=!1}).catch(o=>{this.isUnauthorised=o.isUnauthorised,this.feedback.error(o)})}handleWarningResponse(t){console.log("Dialog: "+t)}showMetadataWarning(){this.dialogs.confirm("Metadata reminder","\n        <p>\n        Please add measurements details, like technique, equipment and short description.\n        </p>\n        <p>\n        It will improve the metadata quality and it will help you when searching for the data.\n        </p>\n","Not now").subscribe(t=>{this.RDMSocial.registerMeasurementWarning(this.model),t&&this.router.navigate(["edit"],{relativeTo:this.route,fragment:"MeasurementSection"})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(l.$),e.Y36(Z.C),e.Y36(v.i),e.Y36(h.T),e.Y36(f.y),e.Y36(d.gz),e.Y36(d.F0),e.Y36(F.d))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],features:[e._Bn([v.i,_.L])],decls:5,vars:3,consts:[[4,"ngIf"],[1,"card","asset-card"],[1,"card-header"],["class","material-icons bd-icon","style","color: green; font-size: 1.5em;",4,"ngIf"],[1,"card-body"],[3,"model"],[3,"experiment","onRefresh"],[1,"material-icons","bd-icon",2,"color","green","font-size","1.5em"]],template:function(t,o){1&t&&(e.TgZ(0,"div"),e.YNc(1,ke,12,5,"div",0),e.YNc(2,Ye,4,0,"div",0),e.YNc(3,Ge,5,0,"div",0),e._UZ(4,"router-outlet"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.model),e.xp6(1),e.Q6J("ngIf",!o.model&&!o.isUnauthorised),e.xp6(1),e.Q6J("ngIf",!o.model&&o.isUnauthorised))},dependencies:[a.O5,d.lC,Ne,Oe],encapsulation:2}),n})();var U=c(4621);function Le(n,i){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Description"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(5),e.Oqu(t.model.description)}}function Be(n,i){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Comments"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(5),e.Oqu(t.model.comments)}}function Re(n,i){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Execution date"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"date"),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(5),e.Oqu(e.lcZ(6,1,t.model.executionDate.date))}}function Ke(n,i){if(1&n&&(e.TgZ(0,"div")(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"div"),e._UZ(4,"hr"),e.TgZ(5,"strong"),e._uU(6,"Purpose/Hypothesis"),e.qZA(),e.TgZ(7,"div"),e._uU(8),e.qZA()(),e.YNc(9,Le,6,1,"div",0),e.YNc(10,Be,6,1,"div",0),e.YNc(11,Re,7,3,"div",0),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Oqu(t.model.name),e.xp6(6),e.Oqu(t.model.purpose),e.xp6(1),e.Q6J("ngIf",t.model.description),e.xp6(1),e.Q6J("ngIf",t.model.comments),e.xp6(1),e.Q6J("ngIf",t.model.executionDate)}}let Y=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-general-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(t,o){1&t&&e.YNc(0,Ke,12,5,"div",0),2&t&&e.Q6J("ngIf",o.model)},dependencies:[a.O5,a.uU],encapsulation:2}),n})();function Ve(n,i){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.hij("",t.name,", ")}}function He(n,i){if(1&n&&(e.TgZ(0,"h4"),e.YNc(1,Ve,2,1,"span",1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.model.authors)}}function We(n,i){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.hij("",t.name,", ")}}function ze(n,i){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Data curators: "),e.qZA(),e.YNc(4,We,2,1,"span",1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("ngForOf",t.model.curators)}}function je(n,i){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.hij("",t.name,", ")}}function Xe(n,i){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.hij("",t.name,", ")}}function $e(n,i){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"strong"),e._uU(3,"Institutions/Fundings: "),e.qZA(),e.YNc(4,je,2,1,"span",1),e.YNc(5,Xe,2,1,"span",1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("ngForOf",t.model.institutions),e.xp6(1),e.Q6J("ngForOf",t.model.fundings)}}function et(n,i){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,He,2,1,"h4",0),e.YNc(2,ze,5,1,"div",0),e.YNc(3,$e,6,2,"div",0),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.model.authors.length>0),e.xp6(1),e.Q6J("ngIf",t.model.curators.length>0),e.xp6(1),e.Q6J("ngIf",t.model.institutions.length>0||t.model.fundings.length>0)}}let G=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-contr-desc-view"]],inputs:{model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(t,o){1&t&&e.YNc(0,et,4,3,"div",0),2&t&&e.Q6J("ngIf",o.model)},dependencies:[a.sg,a.O5],encapsulation:2}),n})();function tt(n,i){if(1&n&&(e.TgZ(0,"div")(1,"p")(2,"strong"),e._uU(3,"Species: "),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"p")(6,"strong"),e._uU(7,"Data category: "),e.qZA(),e._uU(8),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.hij(" ",t.model.species," "),e.xp6(4),e.hij(" ",null==t.model.dataCategory?null:t.model.dataCategory.longName," ")}}let P=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-simple-bio-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(t,o){1&t&&e.YNc(0,tt,9,2,"div",0),2&t&&e.Q6J("ngIf",o.model)},dependencies:[a.O5],encapsulation:2}),n})();function nt(n,i){if(1&n&&(e.TgZ(0,"div")(1,"strong"),e._uU(2,"Details"),e.qZA(),e.TgZ(3,"div"),e._uU(4),e.qZA()()),2&n){const t=e.oxw(3);e.xp6(4),e.Oqu(t.model.description)}}function it(n,i){if(1&n&&(e.TgZ(0,"div")(1,"strong"),e._uU(2,"Technique:"),e.qZA(),e._uU(3),e.YNc(4,nt,5,1,"div",0),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.AsE(" ",t.model.technique," ",t.model.equipment?"("+t.model.equipment+")":""," "),e.xp6(1),e.Q6J("ngIf",t.model.description)}}function ot(n,i){1&n&&(e.TgZ(0,"div"),e._uU(1," Unspecified "),e.qZA())}function st(n,i){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,it,5,3,"div",0),e.YNc(2,ot,2,0,"div",0),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.model.technique),e.xp6(1),e.Q6J("ngIf",!t.model.technique)}}let L=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-measurement-desc-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(t,o){1&t&&e.YNc(0,st,3,2,"div",0),2&t&&e.Q6J("ngIf",o.model)},dependencies:[a.O5],encapsulation:2}),n})();function rt(n,i){if(1&n&&(e.TgZ(0,"div")(1,"h3"),e._uU(2,"Overview of experimental details"),e.qZA(),e.TgZ(3,"div",1)(4,"div",2),e._uU(5,"General description"),e.qZA(),e.TgZ(6,"div",3),e._UZ(7,"bd2-general-desc-view",4),e.qZA()(),e.TgZ(8,"div",1)(9,"div",2),e._uU(10,"Contributions"),e.qZA(),e.TgZ(11,"div",3),e._UZ(12,"bd2-contr-desc-view",4),e.qZA()(),e.TgZ(13,"div",1)(14,"div",2),e._uU(15,"Biological details"),e.qZA(),e.TgZ(16,"div",3),e._UZ(17,"bd2-simple-bio-desc-view",4),e.qZA()(),e.TgZ(18,"div",1)(19,"div",2),e._uU(20,"Measurement details"),e.qZA(),e.TgZ(21,"div",3),e._UZ(22,"bd2-measurement-desc-view",4),e.qZA()()()),2&n){const t=e.oxw();e.xp6(7),e.Q6J("model",t.assay.generalDesc),e.xp6(5),e.Q6J("model",t.assay.contributionDesc),e.xp6(5),e.Q6J("model",t.assay),e.xp6(5),e.Q6J("model",t.assay.experimentalDetails.measurementDesc)}}let at=(()=>{class n extends U.w{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.L))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],features:[e._Bn([]),e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"model"]],template:function(t,o){1&t&&e.YNc(0,rt,23,4,"div",0),2&t&&e.Q6J("ngIf",o.assay)},dependencies:[a.O5,Y,G,P,L],encapsulation:2}),n})();class J{validate(i){const t=[];return i?((!i.name||""==i.name.trim())&&t.push("Non empty name is required"),(!i.purpose||""==i.purpose.trim())&&t.push("Purpose is required"),i.purpose&&i.purpose.trim().length<20&&t.push("Purpose is too short"),t):["General description cannot be empty"]}GeneralDescValidator(){}}J.INSTANCE=new J;class I{validate(i){return i?i.authors.length<1?["At least one author is required"]:[]:["Contribution cannot be empty"]}ContributionDescValidator(){}}I.INSTANCE=new I;class B{constructor(){}validate(i){const t=[];return i?((!i.species||""==i.species.trim())&&t.push("Non empty species is required"),(!i.dataCategory||"NONE"==i.dataCategory.name)&&t.push("Data category is required"),t):["Cannot validate null object"]}}B.INSTANCE=new B;class S{constructor(){this.generalV=J.INSTANCE,this.contribV=I.INSTANCE,this.bioV=B.INSTANCE}validate(i){let t=[];return t=t.concat(this.generalV.validate(i.generalDesc),this.contribV.validate(i.contributionDesc),this.bioV.validate(i)),t}}S.INSTANCE=new S;var R=c(8782);class ie extends R.X{constructor(i){super(i),this.onAccepted=new e.vpe,this.onCancelled=new e.vpe}cancel(){this.clearErrors(),this.onCancelled.emit(!0)}save(){this._orgModel&&this.triggerValidation()&&(this._orgModel.setAll(this._model),this.onAccepted.emit(this._orgModel))}getModel(){return this._model}setModel(i){this._orgModel=i,i&&(this._model=i.clone())}}class ct{constructor(i){this.text=i||"",this.nextPosition=0,this.limit=this.text.length,this.currentWorld=""}next(){if(this.nextPosition>=this.limit)return"";for(;this.nextPosition<this.limit;this.nextPosition++){const i=this.text.charAt(this.nextPosition);if(" "===i||"\t"===i||"\n"===i){if(this.currentWorld){const t=this.currentWorld.toLowerCase();return this.currentWorld="",t}}else{if("."===i||","===i||":"===i||"'"===i)continue;this.currentWorld=this.currentWorld+i}}return this.currentWorld.toLowerCase()}}class M{static initBannedWords(){const i=new Set;return i.add("sensible"),i.add("description"),i.add("with"),i.add("more"),i.add("words"),i.add("required"),i.add("purpose"),i.add("hypothesis"),i}static removeLetterChain(i){if(!i)return"";const t=i.length;let o=i.charAt(0),s=i.charAt(0);for(let r=1;r<t;r++){const b=i.charAt(r);b!==s&&(s=b,o+=b)}return o}static removePairChain(i){if(!i)return"";if(i.length<4)return i;const t=i.length-1;let o=i.substring(0,2),s=o,r=2;for(;r<t;){const b=i.substring(r,r+2);b!==s?(s=s.charAt(1)+b.charAt(0),o+=b.charAt(0),r++):r+=2}return r==t&&(o+=i.charAt(i.length-1)),o}static simplifyWorld(i){let t=M.removeLetterChain(i);return t=M.removePairChain(t),t}static countDistinctCharacters(i){if(!i)return 0;const t=new Set;for(let o=0;o<i.length;o++)t.add(i.charAt(o));return t.size}static isSensibleWorld(i){if(!i||i.length>6&&M.countDistinctCharacters(i)<=4||M.bannedWords.has(i))return!1;const t=M.simplifyWorld(i);let o=4;return 4===i.length&&(o=3),i.length>10&&(o=.6*i.length),t.length>=o}}M.bannedWords=M.initBannedWords();class lt{constructor(i){this.minWords=5,this.previouslyValid="",this.minWords=i||5}validateText(i){if(i&&this.previouslyValid&&i.startsWith(this.previouslyValid))return null;const t=this.countWords(i,this.minWords);return t<this.minWords?{minWords:"required "+this.minWords+" found: "+t}:(this.previouslyValid=i,null)}countWords(i,t){const o=new ct(i),s=new Set;for(let r=o.next();r&&s.size<t;r=o.next())M.isSensibleWorld(r)&&s.add(r);return s.size}}var oe=c(8790),u=c(6223),K=c(4378),y=c(6005),V=c(9548);function dt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"form",null,1)(3,"div",2)(4,"mat-form-field",3)(5,"mat-label",4),e._uU(6,"Name"),e.qZA(),e.TgZ(7,"input",5,6),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.model.name=s)}),e.qZA(),e.TgZ(9,"mat-hint"),e._uU(10,"Good name hints the data content"),e.qZA(),e.TgZ(11,"mat-error"),e._uU(12,"Descriptive name is required"),e.qZA()()(),e.TgZ(13,"div",2)(14,"mat-form-field",3)(15,"mat-label",7),e._uU(16,"Purpose/Hypothesis"),e.qZA(),e.TgZ(17,"textarea",8,9),e.NdJ("input",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.checkPurpose())})("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.model.purpose=s)}),e._uU(19,"                   "),e.qZA(),e.TgZ(20,"mat-hint"),e._uU(21,"Sensible description with more than few words is required"),e.qZA()()(),e.TgZ(22,"div",2)(23,"mat-form-field",3)(24,"mat-label",10),e._uU(25,"Description"),e.qZA(),e.TgZ(26,"textarea",11,12),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.model.description=s)}),e._uU(28,"                 "),e.qZA()()(),e.TgZ(29,"div",2)(30,"mat-form-field",3)(31,"mat-label",13),e._uU(32,"Comments"),e.qZA(),e.TgZ(33,"textarea",14,15),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.model.comments=s)}),e._uU(35,"                "),e.qZA()()(),e.TgZ(36,"div",2)(37,"mat-form-field")(38,"input",16,17),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.executionDate=s)}),e.qZA(),e._UZ(40,"mat-datepicker-toggle",18)(41,"mat-datepicker",null,19),e.TgZ(43,"mat-error"),e._uU(44,"Date is required and cannot be much in the future"),e.qZA()(),e._UZ(45,"br"),e.qZA(),e.TgZ(46,"button",20),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.save())}),e._uU(47),e.qZA(),e.TgZ(48,"button",21),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.cancel())}),e._uU(49,"Cancel"),e.qZA()()()}if(2&n){const t=e.MAs(2),o=e.MAs(18),s=e.MAs(42),r=e.oxw();e.xp6(7),e.Q6J("ngModel",r.model.name),e.xp6(10),e.Q6J("ngModel",r.model.purpose),e.xp6(3),e.Udp("color",r.sufficientPurpose||o.pristine?"":"red"),e.xp6(6),e.Q6J("ngModel",r.model.description),e.xp6(7),e.Q6J("ngModel",r.model.comments),e.xp6(5),e.Q6J("matDatepicker",s)("ngModel",r.executionDate)("max",r.maxDate)("min",r.minDate),e.xp6(2),e.Q6J("for",s),e.xp6(6),e.Q6J("disabled",r.blocked||!t.form.valid||!r.sufficientPurpose),e.xp6(1),e.Oqu(r.okLabel)}}let se=(()=>{class n extends ie{constructor(){super(J.INSTANCE),this.okLabel="Save",this.sufficientPurpose=!1,this.purposeWorldValidator=new lt(5),this.maxDate=new Date,this.maxDate.setDate(this.maxDate.getDate()+21),this.minDate=new Date,this.minDate.setFullYear(this.minDate.getFullYear()-10)}get model(){return this._model}set model(t){this.setModel(t),this.executionDate=t.executionDate.date,this.checkPurpose()}checkPurpose(){this.sufficientPurpose=null===this.purposeWorldValidator.validateText(this.model.purpose)}save(){this.model.executionDate=oe.h.fromDate(this.executionDate),super.save()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-general-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["gDescForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","gName"],["matInput","","id","gName","maxlength","100","minlength","6","name","gName","placeholder","e.g. Testing robustness in low light (E12)","required","","type","text",1,"",3,"ngModel","ngModelChange"],["gName","ngModel"],["for","gPurpose"],["matInput","","id","gPurpose","minlength","55","name","gPurpose","placeholder","Describe the main aim of the experiment. What you tried to achieve, test, verify, on what kind of samples.","required","","rows","4","type","text",1,"",3,"ngModel","input","ngModelChange"],["gPurpose","ngModel"],["for","gDescription"],["matInput","","id","gDescription","name","gDescription","placeholder","Describe how the experiment was conducted, what environmental conditions, sampling procedure.\nFor example: seedlings were exposed to short day light regime (LD 6:18) at two temperatures 15 and 25. Samples where harvested every 4 hours for 3 days and the genes levels measured with RT PCR","rows","5","type","text",1,"",3,"ngModel","ngModelChange"],["gDescription","ngModel"],["for","gComments"],["matInput","","id","gComments","name","gComments","placeholder","Optional remarks, for example technical issues during the experiment, discrepancies/simplifications of in the following sections","type","text",1,"",3,"ngModel","ngModelChange"],["gComments","ngModel"],["matInput","","name","executionDate","placeholder","Exp. execution date","required","",3,"matDatepicker","ngModel","max","min","ngModelChange"],["gDate","ngModel"],["matSuffix","",3,"for"],["picker",""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(t,o){1&t&&e.YNc(0,dt,50,13,"div",0),2&t&&e.Q6J("ngIf",o.model)},dependencies:[a.O5,u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.wO,u.nD,u.On,u.F,K.Mq,K.hl,K.nW,y.TO,y.KE,y.bx,y.hX,y.R9,V.Nt],encapsulation:2}),n})();var mt=c(4866),re=c(1779),ut=c(2029),N=c(1344),H=c(4002),pt=c(4692),_t=c(2468),ae=c(7452);const ft=["persForm"],ht=["instForm"],gt=["fundForm"];function vt(n,i){if(1&n&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.Oqu(t)}}function xt(n,i){if(1&n&&(e.TgZ(0,"div",35)(1,"ul",36),e.YNc(2,vt,2,1,"li",37),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.errors)}}function Ct(n,i){1&n&&(e.TgZ(0,"p"),e._uU(1,"Please add an author"),e.qZA())}function Tt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"mat-chip",38),e.NdJ("removed",function(){const r=e.CHM(t).$implicit,b=e.oxw(2);return e.KtG(b.removeAuthor(r))}),e._uU(1),e.TgZ(2,"mat-icon",39),e._uU(3,"cancel"),e.qZA()()}if(2&n){const t=i.$implicit;e.xp6(1),e.hij(" ",t.name," ")}}function bt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"mat-chip",38),e.NdJ("removed",function(){const r=e.CHM(t).$implicit,b=e.oxw(3);return e.KtG(b.removeCurator(r))}),e._uU(1),e.TgZ(2,"mat-icon",39),e._uU(3,"cancel"),e.qZA()()}if(2&n){const t=i.$implicit;e.xp6(1),e.hij(" ",t.name," ")}}function At(n,i){if(1&n&&(e.TgZ(0,"div",2)(1,"label")(2,"strong"),e._uU(3,"Data curators"),e.qZA()(),e.TgZ(4,"mat-chip-list"),e.YNc(5,bt,4,1,"mat-chip",3),e.qZA(),e._UZ(6,"mat-divider",4),e.qZA()),2&n){const t=e.oxw(2);e.xp6(5),e.Q6J("ngForOf",t.model.curators)}}function Zt(n,i){1&n&&(e.TgZ(0,"p"),e._uU(1,"Please add an institution"),e.qZA())}function Ft(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"mat-chip",38),e.NdJ("removed",function(){const r=e.CHM(t).$implicit,b=e.oxw(2);return e.KtG(b.removeInstitution(r))}),e._uU(1),e.TgZ(2,"mat-icon",39),e._uU(3,"cancel"),e.qZA()()}if(2&n){const t=i.$implicit;e.xp6(1),e.hij(" ",t.name," ")}}function yt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"mat-chip",38),e.NdJ("removed",function(){const r=e.CHM(t).$implicit,b=e.oxw(3);return e.KtG(b.removeFunding(r))}),e._uU(1),e.TgZ(2,"mat-icon",39),e._uU(3,"cancel"),e.qZA()()}if(2&n){const t=i.$implicit;e.xp6(1),e.hij(" ",t.name," ")}}function Et(n,i){if(1&n&&(e.TgZ(0,"div",2)(1,"label")(2,"strong"),e._uU(3,"Fundings"),e.qZA()(),e.TgZ(4,"mat-chip-list"),e.YNc(5,yt,4,1,"mat-chip",3),e.qZA(),e._UZ(6,"mat-divider",4),e.qZA()),2&n){const t=e.oxw(2);e.xp6(5),e.Q6J("ngForOf",t.model.fundings)}}function Dt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e.YNc(1,xt,3,1,"div",1),e.TgZ(2,"mat-card")(3,"mat-card-content")(4,"div",2)(5,"label")(6,"strong"),e._uU(7,"Authors"),e.qZA()(),e.YNc(8,Ct,2,0,"p",0),e.TgZ(9,"mat-chip-list"),e.YNc(10,Tt,4,1,"mat-chip",3),e.qZA(),e._UZ(11,"mat-divider",4),e.qZA(),e.YNc(12,At,7,1,"div",5),e.TgZ(13,"form",6,7)(15,"div",8)(16,"mat-form-field")(17,"mat-label",9),e._uU(18,"Name"),e.qZA(),e.TgZ(19,"input",10,11),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.firstName=s)}),e.qZA()()(),e.TgZ(21,"div",2)(22,"mat-form-field")(23,"mat-label",12),e._uU(24,"Surname"),e.qZA(),e.TgZ(25,"input",13,14),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.lastName=s)}),e.qZA()()(),e.TgZ(27,"button",15),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.addAuthor())}),e._uU(28,"New Author "),e.qZA(),e.TgZ(29,"button",16),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.addCurator())}),e._uU(30,"New Curator "),e.qZA()()()(),e._UZ(31,"mat-divider",17),e.TgZ(32,"mat-card")(33,"mat-card-content")(34,"div",2)(35,"label")(36,"strong"),e._uU(37,"Institutions"),e.qZA()(),e.YNc(38,Zt,2,0,"p",0),e.TgZ(39,"mat-chip-list"),e.YNc(40,Ft,4,1,"mat-chip",3),e.qZA(),e._UZ(41,"mat-divider",4),e.qZA(),e.TgZ(42,"form",6,18)(44,"div",2)(45,"mat-form-field")(46,"mat-label",19),e._uU(47,"Institution"),e.qZA(),e.TgZ(48,"input",20,21),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.institutionName=s)}),e.qZA()()(),e.TgZ(50,"button",22),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.addInstitution())}),e._uU(51," Add Institution "),e.qZA(),e._UZ(52,"mat-divider",23),e.qZA(),e.YNc(53,Et,7,1,"div",5),e.TgZ(54,"form",6,24)(56,"div",2)(57,"mat-form-field",25)(58,"mat-label",26),e._uU(59,"Funder"),e.qZA(),e.TgZ(60,"input",27,28),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.funderName=s)}),e.qZA()()(),e.TgZ(62,"div",2)(63,"mat-form-field")(64,"mat-label",29),e._uU(65,"Grant"),e.qZA(),e.TgZ(66,"input",30,31),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.grantNr=s)}),e.qZA()()(),e.TgZ(68,"button",22),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.addFunding())}),e._uU(69," Add Funding "),e.qZA()()()(),e.TgZ(70,"div",32)(71,"button",33),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.save())}),e._uU(72),e.qZA(),e.TgZ(73,"button",34),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.cancel())}),e._uU(74,"Cancel"),e.qZA()()()}if(2&n){const t=e.MAs(14),o=e.MAs(43),s=e.MAs(55),r=e.oxw();e.xp6(1),e.Q6J("ngIf",r.errors),e.xp6(7),e.Q6J("ngIf",!r.model.authors||r.model.authors.length<1),e.xp6(2),e.Q6J("ngForOf",r.model.authors),e.xp6(2),e.Q6J("ngIf",r.model.curators.length>0),e.xp6(7),e.Q6J("ngModel",r.firstName),e.xp6(6),e.Q6J("ngModel",r.lastName),e.xp6(2),e.Q6J("disabled",!t.form.valid),e.xp6(2),e.Q6J("disabled",!t.form.valid),e.xp6(9),e.Q6J("ngIf",!r.model.institutions||r.model.institutions.length<1),e.xp6(2),e.Q6J("ngForOf",r.model.institutions),e.xp6(8),e.Q6J("ngModel",r.institutionName),e.xp6(2),e.Q6J("disabled",!o.form.valid),e.xp6(3),e.Q6J("ngIf",r.model.fundings.length>0),e.xp6(7),e.Q6J("ngModel",r.funderName),e.xp6(6),e.Q6J("ngModel",r.grantNr),e.xp6(2),e.Q6J("disabled",!s.form.valid),e.xp6(3),e.Q6J("disabled",r.blocked||r.errors),e.xp6(1),e.Oqu(r.okLabel)}}let ce=(()=>{class n extends ie{constructor(){super(I.INSTANCE),this.okLabel="Save",this.blocked=!1}get model(){return this._model}set model(t){this.setModel(t)}addAuthor(){const t=this.selectedPerson();t&&(this._model.authors.push(t),this.resetPerson(),this.triggerValidation())}addCurator(){const t=this.selectedPerson();t&&(this._model.curators.push(t),this.resetPerson())}removeAuthor(t){(0,N.d2)(t,this._model.authors),this.triggerValidation()}removeCurator(t){(0,N.d2)(t,this._model.curators)}addInstitution(){const t=this.selectedInstitution();if(t){if(this.hasInstitution(t,this._model))return;this._model.institutions.push(t),this.resetInstitution()}}hasInstitution(t,o){return o.institutions.findIndex(s=>s.name===t.name)>=0}removeInstitution(t){(0,N.d2)(t,this.model.institutions)}addFunding(){const t=this.selectedFunding();if(t){if(this.hasFunding(t,this._model))return;this._model.fundings.push(t),this.resetFunding()}}hasFunding(t,o){return o.fundings.findIndex(s=>s.name===t.name)>=0}removeFunding(t){(0,N.d2)(t,this._model.fundings)}resetPerson(){this.firstName=void 0,this.lastName=void 0,this.persForm.reset()}selectedPerson(){return this.firstName&&this.lastName?new ut.F(this.firstName,this.lastName):null}resetInstitution(){this.institutionName=void 0,this.instForm.reset()}selectedInstitution(){return this.institutionName?new re.v(this.institutionName):null}resetFunding(){this.funderName=void 0,this.grantNr=void 0,this.fundForm.reset()}selectedFunding(){if(this.funderName){const t=new re.v(this.funderName),o=new mt.e;return o.institution=t,o.grantNr=this.grantNr,o}return null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-contr-desc-form"]],viewQuery:function(t,o){if(1&t&&(e.Gf(ft,5),e.Gf(ht,5),e.Gf(gt,5)),2&t){let s;e.iGM(s=e.CRH())&&(o.persForm=s.first),e.iGM(s=e.CRH())&&(o.instForm=s.first),e.iGM(s=e.CRH())&&(o.fundForm=s.first)}},inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"form-group"],[3,"removed",4,"ngFor","ngForOf"],["inset","",1,"mt-2"],["class","form-group",4,"ngIf"],[1,"form-inline"],["persForm","ngForm"],[1,"form-group","mr-1"],["for","pFirst"],["matInput","","id","pFirst","maxlength","100","minlength","2","name","pFirst","placeholder","e.g. John)","required","","type","text",3,"ngModel","ngModelChange"],["pFirst","ngModel"],["for","pLast"],["matInput","","id","pLast","maxlength","100","minlength","2","name","pLast","placeholder","e.g. Smith","required","","type","text",3,"ngModel","ngModelChange"],["pLast","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","mr-1","ml-1",3,"disabled","click"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"mb-1"],["instForm","ngForm"],["for","iName"],["matInput","","id","iName","maxlength","100","minlength","3","name","iName","placeholder","e.g. University of Edinburgh","required","","type","text",1,"",3,"ngModel","ngModelChange"],["iName","ngModel"],["type","button",1,"btn","btn-primary","btn-sm","ml-1",3,"disabled","click"],["inset","",1,"mt-1","mb-2"],["fundForm","ngForm"],[1,"mr-1"],["for","fName"],["matInput","","id","fName","maxlength","100","minlength","3","name","fName","placeholder","e.g. BBSRC","required","","type","text",1,"",3,"ngModel","ngModelChange"],["fName","ngModel"],["for","fGrant"],["matInput","","id","fGrant","maxlength","100","minlength","3","name","fGrant","placeholder","e.g. EC2014","type","text",1,"",3,"ngModel","ngModelChange"],["fGrant","ngModel"],[1,"mt-2"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"alert","alert-danger"],[1,"mb-0"],[4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""]],template:function(t,o){1&t&&e.YNc(0,Dt,75,18,"div",0),2&t&&e.Q6J("ngIf",o.model)},dependencies:[a.sg,a.O5,u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.wO,u.nD,u.On,u.F,y.KE,y.hX,V.Nt,H.qn,H.HS,H.qH,pt.Hw,_t.d,ae.a8,ae.dn],encapsulation:2}),n})();var W=c(4711),Mt=c(6321),wt=c(93),qt=c(9360),Nt=c(4829),Ut=c(2306),Jt=c(8251),It=c(7103);const St=(0,Ut.d)(n=>function(t=null){n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t});function Qt(n){throw new St(n)}var kt=c(9397),Yt=c(6306),z=c(2096),le=c(8351);let Gt=(()=>{class n{constructor(t){this.BD2REST=t,this.popularSpecies=["Arabidopsis thaliana","Brassica rapa","Danio rerio","Drosophila melanogaster","Glycine max","Homo sapiens","Lemna gibba","Lemna minor","Marchantia polymorpha","Medicago truncatula","Mus musculus","Nannochloropsis","Neurospora crassa","Oryza sativa","Ostreococcus tauri","Phaeodactylum tricornutum","Physcometrella patens","Picea abies","Rattus norvegicus","Saccharomyces cerevisiae","Synechococcus elongatus","Synthetic data"],this.fetchedSpecies=void 0,console.log("Species Service")}species(){return this.fetchedSpecies?Promise.resolve(this.fetchedSpecies):this.fetchSpecies().toPromise()}fetchSpecies(){return this.BD2REST.species().pipe(function Ot(n,i){const{first:t,each:o,with:s=Qt,scheduler:r=i??Mt.z,meta:b=null}=(0,wt.q)(n)?{first:n}:"number"==typeof n?{each:n}:n;if(null==t&&null==o)throw new TypeError("No timeout provided.");return(0,qt.e)((X,q)=>{let Q,D,$=null,ee=0;const fe=te=>{D=(0,It.f)(q,r,()=>{try{Q.unsubscribe(),(0,Nt.Xf)(s({meta:b,lastValue:$,seen:ee})).subscribe(q)}catch(li){q.error(li)}},te)};Q=X.subscribe((0,Jt.x)(q,te=>{D?.unsubscribe(),ee++,q.next($=te),o>0&&fe(o)},void 0,void 0,()=>{D?.closed||D?.unsubscribe(),$=null})),!ee&&fe(null!=t?"number"==typeof t?t:+t-r.now():o)})}(5e3),(0,kt.b)(t=>{if(!(t&&t.length>0))throw new Error("Retrieved empty species falls back to default");this.fetchedSpecies=t}),(0,Yt.K)(t=>(console.log(" Could not fetch species",t),(0,z.of)(this.popularSpecies))))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(le.q))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Pt=c(6611),de=c(6649);function Lt(n,i){if(1&n&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t," ")}}function Bt(n,i){if(1&n&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("value",t.name),e.xp6(1),e.hij(" ",t.longName," ")}}function Rt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"form",null,1)(3,"div",2)(4,"mat-form-field",3)(5,"mat-label",4),e._uU(6,"Species"),e.qZA(),e.TgZ(7,"mat-select",5,6),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r._model.species=s)}),e.YNc(9,Lt,2,2,"mat-option",7),e.qZA(),e.TgZ(10,"mat-hint"),e._uU(11,"Please email us if you don't see suitable terms in the value lists"),e.qZA()()(),e.TgZ(12,"div",2)(13,"mat-form-field",3)(14,"mat-label",8),e._uU(15,"Data category"),e.qZA(),e.TgZ(16,"mat-select",9,10),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r._model.category=s)}),e.YNc(18,Bt,2,2,"mat-option",7),e.qZA(),e.TgZ(19,"mat-hint"),e._uU(20,"Please email us if you don't see suitable terms in the value lists"),e.qZA()()(),e.TgZ(21,"button",11),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.save())}),e._uU(22),e.qZA(),e.TgZ(23,"button",12),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.cancel())}),e._uU(24,"Cancel"),e.qZA()()()}if(2&n){const t=e.MAs(2),o=e.oxw();e.xp6(7),e.Q6J("ngModel",o._model.species),e.xp6(2),e.Q6J("ngForOf",o.knownSpecies),e.xp6(7),e.Q6J("ngModel",o._model.category),e.xp6(2),e.Q6J("ngForOf",o.categories),e.xp6(3),e.Q6J("disabled",o.blocked||!t.form.valid),e.xp6(1),e.Oqu(o.okLabel)}}let me=(()=>{class n extends R.X{constructor(t){super(),this.speciesService=t,this.okLabel="Save",this.blocked=!1,this.onAccepted=new e.vpe,this.onCancelled=new e.vpe,this.categories=[],this.knownSpecies=[],this._model={species:null,category:null}}set model(t){t&&(this.experiment=t,this._model.species=t.species,this._model.category=t.dataCategory?t.dataCategory.name:null)}getModel(){return this._model}ngOnInit(){this.speciesService.species().then(t=>this.knownSpecies=t),this.categories=this.initCategories()}cancel(){this.clearErrors(),this.onCancelled.emit(!0)}save(){this.triggerValidation()&&(this.experiment.dataCategory=W.c.get(this._model.category),this.experiment.species=this._model.species,this.onAccepted.emit(this.experiment))}validate(t){const o=[];return(!t.species||""===t.species.trim())&&o.push("Species cannot be empty"),t.species&&this.knownSpecies.indexOf(t.species)<0&&o.push("Unknown species: "+t.species),(!t.category||"NONE"===t.category)&&o.push("Data category is required"),0===o.length?null:o}initCategories(){const t=W.c.getValidOptions().slice();return(0,N.d2)(W.c.get("NONE"),t),t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Gt))},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-simple-bio-desc-form"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["sBioForm","ngForm"],[1,"form-group"],[1,"w-100"],["for","species"],["id","species","required","","placeholder","Select species","name","species",1,"",3,"ngModel","ngModelChange"],["species","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","dataCategory"],["id","dataCategory","required","","placeholder","Select category","name","dataCategory",1,"",3,"ngModel","ngModelChange"],["dataCategory","ngModel"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(t,o){1&t&&e.YNc(0,Rt,25,6,"div",0),2&t&&e.Q6J("ngIf",o.experiment)},dependencies:[a.sg,a.O5,u._Y,u.JJ,u.JL,u.Q7,u.On,u.F,y.KE,y.bx,y.hX,Pt.gD,de.ey],encapsulation:2}),n})();var ue=c(7921),j=c(9074);let Kt=(()=>{class n{constructor(){this.equipments=new Map,this.parameters=new Map,this.initTechniques()}getTechniques(){return Promise.resolve(this.techniques)}getEquipments(t){return this.equipments.has(t)?Promise.resolve(this.equipments.get(t)):Promise.reject(new Error("Unknown technique: "+t))}getParameters(t){return this.parameters.has(t)?Promise.resolve(this.parameters.get(t)):Promise.reject(new Error("Unknown technique: "+t))}registerEquipment(t,o){return this.equipments.has(t)?(this.equipments.get(t).indexOf(o)<0&&this.equipments.get(t).push(o),Promise.resolve(o)):Promise.reject(new Error("Unknown technique: "+t))}initTechniques(){const t=["Luciferase luminescence","Bioluminescence","(G)FP fluorescence","Delayed fluorescence","Endogenous fluorescence","Leaf movement","General imaging"];this.techniques=t.concat(["Computer simulation","qRT-PCR","RNA microarray","RNA-Seq","Northern blot","Western blot","Protein array","Mass Spectrometry","Flow cytometry","Spectrophotometry","Immunoprecipitation","Biomass Assay","Gas exchange","Oxygen concentration","Other"]);const o=["","Luminometer","Tecan Infinite 200 PRO","Topcount 1","Topcount 2","Topcount 3","Topcount 4","HAM 1","HAM 2","HAM 3","Unknown"];this.equipments=new Map,this.techniques.forEach(r=>this.equipments.set(r,["","Unknown"])),t.forEach(r=>this.equipments.set(r,o)),this.equipments.set("qRT-PCR",["","Robot + Light Cycler 480","Light Cycler 480","Unknown"]),this.equipments.set("Oxygen concentration",["","Galvanic Clarck's probe","Unknown"]);const s=[];s.push(new j.d("exposure_time",void 0,"Exposure time","min")),s.push(new j.d("interval",void 0,"Img interval","h")),s.push(new j.d("start_time",void 0,"Start time","h")),this.parameters=new Map,this.techniques.forEach(r=>this.parameters.set(r,[])),t.forEach(r=>this.parameters.set(r,s))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var pe=c(2626);function Vt(n,i){1&n&&(e.TgZ(0,"mat-error"),e._uU(1,"Known technique must be selected"),e.qZA())}function Ht(n,i){if(1&n&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function Wt(n,i){if(1&n&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function zt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"form",1)(2,"mat-hint",2),e._uU(3,"Please email us if you don't see suitable terms in the value lists"),e.qZA(),e.TgZ(4,"div",3)(5,"mat-form-field",4)(6,"mat-label",5),e._uU(7,"Technique"),e.qZA(),e._UZ(8,"input",6,7),e.TgZ(10,"mat-hint"),e._uU(11,"Type to select technique (backspace for all available)"),e.qZA(),e.YNc(12,Vt,2,0,"mat-error",0),e.qZA(),e.TgZ(13,"mat-autocomplete",8,9),e.NdJ("optionSelected",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.techniqueSelected(s))}),e.YNc(15,Ht,2,2,"mat-option",10),e.ALo(16,"async"),e.qZA()(),e.TgZ(17,"div",3)(18,"mat-form-field",4)(19,"mat-label",11),e._uU(20,"Equipment"),e.qZA(),e._UZ(21,"input",12,13),e.TgZ(23,"mat-hint"),e._uU(24,"Type define your equipment or choose from the list (backspace for all known)"),e.qZA()(),e.TgZ(25,"mat-autocomplete",null,14),e.YNc(27,Wt,2,2,"mat-option",10),e.ALo(28,"async"),e.qZA()(),e.TgZ(29,"div",3)(30,"mat-form-field",4)(31,"mat-label",15),e._uU(32,"Description"),e.qZA(),e.TgZ(33,"textarea",16),e._uU(34,"     "),e.qZA(),e.TgZ(35,"mat-hint"),e._uU(36,"Describe how the measurement was conducted"),e.qZA()()(),e.TgZ(37,"button",17),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.save())}),e._uU(38),e.qZA(),e.TgZ(39,"button",18),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.cancel())}),e._uU(40,"Cancel"),e.qZA()()()}if(2&n){const t=e.MAs(14),o=e.MAs(26),s=e.oxw();e.xp6(1),e.Q6J("formGroup",s.formModel),e.xp6(7),e.Q6J("matAutocomplete",t),e.xp6(4),e.Q6J("ngIf",null==s.formModel.get("technique").errors?null:s.formModel.get("technique").errors.validTechnique),e.xp6(3),e.Q6J("ngForOf",e.lcZ(16,8,s.filteredTechniques)),e.xp6(6),e.Q6J("matAutocomplete",o),e.xp6(6),e.Q6J("ngForOf",e.lcZ(28,10,s.filteredEquipments)),e.xp6(10),e.Q6J("disabled",s.blocked||!s.formModel.valid),e.xp6(1),e.Oqu(s.okLabel)}}let _e=(()=>{class n{constructor(t,o,s){this.techniqueService=t,this.feedback=o,this.fb=s,this.okLabel="Save",this.onAccepted=new e.vpe,this.onCancelled=new e.vpe,this.techniques=[],this.filteredTechniques=(0,z.of)([]),this.equipments=[],this.filteredEquipments=(0,z.of)([])}set model(t){this.setModel(t),this.updateTechniques().then(o=>this.updateEquipments(t.technique)).then(o=>this.formModel=this.buildMainForm(t)).then(o=>{this.filteredTechniques=this.formModel.get("technique").valueChanges.pipe((0,ue.O)(""),(0,C.U)(s=>this.filter(this.techniques,s))),this.filteredEquipments=this.formModel.get("equipment").valueChanges.pipe((0,ue.O)(""),(0,C.U)(s=>this.filter(this.equipments,s)))})}setModel(t){this._orgModel=t}ngOnInit(){this.updateTechniques()}filter(t,o){const s=o.toLowerCase();return t.filter(r=>r.toLowerCase().includes(s))}buildMainForm(t){return this.fb.group({technique:[t.technique,[u.kI.required,o=>this.knownTechnique(o.value)]],equipment:[t.equipment],description:[t.description],parameters:[]})}knownTechnique(t){return t?this.techniques.find(o=>o===t)?null:{validTechnique:"Unknown technique: "+t}:{validTechnique:"Empty value"}}techniqueSelected(t){t.option.value&&this.updateEquipments(t.option.value)}updateTechniques(){return this.techniqueService.getTechniques().then(t=>(this.techniques=t||[],t)).catch(t=>(this.feedback.error(t),Promise.reject(t)))}updateEquipments(t){return t?this.techniqueService.getEquipments(t).then(o=>(this.equipments=o||[],o)).catch(o=>(this.feedback.error(o),Promise.reject(o))):(this.equipments=[],Promise.resolve([]))}cancel(){this.onCancelled.emit(!0)}save(){this.formModel.valid&&(this._orgModel.setAll(this.formModel.value),this.onAccepted.emit(this._orgModel))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Kt),e.Y36(h.T),e.Y36(u.QS))},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-measurement-desc-rform"]],inputs:{okLabel:"okLabel",blocked:"blocked",model:"model"},outputs:{onAccepted:"onAccepted",onCancelled:"onCancelled"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"formGroup"],[1,"mb-2"],[1,"form-group"],[1,"w-100"],["for","mTechNameA"],["matInput","","formControlName","technique","id","mTechNameA","placeholder","Type to select technique (backspace for all available)","required","",1,"",3,"matAutocomplete"],["mTechNameA",""],[3,"optionSelected"],["techniqueAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["for","mEquipNameA"],["matInput","","formControlName","equipment","id","mEquipNameA","placeholder","Type to choose or define equipment",1,"",3,"matAutocomplete"],["mEquipNameA",""],["equipmentAuto","matAutocomplete"],["for","mDescription"],["matInput","","formControlName","description","id","mDescription","placeholder","Describe how the measurement was conducted, used technical tricks etc...\nFor example: plants were sprayed with luciferase two ours before measurement. Images were taken every two ours.","rows","5","type","text",1,""],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value"]],template:function(t,o){1&t&&e.YNc(0,zt,41,12,"div",0),2&t&&e.Q6J("ngIf",o.formModel)},dependencies:[a.sg,a.O5,u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.sg,u.u,y.TO,y.KE,y.bx,y.hX,V.Nt,de.ey,pe.XC,pe.ZL,a.Ov],encapsulation:2}),n})();function jt(n,i){if(1&n&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.Oqu(t)}}function Xt(n,i){if(1&n&&(e.TgZ(0,"div",8)(1,"ul"),e.YNc(2,jt,2,1,"li",9),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.errors)}}function $t(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"bd2-general-desc-form",10),e.NdJ("onAccepted",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.saveEdits(s))})("onCancelled",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("blocked",t.blocked)("model",t.assay.generalDesc)}}function en(n,i){if(1&n&&e._UZ(0,"bd2-general-desc-view",11),2&n){const t=e.oxw(2);e.Q6J("model",t.assay.generalDesc)}}function tn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",12),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeGeneralDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("disabled",t.activeGeneralDescForm)}}function nn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"bd2-contr-desc-form",10),e.NdJ("onAccepted",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.saveEdits(s))})("onCancelled",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("blocked",t.blocked)("model",t.assay.contributionDesc)}}function on(n,i){if(1&n&&e._UZ(0,"bd2-contr-desc-view",11),2&n){const t=e.oxw(2);e.Q6J("model",t.assay.contributionDesc)}}function sn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",12),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeContributionDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("disabled",t.activeContributionDescForm)}}function rn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"bd2-simple-bio-desc-form",10),e.NdJ("onAccepted",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.saveEdits(s))})("onCancelled",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("blocked",t.blocked)("model",t.assay)}}function an(n,i){if(1&n&&e._UZ(0,"bd2-simple-bio-desc-view",11),2&n){const t=e.oxw(2);e.Q6J("model",t.assay)}}function cn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",12),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeSimpleBioDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("disabled",t.activeSimpleBioDescForm)}}function ln(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"bd2-measurement-desc-rform",10),e.NdJ("onAccepted",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.saveEdits(s))})("onCancelled",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("blocked",t.blocked)("model",t.assay.experimentalDetails.measurementDesc)}}function dn(n,i){if(1&n&&e._UZ(0,"bd2-measurement-desc-view",11),2&n){const t=e.oxw(2);e.Q6J("model",t.assay.experimentalDetails.measurementDesc)}}function mn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",12),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeMeasurementDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("disabled",t.activeMeasurementDescForm)}}function un(n,i){if(1&n&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.Oqu(t)}}function pn(n,i){if(1&n&&(e.TgZ(0,"div",8)(1,"ul"),e.YNc(2,un,2,1,"li",9),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.errors)}}function _n(n,i){if(1&n&&(e.TgZ(0,"div")(1,"h3"),e._uU(2,"Modify experiment description"),e.qZA(),e.YNc(3,Xt,3,1,"div",1),e.TgZ(4,"div",2)(5,"div",3),e._uU(6,"General description"),e.qZA(),e.TgZ(7,"div",4),e.YNc(8,$t,1,2,"bd2-general-desc-form",5),e.YNc(9,en,1,1,"bd2-general-desc-view",6),e.YNc(10,tn,4,1,"div",0),e.qZA()(),e.TgZ(11,"div",2)(12,"div",3),e._uU(13,"Contributions"),e.qZA(),e.TgZ(14,"div",4),e.YNc(15,nn,1,2,"bd2-contr-desc-form",5),e.YNc(16,on,1,1,"bd2-contr-desc-view",6),e.YNc(17,sn,4,1,"div",0),e.qZA()(),e.TgZ(18,"div",2)(19,"div",3),e._uU(20,"Biological details"),e.qZA(),e.TgZ(21,"div",4),e.YNc(22,rn,1,2,"bd2-simple-bio-desc-form",5),e.YNc(23,an,1,1,"bd2-simple-bio-desc-view",6),e.YNc(24,cn,4,1,"div",0),e.qZA()(),e.TgZ(25,"div",7)(26,"div",3),e._uU(27,"Measurement details"),e.qZA(),e.TgZ(28,"div",4),e.YNc(29,ln,1,2,"bd2-measurement-desc-rform",5),e.YNc(30,dn,1,1,"bd2-measurement-desc-view",6),e.YNc(31,mn,4,1,"div",0),e.qZA()(),e.YNc(32,pn,3,1,"div",1),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.errors),e.xp6(5),e.Q6J("ngIf",t.activeGeneralDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeGeneralDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeGeneralDescForm),e.xp6(5),e.Q6J("ngIf",t.activeContributionDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeContributionDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeContributionDescForm),e.xp6(5),e.Q6J("ngIf",t.activeSimpleBioDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeSimpleBioDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeSimpleBioDescForm),e.xp6(5),e.Q6J("ngIf",t.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",t.errors)}}let fn=(()=>{class n extends U.w{constructor(t,o){super(o),this.route=t,this.blocked=!1,this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.titlePart=" Edit",this.validator=S.INSTANCE}ngOnInit(){super.ngOnInit(),this.route.fragment.subscribe(t=>{this.requestedSection=t,this.focusOnSection(t)})}ngAfterViewInit(){this.focusOnSection(this.requestedSection)}focusOnSection(t){if(!t)return;const o=document.getElementById(t);o&&o.scrollIntoView(),"MeasurementSection"===t&&(this.activeMeasurementDescForm=!0)}saveEdits(t){this.assay&&t&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.save(this.assay).then(o=>(this.feedback.success('Experiment: "'+o.name+'" updated.'),o)).then(o=>(this.currentExperiment.push(o),o)).then(o=>{this.blocked=!1,this.hideEdits(t)}).catch(o=>{this.blocked=!1,this.feedback.error(o)}))}hideEdits(t){this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiment",this.assay.id])}updateModel(t){this._orgModel=t,this.assay=t?t.clone():null,this.setTitle()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.gz),e.Y36(_.L))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],features:[e._Bn([]),e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"blocked","model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["id","MeasurementSection",1,"card","mb-2"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"],[3,"blocked","model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,o){1&t&&e.YNc(0,_n,33,14,"div",0),2&t&&e.Q6J("ngIf",o.assay)},dependencies:[a.sg,a.O5,se,Y,ce,G,me,P,_e,L],encapsulation:2}),n})();class x{constructor(i){this.name=i}static deserialize(i){if(null==i)return null;const t=x.valuesMap.get(i);if(t)return t;const o=+i;if(o<0||o>=x.values.length||Number.isNaN(o))throw new RangeError("Uknown AssetType "+i);return x.values[o]}static initValuesMap(){const i=new Map;return x.values.forEach(t=>i.set(t.name,t)),i}equals(i){return this.name===i.name}toJSON(){return this.name}}x.NONE=new x("NONE"),x.FILE=new x("FILE"),x.MEDIA=new x("MEDIA"),x.DATA=new x("DATA"),x.TS_DATA=new x("TS_DATA"),x.values=[x.NONE,x.FILE,x.MEDIA,x.DATA,x.TS_DATA],x.valuesMap=x.initValuesMap();class hn{static deserialize(i){return i.created=oe.h.deserialize(i.created),i}}class O{constructor(){this.assetType=x.NONE,this.versions=[]}get last(){return this.versions[0]}static deserialize(i){const t=new O;return t.id=i.id,t.originalName=i.originalName,t.url=i.url,t.assetType=x.deserialize(i.assetType),i.versions&&(t.versions=i.versions.map(o=>hn.deserialize(o))),t}setAll(i){this.id=i.id,this.originalName=i.originalName,this.assetType=i.assetType,this.url=i.url,this.versions=i.versions}}let gn=(()=>{class n{constructor(t){this.BD2REST=t}upload(t,o){const s=new FormData;for(let r=0;r<o.length;r++)s.append("file",o[r],o[r].name);return this.BD2REST.expFileUpload(t.id,s).then(r=>r.data)}getFiles(t){return this.BD2REST.files(t.id).then(o=>o.data).then(o=>this.json2AssetsList(o)).then(o=>this.fillURLs(o,t))}fillURLs(t,o){return t.map(s=>this.fillURL(s,o))}fillURL(t,o){const s=this.BD2REST.fileURL(o.id,t.id);return t.url=s,t.versions.forEach(r=>{r.url=s+"/"+r.versionId}),t}json2AssetsList(t){return t.map(o=>O.deserialize(o))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(le.q))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function vn(n,i){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(t.file.last.description)}}function xn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"li"),e._uU(1),e.ALo(2,"date"),e.TgZ(3,"strong")(4,"a",4),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.recordDownload())}),e._uU(5),e.qZA()(),e._UZ(6,"br"),e._uU(7),e.qZA()}if(2&n){const t=i.$implicit;e.xp6(1),e.AsE(" Version ",t.versionId,". ",e.xi3(2,6,t.created.date,"shortDate")," "),e.xp6(3),e.s9C("href",t.url,e.LSH),e.s9C("download",t.originalName),e.xp6(1),e.Oqu(t.originalName),e.xp6(2),e.hij("",t.description," ")}}function Cn(n,i){if(1&n&&(e.TgZ(0,"div")(1,"ul",5),e.YNc(2,xn,8,9,"li",6),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.file.versions)}}function Tn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",1),e._uU(2),e.TgZ(3,"a",2),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.showVersions=!s.showVersions)}),e.TgZ(4,"i",3),e._uU(5,"expand_more"),e.qZA()()(),e.TgZ(6,"h5")(7,"a",4),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.recordDownload())}),e._uU(8),e.qZA()(),e.YNc(9,vn,2,1,"div",0),e.YNc(10,Cn,3,1,"div",0),e.qZA()}if(2&n){const t=e.oxw();e.xp6(2),e.hij(" ",t.file.versions.length," versions "),e.xp6(5),e.s9C("href",t.file.url,e.LSH),e.s9C("download",t.file.last.originalName),e.xp6(1),e.Oqu(t.file.last.originalName),e.xp6(1),e.Q6J("ngIf",t.file.last.description),e.xp6(1),e.Q6J("ngIf",t.showVersions)}}let bn=(()=>{class n{constructor(t){this.analytics=t,this.canEdit=!0,this.showVersions=!1,this.edit=!1,this.model=this.fakeFileAsset()}set model(t){this.file=t}ngOnInit(){}fakeFileAsset(){const o=JSON.parse('{\n      "id" : 2,\n      "originalName" : "f2",\n      "assetType" : "TS_DATA",\n      "versions" : [ {\n        "versionId" : 2,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : "Some description",\n        "created" : [ 2016, 12, 8 ]\n      }, {\n        "versionId" : 1,\n        "localFile" : "cos2",\n        "originalName" : "f2",\n        "contentType" : "txt",\n        "description" : null,\n        "created" : [ 2016, 12, 8 ]\n      } ]\n    }');return O.deserialize(o)}recordDownload(){this.analytics.fileDownload(this.parentId.toString(),this.file.id)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(f.y))},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-file-asset-view"]],inputs:{canEdit:"canEdit",parentId:"parentId",model:"model"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"float-right"],["role","button","aria-label","expand",3,"click"],[1,"material-icons","bd-icon"],[3,"href","download","click"],[1,"list-unstyled"],[4,"ngFor","ngForOf"]],template:function(t,o){1&t&&e.YNc(0,Tn,11,6,"div",0),2&t&&e.Q6J("ngIf",o.file&&o.file.last)},dependencies:[a.sg,a.O5,a.uU],encapsulation:2}),n})();var An=c(212);const Zn=["uploadWidget"];function Fn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"bd2-file-upload-widget",2,3),e.NdJ("uploadFiles",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.upload(s))}),e.qZA(),e._UZ(3,"hr"),e.qZA()}if(2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("autoReset",!1)("blocked",t.blocked)}}function yn(n,i){if(1&n&&e._UZ(0,"bd2-file-asset-view",5),2&n){const t=i.$implicit,o=e.oxw(3);e.Q6J("model",t)("parentId",o.assay.id)}}function En(n,i){1&n&&(e.TgZ(0,"div",6),e._uU(1,' Use "Replace data" to change timeseries files. '),e.qZA())}function Dn(n,i){if(1&n&&(e.TgZ(0,"div")(1,"h4"),e._uU(2,"Timeseries files"),e.qZA(),e.YNc(3,yn,1,2,"bd2-file-asset-view",4),e.YNc(4,En,2,0,"div",1),e._UZ(5,"hr"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.tsData),e.xp6(1),e.Q6J("ngIf",t.assay.security.canWrite)}}function Mn(n,i){1&n&&(e.TgZ(0,"div",6),e._uU(1,' Use "Import data" to add timeseries files. '),e.qZA())}function wn(n,i){if(1&n&&e._UZ(0,"bd2-file-asset-view",5),2&n){const t=i.$implicit,o=e.oxw(3);e.Q6J("model",t)("parentId",o.assay.id)}}function qn(n,i){if(1&n&&(e.TgZ(0,"div")(1,"h4"),e._uU(2,"Attachments"),e.qZA(),e.YNc(3,wn,1,2,"bd2-file-asset-view",4),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.attachments)}}function Nn(n,i){1&n&&(e.TgZ(0,"div",6),e._uU(1," Drag and upload files using the upload area in order to update the attachments. "),e.qZA())}function Un(n,i){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,Fn,4,2,"div",0),e.YNc(2,Dn,6,2,"div",0),e.YNc(3,Mn,2,0,"div",1),e.YNc(4,qn,4,1,"div",0),e.YNc(5,Nn,2,0,"div",1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.assay.security.canWrite),e.xp6(1),e.Q6J("ngIf",t.tsData&&t.tsData.length>0),e.xp6(1),e.Q6J("ngIf",!t.tsData||0===t.tsData.length),e.xp6(1),e.Q6J("ngIf",t.attachments&&t.attachments.length>0),e.xp6(1),e.Q6J("ngIf",t.assay.security.canWrite)}}let Jn=(()=>{class n extends U.w{constructor(t,o){super(o),this.attachmentsService=t,this.attachments=[],this.tsData=[],this.blocked=!1,this.titlePart=" Files"}updateModel(t){super.updateModel(t),this.refreshAttachments()}refreshAttachments(){this.attachmentsService.getFiles(this.assay).then(t=>this.setFiles(t)).catch(t=>{this.feedback.error(t)})}setFiles(t){this.tsData=t.filter(o=>o.assetType.equals(x.TS_DATA)),this.attachments=t.filter(o=>!o.assetType.equals(x.TS_DATA))}upload(t){console.log("Uploading "+t.length),t&&0!==t.length&&(this.blocked=!0,this.attachmentsService.upload(this.assay,t).then(o=>{this.uploadWidget.reset(),this.blocked=!1,this.feedback.success(o.length+" files uploaded")}).then(()=>this.refreshModel()).catch(o=>{this.blocked=!1,this.feedback.error(o)}))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(gn),e.Y36(_.L))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(t,o){if(1&t&&e.Gf(Zn,5),2&t){let s;e.iGM(s=e.CRH())&&(o.uploadWidget=s.first)}},features:[e.qOj],decls:4,vars:1,consts:[[4,"ngIf"],["type","info","class","alert alert-info","role","alert",4,"ngIf"],[3,"autoReset","blocked","uploadFiles"],["uploadWidget",""],[3,"model","parentId",4,"ngFor","ngForOf"],[3,"model","parentId"],["type","info","role","alert",1,"alert","alert-info"]],template:function(t,o){1&t&&(e.TgZ(0,"h3"),e._uU(1,"Attached files"),e.qZA(),e._UZ(2,"hr"),e.YNc(3,Un,6,5,"div",0)),2&t&&(e.xp6(3),e.Q6J("ngIf",o.assay))},dependencies:[a.sg,a.O5,bn,An.F]}),n})();function In(n,i){if(1&n&&(e.TgZ(0,"div")(1,"div",1),e._uU(2," Experiment is already publicly available under "),e.TgZ(3,"strong"),e._uU(4),e.qZA(),e._uU(5," licence. "),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(4),e.Oqu(t.assay.features.licence)}}function Sn(n,i){if(1&n&&(e.TgZ(0,"option",12),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",t," ")}}function On(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",2),e._uU(2," You are about to make the data public. Once they are public they cannot be made private again. "),e.TgZ(3,"ul")(4,"li"),e._uU(5,"make sure you know what you are doing"),e.qZA(),e.TgZ(6,"li"),e._uU(7,"make sure all contributors agree to public sharing"),e.qZA(),e.TgZ(8,"li"),e._uU(9,"double check the description is correct, not all changes will be possible after the publishing"),e.qZA()()(),e.TgZ(10,"form",null,3)(12,"div",4)(13,"label",5),e._uU(14,"Licence"),e.qZA(),e.TgZ(15,"select",6,7),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.licence=s)}),e.YNc(17,Sn,2,2,"option",8),e.qZA()(),e.TgZ(18,"div",4)(19,"label")(20,"input",9,10),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.terms=s)}),e.qZA(),e._uU(22," I understand that I cannot undo this operation "),e.qZA()(),e.TgZ(23,"button",11),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.publish())}),e._uU(24," Publish "),e.qZA()()()}if(2&n){const t=e.MAs(11),o=e.oxw(2);e.xp6(15),e.Q6J("ngModel",o.licence),e.xp6(2),e.Q6J("ngForOf",o.licences),e.xp6(3),e.Q6J("ngModel",o.terms),e.xp6(3),e.Q6J("disabled",!t.form.valid)}}function Qn(n,i){if(1&n&&(e.TgZ(0,"div")(1,"h3"),e._uU(2,"Publish experiment"),e.qZA(),e.YNc(3,In,6,1,"div",0),e.YNc(4,On,25,4,"div",0),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.assay.features.isOpenAccess),e.xp6(1),e.Q6J("ngIf",!t.assay.features.isOpenAccess)}}let kn=(()=>{class n extends U.w{constructor(t){super(t),this.licences=["CC_BY"]}ngOnInit(){super.ngOnInit(),this.licence=this.licences[0]}publish(){this.terms&&this.licence&&this.experimentService.publish(this.assay,this.licence).then(t=>(this.feedback.success('Experiment: "'+t.name+'" published.'),t)).then(t=>(this.currentExperiment.push(t),t)).then(t=>{this.goToExpHome(t.id)}).catch(t=>{this.feedback.error(t)})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.L))},n.\u0275cmp=e.Xpm({type:n,selectors:[["bd2-publish-form"]],features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["type","info","role","alert",1,"alert","alert-info"],["type","danger","role","alert",1,"alert","alert-danger"],["publishForm","ngForm"],[1,"form-group"],["for","licence"],["id","licence","required","","placeholder","Select licence","name","licence",1,"form-control",3,"ngModel","ngModelChange"],["licenceF","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","checkbox","required","","id","terms","name","fTerms",3,"ngModel","ngModelChange"],["fTerms","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[3,"value"]],template:function(t,o){1&t&&e.YNc(0,Qn,5,2,"div",0),2&t&&e.Q6J("ngIf",o.assay)},dependencies:[a.sg,a.O5,u._Y,u.YN,u.Kr,u.Wl,u.EJ,u.JJ,u.JL,u.Q7,u.Zs,u.On,u.F],encapsulation:2}),n})();function Yn(n,i){1&n&&(e.TgZ(0,"div")(1,"h4"),e._uU(2,"You don't have permission to create experiment"),e.qZA(),e.TgZ(3,"p"),e._uU(4,"Try to login"),e.qZA()())}function Gn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"bd2-general-desc-form",9),e.NdJ("onAccepted",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))})("onCancelled",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("model",t.assay.generalDesc)}}function Pn(n,i){if(1&n&&e._UZ(0,"bd2-general-desc-view",10),2&n){const t=e.oxw(2);e.Q6J("model",t.assay.generalDesc)}}function Ln(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",11),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeGeneralDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("disabled",t.activeGeneralDescForm)}}function Bn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"bd2-simple-bio-desc-form",9),e.NdJ("onAccepted",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))})("onCancelled",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("model",t.assay)}}function Rn(n,i){if(1&n&&e._UZ(0,"bd2-simple-bio-desc-view",10),2&n){const t=e.oxw(2);e.Q6J("model",t.assay)}}function Kn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",11),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeSimpleBioDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("disabled",t.activeSimpleBioDescForm)}}function Vn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"bd2-contr-desc-form",9),e.NdJ("onAccepted",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))})("onCancelled",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("model",t.assay.contributionDesc)}}function Hn(n,i){if(1&n&&e._UZ(0,"bd2-contr-desc-view",10),2&n){const t=e.oxw(2);e.Q6J("model",t.assay.contributionDesc)}}function Wn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",11),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeContributionDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("disabled",t.activeContributionDescForm)}}function zn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"bd2-measurement-desc-rform",9),e.NdJ("onAccepted",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))})("onCancelled",function(s){e.CHM(t);const r=e.oxw(2);return e.KtG(r.hideEdits(s))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("model",t.assay.experimentalDetails.measurementDesc)}}function jn(n,i){if(1&n&&e._UZ(0,"bd2-measurement-desc-view",10),2&n){const t=e.oxw(2);e.Q6J("model",t.assay.experimentalDetails.measurementDesc)}}function Xn(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"button",11),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.activeMeasurementDescForm=!0)}),e._uU(3,"Modify "),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("disabled",t.activeMeasurementDescForm)}}function $n(n,i){if(1&n&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.Oqu(t)}}function ei(n,i){if(1&n&&(e.TgZ(0,"div",12)(1,"ul"),e.YNc(2,$n,2,1,"li",13),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.errors)}}function ti(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"h3"),e._uU(2,"Create experiment"),e.qZA(),e.TgZ(3,"div",1)(4,"div",2),e._uU(5,"General description"),e.qZA(),e.TgZ(6,"div",3),e.YNc(7,Gn,1,1,"bd2-general-desc-form",4),e.YNc(8,Pn,1,1,"bd2-general-desc-view",5),e.YNc(9,Ln,4,1,"div",0),e.qZA()(),e.TgZ(10,"div",1)(11,"div",2),e._uU(12,"Biological details"),e.qZA(),e.TgZ(13,"div",3),e.YNc(14,Bn,1,1,"bd2-simple-bio-desc-form",4),e.YNc(15,Rn,1,1,"bd2-simple-bio-desc-view",5),e.YNc(16,Kn,4,1,"div",0),e.qZA()(),e.TgZ(17,"div",1)(18,"div",2),e._uU(19,"Contributions"),e.qZA(),e.TgZ(20,"div",3),e.YNc(21,Vn,1,1,"bd2-contr-desc-form",4),e.YNc(22,Hn,1,1,"bd2-contr-desc-view",5),e.YNc(23,Wn,4,1,"div",0),e.qZA()(),e.TgZ(24,"div",1)(25,"div",2),e._uU(26,"Measurement details"),e.qZA(),e.TgZ(27,"div",3),e.YNc(28,zn,1,1,"bd2-measurement-desc-rform",4),e.YNc(29,jn,1,1,"bd2-measurement-desc-view",5),e.YNc(30,Xn,4,1,"div",0),e.qZA()(),e.YNc(31,ei,3,1,"div",6),e.TgZ(32,"button",7),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.save())}),e._uU(33,"Create"),e.qZA(),e.TgZ(34,"button",8),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.cancel())}),e._uU(35,"Cancel"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(7),e.Q6J("ngIf",t.activeGeneralDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeGeneralDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeGeneralDescForm),e.xp6(5),e.Q6J("ngIf",t.activeSimpleBioDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeSimpleBioDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeSimpleBioDescForm),e.xp6(5),e.Q6J("ngIf",t.activeContributionDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeContributionDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeContributionDescForm),e.xp6(5),e.Q6J("ngIf",t.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",!t.activeMeasurementDescForm),e.xp6(1),e.Q6J("ngIf",t.errors),e.xp6(1),e.Q6J("disabled",t.blocked||t.errors)}}const ni=[{path:"new",pathMatch:"full",component:(()=>{class n extends R.X{constructor(t,o,s,r){super(S.INSTANCE),this.experimentService=t,this.RDMSocial=o,this.feedback=s,this.router=r,this.isUnauthorised=!1,this.blocked=!1,this.activeGeneralDescForm=!0,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!0,this.activeMeasurementDescForm=!1}ngOnInit(){this.experimentService.newDraft().then(t=>{this.assay=t}).catch(t=>{this.isUnauthorised=t.isUnauthorised,this.feedback.error(t)})}hideEdits(t){this.activeGeneralDescForm=!this.assay.generalDesc.name,this.activeSimpleBioDescForm=!this.assay.species||!this.assay.dataCategory,this.activeContributionDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiments"])}save(){this.assay&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.newExperiment(this.assay).then(t=>(this.feedback.success('Experiment: "'+t.name+'" created.'),t)).then(t=>this.router.navigate(["/experiment",t.id])).catch(t=>{this.blocked=!1,this.feedback.error(t)}))}getModel(){return this.assay}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(l.$),e.Y36(Z.C),e.Y36(h.T),e.Y36(d.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],features:[e.qOj],decls:2,vars:2,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],["okLabel","Accept",3,"model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["okLabel","Accept",3,"model","onAccepted","onCancelled"],[3,"model"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"]],template:function(t,o){1&t&&(e.YNc(0,Yn,5,0,"div",0),e.YNc(1,ti,36,14,"div",0)),2&t&&(e.Q6J("ngIf",o.isUnauthorised),e.xp6(1),e.Q6J("ngIf",o.assay))},dependencies:[a.sg,a.O5,se,Y,ce,G,me,P,_e,L],encapsulation:2}),n})()},{path:":id",component:Pe,children:[{path:"",pathMatch:"full",component:at},{path:"edit",component:fn},{path:"file",component:Jn},{path:"publish",component:kn},{path:"data",loadChildren:()=>Promise.all([c.e(401),c.e(877),c.e(608),c.e(592),c.e(319)]).then(c.bind(c,6319)).then(n=>n.TsDataModule)},{path:"ppa",loadChildren:()=>Promise.all([c.e(401),c.e(877),c.e(608),c.e(675),c.e(592),c.e(279)]).then(c.bind(c,4279)).then(n=>n.PPAModule)},{path:"rhythmicity",loadChildren:()=>Promise.all([c.e(401),c.e(877),c.e(608),c.e(592),c.e(459)]).then(c.bind(c,6459)).then(n=>n.RhythmicityModule)}]}];let ii=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[d.Bz.forChild(ni),d.Bz]}),n})();var oi=c(1690),si=c(7229);let ri=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[a.ez,si.Q]}),n})(),ai=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[a.ez,u.u5]}),n})(),ci=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[a.ez,oi.C,ri,ai,ii]}),n})()},7229:(w,A,c)=>{c.d(A,{Q:()=>C});var a=c(6814),d=c(6223),g=c(5879);let C=(()=>{class v{}return v.\u0275fac=function(e){return new(e||v)},v.\u0275mod=g.oAB({type:v}),v.\u0275inj=g.cJS({imports:[a.ez,d.u5]}),v})()},212:(w,A,c)=>{c.d(A,{F:()=>h});var a=c(5879),d=c(1344),g=c(6814);const C=["inputFieldM"];function v(f,F){if(1&f){const m=a.EpF();a.TgZ(0,"div",11),a._uU(1),a.TgZ(2,"button",12),a.NdJ("click",function(){const E=a.CHM(m).$implicit,k=a.oxw(2);return a.KtG(k.remove(E))}),a.TgZ(3,"span",13),a._uU(4,"\xd7"),a.qZA()()()}if(2&f){const m=F.$implicit;a.xp6(1),a.hij(" ",m.name," ")}}function _(f,F){if(1&f&&(a.TgZ(0,"div",8)(1,"div",9)(2,"label"),a._uU(3,"Files:"),a.qZA()(),a.YNc(4,v,5,1,"div",10),a.qZA()),2&f){const m=a.oxw();a.xp6(4),a.Q6J("ngForOf",m.files)}}function e(f,F){if(1&f){const m=a.EpF();a.TgZ(0,"input",14,15),a.NdJ("change",function(T){a.CHM(m);const E=a.oxw();return a.KtG(E.handleFileSelect(T))}),a.qZA()}}function l(f,F){if(1&f){const m=a.EpF();a.TgZ(0,"input",16,15),a.NdJ("change",function(T){a.CHM(m);const E=a.oxw();return a.KtG(E.handleFileSelect(T))}),a.qZA()}}function Z(f,F){if(1&f&&(a.TgZ(0,"div",17),a._uU(1),a.qZA()),2&f){const m=a.oxw();a.xp6(1),a.hij(" Maximum upload size is ",m.sizeLimit,"MB ")}}let h=(()=>{class f{constructor(){this.activeColor="green",this.baseColor="#ccc",this.overlayColor="rgba(255,255,255,0.5)",this.blocked=!1,this.multiple=!0,this.noDuplicates=!0,this.autoReset=!1,this.sizeLimit=50,this.uploadFiles=new a.vpe,this.selectedFiles=new a.vpe,this.dragging=!1,this.loaded=!1,this.sizeError=!1,this.files=[]}ngOnInit(){}reset(){this.files=[],this.inputField&&this.inputField.nativeElement&&(this.inputField.nativeElement.value="")}handleDragEnter(){this.dragging=!0}handleDragLeave(){this.dragging=!1}handleDrop(m){m.preventDefault(),this.dragging=!1,m.dataTransfer&&this.handleFileChange(m.dataTransfer.files)}handleFileSelect(m){m.target&&this.handleFileChange(m.target.files)}handleFileChange(m){const p=this.multiple?m.length:Math.min(1,m.length);this.multiple||(this.files=[]);for(let T=0;T<p;T++){const E=m[T];this.noDuplicates&&this.removeDuplicate(E),this.files.push(E)}this.checkSize(),this.selectedFiles.next(this.files)}remove(m){(0,d.d2)(m,this.files),this.checkSize()}removeDuplicate(m){const p=this.files.find(T=>T.name===m.name);this.remove(p)}checkSize(){let m=0;this.files.map(p=>p.size).forEach(p=>m+=p),m/=1048576,this.sizeError=m>this.sizeLimit}upload(){this.uploadFiles.next(this.files),this.autoReset&&this.reset()}}return f.\u0275fac=function(m){return new(m||f)},f.\u0275cmp=a.Xpm({type:f,selectors:[["bd2-file-upload-widget"]],viewQuery:function(m,p){if(1&m&&a.Gf(C,5),2&m){let T;a.iGM(T=a.CRH())&&(p.inputField=T.first)}},inputs:{activeColor:"activeColor",baseColor:"baseColor",overlayColor:"overlayColor",blocked:"blocked",multiple:"multiple",noDuplicates:"noDuplicates",autoReset:"autoReset",sizeLimit:"sizeLimit"},outputs:{uploadFiles:"uploadFiles",selectedFiles:"selectedFiles"},decls:13,vars:9,consts:[["class","clearfix","style","margin-bottom: 1em;",4,"ngIf"],[2,"margin-bottom","1em"],["ondragover","return false;",1,"uploader-zone",3,"dragenter","dragleave","drop"],[1,"material-icons","bd-icon","bd-primary",2,"font-size","400%"],["multiple","","name","inputField","type","file",3,"change",4,"ngIf"],["name","inputField","type","file",3,"change",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"clearfix",2,"margin-bottom","1em"],[1,""],["class","float-left fileitem",4,"ngFor","ngForOf"],[1,"float-left","fileitem"],["aria-label","Close","type","button",1,"close",2,"margin-left","0.5em",3,"click"],["aria-hidden","true"],["multiple","","name","inputField","type","file",3,"change"],["inputField",""],["name","inputField","type","file",3,"change"],[1,"alert","alert-danger"]],template:function(m,p){1&m&&(a.TgZ(0,"div"),a.YNc(1,_,5,1,"div",0),a.TgZ(2,"div",1)(3,"label",2),a.NdJ("dragenter",function(){return p.handleDragEnter()})("dragleave",function(){return p.handleDragLeave()})("drop",function(E){return p.handleDrop(E)}),a.TgZ(4,"i",3),a._uU(5,"cloud_upload"),a.qZA(),a.TgZ(6,"p"),a._uU(7," Drag file(s) or click to select"),a.qZA(),a.YNc(8,e,2,0,"input",4),a.YNc(9,l,2,0,"input",5),a.qZA()(),a.YNc(10,Z,2,1,"div",6),a.TgZ(11,"button",7),a.NdJ("click",function(){return p.upload()}),a._uU(12,"Upload selected "),a.qZA()()),2&m&&(a.xp6(1),a.Q6J("ngIf",p.files.length>0),a.xp6(2),a.Udp("outline-color",p.dragging?p.activeColor:p.baseColor),a.ekj("loaded",p.loaded),a.xp6(5),a.Q6J("ngIf",p.multiple),a.xp6(1),a.Q6J("ngIf",!p.multiple),a.xp6(1),a.Q6J("ngIf",p.sizeError),a.xp6(1),a.Q6J("disabled",p.blocked||p.files.length<1||p.sizeError))},dependencies:[g.sg,g.O5],styles:[".uploader-zone[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.uploader-zone[_ngcontent-%COMP%]{font-weight:400;align-items:center;background-color:#efefef;background-color:#00000005;cursor:pointer;display:flex;height:100px;justify-content:center;outline:3px dashed #ccc}div.fileitem[_ngcontent-%COMP%]{margin:2px;padding:2px;border:1px solid #efefef;border-radius:4px}"]}),f})()},6753:(w,A,c)=>{c.d(A,{C:()=>g});var a=c(5879),d=c(8351);let g=(()=>{class C{constructor(_){this.BD2REST=_,this.visited=new Set,console.log("RDMSocialServiceService created")}getAssayGuiAspects(_){return this.BD2REST.rdmAssayGuiAspects(_.id).then(e=>(this.visited.add(_.id),e))}shouldShowMeasurementWarning(_){return!_.security.isOwner||this.visited.has(_.id)?Promise.resolve(!1):this.getAssayGuiAspects(_).then(e=>e.showMeasurementWarning)}registerNewAssay(_){this.visited.add(_.id)}registerMeasurementWarning(_){this.BD2REST.rdmRegisterWarning(_.id,"MEASUREMENT").then(e=>!0)}canProceedByMeasurement(_){return _.security.isOwner?this.getAssayGuiAspects(_).then(e=>e.canProceedByMeasurement):Promise.resolve(!0)}}return C.\u0275fac=function(_){return new(_||C)(a.LFG(d.q))},C.\u0275prov=a.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},1009:(w,A,c)=>{c.d(A,{d:()=>e});var a=c(8189),d=c(5879),g=c(6814);function C(l,Z){if(1&l&&d._UZ(0,"div",5),2&l){const h=d.oxw();d.Q6J("innerHTML",h.question.details,d.oJD)}}class v{constructor(Z,h=void 0,f="Cancel",F="OK"){this.question=Z,this.details=h,this.cancelLabel=f,this.okLabel=F}}let _=(()=>{class l{constructor(h){this.question=h||new v("Missing question")}ngOnInit(){}}return l.\u0275fac=function(h){return new(h||l)(d.Y36(a.WI))},l.\u0275cmp=d.Xpm({type:l,selectors:[["ng-component"]],decls:10,vars:5,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-content","",1,"modal-body"],[3,"innerHTML",4,"ngIf"],["mat-dialog-close","",1,"btn","btn-primary","btn-sm","mr-2"],[1,"btn","btn-primary","btn-sm",3,"mat-dialog-close"],[3,"innerHTML"]],template:function(h,f){1&h&&(d.TgZ(0,"h4",0),d._uU(1),d.qZA(),d.TgZ(2,"div",1),d.YNc(3,C,1,1,"div",2),d.qZA(),d._UZ(4,"hr"),d.TgZ(5,"div")(6,"button",3),d._uU(7),d.qZA(),d.TgZ(8,"button",4),d._uU(9),d.qZA()()),2&h&&(d.xp6(1),d.hij("",f.question.question," "),d.xp6(2),d.Q6J("ngIf",f.question.details),d.xp6(4),d.Oqu(f.question.cancelLabel),d.xp6(1),d.Q6J("mat-dialog-close",!0),d.xp6(1),d.Oqu(f.question.okLabel))},dependencies:[g.O5,a.ZT,a.uh,a.xY],encapsulation:2}),l})(),e=(()=>{class l{constructor(h){this.dialogs=h}confirm(h,f,F="Cancel",m="OK"){const p=new v(h,f,F,m);return this.dialogs.open(_,{data:p,autoFocus:!1}).afterClosed()}}return l.\u0275fac=function(h){return new(h||l)(d.LFG(a.uw))},l.\u0275prov=d.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},8782:(w,A,c)=>{c.d(A,{X:()=>a});class a{constructor(g){this.validator=g,this.errors=void 0}triggerValidation(){const g=this.validate(this.getModel());return g?(this.showErrors(g),!1):(this.clearErrors(),!0)}clearErrors(){this.errors=void 0}showErrors(g){this.errors=g}validate(g){if(this.validator){const C=this.validator.validate(g);return 0===C.length?null:C}return null}}}}]);