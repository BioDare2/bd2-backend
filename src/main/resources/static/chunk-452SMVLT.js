import{a as Wt,b as Xt}from"./chunk-NIE2ZYPZ.js";import{a as Zt}from"./chunk-LKZSTFDB.js";import{a as te,b as ee,o as ie}from"./chunk-X3OMUHYN.js";import{c as Gt,d as Ht,e as Kt,l as nt}from"./chunk-6HSKS2XP.js";import{i as Qt}from"./chunk-I5BPRPCG.js";import{k as Yt}from"./chunk-K5NGWSTH.js";import{E as j,F as Vt,G as Ut,d as Bt,f as I,i as Y,j as W,n as X,o as zt,r as tt,s as Jt,t as et,u as it,v as rt,w as at,y as jt,z as qt}from"./chunk-2RPFGIFO.js";import{$a as d,B as k,C as yt,Cc as $t,Da as L,E as gt,F as St,Gb as _t,Ha as O,Ia as xt,J as N,Ja as Et,Ka as Dt,Kb as pt,Lb as ut,Na as Z,Q as bt,R as vt,U as J,Ua as Rt,Va as Mt,Wa as $,X as K,Xa as M,Y as Pt,Ya as F,Za as f,_ as V,_a as c,ab as x,ba as Tt,ca as wt,e as v,eb as Ft,fc as kt,gb as It,hb as U,hc as Lt,j as ct,k as _,lb as Nt,mb as Ot,nb as At,p as ft,t as R,u as q,vb as p,wb as Q,ya as u,yb as Ct,zb as dt}from"./chunk-EXZ64TUM.js";function ue(r,i){if(r&1&&(c(0,"div",0),x(1,"canvas",1),d()),r&2){let o=U();u(),f("type","line")("datasets",o.dataset.traces)("options",o.scatterOptions)}}var re=(()=>{let i=class i{constructor(){this.scatterOptions={scales:{xAxes:{type:"linear",position:"bottom"}},legend:{display:!0,position:"bottom"}}}set data(t){this.dataset=t}ngOnInit(){}chartClicked(t){}chartHovered(t){}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=O({type:i,selectors:[["bd2-ts-plot"]],inputs:{data:"data"},standalone:!1,decls:1,vars:1,consts:[[2,"display","block"],["baseChart","","width","auto","height","200",3,"type","datasets","options"]],template:function(e,a){e&1&&Rt(0,ue,2,3,"div",0),e&2&&Mt(a.dataset?0:-1)},dependencies:[Wt],encapsulation:2});let r=i;return r})();var A=class{constructor(i,o){this.x=i,this.y=o}},ot=class{constructor(){this.fill=!1,this.data=[]}},st=class{constructor(){this.traces=[],this.totalTraces=0}};function fe(r,i){if(r&1&&(c(0,"div")(1,"h4"),p(2),d(),x(3,"bd2-ts-plot",0),d()),r&2){let o=i.$implicit,t=i.$index;u(2),Ct("",t+1,". ",o.title),u(),f("data",o)}}var Ue=(()=>{let i=class i{constructor(){this.tracesPerPlot=7,this.datasets=[]}set data(t){if(!t)return;let e=this.split(t,this.tracesPerPlot).map(a=>{let n=new st;return n.traces=a,n});this.datasets=e}ngOnInit(){}trackByIx(t,e){return t}split(t,e){let a=[],n=0;for(;n+e<t.length;n+=e){let s=t.slice(n,n+e);a.push(s)}return n<t.length&&a.push(t.slice(n,t.length)),a}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=O({type:i,selectors:[["bd2-ts-plots"]],inputs:{tracesPerPlot:"tracesPerPlot",data:"data"},standalone:!1,decls:2,vars:0,consts:[[3,"data"]],template:function(e,a){e&1&&M(0,fe,4,3,"div",null,a.trackByIx,!0),e&2&&F(a.datasets)},dependencies:[re],encapsulation:2});let r=i;return r})();function ae(r){let i=r.timeStart,o=r.timeEnd;return i<0?{validTimeScale:"Start time must >= 0"}:o<0?{validTimeScale:"End time must >= 0"}:o>0&&i>=o?{validTimeScale:"Start time must be < end time"}:null}var P=class r{constructor(i,o,t,e,a,n,s=!1,l=!1,m=!1){this.detrending=t,this.normalisation=e,this.align=a,this.page=n,this.log2=s,this.trimFirst=l,this.hourly=m,this.timeScale={timeStart:i,timeEnd:o},this.page=n||r.firstPage()}get timeStart(){return this.timeScale.timeStart}get timeEnd(){return this.timeScale.timeEnd}get timeScaleLabel(){let i=""+this.timeStart;i==="0"&&(i="min");let o=""+this.timeEnd;return o==="0"&&(o="max"),`${i} to ${o}`}static firstPage(){let i=new Ht;return i.pageIndex=0,i.pageSize=50,i}static equalsPages(i,o){return i?o?i.pageIndex===o.pageIndex&&i.pageSize===o.pageSize:!1:!o}isValid(){return!(this.timeScale.timeStart<0||this.timeScale.timeEnd<0||this.timeScale.timeEnd>0&&this.timeScale.timeStart>=this.timeScale.timeEnd)}equals(i){return!(!i||!this.equalsView(i)||this.detrending!==i.detrending||!this.equalsPage(i.page))}equalsView(i){return!(!i||this.timeScale.timeStart!==i.timeScale.timeStart||this.timeScale.timeEnd!==i.timeScale.timeEnd||this.normalisation!==i.normalisation||this.align!==i.align||this.log2!==i.log2||this.trimFirst!==i.trimFirst||this.hourly!==i.hourly)}equalsPage(i){return r.equalsPages(this.page,i)}clone(){return new r(this.timeStart,this.timeEnd,this.detrending,this.normalisation,this.align,this.page,this.log2,this.trimFirst,this.hourly)}setAll(i){Object.assign(this,i),this.timeScale.timeStart=i.timeScale?i.timeScale.timeStart:i.timeStart,this.timeScale.timeEnd=i.timeScale?i.timeScale.timeEnd:i.timeEnd}};var h=class h{constructor(i,o){this._name=i,this._label=o}get name(){return this._name}get label(){return this._label}static get(i){return h.getValuesMap().get(i)}static getValuesMap(){if(!h.valuesMap){let i=new Map;h.values.forEach(o=>i.set(o.name,o)),h.valuesMap=i}return h.valuesMap}toJSON(){return this.name}equals(i){return i?this===i||this===h.get(i.name?i.name:i):!1}};h.NO_DTR=new h("NO_DTR","no dtr"),h.LIN_DTR=new h("LIN_DTR","linear dtr"),h.POLY_DTR=new h("POLY_DTR","cubic dtr"),h.BASE_DTR=new h("BASE_DTR","baseline dtr"),h.BAMP_DTR=new h("BAMP_DTR","amp&baseline dtr"),h.values=[h.NO_DTR,h.LIN_DTR,h.POLY_DTR,h.BASE_DTR,h.BAMP_DTR];var T=h,ne=[T.NO_DTR,T.LIN_DTR,T.POLY_DTR,T.BASE_DTR,T.BAMP_DTR],E=class{constructor(i,o){this.name=i,this.label=o}},G=[new E("NO_NORM","none"),new E("RANGE","to [-1,1]"),new E("FOLD","fold change"),new E("Z_SCORE","Z-Score"),new E("MAX_NORM","to extreme")],H=[new E("NONE","none"),new E("MEAN","mean"),new E("SPREAD","spread")];var ye=["PERIOD","PHASE","AMP","ERR"],ge=["R_TAU","R_PVALUE","R_PEAK","R_PERIOD"];function oe(r,i){return!(!r||!i||r.active!==i.active||r.direction!==i.direction||ye.includes(r.active)&&r.ppaJobId!==i.ppaJobId||ge.includes(r.active)&&r.rhythmJobId!==i.rhythmJobId)}var Se=["dataPaginator"],le=(()=>{let i=class i{set disabled(t){t?this.mainForm.disable():this.mainForm.enable(),this._disabled=t}get disabled(){return this._disabled}constructor(t){this.fb=t,this.totalTraces=0,this.currentPage=P.firstPage(),this.displayParams=new Z,this._disabled=!1,this.disabledPagination=!1,this.page$=new _(P.firstPage()),this.displayParamsForm=this.buildDisplayParamsForm(),this.mainForm=this.buildMainForm(),this.detrendingOptions=ne,this.normalisationOptions=G,this.alignOptions=H}ngOnInit(){this.initDisplayParamsStream()}ngOnDestroy(){this.displayParamsSubscription&&this.displayParamsSubscription.unsubscribe(),this.displayParams&&this.displayParams.complete()}initDisplayParamsStream(){let t=yt(this.displayParamsForm.valueChanges,this.displayParamsForm.statusChanges).pipe(bt([this.displayParamsForm.value,this.displayParamsForm.status]),k(([a,n])=>n==="VALID"&&a),R(([a,n])=>a)),e=q([t,this.page$]).pipe(R(([a,n])=>new P(a.timeScale.timeStart,a.timeScale.timeEnd,T.get(a.detrending),a.normalisation,a.align,n,a.log2,a.trimFirst,a.hourly)),k(a=>a.isValid()),N((a,n)=>n.equals(a)));this.displayParamsSubscription=e.subscribe(a=>this.displayParams.next(a))}buildDisplayParamsForm(){return this.fb.group({timeScale:this.fb.group({timeStart:[0,[I.required]],timeEnd:[0,[I.required]]},{validator:t=>ae(t.value)}),detrending:[this.defaultDetrending(),[I.required]],normalisation:[G[0].name,[I.required]],align:[H[0].name,[I.required]],log2:[!1],trimFirst:[!0],hourly:[!1]})}defaultDetrending(){return T.LIN_DTR.name}buildMainForm(){return this.displayParamsForm}loadDataPage(t){this.page$.next(t)}ngAfterViewInit(){this.dataPaginator&&(this.dataPaginator._intl=new Gt,this.dataPaginator._intl.itemsPerPageLabel="Series per page")}};i.\u0275fac=function(e){return new(e||i)(L(j))},i.\u0275dir=Et({type:i,viewQuery:function(e,a){if(e&1&&Nt(Se,7),e&2){let n;Ot(n=At())&&(a.dataPaginator=n.first)}}});let r=i;return r})();var ve=()=>[10,25,50,100,200];function Pe(r,i){if(r&1&&(c(0,"option",16),p(1),d()),r&2){let o=i.$implicit;f("value",o.name),u(),Q(o.label)}}function Te(r,i){if(r&1&&(c(0,"option",16),p(1),d()),r&2){let o=i.$implicit;f("value",o.name),u(),Q(o.label)}}function we(r,i){if(r&1&&(c(0,"option",16),p(1),d()),r&2){let o=i.$implicit;f("value",o.name),u(),Q(o.label)}}var li=(()=>{let i=class i extends le{constructor(t){super(t)}};i.\u0275fac=function(e){return new(e||i)(L(j))},i.\u0275cmp=O({type:i,selectors:[["bd2-tsdisplay-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},standalone:!1,features:[Dt],decls:50,vars:7,consts:[["dataPaginator",""],["role","form",1,"form-horizontal","container",3,"formGroup"],[1,"row"],[1,"col-md-8","col-sm-10"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-md-3","col-sm-3"],["for","timeStart",1,"col-md-1","col-sm-2"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-md-1","col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"col-md-2","col-sm-4"],["formControlName","hourly",1,"mr-3"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-3"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value"],[1,"col-sm-1"],["for","align",1,"col-sm-1"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-2"],["for","normalisation"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],[1,"col-sm"],["formControlName","trimFirst",1,"mr-3"],["formControlName","log2"],[1,"col-sm-8"],[3,"page","length","disabled","pageSize","pageIndex","pageSizeOptions"]],template:function(e,a){if(e&1){let n=Ft();c(0,"form",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"label",5),p(5,"Time range"),d(),c(6,"label",6),p(7,"from:"),d(),c(8,"div",5),x(9,"input",7),d(),c(10,"label",8),p(11,"to:"),d(),c(12,"div",5),x(13,"input",9),d()()(),c(14,"div",10)(15,"mat-slide-toggle",11),p(16,"hourly"),d()()(),c(17,"div",12)(18,"label",13),p(19,"Detrending"),d(),c(20,"div",14)(21,"select",15),M(22,Pe,2,2,"option",16,$),d()(),x(24,"div",17),c(25,"label",18),p(26,"Align"),d(),c(27,"div",14)(28,"select",19),M(29,Te,2,2,"option",16,$),d()()(),c(31,"div",12)(32,"div",20)(33,"label",21),p(34,"Normalize"),d()(),c(35,"div",14)(36,"select",22),M(37,we,2,2,"option",16,$),d()(),c(39,"div",23)(40,"mat-slide-toggle",24),p(41,"within range"),d(),c(42,"mat-slide-toggle",25),p(43,"log2 transf."),d()()(),x(44,"div",12),c(45,"div",12),x(46,"label",20),c(47,"div",26)(48,"mat-paginator",27,0),It("page",function(l){return Tt(n),wt(a.loadDataPage(l))}),d()()()()}e&2&&(f("formGroup",a.mainForm),u(22),F(a.detrendingOptions),u(7),F(a.alignOptions),u(8),F(a.normalisationOptions),u(11),f("length",a.totalTraces)("disabled",a.disabledPagination)("pageSize",a.currentPage.pageSize)("pageIndex",a.currentPage.pageIndex)("pageSizeOptions",_t(6,ve)))},dependencies:[X,rt,at,Bt,zt,it,Y,W,qt,jt,tt,et,Jt,Kt,nt],encapsulation:2});let r=i;return r})();var me=(()=>{let i=class i{constructor(t){this.BD2REST=t}loadDataSet(t,e,a,n){return this.BD2REST.tsdata(t.id,e,a,n)}loadHourlyDataSet(t,e,a,n){return this.BD2REST.tsHourlyData(t.id,e,a,n)}exportURL(t,e){return this.BD2REST.tsdataExportURL(t.id,e.detrending)}dataMetrics(t){return this.BD2REST.tsdataMetrics(t.id)}};i.\u0275fac=function(e){return new(e||i)(V($t))},i.\u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"});let r=i;return r})();var lt=class{constructor(i,o,t=0,e=P.firstPage(),a){this.params=i,this.data=o,this.totalTraces=t,this.currentPage=e,this.sorting=a}},ce=(()=>{let i=class i{constructor(t,e=!1){this.tsDataService=t,this.error$=new ct,this.loading$=new ct,this.addTraceNr=!0,this.addTraceRef=!0,this.dataSetsStream=new _(void 0),this.sortStream=new _({}),this.experiment$=new _(void 0);let a=new P(0,0,T.LIN_DTR,G[0].name,H[0].name,P.firstPage());this.displayParamsStream=new _(a),e?this.slowParameters$=this.displayParamsStream.pipe(k(n=>!!n)):this.slowParameters$=this.displayParamsStream.pipe(St(400),k(n=>!!n)),this.initObservables()}changeDisplayParams(t){this.displayParamsStream.next(t)}experiment(t){this.experiment$.next(t)}sort(t){t&&this.sortStream.next(t)}ngOnDestroy(){this.displayParamsStream.complete(),this.sortStream.complete(),this.dataSetsStream.complete(),this.error$.complete(),this.experiment$.complete(),this.loading$.complete()}initObservables(){this.initDataSetsStream(),this.seriesPackStream=this.initSeriesPackStream(this.dataSetsStream)}initDataSetsStream(){let t=this.slowParameters$.pipe(R(l=>l.page),N((l,m)=>P.equalsPages(l,m))),e=this.experiment$.pipe(k(l=>!!l)),a=this.slowParameters$.pipe(R(l=>l.detrending),N((l,m)=>m.equals(l))),n=this.slowParameters$.pipe(R(l=>l.hourly),N()),s=this.sortStream.pipe(N(oe));q([e,a,n,t,s]).pipe(J(l=>this.loading$.next(!0)),vt(([l,m,S,y,b])=>this.loadDataSet(l,m,S,y,b)),J(l=>this.loading$.next(!1))).subscribe(l=>this.dataSetsStream.next(l),l=>console.log("Error should not propagate here",l))}initSeriesPackStream(t){let e=this.slowParameters$.pipe(N((a,n)=>n.equalsView(a)));return q([t,e]).pipe(R(([a,n])=>this.processDataSet(a,n)),J(a=>this.current=a))}loadDataSet(t,e,a,n,s){let l;return a?l=this.tsDataService.loadHourlyDataSet(t,e,n,s):l=this.tsDataService.loadDataSet(t,e,n,s),l.pipe(J(m=>{m.detrending=m.detrending||e,m.sort=s}),J(m=>m.traces.forEach(S=>this.enrichLabel(S,this.addTraceNr,this.addTraceRef))),gt(m=>(console.log("Caught error",m),this.error$.next(m),ft(void 0))))}enrichLabel(t,e,a){e&&a?t.label=`${t.traceNr}.${t.traceRef} ${t.label}`:e&&(t.label=`${t.traceNr}. ${t.label}`)}getFullDataSet(t,e,a){let n={pageIndex:0,pageSize:5e4};return e=e.clone(),e.timeScale.timeStart=0,e.timeScale.timeEnd=0,this.loadDataSet(t,e.detrending,e.hourly,n,a).pipe(R(s=>this.processDataSet(s,e)))}processDataSet(t,e){if(t){let a=this.processDataTraces(t.traces,e);return e=e.clone(),e.detrending=t.detrending,new lt(e,a,t.totalTraces,t.currentPage,t.sort)}else return new lt(e,[],0,P.firstPage(),{})}processDataTraces(t,e){return e.trimFirst&&(t=this.trimData(t,e)),t=this.logData(t,e),t=this.normalizeData(t,e),e.trimFirst||(t=this.trimData(t,e)),t=this.alignData(t,e),t}normalizeData(t,e){return t.map(a=>this.normalizeTrace(a,e))}normalizeTrace(t,e){switch(e.normalisation){case"MEAN_NORM":return this.normalizeTraceToMean(t);case"MAX_NORM":return this.normalizeTraceToMax(t);case"RANGE":return this.normalizeTraceToRange(t);case"FOLD":return this.normalizeTraceToFoldChange(t);case"Z_SCORE":return this.normalizeTraceToZScore(t);default:return t}}normalizeTraceToMean(t){return this.normalizeTraceToFactor(t,t.mean)}normalizeTraceToMax(t){return this.normalizeTraceToFactor(t,Math.max(t.max,-t.min))}normalizeTraceToFactor(t,e){if(e===0)return t;let a=this.copyTrace(t);return a.data=t.data.map(n=>new A(n.x,n.y/e)),a.min=t.min/e,a.max=t.max/e,a.mean=t.mean/e,a}normalizeTraceToRange(t){let e=this.copyTrace(t),a=t.mean,n=Math.max(t.max-t.mean,Math.abs(t.min-t.mean));return e.data=t.data.map(s=>new A(s.x,(s.y-a)/n)),e.min=(t.min-a)/n,e.max=(t.max-a)/n,e.mean=0,e}normalizeTraceToFoldChange(t){return t.min>0?this.normalizeTraceToFactor(t,t.min):this.emptyTrace(t)}normalizeTraceToZScore(t){if(t.data.length<2)return t;let e=t.data.reduce((l,m)=>l+m.y,0)/t.data.length,a=t.data.reduce((l,m)=>l+Math.pow(m.y-e,2),0),n=Math.sqrt(a/(t.data.length-1)),s=this.copyTrace(t);return s.data=t.data.map(l=>new A(l.x,(l.y-e)/n)),this.updateMinMax(s),s}emptyTrace(t){let e=this.copyTrace(t);return e.data=[],e.min=NaN,e.max=NaN,e.mean=NaN,e}copyTrace(t){return Object.assign(new ot,t)}logData(t,e){return e.log2?t.map(a=>this.logTrace(a)):t}logTrace(t){let a=this.copyTrace(t);return a.data=t.data.filter(n=>n.y>=0).map(n=>new A(n.x,Math.log2(n.y+.015625))),this.updateMinMax(a),a}alignData(t,e){return e.align==="MEAN"?t.map(a=>this.zeroTrace(a)):e.align==="SPREAD"?this.spreadMeans(t):t}zeroTrace(t){return this.subTrace(t,t.mean)}subTrace(t,e){let a=this.copyTrace(t);return a.data=t.data.map(n=>new A(n.x,n.y-e)),a.min=t.min-e,a.max=t.max-e,a.mean=t.mean-e,a}trimData(t,e){return t.map(a=>this.trimTrace(a,e)).filter(a=>a.data.length>0)}trimTrace(t,e){if(e.timeStart===0&&e.timeEnd===0)return t;let a=this.copyTrace(t),n=0;if(e.timeStart!==0)for(;n<t.data.length&&!(t.data[n].x>=e.timeStart);n++);let s=t.data.length-1;if(e.timeEnd!==0)for(;s>=0&&!(t.data[s].x<=e.timeEnd);s--);return s++,a.data=t.data.slice(n,s),this.updateMinMax(a),a}spreadMeans(t){let e=[],a=0,n=0;return t.forEach(s=>{let l=Math.max(n,s.mean-s.min),m=a+l;n=s.max-s.mean,e.push(this.subTrace(s,s.mean-m)),a=m}),e}updateMinMax(t){let e=this.minMaxMean(t.data);t.min=e.min,t.max=e.max,t.mean=e.mean}minMaxMean(t){let e={min:NaN,max:NaN,mean:NaN};return t.length===0||(e.min=t[0].y,e.max=t[0].y,e.mean=0,t.forEach(a=>{let n=a.y;n<e.min&&(e.min=n),n>e.max&&(e.max=n),e.mean+=n}),e.mean=e.mean/t.length),e}};i.\u0275fac=function(e){return new(e||i)(V(me),V(Zt,8))},i.\u0275prov=K({token:i,factory:i.\u0275fac});let r=i;return r})();function De(r,i){if(r&1&&(c(0,"option",11),p(1),pt(2,"date"),d()),r&2){let o=i.$implicit,t=U();f("value",o.jobId),u(),dt(" ",o.method,": ",t.shortUUID(o.jobId)," (",ut(2,4,t.toLocalDateTime(o.submitted)),") ")}}function Re(r,i){if(r&1&&(c(0,"option",11),p(1),pt(2,"date"),d()),r&2){let o=i.$implicit,t=U();f("value",o.jobId),u(),dt(" ",t.friendlyRhythmMethod(o.parameters.METHOD),": ",t.shortUUID(o.jobId)," (",ut(2,4,t.toLocalDateTime(o.jobStatus.submitted)),") ")}}var Ri=(()=>{let i=class i{set rhythmJobs(t){this._rhythmJobs=t,this.noRhythm=!t||t.length<1,this.sortParamsForm.get("rhythmJobId").setValue(this.noRhythm?void 0:t[0].jobId)}get rhythmJobs(){return this._rhythmJobs}set ppaJobs(t){this._ppaJobs=t,this.noPPA=!t||t.length<1,this.sortParamsForm.get("ppaJobId").setValue(this.noPPA?void 0:t[0].jobId)}get ppaJobs(){return this._ppaJobs}constructor(t,e){this.fb=t,this.fetcher=e,this.sorting=new Z,this.noPPA=!0,this.noRhythm=!0,this._rhythmJobs=[],this._ppaJobs=[],this.sortParamsForm=this.buildSortParamsForm(t),this.mainForm=this.buildMainForm(this.sortParamsForm,t),this.ppaJobs=[],this.rhythmJobs=[]}ngOnInit(){this.valuesSubscription=this.mainForm.valueChanges.subscribe(t=>{let e=t;e.direction=t.isAscending?"asc":"desc",this.sorting.next(e),this.fetcher&&this.fetcher.sort(e)})}ngOnDestroy(){this.valuesSubscription&&this.valuesSubscription.unsubscribe(),this.sorting&&this.sorting.complete()}buildSortParamsForm(t){return t.group({active:[this.defaultSorting(),[I.required]],isAscending:[!0,[I.required]],ppaJobId:[],rhythmJobId:[]})}buildMainForm(t,e){return t}defaultSorting(){return"NR"}shortUUID(t){return Yt(t)}toLocalDateTime(t){return Qt.deserialize(t).date}friendlyRhythmMethod(t){return t==="BD2JTK"?"JTK":t==="BD2EJTK"?"eJTK":t}};i.\u0275fac=function(e){return new(e||i)(L(j),L(ce,8))},i.\u0275cmp=O({type:i,selectors:[["bd2-tssort-params-rform"]],inputs:{rhythmJobs:"rhythmJobs",ppaJobs:"ppaJobs"},outputs:{sorting:"sorting"},standalone:!1,decls:44,vars:8,consts:[[1,"container"],["role","form",3,"formGroup"],["aria-label","Sorting options","formControlName","active"],[1,"row","mb-1"],[1,"col-lg-2"],[1,"col-lg-4"],["formControlName","isAscending"],[1,"col-lg-5"],["value","NR"],["value","LABEL"],["id","ppa","aria-label","Select period analysis","formControlName","ppaJobId",1,"form-control"],[3,"value"],["value","PERIOD",3,"disabled"],["value","PHASE",3,"disabled"],["value","AMP",3,"disabled"],["value","ERR",3,"disabled"],["id","rhythm","aria-label","Select rhythmicity test","formControlName","rhythmJobId",1,"form-control"],["value","R_TAU",3,"disabled"],["value","R_PEAK",3,"disabled"],["value","R_PERIOD",3,"disabled"]],template:function(e,a){e&1&&(c(0,"div",0)(1,"form",1)(2,"mat-radio-group",2)(3,"div",3)(4,"label",4),p(5,"Sort"),d(),c(6,"div",5)(7,"mat-slide-toggle",6),p(8,"asc."),d()(),c(9,"div",7)(10,"mat-radio-button",8),p(11,"nr."),d(),c(12,"mat-radio-button",9),p(13,"label"),d()()(),c(14,"div",3)(15,"label",4),p(16,"PPA Analysis"),d(),c(17,"div",5)(18,"select",10),M(19,De,3,6,"option",11,$),d()(),c(21,"div",7)(22,"mat-radio-button",12),p(23,"period"),d(),c(24,"mat-radio-button",13),p(25,"phase"),d(),c(26,"mat-radio-button",14),p(27,"amp."),d(),c(28,"mat-radio-button",15),p(29,"err"),d()()(),c(30,"div",3)(31,"label",4),p(32,"Rhythmicity Test"),d(),c(33,"div",5)(34,"select",16),M(35,Re,3,6,"option",11,$),d()(),c(37,"div",7)(38,"mat-radio-button",17),p(39,"signif."),d(),c(40,"mat-radio-button",18),p(41,"peak"),d(),c(42,"mat-radio-button",19),p(43,"length"),d()()()()()()),e&2&&(u(),f("formGroup",a.mainForm),u(18),F(a.ppaJobs),u(3),f("disabled",a.noPPA),u(2),f("disabled",a.noPPA),u(2),f("disabled",a.noPPA),u(2),f("disabled",a.noPPA),u(7),F(a.rhythmJobs),u(3),f("disabled",a.noRhythm),u(2),f("disabled",a.noRhythm),u(2),f("disabled",a.noRhythm))},dependencies:[X,rt,at,it,Y,W,tt,et,te,ee,nt,kt],styles:["mat-radio-button[_ngcontent-%COMP%]{margin-right:.5em}"]});let r=i;return r})();var Ji=(()=>{let i=class i{};i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=xt({type:i}),i.\u0275inj=Pt({imports:[Lt,Vt,Ut,Xt,ie]});let r=i;return r})();var ht=(()=>{if(typeof self>"u")return!1;if(!("top"in self&&self!==top)){if("showOpenFilePicker"in self)return"showOpenFilePicker"}return!1})(),qi=ht?Promise.resolve().then(function(){return Ne}):Promise.resolve().then(function(){return Le});var Vi=ht?Promise.resolve().then(function(){return Ae}):Promise.resolve().then(function(){return Be});var Me=ht?Promise.resolve().then(function(){return _e}):Promise.resolve().then(function(){return Je});function Ui(...r){return v(this,null,function*(){return(yield Me).default(...r)})}var Fe=r=>v(null,null,function*(){let i=yield r.getFile();return i.handle=r,i}),Ie=(...i)=>v(null,[...i],function*(r=[{}]){Array.isArray(r)||(r=[r]);let o=[];r.forEach((a,n)=>{o[n]={description:a.description||"Files",accept:{}},a.mimeTypes?a.mimeTypes.map(s=>{o[n].accept[s]=a.extensions||[]}):o[n].accept["*/*"]=a.extensions||[]});let t=yield window.showOpenFilePicker({id:r[0].id,startIn:r[0].startIn,types:o,multiple:r[0].multiple||!1,excludeAcceptAllOption:r[0].excludeAcceptAllOption||!1}),e=yield Promise.all(t.map(Fe));return r[0].multiple?e:e[0]}),Ne={__proto__:null,default:Ie};function mt(r){function i(o){if(Object(o)!==o)return Promise.reject(new TypeError(o+" is not an object."));var t=o.done;return Promise.resolve(o.value).then(function(e){return{value:e,done:t}})}return mt=function(o){this.s=o,this.n=o.next},mt.prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(o){var t=this.s.return;return t===void 0?Promise.resolve({value:o,done:!0}):i(t.apply(this.s,arguments))},throw:function(o){var t=this.s.return;return t===void 0?Promise.reject(o):i(t.apply(this.s,arguments))}},new mt(r)}var de=(e,a,...n)=>v(null,[e,a,...n],function*(r,i,o=r.name,t){let s=[],l=[];var m,S=!1,y=!1;try{for(var b,C=function(g){var D,w,z,pe=2;for(typeof Symbol<"u"&&(w=Symbol.asyncIterator,z=Symbol.iterator);pe--;){if(w&&(D=g[w])!=null)return D.call(g);if(z&&(D=g[z])!=null)return new mt(D.call(g));w="@@asyncIterator",z="@@iterator"}throw new TypeError("Object is not async iterable")}(r.values());S=!(b=yield C.next()).done;S=!1){let g=b.value,D=`${o}/${g.name}`;g.kind==="file"?l.push(g.getFile().then(w=>(w.directoryHandle=r,w.handle=g,Object.defineProperty(w,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>D})))):g.kind!=="directory"||!i||t&&t(g)||s.push(de(g,i,D,t))}}catch(g){y=!0,m=g}finally{try{S&&C.return!=null&&(yield C.return())}finally{if(y)throw m}}return[...(yield Promise.all(s)).flat(),...yield Promise.all(l)]}),Oe=(...i)=>v(null,[...i],function*(r={}){r.recursive=r.recursive||!1,r.mode=r.mode||"read";let o=yield window.showDirectoryPicker({id:r.id,startIn:r.startIn,mode:r.mode});return de(o,r.recursive,void 0,r.skipDirectory)}),Ae={__proto__:null,default:Oe},Ce=(a,...n)=>v(null,[a,...n],function*(r,i=[{}],o=null,t=!1,e=null){Array.isArray(i)||(i=[i]),i[0].fileName=i[0].fileName||"Untitled";let s=[],l=null;if(r instanceof Blob&&r.type?l=r.type:r.headers&&r.headers.get("content-type")&&(l=r.headers.get("content-type")),i.forEach((y,b)=>{s[b]={description:y.description||"Files",accept:{}},y.mimeTypes?(b===0&&l&&y.mimeTypes.push(l),y.mimeTypes.map(C=>{s[b].accept[C]=y.extensions||[]})):l?s[b].accept[l]=y.extensions||[]:s[b].accept["*/*"]=y.extensions||[]}),o)try{yield o.getFile()}catch(y){if(o=null,t)throw y}let m=o||(yield window.showSaveFilePicker({suggestedName:i[0].fileName,id:i[0].id,startIn:i[0].startIn,types:s,excludeAcceptAllOption:i[0].excludeAcceptAllOption||!1}));!o&&e&&e(m);let S=yield m.createWritable();return"stream"in r?(yield r.stream().pipeTo(S),m):"body"in r?(yield r.body.pipeTo(S),m):(yield S.write(yield r),yield S.close(),m)}),_e={__proto__:null,default:Ce},ke=(...i)=>v(null,[...i],function*(r=[{}]){return Array.isArray(r)||(r=[r]),new Promise((o,t)=>{let e=document.createElement("input");e.type="file";let a=[...r.map(m=>m.mimeTypes||[]),...r.map(m=>m.extensions||[])].join();e.multiple=r[0].multiple||!1,e.accept=a||"",e.style.display="none",document.body.append(e);let n=m=>{typeof s=="function"&&s(),o(m)},s=r[0].legacySetup&&r[0].legacySetup(n,()=>s(t),e),l=()=>{window.removeEventListener("focus",l),e.remove()};e.addEventListener("click",()=>{window.addEventListener("focus",l)}),e.addEventListener("change",()=>{window.removeEventListener("focus",l),e.remove(),n(e.multiple?Array.from(e.files):e.files[0])}),"showPicker"in HTMLInputElement.prototype?e.showPicker():e.click()})}),Le={__proto__:null,default:ke},$e=(...i)=>v(null,[...i],function*(r=[{}]){return Array.isArray(r)||(r=[r]),r[0].recursive=r[0].recursive||!1,new Promise((o,t)=>{let e=document.createElement("input");e.type="file",e.webkitdirectory=!0;let a=s=>{typeof n=="function"&&n(),o(s)},n=r[0].legacySetup&&r[0].legacySetup(a,()=>n(t),e);e.addEventListener("change",()=>{let s=Array.from(e.files);r[0].recursive?r[0].recursive&&r[0].skipDirectory&&(s=s.filter(l=>l.webkitRelativePath.split("/").every(m=>!r[0].skipDirectory({name:m,kind:"directory"})))):s=s.filter(l=>l.webkitRelativePath.split("/").length===2),a(s)}),"showPicker"in HTMLInputElement.prototype?e.showPicker():e.click()})}),Be={__proto__:null,default:$e},ze=(o,...t)=>v(null,[o,...t],function*(r,i={}){Array.isArray(i)&&(i=i[0]);let e=document.createElement("a"),a=r;"body"in r&&(a=yield function(l,m){return v(this,null,function*(){let S=l.getReader(),y=new ReadableStream({start:g=>function D(){return v(this,null,function*(){return S.read().then(({done:w,value:z})=>{if(!w)return g.enqueue(z),D();g.close()})})}()}),b=new Response(y),C=yield b.blob();return S.releaseLock(),new Blob([C],{type:m})})}(r.body,r.headers.get("content-type"))),e.download=i.fileName||"Untitled",e.href=URL.createObjectURL(yield a);let n=()=>{typeof s=="function"&&s()},s=i.legacySetup&&i.legacySetup(n,()=>s(),e);return e.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(e.href),3e4),n()}),e.click(),null}),Je={__proto__:null,default:ze};export{P as a,A as b,ot as c,st as d,T as e,E as f,ce as g,Ui as h,re as i,Ue as j,le as k,li as l,Ri as m,Ji as n};
