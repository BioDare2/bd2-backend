import{b as ee,k as q,l as Xt,n as Yt,o as v,p as Zt}from"./chunk-DORUMKOX.js";import{d as At,e as $t}from"./chunk-K3MGPV5B.js";import{a as Ut,b as Wt,g as Ht,j as zt,k as jt,l as Qt,m as Gt,n as qt,o as Kt}from"./chunk-ET5TKZBH.js";import{b as Mt,c as Pt}from"./chunk-EZ5WBWOW.js";import"./chunk-EYDQJRZM.js";import"./chunk-3ZZ3OJBF.js";import{a as Nt,b as Lt,c as Et,d as Ft,e as Bt,f as Vt,g as Ot}from"./chunk-3DGRJVY4.js";import{A as Oe,c as je,d as Qe,e as _t,n as Re,o as ke,p as Me,q as yt,r as Ne,s as Le,t as It,u as Ee,v as Fe,w as Rt,x as Be,y as Ve,z as kt}from"./chunk-KOYIGQQW.js";import{a as ye,l as gt,n as bt,p as St,q as Ct,s as vt,t as Tt}from"./chunk-ZV7YAFTP.js";import{a as Te,c as ft,g as $,i as ht,l as Ie,n as wt}from"./chunk-63EJLF7N.js";import{a as ve}from"./chunk-6UWHHRT4.js";import{F as dt,G as ut,H as k,I as xt,J as F,K as Dt,d as le,i as K,j as Ce,k as we,l as st,m as se,n as xe,o as mt,q as ct,z as pt}from"./chunk-LPDAYVF7.js";import{R as De,X as me,a as P}from"./chunk-24L4UUKZ.js";import{Ab as R,B as We,Bb as g,Bc as re,Ca as a,Cb as be,Da as C,Db as nt,Eb as B,Fb as V,Gb as O,Hb as Se,Ib as He,J as Ze,L as Je,Lb as ot,Ma as w,Mb as at,Na as ge,Oa as it,Pa as H,Q as et,R as tt,Sa as u,Wa as c,X as ne,Xa as G,Y as he,Za as oe,_ as J,ac as z,bc as D,db as l,dc as rt,ea as _,eb as s,fa as h,fb as x,gb as T,gc as lt,hb as y,j as $e,jb as S,k as _e,la as U,mb as b,o as Xe,ob as p,t as ue,tb as N,u as Ye,ub as L,vb as E,xc as ze,yb as ae,zb as m}from"./chunk-Z4WVEEB6.js";var W=class n{constructor(o=new Qe,e=new Qe){this.rowPage=o,this.colPage=e}static firstPage(){let o=new n;return o.rowPage.pageIndex=0,o.rowPage.pageSize=50,o.colPage.pageIndex=0,o.colPage.pageSize=50,o}static pageEquals(o,e){return o.pageIndex===e.pageIndex&&o.pageSize===e.pageSize}equals(o){return o?n.pageEquals(this.rowPage,o.rowPage)&&n.pageEquals(this.colPage,o.colPage):!1}};var ei=(()=>{class n{constructor(e){this.BD2REST=e}uploadFile(e){let i=new FormData;return i.append("file",e,e.name),this.BD2REST.fileUpload(i).then(t=>t.id)}static{this.\u0275fac=function(i){return new(i||n)(J(re))}}static{this.\u0275prov=ne({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var ce=(()=>{class n{constructor(e,i){this.uploadService=e,this.BD2REST=i}uploadFile(e,i){return Xe(this.uploadService.uploadFile(e)).pipe(Je(t=>this.verifyFormat(i,t).pipe(ue(r=>t))))}verifyFormat(e,i){return this.BD2REST.fileViewVerifyFormat(e,i)}getTableSlice(e,i,t){return this.BD2REST.fileViewTableSlice(e,i,t)}previewLabels(e,i,t,r){let d=new W;return r?(d.rowPage.pageSize=500,d.rowPage.pageIndex=0,d.colPage.pageSize=1,d.colPage.pageIndex=t.colIx):(d.rowPage.pageSize=1,d.rowPage.pageIndex=t.rowIx,d.colPage.pageSize=500,d.colPage.pageIndex=0),this.getTableSlice(e,i,d).pipe(ue(f=>{let A=[];return f.data.forEach(Y=>Y.forEach(Z=>A.push(""+Z))),A}))}static{this.\u0275fac=function(i){return new(i||n)(J(ei),J(re))}}static{this.\u0275prov=ne({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var M=(()=>{class n{constructor(e){this.tsFileService=e,this.tableSlice$=new _e(void 0),this.slice$=new _e(void 0),this.fileIdFormat$=new _e(void 0),this.error$=new $e,this.dataSlice$=this.tableSlice$.asObservable().pipe(We(i=>i!=null&&i!==void 0)),this.initDataStream()}close(){this.slice$.complete(),this.fileIdFormat$.complete(),this.tableSlice$.complete(),this.error$.complete()}slice(e){e&&this.slice$.next(e)}fileIdFormat(e){e&&e[0]&&e[1]&&this.fileIdFormat$.next(e)}sameParams([[e,i],t],[[r,d],f]){return e==r&&i==d&&t.equals(f)}initDataStream(){Ye([this.fileIdFormat$,this.slice$]).pipe(We(([i,t])=>i&&!!t),Ze(this.sameParams)).pipe(tt(([i,t])=>this.tsFileService.getTableSlice(i[0],i[1],t))).subscribe(i=>this.tableSlice$.next(i),i=>this.error$.next(i))}static{this.\u0275fac=function(i){return new(i||n)(J(ce))}}static{this.\u0275prov=ne({token:n,factory:n.\u0275fac})}}return n})();function gi(n,o){if(n&1&&(l(0,"mat-option",9),m(1),s()),n&2){let e=o.$implicit;c("value",e),a(),R(e.label)}}function bi(n,o){n&1&&(l(0,"div",10),m(1," An Excel file in which one column contains time values while other columns contain measurements taken at the corresponding times. "),l(2,"ul")(3,"li"),m(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes from start, seconds from start, or as image nr (1-based) which will be converted to time using interval between images. "),s(),l(5,"li"),m(6," Not all columns have to be imported. "),s(),l(7,"li"),m(8," First few rows can contain arbitrary text. "),s(),l(9,"li"),m(10," Values from one row can be used as data labels. "),s()()())}function Si(n,o){n&1&&(l(0,"div",10),m(1," A coma or tab separeted file in which one column or row contains time values while other columns or rows contain measurements taken at the corresponding times. "),l(2,"ul")(3,"li"),m(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes or seconds from start, or as image numbers "),s(),l(5,"li"),m(6," Not all columns/rows have to be imported. "),s(),l(7,"li"),m(8," First few rows/columns can contain arbitrary text. "),s(),l(9,"li"),m(10," Values from one row/column can be used as data labels. "),s()()())}function Ci(n,o){n&1&&(l(0,"div",10),m(1," Topcount data can be uploaded in two forms: "),l(2,"ul")(3,"li"),m(4,"Individual file which contains concatenated topcount data blocks in one file"),s(),l(5,"li"),m(6,"Zip file which contains packed files from individual topcount reads"),s()(),m(7,' Check the Dosc section for details about suported data layouts inside tomcats file, we can currently read ASCI content with "plate map" or "column" layouts. '),s())}function wi(n,o){if(n&1&&(l(0,"div",11),m(1),s()),n&2){let e=p();a(),g(" ",e.formatWarning," ")}}var ti=(()=>{class n{constructor(){this.blocked=!1,this.uploadFiles=new U,this.importFormatOptions=Xt,this.importFormat=q.EXCEL_TABLE}ngOnInit(){}upload(e){this.uploadFiles.next({files:e,importFormat:this.importFormat})}formatChanged(e){this.lastFiles&&this.checkFormat(this.lastFiles)}checkFormat(e){this.lastFiles=e,this.formatWarning=void 0,e.forEach(i=>{if(this.importFormat===q.TOPCOUNT){let t=this.isTopCount(i);t&&(this.formatWarning="The selected file does not seem to be a topcount file/archive but rather: "+t+". If you sure it is a valid topcount file/archive you can continue upload.")}else if(this.importFormat===q.EXCEL_TABLE){let t=this.isExcel(i);t&&(this.formatWarning="The selected file does not seem to be an excel file but rather: "+t+". If you sure it is a valid excel file you can continue upload.")}else if(this.importFormat===q.TAB_SEP){let t=this.isTab(i);t&&(this.formatWarning="The selected file does not seem to be a tab-separated file but rather: "+t+". If you sure it is a valid tsv file you can continue upload.")}else if(this.importFormat===q.COMA_SEP){let t=this.isComa(i);t&&(this.formatWarning="The selected file does not seem to be a coma-separated file but rather: "+t+". If you sure it is a valid csv file you can continue upload.")}})}isTopCount(e){let i=e.name,t=e.type;return i?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".tsv")?"tab separated":null):"Unknown"}isExcel(e){let i=e.name,t=e.type;return!t||!i?"Unknown":e.name.endsWith(".csv")?"CSV":e.name.endsWith(".txt")?"text":e.name.endsWith(".tsv")?"tab separated":t.indexOf("excel")>=0||t.indexOf("sheet")>=0?null:t}isTab(e){let i=e.name,t=e.type;return i?(t||(t="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".tsv")?null:"Unrecognized"):"Unknown"}isComa(e){let i=e.name,t=e.type;return i?(t||(t="Unknown"),e.name.endsWith(".tsv")?"tab separated":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".csv")?null:"Unrecognized"):"Unknown"}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-upload-data-file-step"]],outputs:{uploadFiles:"uploadFiles"},standalone:!1,decls:19,vars:9,consts:[["uploadWidget",""],["appearance","outlined",1,"mat-elevation-z4"],[1,""],[1,"form-group"],["required","",3,"valueChange","selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["dismissible","true","style","font-size: smaller;","type","info","class","alert alert-info","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"selectedFiles","uploadFiles","autoReset","blocked","multiple"],[3,"value"],["dismissible","true","type","info","role","alert",1,"alert","alert-info",2,"font-size","smaller"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(i,t){if(i&1){let r=S();l(0,"div")(1,"mat-card",1)(2,"mat-card-title"),m(3,"Time series file"),s(),l(4,"mat-card-content")(5,"form",2)(6,"div",3)(7,"mat-form-field")(8,"mat-label"),m(9,"File Format"),s(),l(10,"mat-select",4),O("valueChange",function(f){return _(r),V(t.importFormat,f)||(t.importFormat=f),h(f)}),b("selectionChange",function(f){return _(r),h(t.formatChanged(f))}),u(11,gi,2,2,"mat-option",5),s()()(),u(12,bi,11,0,"div",6)(13,Si,11,0,"div",6)(14,Ci,8,0,"div",6)(15,wi,2,1,"div",7),l(16,"div",3)(17,"bd2-file-upload-widget",8,0),b("selectedFiles",function(f){return _(r),h(t.checkFormat(f))})("uploadFiles",function(f){return _(r),h(t.upload(f))}),s()()()()()()}i&2&&(a(10),B("value",t.importFormat),a(),c("ngForOf",t.importFormatOptions),a(),c("ngIf",t.importFormat.name=="EXCEL_TABLE"),a(),c("ngIf",t.importFormat.name=="TAB_SEP"||t.importFormat.name=="COMA_SEP"),a(),c("ngIf",t.importFormat.name=="TOPCOUNT"),a(),c("ngIf",t.formatWarning),a(2),c("autoReset",!1)("blocked",t.blocked||!t.importFormat)("multiple",!1))},dependencies:[z,D,xe,Ce,we,At,$,Te,ye,me,k,F,xt],encapsulation:2})}}return n})();function Di(n,o){if(n&1&&(l(0,"span")(1,"label"),m(2,"Images every"),s(),m(3),s()),n&2){let e=p(2);a(3),g(" ",e.importDetails.imgInterval,"h ")}}function vi(n,o){if(n&1&&(l(0,"span")(1,"label"),m(2,"Time offset"),s(),m(3),s()),n&2){let e=p(2);a(3),g(" ",e.importDetails.timeOffset,"h ")}}function Ti(n,o){if(n&1&&(l(0,"p")(1,"label"),m(2,"First time point:"),s(),l(3,"strong"),m(4),s(),u(5,Di,4,1,"span",1)(6,vi,4,1,"span",1),s()),n&2){let e=p();a(4),nt("",e.firstTimeCell.value," ",e.importDetails.timeType==null?null:e.importDetails.timeType.unit," [",e.firstTimeCell.colName+":"+e.firstTimeCell.rowName,"]"),a(),c("ngIf",(e.importDetails.timeType==null?null:e.importDetails.timeType.name)==="IMG_NUMBER"),a(),c("ngIf",e.importDetails.timeOffset!=0)}}function yi(n,o){if(n&1&&(l(0,"p"),m(1),l(2,"strong"),m(3),s()()),n&2){let e=p();a(),g(" Labels in ",e.importDetails.inLabelNeg," "),a(2),g("",e.importDetails.inRows?e.labelsSelection.colName:e.labelsSelection.rowName,";")}}function Ii(n,o){if(n&1&&(l(0,"p")(1,"label"),m(2,"Selected Labels:"),s(),m(3),s()),n&2){let e=p();a(3),g(" ",e.importDetails.summarizeLabels()," ")}}function Ri(n,o){if(n&1&&(l(0,"p"),m(1),l(2,"strong"),m(3),s()()),n&2){let e=p();a(),g(" Data starts in ",e.importDetails.inLabel," "),a(2),g("",e.importDetails.inRows?e.dataStart.rowName:e.dataStart.colName,";")}}function ki(n,o){if(n&1&&(l(0,"p"),m(1),s()),n&2){let e=p();a(),g(" Background noise as: ",e.importDetails.backgroundsLabels.join(", ")," ")}}var ii=(()=>{class n{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(){this.showTime=!1,this.showLabelling=!1,this.showDataStart=!1}ngOnInit(){}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-import-details-summary"]],inputs:{importDetails:"importDetails",showTime:"showTime",showLabelling:"showLabelling",showDataStart:"showDataStart"},standalone:!1,decls:13,vars:8,consts:[["appearance","outlined",1,"mat-elevation-z4"],[4,"ngIf"]],template:function(i,t){i&1&&(l(0,"mat-card",0)(1,"p"),m(2),l(3,"strong"),m(4),s()(),l(5,"p")(6,"label"),m(7),s()(),u(8,Ti,7,5,"p",1)(9,yi,4,2,"p",1)(10,Ii,4,1,"p",1)(11,Ri,4,2,"p",1)(12,ki,2,1,"p",1),s()),i&2&&(a(2),g("",t.importDetails==null||t.importDetails.importFormat==null?null:t.importDetails.importFormat.label,": "),a(2),R(t.importDetails==null?null:t.importDetails.fileName),a(3),g("Time series in ",(t.importDetails==null?null:t.importDetails.inLabel)+"s",""),a(),c("ngIf",t.showTime&&t.firstTimeCell),a(),c("ngIf",t.showLabelling&&t.importDetails.importLabels&&t.labelsSelection),a(),c("ngIf",t.showLabelling&&!t.importDetails.importLabels),a(),c("ngIf",t.showDataStart&&t.importDetails.importLabels&&t.dataStart),a(),c("ngIf",t.showLabelling&&t.importDetails.containsBackgrounds&&t.importDetails.backgroundsLabels))},dependencies:[D,k],encapsulation:2})}}return n})();var ie=class{constructor(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}reset(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}setRowBackground(o,e){this.rowsBackgrounds[o]=e}rowBackground(o){return this.getOrEmptyString(this.rowsBackgrounds,o)}colBackground(o){return this.getOrEmptyString(this.colsBackgrounds,o)}setColBackground(o,e){this.colsBackgrounds[o]=e}cellBackground(o,e){let i=this.getOrEmptyString(this.getOrDefault(this.cellBackgrounds,e,[]),o);return i||this.colBackground(o)}setCellBackground(o,e,i){let t=this.cellBackgrounds[e];t===void 0&&(t=[],this.cellBackgrounds[e]=t),t[o]=i}getOrEmptyString(o,e){return this.getOrDefault(o,e,"")}getOrDefault(o,e,i){return e>=o.length||o[e]===void 0?i:o[e]}},Q=(()=>{class n{static{this.MAIN_ROW_BACKGROUND="#dda0dd"}static{this.MAIN_COL_BACKGROUND="#87cefa"}static{this.MAIN_CELL_BACKGROUND="#ba55d3"}static{this.TIME_BACKGROUND="#dda0dd"}static{this.LABELS_BACKGROUND="#87cefa"}static{this.FIRST_TIME_BACKGROUND="#ba55d3"}static{this.FIST_DATA_BACKGROUND="lightgreen"}rowBackground(e){return n.MAIN_ROW_BACKGROUND}cellBackground(e){return n.MAIN_CELL_BACKGROUND}columnBackground(e){return n.MAIN_COL_BACKGROUND}}return n})(),Ue=class{constructor(o,e){this.tableStyler=o,this.colorCycler=e,this.selectedRows=[],this.selectedCols=[],this.tableStyler=o||new ie,this.colorCycler=e||new Q}toggleRow(o,e=!1,i,t){let r=this.selectedRows.splice(0,this.selectedRows.length);this.selectedRows.push(o),this.uncolorRows(r),this.colorRows(this.selectedRows,i),e&&(this.uncolorCells(r),this.colorCells(this.selectedRows,t))}toggleRowSelection(o,e,i=!1,t,r){let d=this.selectedRows[o]?[this.selectedRows[o]]:[];this.selectedRows[o]=e,this.uncolorRows(d),this.colorRows([this.selectedRows[o]],t),i&&(this.uncolorCells(d),this.colorCells([this.selectedRows[o]],r))}selectRow(o,e){let i=new v(-1,-1,void 0,o,o,void 0,void 0),t=this.selectedRows.findIndex(r=>r.rowNumber===o);t<0?this.selectedRows.push(i):this.selectedRows[t]=i,this.colorRows([i],e)}deselectRow(o){let e=this.selectedRows.findIndex(t=>t.rowNumber===o);e>=0&&(this.selectedRows[e]=void 0);let i=new v(-1,-1,void 0,o,o,void 0,void 0);this.uncolorRows([i])}toggleCol(o,e=!1,i,t){let r=this.selectedCols.splice(0,this.selectedCols.length);this.selectedCols.push(o),this.uncolorCols(r),this.colorCols(this.selectedCols,i),e&&(this.uncolorCells(r),this.colorCells(this.selectedCols,t))}toggleColSelection(o,e,i=!1,t,r){let d=this.selectedCols[o]?[this.selectedCols[o]]:[];this.selectedCols[o]=e,this.uncolorCols(d),this.colorCols([this.selectedCols[o]],t),i&&(this.uncolorCells(d),this.colorCells([this.selectedCols[o]],r))}selectCol(o,e){let i=new v(o,o,void 0,-1,-1,void 0,void 0),t=this.selectedCols.findIndex(r=>r.colNumber===o);t<0?this.selectedCols.push(i):this.selectedCols[t]=i,this.colorCols([i],e)}deselectCol(o){let e=this.selectedCols.findIndex(t=>t.colNumber===o);e>=0&&(this.selectedCols[e]=void 0);let i=new v(o,o,void 0,-1,-1,void 0,void 0);this.uncolorCols([i])}reset(){this.selectedRows=[],this.selectedCols=[],this.tableStyler.reset()}colorRows(o,e){o.forEach((i,t)=>{this.tableStyler.setRowBackground(i.rowNumber,e||this.colorCycler.rowBackground(t))})}colorCols(o,e){o.forEach((i,t)=>{this.tableStyler.setColBackground(i.colNumber,e||this.colorCycler.columnBackground(t))})}colorCells(o,e){o.forEach((i,t)=>{this.tableStyler.setCellBackground(i.colNumber,i.rowNumber,e||this.colorCycler.cellBackground(t))})}uncolorRows(o){o.forEach(e=>{this.tableStyler.setRowBackground(e.rowNumber,void 0)})}uncolorCols(o){o.forEach(e=>{this.tableStyler.setColBackground(e.colNumber,void 0)})}uncolorCells(o){o.forEach(e=>{this.tableStyler.setCellBackground(e.colNumber,e.rowNumber,void 0)})}},ni=(()=>{class n{constructor(){this.index=0,this.labelsIndexes=new Map}static{this.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"]}toColor(e){if(!e)return;this.labelsIndexes.has(e)||this.labelsIndexes.set(e,this.index++);let i=this.labelsIndexes.get(e)%n.colors.length;return n.colors[i]}setColor(e){}}return n})();var X=(()=>{class n{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(e,i){this.dataService=e,this.feedback=i,this.tableSelector=new Ue,this.lastColumnSeen=0,this.lastRowSeen=0,this.firstPageSlice=W.firstPage(),this.currentPageSlice=W.firstPage()}ngOnInit(){this.dataService.error$.forEach(e=>this.feedback.error(e)),this.dataSubscription=this.dataService.dataSlice$.subscribe(e=>this.setDataSlice(e),e=>this.feedback.error(e))}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe()}colNumber(e){return e<0?-1:this.dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this.dataSlice.rowsNumbers[e]}setDataSlice(e){this.dataSlice=e,this.lastColumnSeen=Math.max(this.lastColumnSeen,e.columnsNumbers[e.columnsNumbers.length-1]),this.lastRowSeen=Math.max(this.lastRowSeen,e.rowsNumbers[e.rowsNumbers.length-1]),this.currentPageSlice=new W(e.rowPage,e.colPage),this.applySelection()}loadData(){this.importDetails&&(this.lastColumnSeen=0,this.lastRowSeen=0,this.dataService.fileIdFormat([this.importDetails.fileId,this.importDetails.importFormat.name]),this.dataService.slice(this.firstPageSlice)),this.dataSlice&&this.applySelection()}applySelection(){this.tableSelector.reset(),this.markSelections(),this.applyDefaultSelections()}applyDefaultSelections(){}markSelections(){}selectFirstTime(e){this.importDetails.firstTimeCell=e,this.markFirstTime()}markFirstTime(){let e=this.firstTimeCell;e&&(this.importDetails.inRows?this.tableSelector.toggleRow(e,!0,Q.TIME_BACKGROUND,Q.FIRST_TIME_BACKGROUND):this.tableSelector.toggleCol(e,!0,Q.TIME_BACKGROUND,Q.FIRST_TIME_BACKGROUND))}selectLabels(e){this.importDetails.labelsSelection=e,this.markLabels()}markLabels(){let e=this.labelsSelection;e&&(this.importDetails.inRows?this.tableSelector.toggleCol(e,!1,Q.LABELS_BACKGROUND):this.tableSelector.toggleRow(e,!1,Q.LABELS_BACKGROUND))}selectDataStart(e){e?this.importDetails.inRows?(!this.firstTimeCell||this.firstTimeCell.rowIx!==e.rowIx)&&(this.importDetails.dataStart=e):(!this.firstTimeCell||this.firstTimeCell.colIx!==e.colIx)&&(this.importDetails.dataStart=e):this.importDetails.dataStart=void 0,this.markDataStart()}markDataStart(){let e=this.dataStart;e&&(this.importDetails.inRows?this.tableSelector.toggleRowSelection(1,e,!1,Q.FIST_DATA_BACKGROUND):this.tableSelector.toggleColSelection(1,e,!1,Q.FIST_DATA_BACKGROUND))}reselect(e){if(!this.dataSlice||!e)return;let i=this.dataSlice,t=e.colIx,r=e.rowIx;if(t>=i.columnsNumbers.length||r>=i.rowsNumbers.length)return;let f=(r>=0?i.data[r]:[])[t],A=new v(t,i.columnsNumbers[t],i.columnsNames[t],r,i.rowsNumbers[r],i.rowsNames[r],f);return A.fake=e.fake,A}hasMoreTimes(){return!this.importDetails||!this.dataSlice?!1:this.importDetails.inRows?this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns:this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows}hasMoreLabels(){return!this.importDetails||!this.dataSlice?!1:this.importDetails.inRows?this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows:this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns}static{this.\u0275fac=function(i){return new(i||n)(C(M),C(P))}}static{this.\u0275dir=it({type:n})}}return n})();var Li=["table"];function Ei(n,o){n&1&&x(0,"th",10)}function Fi(n,o){if(n&1){let e=S();l(0,"td",11),b("click",function(){let t=_(e).index,r=p(2);return h(r.selectCell(-1,t))}),l(1,"label"),m(2),s()()}if(n&2){let e=o.index,i=p(2);a(2),R(i.rowsNames[e])}}function Bi(n,o){if(n&1){let e=S();l(0,"th",15),b("click",function(){_(e);let t=p().index,r=p(2);return h(r.selectCell(t,-1))}),m(1),s()}if(n&2){let e=p(),i=e.$implicit,t=e.index,r=p(2);G("background-color",r.colBackground(t)),a(),g(" ",i," ")}}function Vi(n,o){if(n&1){let e=S();l(0,"td",16),b("click",function(){let t=_(e).index,r=p().index,d=p(2);return h(d.selectCell(r,t))}),m(1),s()}if(n&2){let e=o.$implicit,i=o.index,t=p().index,r=p(2);G("background-color",r.cellBackground(t,i)),c("matRippleCentered",!0),a(),g(" ",e[t]," ")}}function Oi(n,o){if(n&1&&(T(0,12),u(1,Bi,2,3,"th",13)(2,Vi,2,4,"td",14),y()),n&2){let e=o.$implicit;c("matColumnDef",e)}}function Pi(n,o){n&1&&x(0,"tr",17)}function Ai(n,o){if(n&1&&x(0,"tr",18),n&2){let e=o.index,i=p(2);G("background-color",i.rowBackground(e))}}function Ui(n,o){if(n&1&&(l(0,"div",2)(1,"table",3,0),T(3,4),u(4,Ei,1,0,"th",5)(5,Fi,3,1,"td",6),y(),u(6,Oi,3,1,"ng-container",7)(7,Pi,1,0,"tr",8)(8,Ai,1,2,"tr",9),s()()),n&2){let e=p();a(),c("dataSource",e.data),a(5),c("ngForOf",e.columnsNames),a(),c("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),a(),c("matRowDefColumns",e.displayedColumns)}}var de=(()=>{class n{set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.displayedColumns=["rowNr"].concat(this.columnsNames),this.data=e.data,this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.styler=new ie,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.selected=new U}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,i){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(i))}ngOnInit(){}selectCell(e,i){if(e<0&&!this.selectableRowHeader||i<0&&!this.selectableColHeader)return;let r=(i>=0?this.data[i]:[])[e],d=this._dataSlice.columnsNumbers[e],f=this._dataSlice.columnsNames[e],A=this._dataSlice.rowsNumbers[i],Y=this._dataSlice.rowsNames[i],Z=new v(e,d,f,i,A,Y,r);this.selected.next(Z)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-data-sheet-mdtable"]],viewQuery:function(i,t){if(i&1&&N(Li,5),i&2){let r;L(r=E())&&(t.matTable=r.first)}},inputs:{dataSlice:"dataSlice",styler:"styler",selectableColHeader:"selectableColHeader",selectableRowHeader:"selectableRowHeader"},outputs:{selected:"selected"},standalone:!1,decls:1,vars:1,consts:[["table",""],["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color","click",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"matRippleCentered","background-color","click",4,"matCellDef"],["mat-header-cell","",3,"click"],["mat-cell","","matRipple","",3,"click","matRippleCentered"],["mat-header-row",""],["mat-row",""]],template:function(i,t){i&1&&u(0,Ui,9,5,"div",1),i&2&&c("ngIf",t.dataSlice)},dependencies:[z,D,Re,Me,Fe,Ne,ke,Be,Le,Ee,Ve,Oe,De],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:300px;overflow:auto}.mat-mdc-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-mdc-header-cell[_ngcontent-%COMP%], .mat-mdc-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}"]})}}return n})();function Hi(n,o){if(n&1&&(l(0,"mat-option",9),m(1),s()),n&2){let e=o.$implicit;c("value",e),a(),R(e.label)}}function zi(n,o){if(n&1){let e=S();l(0,"p")(1,"mat-form-field")(2,"input",10),O("ngModelChange",function(t){_(e);let r=p(3);return V(r.importDetails.imgInterval,t)||(r.importDetails.imgInterval=t),h(t)}),s()()()}if(n&2){let e=p(3);a(2),B("ngModel",e.importDetails.imgInterval)}}function ji(n,o){if(n&1&&(l(0,"div",11),m(1),s()),n&2){let e=p(3);a(),g(" The first time point value ",e.firstTimeCell.value," does not look like a number; ")}}function Qi(n,o){if(n&1){let e=S();l(0,"div")(1,"p"),m(2),l(3,"strong"),m(4),s(),m(5,"\xA0 First time point: "),l(6,"strong"),m(7),s(),m(8),s(),l(9,"p")(10,"mat-form-field")(11,"mat-label"),m(12,"Time unit"),s(),l(13,"mat-select",5),O("valueChange",function(t){_(e);let r=p(2);return V(r.importDetails.timeType,t)||(r.importDetails.timeType=t),h(t)}),u(14,Hi,2,2,"mat-option",6),s()()(),l(15,"p")(16,"mat-form-field")(17,"input",7),O("ngModelChange",function(t){_(e);let r=p(2);return V(r.importDetails.timeOffset,t)||(r.importDetails.timeOffset=t),h(t)}),s()()(),u(18,zi,3,1,"p",2)(19,ji,2,1,"div",8),s()}if(n&2){let e=p(2);a(2),g("Times in ",e.importDetails.inLabel," "),a(2),g("",e.importDetails.inRows?e.firstTimeCell.rowName:e.firstTimeCell.colName,";"),a(3),be("",e.firstTimeCell.value," ",e.importDetails.timeType==null?null:e.importDetails.timeType.unit,""),a(),g(" [",e.firstTimeCell.colName+":"+e.firstTimeCell.rowName,"] "),a(5),B("value",e.importDetails.timeType),a(),c("ngForOf",e.timeTypeOptions),a(3),B("ngModel",e.importDetails.timeOffset),a(),c("ngIf",(e.importDetails.timeType==null?null:e.importDetails.timeType.name)=="IMG_NUMBER"),a(),c("ngIf",e.firstTimeNotNumber())}}function Gi(n,o){if(n&1&&(l(0,"div",12),m(1),s()),n&2){let e=p(2);a(),g(" Even if only the top part of the data table is presented all times from the selected ",e.importDetails.inLabel," will be imported ")}}function qi(n,o){if(n&1){let e=S();l(0,"mat-card",1)(1,"mat-card-content"),u(2,Qi,20,10,"div",2),l(3,"div")(4,"div"),m(5),s()(),l(6,"bd2-data-sheet-mdtable",3),b("selected",function(t){_(e);let r=p();return h(r.selectFirstTime(t))}),s(),u(7,Gi,2,1,"div",4),s()()}if(n&2){let e=p();a(2),c("ngIf",e.firstTimeCell),a(2),oe(e.firstTimeCell?"alert alert-info":"alert alert-danger"),a(),g(" Click on the first timepoint in the time ",e.importDetails.inLabel," and then select a time unit. "),a(),c("dataSlice",e.dataSlice)("styler",e.tableSelector.tableStyler),a(),c("ngIf",e.hasMoreTimes())}}var oi=(()=>{class n extends X{constructor(e,i){super(e,i),this.timeTypeOptions=[ee.TIME_IN_HOURS,ee.TIME_IN_MINUTES,ee.TIME_IN_SECONDS,ee.IMG_NUMBER]}applyDefaultSelections(){if(super.applyDefaultSelections(),this.firstTimeCell&&!this.firstTimeCell.fake)this.selectFirstTime(this.reselect(this.firstTimeCell));else{let e=this.importDetails.inRows?new v(1,this.colNumber(1),void 0,0,this.rowNumber(0),void 0,void 0):new v(0,this.colNumber(0),void 0,1,this.rowNumber(1),void 0,void 0);e=this.reselect(e),e.fake=!0,this.selectFirstTime(e)}}firstTimeNotNumber(){return this.firstTimeCell?isNaN(Number(this.firstTimeCell.value)):!1}static{this.\u0275fac=function(i){return new(i||n)(C(M),C(P))}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-define-time-step"]],inputs:{importDetails:"importDetails"},standalone:!1,features:[H],decls:1,vars:1,consts:[["appearance","outlined","class","mat-elevation-z4",4,"ngIf"],["appearance","outlined",1,"mat-elevation-z4"],[4,"ngIf"],[3,"selected","dataSlice","styler"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["required","",3,"valueChange","value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","placeholder","Time offset",3,"ngModelChange","ngModel"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"value"],["matInput","","type","number","placeholder","Images interval (hours)","required","",3,"ngModelChange","ngModel"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(i,t){i&1&&u(0,qi,8,7,"mat-card",0),i&2&&c("ngIf",t.importDetails)},dependencies:[z,D,le,mt,K,pt,se,$,Te,ye,me,k,F,Ie,de],encapsulation:2})}}return n})();function $i(n,o){if(n&1&&(l(0,"div",7),m(1),s()),n&2){let e=p(3);a(),g(" Labels ",e.importDetails.inLabelNeg," must be before first time point. ")}}function Xi(n,o){if(n&1&&(l(0,"div")(1,"p"),m(2),l(3,"strong"),m(4),s()(),u(5,$i,2,1,"div",6),s()),n&2){let e=p(2);a(2),g("Labels in ",e.importDetails.inLabelNeg," "),a(2),g("",e.importDetails.inRows?e.labelsSelection.colName:e.labelsSelection.rowName,";"),a(),c("ngIf",!e.importDetails.areLabelsAfterTime())}}function Yi(n,o){if(n&1&&(l(0,"div",8),m(1),s()),n&2){let e=p(2);a(),g(" Even if only the top part of the data table is presented all labels from the selected ",e.importDetails.inLabelNeg," will be imported ")}}function Zi(n,o){if(n&1){let e=S();l(0,"mat-card",1)(1,"mat-card-content"),u(2,Xi,6,3,"div",2),l(3,"div")(4,"div",3),m(5),s()(),l(6,"bd2-data-sheet-mdtable",4),b("selected",function(t){_(e);let r=p();return h(r.selectLabels(t))}),s(),l(7,"div"),m(8," \xA0 "),u(9,Yi,2,1,"div",5),s()()()}if(n&2){let e=p();a(2),c("ngIf",e.labelsSelection),a(2),oe(e.labelsSelection?"alert alert-info":"alert alert-danger"),a(),g(" Click on the ",e.importDetails.inLabelNeg," containing labels. "),a(),c("dataSlice",e.dataSlice)("selectableColHeader",e.importDetails.inRows)("selectableRowHeader",!e.importDetails.inRows)("styler",e.tableSelector.tableStyler),a(3),c("ngIf",e.hasMoreLabels())}}var ai=(()=>{class n extends X{constructor(e,i){super(e,i)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.labelsSelection&&!this.labelsSelection.fake)this.selectLabels(this.reselect(this.labelsSelection));else if(this.firstTimeCell){let e=this.reselect(new v(this.firstTimeCell.colIx-1,this.colNumber(this.firstTimeCell.colIx-1),void 0,this.firstTimeCell.rowIx-1,this.rowNumber(this.firstTimeCell.rowIx-1),void 0,void 0));e.fake=!0,this.selectLabels(e)}}markSelections(){super.markSelections(),this.markFirstTime()}static{this.\u0275fac=function(i){return new(i||n)(C(M),C(P))}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-import-labels-step"]],inputs:{importDetails:"importDetails"},standalone:!1,features:[H],decls:1,vars:1,consts:[["appearance","outlined","class","mat-elevation-z4",4,"ngIf"],["appearance","outlined",1,"mat-elevation-z4"],[4,"ngIf"],["role","alert"],[3,"selected","dataSlice","selectableColHeader","selectableRowHeader","styler"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(i,t){i&1&&u(0,Zi,10,9,"mat-card",0),i&2&&c("ngIf",t.importDetails)},dependencies:[D,k,F,de],encapsulation:2})}}return n})();function en(n,o){if(n&1&&(l(0,"div",5),m(1),s()),n&2){let e=p(3);a(),be(" Data start ",e.importDetails.inLabel," must be after time ",e.importDetails.inLabel,". ")}}function tn(n,o){if(n&1&&(l(0,"div")(1,"p"),m(2),l(3,"strong"),m(4),s()(),u(5,en,2,2,"div",4),s()),n&2){let e=p(2);a(2),g("Data starts in ",e.importDetails.inLabel," "),a(2),g("",e.importDetails.inRows?e.dataStart.rowName:e.dataStart.colName,";"),a(),c("ngIf",!e.importDetails.isDataAfterTime())}}function nn(n,o){if(n&1){let e=S();l(0,"mat-card",1)(1,"mat-card-content"),u(2,tn,6,3,"div",2),l(3,"div")(4,"div"),m(5),s()(),l(6,"bd2-data-sheet-mdtable",3),b("selected",function(t){_(e);let r=p();return h(r.selectDataStart(t))}),s()()()}if(n&2){let e=p();a(2),c("ngIf",e.dataStart),a(2),oe(e.dataStart?"alert alert-info":"alert alert-danger"),a(),g(" Click on the first data ",e.importDetails.inLabel,". "),a(),c("dataSlice",e.dataSlice)("selectableColHeader",!e.importDetails.inRows)("selectableRowHeader",e.importDetails.inRows)("styler",e.tableSelector.tableStyler)}}var ri=(()=>{class n extends X{constructor(e,i){super(e,i)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.dataStart&&!this.dataStart.fake)this.selectDataStart(this.reselect(this.dataStart));else if(this.firstTimeCell){let e=this.reselect(new v(this.firstTimeCell.colIx+1,this.colNumber(this.firstTimeCell.colIx+1),void 0,this.firstTimeCell.rowIx+1,this.rowNumber(this.firstTimeCell.rowIx+1),void 0,void 0));e.fake=!0,this.selectDataStart(e)}}markSelections(){super.markSelections(),this.markFirstTime(),this.markLabels()}static{this.\u0275fac=function(i){return new(i||n)(C(M),C(P))}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-select-data-start-step"]],inputs:{importDetails:"importDetails"},standalone:!1,features:[H],decls:1,vars:1,consts:[["appearance","outlined","class","mat-elevation-z4",4,"ngIf"],["appearance","outlined",1,"mat-elevation-z4"],[4,"ngIf"],[3,"selected","dataSlice","selectableColHeader","selectableRowHeader","styler"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(i,t){i&1&&u(0,nn,7,8,"mat-card",0),i&2&&c("ngIf",t.importDetails)},dependencies:[D,k,F,de],encapsulation:2})}}return n})();var li=(()=>{class n{constructor(e,i){this.dialogRef=e,this.data=i}ngOnInit(){}sendLabel(){this.dialogRef.close(this.data.label)}static{this.\u0275fac=function(i){return new(i||n)(C(Nt),C(Lt))}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-edit-label-dialog"]],standalone:!1,decls:20,vars:6,consts:[["ok",""],["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","cdkFocusInitial","",3,"ngModelChange","keydown.enter","ngModel"],["align","start"],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-raised-button","","color","primary",3,"mat-dialog-close"]],template:function(i,t){if(i&1){let r=S();l(0,"h1",1),m(1),s(),l(2,"div",2)(3,"p"),m(4),s(),l(5,"mat-form-field")(6,"input",3),O("ngModelChange",function(f){return _(r),V(t.data.label,f)||(t.data.label=f),h(f)}),b("keydown.enter",function(){return _(r),h(t.sendLabel())}),s(),l(7,"mat-hint",4),m(8,"Pressing "),l(9,"strong"),m(10,"Enter"),s(),m(11," submits "),s()()(),l(12,"div",5)(13,"button",6),m(14,"Cancel"),s(),l(15,"button",6),m(16,"Clear"),s(),l(17,"button",7,0),m(19,"Assign"),s()()}i&2&&(a(),R(t.data.title),a(3),g("Write label for ",t.data.regionName,""),a(2),B("ngModel",t.data.label),a(7),c("mat-dialog-close",void 0),a(2),c("mat-dialog-close",""),a(2),c("mat-dialog-close",t.data.label))},dependencies:[le,K,se,$,ft,Ie,ve,Ft,Bt,Ot,Vt],encapsulation:2})}}return n})();var ln=["table"];function sn(n,o){n&1&&x(0,"th",20)}function mn(n,o){if(n&1){let e=S();l(0,"td",21),b("mousedown",function(){let t=_(e).index,r=p(2);return h(r.startSelectCell(-1,t))})("mouseup",function(){let t=_(e).index,r=p(2);return h(r.endSelectCell(-1,t))}),l(1,"label"),m(2),s()()}if(n&2){let e=o.index,i=p(2);a(2),R(i.rowsNames[e])}}function cn(n,o){if(n&1){let e=S();l(0,"td",22),b("click",function(){_(e);let t=p(2);return h(t.nextRow())}),m(1),s()}if(n&2){let e=p(2);a(),R(e.hasMoreRows?"...":"end")}}function pn(n,o){n&1&&(l(0,"th",20),m(1,"Labels"),s())}function dn(n,o){if(n&1){let e=S();l(0,"td",21),b("mousedown",function(){let t=_(e).index,r=p(2);return h(r.startSelectCell(-1,t))})("mouseup",function(){let t=_(e).index,r=p(2);return h(r.endSelectCell(-1,t))}),l(1,"label",23),m(2),s()()}if(n&2){let e=o.index,i=p(2);a(2),R(i.rowsLabels[e])}}function un(n,o){if(n&1){let e=S();l(0,"td",22),b("click",function(){_(e);let t=p(2);return h(t.nextRow())}),s()}}function fn(n,o){if(n&1){let e=S();l(0,"th",27),b("mousedown",function(){_(e);let t=p().index,r=p(2);return h(r.startSelectCell(t,-1))})("mouseup",function(){_(e);let t=p().index,r=p(2);return h(r.endSelectCell(t,-1))}),m(1),s()}if(n&2){let e=p(),i=e.$implicit,t=e.index,r=p(2);G("background-color",r.colBackground(t)),a(),g(" ",i," ")}}function _n(n,o){if(n&1&&(l(0,"td",28),m(1),s()),n&2){let e=o.$implicit,i=o.index,t=p().index,r=p(2);G("background-color",r.cellBackground(t,i)),a(),g(" ",e[t]," ")}}function hn(n,o){if(n&1){let e=S();l(0,"td",22),b("click",function(){_(e);let t=p(3);return h(t.nextRow())}),m(1),s()}if(n&2){let e=p(3);a(),R(e.hasMoreRows?"...":"")}}function gn(n,o){if(n&1&&(T(0,24),u(1,fn,2,3,"th",25)(2,_n,2,3,"td",26)(3,hn,2,1,"td",7),y()),n&2){let e=o.$implicit;c("matColumnDef",e)}}function bn(n,o){if(n&1){let e=S();l(0,"th",29),b("click",function(){_(e);let t=p(2);return h(t.nextColumn())}),m(1,"..."),s()}}function Sn(n,o){if(n&1){let e=S();l(0,"td",30),b("click",function(){_(e);let t=p(2);return h(t.nextColumn())}),m(1,"..."),s()}}function Cn(n,o){n&1&&x(0,"td",31)}function wn(n,o){n&1&&(l(0,"th",20),m(1,"Labels"),s())}function xn(n,o){n&1&&x(0,"th",20)}function Dn(n,o){if(n&1){let e=S();l(0,"th",27),b("mousedown",function(){_(e);let t=p().index,r=p(3);return h(r.startSelectCell(t,-1))})("mouseup",function(){_(e);let t=p().index,r=p(3);return h(r.endSelectCell(t,-1))}),l(1,"label",23),m(2),s()()}if(n&2){let e=p().index,i=p(3);G("background-color",i.colBackground(e)),a(2),R(i.columnsLabels[e])}}function vn(n,o){if(n&1&&(T(0,24),u(1,Dn,3,3,"th",25),y()),n&2){let e=o.index;c("matColumnDef","label"+e)}}function Tn(n,o){if(n&1&&(T(0),u(1,vn,2,1,"ng-container",9),y()),n&2){let e=p(2);a(),c("ngForOf",e.columnsNames)}}function yn(n,o){n&1&&x(0,"tr",32)}function In(n,o){n&1&&x(0,"tr",32)}function Rn(n,o){if(n&1&&(T(0),u(1,In,1,0,"tr",17),y()),n&2){let e=p(2);a(),c("matHeaderRowDef",e.displayedLabelsColumns)("matHeaderRowDefSticky",!0)}}function kn(n,o){if(n&1&&x(0,"tr",33),n&2){let e=o.index,i=p(2);G("background-color",i.rowBackground(e))}}function Mn(n,o){n&1&&x(0,"tr",34)}function Nn(n,o){if(n&1&&(l(0,"div",2)(1,"table",3,0),T(3,4),u(4,sn,1,0,"th",5)(5,mn,3,1,"td",6)(6,cn,2,1,"td",7),y(),T(7,8),u(8,pn,2,0,"th",5)(9,dn,3,1,"td",6)(10,un,1,0,"td",7),y(),u(11,gn,4,1,"ng-container",9),T(12,10),u(13,bn,2,0,"th",11)(14,Sn,2,0,"td",12)(15,Cn,1,0,"td",13),y(),T(16,14),u(17,wn,2,0,"th",5),y(),T(18,15),u(19,xn,1,0,"th",5),y(),u(20,Tn,2,1,"ng-container",16)(21,yn,1,0,"tr",17)(22,Rn,2,2,"ng-container",16)(23,kn,1,2,"tr",18)(24,Mn,1,0,"tr",19),s()()),n&2){let e=p();a(),c("dataSource",e.data),a(10),c("ngForOf",e.columnsNames),a(9),c("ngIf",e.showColumnsLabels),a(),c("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),a(),c("ngIf",e.showColumnsLabels),a(),c("matRowDefColumns",e.displayedColumns),a(),c("matFooterRowDef",e.displayedColumns)}}var si=(()=>{class n{set columnsLabels(e){this._columnsLabels=e}get columnsLabels(){return this._columnsLabels}set rowsLabels(e){this._rowsLabels=e}get rowsLabels(){return this._rowsLabels}set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.data=e.data,this.hasMoreColumns=e.columnsNumbers[e.columnsNumbers.length-1]<e.totalColumns-1,this.hasMoreRows=e.rowsNumbers[e.rowsNumbers.length-1]<e.totalRows-1,this.decideColumns(),this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}set selectRows(e){this.selectableRowHeader=e,this.showRowsLabels=e,this.decideColumns()}set selectCols(e){this.selectableColHeader=e,this.showColumnsLabels=e,this.decideColumns()}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.hasMoreColumns=!1,this.hasMoreRows=!1,this._columnsLabels=[],this._rowsLabels=[],this.styler=new ie,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.showColumnsLabels=!1,this.showRowsLabels=!1,this.selected=new U,this.moreRows=new U,this.moreColumns=new U}decideColumns(){this.displayedColumns=(this.showRowsLabels?["rowNr","rowLabel"]:["rowNr"]).concat(this.columnsNames),this.displayedLabelsColumns=(this.showRowsLabels?["rowNr2","rowLabel2"]:["rowNr2"]).concat(this.columnsNames.map((e,i)=>"label"+i)),this.hasMoreColumns&&(this.displayedColumns.push("more"),this.displayedLabelsColumns.push("more"))}ngOnInit(){}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,i){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(i))}startSelectCell(e,i){if(e<0&&!this.selectableRowHeader||i<0&&!this.selectableColHeader)return;let r=(i>=0?this.data[i]:[])[e],d=this._dataSlice.columnsNumbers[e],f=this._dataSlice.columnsNames[e],A=this._dataSlice.rowsNumbers[i],Y=this._dataSlice.rowsNames[i],Z=new v(e,d,f,i,A,Y,r);this.selectionStart=Z}endSelectCell(e,i){if(!this.selectionStart)return;if(i<0&&this.selectionStart.rowIx>=0){this.selectionStart=void 0;return}if(e<0&&this.selectionStart.colIx>=0){this.selectionStart=void 0;return}if(e<0&&!this.selectableRowHeader||i<0&&!this.selectableColHeader)return;let r=(i>=0?this.data[i]:[])[e],d=this._dataSlice.columnsNumbers[e],f=this._dataSlice.columnsNames[e],A=this._dataSlice.rowsNumbers[i],Y=this._dataSlice.rowsNames[i],Z=new v(e,d,f,i,A,Y,r);this.selected.next([this.selectionStart,Z])}nextColumn(){this.moreColumns.next(!0)}nextRow(){this.moreRows.next(!0)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-selectable-region-mdtable"]],viewQuery:function(i,t){if(i&1&&N(ln,5),i&2){let r;L(r=E())&&(t.matTable=r.first)}},inputs:{columnsLabels:"columnsLabels",rowsLabels:"rowsLabels",dataSlice:"dataSlice",selectRows:"selectRows",selectCols:"selectCols",styler:"styler"},outputs:{selected:"selected",moreRows:"moreRows",moreColumns:"moreColumns"},standalone:!1,decls:1,vars:1,consts:[["table",""],["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"mousedown","mouseup",4,"matCellDef"],["mat-footer-cell","",3,"click",4,"matFooterCellDef"],["matColumnDef","rowLabel","sticky",""],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","more","sticky",""],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","rowNr2","sticky",""],["matColumnDef","rowLabel2","sticky",""],[4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell","","matRipple","",3,"mousedown","mouseup"],["mat-footer-cell","",3,"click"],[1,"user"],[3,"matColumnDef"],["mat-header-cell","","matRipple","",3,"background-color","mousedown","mouseup",4,"matHeaderCellDef"],["mat-cell","",3,"background-color",4,"matCellDef"],["mat-header-cell","","matRipple","",3,"mousedown","mouseup"],["mat-cell",""],["mat-header-cell","",3,"click"],["mat-cell","",3,"click"],["mat-footer-cell",""],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(i,t){i&1&&u(0,Nn,25,8,"div",1),i&2&&c("ngIf",t.dataSlice)},dependencies:[z,D,Re,Me,Fe,Ne,ke,Be,yt,Rt,Le,Ee,It,Ve,Oe,kt,De],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:800px;overflow:auto}.mat-mdc-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-mdc-header-cell[_ngcontent-%COMP%], .mat-mdc-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}label.user[_ngcontent-%COMP%]{color:#000}"]})}}return n})();var En=["colPaginator"],Fn=["rowPaginator"],mi=()=>[10,25,50,100];function Bn(n,o){if(n&1&&(l(0,"div",9),m(1),s()),n&2){let e=p();a(),g(" You have not seen yet all the available ",e.importDetails==null?null:e.importDetails.inLabel,`s for labelling
`)}}var ci=(()=>{class n extends X{get userLabels(){return this.importDetails?this.importDetails.userLabels:void 0}constructor(e,i,t){super(i,t),this.dialog=e,this.columnsLabels=[],this.rowsLabels=[],this.colorer=new ni}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy(),this.dataService&&this.dataService.close()}ngAfterViewInit(){this.colPaginator._intl=new je,this.colPaginator._intl.itemsPerPageLabel="Columns per page",this.rowPaginator._intl=new je,this.rowPaginator._intl.itemsPerPageLabel="Rows per page"}markSelections(){super.markSelections(),this.markFirstTime(),this.loadLabels(),this.markLabels(),this.labelsSummary=this.importDetails.summarizeLabels(25),this.labelTime()}labelTime(){if(this.firstTimeCell)if(this.importDetails.inRows){let e=this.dataSlice.rowsNumbers.indexOf(this.firstTimeCell.rowNumber);e>=0&&(this.rowsLabels[e]="Time")}else{let e=this.dataSlice.columnsNumbers.indexOf(this.firstTimeCell.colNumber);e>=0&&(this.columnsLabels[e]="Time")}}loadLabels(){let e=this.dataSlice;this.importDetails.inRows?(this.rowsLabels=this.userLabels.slice(e.rowsNumbers[0],e.rowsNumbers[e.rowsNumbers.length-1]),this.columnsLabels=[]):(this.rowsLabels=[],this.columnsLabels=this.userLabels.slice(e.columnsNumbers[0],e.columnsNumbers[e.columnsNumbers.length-1]))}markLabels(){this.userLabels.forEach((e,i)=>{this.importDetails.inRows?this.tableSelector.selectRow(i,this.colorer.toColor(e)):this.tableSelector.selectCol(i,this.colorer.toColor(e))})}hasSeenAll(){return this.dataSlice?this.importDetails.inRows?this.lastRowSeen>=this.dataSlice.totalRows-1:this.lastColumnSeen>=this.dataSlice.totalColumns-1:!1}selected(e){let i=e[0].colName+e[0].rowName,t=e[1].colName+e[1].rowName;e[1].isBeforeOrSame(e[0])&&(e=[e[1],e[0]]),this.importDetails.inRows?this.labelRows(e[0],e[1]):this.labelColumns(e[0],e[1])}setUserLabel(e,i){this.userLabels[e]=i||void 0,this.labelsSummary=this.importDetails.summarizeLabels(25)}askForLabel(e,i,t){let r;return t?r={title:"Label rows",regionName:e.hasSameIx(i)?"row "+e.rowName:"rows "+e.rowName+"-"+i.rowName,label:this.userLabels[e.rowNumber]}:r={title:"Label columns",regionName:e.hasSameIx(i)?"column "+e.colName:"columns "+e.colName+"-"+i.colName,label:this.userLabels[e.rowNumber]},this.dialog.open(li,{data:r}).afterClosed()}labelRows(e,i){if(e.rowIx<0||i.rowIx<0){console.warn("Label rows with col selection",e);return}this.firstTimeCell&&this.firstTimeCell.rowNumber>=e.rowNumber||this.askForLabel(e,i,!0).subscribe(t=>{t!==void 0&&(this.setRowsLabel(e,i,t),t&&this.selectNextRegion(e,i))})}setRowsLabel(e,i,t){t=t.trim();let r=this.colorer.toColor(t);for(let d=e.rowIx;d<=i.rowIx;d++){let f=this.dataSlice.rowsNumbers[d];f===void 0?console.error("No row number for index "+d):(this.rowsLabels[d]=t,this.setUserLabel(f,t),t?this.tableSelector.selectRow(f,r):this.tableSelector.deselectRow(f))}}labelColumns(e,i){if(e.colIx<0||i.colIx<0){console.warn("Label cols with row selection",e);return}if(this.firstTimeCell&&this.firstTimeCell.colNumber>=e.colNumber){console.log("Ignroing labelling as Time col after selection");return}this.askForLabel(e,i,!1).subscribe(t=>{t!==void 0&&(this.setColumnsLabel(e,i,t),t&&this.selectNextRegion(e,i))})}setColumnsLabel(e,i,t){t=t.trim();let r=this.colorer.toColor(t);for(let d=e.colIx;d<=i.colIx;d++){let f=this.dataSlice.columnsNumbers[d];f===void 0?console.error("No col number for index "+d):(this.columnsLabels[d]=t,this.setUserLabel(f,t),t?this.tableSelector.selectCol(f,r):this.tableSelector.deselectCol(f))}}selectNextRegion(e,i){let t=[i.colIx-e.colIx,i.rowIx-e.rowIx],r=this.moveCell(i,[1,1]),d=this.moveCell(r,t);this.isInPage(r)&&(this.isInPage(d)||(d=this.fitToPage(d)),r=this.reselect(r),d=this.reselect(d),this.selected([r,d]))}isInPage(e){return!(e.colIx>=0&&e.colIx>=this.dataSlice.columnsNumbers.length||e.rowIx>=0&&e.rowIx>=this.dataSlice.rowsNumbers.length)}fitToPage(e){let i=e.colIx>=0?this.dataSlice.columnsNumbers.length-1:-1,t=e.rowIx>=0?this.dataSlice.rowsNumbers.length-1:-1;return new v(i,void 0,void 0,t,void 0,void 0,void 0)}moveCell(e,i){let t=e.colIx>=0?e.colIx+i[0]:-1,r=e.rowIx>=0?e.rowIx+i[1]:-1;return new v(t,void 0,void 0,r,void 0,void 0,void 0)}loadColPage(e){this.dataService.slice(new W(this.currentPageSlice.rowPage,e))}loadRowPage(e){this.dataService.slice(new W(e,this.currentPageSlice.colPage))}moreColumns(){this.importDetails.inRows||this.colPaginator.nextPage()}moreRows(){this.importDetails.inRows&&this.rowPaginator.nextPage()}static{this.\u0275fac=function(i){return new(i||n)(C(Et),C(M),C(P))}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-assign-labels-step"]],viewQuery:function(i,t){if(i&1&&(N(En,7),N(Fn,7)),i&2){let r;L(r=E())&&(t.colPaginator=r.first),L(r=E())&&(t.rowPaginator=r.first)}},inputs:{importDetails:"importDetails"},standalone:!1,features:[Se([M]),H],decls:14,vars:23,consts:[["colPaginator",""],["rowPaginator",""],["role","alert","type","info",1,"alert","alert-info",3,"hidden"],[3,"hidden"],[3,"page","length","disabled","pageSize","pageIndex","pageSizeOptions"],[3,"selected","moreColumns","moreRows","dataSlice","columnsLabels","rowsLabels","styler","selectRows","selectCols"],[3,"page","length","disabled","pageSize","pageSizeOptions"],["type","danger","class","alert alert-danger mt-2","role","alert",4,"ngIf"],[2,"margin-top","1em"],["type","danger","role","alert",1,"alert","alert-danger","mt-2"]],template:function(i,t){if(i&1){let r=S();l(0,"div",2),m(1),s(),l(2,"div",3)(3,"mat-paginator",4,0),b("page",function(f){return _(r),h(t.loadColPage(f))}),s()(),l(5,"bd2-selectable-region-mdtable",5),b("selected",function(f){return _(r),h(t.selected(f))})("moreColumns",function(){return _(r),h(t.moreColumns())})("moreRows",function(){return _(r),h(t.moreRows())}),s(),l(6,"div",3)(7,"mat-paginator",6,1),b("page",function(f){return _(r),h(t.loadRowPage(f))}),s()(),u(9,Bn,2,1,"div",7),l(10,"div",8)(11,"label"),m(12,"Selected labels: "),s(),m(13),s()}i&2&&(c("hidden",(t.importDetails==null||t.importDetails.userLabels==null?null:t.importDetails.userLabels.length)>1),a(),g(" Click and drag over ",t.importDetails==null?null:t.importDetails.inLabel,` headers to label the data.
`),a(),c("hidden",t.importDetails==null?null:t.importDetails.inRows),a(),c("length",t.dataSlice==null?null:t.dataSlice.totalColumns)("disabled",t.importDetails==null?null:t.importDetails.inRows)("pageSize",t.currentPageSlice.colPage.pageSize)("pageIndex",t.currentPageSlice.colPage.pageIndex)("pageSizeOptions",He(21,mi)),a(2),c("dataSlice",t.dataSlice)("columnsLabels",t.columnsLabels)("rowsLabels",t.rowsLabels)("styler",t.tableSelector.tableStyler)("selectRows",t.importDetails==null?null:t.importDetails.inRows)("selectCols",!(t.importDetails!=null&&t.importDetails.inRows)),a(),c("hidden",!(t.importDetails!=null&&t.importDetails.inRows)),a(),c("length",t.dataSlice==null?null:t.dataSlice.totalRows)("disabled",!(t.importDetails!=null&&t.importDetails.inRows))("pageSize",t.firstPageSlice.rowPage.pageSize)("pageSizeOptions",He(22,mi)),a(2),c("ngIf",!t.hasSeenAll()),a(4),g("",t.labelsSummary,`
`))},dependencies:[D,_t,si],encapsulation:2})}}return n})();var On=["backgroundInput"],Pn=["auto"];function An(n,o){n&1&&(l(0,"mat-icon",14),m(1,"cancel"),s())}function Un(n,o){if(n&1){let e=S();l(0,"mat-chip-row",12),b("removed",function(){let t=_(e).$implicit,r=p(2);return h(r.remove(t))}),m(1),u(2,An,2,0,"mat-icon",13),s()}if(n&2){let e=o.$implicit,i=p(2);c("removable",i.removable),a(),g(" ",e," "),a(),c("ngIf",i.removable)}}function Wn(n,o){if(n&1&&(l(0,"mat-option",15),m(1),s()),n&2){let e=o.$implicit;c("value",e),a(),g(" ",e," ")}}function Hn(n,o){if(n&1){let e=S();l(0,"div")(1,"mat-card",4)(2,"mat-card-content")(3,"div",5),m(4," Select labels for which data should be treated as the background noise "),s(),l(5,"mat-form-field",6)(6,"mat-chip-grid",7,0),u(8,Un,3,3,"mat-chip-row",8),l(9,"input",9,1),b("matChipInputTokenEnd",function(t){_(e);let r=p();return h(r.add(t))}),s()(),l(11,"mat-autocomplete",10,2),b("optionSelected",function(t){_(e);let r=p();return h(r.selected(t))}),u(13,Wn,2,2,"mat-option",11),ot(14,"async"),s()()()()()}if(n&2){let e=ae(7),i=ae(12),t=p();a(8),c("ngForOf",t.backgrounds),a(),c("formControl",t.backgroundCtrl)("matAutocomplete",i)("matChipInputFor",e)("matChipInputSeparatorKeyCodes",t.separatorKeysCodes)("matChipInputAddOnBlur",t.addOnBlur),a(4),c("ngForOf",at(14,7,t.filteredLabels))}}var pi=(()=>{class n{get backgrounds(){return this.importDetails?this.importDetails.backgroundsLabels:[]}set backgrounds(e){this.importDetails.backgroundsLabels=e}constructor(e){this.tsFileService=e,this.selectable=!0,this.removable=!0,this.addOnBlur=!1,this.separatorKeysCodes=[13,188],this.backgroundCtrl=new st,this.allLabels=[]}ngOnInit(){this.filteredLabels=this.backgroundCtrl.valueChanges.pipe(et(null),ue(e=>e?this.filter(e):this.allLabels))}loadLabels(){if(!this.importDetails||!this.importDetails.fileId){this.updateAllLabels([]);return}this.importDetails.importLabels?this.importDetails.labelsSelection&&this.tsFileService.previewLabels(this.importDetails.fileId,this.importDetails.importFormat.name,this.importDetails.labelsSelection,this.importDetails.inRows).subscribe(e=>{this.updateAllLabels(this.unique(e))}):this.updateAllLabels(this.unique(this.importDetails.userLabels))}updateAllLabels(e){this.allLabels=e.slice().sort();let i=this.backgrounds||[];this.backgrounds=[],i.forEach(t=>this.addBackground(t)),this.backgroundCtrl.setValue(" "),this.backgroundCtrl.setValue(null)}unique(e){return e=e.filter(t=>!!t).map(t=>t.trim()),[...new Set(e)]}addBackground(e){if((e||"").trim()){let i=this.backgrounds.indexOf(e),t=this.allLabels.indexOf(e);i<0&&t>=0&&this.backgrounds.push(e.trim())}}add(e){if(!this.matAutocomplete.isOpen){let i=e.input,t=e.value;this.addBackground(t),i&&(i.value=""),this.backgroundCtrl.setValue(null)}}remove(e){let i=this.backgrounds.indexOf(e);i>=0&&this.backgrounds.splice(i,1)}selected(e){this.addBackground(e.option.viewValue),this.backgroundInput.nativeElement.value="",this.backgroundCtrl.setValue(null)}filter(e){let i=e.toLowerCase();return this.allLabels.filter(t=>t.toLowerCase().includes(i)).slice(0,7)}static{this.\u0275fac=function(i){return new(i||n)(C(ce))}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-select-backgrounds-labels-step"]],viewQuery:function(i,t){if(i&1&&(N(On,5),N(Pn,5)),i&2){let r;L(r=E())&&(t.backgroundInput=r.first),L(r=E())&&(t.matAutocomplete=r.first)}},inputs:{importDetails:"importDetails"},standalone:!1,decls:1,vars:1,consts:[["chipList",""],["backgroundInput",""],["auto","matAutocomplete"],[4,"ngIf"],["appearance","outlined",1,"mat-elevation-z4"],["type","info","role","alert",1,"alert","alert-info"],[2,"width","100%"],["aria-label","Backgrounds selection"],[3,"removable","removed",4,"ngFor","ngForOf"],["placeholder","Type to select background label...",3,"matChipInputTokenEnd","formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur"],[3,"optionSelected"],[3,"value",4,"ngFor","ngForOf"],[3,"removed","removable"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"]],template:function(i,t){i&1&&u(0,Hn,15,9,"div",3),i&2&&c("ngIf",t.importDetails==null?null:t.importDetails.containsBackgrounds)},dependencies:[z,D,le,K,ct,$,me,k,F,St,Ct,gt,bt,ht,vt,Tt,rt],encapsulation:2})}}return n})();var jn=["stepper"],Qn=["importLabelsStep"],Gn=["assignLabelsStep"],qn=["selectBackgroundsStep"];function Kn(n,o){n&1&&m(0,"Upload data file")}function $n(n,o){n&1&&m(0,"Data layout")}function Xn(n,o){if(n&1&&m(0),n&2){let e=p();g("Define time ",e.importDetails.inLabel,"")}}function Yn(n,o){n&1&&m(0,"Label data")}function Zn(n,o){if(n&1){let e=S();T(0),l(1,"mat-step",17),u(2,Yn,1,0,"ng-template",7),x(3,"mat-divider")(4,"bd2-import-details-summary",23)(5,"bd2-assign-labels-step",9,2),l(7,"div")(8,"button",15),m(9,"Back"),s(),l(10,"button",18),b("click",function(){_(e);let t=p();return h(t.startChoosingBackgrounds())}),m(11,"Next"),s()()(),y()}if(n&2){let e=p();a(),c("completed",e.importDetails.areLabelsCorrectlyAssigned()),a(3),c("importDetails",e.importDetails)("showTime",!0),a(),c("importDetails",e.importDetails),a(5),c("disabled",!e.importDetails.areLabelsCorrectlyAssigned())}}function Jn(n,o){if(n&1&&m(0),n&2){let e=p(2);g("Select labels ",e.importDetails.inLabelNeg,"")}}function eo(n,o){n&1&&m(0,"Select data start")}function to(n,o){if(n&1){let e=S();T(0),l(1,"mat-step",17),u(2,Jn,1,1,"ng-template",7),x(3,"mat-divider")(4,"bd2-import-details-summary",23)(5,"bd2-import-labels-step",9,3),l(7,"div")(8,"button",15),m(9,"Back"),s(),l(10,"button",18),b("click",function(){_(e);let t=ae(17),r=p();return h(r.loadData(t))}),m(11,"Next"),s()()(),l(12,"mat-step",17),u(13,eo,1,0,"ng-template",7),x(14,"mat-divider")(15,"bd2-import-details-summary",24)(16,"bd2-select-data-start-step",9,4),l(18,"div")(19,"button",15),m(20,"Back"),s(),l(21,"button",18),b("click",function(){_(e);let t=p();return h(t.startChoosingBackgrounds())}),m(22,"Next"),s()()(),y()}if(n&2){let e=p();a(),c("completed",e.importDetails.areLabelsCorrectlySelected()),a(3),c("importDetails",e.importDetails)("showTime",!0),a(),c("importDetails",e.importDetails),a(5),c("disabled",!e.importDetails.areLabelsCorrectlySelected()),a(2),c("completed",e.importDetails.areLabelsCorrectlySelected()&&e.importDetails.isDataStartCorrectlySelected()),a(3),c("importDetails",e.importDetails)("showTime",!0)("showLabelling",!0),a(),c("importDetails",e.importDetails),a(5),c("disabled",!e.importDetails.isDataStartCorrectlySelected())}}function io(n,o){n&1&&m(0,"Select backgrounds labels")}function no(n,o){if(n&1&&(T(0),l(1,"mat-step"),u(2,io,1,0,"ng-template",7),x(3,"mat-divider")(4,"bd2-import-details-summary",20)(5,"bd2-select-backgrounds-labels-step",9,5),l(7,"div")(8,"button",15),m(9,"Back"),s(),l(10,"button",25),m(11,"Next"),s()()(),y()),n&2){let e=p();a(4),c("importDetails",e.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),a(),c("importDetails",e.importDetails)}}function oo(n,o){n&1&&m(0,"Import timeseries")}var di=(()=>{class n{constructor(e,i,t){this.fileService=e,this.feedback=i,this.dataService=t,this.import=new U,this.oldImport=new U,this.blocked=!1,this.importDetails=new Zt,this.importDetails.timeType=ee.TIME_IN_HOURS}ngOnInit(){}ngOnDestroy(){this.dataService&&this.dataService.close()}upload(e){if(!e.files||e.files.length!==1){console.error("Wrong upload files size",e.files);return}this.fileService.uploadFile(e.files[0],e.importFormat).subscribe(i=>{this.importDetails.fileId=i,this.importDetails.fileName=e.files[0].name,this.importDetails.importFormat=e.importFormat,e.importFormat==q.EXCEL_TABLE?this.importDetails.inRows=!1:this.importDetails.inRows=!0,this.stepper.next(),e.importFormat==q.TOPCOUNT&&this.oldImport.next(this.importDetails)},i=>{this.feedback.error(i)})}loadData(e){e.loadData()}startLabelling(){this.importDetails.importLabels?this.importLabelsStep?this.importLabelsStep.loadData():console.error("Missing importLabelStep"):this.assignLabelsStep?this.assignLabelsStep.loadData():console.error("Missing assignLabelsStep")}startChoosingBackgrounds(){this.importDetails.containsBackgrounds&&(this.selectBackgroundsStep?this.selectBackgroundsStep.loadLabels():console.error("Missing selectBackgroundsStep"))}importData(){this.importDetails.isComplete()&&this.import.next(this.importDetails)}static{this.\u0275fac=function(i){return new(i||n)(C(ce),C(P),C(M))}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-import-steps"]],viewQuery:function(i,t){if(i&1&&(N(jn,5),N(Qn,5),N(Gn,5),N(qn,5)),i&2){let r;L(r=E())&&(t.stepper=r.first),L(r=E())&&(t.importLabelsStep=r.first),L(r=E())&&(t.assignLabelsStep=r.first),L(r=E())&&(t.selectBackgroundsStep=r.first)}},inputs:{blocked:"blocked"},outputs:{import:"import",oldImport:"oldImport"},standalone:!1,features:[Se([M])],decls:62,vars:26,consts:[["stepper",""],["defineTimeStep",""],["assignLabelsStep",""],["importLabelsStep",""],["selectDataStartStep",""],["selectBackgroundsStep",""],[3,"linear"],["matStepLabel",""],[3,"uploadFiles"],[3,"importDetails"],["appearance","outlined",1,"mat-elevation-z4"],["name","inRows",1,"spaced",3,"ngModelChange","ngModel"],[3,"value"],["name","importLabels",1,"spaced",3,"ngModelChange","ngModel"],["name","containsBackgrounds",1,"spaced",3,"ngModelChange","ngModel"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","type","button",3,"click"],[3,"completed"],["mat-button","","matStepperNext","","type","button",3,"click","disabled"],[4,"ngIf"],[3,"importDetails","showTime","showLabelling","showDataStart"],["type","info","role","alert",1,"alert","alert-info"],["mat-button","",3,"click","disabled"],[3,"importDetails","showTime"],[3,"importDetails","showTime","showLabelling"],["mat-button","","matStepperNext","","type","button"]],template:function(i,t){if(i&1){let r=S();l(0,"mat-vertical-stepper",6,0)(2,"mat-step"),u(3,Kn,1,0,"ng-template",7),l(4,"bd2-upload-data-file-step",8),b("uploadFiles",function(f){return _(r),h(t.upload(f))}),s()(),l(5,"mat-step")(6,"form"),u(7,$n,1,0,"ng-template",7),x(8,"mat-divider")(9,"bd2-import-details-summary",9),l(10,"mat-card",10)(11,"mat-card-content")(12,"p")(13,"mat-radio-group",11),O("ngModelChange",function(f){return _(r),V(t.importDetails.inRows,f)||(t.importDetails.inRows=f),h(f)}),l(14,"mat-radio-button",12),m(15,"Data in rows"),s(),l(16,"mat-radio-button",12),m(17,"Data in columns"),s()()(),l(18,"p")(19,"mat-radio-group",13),O("ngModelChange",function(f){return _(r),V(t.importDetails.importLabels,f)||(t.importDetails.importLabels=f),h(f)}),l(20,"mat-radio-button",12),m(21),s(),l(22,"mat-radio-button",12),m(23,"Manually label"),s()()(),l(24,"p")(25,"mat-radio-group",14),O("ngModelChange",function(f){return _(r),V(t.importDetails.containsBackgrounds,f)||(t.importDetails.containsBackgrounds=f),h(f)}),l(26,"mat-radio-button",12),m(27,"No noise data"),s(),l(28,"mat-radio-button",12),m(29),s()()()(),l(30,"mat-card-actions")(31,"button",15),m(32,"Back"),s(),l(33,"button",16),b("click",function(){_(r);let f=ae(40);return h(t.loadData(f))}),m(34,"Next"),s()()()()(),l(35,"mat-step",17),u(36,Xn,1,1,"ng-template",7),x(37,"mat-divider")(38,"bd2-import-details-summary",9)(39,"bd2-define-time-step",9,1),l(41,"div")(42,"button",15),m(43,"Back"),s(),l(44,"button",18),b("click",function(){return _(r),h(t.startLabelling())}),m(45,"Next"),s()()(),u(46,Zn,12,5,"ng-container",19)(47,to,23,11,"ng-container",19)(48,no,12,5,"ng-container",19),l(49,"mat-step",17),u(50,oo,1,0,"ng-template",7),x(51,"mat-divider")(52,"bd2-import-details-summary",20),l(53,"mat-card",10)(54,"mat-card-content")(55,"div",21),m(56,"You can now import the timeseries"),s()()(),l(57,"div")(58,"button",15),m(59,"Back"),s(),l(60,"button",22),b("click",function(){return _(r),h(t.importData())}),m(61,"Import data"),s()()()()}i&2&&(c("linear",!0),a(9),c("importDetails",t.importDetails),a(4),B("ngModel",t.importDetails.inRows),a(),c("value",!0),a(2),c("value",!1),a(3),B("ngModel",t.importDetails.importLabels),a(),c("value",!0),a(),g("Import labels from ",t.importDetails.inLabelNeg,""),a(),c("value",!1),a(3),B("ngModel",t.importDetails.containsBackgrounds),a(),c("value",!1),a(2),c("value",!0),a(),g("Background noise in ",t.importDetails.inLabel,"s"),a(6),c("completed",t.importDetails.isTimeDefined()),a(3),c("importDetails",t.importDetails),a(),c("importDetails",t.importDetails),a(5),c("disabled",!t.importDetails.isTimeDefined()),a(2),c("ngIf",!t.importDetails.importLabels),a(),c("ngIf",t.importDetails.importLabels),a(),c("ngIf",t.importDetails.containsBackgrounds),a(),c("completed",t.importDetails.isComplete()),a(3),c("importDetails",t.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),a(8),c("disabled",t.blocked||!t.importDetails.isComplete()))},dependencies:[D,xe,K,Ce,se,we,Ut,Wt,k,Dt,F,wt,jt,zt,Qt,Gt,qt,ve,ti,ii,oi,ai,ri,ci,pi],encapsulation:2})}}return n})();function ro(n,o){n&1&&(l(0,"mat-card",2)(1,"mat-card-content"),x(2,"mat-spinner",3),l(3,"div",4),m(4,"Importing ...."),s()()())}var ui=(()=>{class n extends Pt{constructor(e,i){super(i),this.BD2REST=e,this.importing=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit()}importData(e){if(this.importing)return;let i=new Yt;i.fileId=e.fileId,i.importFormat=e.importFormat,i.importParameters=e,this.importing=!0,this.BD2REST.experimentImportTS(this.assay.id,i).subscribe(t=>{let r="Imported "+t.imported+" timeseries";this.feedback.success(r),this.refreshModel(),this.importing=!1,this.goToTSView()},t=>{this.importing=!1,this.feedback.error(t)})}goToTSView(){let e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}goToOldImport(e){let i=this.expHomePath();i.push("data","ts-old-import",e.importFormat.name,e.fileId),this.router.navigate(i)}static{this.\u0275fac=function(i){return new(i||n)(C(re),C(Mt))}}static{this.\u0275cmp=w({type:n,selectors:[["bd2-tsimport-dashboard"]],standalone:!1,features:[H],decls:2,vars:1,consts:[[3,"import","oldImport"],["appearance","outlined",4,"ngIf"],["appearance","outlined"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"]],template:function(i,t){i&1&&(l(0,"bd2-import-steps",0),b("import",function(d){return t.importData(d)})("oldImport",function(d){return t.goToOldImport(d)}),s(),u(1,ro,5,0,"mat-card",1)),i&2&&(a(),c("ngIf",t.importing))},dependencies:[D,Ht,k,F,di],encapsulation:2})}}return n})();var lo=[{path:"",children:[{path:"",component:ui}]}],fi=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ge({type:n})}static{this.\u0275inj=he({imports:[ze.forChild(lo),ze]})}}return n})();var ar=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=ge({type:n})}static{this.\u0275inj=he({imports:[lt,dt,ut,$t,Kt,fi]})}}return n})();export{ar as TsImportModule};
