import{k as Ve}from"./chunk-QT4LSY2Z.js";import{a as ue}from"./chunk-X3C2FHL5.js";import{a as Ie}from"./chunk-7VADEMAN.js";import{B as ze,d as D,e as Pe,f as we,g as Me,h as $e,i as Fe,j as Te,k as De,l as Le,m as Ae}from"./chunk-3O746AE3.js";import{j}from"./chunk-VHOBWLCH.js";import{i as ke,j as Oe}from"./chunk-JUYLOIM6.js";import{b as B,d as Ee}from"./chunk-P35HZQU6.js";import{B as _e,E as ve,F as ye,G as Ce,b as he,d as de,f as J,i as fe,j as ge,q as Se,r as be,t as xe}from"./chunk-EB5SMJLY.js";import{$ as f,Ab as ne,B as W,Bb as oe,C as O,Cb as F,D as U,Da as _,Db as T,Ea as A,G as X,Ja as S,N as Y,Na as p,P as C,Qa as te,Qb as se,R as Z,Rb as M,S as ee,T as L,Tb as ae,Ub as ce,V as G,Wa as n,Wb as pe,Xa as o,Ya as E,_ as d,ab as P,db as m,fa as Q,fb as w,gc as le,i as R,j as g,jc as q,lc as H,o as k,pb as ie,qb as s,qc as me,rb as re,s as v,sb as I,t as b,ua as c,va as x,y as K,yb as V,z as y,zb as z}from"./chunk-ZWLUK6NT.js";var qe=(()=>{class r{constructor(e=!1){this.removeDebounce=e,this.error$=new R,this.isFetching$=new g(!1),this.isProcessing$=new g(!1),this.dataLength=0,this.page$=new g(void 0),this.sort$=new g(void 0),this.on$=new g(!1),this.refresh$=new R,this.input$=new g(void 0),this.params$=new g(void 0),this.asset$=new g(void 0),this.DEBUG=!1,this.dataInputsDebounce=10,this.assetInputsDebounce=200,this.busyDebounce=50,this.id=r.ids++,this.logMe("created"),this.initAssetsStream(),this.isBusy$=this.initBusyStream(),this.data$=this.initDataStream()}static{this.ids=0}logMe(e,i){this.DEBUG&&(e=this.constructor.name+":"+this.id+" "+e,i?console.log(e,i):console.log(e))}input(e){e&&(this.input$.next(e),this.resetPage())}params(e){this.params$.next(e)}on(e=!0){this.on$.next(e)}refresh(){this.refresh$.next(!0)}page(e){this.page$.next(e)}sort(e){this.sort$.next(e),this.resetPage()}close(){this.asset$.complete(),this.error$.complete(),this.isFetching$.complete(),this.isProcessing$.complete(),this.input$.complete(),this.params$.complete(),this.on$.complete(),this.refresh$.complete(),this.page$.complete(),this.sort$.complete()}errorToData(e){return k(void 0)}assetToSort(e){}assetToPage(e){}resetPage(){this.page$.pipe(U(1)).subscribe(e=>{if(e){let i=new D;i.pageIndex=0,i.pageSize=e.pageSize,this.page(i)}})}initBusyStream(){return this.removeDebounce?b([this.isFetching$,this.isProcessing$]).pipe(v(([e,i])=>e||i)):b([this.isFetching$,this.isProcessing$]).pipe(O(this.busyDebounce),v(([e,i])=>e||i))}initDataStream(){let e=this.dataMutators(),i;return this.removeDebounce?i=b(e):i=b(e).pipe(O(this.dataInputsDebounce)),i.pipe(C(t=>this.logMe("Input for data stream",t)),C(t=>this.isProcessing$.next(!0)),v(([t,a])=>{let l=this.processData(t,a);return this.currentParams=a,this.currentData=l,l}),W(t=>(this.error$.next(t),this.errorToData(t))),C(t=>this.isProcessing$.next(!1)))}dataMutators(){return[this.asset$.pipe(y(e=>!!e)),this.params$]}assetsMutators(){return[this.initAssetsInput(),this.sort$,this.page$.pipe(y(i=>!!i))]}initAssetsStream(){let e=this.assetsMutators(),i;this.removeDebounce?i=b(e):i=b(e).pipe(O(this.assetInputsDebounce)),i.pipe(C(t=>this.logMe("Input for asset stream",t))).subscribe(([t,a,l])=>this.loadAsset(t,a,l),t=>this.error$.next(t))}loadAsset(e,i,t){this.isFetching$.next(!0),this.fetchAsset(e,i,t).subscribe(a=>{this.isFetching$.next(!1),this.setAsset(a,e,i,t)},a=>{this.isFetching$.next(!1),this.error$.next(a)})}setAsset(e,i,t,a){this.currentInput=i,this.currentAsset=e,this.currentSort=this.assetToSort(e)||t,this.currentPage=this.assetToPage(e)||a,this.dataLength=this.assetToDataLength(e),this.asset$.next(e)}initAssetsInput(){let i=b([this.input$,this.on$]).pipe(y(([l,u])=>l&&u),v(([l,u])=>l)).pipe(X((l,u)=>this.sameInput(l,u))),t=this.refresh$.pipe(Y(l=>i.pipe(U(1))));return K(i,t).pipe(C(l=>this.logMe("Assets input",l)))}}return r})();var N=(()=>{class r extends qe{constructor(e,i=!1){super(i),this.experimentService=e,this.experiment$=this.data$}fetchAsset(e,i,t){let a=(e.query||"").trim();return a===""?this.experimentService.getExperiments(e.showPublic,i,t):this.experimentService.searchExperiments(a,e.showPublic,i,t)}processData(e,i){return e.data}sameInput(e,i){return e.showPublic===i.showPublic&&e.query===i.query}assetToDataLength(e){return e.currentPage.length}assetToPage(e){return e.currentPage}errorToData(e){return k([])}static{this.\u0275fac=function(i){return new(i||r)(G(j),G(Ie,8))}}static{this.\u0275prov=ee({token:r,factory:r.\u0275fac})}}return r})();var Ke=r=>["/experiment",r];function We(r,h){r&1&&(n(0,"i",5),s(1,"lock_open"),o())}var je=(()=>{class r{constructor(){}ngOnInit(){}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=_({type:r,selectors:[["bd2-experiment-summary"]],inputs:{exp:"exp"},standalone:!1,decls:24,vars:14,consts:[[1,"list-group-item","list-group-item-action",3,"routerLink"],[1,"list-group-item-heading"],["class","material-icons bd-icon","style","color: green",4,"ngIf"],[1,"list-group-item-text"],[1,"mb-1"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(i,t){i&1&&(n(0,"a",0)(1,"h5",1),S(2,We,2,0,"i",2),s(3),o(),n(4,"div",3)(5,"div",4),s(6),o(),n(7,"div")(8,"strong"),s(9,"Authors:"),o(),s(10),o(),n(11,"div")(12,"small")(13,"strong"),s(14,"Id:"),o(),s(15),n(16,"strong"),s(17,"Executed:"),o(),s(18),F(19,"date"),n(20,"strong"),s(21,"Modified:"),o(),s(22),F(23,"date"),o()()()()),i&2&&(p("routerLink",ne(12,Ke,t.exp.id)),c(2),p("ngIf",t.exp.features.isOpenAccess),c(),I(" ",t.exp.name," "),c(3),re(t.exp.generalDesc.purpose),c(4),I(" ",t.exp.authors,""),c(5),I(" ",t.exp.id," "),c(3),I(" ",T(19,8,t.exp.generalDesc.executionDate.date)," "),c(4),I(" ",T(23,10,t.exp.provenance.modified.date)," "))},dependencies:[M,q,ce],encapsulation:2})}}return r})();var Ne=(()=>{class r{set options(e){e&&(this.currentQuery=e.query,this.currentShowPublic=e.showPublic,this.currentSort=e.sorting)}constructor(e){this.fb=e,this.sortOrderClass="",this.search=new Q,this.sort=new Q,this.currentSort={active:"modified",direction:"desc"},this.currentQuery="",this.currentShowPublic=!1}ngOnInit(){this.sortOptionsF=this.fb.group({sorting:[this.currentSort.active],direction:[this.currentSort.direction]}),this.showPublicF=this.fb.control(this.currentShowPublic),this.queryF=this.fb.control(this.currentQuery,[J.required,J.minLength(3)]),this.sortOptionsF.valueChanges.subscribe(e=>this.updateSort(e.sorting,this.currentSort.direction)),this.showPublicF.valueChanges.subscribe(e=>{this.currentShowPublic=e,this.emitSearch()})}updateSort(e,i){let t={active:e,direction:i};this.currentSort=t,this.sort.next(t)}emitSearch(){let e={showPublic:this.currentShowPublic,query:this.currentQuery};this.search.next(e)}changeDirection(){let e=this.currentSort.direction=="asc"?"desc":"asc";this.sortOrderClass=e=="asc"?"icon-flipped-h":null,this.updateSort(this.currentSort.active,e)}find(){this.queryF.valid&&(this.currentQuery=this.queryF.value,this.emitSearch())}all(){this.queryF.setValue(""),this.currentQuery="",this.emitSearch()}static{this.\u0275fac=function(i){return new(i||r)(x(ve))}}static{this.\u0275cmp=_({type:r,selectors:[["bd2-search-and-sort-panel"]],inputs:{options:"options"},outputs:{search:"search",sort:"sort"},standalone:!1,decls:27,vars:6,consts:[[1,"pb-1","pt-1","searchpanel"],[1,"float-left",3,"formGroup"],["mat-mini-fab","","aria-label","sort direction",1,"mr-1",2,"vertical-align","bottom",3,"click"],["name","sorting","aria-label","sorting","formControlName","sorting",1,"mr-4"],["value","id"],["value","name"],["value","author"],["value","executed"],["value","modified"],[1,"mr-2","mt-2",3,"formControl"],[1,"no-clues","float-right"],["name","search","minlength","3","placeholder","e.g. prr9 temp*",1,"form-control-sm","mr-1",3,"keydown.enter","formControl"],["mat-mini-fab","","aria-label","search",1,"mr-2",3,"click","disabled"],["mat-mini-fab","","color","primary","aria-label","all",2,"vertical-align","bottom",3,"click"],[1,"clearfix"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"small")(2,"div",1)(3,"button",2),m("click",function(){return t.changeDirection()}),n(4,"mat-icon"),s(5,"sort"),o()(),n(6,"mat-button-toggle-group",3)(7,"mat-button-toggle",4),s(8,"Id"),o(),n(9,"mat-button-toggle",5),s(10,"Title"),o(),n(11,"mat-button-toggle",6),s(12,"Author"),o(),n(13,"mat-button-toggle",7),s(14,"Exec."),o(),n(15,"mat-button-toggle",8),s(16,"Mod."),o()()(),n(17,"mat-slide-toggle",9),s(18,"Show public"),o(),n(19,"div",10)(20,"input",11),m("keydown.enter",function(){return t.find()}),o(),n(21,"button",12),m("click",function(){return t.find()}),n(22,"mat-icon"),s(23,"search"),o()(),n(24,"button",13),m("click",function(){return t.all()}),s(25,"all"),o()()(),E(26,"div",14),o()),i&2&&(c(2),p("formGroup",t.sortOptionsF),c(2),te(t.sortOrderClass),c(13),p("formControl",t.showPublicF),c(3),p("formControl",t.queryF),c(),p("disabled",t.queryF.invalid))},dependencies:[de,fe,ge,_e,Se,be,xe,B,Fe,Te,ke,Le],encapsulation:2})}}return r})();var Re=()=>[10,25,50,100,200],et=()=>[],tt=(r,h)=>({pageIndex:r,pageSize:h});function it(r,h){r&1&&(n(0,"div",14),s(1," There are no visible experiments matching the criteria. "),o())}function rt(r,h){r&1&&E(0,"mat-progress-bar",15)}function nt(r,h){if(r&1&&E(0,"bd2-experiment-summary",16),r&2){let e=h.$implicit;p("exp",e)}}function ot(r,h){if(r&1&&(n(0,"a",17),s(1,"Next"),o()),r&2){let e=w();p("routerLink",z(2,et))("queryParams",oe(3,tt,(e.fetcher.currentPage==null?null:e.fetcher.currentPage.pageIndex)+1,e.fetcher.currentPage==null?null:e.fetcher.currentPage.pageSize))}}var Ue=(()=>{class r{constructor(e,i,t,a,l){this.experimentService=e,this.fetcher=i,this.feedback=t,this.userService=a,this.route=l}ngOnInit(){let e=this.firstPage();this.initialSearchOptions={sorting:{active:"modified",direction:"desc"},showPublic:!this.userService.isLoggedIn(),query:""},this.subscribeRoute(),this.fetcher.experiment$.subscribe(i=>this.experiments=i),this.fetcher.error$.subscribe(i=>this.feedback.error(i)),this.fetcher.on(!0),this.sort(this.initialSearchOptions.sorting),this.search(this.initialSearchOptions),this.page(this.firstPage())}ngOnDestroy(){this.routeSubscription&&this.routeSubscription.unsubscribe(),this.fetcher&&this.fetcher.close()}search(e){this.fetcher.input(e)}sort(e){this.fetcher.sort(e)}page(e){this.fetcher.page(e)}firstPage(){let e=+this.route.snapshot.queryParamMap.get("pageIndex")||0,i=+this.route.snapshot.queryParamMap.get("pageSize")||25,t=new D;return t.pageIndex=e,t.pageSize=i,t}subscribeRoute(){this.routeSubscription=this.route.queryParamMap.pipe(y(e=>e.has("pageIndex")&&e.has("pageSize")),v(e=>{let i=new D;return i.pageSize=+e.get("pageSize"),i.pageIndex=+e.get("pageIndex"),i})).subscribe(e=>this.page(e))}refresh(){this.fetcher.refresh()}static{this.\u0275fac=function(i){return new(i||r)(x(j),x(N),x(me),x(ue),x(le))}}static{this.\u0275cmp=_({type:r,selectors:[["ng-component"]],standalone:!1,features:[V([N])],decls:20,vars:18,consts:[["paginator",""],["paginator2",""],[1,"float-left"],["role","button","aria-label","refresh",3,"click"],[1,"material-icons","bd-icon-inh","bd-primary",2,"font-size","larger"],[1,"clearfix"],["class","alert alert-info",4,"ngIf"],[3,"search","sort","options"],[3,"page","length","pageSize","pageIndex","pageSizeOptions"],["mode","indeterminate",4,"ngIf"],[1,"list-group"],[3,"exp",4,"ngFor","ngForOf"],[3,"page","hidden","length","pageSize","pageIndex","pageSizeOptions"],["style","color: rgba(0,0,0,.54);",3,"routerLink","queryParams",4,"ngIf"],[1,"alert","alert-info"],["mode","indeterminate"],[3,"exp"],[2,"color","rgba(0,0,0,.54)",3,"routerLink","queryParams"]],template:function(i,t){if(i&1){let a=P();n(0,"div")(1,"h2",2),s(2,"Experiments "),n(3,"a",3),m("click",function(){return d(a),f(t.refresh())}),n(4,"i",4),s(5,"refresh"),o()()(),E(6,"div",5),S(7,it,2,0,"div",6),n(8,"div")(9,"bd2-search-and-sort-panel",7),m("search",function(u){return d(a),f(t.search(u))})("sort",function(u){return d(a),f(t.sort(u))}),o(),n(10,"mat-paginator",8,0),m("page",function(u){return d(a),f(t.page(u))}),o(),S(12,rt,1,0,"mat-progress-bar",9),F(13,"async"),n(14,"div",10),S(15,nt,1,1,"bd2-experiment-summary",11),o(),n(16,"mat-paginator",12,1),m("page",function(u){return d(a),f(t.page(u))}),o(),n(18,"div",2),S(19,ot,2,6,"a",13),o()()()}if(i&2){let a=ie(11);c(7),p("ngIf",!t.experiments||t.experiments.length<1),c(2),p("options",t.initialSearchOptions),c(),p("length",t.fetcher.dataLength)("pageSize",(t.fetcher.currentPage==null?null:t.fetcher.currentPage.pageSize)||25)("pageIndex",t.fetcher.currentPage==null?null:t.fetcher.currentPage.pageIndex)("pageSizeOptions",z(16,Re)),c(2),p("ngIf",T(13,14,t.fetcher.isBusy$)),c(3),p("ngForOf",t.experiments),c(),p("hidden",(t.experiments==null?null:t.experiments.length)<1)("length",t.fetcher.dataLength)("pageSize",(t.fetcher.currentPage==null?null:t.fetcher.currentPage.pageSize)||25)("pageIndex",t.fetcher.currentPage==null?null:t.fetcher.currentPage.pageIndex)("pageSizeOptions",z(17,Re)),c(3),p("ngIf",a.hasNextPage())}},dependencies:[se,M,Pe,Me,q,je,Ne,ae],encapsulation:2})}}return r})();var st=[{path:"",children:[{path:"",component:Ue,pathMatch:"full"}]}],Ge=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=A({type:r})}static{this.\u0275inj=L({imports:[H.forChild(st),H]})}}return r})();function at(r,h){if(r&1){let e=P();n(0,"i",3),m("click",function(){d(e);let t=w();return f(t.select("desc"))}),s(1,"sort"),o()}}function ct(r,h){if(r&1){let e=P();n(0,"i",4),m("click",function(){d(e);let t=w();return f(t.select(""))}),s(1,"sort"),o()}}function pt(r,h){if(r&1){let e=P();n(0,"i",4),m("click",function(){d(e);let t=w();return f(t.select("asc"))}),s(1,"more_horiz"),o()}}var lt={provide:he,useExisting:Z(()=>mt),multi:!0},mt=(()=>{class r{constructor(){this.value="",this.disabled=!1,this.onChange=e=>{},this.onTouched=()=>{}}ngOnInit(){}select(e){this.disabled||(this.value=e,this.onChange(this.value),this.onTouched())}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}writeValue(e){this.value=e}setDisabledState(e){this.disabled=e}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=_({type:r,selectors:[["bd2-sort-switch"]],standalone:!1,features:[V([lt])],decls:4,vars:4,consts:[["mat-mini-fab","","aria-label","sorting",3,"disabled"],["class","material-icons  icon-flipped-h",3,"click",4,"ngIf"],["class","material-icons",3,"click",4,"ngIf"],[1,"material-icons","icon-flipped-h",3,"click"],[1,"material-icons",3,"click"]],template:function(i,t){i&1&&(n(0,"button",0),S(1,at,2,0,"i",1)(2,ct,2,0,"i",2)(3,pt,2,0,"i",2),o()),i&2&&(p("disabled",t.disabled),c(),p("ngIf",t.value==="asc"),c(),p("ngIf",t.value==="desc"),c(),p("ngIf",t.value===""))},dependencies:[M,B],encapsulation:2})}}return r})();var ci=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=A({type:r})}static{this.\u0275inj=L({imports:[pe,ye,Ce,Ee,De,Oe,Ae,we,ze,$e,Ve,Ge]})}}return r})();export{ci as ExperimentsModule};
