import{a as Xt,b as te}from"./chunk-NIE2ZYPZ.js";import{a as Qt}from"./chunk-LKZSTFDB.js";import{a as ee,b as ie,o as re}from"./chunk-X3OMUHYN.js";import{c as Ht,d as Kt,e as Zt,l as ot}from"./chunk-6HSKS2XP.js";import{i as Yt}from"./chunk-I5BPRPCG.js";import{k as Wt}from"./chunk-K5NGWSTH.js";import{E as j,F as Ut,G as Gt,d as zt,f as I,i as W,j as X,n as tt,o as Jt,r as et,s as jt,t as it,u as rt,v as at,w as nt,y as qt,z as Vt}from"./chunk-2RPFGIFO.js";import{$a as d,B as k,C as yt,Cc as Bt,Da as $,E as St,F as bt,Gb as kt,Ha as O,Ia as Et,J as N,Ja as Dt,Ka as Rt,Kb as ut,Lb as ht,Na as Q,Q as vt,R as Pt,U as J,Ua as Mt,Va as Ft,Wa as L,X as Z,Xa as M,Y as Tt,Ya as F,Za as f,_ as U,_a as c,ab as x,ba as wt,ca as xt,e as v,eb as It,fc as $t,gb as Nt,hb as G,hc as Lt,j as dt,k as _,lb as Ot,mb as Ct,nb as At,p as gt,t as R,u as V,vb as p,wb as Y,ya as u,yb as _t,zb as pt}from"./chunk-EXZ64TUM.js";function fe(r,i){if(r&1&&(c(0,"div",0),x(1,"canvas",1),d()),r&2){let o=G();u(),f("type","line")("datasets",o.dataset.traces)("options",o.scatterOptions)}}var ae=(()=>{let i=class i{constructor(){this.scatterOptions={scales:{xAxes:{type:"linear",position:"bottom"}},legend:{display:!0,position:"bottom"}}}set data(t){this.dataset=t}ngOnInit(){}chartClicked(t){}chartHovered(t){}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=O({type:i,selectors:[["bd2-ts-plot"]],inputs:{data:"data"},standalone:!1,decls:1,vars:1,consts:[[2,"display","block"],["baseChart","","width","auto","height","200",3,"type","datasets","options"]],template:function(e,a){e&1&&Mt(0,fe,2,3,"div",0),e&2&&Ft(a.dataset?0:-1)},dependencies:[Xt],encapsulation:2});let r=i;return r})();var C=class{constructor(i,o){this.x=i,this.y=o}},st=class{constructor(){this.fill=!1,this.data=[]}},lt=class{constructor(){this.traces=[],this.totalTraces=0}};var ne=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],ye=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],q=class r{static extendPalette(i,o){(!i||i.length===0)&&(i=["black"]);let t=[];for(let e=0;e<o;e++)t.push(i[e%i.length]);return t}static palette(i){return i<=ne.length?r.extendPalette(ne,i):r.extendPalette(ye,i)}static toRGBA(i,o){if(i.charAt(0)!=="#")return i;let t=parseInt(i.substring(1,3),16),e=parseInt(i.substring(3,5),16),a=parseInt(i.substring(5,7),16);return`rgba(${t},${e},${a},${o})`}};function Se(r,i){if(r&1&&(c(0,"div")(1,"h4"),p(2),d(),x(3,"bd2-ts-plot",0),d()),r&2){let o=i.$implicit,t=i.$index;u(2),_t("",t+1,". ",o.title),u(),f("data",o)}}var Qe=(()=>{let i=class i{constructor(){this.tracesPerPlot=7,this.datasets=[]}setTraceStyle(t,e,a){let n=q.palette(a),s=["circle","rect","triangle","rectRot","rectRounded"],l=[3,4,5,4,4],m=n[e%n.length];t.borderColor=q.toRGBA(m,.8),t.backgroundColor=q.toRGBA(m,.2),t.pointBackgroundColor=m,t.pointBorderColor="#ffffff",t.pointStyle=s[e%s.length],t.pointRadius=l[e%l.length],t.pointHoverRadius=l[e%l.length]+1}set data(t){if(!t)return;let e=this.split(t,this.tracesPerPlot).map(a=>{a.forEach((s,l)=>this.setTraceStyle(s,l,this.tracesPerPlot));let n=new lt;return n.traces=a,n});this.datasets=e}ngOnInit(){}trackByIx(t,e){return t}split(t,e){let a=[],n=0;for(;n+e<t.length;n+=e){let s=t.slice(n,n+e);a.push(s)}return n<t.length&&a.push(t.slice(n,t.length)),a}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=O({type:i,selectors:[["bd2-ts-plots"]],inputs:{tracesPerPlot:"tracesPerPlot",data:"data"},standalone:!1,decls:2,vars:0,consts:[[3,"data"]],template:function(e,a){e&1&&M(0,Se,4,3,"div",null,a.trackByIx,!0),e&2&&F(a.datasets)},dependencies:[ae],encapsulation:2});let r=i;return r})();function oe(r){let i=r.timeStart,o=r.timeEnd;return i<0?{validTimeScale:"Start time must >= 0"}:o<0?{validTimeScale:"End time must >= 0"}:o>0&&i>=o?{validTimeScale:"Start time must be < end time"}:null}var P=class r{constructor(i,o,t,e,a,n,s=!1,l=!1,m=!1){this.detrending=t,this.normalisation=e,this.align=a,this.page=n,this.log2=s,this.trimFirst=l,this.hourly=m,this.timeScale={timeStart:i,timeEnd:o},this.page=n||r.firstPage()}get timeStart(){return this.timeScale.timeStart}get timeEnd(){return this.timeScale.timeEnd}get timeScaleLabel(){let i=""+this.timeStart;i==="0"&&(i="min");let o=""+this.timeEnd;return o==="0"&&(o="max"),`${i} to ${o}`}static firstPage(){let i=new Kt;return i.pageIndex=0,i.pageSize=50,i}static equalsPages(i,o){return i?o?i.pageIndex===o.pageIndex&&i.pageSize===o.pageSize:!1:!o}isValid(){return!(this.timeScale.timeStart<0||this.timeScale.timeEnd<0||this.timeScale.timeEnd>0&&this.timeScale.timeStart>=this.timeScale.timeEnd)}equals(i){return!(!i||!this.equalsView(i)||this.detrending!==i.detrending||!this.equalsPage(i.page))}equalsView(i){return!(!i||this.timeScale.timeStart!==i.timeScale.timeStart||this.timeScale.timeEnd!==i.timeScale.timeEnd||this.normalisation!==i.normalisation||this.align!==i.align||this.log2!==i.log2||this.trimFirst!==i.trimFirst||this.hourly!==i.hourly)}equalsPage(i){return r.equalsPages(this.page,i)}clone(){return new r(this.timeStart,this.timeEnd,this.detrending,this.normalisation,this.align,this.page,this.log2,this.trimFirst,this.hourly)}setAll(i){Object.assign(this,i),this.timeScale.timeStart=i.timeScale?i.timeScale.timeStart:i.timeStart,this.timeScale.timeEnd=i.timeScale?i.timeScale.timeEnd:i.timeEnd}};var h=class h{constructor(i,o){this._name=i,this._label=o}get name(){return this._name}get label(){return this._label}static get(i){return h.getValuesMap().get(i)}static getValuesMap(){if(!h.valuesMap){let i=new Map;h.values.forEach(o=>i.set(o.name,o)),h.valuesMap=i}return h.valuesMap}toJSON(){return this.name}equals(i){return i?this===i||this===h.get(i.name?i.name:i):!1}};h.NO_DTR=new h("NO_DTR","no dtr"),h.LIN_DTR=new h("LIN_DTR","linear dtr"),h.POLY_DTR=new h("POLY_DTR","cubic dtr"),h.BASE_DTR=new h("BASE_DTR","baseline dtr"),h.BAMP_DTR=new h("BAMP_DTR","amp&baseline dtr"),h.values=[h.NO_DTR,h.LIN_DTR,h.POLY_DTR,h.BASE_DTR,h.BAMP_DTR];var T=h,se=[T.NO_DTR,T.LIN_DTR,T.POLY_DTR,T.BASE_DTR,T.BAMP_DTR],E=class{constructor(i,o){this.name=i,this.label=o}},H=[new E("NO_NORM","none"),new E("RANGE","to [-1,1]"),new E("FOLD","fold change"),new E("Z_SCORE","Z-Score"),new E("MAX_NORM","to extreme")],K=[new E("NONE","none"),new E("MEAN","mean"),new E("SPREAD","spread")];var be=["PERIOD","PHASE","AMP","ERR"],ve=["R_TAU","R_PVALUE","R_PEAK","R_PERIOD"];function le(r,i){return!(!r||!i||r.active!==i.active||r.direction!==i.direction||be.includes(r.active)&&r.ppaJobId!==i.ppaJobId||ve.includes(r.active)&&r.rhythmJobId!==i.rhythmJobId)}var Pe=["dataPaginator"],ce=(()=>{let i=class i{set disabled(t){t?this.mainForm.disable():this.mainForm.enable(),this._disabled=t}get disabled(){return this._disabled}constructor(t){this.fb=t,this.totalTraces=0,this.currentPage=P.firstPage(),this.displayParams=new Q,this._disabled=!1,this.disabledPagination=!1,this.page$=new _(P.firstPage()),this.displayParamsForm=this.buildDisplayParamsForm(),this.mainForm=this.buildMainForm(),this.detrendingOptions=se,this.normalisationOptions=H,this.alignOptions=K}ngOnInit(){this.initDisplayParamsStream()}ngOnDestroy(){this.displayParamsSubscription&&this.displayParamsSubscription.unsubscribe(),this.displayParams&&this.displayParams.complete()}initDisplayParamsStream(){let t=yt(this.displayParamsForm.valueChanges,this.displayParamsForm.statusChanges).pipe(vt([this.displayParamsForm.value,this.displayParamsForm.status]),k(([a,n])=>n==="VALID"&&a),R(([a,n])=>a)),e=V([t,this.page$]).pipe(R(([a,n])=>new P(a.timeScale.timeStart,a.timeScale.timeEnd,T.get(a.detrending),a.normalisation,a.align,n,a.log2,a.trimFirst,a.hourly)),k(a=>a.isValid()),N((a,n)=>n.equals(a)));this.displayParamsSubscription=e.subscribe(a=>this.displayParams.next(a))}buildDisplayParamsForm(){return this.fb.group({timeScale:this.fb.group({timeStart:[0,[I.required]],timeEnd:[0,[I.required]]},{validator:t=>oe(t.value)}),detrending:[this.defaultDetrending(),[I.required]],normalisation:[H[0].name,[I.required]],align:[K[0].name,[I.required]],log2:[!1],trimFirst:[!0],hourly:[!1]})}defaultDetrending(){return T.LIN_DTR.name}buildMainForm(){return this.displayParamsForm}loadDataPage(t){this.page$.next(t)}ngAfterViewInit(){this.dataPaginator&&(this.dataPaginator._intl=new Ht,this.dataPaginator._intl.itemsPerPageLabel="Series per page")}};i.\u0275fac=function(e){return new(e||i)($(j))},i.\u0275dir=Dt({type:i,viewQuery:function(e,a){if(e&1&&Ot(Pe,7),e&2){let n;Ct(n=At())&&(a.dataPaginator=n.first)}}});let r=i;return r})();var we=()=>[10,25,50,100,200];function xe(r,i){if(r&1&&(c(0,"option",16),p(1),d()),r&2){let o=i.$implicit;f("value",o.name),u(),Y(o.label)}}function Ee(r,i){if(r&1&&(c(0,"option",16),p(1),d()),r&2){let o=i.$implicit;f("value",o.name),u(),Y(o.label)}}function De(r,i){if(r&1&&(c(0,"option",16),p(1),d()),r&2){let o=i.$implicit;f("value",o.name),u(),Y(o.label)}}var ui=(()=>{let i=class i extends ce{constructor(t){super(t)}};i.\u0275fac=function(e){return new(e||i)($(j))},i.\u0275cmp=O({type:i,selectors:[["bd2-tsdisplay-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},standalone:!1,features:[Rt],decls:50,vars:7,consts:[["dataPaginator",""],["role","form",1,"form-horizontal","container",3,"formGroup"],[1,"row"],[1,"col-md-8","col-sm-10"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-md-3","col-sm-3"],["for","timeStart",1,"col-md-1","col-sm-2"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-md-1","col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"col-md-2","col-sm-4"],["formControlName","hourly",1,"mr-3"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-3"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value"],[1,"col-sm-1"],["for","align",1,"col-sm-1"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-2"],["for","normalisation"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],[1,"col-sm"],["formControlName","trimFirst",1,"mr-3"],["formControlName","log2"],[1,"col-sm-8"],[3,"page","length","disabled","pageSize","pageIndex","pageSizeOptions"]],template:function(e,a){if(e&1){let n=It();c(0,"form",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"label",5),p(5,"Time range"),d(),c(6,"label",6),p(7,"from:"),d(),c(8,"div",5),x(9,"input",7),d(),c(10,"label",8),p(11,"to:"),d(),c(12,"div",5),x(13,"input",9),d()()(),c(14,"div",10)(15,"mat-slide-toggle",11),p(16,"hourly"),d()()(),c(17,"div",12)(18,"label",13),p(19,"Detrending"),d(),c(20,"div",14)(21,"select",15),M(22,xe,2,2,"option",16,L),d()(),x(24,"div",17),c(25,"label",18),p(26,"Align"),d(),c(27,"div",14)(28,"select",19),M(29,Ee,2,2,"option",16,L),d()()(),c(31,"div",12)(32,"div",20)(33,"label",21),p(34,"Normalize"),d()(),c(35,"div",14)(36,"select",22),M(37,De,2,2,"option",16,L),d()(),c(39,"div",23)(40,"mat-slide-toggle",24),p(41,"within range"),d(),c(42,"mat-slide-toggle",25),p(43,"log2 transf."),d()()(),x(44,"div",12),c(45,"div",12),x(46,"label",20),c(47,"div",26)(48,"mat-paginator",27,0),Nt("page",function(l){return wt(n),xt(a.loadDataPage(l))}),d()()()()}e&2&&(f("formGroup",a.mainForm),u(22),F(a.detrendingOptions),u(7),F(a.alignOptions),u(8),F(a.normalisationOptions),u(11),f("length",a.totalTraces)("disabled",a.disabledPagination)("pageSize",a.currentPage.pageSize)("pageIndex",a.currentPage.pageIndex)("pageSizeOptions",kt(6,we)))},dependencies:[tt,at,nt,zt,Jt,rt,W,X,Vt,qt,et,it,jt,Zt,ot],encapsulation:2});let r=i;return r})();var de=(()=>{let i=class i{constructor(t){this.BD2REST=t}loadDataSet(t,e,a,n){return this.BD2REST.tsdata(t.id,e,a,n)}loadHourlyDataSet(t,e,a,n){return this.BD2REST.tsHourlyData(t.id,e,a,n)}exportURL(t,e){return this.BD2REST.tsdataExportURL(t.id,e.detrending)}dataMetrics(t){return this.BD2REST.tsdataMetrics(t.id)}};i.\u0275fac=function(e){return new(e||i)(U(Bt))},i.\u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"});let r=i;return r})();var mt=class{constructor(i,o,t=0,e=P.firstPage(),a){this.params=i,this.data=o,this.totalTraces=t,this.currentPage=e,this.sorting=a}},pe=(()=>{let i=class i{constructor(t,e=!1){this.tsDataService=t,this.error$=new dt,this.loading$=new dt,this.addTraceNr=!0,this.addTraceRef=!0,this.dataSetsStream=new _(void 0),this.sortStream=new _({}),this.experiment$=new _(void 0);let a=new P(0,0,T.LIN_DTR,H[0].name,K[0].name,P.firstPage());this.displayParamsStream=new _(a),e?this.slowParameters$=this.displayParamsStream.pipe(k(n=>!!n)):this.slowParameters$=this.displayParamsStream.pipe(bt(400),k(n=>!!n)),this.initObservables()}changeDisplayParams(t){this.displayParamsStream.next(t)}experiment(t){this.experiment$.next(t)}sort(t){t&&this.sortStream.next(t)}ngOnDestroy(){this.displayParamsStream.complete(),this.sortStream.complete(),this.dataSetsStream.complete(),this.error$.complete(),this.experiment$.complete(),this.loading$.complete()}initObservables(){this.initDataSetsStream(),this.seriesPackStream=this.initSeriesPackStream(this.dataSetsStream)}initDataSetsStream(){let t=this.slowParameters$.pipe(R(l=>l.page),N((l,m)=>P.equalsPages(l,m))),e=this.experiment$.pipe(k(l=>!!l)),a=this.slowParameters$.pipe(R(l=>l.detrending),N((l,m)=>m.equals(l))),n=this.slowParameters$.pipe(R(l=>l.hourly),N()),s=this.sortStream.pipe(N(le));V([e,a,n,t,s]).pipe(J(l=>this.loading$.next(!0)),Pt(([l,m,S,g,b])=>this.loadDataSet(l,m,S,g,b)),J(l=>this.loading$.next(!1))).subscribe(l=>this.dataSetsStream.next(l),l=>console.log("Error should not propagate here",l))}initSeriesPackStream(t){let e=this.slowParameters$.pipe(N((a,n)=>n.equalsView(a)));return V([t,e]).pipe(R(([a,n])=>this.processDataSet(a,n)),J(a=>this.current=a))}loadDataSet(t,e,a,n,s){let l;return a?l=this.tsDataService.loadHourlyDataSet(t,e,n,s):l=this.tsDataService.loadDataSet(t,e,n,s),l.pipe(J(m=>{m.detrending=m.detrending||e,m.sort=s}),J(m=>m.traces.forEach(S=>this.enrichLabel(S,this.addTraceNr,this.addTraceRef))),St(m=>(console.log("Caught error",m),this.error$.next(m),gt(void 0))))}enrichLabel(t,e,a){e&&a?t.label=`${t.traceNr}.${t.traceRef} ${t.label}`:e&&(t.label=`${t.traceNr}. ${t.label}`)}getFullDataSet(t,e,a){let n={pageIndex:0,pageSize:5e4};return e=e.clone(),e.timeScale.timeStart=0,e.timeScale.timeEnd=0,this.loadDataSet(t,e.detrending,e.hourly,n,a).pipe(R(s=>this.processDataSet(s,e)))}processDataSet(t,e){if(t){let a=this.processDataTraces(t.traces,e);return e=e.clone(),e.detrending=t.detrending,new mt(e,a,t.totalTraces,t.currentPage,t.sort)}else return new mt(e,[],0,P.firstPage(),{})}processDataTraces(t,e){return e.trimFirst&&(t=this.trimData(t,e)),t=this.logData(t,e),t=this.normalizeData(t,e),e.trimFirst||(t=this.trimData(t,e)),t=this.alignData(t,e),t}normalizeData(t,e){return t.map(a=>this.normalizeTrace(a,e))}normalizeTrace(t,e){switch(e.normalisation){case"MEAN_NORM":return this.normalizeTraceToMean(t);case"MAX_NORM":return this.normalizeTraceToMax(t);case"RANGE":return this.normalizeTraceToRange(t);case"FOLD":return this.normalizeTraceToFoldChange(t);case"Z_SCORE":return this.normalizeTraceToZScore(t);default:return t}}normalizeTraceToMean(t){return this.normalizeTraceToFactor(t,t.mean)}normalizeTraceToMax(t){return this.normalizeTraceToFactor(t,Math.max(t.max,-t.min))}normalizeTraceToFactor(t,e){if(e===0)return t;let a=this.copyTrace(t);return a.data=t.data.map(n=>new C(n.x,n.y/e)),a.min=t.min/e,a.max=t.max/e,a.mean=t.mean/e,a}normalizeTraceToRange(t){let e=this.copyTrace(t),a=t.mean,n=Math.max(t.max-t.mean,Math.abs(t.min-t.mean));return e.data=t.data.map(s=>new C(s.x,(s.y-a)/n)),e.min=(t.min-a)/n,e.max=(t.max-a)/n,e.mean=0,e}normalizeTraceToFoldChange(t){return t.min>0?this.normalizeTraceToFactor(t,t.min):this.emptyTrace(t)}normalizeTraceToZScore(t){if(t.data.length<2)return t;let e=t.data.reduce((l,m)=>l+m.y,0)/t.data.length,a=t.data.reduce((l,m)=>l+Math.pow(m.y-e,2),0),n=Math.sqrt(a/(t.data.length-1)),s=this.copyTrace(t);return s.data=t.data.map(l=>new C(l.x,(l.y-e)/n)),this.updateMinMax(s),s}emptyTrace(t){let e=this.copyTrace(t);return e.data=[],e.min=NaN,e.max=NaN,e.mean=NaN,e}copyTrace(t){return Object.assign(new st,t)}logData(t,e){return e.log2?t.map(a=>this.logTrace(a)):t}logTrace(t){let a=this.copyTrace(t);return a.data=t.data.filter(n=>n.y>=0).map(n=>new C(n.x,Math.log2(n.y+.015625))),this.updateMinMax(a),a}alignData(t,e){return e.align==="MEAN"?t.map(a=>this.zeroTrace(a)):e.align==="SPREAD"?this.spreadMeans(t):t}zeroTrace(t){return this.subTrace(t,t.mean)}subTrace(t,e){let a=this.copyTrace(t);return a.data=t.data.map(n=>new C(n.x,n.y-e)),a.min=t.min-e,a.max=t.max-e,a.mean=t.mean-e,a}trimData(t,e){return t.map(a=>this.trimTrace(a,e)).filter(a=>a.data.length>0)}trimTrace(t,e){if(e.timeStart===0&&e.timeEnd===0)return t;let a=this.copyTrace(t),n=0;if(e.timeStart!==0)for(;n<t.data.length&&!(t.data[n].x>=e.timeStart);n++);let s=t.data.length-1;if(e.timeEnd!==0)for(;s>=0&&!(t.data[s].x<=e.timeEnd);s--);return s++,a.data=t.data.slice(n,s),this.updateMinMax(a),a}spreadMeans(t){let e=[],a=0,n=0;return t.forEach(s=>{let l=Math.max(n,s.mean-s.min),m=a+l;n=s.max-s.mean,e.push(this.subTrace(s,s.mean-m)),a=m}),e}updateMinMax(t){let e=this.minMaxMean(t.data);t.min=e.min,t.max=e.max,t.mean=e.mean}minMaxMean(t){let e={min:NaN,max:NaN,mean:NaN};return t.length===0||(e.min=t[0].y,e.max=t[0].y,e.mean=0,t.forEach(a=>{let n=a.y;n<e.min&&(e.min=n),n>e.max&&(e.max=n),e.mean+=n}),e.mean=e.mean/t.length),e}};i.\u0275fac=function(e){return new(e||i)(U(de),U(Qt,8))},i.\u0275prov=Z({token:i,factory:i.\u0275fac});let r=i;return r})();function Fe(r,i){if(r&1&&(c(0,"option",11),p(1),ut(2,"date"),d()),r&2){let o=i.$implicit,t=G();f("value",o.jobId),u(),pt(" ",o.method,": ",t.shortUUID(o.jobId)," (",ht(2,4,t.toLocalDateTime(o.submitted)),") ")}}function Ie(r,i){if(r&1&&(c(0,"option",11),p(1),ut(2,"date"),d()),r&2){let o=i.$implicit,t=G();f("value",o.jobId),u(),pt(" ",t.friendlyRhythmMethod(o.parameters.METHOD),": ",t.shortUUID(o.jobId)," (",ht(2,4,t.toLocalDateTime(o.jobStatus.submitted)),") ")}}var Oi=(()=>{let i=class i{set rhythmJobs(t){this._rhythmJobs=t,this.noRhythm=!t||t.length<1,this.sortParamsForm.get("rhythmJobId").setValue(this.noRhythm?void 0:t[0].jobId)}get rhythmJobs(){return this._rhythmJobs}set ppaJobs(t){this._ppaJobs=t,this.noPPA=!t||t.length<1,this.sortParamsForm.get("ppaJobId").setValue(this.noPPA?void 0:t[0].jobId)}get ppaJobs(){return this._ppaJobs}constructor(t,e){this.fb=t,this.fetcher=e,this.sorting=new Q,this.noPPA=!0,this.noRhythm=!0,this._rhythmJobs=[],this._ppaJobs=[],this.sortParamsForm=this.buildSortParamsForm(t),this.mainForm=this.buildMainForm(this.sortParamsForm,t),this.ppaJobs=[],this.rhythmJobs=[]}ngOnInit(){this.valuesSubscription=this.mainForm.valueChanges.subscribe(t=>{let e=t;e.direction=t.isAscending?"asc":"desc",this.sorting.next(e),this.fetcher&&this.fetcher.sort(e)})}ngOnDestroy(){this.valuesSubscription&&this.valuesSubscription.unsubscribe(),this.sorting&&this.sorting.complete()}buildSortParamsForm(t){return t.group({active:[this.defaultSorting(),[I.required]],isAscending:[!0,[I.required]],ppaJobId:[],rhythmJobId:[]})}buildMainForm(t,e){return t}defaultSorting(){return"NR"}shortUUID(t){return Wt(t)}toLocalDateTime(t){return Yt.deserialize(t).date}friendlyRhythmMethod(t){return t==="BD2JTK"?"JTK":t==="BD2EJTK"?"eJTK":t}};i.\u0275fac=function(e){return new(e||i)($(j),$(pe,8))},i.\u0275cmp=O({type:i,selectors:[["bd2-tssort-params-rform"]],inputs:{rhythmJobs:"rhythmJobs",ppaJobs:"ppaJobs"},outputs:{sorting:"sorting"},standalone:!1,decls:44,vars:8,consts:[[1,"container"],["role","form",3,"formGroup"],["aria-label","Sorting options","formControlName","active"],[1,"row","mb-1"],[1,"col-lg-2"],[1,"col-lg-4"],["formControlName","isAscending"],[1,"col-lg-5"],["value","NR"],["value","LABEL"],["id","ppa","aria-label","Select period analysis","formControlName","ppaJobId",1,"form-control"],[3,"value"],["value","PERIOD",3,"disabled"],["value","PHASE",3,"disabled"],["value","AMP",3,"disabled"],["value","ERR",3,"disabled"],["id","rhythm","aria-label","Select rhythmicity test","formControlName","rhythmJobId",1,"form-control"],["value","R_TAU",3,"disabled"],["value","R_PEAK",3,"disabled"],["value","R_PERIOD",3,"disabled"]],template:function(e,a){e&1&&(c(0,"div",0)(1,"form",1)(2,"mat-radio-group",2)(3,"div",3)(4,"label",4),p(5,"Sort"),d(),c(6,"div",5)(7,"mat-slide-toggle",6),p(8,"asc."),d()(),c(9,"div",7)(10,"mat-radio-button",8),p(11,"nr."),d(),c(12,"mat-radio-button",9),p(13,"label"),d()()(),c(14,"div",3)(15,"label",4),p(16,"PPA Analysis"),d(),c(17,"div",5)(18,"select",10),M(19,Fe,3,6,"option",11,L),d()(),c(21,"div",7)(22,"mat-radio-button",12),p(23,"period"),d(),c(24,"mat-radio-button",13),p(25,"phase"),d(),c(26,"mat-radio-button",14),p(27,"amp."),d(),c(28,"mat-radio-button",15),p(29,"err"),d()()(),c(30,"div",3)(31,"label",4),p(32,"Rhythmicity Test"),d(),c(33,"div",5)(34,"select",16),M(35,Ie,3,6,"option",11,L),d()(),c(37,"div",7)(38,"mat-radio-button",17),p(39,"signif."),d(),c(40,"mat-radio-button",18),p(41,"peak"),d(),c(42,"mat-radio-button",19),p(43,"length"),d()()()()()()),e&2&&(u(),f("formGroup",a.mainForm),u(18),F(a.ppaJobs),u(3),f("disabled",a.noPPA),u(2),f("disabled",a.noPPA),u(2),f("disabled",a.noPPA),u(2),f("disabled",a.noPPA),u(7),F(a.rhythmJobs),u(3),f("disabled",a.noRhythm),u(2),f("disabled",a.noRhythm),u(2),f("disabled",a.noRhythm))},dependencies:[tt,at,nt,rt,W,X,et,it,ee,ie,ot,$t],styles:["mat-radio-button[_ngcontent-%COMP%]{margin-right:.5em}"]});let r=i;return r})();var Gi=(()=>{let i=class i{};i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=Et({type:i}),i.\u0275inj=Tt({imports:[Lt,Ut,Gt,te,re]});let r=i;return r})();var ft=(()=>{if(typeof self>"u")return!1;if(!("top"in self&&self!==top)){if("showOpenFilePicker"in self)return"showOpenFilePicker"}return!1})(),Ki=ft?Promise.resolve().then(function(){return Ae}):Promise.resolve().then(function(){return ze});var Zi=ft?Promise.resolve().then(function(){return ke}):Promise.resolve().then(function(){return je});var Ne=ft?Promise.resolve().then(function(){return Le}):Promise.resolve().then(function(){return Ve});function Qi(...r){return v(this,null,function*(){return(yield Ne).default(...r)})}var Oe=r=>v(null,null,function*(){let i=yield r.getFile();return i.handle=r,i}),Ce=(...i)=>v(null,[...i],function*(r=[{}]){Array.isArray(r)||(r=[r]);let o=[];r.forEach((a,n)=>{o[n]={description:a.description||"Files",accept:{}},a.mimeTypes?a.mimeTypes.map(s=>{o[n].accept[s]=a.extensions||[]}):o[n].accept["*/*"]=a.extensions||[]});let t=yield window.showOpenFilePicker({id:r[0].id,startIn:r[0].startIn,types:o,multiple:r[0].multiple||!1,excludeAcceptAllOption:r[0].excludeAcceptAllOption||!1}),e=yield Promise.all(t.map(Oe));return r[0].multiple?e:e[0]}),Ae={__proto__:null,default:Ce};function ct(r){function i(o){if(Object(o)!==o)return Promise.reject(new TypeError(o+" is not an object."));var t=o.done;return Promise.resolve(o.value).then(function(e){return{value:e,done:t}})}return ct=function(o){this.s=o,this.n=o.next},ct.prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(o){var t=this.s.return;return t===void 0?Promise.resolve({value:o,done:!0}):i(t.apply(this.s,arguments))},throw:function(o){var t=this.s.return;return t===void 0?Promise.reject(o):i(t.apply(this.s,arguments))}},new ct(r)}var ue=(e,a,...n)=>v(null,[e,a,...n],function*(r,i,o=r.name,t){let s=[],l=[];var m,S=!1,g=!1;try{for(var b,A=function(y){var D,w,z,he=2;for(typeof Symbol<"u"&&(w=Symbol.asyncIterator,z=Symbol.iterator);he--;){if(w&&(D=y[w])!=null)return D.call(y);if(z&&(D=y[z])!=null)return new ct(D.call(y));w="@@asyncIterator",z="@@iterator"}throw new TypeError("Object is not async iterable")}(r.values());S=!(b=yield A.next()).done;S=!1){let y=b.value,D=`${o}/${y.name}`;y.kind==="file"?l.push(y.getFile().then(w=>(w.directoryHandle=r,w.handle=y,Object.defineProperty(w,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>D})))):y.kind!=="directory"||!i||t&&t(y)||s.push(ue(y,i,D,t))}}catch(y){g=!0,m=y}finally{try{S&&A.return!=null&&(yield A.return())}finally{if(g)throw m}}return[...(yield Promise.all(s)).flat(),...yield Promise.all(l)]}),_e=(...i)=>v(null,[...i],function*(r={}){r.recursive=r.recursive||!1,r.mode=r.mode||"read";let o=yield window.showDirectoryPicker({id:r.id,startIn:r.startIn,mode:r.mode});return ue(o,r.recursive,void 0,r.skipDirectory)}),ke={__proto__:null,default:_e},$e=(a,...n)=>v(null,[a,...n],function*(r,i=[{}],o=null,t=!1,e=null){Array.isArray(i)||(i=[i]),i[0].fileName=i[0].fileName||"Untitled";let s=[],l=null;if(r instanceof Blob&&r.type?l=r.type:r.headers&&r.headers.get("content-type")&&(l=r.headers.get("content-type")),i.forEach((g,b)=>{s[b]={description:g.description||"Files",accept:{}},g.mimeTypes?(b===0&&l&&g.mimeTypes.push(l),g.mimeTypes.map(A=>{s[b].accept[A]=g.extensions||[]})):l?s[b].accept[l]=g.extensions||[]:s[b].accept["*/*"]=g.extensions||[]}),o)try{yield o.getFile()}catch(g){if(o=null,t)throw g}let m=o||(yield window.showSaveFilePicker({suggestedName:i[0].fileName,id:i[0].id,startIn:i[0].startIn,types:s,excludeAcceptAllOption:i[0].excludeAcceptAllOption||!1}));!o&&e&&e(m);let S=yield m.createWritable();return"stream"in r?(yield r.stream().pipeTo(S),m):"body"in r?(yield r.body.pipeTo(S),m):(yield S.write(yield r),yield S.close(),m)}),Le={__proto__:null,default:$e},Be=(...i)=>v(null,[...i],function*(r=[{}]){return Array.isArray(r)||(r=[r]),new Promise((o,t)=>{let e=document.createElement("input");e.type="file";let a=[...r.map(m=>m.mimeTypes||[]),...r.map(m=>m.extensions||[])].join();e.multiple=r[0].multiple||!1,e.accept=a||"",e.style.display="none",document.body.append(e);let n=m=>{typeof s=="function"&&s(),o(m)},s=r[0].legacySetup&&r[0].legacySetup(n,()=>s(t),e),l=()=>{window.removeEventListener("focus",l),e.remove()};e.addEventListener("click",()=>{window.addEventListener("focus",l)}),e.addEventListener("change",()=>{window.removeEventListener("focus",l),e.remove(),n(e.multiple?Array.from(e.files):e.files[0])}),"showPicker"in HTMLInputElement.prototype?e.showPicker():e.click()})}),ze={__proto__:null,default:Be},Je=(...i)=>v(null,[...i],function*(r=[{}]){return Array.isArray(r)||(r=[r]),r[0].recursive=r[0].recursive||!1,new Promise((o,t)=>{let e=document.createElement("input");e.type="file",e.webkitdirectory=!0;let a=s=>{typeof n=="function"&&n(),o(s)},n=r[0].legacySetup&&r[0].legacySetup(a,()=>n(t),e);e.addEventListener("change",()=>{let s=Array.from(e.files);r[0].recursive?r[0].recursive&&r[0].skipDirectory&&(s=s.filter(l=>l.webkitRelativePath.split("/").every(m=>!r[0].skipDirectory({name:m,kind:"directory"})))):s=s.filter(l=>l.webkitRelativePath.split("/").length===2),a(s)}),"showPicker"in HTMLInputElement.prototype?e.showPicker():e.click()})}),je={__proto__:null,default:Je},qe=(o,...t)=>v(null,[o,...t],function*(r,i={}){Array.isArray(i)&&(i=i[0]);let e=document.createElement("a"),a=r;"body"in r&&(a=yield function(l,m){return v(this,null,function*(){let S=l.getReader(),g=new ReadableStream({start:y=>function D(){return v(this,null,function*(){return S.read().then(({done:w,value:z})=>{if(!w)return y.enqueue(z),D();y.close()})})}()}),b=new Response(g),A=yield b.blob();return S.releaseLock(),new Blob([A],{type:m})})}(r.body,r.headers.get("content-type"))),e.download=i.fileName||"Untitled",e.href=URL.createObjectURL(yield a);let n=()=>{typeof s=="function"&&s()},s=i.legacySetup&&i.legacySetup(n,()=>s(),e);return e.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(e.href),3e4),n()}),e.click(),null}),Ve={__proto__:null,default:qe};export{P as a,C as b,st as c,lt as d,T as e,E as f,pe as g,Qi as h,q as i,ae as j,Qe as k,ce as l,ui as m,Oi as n,Gi as o};
