import{a as Ve,b as q,c as O,d as ke,e as Q,f as R,g as Y,h as B,i as z,j as L,k as Me}from"./chunk-IV43UCOI.js";import{a as ie,b as Oe,c as Re,d as Be,e as Le}from"./chunk-AUARK44K.js";import{a as $}from"./chunk-NT63QJH6.js";import{a as Ne}from"./chunk-NS2WMCE2.js";import"./chunk-N5K2AFHX.js";import{a as J,b as D,c as V}from"./chunk-R546TKQQ.js";import"./chunk-7UCAK7A4.js";import"./chunk-DJ2VVPKW.js";import{j as U,k as Te}from"./chunk-3DRDKITD.js";import"./chunk-5VYPYMOR.js";import"./chunk-VRYT53ET.js";import{A as Ae,F as Ie,a as xe,c as he,i as Ce,j as ye,k as be,m as ge,n as Ee,u as Fe,v as we,w as Se,z as De}from"./chunk-V2HAGLXN.js";import{a as W}from"./chunk-P7IXKCK2.js";import{Ab as E,B as K,Bb as w,Bc as ve,Ca as s,Da as h,Eb as X,Fb as Z,Gb as ee,Hb as T,Ib as C,Ma as y,Na as I,Pa as F,Sa as p,Wa as r,X as ae,Y as A,_ as se,ac as S,bc as b,db as n,ea as _,eb as o,fa as u,fb as f,gc as N,jb as x,la as me,mb as v,ob as m,sc as j,t as oe,tb as ce,tc as _e,ub as de,uc as G,vb as le,vc as ue,wc as fe,xc as te,yb as pe,zb as c}from"./chunk-L7CH4MQ7.js";var at=()=>["/experiments"],st=()=>["."],k=()=>({exact:!0}),mt=()=>["file"],ct=()=>["edit"],dt=()=>[".","data","view","ts"],lt=()=>[".","data","view","heatmap"],pt=()=>["ppa/new"],_t=()=>["ppa"],Pe=()=>({exact:!1}),ut=()=>["rhythmicity"],ft=()=>[".","data","ts-import"],vt=()=>["publish"];function xt(t,d){t&1&&(n(0,"a",6),c(1,"Edit"),o()),t&2&&r("routerLink",C(2,ct))("routerLinkActiveOptions",C(3,k))}function ht(t,d){t&1&&(n(0,"a",6),c(1,"Show data"),o()),t&2&&r("routerLink",C(2,dt))("routerLinkActiveOptions",C(3,k))}function Ct(t,d){t&1&&(n(0,"a",6),c(1,"Heatmap"),o()),t&2&&r("routerLink",C(2,lt))("routerLinkActiveOptions",C(3,k))}function yt(t,d){t&1&&(n(0,"a",6),c(1,"Period analysis"),o()),t&2&&r("routerLink",C(2,pt))("routerLinkActiveOptions",C(3,k))}function bt(t,d){t&1&&(n(0,"a",6),c(1,"Period analysis"),o()),t&2&&r("routerLink",C(2,_t))("routerLinkActiveOptions",C(3,Pe))}function gt(t,d){t&1&&(n(0,"a",6),c(1,"Rhythmicity"),o()),t&2&&r("routerLink",C(2,ut))("routerLinkActiveOptions",C(3,Pe))}function Et(t,d){if(t&1&&(n(0,"a",6),c(1),o()),t&2){let e=m(2);r("routerLink",C(3,ft))("routerLinkActiveOptions",C(4,k)),s(),w(" ",e.experiment.features.hasTSData?"Replace data":"Import data","")}}function Ft(t,d){t&1&&(n(0,"a",6)(1,"i",8),c(2,"lock_open"),o()()),t&2&&r("routerLink",C(2,vt))("routerLinkActiveOptions",C(3,k))}function wt(t,d){if(t&1){let e=x();n(0,"div",1)(1,"nav",2)(2,"a",3)(3,"i",4),c(4,"fast_rewind"),o()(),n(5,"a",5),v("click",function(){_(e);let a=m();return u(a.back())}),n(6,"i",4),c(7,"arrow_left"),o()(),n(8,"a",5),v("click",function(){_(e);let a=m();return u(a.refresh())}),n(9,"i",4),c(10,"refresh"),o()(),n(11,"a",6),c(12,"Overview"),o(),p(13,xt,2,4,"a",7)(14,ht,2,4,"a",7)(15,Ct,2,4,"a",7)(16,yt,2,4,"a",7)(17,bt,2,4,"a",7)(18,gt,2,4,"a",7)(19,Et,2,5,"a",7),n(20,"a",6),c(21,"Files"),o(),p(22,Ft,3,4,"a",7),o()()}if(t&2){let e=m();s(2),r("routerLink",C(13,at)),s(9),r("routerLink",C(14,st))("routerLinkActiveOptions",C(15,k)),s(2),r("ngIf",e.experiment.security.canWrite),s(),r("ngIf",e.experiment.features.hasTSData),s(),r("ngIf",e.experiment.features.hasTSData),s(),r("ngIf",e.experiment.security.canWrite&&e.experiment.features.hasTSData&&!e.experiment.features.hasPPAJobs),s(),r("ngIf",e.experiment.features.hasPPAJobs),s(),r("ngIf",e.experiment.security.canWrite&&e.experiment.features.hasTSData||e.experiment.features.hasRhythmicityJobs),s(),r("ngIf",e.experiment.security.canWrite),s(),r("routerLink",C(16,mt))("routerLinkActiveOptions",C(17,k)),s(2),r("ngIf",e.experiment.security.isOwner||e.experiment.security.isSuperOwner)}}var je=(()=>{class t{constructor(){this.onRefresh=new me}refresh(){this.onRefresh.emit(!0)}back(){window.history.back()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=y({type:t,selectors:[["bd2-experiment-navigation"]],inputs:{experiment:"experiment"},outputs:{onRefresh:"onRefresh"},standalone:!1,features:[T([])],decls:1,vars:1,consts:[["style","margin-bottom: 2em;",4,"ngIf"],[2,"margin-bottom","2em"],[1,"secondary"],[3,"routerLink"],[1,"material-icons","bd-icon"],["role","button",1,"shade",3,"click"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions",4,"ngIf"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(i,a){i&1&&p(0,wt,23,18,"div",0),i&2&&r("ngIf",a.experiment)},dependencies:[b,ue,fe],encapsulation:2})}}return t})();function Dt(t,d){if(t&1&&(n(0,"div",2)(1,"strong"),c(2,"Open Access: "),o(),c(3," under "),n(4,"strong"),c(5),o(),c(6," license "),o()),t&2){let e=m(2);s(5),E(e.model.features.licence)}}function At(t,d){if(t&1&&(n(0,"span"),c(1),o()),t&2){let e=d.$implicit;s(),w("",e.name,", ")}}function It(t,d){if(t&1&&(n(0,"div",2)(1,"strong"),c(2,"Authors: "),o(),p(3,At,2,1,"span",5),o()),t&2){let e=m(2);s(3),r("ngForOf",e.model.contributionDesc.authors)}}function Tt(t,d){if(t&1&&(n(0,"div",1)(1,"div",2)(2,"strong"),c(3,"Purpose: "),o(),c(4),o(),p(5,Dt,7,1,"div",3)(6,It,4,1,"div",3),n(7,"div",4)(8,"strong"),c(9,"Data category: "),o(),c(10),o()()),t&2){let e=m();s(4),w(" ",e.model.generalDesc.purpose," "),s(),r("ngIf",e.model.features.isOpenAccess),s(),r("ngIf",e.model.contributionDesc.authors),s(4),w(" ",e.model.dataCategory==null?null:e.model.dataCategory.longName," ")}}var Ge=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=y({type:t,selectors:[["bd2-experiment-basic-info-view"]],inputs:{model:"model"},standalone:!1,decls:1,vars:1,consts:[["class","summary-box",4,"ngIf"],[1,"summary-box"],[1,"item"],["class","item",4,"ngIf"],[1,"item","item-last"],[4,"ngFor","ngForOf"]],template:function(i,a){i&1&&p(0,Tt,11,4,"div",0),i&2&&r("ngIf",a.model)},dependencies:[S,b],encapsulation:2})}}return t})();function Ot(t,d){t&1&&(n(0,"i",7),c(1,"lock_open"),o())}function Rt(t,d){if(t&1){let e=x();n(0,"div")(1,"div",1)(2,"div",2)(3,"h3"),p(4,Ot,2,0,"i",3),c(5),f(6,"br"),n(7,"small"),c(8),o()()(),n(9,"div",4),f(10,"bd2-experiment-basic-info-view",5),o()(),n(11,"bd2-experiment-navigation",6),v("onRefresh",function(){_(e);let a=m();return u(a.refresh())}),o()()}if(t&2){let e=m();s(4),r("ngIf",e.model.features.isOpenAccess),s(),w(" Experiment: ",e.model.id,""),s(3),E(e.model.name),s(2),r("model",e.model),s(),r("experiment",e.model)}}function Bt(t,d){t&1&&(n(0,"div"),c(1," ... loading experiment "),n(2,"p"),c(3,"If just logged in try to refresh the window if the experiment is not loading."),o()())}function Lt(t,d){t&1&&(n(0,"div")(1,"h4"),c(2,"You don't have sufficient permissions to see the experiment"),o(),n(3,"p"),c(4,"Try to login"),o()())}var We=(()=>{class t{constructor(e,i,a,l,it,nt,rt,ot){this.experimentService=e,this.RDMSocial=i,this.currentExperiment=a,this.feedback=l,this.analytics=it,this.route=nt,this.router=rt,this.dialogs=ot,this.isUnauthorised=!1}ngOnInit(){this.expSubscription=this.currentExperiment.experiment().pipe(K(e=>!!e)).subscribe(e=>{this.model=e,this.analytics.experimentView(e.id),this.RDMSocial.shouldShowMeasurementWarning(e).then(i=>{i&&this.showMetadataWarning()})},e=>this.feedback.error(e),()=>console.log("currentExperimentStream completed")),this.paramsSubscription=this.route.paramMap.pipe(oe(e=>e.get("id")),K(e=>!!e)).subscribe(e=>this.loadExperiment(+e))}ngOnDestroy(){this.paramsSubscription&&this.paramsSubscription.unsubscribe(),this.expSubscription&&this.expSubscription.unsubscribe(),this.currentExperiment&&this.currentExperiment.close()}refresh(){this.model&&this.loadExperiment(this.model.id)}loadExperiment(e){this.experimentService.getExperiment(e).then(i=>{this.currentExperiment.push(i),this.isUnauthorised=!1}).catch(i=>{this.isUnauthorised=i.isUnauthorised,this.feedback.error(i)})}handleWarningResponse(e){console.log("Dialog: "+e)}showMetadataWarning(){this.dialogs.confirm("Metadata reminder",`
        <p>
        Please add measurements details, like technique, equipment and short description.
        </p>
        <p>
        It will improve the metadata quality and it will help you when searching for the data.
        </p>
`,"Not now").subscribe(e=>{this.RDMSocial.registerMeasurementWarning(this.model),e&&this.router.navigate(["edit"],{relativeTo:this.route,fragment:"MeasurementSection"})})}static{this.\u0275fac=function(i){return new(i||t)(h(U),h($),h(J),h(W),h(xe),h(j),h(G),h(Ne))}}static{this.\u0275cmp=y({type:t,selectors:[["ng-component"]],standalone:!1,features:[T([J,D])],decls:5,vars:3,consts:[[4,"ngIf"],[1,"card","asset-card"],[1,"card-header"],["class","material-icons bd-icon","style","color: green; font-size: 1.5em;",4,"ngIf"],[1,"card-body"],[3,"model"],[3,"onRefresh","experiment"],[1,"material-icons","bd-icon",2,"color","green","font-size","1.5em"]],template:function(i,a){i&1&&(n(0,"div"),p(1,Rt,12,5,"div",0)(2,Bt,4,0,"div",0)(3,Lt,5,0,"div",0),f(4,"router-outlet"),o()),i&2&&(s(),r("ngIf",a.model),s(),r("ngIf",!a.model&&!a.isUnauthorised),s(),r("ngIf",!a.model&&a.isUnauthorised))},dependencies:[b,_e,je,Ge],encapsulation:2})}}return t})();function Pt(t,d){if(t&1&&(n(0,"div")(1,"h3"),c(2,"Overview of experimental details"),o(),n(3,"div",1)(4,"div",2),c(5,"General description"),o(),n(6,"div",3),f(7,"bd2-general-desc-view",4),o()(),n(8,"div",1)(9,"div",2),c(10,"Contributions"),o(),n(11,"div",3),f(12,"bd2-contr-desc-view",4),o()(),n(13,"div",1)(14,"div",2),c(15,"Biological details"),o(),n(16,"div",3),f(17,"bd2-simple-bio-desc-view",4),o()(),n(18,"div",1)(19,"div",2),c(20,"Measurement details"),o(),n(21,"div",3),f(22,"bd2-measurement-desc-view",4),o()()()),t&2){let e=m();s(7),r("model",e.assay.generalDesc),s(5),r("model",e.assay.contributionDesc),s(5),r("model",e.assay),s(5),r("model",e.assay.experimentalDetails.measurementDesc)}}var ze=(()=>{class t extends V{constructor(e){super(e)}static{this.\u0275fac=function(i){return new(i||t)(h(D))}}static{this.\u0275cmp=y({type:t,selectors:[["ng-component"]],standalone:!1,features:[T([]),F],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"model"]],template:function(i,a){i&1&&p(0,Pt,23,4,"div",0),i&2&&r("ngIf",a.assay)},dependencies:[b,O,R,B,L],encapsulation:2})}}return t})();var H=class t{static{this.INSTANCE=new t}constructor(){}validate(d){let e=[];return d?((!d.species||d.species.trim()=="")&&e.push("Non empty species is required"),(!d.dataCategory||d.dataCategory.name=="NONE")&&e.push("Data category is required"),e):["Cannot validate null object"]}};var P=class t{static{this.INSTANCE=new t}constructor(){this.generalV=Ve.INSTANCE,this.contribV=ke.INSTANCE,this.bioV=H.INSTANCE}validate(d){let e=[];return e=e.concat(this.generalV.validate(d.generalDesc),this.contribV.validate(d.contributionDesc),this.bioV.validate(d)),e}};function qt(t,d){if(t&1&&(n(0,"li"),c(1),o()),t&2){let e=d.$implicit;s(),E(e)}}function Qt(t,d){if(t&1&&(n(0,"div",8)(1,"ul"),p(2,qt,2,1,"li",9),o()()),t&2){let e=m(2);s(2),r("ngForOf",e.errors)}}function Yt(t,d){if(t&1){let e=x();n(0,"bd2-general-desc-form",10),v("onAccepted",function(a){_(e);let l=m(2);return u(l.saveEdits(a))})("onCancelled",function(a){_(e);let l=m(2);return u(l.hideEdits(a))}),o()}if(t&2){let e=m(2);r("blocked",e.blocked)("model",e.assay.generalDesc)}}function zt(t,d){if(t&1&&f(0,"bd2-general-desc-view",11),t&2){let e=m(2);r("model",e.assay.generalDesc)}}function Jt(t,d){if(t&1){let e=x();n(0,"div"),f(1,"hr"),n(2,"button",12),v("click",function(){_(e);let a=m(2);return u(a.activeGeneralDescForm=!0)}),c(3,"Modify "),o()()}if(t&2){let e=m(2);s(2),r("disabled",e.activeGeneralDescForm)}}function $t(t,d){if(t&1){let e=x();n(0,"bd2-contr-desc-form",10),v("onAccepted",function(a){_(e);let l=m(2);return u(l.saveEdits(a))})("onCancelled",function(a){_(e);let l=m(2);return u(l.hideEdits(a))}),o()}if(t&2){let e=m(2);r("blocked",e.blocked)("model",e.assay.contributionDesc)}}function Ht(t,d){if(t&1&&f(0,"bd2-contr-desc-view",11),t&2){let e=m(2);r("model",e.assay.contributionDesc)}}function Kt(t,d){if(t&1){let e=x();n(0,"div"),f(1,"hr"),n(2,"button",12),v("click",function(){_(e);let a=m(2);return u(a.activeContributionDescForm=!0)}),c(3,"Modify "),o()()}if(t&2){let e=m(2);s(2),r("disabled",e.activeContributionDescForm)}}function Xt(t,d){if(t&1){let e=x();n(0,"bd2-simple-bio-desc-form",10),v("onAccepted",function(a){_(e);let l=m(2);return u(l.saveEdits(a))})("onCancelled",function(a){_(e);let l=m(2);return u(l.hideEdits(a))}),o()}if(t&2){let e=m(2);r("blocked",e.blocked)("model",e.assay)}}function Zt(t,d){if(t&1&&f(0,"bd2-simple-bio-desc-view",11),t&2){let e=m(2);r("model",e.assay)}}function ei(t,d){if(t&1){let e=x();n(0,"div"),f(1,"hr"),n(2,"button",12),v("click",function(){_(e);let a=m(2);return u(a.activeSimpleBioDescForm=!0)}),c(3,"Modify "),o()()}if(t&2){let e=m(2);s(2),r("disabled",e.activeSimpleBioDescForm)}}function ti(t,d){if(t&1){let e=x();n(0,"bd2-measurement-desc-rform",10),v("onAccepted",function(a){_(e);let l=m(2);return u(l.saveEdits(a))})("onCancelled",function(a){_(e);let l=m(2);return u(l.hideEdits(a))}),o()}if(t&2){let e=m(2);r("blocked",e.blocked)("model",e.assay.experimentalDetails.measurementDesc)}}function ii(t,d){if(t&1&&f(0,"bd2-measurement-desc-view",11),t&2){let e=m(2);r("model",e.assay.experimentalDetails.measurementDesc)}}function ni(t,d){if(t&1){let e=x();n(0,"div"),f(1,"hr"),n(2,"button",12),v("click",function(){_(e);let a=m(2);return u(a.activeMeasurementDescForm=!0)}),c(3,"Modify "),o()()}if(t&2){let e=m(2);s(2),r("disabled",e.activeMeasurementDescForm)}}function ri(t,d){if(t&1&&(n(0,"li"),c(1),o()),t&2){let e=d.$implicit;s(),E(e)}}function oi(t,d){if(t&1&&(n(0,"div",8)(1,"ul"),p(2,ri,2,1,"li",9),o()()),t&2){let e=m(2);s(2),r("ngForOf",e.errors)}}function ai(t,d){if(t&1&&(n(0,"div")(1,"h3"),c(2,"Modify experiment description"),o(),p(3,Qt,3,1,"div",1),n(4,"div",2)(5,"div",3),c(6,"General description"),o(),n(7,"div",4),p(8,Yt,1,2,"bd2-general-desc-form",5)(9,zt,1,1,"bd2-general-desc-view",6)(10,Jt,4,1,"div",0),o()(),n(11,"div",2)(12,"div",3),c(13,"Contributions"),o(),n(14,"div",4),p(15,$t,1,2,"bd2-contr-desc-form",5)(16,Ht,1,1,"bd2-contr-desc-view",6)(17,Kt,4,1,"div",0),o()(),n(18,"div",2)(19,"div",3),c(20,"Biological details"),o(),n(21,"div",4),p(22,Xt,1,2,"bd2-simple-bio-desc-form",5)(23,Zt,1,1,"bd2-simple-bio-desc-view",6)(24,ei,4,1,"div",0),o()(),n(25,"div",7)(26,"div",3),c(27,"Measurement details"),o(),n(28,"div",4),p(29,ti,1,2,"bd2-measurement-desc-rform",5)(30,ii,1,1,"bd2-measurement-desc-view",6)(31,ni,4,1,"div",0),o()(),p(32,oi,3,1,"div",1),o()),t&2){let e=m();s(3),r("ngIf",e.errors),s(5),r("ngIf",e.activeGeneralDescForm),s(),r("ngIf",!e.activeGeneralDescForm),s(),r("ngIf",!e.activeGeneralDescForm),s(5),r("ngIf",e.activeContributionDescForm),s(),r("ngIf",!e.activeContributionDescForm),s(),r("ngIf",!e.activeContributionDescForm),s(5),r("ngIf",e.activeSimpleBioDescForm),s(),r("ngIf",!e.activeSimpleBioDescForm),s(),r("ngIf",!e.activeSimpleBioDescForm),s(5),r("ngIf",e.activeMeasurementDescForm),s(),r("ngIf",!e.activeMeasurementDescForm),s(),r("ngIf",!e.activeMeasurementDescForm),s(),r("ngIf",e.errors)}}var Je=(()=>{class t extends V{constructor(e,i){super(i),this.route=e,this.blocked=!1,this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.titlePart=" Edit",this.validator=P.INSTANCE}ngOnInit(){super.ngOnInit(),this.route.fragment.subscribe(e=>{this.requestedSection=e,this.focusOnSection(e)})}ngAfterViewInit(){this.focusOnSection(this.requestedSection)}focusOnSection(e){if(!e)return;let i=document.getElementById(e);i&&i.scrollIntoView(),e==="MeasurementSection"&&(this.activeMeasurementDescForm=!0)}saveEdits(e){this.assay&&e&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.save(this.assay).then(i=>(this.feedback.success('Experiment: "'+i.name+'" updated.'),i)).then(i=>(this.currentExperiment.push(i),i)).then(i=>{this.blocked=!1,this.hideEdits(e)}).catch(i=>{this.blocked=!1,this.feedback.error(i)}))}hideEdits(e){this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiment",this.assay.id])}updateModel(e){this._orgModel=e,this.assay=e?e.clone():null,this.setTitle()}static{this.\u0275fac=function(i){return new(i||t)(h(j),h(D))}}static{this.\u0275cmp=y({type:t,selectors:[["ng-component"]],standalone:!1,features:[T([]),F],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"blocked","model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["id","MeasurementSection",1,"card","mb-2"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"],[3,"onAccepted","onCancelled","blocked","model"],[3,"model"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,a){i&1&&p(0,ai,33,14,"div",0),i&2&&r("ngIf",a.assay)},dependencies:[S,b,q,O,Q,R,Y,B,z,L],encapsulation:2})}}return t})();var $e=(()=>{class t{constructor(e){this.BD2REST=e}upload(e,i){let a=new FormData;for(let l=0;l<i.length;l++)a.append("file",i[l],i[l].name);return this.BD2REST.expFileUpload(e.id,a).then(l=>l.data)}getFiles(e){return this.BD2REST.files(e.id).then(i=>i.data).then(i=>this.json2AssetsList(i)).then(i=>this.fillURLs(i,e))}fillURLs(e,i){return e.map(a=>this.fillURL(a,i))}fillURL(e,i){let a=this.BD2REST.fileURL(i.id,e.id);return e.url=a,e.versions.forEach(l=>{l.url=a+"/"+l.versionId}),e}json2AssetsList(e){return e.map(i=>Oe.deserialize(i))}static{this.\u0275fac=function(i){return new(i||t)(se(ve))}}static{this.\u0275prov=ae({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var mi=["uploadWidget"];function ci(t,d){if(t&1){let e=x();n(0,"div")(1,"bd2-file-upload-widget",3,0),v("uploadFiles",function(a){_(e);let l=m(2);return u(l.upload(a))}),o(),f(3,"hr"),o()}if(t&2){let e=m(2);s(),r("autoReset",!1)("blocked",e.blocked)}}function di(t,d){if(t&1&&f(0,"bd2-file-asset-view",5),t&2){let e=d.$implicit,i=m(3);r("model",e)("parentId",i.assay.id)}}function li(t,d){t&1&&(n(0,"div",6),c(1,' Use "Replace data" to change timeseries files. '),o())}function pi(t,d){if(t&1&&(n(0,"div")(1,"h4"),c(2,"Timeseries files"),o(),p(3,di,1,2,"bd2-file-asset-view",4)(4,li,2,0,"div",2),f(5,"hr"),o()),t&2){let e=m(2);s(3),r("ngForOf",e.tsData),s(),r("ngIf",e.assay.security.canWrite)}}function _i(t,d){t&1&&(n(0,"div",6),c(1,' Use "Import data" to add timeseries files. '),o())}function ui(t,d){if(t&1&&f(0,"bd2-file-asset-view",5),t&2){let e=d.$implicit,i=m(3);r("model",e)("parentId",i.assay.id)}}function fi(t,d){if(t&1&&(n(0,"div")(1,"h4"),c(2,"Attachments"),o(),p(3,ui,1,2,"bd2-file-asset-view",4),o()),t&2){let e=m(2);s(3),r("ngForOf",e.attachments)}}function vi(t,d){t&1&&(n(0,"div",6),c(1," Drag and upload files using the upload area in order to update the attachments. "),o())}function xi(t,d){if(t&1&&(n(0,"div"),p(1,ci,4,2,"div",1)(2,pi,6,2,"div",1)(3,_i,2,0,"div",2)(4,fi,4,1,"div",1)(5,vi,2,0,"div",2),o()),t&2){let e=m();s(),r("ngIf",e.assay.security.canWrite),s(),r("ngIf",e.tsData&&e.tsData.length>0),s(),r("ngIf",!e.tsData||e.tsData.length===0),s(),r("ngIf",e.attachments&&e.attachments.length>0),s(),r("ngIf",e.assay.security.canWrite)}}var He=(()=>{class t extends V{constructor(e,i){super(i),this.attachmentsService=e,this.attachments=[],this.tsData=[],this.blocked=!1,this.titlePart=" Files"}updateModel(e){super.updateModel(e),this.refreshAttachments()}refreshAttachments(){this.attachmentsService.getFiles(this.assay).then(e=>this.setFiles(e)).catch(e=>{this.feedback.error(e)})}setFiles(e){this.tsData=e.filter(i=>i.assetType.equals(ie.TS_DATA)),this.attachments=e.filter(i=>!i.assetType.equals(ie.TS_DATA))}upload(e){console.log("Uploading "+e.length),!(!e||e.length===0)&&(this.blocked=!0,this.attachmentsService.upload(this.assay,e).then(i=>{this.uploadWidget.reset(),this.blocked=!1;let a=i.length;this.feedback.success(a+" files uploaded")}).then(()=>this.refreshModel()).catch(i=>{this.blocked=!1,this.feedback.error(i)}))}static{this.\u0275fac=function(i){return new(i||t)(h($e),h(D))}}static{this.\u0275cmp=y({type:t,selectors:[["ng-component"]],viewQuery:function(i,a){if(i&1&&ce(mi,5),i&2){let l;de(l=le())&&(a.uploadWidget=l.first)}},standalone:!1,features:[F],decls:4,vars:1,consts:[["uploadWidget",""],[4,"ngIf"],["type","info","class","alert alert-info","role","alert",4,"ngIf"],[3,"uploadFiles","autoReset","blocked"],[3,"model","parentId",4,"ngFor","ngForOf"],[3,"model","parentId"],["type","info","role","alert",1,"alert","alert-info"]],template:function(i,a){i&1&&(n(0,"h3"),c(1,"Attached files"),o(),f(2,"hr"),p(3,xi,6,5,"div",1)),i&2&&(s(3),r("ngIf",a.assay))},dependencies:[S,b,Re,Be],encapsulation:2})}}return t})();function hi(t,d){if(t&1&&(n(0,"div")(1,"div",4),c(2," Experiment is already publicly available under "),n(3,"strong"),c(4),o(),c(5," licence. "),o()()),t&2){let e=m(2);s(4),E(e.assay.features.licence)}}function Ci(t,d){if(t&1&&(n(0,"option",12),c(1),o()),t&2){let e=d.$implicit;r("value",e),s(),w("",e," ")}}function yi(t,d){if(t&1){let e=x();n(0,"div")(1,"div",5),c(2," You are about to make the data public. Once they are public they cannot be made private again. "),n(3,"ul")(4,"li"),c(5,"make sure you know what you are doing"),o(),n(6,"li"),c(7,"make sure all contributors agree to public sharing"),o(),n(8,"li"),c(9,"double check the description is correct, not all changes will be possible after the publishing"),o()()(),n(10,"form",null,0)(12,"div",6)(13,"label",7),c(14,"Licence"),o(),n(15,"select",8,1),ee("ngModelChange",function(a){_(e);let l=m(2);return Z(l.licence,a)||(l.licence=a),u(a)}),p(17,Ci,2,2,"option",9),o()(),n(18,"div",6)(19,"label")(20,"input",10,2),ee("ngModelChange",function(a){_(e);let l=m(2);return Z(l.terms,a)||(l.terms=a),u(a)}),o(),c(22," I understand that I cannot undo this operation "),o()(),n(23,"button",11),v("click",function(){_(e);let a=m(2);return u(a.publish())}),c(24," Publish "),o()()()}if(t&2){let e=pe(11),i=m(2);s(15),X("ngModel",i.licence),s(2),r("ngForOf",i.licences),s(3),X("ngModel",i.terms),s(3),r("disabled",!e.form.valid)}}function bi(t,d){if(t&1&&(n(0,"div")(1,"h3"),c(2,"Publish experiment"),o(),p(3,hi,6,1,"div",3)(4,yi,25,4,"div",3),o()),t&2){let e=m();s(3),r("ngIf",e.assay.features.isOpenAccess),s(),r("ngIf",!e.assay.features.isOpenAccess)}}var Ke=(()=>{class t extends V{constructor(e){super(e),this.licences=["CC_BY"]}ngOnInit(){super.ngOnInit(),this.licence=this.licences[0]}publish(){this.terms&&this.licence&&this.experimentService.publish(this.assay,this.licence).then(e=>(this.feedback.success('Experiment: "'+e.name+'" published.'),e)).then(e=>(this.currentExperiment.push(e),e)).then(e=>{this.goToExpHome(e.id)}).catch(e=>{this.feedback.error(e)})}static{this.\u0275fac=function(i){return new(i||t)(h(D))}}static{this.\u0275cmp=y({type:t,selectors:[["bd2-publish-form"]],standalone:!1,features:[F],decls:1,vars:1,consts:[["publishForm","ngForm"],["licenceF","ngModel"],["fTerms","ngModel"],[4,"ngIf"],["type","info","role","alert",1,"alert","alert-info"],["type","danger","role","alert",1,"alert","alert-danger"],[1,"form-group"],["for","licence"],["id","licence","required","","placeholder","Select licence","name","licence",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","checkbox","required","","id","terms","name","fTerms",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary",3,"click","disabled"],[3,"value"]],template:function(i,a){i&1&&p(0,bi,5,2,"div",3),i&2&&r("ngIf",a.assay)},dependencies:[S,b,Ee,we,Se,he,Fe,Ce,ye,De,Ae,ge,be],encapsulation:2})}}return t})();function gi(t,d){t&1&&(n(0,"div")(1,"h4"),c(2,"You don't have permission to create experiment"),o(),n(3,"p"),c(4,"Try to login"),o()())}function Ei(t,d){if(t&1){let e=x();n(0,"bd2-general-desc-form",9),v("onAccepted",function(a){_(e);let l=m(2);return u(l.hideEdits(a))})("onCancelled",function(a){_(e);let l=m(2);return u(l.hideEdits(a))}),o()}if(t&2){let e=m(2);r("model",e.assay.generalDesc)}}function Fi(t,d){if(t&1&&f(0,"bd2-general-desc-view",10),t&2){let e=m(2);r("model",e.assay.generalDesc)}}function wi(t,d){if(t&1){let e=x();n(0,"div"),f(1,"hr"),n(2,"button",11),v("click",function(){_(e);let a=m(2);return u(a.activeGeneralDescForm=!0)}),c(3,"Modify "),o()()}if(t&2){let e=m(2);s(2),r("disabled",e.activeGeneralDescForm)}}function Si(t,d){if(t&1){let e=x();n(0,"bd2-simple-bio-desc-form",9),v("onAccepted",function(a){_(e);let l=m(2);return u(l.hideEdits(a))})("onCancelled",function(a){_(e);let l=m(2);return u(l.hideEdits(a))}),o()}if(t&2){let e=m(2);r("model",e.assay)}}function Di(t,d){if(t&1&&f(0,"bd2-simple-bio-desc-view",10),t&2){let e=m(2);r("model",e.assay)}}function Ai(t,d){if(t&1){let e=x();n(0,"div"),f(1,"hr"),n(2,"button",11),v("click",function(){_(e);let a=m(2);return u(a.activeSimpleBioDescForm=!0)}),c(3,"Modify "),o()()}if(t&2){let e=m(2);s(2),r("disabled",e.activeSimpleBioDescForm)}}function Ii(t,d){if(t&1){let e=x();n(0,"bd2-contr-desc-form",9),v("onAccepted",function(a){_(e);let l=m(2);return u(l.hideEdits(a))})("onCancelled",function(a){_(e);let l=m(2);return u(l.hideEdits(a))}),o()}if(t&2){let e=m(2);r("model",e.assay.contributionDesc)}}function Ti(t,d){if(t&1&&f(0,"bd2-contr-desc-view",10),t&2){let e=m(2);r("model",e.assay.contributionDesc)}}function Vi(t,d){if(t&1){let e=x();n(0,"div"),f(1,"hr"),n(2,"button",11),v("click",function(){_(e);let a=m(2);return u(a.activeContributionDescForm=!0)}),c(3,"Modify "),o()()}if(t&2){let e=m(2);s(2),r("disabled",e.activeContributionDescForm)}}function ki(t,d){if(t&1){let e=x();n(0,"bd2-measurement-desc-rform",9),v("onAccepted",function(a){_(e);let l=m(2);return u(l.hideEdits(a))})("onCancelled",function(a){_(e);let l=m(2);return u(l.hideEdits(a))}),o()}if(t&2){let e=m(2);r("model",e.assay.experimentalDetails.measurementDesc)}}function Mi(t,d){if(t&1&&f(0,"bd2-measurement-desc-view",10),t&2){let e=m(2);r("model",e.assay.experimentalDetails.measurementDesc)}}function Ni(t,d){if(t&1){let e=x();n(0,"div"),f(1,"hr"),n(2,"button",11),v("click",function(){_(e);let a=m(2);return u(a.activeMeasurementDescForm=!0)}),c(3,"Modify "),o()()}if(t&2){let e=m(2);s(2),r("disabled",e.activeMeasurementDescForm)}}function Oi(t,d){if(t&1&&(n(0,"li"),c(1),o()),t&2){let e=d.$implicit;s(),E(e)}}function Ri(t,d){if(t&1&&(n(0,"div",12)(1,"ul"),p(2,Oi,2,1,"li",13),o()()),t&2){let e=m(2);s(2),r("ngForOf",e.errors)}}function Bi(t,d){if(t&1){let e=x();n(0,"div")(1,"h3"),c(2,"Create experiment"),o(),n(3,"div",1)(4,"div",2),c(5,"General description"),o(),n(6,"div",3),p(7,Ei,1,1,"bd2-general-desc-form",4)(8,Fi,1,1,"bd2-general-desc-view",5)(9,wi,4,1,"div",0),o()(),n(10,"div",1)(11,"div",2),c(12,"Biological details"),o(),n(13,"div",3),p(14,Si,1,1,"bd2-simple-bio-desc-form",4)(15,Di,1,1,"bd2-simple-bio-desc-view",5)(16,Ai,4,1,"div",0),o()(),n(17,"div",1)(18,"div",2),c(19,"Contributions"),o(),n(20,"div",3),p(21,Ii,1,1,"bd2-contr-desc-form",4)(22,Ti,1,1,"bd2-contr-desc-view",5)(23,Vi,4,1,"div",0),o()(),n(24,"div",1)(25,"div",2),c(26,"Measurement details"),o(),n(27,"div",3),p(28,ki,1,1,"bd2-measurement-desc-rform",4)(29,Mi,1,1,"bd2-measurement-desc-view",5)(30,Ni,4,1,"div",0),o()(),p(31,Ri,3,1,"div",6),n(32,"button",7),v("click",function(){_(e);let a=m();return u(a.save())}),c(33,"Create"),o(),n(34,"button",8),v("click",function(){_(e);let a=m();return u(a.cancel())}),c(35,"Cancel"),o()()}if(t&2){let e=m();s(7),r("ngIf",e.activeGeneralDescForm),s(),r("ngIf",!e.activeGeneralDescForm),s(),r("ngIf",!e.activeGeneralDescForm),s(5),r("ngIf",e.activeSimpleBioDescForm),s(),r("ngIf",!e.activeSimpleBioDescForm),s(),r("ngIf",!e.activeSimpleBioDescForm),s(5),r("ngIf",e.activeContributionDescForm),s(),r("ngIf",!e.activeContributionDescForm),s(),r("ngIf",!e.activeContributionDescForm),s(5),r("ngIf",e.activeMeasurementDescForm),s(),r("ngIf",!e.activeMeasurementDescForm),s(),r("ngIf",!e.activeMeasurementDescForm),s(),r("ngIf",e.errors),s(),r("disabled",e.blocked||e.errors)}}var Xe=(()=>{class t extends Te{constructor(e,i,a,l){super(P.INSTANCE),this.experimentService=e,this.RDMSocial=i,this.feedback=a,this.router=l,this.isUnauthorised=!1,this.blocked=!1,this.activeGeneralDescForm=!0,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!0,this.activeMeasurementDescForm=!1}ngOnInit(){this.experimentService.newDraft().then(e=>{this.assay=e}).catch(e=>{this.isUnauthorised=e.isUnauthorised,this.feedback.error(e)})}hideEdits(e){this.assay.generalDesc.name?this.activeGeneralDescForm=!1:this.activeGeneralDescForm=!0,this.assay.species&&this.assay.dataCategory?this.activeSimpleBioDescForm=!1:this.activeSimpleBioDescForm=!0,this.activeContributionDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiments"])}save(){this.assay&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.newExperiment(this.assay).then(e=>(this.feedback.success('Experiment: "'+e.name+'" created.'),e)).then(e=>this.router.navigate(["/experiment",e.id])).catch(e=>{this.blocked=!1,this.feedback.error(e)}))}getModel(){return this.assay}static{this.\u0275fac=function(i){return new(i||t)(h(U),h($),h(W),h(G))}}static{this.\u0275cmp=y({type:t,selectors:[["ng-component"]],standalone:!1,features:[F],decls:2,vars:2,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],["okLabel","Accept",3,"model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","mr-1",3,"click","disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["okLabel","Accept",3,"onAccepted","onCancelled","model"],[3,"model"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"]],template:function(i,a){i&1&&p(0,gi,5,0,"div",0)(1,Bi,36,14,"div",0),i&2&&(r("ngIf",a.isUnauthorised),s(),r("ngIf",a.assay))},dependencies:[S,b,q,O,Q,R,Y,B,z,L],encapsulation:2})}}return t})();var Li=[{path:"new",pathMatch:"full",component:Xe},{path:":id",component:We,children:[{path:"",pathMatch:"full",component:ze},{path:"edit",component:Je},{path:"file",component:He},{path:"publish",component:Ke},{path:"data",loadChildren:()=>import("./chunk-3SCRFITU.js").then(t=>t.TsDataModule)},{path:"ppa",loadChildren:()=>import("./chunk-46B2SHZD.js").then(t=>t.PPAModule)},{path:"rhythmicity",loadChildren:()=>import("./chunk-B77Y2CIR.js").then(t=>t.RhythmicityModule)}]}],Ze=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=A({imports:[te.forChild(Li),te]})}}return t})();var et=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=A({imports:[N,Le]})}}return t})();var tt=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=A({imports:[N,Ie]})}}return t})();var tr=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=A({imports:[N,Me,et,tt,Ze]})}}return t})();export{tr as ExperimentModule};
