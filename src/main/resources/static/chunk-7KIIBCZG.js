import{b as ne,k as X,l as Zt,n as Jt,o as y,p as ei}from"./chunk-ZAWAO4I2.js";import{d as Wt,e as Yt}from"./chunk-WA7O2XOB.js";import{a as Ht,b as zt,g as $t,j as jt,k as Qt,l as Gt,m as qt,n as Kt,o as Xt}from"./chunk-X3OMUHYN.js";import{b as Nt,c as Ut}from"./chunk-FB5T6NUV.js";import"./chunk-ZAPWFC3C.js";import"./chunk-QDUVFCGA.js";import{a as Et,b as Ft,c as Bt,d as Vt,e as Pt,f as Ot,g as At}from"./chunk-E2ZG2HAU.js";import{A as Ue,c as Qe,d as Ge,e as Ct,n as Le,o as Ne,p as Ee,q as kt,r as Fe,s as Be,t as Rt,u as Ve,v as Pe,w as Mt,x as Oe,y as Ae,z as Lt}from"./chunk-6HSKS2XP.js";import{A as yt,B as It,e as pe,f as ke,t as gt,v as St,x as wt,y as xt}from"./chunk-I5BPRPCG.js";import{a as ye,c as _t,g as Z,k as bt,o as Me,q as Dt}from"./chunk-DFK6U2UW.js";import{d as Re}from"./chunk-K5NGWSTH.js";import{F as ft,G as ht,L as Ie,N as R,O as vt,P as F,Q as Tt,d as ce,i as Y,j as De,k as ve,l as ct,m as de,n as Te,o as dt,q as pt,z as ut}from"./chunk-2RPFGIFO.js";import{a as W}from"./chunk-I6T75M2J.js";import{$a as s,Ab as O,B as ze,Bb as A,Cb as U,Cc as me,Da as x,Fb as xe,Gb as $e,Ha as D,Ia as Se,J as et,Ja as ot,Ka as G,Kb as rt,L as tt,Lb as lt,Ma as v,Na as z,Q as it,R as nt,Ua as b,Va as g,Wa as B,X as re,Xa as V,Y as ge,Ya as P,Za as p,_ as ie,_a as l,ab as T,ba as h,bb as $,ca as _,cb as j,eb as w,ec as st,gb as S,hb as c,hc as mt,j as Ye,k as be,lb as L,mb as N,nb as E,o as Ze,rb as le,sb as K,t as _e,u as Je,ub as se,vb as m,wb as k,xb as C,ya as r,yb as we,yc as je,zb as at}from"./chunk-EXZ64TUM.js";var Q=class a{constructor(i=new Ge,o=new Ge){this.rowPage=i,this.colPage=o}static firstPage(){let i=new a;return i.rowPage.pageIndex=0,i.rowPage.pageSize=50,i.colPage.pageIndex=0,i.colPage.pageSize=50,i}static pageEquals(i,o){return i.pageIndex===o.pageIndex&&i.pageSize===o.pageSize}equals(i){return i?a.pageEquals(this.rowPage,i.rowPage)&&a.pageEquals(this.colPage,i.colPage):!1}};var ii=(()=>{let i=class i{constructor(e){this.BD2REST=e}uploadFile(e){let t=new FormData;return t.append("file",e,e.name),this.BD2REST.fileUpload(t).then(n=>n.id)}};i.\u0275fac=function(t){return new(t||i)(ie(me))},i.\u0275prov=re({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var ue=(()=>{let i=class i{constructor(e,t){this.uploadService=e,this.BD2REST=t}uploadFile(e,t){return Ze(this.uploadService.uploadFile(e)).pipe(tt(n=>this.verifyFormat(t,n).pipe(_e(d=>n))))}verifyFormat(e,t){return this.BD2REST.fileViewVerifyFormat(e,t)}getTableSlice(e,t,n){return this.BD2REST.fileViewTableSlice(e,t,n)}previewLabels(e,t,n,d){let u=new Q;return d?(u.rowPage.pageSize=500,u.rowPage.pageIndex=0,u.colPage.pageSize=1,u.colPage.pageIndex=n.colIx):(u.rowPage.pageSize=1,u.rowPage.pageIndex=n.rowIx,u.colPage.pageSize=500,u.colPage.pageIndex=0),this.getTableSlice(e,t,u).pipe(_e(f=>{let H=[];return f.data.forEach(ee=>ee.forEach(te=>H.push(""+te))),H}))}};i.\u0275fac=function(t){return new(t||i)(ie(ii),ie(me))},i.\u0275prov=re({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var M=(()=>{let i=class i{constructor(e){this.tsFileService=e,this.tableSlice$=new be(void 0),this.slice$=new be(void 0),this.fileIdFormat$=new be(void 0),this.error$=new Ye,this.dataSlice$=this.tableSlice$.asObservable().pipe(ze(t=>t!=null&&t!==void 0)),this.initDataStream()}close(){this.slice$.complete(),this.fileIdFormat$.complete(),this.tableSlice$.complete(),this.error$.complete()}slice(e){e&&this.slice$.next(e)}fileIdFormat(e){e&&e[0]&&e[1]&&this.fileIdFormat$.next(e)}sameParams([[e,t],n],[[d,u],f]){return e==d&&t==u&&n.equals(f)}initDataStream(){Je([this.fileIdFormat$,this.slice$]).pipe(ze(([t,n])=>t&&!!n),et(this.sameParams)).pipe(nt(([t,n])=>this.tsFileService.getTableSlice(t[0],t[1],n))).subscribe(t=>this.tableSlice$.next(t),t=>this.error$.next(t))}};i.\u0275fac=function(t){return new(t||i)(ie(ue))},i.\u0275prov=re({token:i,factory:i.\u0275fac});let a=i;return a})();function gi(a,i){if(a&1&&(l(0,"mat-option",5),m(1),s()),a&2){let o=i.$implicit;p("value",o),r(),k(o.label)}}function Si(a,i){a&1&&(l(0,"div",6),m(1," An Excel file in which one column contains time values while other columns contain measurements taken at the corresponding times. "),l(2,"ul")(3,"li"),m(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes from start, seconds from start, or as image nr (1-based) which will be converted to time using interval between images. "),s(),l(5,"li"),m(6," Not all columns have to be imported. "),s(),l(7,"li"),m(8," First few rows can contain arbitrary text. "),s(),l(9,"li"),m(10," Values from one row can be used as data labels. "),s()()())}function wi(a,i){a&1&&(l(0,"div",6),m(1," A coma or tab separeted file in which one column or row contains time values while other columns or rows contain measurements taken at the corresponding times. "),l(2,"ul")(3,"li"),m(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes or seconds from start, or as image numbers "),s(),l(5,"li"),m(6," Not all columns/rows have to be imported. "),s(),l(7,"li"),m(8," First few rows/columns can contain arbitrary text. "),s(),l(9,"li"),m(10," Values from one row/column can be used as data labels. "),s()()())}function xi(a,i){a&1&&(l(0,"div",6),m(1," Topcount data can be uploaded in two forms: "),l(2,"ul")(3,"li"),m(4,"Individual file which contains concatenated topcount data blocks in one file"),s(),l(5,"li"),m(6,"Zip file which contains packed files from individual topcount reads"),s()(),m(7,' Check the Dosc section for details about suported data layouts inside tomcats file, we can currently read ASCI content with "plate map" or "column" layouts. '),s())}function Di(a,i){if(a&1&&(l(0,"div",7),m(1),s()),a&2){let o=c();r(),C(" ",o.formatWarning," ")}}var oi=(()=>{let i=class i{constructor(){this.blocked=!1,this.uploadFiles=new z,this.importFormatOptions=Zt,this.importFormat=X.EXCEL_TABLE}ngOnInit(){}upload(e){this.uploadFiles.next({files:e,importFormat:this.importFormat})}formatChanged(e){this.lastFiles&&this.checkFormat(this.lastFiles)}checkFormat(e){this.lastFiles=e,this.formatWarning=void 0,e.forEach(t=>{if(this.importFormat===X.TOPCOUNT){let n=this.isTopCount(t);n&&(this.formatWarning="The selected file does not seem to be a topcount file/archive but rather: "+n+". If you sure it is a valid topcount file/archive you can continue upload.")}else if(this.importFormat===X.EXCEL_TABLE){let n=this.isExcel(t);n&&(this.formatWarning="The selected file does not seem to be an excel file but rather: "+n+". If you sure it is a valid excel file you can continue upload.")}else if(this.importFormat===X.TAB_SEP){let n=this.isTab(t);n&&(this.formatWarning="The selected file does not seem to be a tab-separated file but rather: "+n+". If you sure it is a valid tsv file you can continue upload.")}else if(this.importFormat===X.COMA_SEP){let n=this.isComa(t);n&&(this.formatWarning="The selected file does not seem to be a coma-separated file but rather: "+n+". If you sure it is a valid csv file you can continue upload.")}})}isTopCount(e){let t=e.name,n=e.type;return t?(n||(n="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".tsv")?"tab separated":null):"Unknown"}isExcel(e){let t=e.name,n=e.type;return!n||!t?"Unknown":e.name.endsWith(".csv")?"CSV":e.name.endsWith(".txt")?"text":e.name.endsWith(".tsv")?"tab separated":n.indexOf("excel")>=0||n.indexOf("sheet")>=0?null:n}isTab(e){let t=e.name,n=e.type;return t?(n||(n="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".tsv")?null:"Unrecognized"):"Unknown"}isComa(e){let t=e.name,n=e.type;return t?(n||(n="Unknown"),e.name.endsWith(".tsv")?"tab separated":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".csv")?null:"Unrecognized"):"Unknown"}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=D({type:i,selectors:[["bd2-upload-data-file-step"]],outputs:{uploadFiles:"uploadFiles"},standalone:!1,decls:20,vars:8,consts:[["uploadWidget",""],["appearance","outlined",1,"mat-elevation-z4"],[1,""],[1,"form-group"],["required","",3,"valueChange","selectionChange","value"],[3,"value"],["dismissible","true","type","info","role","alert",1,"alert","alert-info",2,"font-size","smaller"],["type","danger","role","alert",1,"alert","alert-danger"],[3,"selectedFiles","uploadFiles","autoReset","blocked","multiple"]],template:function(t,n){if(t&1){let d=w();l(0,"div")(1,"mat-card",1)(2,"mat-card-title"),m(3,"Time series file"),s(),l(4,"mat-card-content")(5,"form",2)(6,"div",3)(7,"mat-form-field")(8,"mat-label"),m(9,"File Format"),s(),l(10,"mat-select",4),U("valueChange",function(f){return h(d),A(n.importFormat,f)||(n.importFormat=f),_(f)}),S("selectionChange",function(f){return h(d),_(n.formatChanged(f))}),V(11,gi,2,2,"mat-option",5,B),s()()(),b(13,Si,11,0,"div",6),b(14,wi,11,0,"div",6),b(15,xi,8,0,"div",6),b(16,Di,2,1,"div",7),l(17,"div",3)(18,"bd2-file-upload-widget",8,0),S("selectedFiles",function(f){return h(d),_(n.checkFormat(f))})("uploadFiles",function(f){return h(d),_(n.upload(f))}),s()()()()()()}t&2&&(r(10),O("value",n.importFormat),r(),P(n.importFormatOptions),r(2),g(n.importFormat.name=="EXCEL_TABLE"?13:-1),r(),g(n.importFormat.name=="TAB_SEP"||n.importFormat.name=="COMA_SEP"?14:-1),r(),g(n.importFormat.name=="TOPCOUNT"?15:-1),r(),g(n.formatWarning?16:-1),r(2),p("autoReset",!1)("blocked",n.blocked||!n.importFormat)("multiple",!1))},dependencies:[Te,De,ve,Wt,Z,ye,ke,pe,R,F,vt],encapsulation:2});let a=i;return a})();function Ti(a,i){if(a&1&&(l(0,"span")(1,"label"),m(2,"Images every"),s(),m(3),s()),a&2){let o=c(2);r(3),C(" ",o.importDetails.imgInterval,"h ")}}function yi(a,i){if(a&1&&(l(0,"span")(1,"label"),m(2,"Time offset"),s(),m(3),s()),a&2){let o=c(2);r(3),C(" ",o.importDetails.timeOffset,"h ")}}function Ii(a,i){if(a&1&&(l(0,"p")(1,"label"),m(2,"First time point:"),s(),l(3,"strong"),m(4),s(),b(5,Ti,4,1,"span"),b(6,yi,4,1,"span"),s()),a&2){let o=c();r(4),at("",o.firstTimeCell.value," ",o.importDetails.timeType==null?null:o.importDetails.timeType.unit," [",o.firstTimeCell.colName+":"+o.firstTimeCell.rowName,"]"),r(),g((o.importDetails.timeType==null?null:o.importDetails.timeType.name)==="IMG_NUMBER"?5:-1),r(),g(o.importDetails.timeOffset!=0?6:-1)}}function ki(a,i){if(a&1&&(l(0,"p"),m(1),l(2,"strong"),m(3),s()()),a&2){let o=c();r(),C(" Labels in ",o.importDetails.inLabelNeg," "),r(2),C("",o.importDetails.inRows?o.labelsSelection.colName:o.labelsSelection.rowName,";")}}function Ri(a,i){if(a&1&&(l(0,"p")(1,"label"),m(2,"Selected Labels:"),s(),m(3),s()),a&2){let o=c();r(3),C(" ",o.importDetails.summarizeLabels()," ")}}function Mi(a,i){if(a&1&&(l(0,"p"),m(1),l(2,"strong"),m(3),s()()),a&2){let o=c();r(),C(" Data starts in ",o.importDetails.inLabel," "),r(2),C("",o.importDetails.inRows?o.dataStart.rowName:o.dataStart.colName,";")}}function Li(a,i){if(a&1&&(l(0,"p"),m(1),s()),a&2){let o=c();r(),C(" Background noise as: ",o.importDetails.backgroundsLabels.join(", ")," ")}}var ai=(()=>{let i=class i{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(){this.showTime=!1,this.showLabelling=!1,this.showDataStart=!1}ngOnInit(){}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=D({type:i,selectors:[["bd2-import-details-summary"]],inputs:{importDetails:"importDetails",showTime:"showTime",showLabelling:"showLabelling",showDataStart:"showDataStart"},standalone:!1,decls:13,vars:8,consts:[["appearance","outlined",1,"mat-elevation-z4"]],template:function(t,n){t&1&&(l(0,"mat-card",0)(1,"p"),m(2),l(3,"strong"),m(4),s()(),l(5,"p")(6,"label"),m(7),s()(),b(8,Ii,7,5,"p"),b(9,ki,4,2,"p"),b(10,Ri,4,1,"p"),b(11,Mi,4,2,"p"),b(12,Li,2,1,"p"),s()),t&2&&(r(2),C("",n.importDetails==null||n.importDetails.importFormat==null?null:n.importDetails.importFormat.label,": "),r(2),k(n.importDetails==null?null:n.importDetails.fileName),r(3),C("Time series in ",(n.importDetails==null?null:n.importDetails.inLabel)+"s"),r(),g(n.showTime&&n.firstTimeCell?8:-1),r(),g(n.showLabelling&&n.importDetails.importLabels&&n.labelsSelection?9:-1),r(),g(n.showLabelling&&!n.importDetails.importLabels?10:-1),r(),g(n.showDataStart&&n.importDetails.importLabels&&n.dataStart?11:-1),r(),g(n.showLabelling&&n.importDetails.containsBackgrounds&&n.importDetails.backgroundsLabels?12:-1))},dependencies:[R],encapsulation:2});let a=i;return a})();var ae=class{constructor(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}reset(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}setRowBackground(i,o){this.rowsBackgrounds[i]=o}rowBackground(i){return this.getOrEmptyString(this.rowsBackgrounds,i)}colBackground(i){return this.getOrEmptyString(this.colsBackgrounds,i)}setColBackground(i,o){this.colsBackgrounds[i]=o}cellBackground(i,o){let e=this.getOrEmptyString(this.getOrDefault(this.cellBackgrounds,o,[]),i);return e||this.colBackground(i)}setCellBackground(i,o,e){let t=this.cellBackgrounds[o];t===void 0&&(t=[],this.cellBackgrounds[o]=t),t[i]=e}getOrEmptyString(i,o){return this.getOrDefault(i,o,"")}getOrDefault(i,o,e){return o>=i.length||i[o]===void 0?e:i[o]}},q=(()=>{let i=class i{rowBackground(e){return i.MAIN_ROW_BACKGROUND}cellBackground(e){return i.MAIN_CELL_BACKGROUND}columnBackground(e){return i.MAIN_COL_BACKGROUND}};i.MAIN_ROW_BACKGROUND="#dda0dd",i.MAIN_COL_BACKGROUND="#87cefa",i.MAIN_CELL_BACKGROUND="#ba55d3",i.TIME_BACKGROUND="#dda0dd",i.LABELS_BACKGROUND="#87cefa",i.FIRST_TIME_BACKGROUND="#ba55d3",i.FIST_DATA_BACKGROUND="lightgreen";let a=i;return a})(),He=class{constructor(i,o){this.tableStyler=i,this.colorCycler=o,this.selectedRows=[],this.selectedCols=[],this.tableStyler=i||new ae,this.colorCycler=o||new q}toggleRow(i,o=!1,e,t){let n=this.selectedRows.splice(0,this.selectedRows.length);this.selectedRows.push(i),this.uncolorRows(n),this.colorRows(this.selectedRows,e),o&&(this.uncolorCells(n),this.colorCells(this.selectedRows,t))}toggleRowSelection(i,o,e=!1,t,n){let d=this.selectedRows[i]?[this.selectedRows[i]]:[];this.selectedRows[i]=o,this.uncolorRows(d),this.colorRows([this.selectedRows[i]],t),e&&(this.uncolorCells(d),this.colorCells([this.selectedRows[i]],n))}selectRow(i,o){let e=new y(-1,-1,void 0,i,i,void 0,void 0),t=this.selectedRows.findIndex(n=>n.rowNumber===i);t<0?this.selectedRows.push(e):this.selectedRows[t]=e,this.colorRows([e],o)}deselectRow(i){let o=this.selectedRows.findIndex(t=>t.rowNumber===i);o>=0&&(this.selectedRows[o]=void 0);let e=new y(-1,-1,void 0,i,i,void 0,void 0);this.uncolorRows([e])}toggleCol(i,o=!1,e,t){let n=this.selectedCols.splice(0,this.selectedCols.length);this.selectedCols.push(i),this.uncolorCols(n),this.colorCols(this.selectedCols,e),o&&(this.uncolorCells(n),this.colorCells(this.selectedCols,t))}toggleColSelection(i,o,e=!1,t,n){let d=this.selectedCols[i]?[this.selectedCols[i]]:[];this.selectedCols[i]=o,this.uncolorCols(d),this.colorCols([this.selectedCols[i]],t),e&&(this.uncolorCells(d),this.colorCells([this.selectedCols[i]],n))}selectCol(i,o){let e=new y(i,i,void 0,-1,-1,void 0,void 0),t=this.selectedCols.findIndex(n=>n.colNumber===i);t<0?this.selectedCols.push(e):this.selectedCols[t]=e,this.colorCols([e],o)}deselectCol(i){let o=this.selectedCols.findIndex(t=>t.colNumber===i);o>=0&&(this.selectedCols[o]=void 0);let e=new y(i,i,void 0,-1,-1,void 0,void 0);this.uncolorCols([e])}reset(){this.selectedRows=[],this.selectedCols=[],this.tableStyler.reset()}colorRows(i,o){i.forEach((e,t)=>{this.tableStyler.setRowBackground(e.rowNumber,o||this.colorCycler.rowBackground(t))})}colorCols(i,o){i.forEach((e,t)=>{this.tableStyler.setColBackground(e.colNumber,o||this.colorCycler.columnBackground(t))})}colorCells(i,o){i.forEach((e,t)=>{this.tableStyler.setCellBackground(e.colNumber,e.rowNumber,o||this.colorCycler.cellBackground(t))})}uncolorRows(i){i.forEach(o=>{this.tableStyler.setRowBackground(o.rowNumber,void 0)})}uncolorCols(i){i.forEach(o=>{this.tableStyler.setColBackground(o.colNumber,void 0)})}uncolorCells(i){i.forEach(o=>{this.tableStyler.setCellBackground(o.colNumber,o.rowNumber,void 0)})}},ri=(()=>{let i=class i{constructor(){this.index=0,this.labelsIndexes=new Map}toColor(e){if(!e)return;this.labelsIndexes.has(e)||this.labelsIndexes.set(e,this.index++);let t=this.labelsIndexes.get(e)%i.colors.length;return i.colors[t]}setColor(e){}};i.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"];let a=i;return a})();var J=(()=>{let i=class i{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(e,t){this.dataService=e,this.feedback=t,this.tableSelector=new He,this.lastColumnSeen=0,this.lastRowSeen=0,this.firstPageSlice=Q.firstPage(),this.currentPageSlice=Q.firstPage()}ngOnInit(){this.dataService.error$.forEach(e=>this.feedback.error(e)),this.dataSubscription=this.dataService.dataSlice$.subscribe(e=>this.setDataSlice(e),e=>this.feedback.error(e))}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe()}colNumber(e){return e<0?-1:this.dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this.dataSlice.rowsNumbers[e]}setDataSlice(e){this.dataSlice=e,this.lastColumnSeen=Math.max(this.lastColumnSeen,e.columnsNumbers[e.columnsNumbers.length-1]),this.lastRowSeen=Math.max(this.lastRowSeen,e.rowsNumbers[e.rowsNumbers.length-1]),this.currentPageSlice=new Q(e.rowPage,e.colPage),this.applySelection()}loadData(){this.importDetails&&(this.lastColumnSeen=0,this.lastRowSeen=0,this.dataService.fileIdFormat([this.importDetails.fileId,this.importDetails.importFormat.name]),this.dataService.slice(this.firstPageSlice)),this.dataSlice&&this.applySelection()}applySelection(){this.tableSelector.reset(),this.markSelections(),this.applyDefaultSelections()}applyDefaultSelections(){}markSelections(){}selectFirstTime(e){this.importDetails.firstTimeCell=e,this.markFirstTime()}markFirstTime(){let e=this.firstTimeCell;e&&(this.importDetails.inRows?this.tableSelector.toggleRow(e,!0,q.TIME_BACKGROUND,q.FIRST_TIME_BACKGROUND):this.tableSelector.toggleCol(e,!0,q.TIME_BACKGROUND,q.FIRST_TIME_BACKGROUND))}selectLabels(e){this.importDetails.labelsSelection=e,this.markLabels()}markLabels(){let e=this.labelsSelection;e&&(this.importDetails.inRows?this.tableSelector.toggleCol(e,!1,q.LABELS_BACKGROUND):this.tableSelector.toggleRow(e,!1,q.LABELS_BACKGROUND))}selectDataStart(e){e?this.importDetails.inRows?(!this.firstTimeCell||this.firstTimeCell.rowIx!==e.rowIx)&&(this.importDetails.dataStart=e):(!this.firstTimeCell||this.firstTimeCell.colIx!==e.colIx)&&(this.importDetails.dataStart=e):this.importDetails.dataStart=void 0,this.markDataStart()}markDataStart(){let e=this.dataStart;e&&(this.importDetails.inRows?this.tableSelector.toggleRowSelection(1,e,!1,q.FIST_DATA_BACKGROUND):this.tableSelector.toggleColSelection(1,e,!1,q.FIST_DATA_BACKGROUND))}reselect(e){if(!this.dataSlice||!e)return;let t=this.dataSlice,n=e.colIx,d=e.rowIx;if(n>=t.columnsNumbers.length||d>=t.rowsNumbers.length)return;let f=(d>=0?t.data[d]:[])[n],H=new y(n,t.columnsNumbers[n],t.columnsNames[n],d,t.rowsNumbers[d],t.rowsNames[d],f);return H.fake=e.fake,H}hasMoreTimes(){return!this.importDetails||!this.dataSlice?!1:this.importDetails.inRows?this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns:this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows}hasMoreLabels(){return!this.importDetails||!this.dataSlice?!1:this.importDetails.inRows?this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows:this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns}};i.\u0275fac=function(t){return new(t||i)(x(M),x(W))},i.\u0275dir=ot({type:i});let a=i;return a})();var Bi=["table"];function Vi(a,i){a&1&&T(0,"th",9)}function Pi(a,i){if(a&1){let o=w();l(0,"td",10),S("click",function(){let t=h(o).index,n=c(2);return _(n.selectCell(-1,t))}),l(1,"label"),m(2),s()()}if(a&2){let o=i.index,e=c(2);r(2),k(e.rowsNames[o])}}function Oi(a,i){if(a&1){let o=w();l(0,"th",13),S("click",function(){h(o);let t=c().$index,n=c(2);return _(n.selectCell(t,-1))}),m(1),s()}if(a&2){let o=c(),e=o.$implicit,t=o.$index,n=c(2);K("background-color",n.colBackground(t)),r(),C(" ",e," ")}}function Ai(a,i){if(a&1){let o=w();l(0,"td",14),S("click",function(){let t=h(o).index,n=c().$index,d=c(2);return _(d.selectCell(n,t))}),m(1),s()}if(a&2){let o=i.$implicit,e=i.index,t=c().$index,n=c(2);K("background-color",n.cellBackground(t,e)),p("matRippleCentered",!0),r(),C(" ",o[t]," ")}}function Ui(a,i){if(a&1&&($(0,6),v(1,Oi,2,3,"th",11)(2,Ai,2,4,"td",12),j()),a&2){let o=i.$implicit;p("matColumnDef",o)}}function Wi(a,i){a&1&&T(0,"tr",15)}function Hi(a,i){if(a&1&&T(0,"tr",16),a&2){let o=i.index,e=c(2);K("background-color",e.rowBackground(o))}}function zi(a,i){if(a&1&&(l(0,"div",1)(1,"table",2,0),$(3,3),v(4,Vi,1,0,"th",4)(5,Pi,3,1,"td",5),j(),V(6,Ui,3,1,"ng-container",6,B),v(8,Wi,1,0,"tr",7)(9,Hi,1,2,"tr",8),s()()),a&2){let o=c();r(),p("dataSource",o.data),r(5),P(o.columnsNames),r(2),p("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),r(),p("matRowDefColumns",o.displayedColumns)}}var he=(()=>{let i=class i{set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.displayedColumns=["rowNr"].concat(this.columnsNames),this.data=e.data,this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.styler=new ae,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.selected=new z}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}ngOnInit(){}selectCell(e,t){if(e<0&&!this.selectableRowHeader||t<0&&!this.selectableColHeader)return;let d=(t>=0?this.data[t]:[])[e],u=this._dataSlice.columnsNumbers[e],f=this._dataSlice.columnsNames[e],H=this._dataSlice.rowsNumbers[t],ee=this._dataSlice.rowsNames[t],te=new y(e,u,f,t,H,ee,d);this.selected.next(te)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=D({type:i,selectors:[["bd2-data-sheet-mdtable"]],viewQuery:function(t,n){if(t&1&&L(Bi,5),t&2){let d;N(d=E())&&(n.matTable=d.first)}},inputs:{dataSlice:"dataSlice",styler:"styler",selectableColHeader:"selectableColHeader",selectableRowHeader:"selectableRowHeader"},outputs:{selected:"selected"},standalone:!1,decls:1,vars:1,consts:[["table",""],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],["mat-header-cell","",3,"background-color","click",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"matRippleCentered","background-color","click",4,"matCellDef"],["mat-header-cell","",3,"click"],["mat-cell","","matRipple","",3,"click","matRippleCentered"],["mat-header-row",""],["mat-row",""]],template:function(t,n){t&1&&b(0,zi,10,4,"div",1),t&2&&g(n.dataSlice?0:-1)},dependencies:[Le,Ee,Pe,Fe,Ne,Oe,Be,Ve,Ae,Ue,Ie],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:300px;overflow:auto}.mat-mdc-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-mdc-header-cell[_ngcontent-%COMP%], .mat-mdc-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}"]});let a=i;return a})();function ji(a,i){if(a&1&&(l(0,"mat-option",4),m(1),s()),a&2){let o=i.$implicit;p("value",o),r(),k(o.label)}}function Qi(a,i){if(a&1){let o=w();l(0,"p")(1,"mat-form-field")(2,"input",7),U("ngModelChange",function(t){h(o);let n=c(3);return A(n.importDetails.imgInterval,t)||(n.importDetails.imgInterval=t),_(t)}),s()()()}if(a&2){let o=c(3);r(2),O("ngModel",o.importDetails.imgInterval)}}function Gi(a,i){if(a&1&&(l(0,"div",6),m(1),s()),a&2){let o=c(3);r(),C(" The first time point value ",o.firstTimeCell.value," does not look like a number; ")}}function qi(a,i){if(a&1){let o=w();l(0,"div")(1,"p"),m(2),l(3,"strong"),m(4),s(),m(5,"\xA0 First time point: "),l(6,"strong"),m(7),s(),m(8),s(),l(9,"p")(10,"mat-form-field")(11,"mat-label"),m(12,"Time unit"),s(),l(13,"mat-select",3),U("valueChange",function(t){h(o);let n=c(2);return A(n.importDetails.timeType,t)||(n.importDetails.timeType=t),_(t)}),V(14,ji,2,2,"mat-option",4,B),s()()(),l(16,"p")(17,"mat-form-field")(18,"input",5),U("ngModelChange",function(t){h(o);let n=c(2);return A(n.importDetails.timeOffset,t)||(n.importDetails.timeOffset=t),_(t)}),s()()(),b(19,Qi,3,1,"p"),b(20,Gi,2,1,"div",6),s()}if(a&2){let o=c(2);r(2),C("Times in ",o.importDetails.inLabel," "),r(2),C("",o.importDetails.inRows?o.firstTimeCell.rowName:o.firstTimeCell.colName,";"),r(3),we("",o.firstTimeCell.value," ",o.importDetails.timeType==null?null:o.importDetails.timeType.unit),r(),C(" [",o.firstTimeCell.colName+":"+o.firstTimeCell.rowName,"] "),r(5),O("value",o.importDetails.timeType),r(),P(o.timeTypeOptions),r(4),O("ngModel",o.importDetails.timeOffset),r(),g((o.importDetails.timeType==null?null:o.importDetails.timeType.name)=="IMG_NUMBER"?19:-1),r(),g(o.firstTimeNotNumber()?20:-1)}}function Ki(a,i){if(a&1&&(l(0,"div",2),m(1),s()),a&2){let o=c(2);r(),C(" Even if only the top part of the data table is presented all times from the selected ",o.importDetails.inLabel," will be imported ")}}function Xi(a,i){if(a&1){let o=w();l(0,"mat-card",0)(1,"mat-card-content"),b(2,qi,21,9,"div"),l(3,"div")(4,"div"),m(5),s()(),l(6,"bd2-data-sheet-mdtable",1),S("selected",function(t){h(o);let n=c();return _(n.selectFirstTime(t))}),s(),b(7,Ki,2,1,"div",2),s()()}if(a&2){let o=c();r(2),g(o.firstTimeCell?2:-1),r(2),se(o.firstTimeCell?"alert alert-info":"alert alert-danger"),r(),C(" Click on the first timepoint in the time ",o.importDetails.inLabel," and then select a time unit. "),r(),p("dataSlice",o.dataSlice)("styler",o.tableSelector.tableStyler),r(),g(o.hasMoreTimes()?7:-1)}}var li=(()=>{let i=class i extends J{constructor(e,t){super(e,t),this.timeTypeOptions=[ne.TIME_IN_HOURS,ne.TIME_IN_MINUTES,ne.TIME_IN_SECONDS,ne.IMG_NUMBER]}applyDefaultSelections(){if(super.applyDefaultSelections(),this.firstTimeCell&&!this.firstTimeCell.fake)this.selectFirstTime(this.reselect(this.firstTimeCell));else{let e=this.importDetails.inRows?new y(1,this.colNumber(1),void 0,0,this.rowNumber(0),void 0,void 0):new y(0,this.colNumber(0),void 0,1,this.rowNumber(1),void 0,void 0);e=this.reselect(e),e.fake=!0,this.selectFirstTime(e)}}firstTimeNotNumber(){return this.firstTimeCell?isNaN(Number(this.firstTimeCell.value)):!1}};i.\u0275fac=function(t){return new(t||i)(x(M),x(W))},i.\u0275cmp=D({type:i,selectors:[["bd2-define-time-step"]],inputs:{importDetails:"importDetails"},standalone:!1,features:[G],decls:1,vars:1,consts:[["appearance","outlined",1,"mat-elevation-z4"],[3,"selected","dataSlice","styler"],["type","info","role","alert",1,"alert","alert-info","small"],["required","",3,"valueChange","value"],[3,"value"],["matInput","","type","number","placeholder","Time offset",3,"ngModelChange","ngModel"],["type","danger","role","alert",1,"alert","alert-danger"],["matInput","","type","number","placeholder","Images interval (hours)","required","",3,"ngModelChange","ngModel"]],template:function(t,n){t&1&&b(0,Xi,8,7,"mat-card",0),t&2&&g(n.importDetails?0:-1)},dependencies:[ce,dt,Y,ut,de,Z,ye,ke,pe,R,F,Me,he],encapsulation:2});let a=i;return a})();function Zi(a,i){if(a&1&&(l(0,"div",4),m(1),s()),a&2){let o=c(3);r(),C(" Labels ",o.importDetails.inLabelNeg," must be before first time point. ")}}function Ji(a,i){if(a&1&&(l(0,"div")(1,"p"),m(2),l(3,"strong"),m(4),s()(),b(5,Zi,2,1,"div",4),s()),a&2){let o=c(2);r(2),C("Labels in ",o.importDetails.inLabelNeg," "),r(2),C("",o.importDetails.inRows?o.labelsSelection.colName:o.labelsSelection.rowName,";"),r(),g(o.importDetails.areLabelsAfterTime()?-1:5)}}function en(a,i){if(a&1&&(l(0,"div",3),m(1),s()),a&2){let o=c(2);r(),C(" Even if only the top part of the data table is presented all labels from the selected ",o.importDetails.inLabelNeg," will be imported ")}}function tn(a,i){if(a&1){let o=w();l(0,"mat-card",0)(1,"mat-card-content"),b(2,Ji,6,3,"div"),l(3,"div")(4,"div",1),m(5),s()(),l(6,"bd2-data-sheet-mdtable",2),S("selected",function(t){h(o);let n=c();return _(n.selectLabels(t))}),s(),l(7,"div"),m(8," \xA0 "),b(9,en,2,1,"div",3),s()()()}if(a&2){let o=c();r(2),g(o.labelsSelection?2:-1),r(2),se(o.labelsSelection?"alert alert-info":"alert alert-danger"),r(),C(" Click on the ",o.importDetails.inLabelNeg," containing labels. "),r(),p("dataSlice",o.dataSlice)("selectableColHeader",o.importDetails.inRows)("selectableRowHeader",!o.importDetails.inRows)("styler",o.tableSelector.tableStyler),r(3),g(o.hasMoreLabels()?9:-1)}}var si=(()=>{let i=class i extends J{constructor(e,t){super(e,t)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.labelsSelection&&!this.labelsSelection.fake)this.selectLabels(this.reselect(this.labelsSelection));else if(this.firstTimeCell){let e=this.reselect(new y(this.firstTimeCell.colIx-1,this.colNumber(this.firstTimeCell.colIx-1),void 0,this.firstTimeCell.rowIx-1,this.rowNumber(this.firstTimeCell.rowIx-1),void 0,void 0));e.fake=!0,this.selectLabels(e)}}markSelections(){super.markSelections(),this.markFirstTime()}};i.\u0275fac=function(t){return new(t||i)(x(M),x(W))},i.\u0275cmp=D({type:i,selectors:[["bd2-import-labels-step"]],inputs:{importDetails:"importDetails"},standalone:!1,features:[G],decls:1,vars:1,consts:[["appearance","outlined",1,"mat-elevation-z4"],["role","alert"],[3,"selected","dataSlice","selectableColHeader","selectableRowHeader","styler"],["type","info","role","alert",1,"alert","alert-info","small"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(t,n){t&1&&b(0,tn,10,9,"mat-card",0),t&2&&g(n.importDetails?0:-1)},dependencies:[R,F,he],encapsulation:2});let a=i;return a})();function on(a,i){if(a&1&&(l(0,"div",2),m(1),s()),a&2){let o=c(3);r(),we(" Data start ",o.importDetails.inLabel," must be after time ",o.importDetails.inLabel,". ")}}function an(a,i){if(a&1&&(l(0,"div")(1,"p"),m(2),l(3,"strong"),m(4),s()(),b(5,on,2,2,"div",2),s()),a&2){let o=c(2);r(2),C("Data starts in ",o.importDetails.inLabel," "),r(2),C("",o.importDetails.inRows?o.dataStart.rowName:o.dataStart.colName,";"),r(),g(o.importDetails.isDataAfterTime()?-1:5)}}function rn(a,i){if(a&1){let o=w();l(0,"mat-card",0)(1,"mat-card-content"),b(2,an,6,3,"div"),l(3,"div")(4,"div"),m(5),s()(),l(6,"bd2-data-sheet-mdtable",1),S("selected",function(t){h(o);let n=c();return _(n.selectDataStart(t))}),s()()()}if(a&2){let o=c();r(2),g(o.dataStart?2:-1),r(2),se(o.dataStart?"alert alert-info":"alert alert-danger"),r(),C(" Click on the first data ",o.importDetails.inLabel,". "),r(),p("dataSlice",o.dataSlice)("selectableColHeader",!o.importDetails.inRows)("selectableRowHeader",o.importDetails.inRows)("styler",o.tableSelector.tableStyler)}}var mi=(()=>{let i=class i extends J{constructor(e,t){super(e,t)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.dataStart&&!this.dataStart.fake)this.selectDataStart(this.reselect(this.dataStart));else if(this.firstTimeCell){let e=this.reselect(new y(this.firstTimeCell.colIx+1,this.colNumber(this.firstTimeCell.colIx+1),void 0,this.firstTimeCell.rowIx+1,this.rowNumber(this.firstTimeCell.rowIx+1),void 0,void 0));e.fake=!0,this.selectDataStart(e)}}markSelections(){super.markSelections(),this.markFirstTime(),this.markLabels()}};i.\u0275fac=function(t){return new(t||i)(x(M),x(W))},i.\u0275cmp=D({type:i,selectors:[["bd2-select-data-start-step"]],inputs:{importDetails:"importDetails"},standalone:!1,features:[G],decls:1,vars:1,consts:[["appearance","outlined",1,"mat-elevation-z4"],[3,"selected","dataSlice","selectableColHeader","selectableRowHeader","styler"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(t,n){t&1&&b(0,rn,7,8,"mat-card",0),t&2&&g(n.importDetails?0:-1)},dependencies:[R,F,he],encapsulation:2});let a=i;return a})();var ci=(()=>{let i=class i{constructor(e,t){this.dialogRef=e,this.data=t}ngOnInit(){}sendLabel(){this.dialogRef.close(this.data.label)}};i.\u0275fac=function(t){return new(t||i)(x(Et),x(Ft))},i.\u0275cmp=D({type:i,selectors:[["bd2-edit-label-dialog"]],standalone:!1,decls:20,vars:6,consts:[["ok",""],["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","cdkFocusInitial","",3,"ngModelChange","keydown.enter","ngModel"],["align","start"],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-raised-button","","color","primary",3,"mat-dialog-close"]],template:function(t,n){if(t&1){let d=w();l(0,"h1",1),m(1),s(),l(2,"div",2)(3,"p"),m(4),s(),l(5,"mat-form-field")(6,"input",3),U("ngModelChange",function(f){return h(d),A(n.data.label,f)||(n.data.label=f),_(f)}),S("keydown.enter",function(){return h(d),_(n.sendLabel())}),s(),l(7,"mat-hint",4),m(8,"Pressing "),l(9,"strong"),m(10,"Enter"),s(),m(11," submits "),s()()(),l(12,"div",5)(13,"button",6),m(14,"Cancel"),s(),l(15,"button",6),m(16,"Clear"),s(),l(17,"button",7,0),m(19,"Assign"),s()()}t&2&&(r(),k(n.data.title),r(3),C("Write label for ",n.data.regionName),r(2),O("ngModel",n.data.label),r(7),p("mat-dialog-close",void 0),r(2),p("mat-dialog-close",""),r(2),p("mat-dialog-close",n.data.label))},dependencies:[ce,Y,de,Z,_t,Me,Re,Vt,Pt,At,Ot],encapsulation:2});let a=i;return a})();var cn=["table"];function dn(a,i){a&1&&T(0,"th",19)}function pn(a,i){if(a&1){let o=w();l(0,"td",20),S("mousedown",function(){let t=h(o).index,n=c(2);return _(n.startSelectCell(-1,t))})("mouseup",function(){let t=h(o).index,n=c(2);return _(n.endSelectCell(-1,t))}),l(1,"label"),m(2),s()()}if(a&2){let o=i.index,e=c(2);r(2),k(e.rowsNames[o])}}function un(a,i){if(a&1){let o=w();l(0,"td",21),S("click",function(){h(o);let t=c(2);return _(t.nextRow())}),m(1),s()}if(a&2){let o=c(2);r(),k(o.hasMoreRows?"...":"end")}}function fn(a,i){a&1&&(l(0,"th",19),m(1,"Labels"),s())}function hn(a,i){if(a&1){let o=w();l(0,"td",20),S("mousedown",function(){let t=h(o).index,n=c(2);return _(n.startSelectCell(-1,t))})("mouseup",function(){let t=h(o).index,n=c(2);return _(n.endSelectCell(-1,t))}),l(1,"label",22),m(2),s()()}if(a&2){let o=i.index,e=c(2);r(2),k(e.rowsLabels[o])}}function _n(a,i){if(a&1){let o=w();l(0,"td",21),S("click",function(){h(o);let t=c(2);return _(t.nextRow())}),s()}}function Cn(a,i){if(a&1){let o=w();l(0,"th",25),S("mousedown",function(){h(o);let t=c().$index,n=c(2);return _(n.startSelectCell(t,-1))})("mouseup",function(){h(o);let t=c().$index,n=c(2);return _(n.endSelectCell(t,-1))}),m(1),s()}if(a&2){let o=c(),e=o.$implicit,t=o.$index,n=c(2);K("background-color",n.colBackground(t)),r(),C(" ",e," ")}}function bn(a,i){if(a&1&&(l(0,"td",26),m(1),s()),a&2){let o=i.$implicit,e=i.index,t=c().$index,n=c(2);K("background-color",n.cellBackground(t,e)),r(),C(" ",o[t]," ")}}function gn(a,i){if(a&1){let o=w();l(0,"td",21),S("click",function(){h(o);let t=c(3);return _(t.nextRow())}),m(1),s()}if(a&2){let o=c(3);r(),k(o.hasMoreRows?"...":"")}}function Sn(a,i){if(a&1&&($(0,8),v(1,Cn,2,3,"th",23)(2,bn,2,3,"td",24)(3,gn,2,1,"td",6),j()),a&2){let o=i.$implicit;p("matColumnDef",o)}}function wn(a,i){if(a&1){let o=w();l(0,"th",27),S("click",function(){h(o);let t=c(2);return _(t.nextColumn())}),m(1,"..."),s()}}function xn(a,i){if(a&1){let o=w();l(0,"td",28),S("click",function(){h(o);let t=c(2);return _(t.nextColumn())}),m(1,"..."),s()}}function Dn(a,i){a&1&&T(0,"td",29)}function vn(a,i){a&1&&(l(0,"th",19),m(1,"Labels"),s())}function Tn(a,i){a&1&&T(0,"th",19)}function yn(a,i){if(a&1){let o=w();l(0,"th",25),S("mousedown",function(){h(o);let t=c().$index,n=c(3);return _(n.startSelectCell(t,-1))})("mouseup",function(){h(o);let t=c().$index,n=c(3);return _(n.endSelectCell(t,-1))}),l(1,"label",22),m(2),s()()}if(a&2){let o=c().$index,e=c(3);K("background-color",e.colBackground(o)),r(2),k(e.columnsLabels[o])}}function In(a,i){if(a&1&&($(0,8),v(1,yn,3,3,"th",23),j()),a&2){let o=i.$index;p("matColumnDef","label"+o)}}function kn(a,i){if(a&1&&V(0,In,2,1,"ng-container",8,B),a&2){let o=c(2);P(o.columnsNames)}}function Rn(a,i){a&1&&T(0,"tr",16)}function Mn(a,i){a&1&&T(0,"tr",16)}function Ln(a,i){if(a&1&&v(0,Mn,1,0,"tr",15),a&2){let o=c(2);p("matHeaderRowDef",o.displayedLabelsColumns)("matHeaderRowDefSticky",!0)}}function Nn(a,i){if(a&1&&T(0,"tr",30),a&2){let o=i.index,e=c(2);K("background-color",e.rowBackground(o))}}function En(a,i){a&1&&T(0,"tr",31)}function Fn(a,i){if(a&1&&(l(0,"div",1)(1,"table",2,0),$(3,3),v(4,dn,1,0,"th",4)(5,pn,3,1,"td",5)(6,un,2,1,"td",6),j(),$(7,7),v(8,fn,2,0,"th",4)(9,hn,3,1,"td",5)(10,_n,1,0,"td",6),j(),V(11,Sn,4,1,"ng-container",8,B),$(13,9),v(14,wn,2,0,"th",10)(15,xn,2,0,"td",11)(16,Dn,1,0,"td",12),j(),$(17,13),v(18,vn,2,0,"th",4),j(),$(19,14),v(20,Tn,1,0,"th",4),j(),b(21,kn,2,0),v(22,Rn,1,0,"tr",15),b(23,Ln,1,2,"tr",16),v(24,Nn,1,2,"tr",17)(25,En,1,0,"tr",18),s()()),a&2){let o=c();r(),p("dataSource",o.data),r(10),P(o.columnsNames),r(10),g(o.showColumnsLabels?21:-1),r(),p("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),r(),g(o.showColumnsLabels?23:-1),r(),p("matRowDefColumns",o.displayedColumns),r(),p("matFooterRowDef",o.displayedColumns)}}var di=(()=>{let i=class i{set columnsLabels(e){this._columnsLabels=e}get columnsLabels(){return this._columnsLabels}set rowsLabels(e){this._rowsLabels=e}get rowsLabels(){return this._rowsLabels}set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.data=e.data,this.hasMoreColumns=e.columnsNumbers[e.columnsNumbers.length-1]<e.totalColumns-1,this.hasMoreRows=e.rowsNumbers[e.rowsNumbers.length-1]<e.totalRows-1,this.decideColumns(),this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}set selectRows(e){this.selectableRowHeader=e,this.showRowsLabels=e,this.decideColumns()}set selectCols(e){this.selectableColHeader=e,this.showColumnsLabels=e,this.decideColumns()}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.hasMoreColumns=!1,this.hasMoreRows=!1,this._columnsLabels=[],this._rowsLabels=[],this.styler=new ae,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.showColumnsLabels=!1,this.showRowsLabels=!1,this.selected=new z,this.moreRows=new z,this.moreColumns=new z}decideColumns(){this.displayedColumns=(this.showRowsLabels?["rowNr","rowLabel"]:["rowNr"]).concat(this.columnsNames),this.displayedLabelsColumns=(this.showRowsLabels?["rowNr2","rowLabel2"]:["rowNr2"]).concat(this.columnsNames.map((e,t)=>"label"+t)),this.hasMoreColumns&&(this.displayedColumns.push("more"),this.displayedLabelsColumns.push("more"))}ngOnInit(){}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}startSelectCell(e,t){if(e<0&&!this.selectableRowHeader||t<0&&!this.selectableColHeader)return;let d=(t>=0?this.data[t]:[])[e],u=this._dataSlice.columnsNumbers[e],f=this._dataSlice.columnsNames[e],H=this._dataSlice.rowsNumbers[t],ee=this._dataSlice.rowsNames[t],te=new y(e,u,f,t,H,ee,d);this.selectionStart=te}endSelectCell(e,t){if(!this.selectionStart)return;if(t<0&&this.selectionStart.rowIx>=0){this.selectionStart=void 0;return}if(e<0&&this.selectionStart.colIx>=0){this.selectionStart=void 0;return}if(e<0&&!this.selectableRowHeader||t<0&&!this.selectableColHeader)return;let d=(t>=0?this.data[t]:[])[e],u=this._dataSlice.columnsNumbers[e],f=this._dataSlice.columnsNames[e],H=this._dataSlice.rowsNumbers[t],ee=this._dataSlice.rowsNames[t],te=new y(e,u,f,t,H,ee,d);this.selected.next([this.selectionStart,te])}nextColumn(){this.moreColumns.next(!0)}nextRow(){this.moreRows.next(!0)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=D({type:i,selectors:[["bd2-selectable-region-mdtable"]],viewQuery:function(t,n){if(t&1&&L(cn,5),t&2){let d;N(d=E())&&(n.matTable=d.first)}},inputs:{columnsLabels:"columnsLabels",rowsLabels:"rowsLabels",dataSlice:"dataSlice",selectRows:"selectRows",selectCols:"selectCols",styler:"styler"},outputs:{selected:"selected",moreRows:"moreRows",moreColumns:"moreColumns"},standalone:!1,decls:1,vars:1,consts:[["table",""],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"mousedown","mouseup",4,"matCellDef"],["mat-footer-cell","",3,"click",4,"matFooterCellDef"],["matColumnDef","rowLabel","sticky",""],[3,"matColumnDef"],["matColumnDef","more","sticky",""],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","rowNr2","sticky",""],["matColumnDef","rowLabel2","sticky",""],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-header-row",""],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell","","matRipple","",3,"mousedown","mouseup"],["mat-footer-cell","",3,"click"],[1,"user"],["mat-header-cell","","matRipple","",3,"background-color","mousedown","mouseup",4,"matHeaderCellDef"],["mat-cell","",3,"background-color",4,"matCellDef"],["mat-header-cell","","matRipple","",3,"mousedown","mouseup"],["mat-cell",""],["mat-header-cell","",3,"click"],["mat-cell","",3,"click"],["mat-footer-cell",""],["mat-row",""],["mat-footer-row",""]],template:function(t,n){t&1&&b(0,Fn,26,7,"div",1),t&2&&g(n.dataSlice?0:-1)},dependencies:[Le,Ee,Pe,Fe,Ne,Oe,kt,Mt,Be,Ve,Rt,Ae,Ue,Lt,Ie],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:800px;overflow:auto}.mat-mdc-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-mdc-header-cell[_ngcontent-%COMP%], .mat-mdc-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}label.user[_ngcontent-%COMP%]{color:#000}"]});let a=i;return a})();var Vn=["colPaginator"],Pn=["rowPaginator"],pi=()=>[10,25,50,100];function On(a,i){if(a&1&&(l(0,"div",7),m(1),s()),a&2){let o=c();r(),C(" You have not seen yet all the available ",o.importDetails==null?null:o.importDetails.inLabel,"s for labelling ")}}var ui=(()=>{let i=class i extends J{get userLabels(){return this.importDetails?this.importDetails.userLabels:void 0}constructor(e,t,n){super(t,n),this.dialog=e,this.columnsLabels=[],this.rowsLabels=[],this.colorer=new ri}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy(),this.dataService&&this.dataService.close()}ngAfterViewInit(){this.colPaginator._intl=new Qe,this.colPaginator._intl.itemsPerPageLabel="Columns per page",this.rowPaginator._intl=new Qe,this.rowPaginator._intl.itemsPerPageLabel="Rows per page"}markSelections(){super.markSelections(),this.markFirstTime(),this.loadLabels(),this.markLabels(),this.labelsSummary=this.importDetails.summarizeLabels(25),this.labelTime()}labelTime(){if(this.firstTimeCell)if(this.importDetails.inRows){let e=this.dataSlice.rowsNumbers.indexOf(this.firstTimeCell.rowNumber);e>=0&&(this.rowsLabels[e]="Time")}else{let e=this.dataSlice.columnsNumbers.indexOf(this.firstTimeCell.colNumber);e>=0&&(this.columnsLabels[e]="Time")}}loadLabels(){let e=this.dataSlice;this.importDetails.inRows?(this.rowsLabels=this.userLabels.slice(e.rowsNumbers[0],e.rowsNumbers[e.rowsNumbers.length-1]),this.columnsLabels=[]):(this.rowsLabels=[],this.columnsLabels=this.userLabels.slice(e.columnsNumbers[0],e.columnsNumbers[e.columnsNumbers.length-1]))}markLabels(){this.userLabels.forEach((e,t)=>{this.importDetails.inRows?this.tableSelector.selectRow(t,this.colorer.toColor(e)):this.tableSelector.selectCol(t,this.colorer.toColor(e))})}hasSeenAll(){return this.dataSlice?this.importDetails.inRows?this.lastRowSeen>=this.dataSlice.totalRows-1:this.lastColumnSeen>=this.dataSlice.totalColumns-1:!1}selected(e){let t=e[0].colName+e[0].rowName,n=e[1].colName+e[1].rowName;e[1].isBeforeOrSame(e[0])&&(e=[e[1],e[0]]),this.importDetails.inRows?this.labelRows(e[0],e[1]):this.labelColumns(e[0],e[1])}setUserLabel(e,t){this.userLabels[e]=t||void 0,this.labelsSummary=this.importDetails.summarizeLabels(25)}askForLabel(e,t,n){let d;return n?d={title:"Label rows",regionName:e.hasSameIx(t)?"row "+e.rowName:"rows "+e.rowName+"-"+t.rowName,label:this.userLabels[e.rowNumber]}:d={title:"Label columns",regionName:e.hasSameIx(t)?"column "+e.colName:"columns "+e.colName+"-"+t.colName,label:this.userLabels[e.rowNumber]},this.dialog.open(ci,{data:d}).afterClosed()}labelRows(e,t){if(e.rowIx<0||t.rowIx<0){console.warn("Label rows with col selection",e);return}this.firstTimeCell&&this.firstTimeCell.rowNumber>=e.rowNumber||this.askForLabel(e,t,!0).subscribe(n=>{n!==void 0&&(this.setRowsLabel(e,t,n),n&&this.selectNextRegion(e,t))})}setRowsLabel(e,t,n){n=n.trim();let d=this.colorer.toColor(n);for(let u=e.rowIx;u<=t.rowIx;u++){let f=this.dataSlice.rowsNumbers[u];f===void 0?console.error("No row number for index "+u):(this.rowsLabels[u]=n,this.setUserLabel(f,n),n?this.tableSelector.selectRow(f,d):this.tableSelector.deselectRow(f))}}labelColumns(e,t){if(e.colIx<0||t.colIx<0){console.warn("Label cols with row selection",e);return}if(this.firstTimeCell&&this.firstTimeCell.colNumber>=e.colNumber){console.log("Ignroing labelling as Time col after selection");return}this.askForLabel(e,t,!1).subscribe(n=>{n!==void 0&&(this.setColumnsLabel(e,t,n),n&&this.selectNextRegion(e,t))})}setColumnsLabel(e,t,n){n=n.trim();let d=this.colorer.toColor(n);for(let u=e.colIx;u<=t.colIx;u++){let f=this.dataSlice.columnsNumbers[u];f===void 0?console.error("No col number for index "+u):(this.columnsLabels[u]=n,this.setUserLabel(f,n),n?this.tableSelector.selectCol(f,d):this.tableSelector.deselectCol(f))}}selectNextRegion(e,t){let n=[t.colIx-e.colIx,t.rowIx-e.rowIx],d=this.moveCell(t,[1,1]),u=this.moveCell(d,n);this.isInPage(d)&&(this.isInPage(u)||(u=this.fitToPage(u)),d=this.reselect(d),u=this.reselect(u),this.selected([d,u]))}isInPage(e){return!(e.colIx>=0&&e.colIx>=this.dataSlice.columnsNumbers.length||e.rowIx>=0&&e.rowIx>=this.dataSlice.rowsNumbers.length)}fitToPage(e){let t=e.colIx>=0?this.dataSlice.columnsNumbers.length-1:-1,n=e.rowIx>=0?this.dataSlice.rowsNumbers.length-1:-1;return new y(t,void 0,void 0,n,void 0,void 0,void 0)}moveCell(e,t){let n=e.colIx>=0?e.colIx+t[0]:-1,d=e.rowIx>=0?e.rowIx+t[1]:-1;return new y(n,void 0,void 0,d,void 0,void 0,void 0)}loadColPage(e){this.dataService.slice(new Q(this.currentPageSlice.rowPage,e))}loadRowPage(e){this.dataService.slice(new Q(e,this.currentPageSlice.colPage))}moreColumns(){this.importDetails.inRows||this.colPaginator.nextPage()}moreRows(){this.importDetails.inRows&&this.rowPaginator.nextPage()}};i.\u0275fac=function(t){return new(t||i)(x(Bt),x(M),x(W))},i.\u0275cmp=D({type:i,selectors:[["bd2-assign-labels-step"]],viewQuery:function(t,n){if(t&1&&(L(Vn,7),L(Pn,7)),t&2){let d;N(d=E())&&(n.colPaginator=d.first),N(d=E())&&(n.rowPaginator=d.first)}},inputs:{importDetails:"importDetails"},standalone:!1,features:[xe([M]),G],decls:14,vars:23,consts:[["colPaginator",""],["rowPaginator",""],["role","alert","type","info",1,"alert","alert-info",3,"hidden"],[3,"hidden"],[3,"page","length","disabled","pageSize","pageIndex","pageSizeOptions"],[3,"selected","moreColumns","moreRows","dataSlice","columnsLabels","rowsLabels","styler","selectRows","selectCols"],[3,"page","length","disabled","pageSize","pageSizeOptions"],["type","danger","role","alert",1,"alert","alert-danger","mt-2"],[2,"margin-top","1em"]],template:function(t,n){if(t&1){let d=w();l(0,"div",2),m(1),s(),l(2,"div",3)(3,"mat-paginator",4,0),S("page",function(f){return h(d),_(n.loadColPage(f))}),s()(),l(5,"bd2-selectable-region-mdtable",5),S("selected",function(f){return h(d),_(n.selected(f))})("moreColumns",function(){return h(d),_(n.moreColumns())})("moreRows",function(){return h(d),_(n.moreRows())}),s(),l(6,"div",3)(7,"mat-paginator",6,1),S("page",function(f){return h(d),_(n.loadRowPage(f))}),s()(),b(9,On,2,1,"div",7),l(10,"div",8)(11,"label"),m(12,"Selected labels: "),s(),m(13),s()}t&2&&(p("hidden",(n.importDetails==null||n.importDetails.userLabels==null?null:n.importDetails.userLabels.length)>1),r(),C(" Click and drag over ",n.importDetails==null?null:n.importDetails.inLabel,` headers to label the data.
`),r(),p("hidden",n.importDetails==null?null:n.importDetails.inRows),r(),p("length",n.dataSlice==null?null:n.dataSlice.totalColumns)("disabled",n.importDetails==null?null:n.importDetails.inRows)("pageSize",n.currentPageSlice.colPage.pageSize)("pageIndex",n.currentPageSlice.colPage.pageIndex)("pageSizeOptions",$e(21,pi)),r(2),p("dataSlice",n.dataSlice)("columnsLabels",n.columnsLabels)("rowsLabels",n.rowsLabels)("styler",n.tableSelector.tableStyler)("selectRows",n.importDetails==null?null:n.importDetails.inRows)("selectCols",!(n.importDetails!=null&&n.importDetails.inRows)),r(),p("hidden",!(n.importDetails!=null&&n.importDetails.inRows)),r(),p("length",n.dataSlice==null?null:n.dataSlice.totalRows)("disabled",!(n.importDetails!=null&&n.importDetails.inRows))("pageSize",n.firstPageSlice.rowPage.pageSize)("pageSizeOptions",$e(22,pi)),r(2),g(n.hasSeenAll()?-1:9),r(4),C("",n.labelsSummary,`
`))},dependencies:[Ct,di],encapsulation:2});let a=i;return a})();var Un=["backgroundInput"],Wn=["auto"];function Hn(a,i){a&1&&(l(0,"mat-icon",12),m(1,"cancel"),s())}function zn(a,i){if(a&1){let o=w();l(0,"mat-chip-row",11),S("removed",function(){let t=h(o).$implicit,n=c(2);return _(n.remove(t))}),m(1),b(2,Hn,2,0,"mat-icon",12),s()}if(a&2){let o=i.$implicit,e=c(2);p("removable",e.removable),r(),C(" ",o," "),r(),g(e.removable?2:-1)}}function $n(a,i){if(a&1&&(l(0,"mat-option",10),m(1),s()),a&2){let o=i.$implicit;p("value",o),r(),C(" ",o," ")}}function jn(a,i){if(a&1){let o=w();l(0,"div")(1,"mat-card",3)(2,"mat-card-content")(3,"div",4),m(4," Select labels for which data should be treated as the background noise "),s(),l(5,"mat-form-field",5)(6,"mat-chip-grid",6,0),V(8,zn,3,3,"mat-chip-row",7,B),l(10,"input",8,1),S("matChipInputTokenEnd",function(t){h(o);let n=c();return _(n.add(t))}),s()(),l(12,"mat-autocomplete",9,2),S("optionSelected",function(t){h(o);let n=c();return _(n.selected(t))}),V(14,$n,2,2,"mat-option",10,B),rt(16,"async"),s()()()()()}if(a&2){let o=le(7),e=le(13),t=c();r(8),P(t.backgrounds),r(2),p("formControl",t.backgroundCtrl)("matAutocomplete",e)("matChipInputFor",o)("matChipInputSeparatorKeyCodes",t.separatorKeysCodes)("matChipInputAddOnBlur",t.addOnBlur),r(4),P(lt(16,5,t.filteredLabels))}}var fi=(()=>{let i=class i{get backgrounds(){return this.importDetails?this.importDetails.backgroundsLabels:[]}set backgrounds(e){this.importDetails.backgroundsLabels=e}constructor(e){this.tsFileService=e,this.selectable=!0,this.removable=!0,this.addOnBlur=!1,this.separatorKeysCodes=[13,188],this.backgroundCtrl=new ct,this.allLabels=[]}ngOnInit(){this.filteredLabels=this.backgroundCtrl.valueChanges.pipe(it(null),_e(e=>e?this.filter(e):this.allLabels))}loadLabels(){if(!this.importDetails||!this.importDetails.fileId){this.updateAllLabels([]);return}this.importDetails.importLabels?this.importDetails.labelsSelection&&this.tsFileService.previewLabels(this.importDetails.fileId,this.importDetails.importFormat.name,this.importDetails.labelsSelection,this.importDetails.inRows).subscribe(e=>{this.updateAllLabels(this.unique(e))}):this.updateAllLabels(this.unique(this.importDetails.userLabels))}updateAllLabels(e){this.allLabels=e.slice().sort();let t=this.backgrounds||[];this.backgrounds=[],t.forEach(n=>this.addBackground(n)),this.backgroundCtrl.setValue(" "),this.backgroundCtrl.setValue(null)}unique(e){return e=e.filter(n=>!!n).map(n=>n.trim()),[...new Set(e)]}addBackground(e){if((e||"").trim()){let t=this.backgrounds.indexOf(e),n=this.allLabels.indexOf(e);t<0&&n>=0&&this.backgrounds.push(e.trim())}}add(e){if(!this.matAutocomplete.isOpen){let t=e.input,n=e.value;this.addBackground(n),t&&(t.value=""),this.backgroundCtrl.setValue(null)}}remove(e){let t=this.backgrounds.indexOf(e);t>=0&&this.backgrounds.splice(t,1)}selected(e){this.addBackground(e.option.viewValue),this.backgroundInput.nativeElement.value="",this.backgroundCtrl.setValue(null)}filter(e){let t=e.toLowerCase();return this.allLabels.filter(n=>n.toLowerCase().includes(t)).slice(0,7)}};i.\u0275fac=function(t){return new(t||i)(x(ue))},i.\u0275cmp=D({type:i,selectors:[["bd2-select-backgrounds-labels-step"]],viewQuery:function(t,n){if(t&1&&(L(Un,5),L(Wn,5)),t&2){let d;N(d=E())&&(n.backgroundInput=d.first),N(d=E())&&(n.matAutocomplete=d.first)}},inputs:{importDetails:"importDetails"},standalone:!1,decls:1,vars:1,consts:[["chipList",""],["backgroundInput",""],["auto","matAutocomplete"],["appearance","outlined",1,"mat-elevation-z4"],["type","info","role","alert",1,"alert","alert-info"],[2,"width","100%"],["aria-label","Backgrounds selection"],[3,"removable"],["placeholder","Type to select background label...",3,"matChipInputTokenEnd","formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur"],[3,"optionSelected"],[3,"value"],[3,"removed","removable"],["matChipRemove",""]],template:function(t,n){t&1&&b(0,jn,17,7,"div"),t&2&&g(n.importDetails!=null&&n.importDetails.containsBackgrounds?0:-1)},dependencies:[ce,Y,pt,Z,pe,R,F,wt,xt,gt,St,bt,yt,It,st],encapsulation:2});let a=i;return a})();var Gn=["stepper"],qn=["importLabelsStep"],Kn=["assignLabelsStep"],Xn=["selectBackgroundsStep"];function Yn(a,i){a&1&&m(0,"Upload data file")}function Zn(a,i){a&1&&m(0,"Data layout")}function Jn(a,i){if(a&1&&m(0),a&2){let o=c();C("Define time ",o.importDetails.inLabel)}}function eo(a,i){a&1&&m(0,"Label data")}function to(a,i){if(a&1){let o=w();l(0,"mat-step",17),v(1,eo,1,0,"ng-template",7),T(2,"mat-divider")(3,"bd2-import-details-summary",22)(4,"bd2-assign-labels-step",9,2),l(6,"div")(7,"button",15),m(8,"Back"),s(),l(9,"button",18),S("click",function(){h(o);let t=c();return _(t.startChoosingBackgrounds())}),m(10,"Next"),s()()()}if(a&2){let o=c();p("completed",o.importDetails.areLabelsCorrectlyAssigned()),r(3),p("importDetails",o.importDetails)("showTime",!0),r(),p("importDetails",o.importDetails),r(5),p("disabled",!o.importDetails.areLabelsCorrectlyAssigned())}}function io(a,i){if(a&1&&m(0),a&2){let o=c(2);C("Select labels ",o.importDetails.inLabelNeg)}}function no(a,i){a&1&&m(0,"Select data start")}function oo(a,i){if(a&1){let o=w();l(0,"mat-step",17),v(1,io,1,1,"ng-template",7),T(2,"mat-divider")(3,"bd2-import-details-summary",22)(4,"bd2-import-labels-step",9,3),l(6,"div")(7,"button",15),m(8,"Back"),s(),l(9,"button",18),S("click",function(){h(o);let t=le(16),n=c();return _(n.loadData(t))}),m(10,"Next"),s()()(),l(11,"mat-step",17),v(12,no,1,0,"ng-template",7),T(13,"mat-divider")(14,"bd2-import-details-summary",23)(15,"bd2-select-data-start-step",9,4),l(17,"div")(18,"button",15),m(19,"Back"),s(),l(20,"button",18),S("click",function(){h(o);let t=c();return _(t.startChoosingBackgrounds())}),m(21,"Next"),s()()()}if(a&2){let o=c();p("completed",o.importDetails.areLabelsCorrectlySelected()),r(3),p("importDetails",o.importDetails)("showTime",!0),r(),p("importDetails",o.importDetails),r(5),p("disabled",!o.importDetails.areLabelsCorrectlySelected()),r(2),p("completed",o.importDetails.areLabelsCorrectlySelected()&&o.importDetails.isDataStartCorrectlySelected()),r(3),p("importDetails",o.importDetails)("showTime",!0)("showLabelling",!0),r(),p("importDetails",o.importDetails),r(5),p("disabled",!o.importDetails.isDataStartCorrectlySelected())}}function ao(a,i){a&1&&m(0,"Select backgrounds labels")}function ro(a,i){if(a&1&&(l(0,"mat-step"),v(1,ao,1,0,"ng-template",7),T(2,"mat-divider")(3,"bd2-import-details-summary",19)(4,"bd2-select-backgrounds-labels-step",9,5),l(6,"div")(7,"button",15),m(8,"Back"),s(),l(9,"button",24),m(10,"Next"),s()()()),a&2){let o=c();r(3),p("importDetails",o.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),r(),p("importDetails",o.importDetails)}}function lo(a,i){a&1&&m(0,"Import timeseries")}var hi=(()=>{let i=class i{constructor(e,t,n){this.fileService=e,this.feedback=t,this.dataService=n,this.import=new z,this.oldImport=new z,this.blocked=!1,this.importDetails=new ei,this.importDetails.timeType=ne.TIME_IN_HOURS}ngOnInit(){}ngOnDestroy(){this.dataService&&this.dataService.close()}upload(e){if(!e.files||e.files.length!==1){console.error("Wrong upload files size",e.files);return}this.fileService.uploadFile(e.files[0],e.importFormat).subscribe(t=>{this.importDetails.fileId=t,this.importDetails.fileName=e.files[0].name,this.importDetails.importFormat=e.importFormat,e.importFormat==X.EXCEL_TABLE?this.importDetails.inRows=!1:this.importDetails.inRows=!0,this.stepper.next(),e.importFormat==X.TOPCOUNT&&this.oldImport.next(this.importDetails)},t=>{this.feedback.error(t)})}loadData(e){e.loadData()}startLabelling(){this.importDetails.importLabels?this.importLabelsStep?this.importLabelsStep.loadData():console.error("Missing importLabelStep"):this.assignLabelsStep?this.assignLabelsStep.loadData():console.error("Missing assignLabelsStep")}startChoosingBackgrounds(){this.importDetails.containsBackgrounds&&(this.selectBackgroundsStep?this.selectBackgroundsStep.loadLabels():console.error("Missing selectBackgroundsStep"))}importData(){this.importDetails.isComplete()&&this.import.next(this.importDetails)}};i.\u0275fac=function(t){return new(t||i)(x(ue),x(W),x(M))},i.\u0275cmp=D({type:i,selectors:[["bd2-import-steps"]],viewQuery:function(t,n){if(t&1&&(L(Gn,5),L(qn,5),L(Kn,5),L(Xn,5)),t&2){let d;N(d=E())&&(n.stepper=d.first),N(d=E())&&(n.importLabelsStep=d.first),N(d=E())&&(n.assignLabelsStep=d.first),N(d=E())&&(n.selectBackgroundsStep=d.first)}},inputs:{blocked:"blocked"},outputs:{import:"import",oldImport:"oldImport"},standalone:!1,features:[xe([M])],decls:62,vars:26,consts:[["stepper",""],["defineTimeStep",""],["assignLabelsStep",""],["importLabelsStep",""],["selectDataStartStep",""],["selectBackgroundsStep",""],[3,"linear"],["matStepLabel",""],[3,"uploadFiles"],[3,"importDetails"],["appearance","outlined",1,"mat-elevation-z4"],["name","inRows",1,"spaced",3,"ngModelChange","ngModel"],[3,"value"],["name","importLabels",1,"spaced",3,"ngModelChange","ngModel"],["name","containsBackgrounds",1,"spaced",3,"ngModelChange","ngModel"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","type","button",3,"click"],[3,"completed"],["mat-button","","matStepperNext","","type","button",3,"click","disabled"],[3,"importDetails","showTime","showLabelling","showDataStart"],["type","info","role","alert",1,"alert","alert-info"],["mat-button","",3,"click","disabled"],[3,"importDetails","showTime"],[3,"importDetails","showTime","showLabelling"],["mat-button","","matStepperNext","","type","button"]],template:function(t,n){if(t&1){let d=w();l(0,"mat-vertical-stepper",6,0)(2,"mat-step"),v(3,Yn,1,0,"ng-template",7),l(4,"bd2-upload-data-file-step",8),S("uploadFiles",function(f){return h(d),_(n.upload(f))}),s()(),l(5,"mat-step")(6,"form"),v(7,Zn,1,0,"ng-template",7),T(8,"mat-divider")(9,"bd2-import-details-summary",9),l(10,"mat-card",10)(11,"mat-card-content")(12,"p")(13,"mat-radio-group",11),U("ngModelChange",function(f){return h(d),A(n.importDetails.inRows,f)||(n.importDetails.inRows=f),_(f)}),l(14,"mat-radio-button",12),m(15,"Data in rows"),s(),l(16,"mat-radio-button",12),m(17,"Data in columns"),s()()(),l(18,"p")(19,"mat-radio-group",13),U("ngModelChange",function(f){return h(d),A(n.importDetails.importLabels,f)||(n.importDetails.importLabels=f),_(f)}),l(20,"mat-radio-button",12),m(21),s(),l(22,"mat-radio-button",12),m(23,"Manually label"),s()()(),l(24,"p")(25,"mat-radio-group",14),U("ngModelChange",function(f){return h(d),A(n.importDetails.containsBackgrounds,f)||(n.importDetails.containsBackgrounds=f),_(f)}),l(26,"mat-radio-button",12),m(27,"No noise data"),s(),l(28,"mat-radio-button",12),m(29),s()()()(),l(30,"mat-card-actions")(31,"button",15),m(32,"Back"),s(),l(33,"button",16),S("click",function(){h(d);let f=le(40);return _(n.loadData(f))}),m(34,"Next"),s()()()()(),l(35,"mat-step",17),v(36,Jn,1,1,"ng-template",7),T(37,"mat-divider")(38,"bd2-import-details-summary",9)(39,"bd2-define-time-step",9,1),l(41,"div")(42,"button",15),m(43,"Back"),s(),l(44,"button",18),S("click",function(){return h(d),_(n.startLabelling())}),m(45,"Next"),s()()(),b(46,to,11,5,"mat-step",17),b(47,oo,22,11),b(48,ro,11,5,"mat-step"),l(49,"mat-step",17),v(50,lo,1,0,"ng-template",7),T(51,"mat-divider")(52,"bd2-import-details-summary",19),l(53,"mat-card",10)(54,"mat-card-content")(55,"div",20),m(56,"You can now import the timeseries"),s()()(),l(57,"div")(58,"button",15),m(59,"Back"),s(),l(60,"button",21),S("click",function(){return h(d),_(n.importData())}),m(61,"Import data"),s()()()()}t&2&&(p("linear",!0),r(9),p("importDetails",n.importDetails),r(4),O("ngModel",n.importDetails.inRows),r(),p("value",!0),r(2),p("value",!1),r(3),O("ngModel",n.importDetails.importLabels),r(),p("value",!0),r(),C("Import labels from ",n.importDetails.inLabelNeg),r(),p("value",!1),r(3),O("ngModel",n.importDetails.containsBackgrounds),r(),p("value",!1),r(2),p("value",!0),r(),C("Background noise in ",n.importDetails.inLabel,"s"),r(6),p("completed",n.importDetails.isTimeDefined()),r(3),p("importDetails",n.importDetails),r(),p("importDetails",n.importDetails),r(5),p("disabled",!n.importDetails.isTimeDefined()),r(2),g(n.importDetails.importLabels?-1:46),r(),g(n.importDetails.importLabels?47:-1),r(),g(n.importDetails.containsBackgrounds?48:-1),r(),p("completed",n.importDetails.isComplete()),r(3),p("importDetails",n.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),r(8),p("disabled",n.blocked||!n.importDetails.isComplete()))},dependencies:[Te,Y,De,de,ve,Ht,zt,R,Tt,F,Dt,Qt,jt,Gt,qt,Kt,Re,oi,ai,li,si,mi,ui,fi],encapsulation:2});let a=i;return a})();function mo(a,i){a&1&&(l(0,"mat-card",1)(1,"mat-card-content"),T(2,"mat-spinner",2),l(3,"div",3),m(4,"Importing ...."),s()()())}var _i=(()=>{let i=class i extends Ut{constructor(e,t){super(t),this.BD2REST=e,this.importing=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit()}importData(e){if(this.importing)return;let t=new Jt;t.fileId=e.fileId,t.importFormat=e.importFormat,t.importParameters=e,this.importing=!0,this.BD2REST.experimentImportTS(this.assay.id,t).subscribe(n=>{let d="Imported "+n.imported+" timeseries";this.feedback.success(d),this.refreshModel(),this.importing=!1,this.goToTSView()},n=>{this.importing=!1,this.feedback.error(n)})}goToTSView(){let e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}goToOldImport(e){let t=this.expHomePath();t.push("data","ts-old-import",e.importFormat.name,e.fileId),this.router.navigate(t)}};i.\u0275fac=function(t){return new(t||i)(x(me),x(Nt))},i.\u0275cmp=D({type:i,selectors:[["bd2-tsimport-dashboard"]],standalone:!1,features:[G],decls:2,vars:1,consts:[[3,"import","oldImport"],["appearance","outlined"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"]],template:function(t,n){t&1&&(l(0,"bd2-import-steps",0),S("import",function(u){return n.importData(u)})("oldImport",function(u){return n.goToOldImport(u)}),s(),b(1,mo,5,0,"mat-card",1)),t&2&&(r(),g(n.importing?1:-1))},dependencies:[$t,R,F,hi],encapsulation:2});let a=i;return a})();var co=[{path:"",children:[{path:"",component:_i}]}],Ci=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=Se({type:i}),i.\u0275inj=ge({imports:[je.forChild(co),je]});let a=i;return a})();var mr=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=Se({type:i}),i.\u0275inj=ge({imports:[mt,ft,ht,Yt,Xt,Ci]});let a=i;return a})();export{mr as TsImportModule};
