import{a as q,b as g}from"./chunk-VRWFW24G.js";import{e as Z}from"./chunk-VIA5AFIU.js";import"./chunk-6EZS4W46.js";import{a as B}from"./chunk-RSZZKPWF.js";import"./chunk-O3RBZ5Z3.js";import{a as z}from"./chunk-AG6TB2CD.js";import{h as R,i as L,j as v,l as G,m as K,n as Y}from"./chunk-OXAFMXG5.js";import"./chunk-VUPIMN6E.js";import"./chunk-5JH2XPWW.js";import{b as A,c as H}from"./chunk-KXJ32HWL.js";import"./chunk-GKSKHALW.js";import{c as Q,d as U,e as W,o as X}from"./chunk-MFGL2POH.js";import"./chunk-DMOCFO74.js";import"./chunk-NTQTMRBJ.js";import"./chunk-URYWC6PJ.js";import"./chunk-ZG4MTZZ2.js";import"./chunk-NGCCVO7F.js";import{a as N}from"./chunk-FKMOXKLG.js";import"./chunk-KPPNJCJB.js";import"./chunk-LVE7ORJF.js";import{E as O,F as $}from"./chunk-3FBU7QO2.js";import{Aa as d,Cb as I,Ea as k,F as D,Fa as _,Ha as F,Hb as T,Ib as E,Ra as u,Sa as x,Wa as C,X as y,Xa as a,Ya as o,Za as p,aa as h,ba as f,bb as b,cc as j,db as S,eb as c,fc as J,sb as s,va as m,wc as M}from"./chunk-7XF6BO2U.js";function ne(t,i){if(t&1){let n=b();a(0,"div",2),s(1,"Please complete "),a(2,"a",7),S("click",function(){h(n);let r=c(2);return f(r.goToExpEdit(r.assay.id,"MeasurementSection"))}),s(3,"Measurement details"),o(),s(4," to get access to the secondary data "),o()}}function oe(t,i){if(t&1){let n=b();a(0,"div",5)(1,"label",8)(2,"a",9),S("click",function(){h(n);let r=c(2);return f(r.exportDataView())}),a(3,"i",10),s(4,"save_alt"),o(),a(5,"span",11),s(6,"Download"),o()(),s(7," current view "),o(),a(8,"label",8)(9,"a",12),S("click",function(){h(n);let r=c(2);return f(r.exportFullData())}),a(10,"i",10),s(11,"save_alt"),o(),a(12,"span",11),s(13,"Download"),o()(),s(14," full "),o()()}}function ae(t,i){if(t&1&&p(0,"bd2-ts-plots",6),t&2){let n=c(2);C("tracesPerPlot",n.tracesPerPlot)("data",n.timeseries)}}function se(t,i){if(t&1){let n=b();a(0,"div")(1,"h3"),s(2,"Show timeseries"),o(),p(3,"hr"),a(4,"bd2-tsdisplay-params-rform",0),S("displayParams",function(r){h(n);let l=c();return f(l.displayChanged(r))}),o(),a(5,"mat-expansion-panel")(6,"mat-expansion-panel-header")(7,"mat-panel-title"),s(8," Sorting "),o()(),p(9,"bd2-tssort-params-rform",1),T(10,"async"),T(11,"async"),o(),u(12,ne,5,0,"div",2),p(13,"hr"),a(14,"div",3),s(15," Hint: Click on legend labels to remove individual timeseries from the plot. "),o(),a(16,"div",4),u(17,oe,15,0,"div",5),o(),p(18,"hr"),u(19,ae,1,2,"bd2-ts-plots",6),o()}if(t&2){let n=c();m(4),C("disabled",n.disabledSecondary)("totalTraces",n.totalTraces)("currentPage",n.currentPage),m(5),C("ppaJobs",E(10,8,n.analysis.ppaJobs$))("rhythmJobs",E(11,10,n.analysis.rhythmJobs$)),m(3),x(n.disabledSecondary?12:-1),m(5),x(n.timeseries?17:-1),m(2),x(n.timeseries?19:-1)}}var te=(()=>{let i=class i extends H{constructor(e,r,l,w,P){super(P),this.analysis=e,this.fetcher=r,this.RDMSocial=l,this.analytics=w,this.timeseries=[],this.totalTraces=0,this.currentPage=L.firstPage(),this.tracesPerPlot=5,this.blocked=!1,this.disabledSecondary=!1,this.csvExporter=new q,e.allowedPPAMethods=["NLLS","MESA"],this.titlePart=" Data"}ngOnInit(){super.ngOnInit(),this.timeSeriesSubsripction=this.fetcher.seriesPackStream.pipe(D(1e3)).subscribe(e=>{if(!this.assay)return;let r=e.data;this.currentParams=e.params,this.timeseries=r,this.tracesPerPlot=Math.max(5,r.length/20),this.totalTraces=e.totalTraces,this.currentPage=e.currentPage,this.analytics.experimentDataView(this.assay.id)},e=>{console.log("Error in TS subscription: "+e),this.feedback.error(e)}),this.fetcher.error$.subscribe(e=>this.feedback.error(e))}ngOnDestroy(){this.timeSeriesSubsripction&&this.timeSeriesSubsripction.unsubscribe(),this.fetcher.ngOnDestroy(),super.ngOnDestroy()}displayChanged(e){this.fetcher.changeDisplayParams(e)}exportDataView(){let e=this.fetcher.current;this.exportSeriesPack(e)}exportFullData(){this.fetcher.getFullDataSet(this.assay,this.fetcher.current.params,this.fetcher.current.sorting).subscribe(e=>{this.exportSeriesPack(e,!0)})}exportSeriesPack(e,r=!1){if(!e)return;let l=this.csvExporter.renderCSVTable(e.data,e.params,e.currentPage,e.sorting,this.assay),w=new Blob([l],{type:"text/csv"}),P=r?".full":`.page${e.currentPage.pageIndex+1}`,re={fileName:`${this.assay.id}_data.${e.params.detrending.name}${P}.csv`,extensions:[".csv"]};z(w,re).then(V=>{this.recordExport()}).catch(V=>console.log("could not save export",V))}recordExport(){this.analytics.experimentDataExport(this.assay.id)}updateModel(e){super.updateModel(e),this.RDMSocial.canProceedByMeasurement(e).then(r=>{r?this.disabledSecondary=!1:this.disabledSecondary=!0}),this.fetcher.experiment(e),this.analysis.experiment(e)}};i.\u0275fac=function(r){return new(r||i)(d(g),d(v),d(B),d(N),d(A))},i.\u0275cmp=k({type:i,selectors:[["ng-component"]],standalone:!1,features:[I([v,g]),F],decls:1,vars:1,consts:[[3,"displayParams","disabled","totalTraces","currentPage"],[3,"ppaJobs","rhythmJobs"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert","dismissible","true","dismissOnTimeout","20000",1,"alert","alert-info"],[1,"clearfix"],[1,"float-right"],[3,"tracesPerPlot","data"],[3,"click"],[1,"mr-4"],["download","","role","button","aria-label","download",1,"btn","btn-primary",2,"color","white",3,"click"],[1,"material-icons","bd-icon"],[1,"cdk-visually-hidden"],["download","","role","button","aria-label","download whole",1,"btn","btn-primary",2,"color","white",3,"click"]],template:function(r,l){r&1&&u(0,se,20,12,"div"),r&2&&x(l.assay?0:-1)},dependencies:[R,G,K,Q,U,W,j],encapsulation:2});let t=i;return t})();var le=[{path:"",children:[{path:"view/ts",component:te},{path:"view/heatmap",loadChildren:()=>import("./chunk-6PQATGSN.js").then(t=>t.TsHeatmapModule)},{path:"ts-old-import",loadChildren:()=>import("./chunk-LJRG7X5R.js").then(t=>t.TsOldImportModule)},{path:"ts-import",loadChildren:()=>import("./chunk-QZHJNGB2.js").then(t=>t.TsImportModule)}]}],ie=(()=>{let i=class i{};i.\u0275fac=function(r){return new(r||i)},i.\u0275mod=_({type:i}),i.\u0275inj=y({imports:[M.forChild(le),M]});let t=i;return t})();var Re=(()=>{let i=class i{};i.\u0275fac=function(r){return new(r||i)},i.\u0275mod=_({type:i}),i.\u0275inj=y({imports:[J,O,$,Z,Y,ie,X]});let t=i;return t})();export{Re as TsDataModule};
