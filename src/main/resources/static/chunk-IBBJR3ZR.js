import{d as m,i as f}from"./chunk-5ROL4OYM.js";import{g as d,i as b}from"./chunk-2KOYKWRC.js";import{R as c,U as p,i as u,j as a}from"./chunk-BWZCNJMV.js";var n=class{constructor(t){this.rows=new Map,this.nextColumn=0,this.sorted=!0,t!=null&&(this.sorted=t)}get width(){return this.nextColumn}get size(){return this.rows.size}append(t,e){this.put(t,e,this.nextColumn)}put(t,e,i){this._put(t,e,i),this.nextColumn=Math.max(this.nextColumn,i+1)}putColumn(t,e,i){t.forEach((r,s)=>{this._put(r,e[s],i)}),this.nextColumn=Math.max(this.nextColumn,i+1)}appendColumn(t,e){this.putColumn(t,e,this.nextColumn)}getValue(t,e){let i=this.rows.get(t);if(i)return i[e]}getRow(t){return this.rows.get(t)}forEach(t){this.keys().forEach((e,i)=>{let r={key:e,columns:this.rows.get(e)};t(r,i,this)})}forEachFlat(t){this.keys().forEach((e,i)=>{let r=[e].concat(this.rows.get(e));t(r,i,this)})}keys(){return this.sorted?Array.from(this.rows.keys()).sort((t,e)=>t==e?0:t<e?-1:1):Array.from(this.rows.keys())}_put(t,e,i){let r=this.rows.get(t);r||(r=[],this.rows.set(t,r)),r[i]=e}};var y=class{constructor(){this.SEP=","}renderCSVTable(t,e,i,r,s){let o=this.prepareHeaders(s,e,i,r,t.length);this.appendDataLabels(o,t);let g=this.prepareDataTable(t),l=this.mapToString(o,this.SEP);return l+=this.mapToString(g,this.SEP),l}prepareHeaders(t,e,i,r,s){let o=this.prepareExpHeaders(t);return this.appendDisplayProperties(o,e),this.appendSortingProperties(o,r),this.appendDataProperties(o,s,i),o}prepareExpHeaders(t){let e=new n(!1);return e.put("Exp Id:",""+t.id,0),e.put("Exp URL:","https://biodare2.ed.ac.uk/experiment/"+t.id,0),e.put("Exp Name:",t.name,0),t.contributionDesc.authors.forEach((i,r)=>{e.put("Authors:",i.name,r)}),e}appendDisplayProperties(t,e){t.put("Time range:",e.timeScaleLabel,0),t.put("Detrending:",e.detrending.label,0),e.hourly&&t.put("Hourly binned:","true",0),e.log2&&t.put("Log2 transform:",""+e.log2,0),t.put("Normalization:",e.normalisation,0),t.put("Normalization:",e.trimFirst?"within range":"whole serie",1),t.put("Align:",e.align,0)}appendSortingProperties(t,e){t.put("Sorting:",`${e.active} ${e.direction}`,0),t.put("Sorting jobs:",`${e.ppaJobId} ${e.rhythmJobId}`,0)}appendDataProperties(t,e,i){t.put("Traces",e+" of "+i.length,0);let r=Math.floor(i.length/i.pageSize)+(i.length%i.pageSize===0?0:1);t.put("Data Page",i.pageIndex+1+" of "+r,0)}appendDataLabels(t,e){e.forEach((i,r)=>{t.put("Label:",i.label,r)})}prepareDataTable(t){let e=new n;return t.forEach(i=>{let r=i.data.map(o=>o.x),s=i.data.map(o=>o.y);e.appendColumn(r,s)}),e}mapToString(t,e){let i="";return t.forEachFlat(r=>{for(let s=0;s<r.length;s++)r[s]!==void 0&&(i+=r[s]),i+=e;i+=`
`}),i}};var M=(()=>{let t=class t{constructor(i,r){this.ppa=i,this.rhythmicity=r,this.error$=new u,this.allowedPPAMethods=void 0,this.allowedRhythmMethods=void 0,this.ppaJobs=new a([]),this.rhythmJobs=new a([]),this.ppaJobs$=this.ppaJobs.asObservable(),this.rhythmJobs$=this.rhythmJobs.asObservable()}ngOnDestroy(){this.ppaJobs.complete(),this.rhythmJobs.complete()}experiment(i){this.fetchPPA(i),this.fetchRhythm(i)}fetchPPA(i){this.ppa.getPPAJobs(i).subscribe(r=>{r=r.filter(s=>m.isFinished(s)),this.allowedPPAMethods&&(r=r.filter(s=>this.allowedPPAMethods.includes(s.method))),this.ppaJobs.next(r)},r=>{this.error$.next(r),this.ppaJobs.next([])})}fetchRhythm(i){this.rhythmicity.getJobs(i).subscribe(r=>{r=r.filter(s=>d.isFinished(s)),this.allowedRhythmMethods&&(r=r.filter(s=>this.allowedRhythmMethods.includes(s.parameters.METHOD))),this.rhythmJobs.next(r)},r=>{this.error$.next(r),this.rhythmJobs.next([])})}};t.\u0275fac=function(r){return new(r||t)(p(f),p(b))},t.\u0275prov=c({token:t,factory:t.\u0275fac});let h=t;return h})();export{y as a,M as b};
