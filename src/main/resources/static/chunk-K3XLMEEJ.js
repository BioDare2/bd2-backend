import{a as fe}from"./chunk-EDOAR6V4.js";import{a as de,b as he}from"./chunk-VUPIMN6E.js";import{a as me,b as ue}from"./chunk-LVE7ORJF.js";import{E as pe,h as le,l as ce}from"./chunk-3FBU7QO2.js";import{Aa as b,Ac as oe,Ea as u,Fa as I,Hb as h,Ib as m,Jb as ie,Pa as Q,Ra as D,Sa as C,Ta as F,Tb as se,Ua as k,Va as O,W as K,Wa as f,X as w,Xa as l,Ya as a,Z as z,Za as d,a as L,db as V,dc as ne,eb as x,ec as E,fc as re,la as W,lc as ae,pb as Z,qb as J,sa as $,sb as o,ta as H,tb as P,ub as y,va as c,vb as Y,wc as A,xb as X,yb as ee,zb as te}from"./chunk-7XF6BO2U.js";var v=(()=>{let e=class e{constructor(i){this.BD2REST=i}getUsageData(){return this.BD2REST.getUsageData()}};e.\u0275fac=function(n){return new(n||e)(z(oe))},e.\u0275prov=K({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Ce(t,e){t&1&&d(0,"div",2)}function xe(t,e){if(t&1&&(l(0,"tr")(1,"td"),o(2),a(),l(3,"td"),o(4),h(5,"number"),a()()),t&2){let r=e.$implicit;c(2),P(r.country),c(2),P(m(5,2,r.activeUsers))}}var ge=(()=>{let e=class e{constructor(i,n){this.usagedataService=i,this.cdr=n,this.API_KEY=fe.googleAnalyticsApiKey,this.chartDrawn=!1,this.topCountries=[]}ngOnInit(){this.fetchAnalyticsData()}ngAfterViewChecked(){this.analyticsData&&!this.chartDrawn&&document.getElementById("chart_div")&&(this.drawChart(this.analyticsData),this.chartDrawn=!0)}fetchAnalyticsData(){this.analyticsSub=this.usagedataService.getUsageData().subscribe({next:i=>{console.log("API Response:",i);let n=i.analytics;this.analyticsData=n;let s=n.filter(p=>p.country!=="(not set)");this.topCountries=s.sort((p,g)=>g.activeUsers-p.activeUsers).slice(0,5),this.chartDrawn=!1,this.cdr.detectChanges()},error:i=>{console.error("Error fetching analytics data:",i)}})}drawChart(i){google.charts.load("current",{packages:["geochart"],mapsApiKey:this.API_KEY}),google.charts.setOnLoadCallback(()=>{let n=[["Country","Users"]];i.forEach(g=>{n.push([g.country,g.activeUsers])});let s=google.visualization.arrayToDataTable(n),p={colorAxis:{colors:["#9fc5e8","#4374e0"]}};this.chart=new google.visualization.GeoChart(document.getElementById("chart_div")),this.chart.draw(s,p)})}ngOnDestroy(){this.analyticsSub?.unsubscribe(),this.chart&&typeof this.chart.clearChart=="function"&&(this.chart.clearChart(),this.chart=null);let i=document.getElementById("chart_div");i&&i.parentNode&&i.parentNode.removeChild(i),this.analyticsData=null}};e.\u0275fac=function(n){return new(n||e)(b(v),b(se))},e.\u0275cmp=u({type:e,selectors:[["bd2-google-analytics"]],standalone:!1,decls:24,vars:1,consts:[[1,"row"],[1,"col-sm-8"],["id","chart_div","aria-label","World map showing the number of active users per country.",2,"width","100%","height","400px"],[1,"col-sm-4"],[1,"table","table-striped"],[1,"text-right"]],template:function(n,s){n&1&&(l(0,"div")(1,"h3"),o(2,"Number of users per country"),a(),l(3,"p"),o(4,"The world-map shows the number of active users per country in the last 12 months (including non-registered users)."),d(5,"br"),o(6," The table shows the number of active users in the five countries with the most users."),a(),d(7,"br"),l(8,"div",0)(9,"div",1),D(10,Ce,1,0,"div",2),a(),l(11,"div",3)(12,"table",4)(13,"thead")(14,"tr")(15,"th"),o(16,"Country"),a(),l(17,"th"),o(18,"Active users"),a()()(),l(19,"tbody"),k(20,xe,6,4,"tr",null,F),a()(),l(22,"p",5),o(23,"(last 12 months)"),a()()()()),n&2&&(c(10),C(s.analyticsData?10:-1),c(10),O(s.topCountries))},dependencies:[E],encapsulation:2});let t=e;return t})();function Ee(t,e){if(t&1&&(l(0,"div",0),d(1,"canvas",1),a()),t&2){let r=x();c(),f("type","bar")("datasets",r.dataset)("options",r.barOptions)("labels",r.labels),Q("aria-label",r.ariaLabel)}}var be=(()=>{let e=class e{constructor(){this.barColor="rgba(75, 192, 192, 0.4)",this.barOptions={scales:{x:{type:"category",position:"bottom",stacked:!0},y:{beginAtZero:!0,stacked:!0}},plugins:{legend:{display:!0,position:"top"}}}}ngOnInit(){this.updateChart()}ngOnChanges(i){(i.publicData||i.privateData)&&this.updateChart()}updateChart(){if(this.publicData||this.privateData){console.log("Input public data:",this.publicData),console.log("Input private data:",this.privateData);let i=this.publicData&&this.publicData.length?this.publicData:this.privateData;i?this.labels=i.map(n=>n.year.toString()):this.labels=[],this.dataset=[],this.privateData&&this.privateData.length&&this.dataset.push({label:this.publicData&&this.publicData.length?`Private ${this.chartLabel}`:this.chartLabel,data:this.privateData.map(n=>n.value),backgroundColor:"rgba(128, 128, 128, 0.4)",borderColor:"rgba(128, 128, 128, 1)",borderWidth:1}),this.publicData&&this.publicData.length&&this.dataset.push({label:this.privateData&&this.privateData.length?`Public ${this.chartLabel}`:this.chartLabel,data:this.publicData.map(n=>n.value),backgroundColor:this.barColor,borderColor:this.barColor.replace("0.4","1"),borderWidth:1}),console.log("Chart labels:",this.labels),console.log("Chart dataset:",this.dataset)}}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=u({type:e,selectors:[["bd2-usage-stats-plot"]],inputs:{publicData:"publicData",privateData:"privateData",ariaLabel:"ariaLabel",chartLabel:"chartLabel",barColor:"barColor"},standalone:!1,features:[W],decls:1,vars:1,consts:[[1,"chart-container"],["baseChart","","width","auto","height","200",3,"type","datasets","options","labels"]],template:function(n,s){n&1&&D(0,Ee,2,5,"div",0),n&2&&C(s.dataset?0:-1)},dependencies:[de],styles:[".chart-container[_ngcontent-%COMP%]{width:100%;margin:0 auto}"]});let t=e;return t})();function Ie(t,e){if(t&1&&(l(0,"div"),o(1),h(2,"number"),h(3,"number"),d(4,"br"),o(5),h(6,"number"),h(7,"number"),d(8,"br"),o(9),h(10,"number"),a()),t&2){let r=x();c(),Y(" Number of experiments: ",m(2,5,r.totalSets)," (",m(3,7,r.totalPublicSets)," are public)."),c(4),Y(" Number of timeseries: ",m(6,9,r.totalSeries)," (",m(7,11,r.totalPublicSeries)," are public)."),c(4),y(" Number of registered users: ",m(10,13,r.totalUsers),". ")}}var ye=(()=>{let e=class e{constructor(i){this.usagedataService=i,this.totalSets=0,this.totalSeries=0,this.totalPublicSets=0,this.totalPublicSeries=0,this.totalUsers=0,this.usersPerYear=[],this.publicSetsPerYear=[],this.publicSeriesPerYear=[],this.privateSetsPerYear=[],this.privateSeriesPerYear=[]}ngOnInit(){this.fetchUsageStats()}fetchUsageStats(){this.usageStatsSub?.unsubscribe(),this.usageStatsSub=this.usagedataService.getUsageData().subscribe({next:i=>{console.log("API Response:",i);let n=i.year_stats;this.usageStats=i,this.totalSets=n.reduce((s,p)=>s+p.sets,0),this.totalSeries=n.reduce((s,p)=>s+p.series,0),this.totalPublicSets=n.reduce((s,p)=>s+p.public_sets,0),this.totalPublicSeries=n.reduce((s,p)=>s+p.public_series,0),this.totalUsers=n.reduce((s,p)=>s+p.users,0),this.usersPerYear=n.map(s=>({year:s.year,value:s.users})),this.publicSetsPerYear=n.map(s=>({year:s.year,value:s.public_sets})),this.publicSeriesPerYear=n.map(s=>({year:s.year,value:s.public_series})),this.privateSetsPerYear=n.map(s=>({year:s.year,value:s.sets-s.public_sets})),this.privateSeriesPerYear=n.map(s=>({year:s.year,value:s.series-s.public_series}))},error:i=>{console.error("Error fetching usage stats:",i)}})}ngOnDestroy(){this.usageStatsSub?.unsubscribe()}};e.\u0275fac=function(n){return new(n||e)(b(v))},e.\u0275cmp=u({type:e,selectors:[["bd2-usage-stats"]],standalone:!1,decls:11,vars:6,consts:[[1,"charts-container"],["chartLabel","Exp.","ariaLabel","Bar chart showing the number of public and private experiments per year.","barColor","rgba(31, 119, 180, 0.4)",3,"publicData","privateData"],["chartLabel","Series","ariaLabel","Bar chart showing the number of public and private timeseries per year.","barColor","rgba(255, 127, 14, 0.4)",3,"publicData","privateData"],["chartLabel","User Registrations","ariaLabel","Bar chart showing the number of user registrations per year.","barColor","rgba(44, 160, 44, 0.4)",3,"publicData"]],template:function(n,s){n&1&&(D(0,Ie,11,15,"div"),d(1,"br"),l(2,"p"),o(3,` The three histograms below show the number of public and private experiments, timeseries and user registrations per year.
`),a(),l(4,"div",0),d(5,"bd2-usage-stats-plot",1)(6,"bd2-usage-stats-plot",2)(7,"bd2-usage-stats-plot",3),a(),l(8,"small"),o(9," Hover on the bars to see the exact numbers. Click on the legend to hide/show the data."),d(10,"br"),a()),n&2&&(C(s.usageStats?0:-1),c(5),f("publicData",s.publicSetsPerYear)("privateData",s.privateSetsPerYear),c(),f("publicData",s.publicSeriesPerYear)("privateData",s.privateSeriesPerYear),c(),f("publicData",s.usersPerYear))},dependencies:[be,E],styles:[".charts-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;gap:10px}.charts-container[_ngcontent-%COMP%]   bd2-usage-stats-plot[_ngcontent-%COMP%]{flex:1 1 calc(33.33% - 20px);margin:0;min-width:300px}"]});let t=e;return t})();var S=function(t){return t[t.State=0]="State",t[t.Transition=1]="Transition",t[t.Sequence=2]="Sequence",t[t.Group=3]="Group",t[t.Animate=4]="Animate",t[t.Keyframes=5]="Keyframes",t[t.Style=6]="Style",t[t.Trigger=7]="Trigger",t[t.Reference=8]="Reference",t[t.AnimateChild=9]="AnimateChild",t[t.AnimateRef=10]="AnimateRef",t[t.Query=11]="Query",t[t.Stagger=12]="Stagger",t}(S||{}),ke="*";function G(t,e){return{type:S.Trigger,name:t,definitions:e,options:{}}}function T(t,e=null){return{type:S.Animate,styles:e,timings:t}}function Ae(t,e=null){return{type:S.Sequence,steps:t,options:e}}function U(t){return{type:S.Style,styles:t,offset:null}}function B(t,e,r){return{type:S.State,name:t,styles:e,options:r}}function j(t,e,r=null){return{type:S.Transition,expr:t,animation:e,options:r}}var N=class{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(e=0,r=0){this.totalTime=e+r}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let r=e=="start"?this._onStartFns:this._onDoneFns;r.forEach(i=>i()),r.length=0}},q=class{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(e){this.players=e;let r=0,i=0,n=0,s=this.players.length;s==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(p=>{p.onDone(()=>{++r==s&&this._onFinish()}),p.onDestroy(()=>{++i==s&&this._onDestroy()}),p.onStart(()=>{++n==s&&this._onStart()})}),this.totalTime=this.players.reduce((p,g)=>Math.max(p,g.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let r=e*this.totalTime;this.players.forEach(i=>{let n=i.totalTime?Math.min(1,r/i.totalTime):1;i.setPosition(n)})}getPosition(){let e=this.players.reduce((r,i)=>r===null||i.totalTime>r.totalTime?i:r,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let r=e=="start"?this._onStartFns:this._onDoneFns;r.forEach(i=>i()),r.length=0}},Oe="!";var _e=(()=>{let e=class e{constructor(){this.animationEnabled=!0,this.data={state:"default"}}ngOnInit(){}cardClicked(){this.data.state==="default"?this.data.state="flipped":this.data.state="default"}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=u({type:e,selectors:[["bd2-species-card"]],inputs:{name:"name",image:"image",alt:"alt",reference:"reference",datasets:"datasets",publicDatasets:"publicDatasets",timeseries:"timeseries",publicTimeseries:"publicTimeseries",keywords:"keywords",animationEnabled:"animationEnabled"},standalone:!1,decls:25,vars:23,consts:[["tabindex","0",1,"card",3,"click","keydown.enter"],[1,"face","back"],[1,"species"],[3,"src","alt"],[1,"reference",3,"innerHTML"],[1,"face","front"]],template:function(n,s){n&1&&(l(0,"div",0),V("click",function(){return s.cardClicked()})("keydown.enter",function(){return s.cardClicked()}),l(1,"div",1)(2,"div",2),o(3),a(),d(4,"img",3)(5,"small",4),a(),l(6,"div",5)(7,"div",2),o(8),a(),o(9),h(10,"number"),d(11,"br"),l(12,"small"),o(13),h(14,"number"),a(),o(15),h(16,"number"),d(17,"br"),l(18,"small"),o(19),h(20,"number"),a(),d(21,"br"),l(22,"b"),o(23,"Popular keywords"),a(),o(24),a()()),n&2&&(Z("transform",!s.animationEnabled&&s.data.state==="flipped"?"rotateY(180deg)":"none"),J("no-animation",!s.animationEnabled),f("@cardFlip",s.animationEnabled?s.data.state:null),c(3),P(s.name),c(),f("src",s.image,H)("alt",s.alt),c(),f("innerHTML",s.reference,$),c(3),P(s.name),c(),y(" Experiments: ",m(10,15,s.datasets)," "),c(4),y("(Public: ",m(14,17,s.publicDatasets),")"),c(2),y(" Timeseries: ",m(16,19,s.timeseries)," "),c(4),y("(Public: ",m(20,21,s.publicTimeseries),")"),c(5),y("",s.keywords," "))},dependencies:[E],styles:["[_nghost-%COMP%]{display:block;perspective:600px}.card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;box-shadow:10px 10px 43px -18px #000000bf;border-radius:20px;height:250px;width:200px;cursor:pointer;position:relative;transform-style:preserve-3d}.face[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;position:absolute;width:100%;height:100%;border-radius:inherit;backface-visibility:hidden}.face[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:90%;height:70%;object-fit:cover;border-radius:inherit}.front[_ngcontent-%COMP%]{transform:rotateY(180deg)}.back[_ngcontent-%COMP%]{transform:rotateY(0)}.reference[_ngcontent-%COMP%]{font-size:.7em}.species[_ngcontent-%COMP%]{font-style:italic;font-weight:700}.reference[_ngcontent-%COMP%]{display:block;height:3em}"],data:{animation:[G("cardFlip",[B("default",U({transform:"none"})),B("flipped",U({transform:"rotateY(180deg)"})),j("default => flipped",[T("400ms")]),j("flipped => default",[T("200ms")])])]}});let t=e;return t})();function Te(t,e){if(t&1&&d(0,"bd2-species-card",2),t&2){let r=e.$implicit,i=x();f("name",r.name)("image",r.image)("reference",r.reference)("datasets",r.sets)("publicDatasets",r.public_sets)("timeseries",r.series)("publicTimeseries",r.public_series)("keywords",r.keywords)("animationEnabled",i.animationEnabled)}}var ve=(()=>{let e=class e{constructor(i,n){this.usageDataService=i,this.http=n,this.speciesStats=[],this.speciesInfo=[],this.speciesData=[],this.animationEnabled=!0}ngOnInit(){this.loadSpeciesInfo()}loadSpeciesInfo(){this.speciesInfoSub=this.http.get("assets/species/species-info.json").subscribe({next:i=>{this.speciesInfo=i,this.fetchSpeciesStats()},error:i=>{console.error("Error loading static species info",i)}})}fetchSpeciesStats(){this.speciesStatsSub=this.usageDataService.getUsageData().subscribe({next:i=>{this.speciesStats=i.species_stats,this.speciesData=this.speciesInfo.map(n=>{let s=this.speciesStats.find(p=>p.species===n.name);return s?L(L({},n),s):n})},error:i=>{console.error("Error fetching species stats from backend",i)}})}ngOnDestroy(){this.speciesInfoSub?.unsubscribe(),this.speciesStatsSub?.unsubscribe()}};e.\u0275fac=function(n){return new(n||e)(b(v),b(ae))},e.\u0275cmp=u({type:e,selectors:[["bd2-species-cards"]],standalone:!1,decls:12,vars:1,consts:[[1,"mr-1","mt-2",3,"ngModelChange","ngModel"],[1,"species-cards"],[3,"name","image","reference","datasets","publicDatasets","timeseries","publicTimeseries","keywords","animationEnabled"]],template:function(n,s){n&1&&(l(0,"h3"),o(1,"Species on BioDare2"),a(),l(2,"p"),o(3," These 9 cards show the most common species in BioDare2, based on the number of experiments and timeseries available for each species."),d(4,"br"),o(5,` Clicking on the cards displays the number of public and private experiments and timeseries for each species (updated daily), as well as the most commonly used keywords in experiment descriptions.
`),a(),l(6,"label")(7,"mat-slide-toggle",0),te("ngModelChange",function(g){return ee(s.animationEnabled,g)||(s.animationEnabled=g),g}),o(8,"Card animation "),a()(),l(9,"div",1),k(10,Te,1,9,"bd2-species-card",2,F),a()),n&2&&(c(7),X("ngModel",s.animationEnabled),c(3),O(s.speciesData))},dependencies:[le,ce,me,_e],styles:["[_nghost-%COMP%]{display:block;perspective:600px}.card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;box-shadow:10px 10px 43px -18px #000000bf;border-radius:20px;height:250px;width:200px;cursor:pointer;position:relative;transform-style:preserve-3d}.face[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;position:absolute;width:100%;height:100%;border-radius:inherit;backface-visibility:hidden}.face[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:90%;height:70%;object-fit:cover;border-radius:inherit}.front[_ngcontent-%COMP%]{transform:rotateY(180deg)}.reference[_ngcontent-%COMP%]{font-size:.7em}.species[_ngcontent-%COMP%]{font-style:italic;font-weight:700}.species-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;padding:16px}"]});let t=e;return t})();var Se=(()=>{let e=class e{constructor(i){this.usagedataService=i}ngOnInit(){this.fetchUsageDate()}fetchUsageDate(){this.usagedataService.getUsageData().subscribe({next:i=>{console.log("API Response:",i),this.currentDate=new Date(i.timestamp)},error:i=>{console.error("Error fetching usage date:",i)}})}};e.\u0275fac=function(n){return new(n||e)(b(v))},e.\u0275cmp=u({type:e,selectors:[["bd2-usage"]],standalone:!1,decls:12,vars:4,template:function(n,s){n&1&&(l(0,"div")(1,"h2"),o(2,"BioDare2 Usage Data"),a(),o(3),h(4,"date"),d(5,"br")(6,"br")(7,"bd2-usage-stats")(8,"hr")(9,"bd2-google-analytics")(10,"hr")(11,"bd2-species-cards"),a()),n&2&&(c(3),y(" Last updated: ",ie(4,1,s.currentDate,"longDate")))},dependencies:[ge,ye,ve,ne],encapsulation:2});let t=e;return t})();var Be=[{path:"usage",component:Se}],De=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=I({type:e}),e.\u0275inj=w({imports:[A.forChild(Be),A]});let t=e;return t})();var Dt=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=I({type:e}),e.\u0275inj=w({imports:[re,he,De,pe,ue]});let t=e;return t})();export{S as a,ke as b,G as c,T as d,Ae as e,U as f,B as g,j as h,N as i,q as j,Oe as k,Dt as l};
