import{f as Ne,g as Y,h as L,i as Re,j as J,k as O,l as $,m as P,n as z,o as j,p as Le}from"./chunk-BA2JQQKV.js";import{a as ae,b as Pe,c as je,d as Ge,e as We}from"./chunk-WA7O2XOB.js";import{a as K}from"./chunk-WCGGJLHZ.js";import{a as Oe}from"./chunk-6C5IN3M7.js";import"./chunk-VOF2332S.js";import{a as H,b as V,c as B}from"./chunk-FB5T6NUV.js";import"./chunk-QDUVFCGA.js";import"./chunk-E2ZG2HAU.js";import{o as Q,s as Be}from"./chunk-I5BPRPCG.js";import"./chunk-DFK6U2UW.js";import"./chunk-K5NGWSTH.js";import{A as Me,F as Ie,a as ye,c as be,i as Fe,j as ge,k as Se,m as we,n as De,u as Ae,v as Te,w as Ve,z as ke}from"./chunk-2RPFGIFO.js";import{a as q}from"./chunk-I6T75M2J.js";import{$a as a,Ab as ie,B as te,Bb as ne,Cb as oe,Cc as Ee,Da as v,Fb as I,Gb as E,Ha as b,Ia as M,Ka as A,Na as pe,Ua as d,Va as p,Wa as F,X as me,Xa as g,Y as k,Ya as S,Za as _,_ as de,_a as r,ab as x,ba as u,ca as C,eb as h,gb as f,hb as c,hc as R,lb as _e,mb as ue,nb as Ce,rb as xe,t as le,tc as W,uc as fe,vb as l,vc as U,wb as D,wc as he,xb as T,xc as ve,ya as s,yc as re}from"./chunk-EXZ64TUM.js";var mt=()=>["/experiments"],dt=()=>["."],N=()=>({exact:!0}),pt=()=>["file"],_t=()=>["edit"],ut=()=>[".","data","view","ts"],Ct=()=>[".","data","view","heatmap"],xt=()=>["ppa/new"],ft=()=>["ppa"],Ue=()=>({exact:!1}),ht=()=>["rhythmicity"],vt=()=>[".","data","ts-import"],Et=()=>["publish"];function yt(e,i){e&1&&(r(0,"a",5),l(1,"Edit"),a()),e&2&&_("routerLink",E(2,_t))("routerLinkActiveOptions",E(3,N))}function bt(e,i){e&1&&(r(0,"a",5),l(1,"Show data"),a()),e&2&&_("routerLink",E(2,ut))("routerLinkActiveOptions",E(3,N))}function Ft(e,i){e&1&&(r(0,"a",5),l(1,"Heatmap"),a()),e&2&&_("routerLink",E(2,Ct))("routerLinkActiveOptions",E(3,N))}function gt(e,i){e&1&&(r(0,"a",5),l(1,"Period analysis"),a()),e&2&&_("routerLink",E(2,xt))("routerLinkActiveOptions",E(3,N))}function St(e,i){e&1&&(r(0,"a",5),l(1,"Period analysis"),a()),e&2&&_("routerLink",E(2,ft))("routerLinkActiveOptions",E(3,Ue))}function wt(e,i){e&1&&(r(0,"a",5),l(1,"Rhythmicity"),a()),e&2&&_("routerLink",E(2,ht))("routerLinkActiveOptions",E(3,Ue))}function Dt(e,i){if(e&1&&(r(0,"a",5),l(1),a()),e&2){let t=c(2);_("routerLink",E(3,vt))("routerLinkActiveOptions",E(4,N)),s(),T(" ",t.experiment.features.hasTSData?"Replace data":"Import data")}}function At(e,i){e&1&&(r(0,"a",5)(1,"i",6),l(2,"lock_open"),a()()),e&2&&_("routerLink",E(2,Et))("routerLinkActiveOptions",E(3,N))}function Tt(e,i){if(e&1){let t=h();r(0,"div",0)(1,"nav",1)(2,"a",2)(3,"i",3),l(4,"fast_rewind"),a()(),r(5,"a",4),f("click",function(){u(t);let n=c();return C(n.back())}),r(6,"i",3),l(7,"arrow_left"),a()(),r(8,"a",4),f("click",function(){u(t);let n=c();return C(n.refresh())}),r(9,"i",3),l(10,"refresh"),a()(),r(11,"a",5),l(12,"Overview"),a(),d(13,yt,2,4,"a",5),d(14,bt,2,4,"a",5),d(15,Ft,2,4,"a",5),d(16,gt,2,4,"a",5),d(17,St,2,4,"a",5),d(18,wt,2,4,"a",5),d(19,Dt,2,5,"a",5),r(20,"a",5),l(21,"Files"),a(),d(22,At,3,4,"a",5),a()()}if(e&2){let t=c();s(2),_("routerLink",E(13,mt)),s(9),_("routerLink",E(14,dt))("routerLinkActiveOptions",E(15,N)),s(2),p(t.experiment.security.canWrite?13:-1),s(),p(t.experiment.features.hasTSData?14:-1),s(),p(t.experiment.features.hasTSData?15:-1),s(),p(t.experiment.security.canWrite&&t.experiment.features.hasTSData&&!t.experiment.features.hasPPAJobs?16:-1),s(),p(t.experiment.features.hasPPAJobs?17:-1),s(),p(t.experiment.security.canWrite&&t.experiment.features.hasTSData||t.experiment.features.hasRhythmicityJobs?18:-1),s(),p(t.experiment.security.canWrite?19:-1),s(),_("routerLink",E(16,pt))("routerLinkActiveOptions",E(17,N)),s(2),p(t.experiment.security.isOwner||t.experiment.security.isSuperOwner?22:-1)}}var qe=(()=>{let i=class i{constructor(){this.onRefresh=new pe}refresh(){this.onRefresh.emit(!0)}back(){window.history.back()}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=b({type:i,selectors:[["bd2-experiment-navigation"]],inputs:{experiment:"experiment"},outputs:{onRefresh:"onRefresh"},standalone:!1,features:[I([])],decls:1,vars:1,consts:[[2,"margin-bottom","2em"],[1,"secondary"],[3,"routerLink"],[1,"material-icons","bd-icon"],["role","button",1,"shade",3,"click"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(n,m){n&1&&d(0,Tt,23,18,"div",0),n&2&&p(m.experiment?0:-1)},dependencies:[he,ve],encapsulation:2});let e=i;return e})();function kt(e,i){if(e&1&&(r(0,"div",1)(1,"strong"),l(2,"Open Access: "),a(),l(3," under "),r(4,"strong"),l(5),a(),l(6," license "),a()),e&2){let t=c(2);s(5),D(t.model.features.licence)}}function Mt(e,i){if(e&1&&(r(0,"span"),l(1),a()),e&2){let t=i.$implicit;s(),T("",t.name,", ")}}function It(e,i){if(e&1&&(r(0,"div",1)(1,"strong"),l(2,"Authors: "),a(),g(3,Mt,2,1,"span",null,F),a()),e&2){let t=c(2);s(3),S(t.model.contributionDesc.authors)}}function Bt(e,i){if(e&1&&(r(0,"div",0)(1,"div",1)(2,"strong"),l(3,"Purpose: "),a(),l(4),a(),d(5,kt,7,1,"div",1),d(6,It,5,0,"div",1),r(7,"div",2)(8,"strong"),l(9,"Data category: "),a(),l(10),a()()),e&2){let t=c();s(4),T(" ",t.model.generalDesc.purpose," "),s(),p(t.model.features.isOpenAccess?5:-1),s(),p(t.model.contributionDesc.authors?6:-1),s(4),T(" ",t.model.dataCategory==null?null:t.model.dataCategory.longName," ")}}var Qe=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=b({type:i,selectors:[["bd2-experiment-basic-info-view"]],inputs:{model:"model"},standalone:!1,decls:1,vars:1,consts:[[1,"summary-box"],[1,"item"],[1,"item","item-last"]],template:function(n,m){n&1&&d(0,Bt,11,4,"div",0),n&2&&p(m.model?0:-1)},encapsulation:2});let e=i;return e})();function Pt(e,i){e&1&&(r(0,"i",2),l(1,"lock_open"),a())}function jt(e,i){if(e&1){let t=h();r(0,"div")(1,"div",0)(2,"div",1)(3,"h3"),d(4,Pt,2,0,"i",2),l(5),x(6,"br"),r(7,"small"),l(8),a()()(),r(9,"div",3),x(10,"bd2-experiment-basic-info-view",4),a()(),r(11,"bd2-experiment-navigation",5),f("onRefresh",function(){u(t);let n=c();return C(n.refresh())}),a()()}if(e&2){let t=c();s(4),p(t.model.features.isOpenAccess?4:-1),s(),T(" Experiment: ",t.model.id),s(3),D(t.model.name),s(2),_("model",t.model),s(),_("experiment",t.model)}}function Gt(e,i){e&1&&(r(0,"div"),l(1," ... loading experiment "),r(2,"p"),l(3,"If just logged in try to refresh the window if the experiment is not loading."),a()())}function Wt(e,i){e&1&&(r(0,"div")(1,"h4"),l(2,"You don't have sufficient permissions to see the experiment"),a(),r(3,"p"),l(4,"Try to login"),a()())}var Ye=(()=>{let i=class i{constructor(o,n,m,y,at,st,ct,lt){this.experimentService=o,this.RDMSocial=n,this.currentExperiment=m,this.feedback=y,this.analytics=at,this.route=st,this.router=ct,this.dialogs=lt,this.isUnauthorised=!1}ngOnInit(){this.expSubscription=this.currentExperiment.experiment().pipe(te(o=>!!o)).subscribe(o=>{this.model=o,this.analytics.experimentView(o.id),this.RDMSocial.shouldShowMeasurementWarning(o).then(n=>{n&&this.showMetadataWarning()})},o=>this.feedback.error(o),()=>console.log("currentExperimentStream completed")),this.paramsSubscription=this.route.paramMap.pipe(le(o=>o.get("id")),te(o=>!!o)).subscribe(o=>this.loadExperiment(+o))}ngOnDestroy(){this.paramsSubscription&&this.paramsSubscription.unsubscribe(),this.expSubscription&&this.expSubscription.unsubscribe(),this.currentExperiment&&this.currentExperiment.close()}refresh(){this.model&&this.loadExperiment(this.model.id)}loadExperiment(o){this.experimentService.getExperiment(o).then(n=>{this.currentExperiment.push(n),this.isUnauthorised=!1}).catch(n=>{this.isUnauthorised=n.isUnauthorised,this.feedback.error(n)})}handleWarningResponse(o){console.log("Dialog: "+o)}showMetadataWarning(){this.dialogs.confirm("Metadata reminder",`
        <p>
        Please add measurements details, like technique, equipment and short description.
        </p>
        <p>
        It will improve the metadata quality and it will help you when searching for the data.
        </p>
`,"Not now").subscribe(o=>{this.RDMSocial.registerMeasurementWarning(this.model),o&&this.router.navigate(["edit"],{relativeTo:this.route,fragment:"MeasurementSection"})})}};i.\u0275fac=function(n){return new(n||i)(v(Q),v(K),v(H),v(q),v(ye),v(W),v(U),v(Oe))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],standalone:!1,features:[I([H,V])],decls:5,vars:3,consts:[[1,"card","asset-card"],[1,"card-header"],[1,"material-icons","bd-icon",2,"color","green","font-size","1.5em"],[1,"card-body"],[3,"model"],[3,"onRefresh","experiment"]],template:function(n,m){n&1&&(r(0,"div"),d(1,jt,12,5,"div"),d(2,Gt,4,0,"div"),d(3,Wt,5,0,"div"),x(4,"router-outlet"),a()),n&2&&(s(),p(m.model?1:-1),s(),p(!m.model&&!m.isUnauthorised?2:-1),s(),p(!m.model&&m.isUnauthorised?3:-1))},dependencies:[fe,qe,Qe],encapsulation:2});let e=i;return e})();function Ut(e,i){if(e&1&&(r(0,"div")(1,"h3"),l(2,"Overview of experimental details"),a(),r(3,"div",0)(4,"div",1),l(5,"General description"),a(),r(6,"div",2),x(7,"bd2-general-desc-view",3),a()(),r(8,"div",0)(9,"div",1),l(10,"Contributions"),a(),r(11,"div",2),x(12,"bd2-contr-desc-view",3),a()(),r(13,"div",0)(14,"div",1),l(15,"Biological details"),a(),r(16,"div",2),x(17,"bd2-simple-bio-desc-view",3),a()(),r(18,"div",0)(19,"div",1),l(20,"Measurement details"),a(),r(21,"div",2),x(22,"bd2-measurement-desc-view",3),a()()()),e&2){let t=c();s(7),_("model",t.assay.generalDesc),s(5),_("model",t.assay.contributionDesc),s(5),_("model",t.assay),s(5),_("model",t.assay.experimentalDetails.measurementDesc)}}var Ke=(()=>{let i=class i extends B{constructor(o){super(o)}};i.\u0275fac=function(n){return new(n||i)(v(V))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],standalone:!1,features:[I([]),A],decls:1,vars:1,consts:[[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"model"]],template:function(n,m){n&1&&d(0,Ut,23,4,"div"),n&2&&p(m.assay?0:-1)},dependencies:[L,O,P,j],encapsulation:2});let e=i;return e})();var Z=class Z{constructor(){}validate(i){let t=[];return i?((!i.species||i.species.trim()=="")&&t.push("Non empty species is required"),(!i.dataCategory||i.dataCategory.name=="NONE")&&t.push("Data category is required"),t):["Cannot validate null object"]}};Z.INSTANCE=new Z;var X=Z;var ee=class ee{constructor(){this.generalV=Ne.INSTANCE,this.contribV=Re.INSTANCE,this.bioV=X.INSTANCE}validate(i){let t=[];return t=t.concat(this.generalV.validate(i.generalDesc),this.contribV.validate(i.contributionDesc),this.bioV.validate(i)),t}};ee.INSTANCE=new ee;var G=ee;function $t(e,i){if(e&1&&(r(0,"li"),l(1),a()),e&2){let t=i.$implicit;s(),D(t)}}function zt(e,i){if(e&1&&(r(0,"div",0)(1,"ul"),g(2,$t,2,1,"li",null,F),a()()),e&2){let t=c(2);s(2),S(t.errors)}}function Ht(e,i){if(e&1){let t=h();r(0,"bd2-general-desc-form",7),f("onAccepted",function(n){u(t);let m=c(2);return C(m.saveEdits(n))})("onCancelled",function(n){u(t);let m=c(2);return C(m.hideEdits(n))}),a()}if(e&2){let t=c(2);_("blocked",t.blocked)("model",t.assay.generalDesc)}}function Kt(e,i){if(e&1&&x(0,"bd2-general-desc-view",5),e&2){let t=c(2);_("model",t.assay.generalDesc)}}function Xt(e,i){if(e&1){let t=h();r(0,"div"),x(1,"hr"),r(2,"button",8),f("click",function(){u(t);let n=c(2);return C(n.activeGeneralDescForm=!0)}),l(3,"Modify "),a()()}if(e&2){let t=c(2);s(2),_("disabled",t.activeGeneralDescForm)}}function Zt(e,i){if(e&1){let t=h();r(0,"bd2-contr-desc-form",7),f("onAccepted",function(n){u(t);let m=c(2);return C(m.saveEdits(n))})("onCancelled",function(n){u(t);let m=c(2);return C(m.hideEdits(n))}),a()}if(e&2){let t=c(2);_("blocked",t.blocked)("model",t.assay.contributionDesc)}}function ei(e,i){if(e&1&&x(0,"bd2-contr-desc-view",5),e&2){let t=c(2);_("model",t.assay.contributionDesc)}}function ti(e,i){if(e&1){let t=h();r(0,"div"),x(1,"hr"),r(2,"button",8),f("click",function(){u(t);let n=c(2);return C(n.activeContributionDescForm=!0)}),l(3,"Modify "),a()()}if(e&2){let t=c(2);s(2),_("disabled",t.activeContributionDescForm)}}function ii(e,i){if(e&1){let t=h();r(0,"bd2-simple-bio-desc-form",7),f("onAccepted",function(n){u(t);let m=c(2);return C(m.saveEdits(n))})("onCancelled",function(n){u(t);let m=c(2);return C(m.hideEdits(n))}),a()}if(e&2){let t=c(2);_("blocked",t.blocked)("model",t.assay)}}function ni(e,i){if(e&1&&x(0,"bd2-simple-bio-desc-view",5),e&2){let t=c(2);_("model",t.assay)}}function oi(e,i){if(e&1){let t=h();r(0,"div"),x(1,"hr"),r(2,"button",8),f("click",function(){u(t);let n=c(2);return C(n.activeSimpleBioDescForm=!0)}),l(3,"Modify "),a()()}if(e&2){let t=c(2);s(2),_("disabled",t.activeSimpleBioDescForm)}}function ri(e,i){if(e&1){let t=h();r(0,"bd2-measurement-desc-rform",7),f("onAccepted",function(n){u(t);let m=c(2);return C(m.saveEdits(n))})("onCancelled",function(n){u(t);let m=c(2);return C(m.hideEdits(n))}),a()}if(e&2){let t=c(2);_("blocked",t.blocked)("model",t.assay.experimentalDetails.measurementDesc)}}function ai(e,i){if(e&1&&x(0,"bd2-measurement-desc-view",5),e&2){let t=c(2);_("model",t.assay.experimentalDetails.measurementDesc)}}function si(e,i){if(e&1){let t=h();r(0,"div"),x(1,"hr"),r(2,"button",8),f("click",function(){u(t);let n=c(2);return C(n.activeMeasurementDescForm=!0)}),l(3,"Modify "),a()()}if(e&2){let t=c(2);s(2),_("disabled",t.activeMeasurementDescForm)}}function ci(e,i){if(e&1&&(r(0,"li"),l(1),a()),e&2){let t=i.$implicit;s(),D(t)}}function li(e,i){if(e&1&&(r(0,"div",0)(1,"ul"),g(2,ci,2,1,"li",null,F),a()()),e&2){let t=c(2);s(2),S(t.errors)}}function mi(e,i){if(e&1&&(r(0,"div")(1,"h3"),l(2,"Modify experiment description"),a(),d(3,zt,4,0,"div",0),r(4,"div",1)(5,"div",2),l(6,"General description"),a(),r(7,"div",3),d(8,Ht,1,2,"bd2-general-desc-form",4),d(9,Kt,1,1,"bd2-general-desc-view",5),d(10,Xt,4,1,"div"),a()(),r(11,"div",1)(12,"div",2),l(13,"Contributions"),a(),r(14,"div",3),d(15,Zt,1,2,"bd2-contr-desc-form",4),d(16,ei,1,1,"bd2-contr-desc-view",5),d(17,ti,4,1,"div"),a()(),r(18,"div",1)(19,"div",2),l(20,"Biological details"),a(),r(21,"div",3),d(22,ii,1,2,"bd2-simple-bio-desc-form",4),d(23,ni,1,1,"bd2-simple-bio-desc-view",5),d(24,oi,4,1,"div"),a()(),r(25,"div",6)(26,"div",2),l(27,"Measurement details"),a(),r(28,"div",3),d(29,ri,1,2,"bd2-measurement-desc-rform",4),d(30,ai,1,1,"bd2-measurement-desc-view",5),d(31,si,4,1,"div"),a()(),d(32,li,4,0,"div",0),a()),e&2){let t=c();s(3),p(t.errors?3:-1),s(5),p(t.activeGeneralDescForm?8:-1),s(),p(t.activeGeneralDescForm?-1:9),s(),p(t.activeGeneralDescForm?-1:10),s(5),p(t.activeContributionDescForm?15:-1),s(),p(t.activeContributionDescForm?-1:16),s(),p(t.activeContributionDescForm?-1:17),s(5),p(t.activeSimpleBioDescForm?22:-1),s(),p(t.activeSimpleBioDescForm?-1:23),s(),p(t.activeSimpleBioDescForm?-1:24),s(5),p(t.activeMeasurementDescForm?29:-1),s(),p(t.activeMeasurementDescForm?-1:30),s(),p(t.activeMeasurementDescForm?-1:31),s(),p(t.errors?32:-1)}}var Xe=(()=>{let i=class i extends B{constructor(o,n){super(n),this.route=o,this.blocked=!1,this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.titlePart=" Edit",this.validator=G.INSTANCE}ngOnInit(){super.ngOnInit(),this.route.fragment.subscribe(o=>{this.requestedSection=o,this.focusOnSection(o)})}ngAfterViewInit(){this.focusOnSection(this.requestedSection)}focusOnSection(o){if(!o)return;let n=document.getElementById(o);n&&n.scrollIntoView(),o==="MeasurementSection"&&(this.activeMeasurementDescForm=!0)}saveEdits(o){this.assay&&o&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.save(this.assay).then(n=>(this.feedback.success('Experiment: "'+n.name+'" updated.'),n)).then(n=>(this.currentExperiment.push(n),n)).then(n=>{this.blocked=!1,this.hideEdits(o)}).catch(n=>{this.blocked=!1,this.feedback.error(n)}))}hideEdits(o){this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiment",this.assay.id])}updateModel(o){this._orgModel=o,this.assay=o?o.clone():null,this.setTitle()}};i.\u0275fac=function(n){return new(n||i)(v(W),v(V))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],standalone:!1,features:[I([]),A],decls:1,vars:1,consts:[[1,"alert","alert-danger"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"blocked","model"],[3,"model"],["id","MeasurementSection",1,"card","mb-2"],[3,"onAccepted","onCancelled","blocked","model"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(n,m){n&1&&d(0,mi,33,14,"div"),n&2&&p(m.assay?0:-1)},dependencies:[Y,L,J,O,$,P,z,j],encapsulation:2});let e=i;return e})();var Ze=(()=>{let i=class i{constructor(o){this.BD2REST=o}upload(o,n){let m=new FormData;for(let y=0;y<n.length;y++)m.append("file",n[y],n[y].name);return this.BD2REST.expFileUpload(o.id,m).then(y=>y.data)}getFiles(o){return this.BD2REST.files(o.id).then(n=>n.data).then(n=>this.json2AssetsList(n)).then(n=>this.fillURLs(n,o))}fillURLs(o,n){return o.map(m=>this.fillURL(m,n))}fillURL(o,n){let m=this.BD2REST.fileURL(n.id,o.id);return o.url=m,o.versions.forEach(y=>{y.url=m+"/"+y.versionId}),o}json2AssetsList(o){return o.map(n=>Pe.deserialize(n))}};i.\u0275fac=function(n){return new(n||i)(de(Ee))},i.\u0275prov=me({token:i,factory:i.\u0275fac,providedIn:"root"});let e=i;return e})();var pi=["uploadWidget"];function _i(e,i){if(e&1){let t=h();r(0,"div")(1,"bd2-file-upload-widget",2,0),f("uploadFiles",function(n){u(t);let m=c(2);return C(m.upload(n))}),a(),x(3,"hr"),a()}if(e&2){let t=c(2);s(),_("autoReset",!1)("blocked",t.blocked)}}function ui(e,i){if(e&1&&x(0,"bd2-file-asset-view",3),e&2){let t=i.$implicit,o=c(3);_("model",t)("parentId",o.assay.id)}}function Ci(e,i){e&1&&(r(0,"div",1),l(1,' Use "Replace data" to change timeseries files. '),a())}function xi(e,i){if(e&1&&(r(0,"div")(1,"h4"),l(2,"Timeseries files"),a(),g(3,ui,1,2,"bd2-file-asset-view",3,F),d(5,Ci,2,0,"div",1),x(6,"hr"),a()),e&2){let t=c(2);s(3),S(t.tsData),s(2),p(t.assay.security.canWrite?5:-1)}}function fi(e,i){e&1&&(r(0,"div",1),l(1,' Use "Import data" to add timeseries files. '),a())}function hi(e,i){if(e&1&&x(0,"bd2-file-asset-view",3),e&2){let t=i.$implicit,o=c(3);_("model",t)("parentId",o.assay.id)}}function vi(e,i){if(e&1&&(r(0,"div")(1,"h4"),l(2,"Attachments"),a(),g(3,hi,1,2,"bd2-file-asset-view",3,F),a()),e&2){let t=c(2);s(3),S(t.attachments)}}function Ei(e,i){e&1&&(r(0,"div",1),l(1," Drag and upload files using the upload area in order to update the attachments. "),a())}function yi(e,i){if(e&1&&(r(0,"div"),d(1,_i,4,2,"div"),d(2,xi,7,1,"div"),d(3,fi,2,0,"div",1),d(4,vi,5,0,"div"),d(5,Ei,2,0,"div",1),a()),e&2){let t=c();s(),p(t.assay.security.canWrite?1:-1),s(),p(t.tsData&&t.tsData.length>0?2:-1),s(),p(!t.tsData||t.tsData.length===0?3:-1),s(),p(t.attachments&&t.attachments.length>0?4:-1),s(),p(t.assay.security.canWrite?5:-1)}}var et=(()=>{let i=class i extends B{constructor(o,n){super(n),this.attachmentsService=o,this.attachments=[],this.tsData=[],this.blocked=!1,this.titlePart=" Files"}updateModel(o){super.updateModel(o),this.refreshAttachments()}refreshAttachments(){this.attachmentsService.getFiles(this.assay).then(o=>this.setFiles(o)).catch(o=>{this.feedback.error(o)})}setFiles(o){this.tsData=o.filter(n=>n.assetType.equals(ae.TS_DATA)),this.attachments=o.filter(n=>!n.assetType.equals(ae.TS_DATA))}upload(o){console.log("Uploading "+o.length),!(!o||o.length===0)&&(this.blocked=!0,this.attachmentsService.upload(this.assay,o).then(n=>{this.uploadWidget.reset(),this.blocked=!1;let m=n.length;this.feedback.success(m+" files uploaded")}).then(()=>this.refreshModel()).catch(n=>{this.blocked=!1,this.feedback.error(n)}))}};i.\u0275fac=function(n){return new(n||i)(v(Ze),v(V))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],viewQuery:function(n,m){if(n&1&&_e(pi,5),n&2){let y;ue(y=Ce())&&(m.uploadWidget=y.first)}},standalone:!1,features:[A],decls:4,vars:1,consts:[["uploadWidget",""],["type","info","role","alert",1,"alert","alert-info"],[3,"uploadFiles","autoReset","blocked"],[3,"model","parentId"]],template:function(n,m){n&1&&(r(0,"h3"),l(1,"Attached files"),a(),x(2,"hr"),d(3,yi,6,5,"div")),n&2&&(s(3),p(m.assay?3:-1))},dependencies:[je,Ge],encapsulation:2});let e=i;return e})();function bi(e,i){if(e&1&&(r(0,"div")(1,"div",3),l(2," Experiment is already publicly available under "),r(3,"strong"),l(4),a(),l(5," licence. "),a()()),e&2){let t=c(2);s(4),D(t.assay.features.licence)}}function Fi(e,i){if(e&1&&(r(0,"option",8),l(1),a()),e&2){let t=i.$implicit;_("value",t),s(),T("",t," ")}}function gi(e,i){if(e&1){let t=h();r(0,"div")(1,"div",4),l(2," You are about to make the data public. Once they are public they cannot be made private again. "),r(3,"ul")(4,"li"),l(5,"make sure you know what you are doing"),a(),r(6,"li"),l(7,"make sure all contributors agree to public sharing"),a(),r(8,"li"),l(9,"double check the description is correct, not all changes will be possible after the publishing"),a()()(),r(10,"form",null,0)(12,"div",5)(13,"label",6),l(14,"Licence"),a(),r(15,"select",7,1),oe("ngModelChange",function(n){u(t);let m=c(2);return ne(m.licence,n)||(m.licence=n),C(n)}),g(17,Fi,2,2,"option",8,F),a()(),r(19,"div",5)(20,"label")(21,"input",9,2),oe("ngModelChange",function(n){u(t);let m=c(2);return ne(m.terms,n)||(m.terms=n),C(n)}),a(),l(23," I understand that I cannot undo this operation "),a()(),r(24,"button",10),f("click",function(){u(t);let n=c(2);return C(n.publish())}),l(25," Publish "),a()()()}if(e&2){let t=xe(11),o=c(2);s(15),ie("ngModel",o.licence),s(2),S(o.licences),s(4),ie("ngModel",o.terms),s(3),_("disabled",!t.form.valid)}}function Si(e,i){if(e&1&&(r(0,"div")(1,"h3"),l(2,"Publish experiment"),a(),d(3,bi,6,1,"div"),d(4,gi,26,3,"div"),a()),e&2){let t=c();s(3),p(t.assay.features.isOpenAccess?3:-1),s(),p(t.assay.features.isOpenAccess?-1:4)}}var tt=(()=>{let i=class i extends B{constructor(o){super(o),this.licences=["CC_BY"]}ngOnInit(){super.ngOnInit(),this.licence=this.licences[0]}publish(){this.terms&&this.licence&&this.experimentService.publish(this.assay,this.licence).then(o=>(this.feedback.success('Experiment: "'+o.name+'" published.'),o)).then(o=>(this.currentExperiment.push(o),o)).then(o=>{this.goToExpHome(o.id)}).catch(o=>{this.feedback.error(o)})}};i.\u0275fac=function(n){return new(n||i)(v(V))},i.\u0275cmp=b({type:i,selectors:[["bd2-publish-form"]],standalone:!1,features:[A],decls:1,vars:1,consts:[["publishForm","ngForm"],["licenceF","ngModel"],["fTerms","ngModel"],["type","info","role","alert",1,"alert","alert-info"],["type","danger","role","alert",1,"alert","alert-danger"],[1,"form-group"],["for","licence"],["id","licence","required","","placeholder","Select licence","name","licence",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],["type","checkbox","required","","id","terms","name","fTerms",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(n,m){n&1&&d(0,Si,5,2,"div"),n&2&&p(m.assay?0:-1)},dependencies:[De,Te,Ve,be,Ae,Fe,ge,ke,Me,we,Se],encapsulation:2});let e=i;return e})();function wi(e,i){e&1&&(r(0,"div")(1,"h4"),l(2,"You don't have permission to create experiment"),a(),r(3,"p"),l(4,"Try to login"),a()())}function Di(e,i){if(e&1){let t=h();r(0,"bd2-general-desc-form",8),f("onAccepted",function(n){u(t);let m=c(2);return C(m.hideEdits(n))})("onCancelled",function(n){u(t);let m=c(2);return C(m.hideEdits(n))}),a()}if(e&2){let t=c(2);_("model",t.assay.generalDesc)}}function Ai(e,i){if(e&1&&x(0,"bd2-general-desc-view",4),e&2){let t=c(2);_("model",t.assay.generalDesc)}}function Ti(e,i){if(e&1){let t=h();r(0,"div"),x(1,"hr"),r(2,"button",9),f("click",function(){u(t);let n=c(2);return C(n.activeGeneralDescForm=!0)}),l(3,"Modify "),a()()}if(e&2){let t=c(2);s(2),_("disabled",t.activeGeneralDescForm)}}function Vi(e,i){if(e&1){let t=h();r(0,"bd2-simple-bio-desc-form",8),f("onAccepted",function(n){u(t);let m=c(2);return C(m.hideEdits(n))})("onCancelled",function(n){u(t);let m=c(2);return C(m.hideEdits(n))}),a()}if(e&2){let t=c(2);_("model",t.assay)}}function ki(e,i){if(e&1&&x(0,"bd2-simple-bio-desc-view",4),e&2){let t=c(2);_("model",t.assay)}}function Mi(e,i){if(e&1){let t=h();r(0,"div"),x(1,"hr"),r(2,"button",9),f("click",function(){u(t);let n=c(2);return C(n.activeSimpleBioDescForm=!0)}),l(3,"Modify "),a()()}if(e&2){let t=c(2);s(2),_("disabled",t.activeSimpleBioDescForm)}}function Ii(e,i){if(e&1){let t=h();r(0,"bd2-contr-desc-form",8),f("onAccepted",function(n){u(t);let m=c(2);return C(m.hideEdits(n))})("onCancelled",function(n){u(t);let m=c(2);return C(m.hideEdits(n))}),a()}if(e&2){let t=c(2);_("model",t.assay.contributionDesc)}}function Bi(e,i){if(e&1&&x(0,"bd2-contr-desc-view",4),e&2){let t=c(2);_("model",t.assay.contributionDesc)}}function Ni(e,i){if(e&1){let t=h();r(0,"div"),x(1,"hr"),r(2,"button",9),f("click",function(){u(t);let n=c(2);return C(n.activeContributionDescForm=!0)}),l(3,"Modify "),a()()}if(e&2){let t=c(2);s(2),_("disabled",t.activeContributionDescForm)}}function Ri(e,i){if(e&1){let t=h();r(0,"bd2-measurement-desc-rform",8),f("onAccepted",function(n){u(t);let m=c(2);return C(m.hideEdits(n))})("onCancelled",function(n){u(t);let m=c(2);return C(m.hideEdits(n))}),a()}if(e&2){let t=c(2);_("model",t.assay.experimentalDetails.measurementDesc)}}function Li(e,i){if(e&1&&x(0,"bd2-measurement-desc-view",4),e&2){let t=c(2);_("model",t.assay.experimentalDetails.measurementDesc)}}function Oi(e,i){if(e&1){let t=h();r(0,"div"),x(1,"hr"),r(2,"button",9),f("click",function(){u(t);let n=c(2);return C(n.activeMeasurementDescForm=!0)}),l(3,"Modify "),a()()}if(e&2){let t=c(2);s(2),_("disabled",t.activeMeasurementDescForm)}}function Pi(e,i){if(e&1&&(r(0,"li"),l(1),a()),e&2){let t=i.$implicit;s(),D(t)}}function ji(e,i){if(e&1&&(r(0,"div",5)(1,"ul"),g(2,Pi,2,1,"li",null,F),a()()),e&2){let t=c(2);s(2),S(t.errors)}}function Gi(e,i){if(e&1){let t=h();r(0,"div")(1,"h3"),l(2,"Create experiment"),a(),r(3,"div",0)(4,"div",1),l(5,"General description"),a(),r(6,"div",2),d(7,Di,1,1,"bd2-general-desc-form",3),d(8,Ai,1,1,"bd2-general-desc-view",4),d(9,Ti,4,1,"div"),a()(),r(10,"div",0)(11,"div",1),l(12,"Biological details"),a(),r(13,"div",2),d(14,Vi,1,1,"bd2-simple-bio-desc-form",3),d(15,ki,1,1,"bd2-simple-bio-desc-view",4),d(16,Mi,4,1,"div"),a()(),r(17,"div",0)(18,"div",1),l(19,"Contributions"),a(),r(20,"div",2),d(21,Ii,1,1,"bd2-contr-desc-form",3),d(22,Bi,1,1,"bd2-contr-desc-view",4),d(23,Ni,4,1,"div"),a()(),r(24,"div",0)(25,"div",1),l(26,"Measurement details"),a(),r(27,"div",2),d(28,Ri,1,1,"bd2-measurement-desc-rform",3),d(29,Li,1,1,"bd2-measurement-desc-view",4),d(30,Oi,4,1,"div"),a()(),d(31,ji,4,0,"div",5),r(32,"button",6),f("click",function(){u(t);let n=c();return C(n.save())}),l(33,"Create"),a(),r(34,"button",7),f("click",function(){u(t);let n=c();return C(n.cancel())}),l(35,"Cancel"),a()()}if(e&2){let t=c();s(7),p(t.activeGeneralDescForm?7:-1),s(),p(t.activeGeneralDescForm?-1:8),s(),p(t.activeGeneralDescForm?-1:9),s(5),p(t.activeSimpleBioDescForm?14:-1),s(),p(t.activeSimpleBioDescForm?-1:15),s(),p(t.activeSimpleBioDescForm?-1:16),s(5),p(t.activeContributionDescForm?21:-1),s(),p(t.activeContributionDescForm?-1:22),s(),p(t.activeContributionDescForm?-1:23),s(5),p(t.activeMeasurementDescForm?28:-1),s(),p(t.activeMeasurementDescForm?-1:29),s(),p(t.activeMeasurementDescForm?-1:30),s(),p(t.errors?31:-1),s(),_("disabled",t.blocked||t.errors)}}var it=(()=>{let i=class i extends Be{constructor(o,n,m,y){super(G.INSTANCE),this.experimentService=o,this.RDMSocial=n,this.feedback=m,this.router=y,this.isUnauthorised=!1,this.blocked=!1,this.activeGeneralDescForm=!0,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!0,this.activeMeasurementDescForm=!1}ngOnInit(){this.experimentService.newDraft().then(o=>{this.assay=o}).catch(o=>{this.isUnauthorised=o.isUnauthorised,this.feedback.error(o)})}hideEdits(o){this.assay.generalDesc.name?this.activeGeneralDescForm=!1:this.activeGeneralDescForm=!0,this.assay.species&&this.assay.dataCategory?this.activeSimpleBioDescForm=!1:this.activeSimpleBioDescForm=!0,this.activeContributionDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiments"])}save(){this.assay&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.newExperiment(this.assay).then(o=>(this.feedback.success('Experiment: "'+o.name+'" created.'),o)).then(o=>this.router.navigate(["/experiment",o.id])).catch(o=>{this.blocked=!1,this.feedback.error(o)}))}getModel(){return this.assay}};i.\u0275fac=function(n){return new(n||i)(v(Q),v(K),v(q),v(U))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],standalone:!1,features:[A],decls:2,vars:2,consts:[[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],["okLabel","Accept",3,"model"],[3,"model"],[1,"alert","alert-danger"],["type","button",1,"btn","btn-primary","mr-1",3,"click","disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["okLabel","Accept",3,"onAccepted","onCancelled","model"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(n,m){n&1&&(d(0,wi,5,0,"div"),d(1,Gi,36,14,"div")),n&2&&(p(m.isUnauthorised?0:-1),s(),p(m.assay?1:-1))},dependencies:[Y,L,J,O,$,P,z,j],encapsulation:2});let e=i;return e})();var Wi=[{path:"new",pathMatch:"full",component:it},{path:":id",component:Ye,children:[{path:"",pathMatch:"full",component:Ke},{path:"edit",component:Xe},{path:"file",component:et},{path:"publish",component:tt},{path:"data",loadChildren:()=>import("./chunk-GDZZBB7R.js").then(e=>e.TsDataModule)},{path:"ppa",loadChildren:()=>import("./chunk-7TTZSVMI.js").then(e=>e.PPAModule)},{path:"rhythmicity",loadChildren:()=>import("./chunk-BKZHVT6T.js").then(e=>e.RhythmicityModule)}]}],nt=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=M({type:i}),i.\u0275inj=k({imports:[re.forChild(Wi),re]});let e=i;return e})();var ot=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=M({type:i}),i.\u0275inj=k({imports:[R,We]});let e=i;return e})();var rt=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=M({type:i}),i.\u0275inj=k({imports:[R,Ie]});let e=i;return e})();var ro=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=M({type:i}),i.\u0275inj=k({imports:[R,Le,ot,rt,nt]});let e=i;return e})();export{ro as ExperimentModule};
