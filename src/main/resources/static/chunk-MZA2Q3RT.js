import{a as kt,b as jt}from"./chunk-VUPIMN6E.js";import{a as Kt}from"./chunk-5JH2XPWW.js";import{a as Qt,b as Wt,o as Yt}from"./chunk-MFGL2POH.js";import{c as Gt,d as Ut,e as Ht}from"./chunk-ZG4MTZZ2.js";import{E as Zt,f as Vt}from"./chunk-NGCCVO7F.js";import{a as Y}from"./chunk-LVE7ORJF.js";import{D as $,E as Jt,F as qt,c as _t,e as x,h as j,i as G,m as U,n as $t,q as H,r as Bt,s as K,t as Z,u as Q,v as W,x as Lt,y as zt}from"./chunk-3FBU7QO2.js";import{Aa as N,Ac as At,B as I,C as st,Db as Ft,E as lt,Ea as E,F as mt,Fa as gt,Ga as St,Ha as bt,Hb as rt,Ib as nt,J as D,Ja as yt,Ka as V,P as dt,Pa as Pt,Q as ct,Ra as Tt,Sa as vt,T as _,Ta as O,Ua as T,Va as v,W as q,Wa as f,X as pt,Xa as s,Ya as l,Z as L,Za as b,aa as ut,ac as It,ba as ht,bb as xt,db as Dt,dc as Nt,eb as R,fc as Ot,ib as Et,j as it,jb as Rt,k as F,kb as Mt,la as ft,p as ot,qb as wt,sb as c,tb as k,u as P,v as B,va as u,vb as Ct,wb as at}from"./chunk-7XF6BO2U.js";function de(r,i){if(r&1&&(s(0,"div",1),b(1,"canvas",2),l()),r&2){let o=R();wt("compact",o.compact),u(),f("type","line")("datasets",o.dataset.traces)("options",o.chartOptions)}}var Xt=(()=>{let i=class i{constructor(){this.showLegend=!0,this.compact=!1}set data(t){this.dataset=t}ngOnInit(){this.chartOptions={responsive:!0,plugins:{legend:{display:this.showLegend,position:"top"}},scales:{x:{type:"linear",position:"bottom"}}}}chartClicked(t){}chartHovered(t){}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=E({type:i,selectors:[["bd2-ts-plot"]],inputs:{showLegend:"showLegend",compact:"compact",data:"data"},standalone:!1,decls:1,vars:1,consts:[[1,"tsplot-shell",3,"compact"],[1,"tsplot-shell"],["baseChart","","width","auto","height","200",3,"type","datasets","options"]],template:function(e,a){e&1&&Tt(0,de,2,5,"div",0),e&2&&vt(a.dataset?0:-1)},dependencies:[kt],encapsulation:2});let r=i;return r})();var M=class{constructor(i,o){this.x=i,this.y=o}},X=class{constructor(){this.fill=!1,this.data=[]}},tt=class{constructor(){this.traces=[],this.totalTraces=0}};var te=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],pe=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],w=class r{static extendPalette(i,o){(!i||i.length===0)&&(i=["black"]);let t=[];for(let e=0;e<o;e++)t.push(i[e%i.length]);return t}static palette(i){return i<=te.length?r.extendPalette(te,i):r.extendPalette(pe,i)}static toRGBA(i,o){if(i.charAt(0)!=="#")return i;let t=parseInt(i.substring(1,3),16),e=parseInt(i.substring(3,5),16),a=parseInt(i.substring(5,7),16);return`rgba(${t},${e},${a},${o})`}};function he(r,i){if(r&1&&(s(0,"h4"),c(1),l()),r&2){let o=R(),t=o.$implicit,e=o.$index;u(),Ct("",e+1,". ",t.title)}}function fe(r,i){if(r&1&&(s(0,"div",0),yt(1,he,2,2,"h4",1),b(2,"bd2-ts-plot",2),l()),r&2){let o=i.$implicit,t=R();u(),f("ngIf",!t.compact),u(),f("data",o)("showLegend",t.showLegend)("compact",t.compact),Pt("aria-label",t.ariaLabel)}}var Oe=(()=>{let i=class i{constructor(){this.tracesPerPlot=7,this.showLegend=!0,this.compact=!1,this.rawTraces=[],this.datasets=[]}setTraceStyle(t,e,a){let n=w.palette(a);if(this.compact){let C=n[e%n.length];t.fill=!1,t.borderColor=w.toRGBA(C,.8),t.borderWidth=1,t.backgroundColor=w.toRGBA(C,.2),t.pointRadius=2,t.pointHoverRadius=1,t.pointBackgroundColor=C,t.pointBorderWidth=0;return}let d=["circle","rect","triangle","rectRot","rectRounded"],m=[3,4,5,4,4],p=n[e%n.length];t.fill=!1,t.borderColor=w.toRGBA(p,.8),t.borderWidth=2,t.backgroundColor=w.toRGBA(p,.2),t.pointBackgroundColor=p,t.pointBorderColor="#ffffffff",t.pointStyle=d[e%d.length],t.pointRadius=m[e%m.length],t.pointHoverRadius=t.pointRadius+1}set data(t){this.rawTraces=t||[],this.buildDatasets()}ngOnInit(){}ngOnChanges(t){(t.compact||t.tracesPerPlot)&&this.buildDatasets()}buildDatasets(){if(!this.rawTraces.length){this.datasets=[];return}let t=this.split(this.rawTraces,this.tracesPerPlot).map(e=>{e.forEach((n,d)=>this.setTraceStyle(n,d,this.tracesPerPlot));let a=new tt;return a.traces=e,a});this.datasets=t}trackByIx(t,e){return t}split(t,e){let a=[],n=0;for(;n+e<t.length;n+=e){let d=t.slice(n,n+e);a.push(d)}return n<t.length&&a.push(t.slice(n,t.length)),a}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=E({type:i,selectors:[["bd2-ts-plots"]],inputs:{tracesPerPlot:"tracesPerPlot",showLegend:"showLegend",compact:"compact",ariaLabel:"ariaLabel",data:"data"},standalone:!1,features:[ft],decls:2,vars:0,consts:[[1,"tsplots-block"],[4,"ngIf"],[3,"data","showLegend","compact"]],template:function(e,a){e&1&&T(0,fe,3,5,"div",0,a.trackByIx,!0),e&2&&v(a.datasets)},dependencies:[It,Xt],encapsulation:2});let r=i;return r})();function ee(r){let i=r.timeStart,o=r.timeEnd;return i<0?{validTimeScale:"Start time must >= 0"}:o<0?{validTimeScale:"End time must >= 0"}:o>0&&i>=o?{validTimeScale:"Start time must be < end time"}:null}var g=class r{constructor(i,o,t,e,a,n,d=!1,m=!1,p=!1){this.detrending=t,this.normalisation=e,this.align=a,this.page=n,this.log2=d,this.trimFirst=m,this.hourly=p,this.timeScale={timeStart:i,timeEnd:o},this.page=n||r.firstPage()}get timeStart(){return this.timeScale.timeStart}get timeEnd(){return this.timeScale.timeEnd}get timeScaleLabel(){let i=""+this.timeStart;i==="0"&&(i="min");let o=""+this.timeEnd;return o==="0"&&(o="max"),`${i} to ${o}`}static firstPage(){let i=new Ut;return i.pageIndex=0,i.pageSize=50,i}static equalsPages(i,o){return i?o?i.pageIndex===o.pageIndex&&i.pageSize===o.pageSize:!1:!o}isValid(){return!(this.timeScale.timeStart<0||this.timeScale.timeEnd<0||this.timeScale.timeEnd>0&&this.timeScale.timeStart>=this.timeScale.timeEnd)}equals(i){return!(!i||!this.equalsView(i)||this.detrending!==i.detrending||!this.equalsPage(i.page))}equalsView(i){return!(!i||this.timeScale.timeStart!==i.timeScale.timeStart||this.timeScale.timeEnd!==i.timeScale.timeEnd||this.normalisation!==i.normalisation||this.align!==i.align||this.log2!==i.log2||this.trimFirst!==i.trimFirst||this.hourly!==i.hourly)}equalsPage(i){return r.equalsPages(this.page,i)}clone(){return new r(this.timeStart,this.timeEnd,this.detrending,this.normalisation,this.align,this.page,this.log2,this.trimFirst,this.hourly)}setAll(i){Object.assign(this,i),this.timeScale.timeStart=i.timeScale?i.timeScale.timeStart:i.timeStart,this.timeScale.timeEnd=i.timeScale?i.timeScale.timeEnd:i.timeEnd}};var h=class h{constructor(i,o){this._name=i,this._label=o}get name(){return this._name}get label(){return this._label}static get(i){return h.getValuesMap().get(i)}static getValuesMap(){if(!h.valuesMap){let i=new Map;h.values.forEach(o=>i.set(o.name,o)),h.valuesMap=i}return h.valuesMap}toJSON(){return this.name}equals(i){return i?this===i||this===h.get(i.name?i.name:i):!1}};h.NO_DTR=new h("NO_DTR","no dtr"),h.LIN_DTR=new h("LIN_DTR","linear dtr"),h.POLY_DTR=new h("POLY_DTR","cubic dtr"),h.BASE_DTR=new h("BASE_DTR","baseline dtr"),h.BAMP_DTR=new h("BAMP_DTR","amp&baseline dtr"),h.values=[h.NO_DTR,h.LIN_DTR,h.POLY_DTR,h.BASE_DTR,h.BAMP_DTR];var S=h,ie=[S.NO_DTR,S.LIN_DTR,S.POLY_DTR,S.BASE_DTR,S.BAMP_DTR],y=class{constructor(i,o){this.name=i,this.label=o}},z=[new y("NO_NORM","none"),new y("RANGE","to [-1,1]"),new y("FOLD","fold change"),new y("Z_SCORE","Z-Score"),new y("MAX_NORM","to extreme")],J=[new y("NONE","none"),new y("MEAN","mean"),new y("SPREAD","spread")];var ge=["PERIOD","PHASE","AMP","ERR"],Se=["R_TAU","R_PVALUE","R_PEAK","R_PERIOD"];function ae(r,i){return!(!r||!i||r.active!==i.active||r.direction!==i.direction||ge.includes(r.active)&&r.ppaJobId!==i.ppaJobId||Se.includes(r.active)&&r.rhythmJobId!==i.rhythmJobId)}var be=["dataPaginator"],ne=(()=>{let i=class i{set disabled(t){t?this.mainForm.disable():this.mainForm.enable(),this._disabled=t}get disabled(){return this._disabled}constructor(t){this.fb=t,this.totalTraces=0,this.currentPage=g.firstPage(),this.displayParams=new V,this._disabled=!1,this.disabledPagination=!1,this.page$=new F(g.firstPage()),this.displayParamsForm=this.buildDisplayParamsForm(),this.mainForm=this.buildMainForm(),this.detrendingOptions=ie,this.normalisationOptions=z,this.alignOptions=J}ngOnInit(){this.initDisplayParamsStream()}ngOnDestroy(){this.displayParamsSubscription&&this.displayParamsSubscription.unsubscribe(),this.displayParams&&this.displayParams.complete()}initDisplayParamsStream(){let t=st(this.displayParamsForm.valueChanges,this.displayParamsForm.statusChanges).pipe(dt([this.displayParamsForm.value,this.displayParamsForm.status]),I(([a,n])=>n==="VALID"&&a),P(([a,n])=>a)),e=B([t,this.page$]).pipe(P(([a,n])=>new g(a.timeScale.timeStart,a.timeScale.timeEnd,S.get(a.detrending),a.normalisation,a.align,n,a.log2,a.trimFirst,a.hourly)),I(a=>a.isValid()),D((a,n)=>n.equals(a)));this.displayParamsSubscription=e.subscribe(a=>this.displayParams.next(a))}buildDisplayParamsForm(){return this.fb.group({timeScale:this.fb.group({timeStart:[0,[x.required]],timeEnd:[0,[x.required]]},{validator:t=>ee(t.value)}),detrending:[this.defaultDetrending(),[x.required]],normalisation:[z[0].name,[x.required]],align:[J[0].name,[x.required]],log2:[!1],trimFirst:[!0],hourly:[!1]})}defaultDetrending(){return S.LIN_DTR.name}buildMainForm(){return this.displayParamsForm}loadDataPage(t){this.page$.next(t)}ngAfterViewInit(){this.dataPaginator&&(this.dataPaginator._intl=new Gt,this.dataPaginator._intl.itemsPerPageLabel="Series per page")}};i.\u0275fac=function(e){return new(e||i)(N($))},i.\u0275dir=St({type:i,viewQuery:function(e,a){if(e&1&&Et(be,7),e&2){let n;Rt(n=Mt())&&(a.dataPaginator=n.first)}}});let r=i;return r})();var Pe=()=>[10,25,50,100,200];function Te(r,i){if(r&1&&(s(0,"option",16),c(1),l()),r&2){let o=i.$implicit;f("value",o.name),u(),k(o.label)}}function ve(r,i){if(r&1&&(s(0,"option",16),c(1),l()),r&2){let o=i.$implicit;f("value",o.name),u(),k(o.label)}}function xe(r,i){if(r&1&&(s(0,"option",16),c(1),l()),r&2){let o=i.$implicit;f("value",o.name),u(),k(o.label)}}var Qe=(()=>{let i=class i extends ne{constructor(t){super(t)}};i.\u0275fac=function(e){return new(e||i)(N($))},i.\u0275cmp=E({type:i,selectors:[["bd2-tsdisplay-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},standalone:!1,features:[bt],decls:50,vars:7,consts:[["dataPaginator",""],["role","form",1,"form-horizontal","container",3,"formGroup"],[1,"row"],[1,"col-md-8","col-sm-10"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-md-3","col-sm-3"],["for","timeStart",1,"col-md-1","col-sm-2"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-md-1","col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"col-md-2","col-sm-4"],["formControlName","hourly",1,"mr-3"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-3"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value"],[1,"col-sm-1"],["for","align",1,"col-sm-1"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-2"],["for","normalisation"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],[1,"col-sm"],["formControlName","trimFirst",1,"mr-3"],["formControlName","log2"],[1,"col-sm-8"],[3,"page","length","disabled","pageSize","pageIndex","pageSizeOptions"]],template:function(e,a){if(e&1){let n=xt();s(0,"form",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"label",5),c(5,"Time range"),l(),s(6,"label",6),c(7,"from:"),l(),s(8,"div",5),b(9,"input",7),l(),s(10,"label",8),c(11,"to:"),l(),s(12,"div",5),b(13,"input",9),l()()(),s(14,"div",10)(15,"mat-slide-toggle",11),c(16,"hourly"),l()()(),s(17,"div",12)(18,"label",13),c(19,"Detrending"),l(),s(20,"div",14)(21,"select",15),T(22,Te,2,2,"option",16,O),l()(),b(24,"div",17),s(25,"label",18),c(26,"Align"),l(),s(27,"div",14)(28,"select",19),T(29,ve,2,2,"option",16,O),l()()(),s(31,"div",12)(32,"div",20)(33,"label",21),c(34,"Normalize"),l()(),s(35,"div",14)(36,"select",22),T(37,xe,2,2,"option",16,O),l()(),s(39,"div",23)(40,"mat-slide-toggle",24),c(41,"within range"),l(),s(42,"mat-slide-toggle",25),c(43,"log2 transf."),l()()(),b(44,"div",12),s(45,"div",12),b(46,"label",20),s(47,"div",26)(48,"mat-paginator",27,0),Dt("page",function(m){return ut(n),ht(a.loadDataPage(m))}),l()()()()}e&2&&(f("formGroup",a.mainForm),u(22),v(a.detrendingOptions),u(7),v(a.alignOptions),u(8),v(a.normalisationOptions),u(11),f("length",a.totalTraces)("disabled",a.disabledPagination)("pageSize",a.currentPage.pageSize)("pageIndex",a.currentPage.pageIndex)("pageSizeOptions",Ft(6,Pe)))},dependencies:[U,Q,W,_t,$t,Z,j,G,zt,Lt,H,K,Bt,Ht,Y],encapsulation:2});let r=i;return r})();var oe=(()=>{let i=class i{constructor(t){this.BD2REST=t}loadDataSet(t,e,a,n){return this.BD2REST.tsdata(t.id,e,a,n)}loadHourlyDataSet(t,e,a,n){return this.BD2REST.tsHourlyData(t.id,e,a,n)}exportURL(t,e){return this.BD2REST.tsdataExportURL(t.id,e.detrending)}dataMetrics(t){return this.BD2REST.tsdataMetrics(t.id)}};i.\u0275fac=function(e){return new(e||i)(L(At))},i.\u0275prov=q({token:i,factory:i.\u0275fac,providedIn:"root"});let r=i;return r})();var et=class{constructor(i,o,t=0,e=g.firstPage(),a){this.params=i,this.data=o,this.totalTraces=t,this.currentPage=e,this.sorting=a}},se=(()=>{let i=class i{constructor(t,e=!1){this.tsDataService=t,this.error$=new it,this.loading$=new it,this.addTraceNr=!0,this.addTraceRef=!0,this.dataSetsStream=new F(void 0),this.sortStream=new F({}),this.experiment$=new F(void 0);let a=new g(0,0,S.LIN_DTR,z[0].name,J[0].name,g.firstPage());this.displayParamsStream=new F(a),e?this.slowParameters$=this.displayParamsStream.pipe(I(n=>!!n)):this.slowParameters$=this.displayParamsStream.pipe(mt(400),I(n=>!!n)),this.initObservables()}changeDisplayParams(t){this.displayParamsStream.next(t)}experiment(t){this.experiment$.next(t)}sort(t){t&&this.sortStream.next(t)}ngOnDestroy(){this.displayParamsStream.complete(),this.sortStream.complete(),this.dataSetsStream.complete(),this.error$.complete(),this.experiment$.complete(),this.loading$.complete()}initObservables(){this.initDataSetsStream(),this.seriesPackStream=this.initSeriesPackStream(this.dataSetsStream)}initDataSetsStream(){let t=this.slowParameters$.pipe(P(m=>m.page),D((m,p)=>g.equalsPages(m,p))),e=this.experiment$.pipe(I(m=>!!m)),a=this.slowParameters$.pipe(P(m=>m.detrending),D((m,p)=>p.equals(m))),n=this.slowParameters$.pipe(P(m=>m.hourly),D()),d=this.sortStream.pipe(D(ae));B([e,a,n,t,d]).pipe(_(m=>this.loading$.next(!0)),ct(([m,p,C,le,me])=>this.loadDataSet(m,p,C,le,me)),_(m=>this.loading$.next(!1))).subscribe(m=>this.dataSetsStream.next(m),m=>console.log("Error should not propagate here",m))}initSeriesPackStream(t){let e=this.slowParameters$.pipe(D((a,n)=>n.equalsView(a)));return B([t,e]).pipe(P(([a,n])=>this.processDataSet(a,n)),_(a=>this.current=a))}loadDataSet(t,e,a,n,d){let m;return a?m=this.tsDataService.loadHourlyDataSet(t,e,n,d):m=this.tsDataService.loadDataSet(t,e,n,d),m.pipe(_(p=>{p.detrending=p.detrending||e,p.sort=d}),_(p=>p.traces.forEach(C=>this.enrichLabel(C,this.addTraceNr,this.addTraceRef))),lt(p=>(console.log("Caught error",p),this.error$.next(p),ot(void 0))))}enrichLabel(t,e,a){e&&a?t.label=`${t.traceNr}.${t.traceRef} ${t.label}`:e&&(t.label=`${t.traceNr}. ${t.label}`)}getFullDataSet(t,e,a){let n={pageIndex:0,pageSize:5e4};return e=e.clone(),e.timeScale.timeStart=0,e.timeScale.timeEnd=0,this.loadDataSet(t,e.detrending,e.hourly,n,a).pipe(P(d=>this.processDataSet(d,e)))}processDataSet(t,e){if(t){let a=this.processDataTraces(t.traces,e);return e=e.clone(),e.detrending=t.detrending,new et(e,a,t.totalTraces,t.currentPage,t.sort)}else return new et(e,[],0,g.firstPage(),{})}processDataTraces(t,e){return e.trimFirst&&(t=this.trimData(t,e)),t=this.logData(t,e),t=this.normalizeData(t,e),e.trimFirst||(t=this.trimData(t,e)),t=this.alignData(t,e),t}normalizeData(t,e){return t.map(a=>this.normalizeTrace(a,e))}normalizeTrace(t,e){switch(e.normalisation){case"MEAN_NORM":return this.normalizeTraceToMean(t);case"MAX_NORM":return this.normalizeTraceToMax(t);case"RANGE":return this.normalizeTraceToRange(t);case"FOLD":return this.normalizeTraceToFoldChange(t);case"Z_SCORE":return this.normalizeTraceToZScore(t);default:return t}}normalizeTraceToMean(t){return this.normalizeTraceToFactor(t,t.mean)}normalizeTraceToMax(t){return this.normalizeTraceToFactor(t,Math.max(t.max,-t.min))}normalizeTraceToFactor(t,e){if(e===0)return t;let a=this.copyTrace(t);return a.data=t.data.map(n=>new M(n.x,n.y/e)),a.min=t.min/e,a.max=t.max/e,a.mean=t.mean/e,a}normalizeTraceToRange(t){let e=this.copyTrace(t),a=t.mean,n=Math.max(t.max-t.mean,Math.abs(t.min-t.mean));return e.data=t.data.map(d=>new M(d.x,(d.y-a)/n)),e.min=(t.min-a)/n,e.max=(t.max-a)/n,e.mean=0,e}normalizeTraceToFoldChange(t){return t.min>0?this.normalizeTraceToFactor(t,t.min):this.emptyTrace(t)}normalizeTraceToZScore(t){if(t.data.length<2)return t;let e=t.data.reduce((m,p)=>m+p.y,0)/t.data.length,a=t.data.reduce((m,p)=>m+Math.pow(p.y-e,2),0),n=Math.sqrt(a/(t.data.length-1)),d=this.copyTrace(t);return d.data=t.data.map(m=>new M(m.x,(m.y-e)/n)),this.updateMinMax(d),d}emptyTrace(t){let e=this.copyTrace(t);return e.data=[],e.min=NaN,e.max=NaN,e.mean=NaN,e}copyTrace(t){return Object.assign(new X,t)}logData(t,e){return e.log2?t.map(a=>this.logTrace(a)):t}logTrace(t){let a=this.copyTrace(t);return a.data=t.data.filter(n=>n.y>=0).map(n=>new M(n.x,Math.log2(n.y+.015625))),this.updateMinMax(a),a}alignData(t,e){return e.align==="MEAN"?t.map(a=>this.zeroTrace(a)):e.align==="SPREAD"?this.spreadMeans(t):t}zeroTrace(t){return this.subTrace(t,t.mean)}subTrace(t,e){let a=this.copyTrace(t);return a.data=t.data.map(n=>new M(n.x,n.y-e)),a.min=t.min-e,a.max=t.max-e,a.mean=t.mean-e,a}trimData(t,e){return t.map(a=>this.trimTrace(a,e)).filter(a=>a.data.length>0)}trimTrace(t,e){if(e.timeStart===0&&e.timeEnd===0)return t;let a=this.copyTrace(t),n=0;if(e.timeStart!==0)for(;n<t.data.length&&!(t.data[n].x>=e.timeStart);n++);let d=t.data.length-1;if(e.timeEnd!==0)for(;d>=0&&!(t.data[d].x<=e.timeEnd);d--);return d++,a.data=t.data.slice(n,d),this.updateMinMax(a),a}spreadMeans(t){let e=[],a=0,n=0;return t.forEach(d=>{let m=Math.max(n,d.mean-d.min),p=a+m;n=d.max-d.mean,e.push(this.subTrace(d,d.mean-p)),a=p}),e}updateMinMax(t){let e=this.minMaxMean(t.data);t.min=e.min,t.max=e.max,t.mean=e.mean}minMaxMean(t){let e={min:NaN,max:NaN,mean:NaN};return t.length===0||(e.min=t[0].y,e.max=t[0].y,e.mean=0,t.forEach(a=>{let n=a.y;n<e.min&&(e.min=n),n>e.max&&(e.max=n),e.mean+=n}),e.mean=e.mean/t.length),e}};i.\u0275fac=function(e){return new(e||i)(L(oe),L(Kt,8))},i.\u0275prov=q({token:i,factory:i.\u0275fac});let r=i;return r})();function Re(r,i){if(r&1&&(s(0,"option",11),c(1),rt(2,"date"),l()),r&2){let o=i.$implicit,t=R();f("value",o.jobId),u(),at(" ",o.method,": ",t.shortUUID(o.jobId)," (",nt(2,4,t.toLocalDateTime(o.submitted)),") ")}}function Me(r,i){if(r&1&&(s(0,"option",11),c(1),rt(2,"date"),l()),r&2){let o=i.$implicit,t=R();f("value",o.jobId),u(),at(" ",t.friendlyRhythmMethod(o.parameters.METHOD),": ",t.shortUUID(o.jobId)," (",nt(2,4,t.toLocalDateTime(o.jobStatus.submitted)),") ")}}var hi=(()=>{let i=class i{set rhythmJobs(t){this._rhythmJobs=t,this.noRhythm=!t||t.length<1,this.sortParamsForm.get("rhythmJobId").setValue(this.noRhythm?void 0:t[0].jobId)}get rhythmJobs(){return this._rhythmJobs}set ppaJobs(t){this._ppaJobs=t,this.noPPA=!t||t.length<1,this.sortParamsForm.get("ppaJobId").setValue(this.noPPA?void 0:t[0].jobId)}get ppaJobs(){return this._ppaJobs}constructor(t,e){this.fb=t,this.fetcher=e,this.sorting=new V,this.noPPA=!0,this.noRhythm=!0,this._rhythmJobs=[],this._ppaJobs=[],this.sortParamsForm=this.buildSortParamsForm(t),this.mainForm=this.buildMainForm(this.sortParamsForm,t),this.ppaJobs=[],this.rhythmJobs=[]}ngOnInit(){this.valuesSubscription=this.mainForm.valueChanges.subscribe(t=>{let e=t;e.direction=t.isAscending?"asc":"desc",this.sorting.next(e),this.fetcher&&this.fetcher.sort(e)})}ngOnDestroy(){this.valuesSubscription&&this.valuesSubscription.unsubscribe(),this.sorting&&this.sorting.complete()}buildSortParamsForm(t){return t.group({active:[this.defaultSorting(),[x.required]],isAscending:[!0,[x.required]],ppaJobId:[],rhythmJobId:[]})}buildMainForm(t,e){return t}defaultSorting(){return"NR"}shortUUID(t){return Zt(t)}toLocalDateTime(t){return Vt.deserialize(t).date}friendlyRhythmMethod(t){return t==="BD2JTK"?"JTK":t==="BD2EJTK"?"eJTK":t}};i.\u0275fac=function(e){return new(e||i)(N($),N(se,8))},i.\u0275cmp=E({type:i,selectors:[["bd2-tssort-params-rform"]],inputs:{rhythmJobs:"rhythmJobs",ppaJobs:"ppaJobs"},outputs:{sorting:"sorting"},standalone:!1,decls:44,vars:8,consts:[[1,"container"],["role","form",3,"formGroup"],["aria-label","Sorting options","formControlName","active"],[1,"row","mb-1"],[1,"col-lg-2"],[1,"col-lg-4"],["formControlName","isAscending"],[1,"col-lg-5"],["value","NR"],["value","LABEL"],["id","ppa","aria-label","Select period analysis","formControlName","ppaJobId",1,"form-control"],[3,"value"],["value","PERIOD",3,"disabled"],["value","PHASE",3,"disabled"],["value","AMP",3,"disabled"],["value","ERR",3,"disabled"],["id","rhythm","aria-label","Select rhythmicity test","formControlName","rhythmJobId",1,"form-control"],["value","R_TAU",3,"disabled"],["value","R_PEAK",3,"disabled"],["value","R_PERIOD",3,"disabled"]],template:function(e,a){e&1&&(s(0,"div",0)(1,"form",1)(2,"mat-radio-group",2)(3,"div",3)(4,"label",4),c(5,"Sort"),l(),s(6,"div",5)(7,"mat-slide-toggle",6),c(8,"asc."),l()(),s(9,"div",7)(10,"mat-radio-button",8),c(11,"nr."),l(),s(12,"mat-radio-button",9),c(13,"label"),l()()(),s(14,"div",3)(15,"label",4),c(16,"PPA Analysis"),l(),s(17,"div",5)(18,"select",10),T(19,Re,3,6,"option",11,O),l()(),s(21,"div",7)(22,"mat-radio-button",12),c(23,"period"),l(),s(24,"mat-radio-button",13),c(25,"phase"),l(),s(26,"mat-radio-button",14),c(27,"amp."),l(),s(28,"mat-radio-button",15),c(29,"err"),l()()(),s(30,"div",3)(31,"label",4),c(32,"Rhythmicity Test"),l(),s(33,"div",5)(34,"select",16),T(35,Me,3,6,"option",11,O),l()(),s(37,"div",7)(38,"mat-radio-button",17),c(39,"signif."),l(),s(40,"mat-radio-button",18),c(41,"peak"),l(),s(42,"mat-radio-button",19),c(43,"length"),l()()()()()()),e&2&&(u(),f("formGroup",a.mainForm),u(18),v(a.ppaJobs),u(3),f("disabled",a.noPPA),u(2),f("disabled",a.noPPA),u(2),f("disabled",a.noPPA),u(2),f("disabled",a.noPPA),u(7),v(a.rhythmJobs),u(3),f("disabled",a.noRhythm),u(2),f("disabled",a.noRhythm),u(2),f("disabled",a.noRhythm))},dependencies:[U,Q,W,Z,j,G,H,K,Qt,Wt,Y,Nt],styles:["mat-radio-button[_ngcontent-%COMP%]{margin-right:.5em}"]});let r=i;return r})();var wi=(()=>{let i=class i{};i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=gt({type:i}),i.\u0275inj=pt({imports:[Ot,Jt,qt,jt,Yt]});let r=i;return r})();export{S as a,y as b,M as c,X as d,tt as e,w as f,Xt as g,Oe as h,g as i,se as j,ne as k,Qe as l,hi as m,wi as n};
