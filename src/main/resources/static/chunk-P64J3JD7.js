import{b as te,k as K,l as Yt,n as Zt,o as y,p as Jt}from"./chunk-ZAWAO4I2.js";import{d as Ut,e as Xt}from"./chunk-M7X7JQUQ.js";import{a as Wt,b as Ht,g as zt,j as jt,k as Qt,l as Gt,m as qt,n as Kt,o as $t}from"./chunk-THGCCJUJ.js";import{b as Nt,c as At}from"./chunk-5VP5V2NG.js";import"./chunk-ZUXWEGFT.js";import"./chunk-URHLGKLM.js";import{a as Lt,b as Et,c as Ft,d as Bt,e as Vt,f as Ot,g as Pt}from"./chunk-FDKJ75ZE.js";import{A as Pe,c as Qe,d as Ge,e as _t,n as ke,o as Me,p as Ne,q as It,r as Le,s as Ee,t as Rt,u as Fe,v as Be,w as kt,x as Ve,y as Oe,z as Mt}from"./chunk-D224IPLR.js";import{a as Ie,l as bt,n as Ct,p as St,q as wt,s as yt,t as Tt}from"./chunk-VDA2LVPM.js";import{a as Te,c as ht,g as X,i as gt,l as Re,n as xt}from"./chunk-PGRVX3MW.js";import{a as ye}from"./chunk-6KRAEQXB.js";import{E as ut,F as ft,G as M,H as Dt,I as B,J as vt,d as se,h as $,i as we,j as xe,k as mt,l as me,m as De,n as ct,p as pt,y as dt}from"./chunk-6XVRX2RL.js";import{Da as z,G as Je,Ga as f,I as et,Ia as c,Ja as q,Kb as j,L as tt,La as ae,Lb as v,M as it,Nb as lt,Qb as st,R as oe,Ra as l,S as ge,Sa as s,Ta as D,U as ee,Ua as T,Va as I,Xa as S,Xc as ve,Y as x,Z as be,_ as nt,_a as C,aa as _,ab as p,ba as g,bd as ce,fb as L,fc as je,gb as E,hb as F,i as Xe,ib as re,j as _e,ja as W,jb as m,jc as le,kb as k,kc as A,lb as b,mb as Ce,n as Ye,nb as ot,ob as V,pb as O,qb as P,ra as r,rb as Se,s as fe,sa as w,t as Ze,tb as ze,wb as at,xb as rt,z as He}from"./chunk-BWZCNJMV.js";var H=class a{constructor(i=new Ge,o=new Ge){this.rowPage=i,this.colPage=o}static firstPage(){let i=new a;return i.rowPage.pageIndex=0,i.rowPage.pageSize=50,i.colPage.pageIndex=0,i.colPage.pageSize=50,i}static pageEquals(i,o){return i.pageIndex===o.pageIndex&&i.pageSize===o.pageSize}equals(i){return i?a.pageEquals(this.rowPage,i.rowPage)&&a.pageEquals(this.colPage,i.colPage):!1}};var ti=(()=>{let i=class i{constructor(e){this.BD2REST=e}uploadFile(e){let t=new FormData;return t.append("file",e,e.name),this.BD2REST.fileUpload(t).then(n=>n.id)}};i.\u0275fac=function(t){return new(t||i)(ee(le))},i.\u0275prov=oe({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var pe=(()=>{let i=class i{constructor(e,t){this.uploadService=e,this.BD2REST=t}uploadFile(e,t){return Ye(this.uploadService.uploadFile(e)).pipe(et(n=>this.verifyFormat(t,n).pipe(fe(d=>n))))}verifyFormat(e,t){return this.BD2REST.fileViewVerifyFormat(e,t)}getTableSlice(e,t,n){return this.BD2REST.fileViewTableSlice(e,t,n)}previewLabels(e,t,n,d){let u=new H;return d?(u.rowPage.pageSize=500,u.rowPage.pageIndex=0,u.colPage.pageSize=1,u.colPage.pageIndex=n.colIx):(u.rowPage.pageSize=1,u.rowPage.pageIndex=n.rowIx,u.colPage.pageSize=500,u.colPage.pageIndex=0),this.getTableSlice(e,t,u).pipe(fe(h=>{let U=[];return h.data.forEach(Z=>Z.forEach(J=>U.push(""+J))),U}))}};i.\u0275fac=function(t){return new(t||i)(ee(ti),ee(le))},i.\u0275prov=oe({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var N=(()=>{let i=class i{constructor(e){this.tsFileService=e,this.tableSlice$=new _e(void 0),this.slice$=new _e(void 0),this.fileIdFormat$=new _e(void 0),this.error$=new Xe,this.dataSlice$=this.tableSlice$.asObservable().pipe(He(t=>t!=null&&t!==void 0)),this.initDataStream()}close(){this.slice$.complete(),this.fileIdFormat$.complete(),this.tableSlice$.complete(),this.error$.complete()}slice(e){e&&this.slice$.next(e)}fileIdFormat(e){e&&e[0]&&e[1]&&this.fileIdFormat$.next(e)}sameParams([[e,t],n],[[d,u],h]){return e==d&&t==u&&n.equals(h)}initDataStream(){Ze([this.fileIdFormat$,this.slice$]).pipe(He(([t,n])=>t&&!!n),Je(this.sameParams)).pipe(it(([t,n])=>this.tsFileService.getTableSlice(t[0],t[1],n))).subscribe(t=>this.tableSlice$.next(t),t=>this.error$.next(t))}};i.\u0275fac=function(t){return new(t||i)(ee(pe))},i.\u0275prov=oe({token:i,factory:i.\u0275fac});let a=i;return a})();function bi(a,i){if(a&1&&(l(0,"mat-option",9),m(1),s()),a&2){let o=i.$implicit;c("value",o),r(),k(o.label)}}function Ci(a,i){a&1&&(l(0,"div",10),m(1," An Excel file in which one column contains time values while other columns contain measurements taken at the corresponding times. "),l(2,"ul")(3,"li"),m(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes from start, seconds from start, or as image nr (1-based) which will be converted to time using interval between images. "),s(),l(5,"li"),m(6," Not all columns have to be imported. "),s(),l(7,"li"),m(8," First few rows can contain arbitrary text. "),s(),l(9,"li"),m(10," Values from one row can be used as data labels. "),s()()())}function Si(a,i){a&1&&(l(0,"div",10),m(1," A coma or tab separeted file in which one column or row contains time values while other columns or rows contain measurements taken at the corresponding times. "),l(2,"ul")(3,"li"),m(4," Time can be represented as: hours from start (e.g 2.25 for measurement at 2 hours 15 minutes after the start), minutes or seconds from start, or as image numbers "),s(),l(5,"li"),m(6," Not all columns/rows have to be imported. "),s(),l(7,"li"),m(8," First few rows/columns can contain arbitrary text. "),s(),l(9,"li"),m(10," Values from one row/column can be used as data labels. "),s()()())}function wi(a,i){a&1&&(l(0,"div",10),m(1," Topcount data can be uploaded in two forms: "),l(2,"ul")(3,"li"),m(4,"Individual file which contains concatenated topcount data blocks in one file"),s(),l(5,"li"),m(6,"Zip file which contains packed files from individual topcount reads"),s()(),m(7,' Check the Dosc section for details about suported data layouts inside tomcats file, we can currently read ASCI content with "plate map" or "column" layouts. '),s())}function xi(a,i){if(a&1&&(l(0,"div",11),m(1),s()),a&2){let o=p();r(),b(" ",o.formatWarning," ")}}var ii=(()=>{let i=class i{constructor(){this.blocked=!1,this.uploadFiles=new W,this.importFormatOptions=Yt,this.importFormat=K.EXCEL_TABLE}ngOnInit(){}upload(e){this.uploadFiles.next({files:e,importFormat:this.importFormat})}formatChanged(e){this.lastFiles&&this.checkFormat(this.lastFiles)}checkFormat(e){this.lastFiles=e,this.formatWarning=void 0,e.forEach(t=>{if(this.importFormat===K.TOPCOUNT){let n=this.isTopCount(t);n&&(this.formatWarning="The selected file does not seem to be a topcount file/archive but rather: "+n+". If you sure it is a valid topcount file/archive you can continue upload.")}else if(this.importFormat===K.EXCEL_TABLE){let n=this.isExcel(t);n&&(this.formatWarning="The selected file does not seem to be an excel file but rather: "+n+". If you sure it is a valid excel file you can continue upload.")}else if(this.importFormat===K.TAB_SEP){let n=this.isTab(t);n&&(this.formatWarning="The selected file does not seem to be a tab-separated file but rather: "+n+". If you sure it is a valid tsv file you can continue upload.")}else if(this.importFormat===K.COMA_SEP){let n=this.isComa(t);n&&(this.formatWarning="The selected file does not seem to be a coma-separated file but rather: "+n+". If you sure it is a valid csv file you can continue upload.")}})}isTopCount(e){let t=e.name,n=e.type;return t?(n||(n="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".tsv")?"tab separated":null):"Unknown"}isExcel(e){let t=e.name,n=e.type;return!n||!t?"Unknown":e.name.endsWith(".csv")?"CSV":e.name.endsWith(".txt")?"text":e.name.endsWith(".tsv")?"tab separated":n.indexOf("excel")>=0||n.indexOf("sheet")>=0?null:n}isTab(e){let t=e.name,n=e.type;return t?(n||(n="Unknown"),e.name.endsWith(".csv")?"CSV":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".tsv")?null:"Unrecognized"):"Unknown"}isComa(e){let t=e.name,n=e.type;return t?(n||(n="Unknown"),e.name.endsWith(".tsv")?"tab separated":e.name.endsWith(".xls")||e.name.endsWith(".xlsx")?"Excel":e.name.endsWith(".txt")?"Text":e.name.endsWith(".csv")?null:"Unrecognized"):"Unknown"}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=x({type:i,selectors:[["bd2-upload-data-file-step"]],outputs:{uploadFiles:"uploadFiles"},decls:19,vars:9,consts:[["uploadWidget",""],["appearance","outlined",1,"mat-elevation-z4"],[1,""],[1,"form-group"],["required","",3,"valueChange","selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["dismissible","true","style","font-size: smaller;","type","info","class","alert alert-info","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"selectedFiles","uploadFiles","autoReset","blocked","multiple"],[3,"value"],["dismissible","true","type","info","role","alert",1,"alert","alert-info",2,"font-size","smaller"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(t,n){if(t&1){let d=S();l(0,"div")(1,"mat-card",1)(2,"mat-card-title"),m(3,"Time series file"),s(),l(4,"mat-card-content")(5,"form",2)(6,"div",3)(7,"mat-form-field")(8,"mat-label"),m(9,"File Format"),s(),l(10,"mat-select",4),P("valueChange",function(h){return _(d),O(n.importFormat,h)||(n.importFormat=h),g(h)}),C("selectionChange",function(h){return _(d),g(n.formatChanged(h))}),f(11,bi,2,2,"mat-option",5),s()()(),f(12,Ci,11,0,"div",6)(13,Si,11,0,"div",6)(14,wi,8,0,"div",6)(15,xi,2,1,"div",7),l(16,"div",3)(17,"bd2-file-upload-widget",8,0),C("selectedFiles",function(h){return _(d),g(n.checkFormat(h))})("uploadFiles",function(h){return _(d),g(n.upload(h))}),s()()()()()()}t&2&&(r(10),V("value",n.importFormat),r(),c("ngForOf",n.importFormatOptions),r(),c("ngIf",n.importFormat.name=="EXCEL_TABLE"),r(),c("ngIf",n.importFormat.name=="TAB_SEP"||n.importFormat.name=="COMA_SEP"),r(),c("ngIf",n.importFormat.name=="TOPCOUNT"),r(),c("ngIf",n.formatWarning),r(2),c("autoReset",!1)("blocked",n.blocked||!n.importFormat)("multiple",!1))},dependencies:[j,v,De,we,xe,Ut,X,Te,Ie,ce,M,B,Dt],encapsulation:2});let a=i;return a})();function vi(a,i){if(a&1&&(l(0,"span")(1,"label"),m(2,"Images every"),s(),m(3),s()),a&2){let o=p(2);r(3),b(" ",o.importDetails.imgInterval,"h ")}}function yi(a,i){if(a&1&&(l(0,"span")(1,"label"),m(2,"Time offset"),s(),m(3),s()),a&2){let o=p(2);r(3),b(" ",o.importDetails.timeOffset,"h ")}}function Ti(a,i){if(a&1&&(l(0,"p")(1,"label"),m(2,"First time point:"),s(),l(3,"strong"),m(4),s(),f(5,vi,4,1,"span",1)(6,yi,4,1,"span",1),s()),a&2){let o=p();r(4),ot("",o.firstTimeCell.value," ",o.importDetails.timeType==null?null:o.importDetails.timeType.unit," [",o.firstTimeCell.colName+":"+o.firstTimeCell.rowName,"]"),r(),c("ngIf",(o.importDetails.timeType==null?null:o.importDetails.timeType.name)==="IMG_NUMBER"),r(),c("ngIf",o.importDetails.timeOffset!=0)}}function Ii(a,i){if(a&1&&(l(0,"p"),m(1),l(2,"strong"),m(3),s()()),a&2){let o=p();r(),b(" Labels in ",o.importDetails.inLabelNeg," "),r(2),b("",o.importDetails.inRows?o.labelsSelection.colName:o.labelsSelection.rowName,";")}}function Ri(a,i){if(a&1&&(l(0,"p")(1,"label"),m(2,"Selected Labels:"),s(),m(3),s()),a&2){let o=p();r(3),b(" ",o.importDetails.summarizeLabels()," ")}}function ki(a,i){if(a&1&&(l(0,"p"),m(1),l(2,"strong"),m(3),s()()),a&2){let o=p();r(),b(" Data starts in ",o.importDetails.inLabel," "),r(2),b("",o.importDetails.inRows?o.dataStart.rowName:o.dataStart.colName,";")}}function Mi(a,i){if(a&1&&(l(0,"p"),m(1),s()),a&2){let o=p();r(),b(" Background noise as: ",o.importDetails.backgroundsLabels.join(", ")," ")}}var ni=(()=>{let i=class i{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(){this.showTime=!1,this.showLabelling=!1,this.showDataStart=!1}ngOnInit(){}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=x({type:i,selectors:[["bd2-import-details-summary"]],inputs:{importDetails:"importDetails",showTime:"showTime",showLabelling:"showLabelling",showDataStart:"showDataStart"},decls:13,vars:8,consts:[["appearance","outlined",1,"mat-elevation-z4"],[4,"ngIf"]],template:function(t,n){t&1&&(l(0,"mat-card",0)(1,"p"),m(2),l(3,"strong"),m(4),s()(),l(5,"p")(6,"label"),m(7),s()(),f(8,Ti,7,5,"p",1)(9,Ii,4,2,"p",1)(10,Ri,4,1,"p",1)(11,ki,4,2,"p",1)(12,Mi,2,1,"p",1),s()),t&2&&(r(2),b("",n.importDetails==null||n.importDetails.importFormat==null?null:n.importDetails.importFormat.label,": "),r(2),k(n.importDetails==null?null:n.importDetails.fileName),r(3),b("Time series in ",(n.importDetails==null?null:n.importDetails.inLabel)+"s",""),r(),c("ngIf",n.showTime&&n.firstTimeCell),r(),c("ngIf",n.showLabelling&&n.importDetails.importLabels&&n.labelsSelection),r(),c("ngIf",n.showLabelling&&!n.importDetails.importLabels),r(),c("ngIf",n.showDataStart&&n.importDetails.importLabels&&n.dataStart),r(),c("ngIf",n.showLabelling&&n.importDetails.containsBackgrounds&&n.importDetails.backgroundsLabels))},dependencies:[v,M],encapsulation:2});let a=i;return a})();var ne=class{constructor(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}reset(){this.rowsBackgrounds=[],this.colsBackgrounds=[],this.cellBackgrounds=[]}setRowBackground(i,o){this.rowsBackgrounds[i]=o}rowBackground(i){return this.getOrEmptyString(this.rowsBackgrounds,i)}colBackground(i){return this.getOrEmptyString(this.colsBackgrounds,i)}setColBackground(i,o){this.colsBackgrounds[i]=o}cellBackground(i,o){let e=this.getOrEmptyString(this.getOrDefault(this.cellBackgrounds,o,[]),i);return e||this.colBackground(i)}setCellBackground(i,o,e){let t=this.cellBackgrounds[o];t===void 0&&(t=[],this.cellBackgrounds[o]=t),t[i]=e}getOrEmptyString(i,o){return this.getOrDefault(i,o,"")}getOrDefault(i,o,e){return o>=i.length||i[o]===void 0?e:i[o]}},G=(()=>{let i=class i{rowBackground(e){return i.MAIN_ROW_BACKGROUND}cellBackground(e){return i.MAIN_CELL_BACKGROUND}columnBackground(e){return i.MAIN_COL_BACKGROUND}};i.MAIN_ROW_BACKGROUND="#dda0dd",i.MAIN_COL_BACKGROUND="#87cefa",i.MAIN_CELL_BACKGROUND="#ba55d3",i.TIME_BACKGROUND="#dda0dd",i.LABELS_BACKGROUND="#87cefa",i.FIRST_TIME_BACKGROUND="#ba55d3",i.FIST_DATA_BACKGROUND="lightgreen";let a=i;return a})(),We=class{constructor(i,o){this.tableStyler=i,this.colorCycler=o,this.selectedRows=[],this.selectedCols=[],this.tableStyler=i||new ne,this.colorCycler=o||new G}toggleRow(i,o=!1,e,t){let n=this.selectedRows.splice(0,this.selectedRows.length);this.selectedRows.push(i),this.uncolorRows(n),this.colorRows(this.selectedRows,e),o&&(this.uncolorCells(n),this.colorCells(this.selectedRows,t))}toggleRowSelection(i,o,e=!1,t,n){let d=this.selectedRows[i]?[this.selectedRows[i]]:[];this.selectedRows[i]=o,this.uncolorRows(d),this.colorRows([this.selectedRows[i]],t),e&&(this.uncolorCells(d),this.colorCells([this.selectedRows[i]],n))}selectRow(i,o){let e=new y(-1,-1,void 0,i,i,void 0,void 0),t=this.selectedRows.findIndex(n=>n.rowNumber===i);t<0?this.selectedRows.push(e):this.selectedRows[t]=e,this.colorRows([e],o)}deselectRow(i){let o=this.selectedRows.findIndex(t=>t.rowNumber===i);o>=0&&(this.selectedRows[o]=void 0);let e=new y(-1,-1,void 0,i,i,void 0,void 0);this.uncolorRows([e])}toggleCol(i,o=!1,e,t){let n=this.selectedCols.splice(0,this.selectedCols.length);this.selectedCols.push(i),this.uncolorCols(n),this.colorCols(this.selectedCols,e),o&&(this.uncolorCells(n),this.colorCells(this.selectedCols,t))}toggleColSelection(i,o,e=!1,t,n){let d=this.selectedCols[i]?[this.selectedCols[i]]:[];this.selectedCols[i]=o,this.uncolorCols(d),this.colorCols([this.selectedCols[i]],t),e&&(this.uncolorCells(d),this.colorCells([this.selectedCols[i]],n))}selectCol(i,o){let e=new y(i,i,void 0,-1,-1,void 0,void 0),t=this.selectedCols.findIndex(n=>n.colNumber===i);t<0?this.selectedCols.push(e):this.selectedCols[t]=e,this.colorCols([e],o)}deselectCol(i){let o=this.selectedCols.findIndex(t=>t.colNumber===i);o>=0&&(this.selectedCols[o]=void 0);let e=new y(i,i,void 0,-1,-1,void 0,void 0);this.uncolorCols([e])}reset(){this.selectedRows=[],this.selectedCols=[],this.tableStyler.reset()}colorRows(i,o){i.forEach((e,t)=>{this.tableStyler.setRowBackground(e.rowNumber,o||this.colorCycler.rowBackground(t))})}colorCols(i,o){i.forEach((e,t)=>{this.tableStyler.setColBackground(e.colNumber,o||this.colorCycler.columnBackground(t))})}colorCells(i,o){i.forEach((e,t)=>{this.tableStyler.setCellBackground(e.colNumber,e.rowNumber,o||this.colorCycler.cellBackground(t))})}uncolorRows(i){i.forEach(o=>{this.tableStyler.setRowBackground(o.rowNumber,void 0)})}uncolorCols(i){i.forEach(o=>{this.tableStyler.setColBackground(o.colNumber,void 0)})}uncolorCells(i){i.forEach(o=>{this.tableStyler.setCellBackground(o.colNumber,o.rowNumber,void 0)})}},oi=(()=>{let i=class i{constructor(){this.index=0,this.labelsIndexes=new Map}toColor(e){if(!e)return;this.labelsIndexes.has(e)||this.labelsIndexes.set(e,this.index++);let t=this.labelsIndexes.get(e)%i.colors.length;return i.colors[t]}setColor(e){}};i.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"];let a=i;return a})();var Y=(()=>{let i=class i{get firstTimeCell(){return this.importDetails?this.importDetails.firstTimeCell:void 0}get labelsSelection(){return this.importDetails?this.importDetails.labelsSelection:void 0}get dataStart(){return this.importDetails?this.importDetails.dataStart:void 0}constructor(e,t){this.dataService=e,this.feedback=t,this.tableSelector=new We,this.lastColumnSeen=0,this.lastRowSeen=0,this.firstPageSlice=H.firstPage(),this.currentPageSlice=H.firstPage()}ngOnInit(){this.dataService.error$.forEach(e=>this.feedback.error(e)),this.dataSubscription=this.dataService.dataSlice$.subscribe(e=>this.setDataSlice(e),e=>this.feedback.error(e))}ngOnDestroy(){this.dataSubscription&&this.dataSubscription.unsubscribe()}colNumber(e){return e<0?-1:this.dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this.dataSlice.rowsNumbers[e]}setDataSlice(e){this.dataSlice=e,this.lastColumnSeen=Math.max(this.lastColumnSeen,e.columnsNumbers[e.columnsNumbers.length-1]),this.lastRowSeen=Math.max(this.lastRowSeen,e.rowsNumbers[e.rowsNumbers.length-1]),this.currentPageSlice=new H(e.rowPage,e.colPage),this.applySelection()}loadData(){this.importDetails&&(this.lastColumnSeen=0,this.lastRowSeen=0,this.dataService.fileIdFormat([this.importDetails.fileId,this.importDetails.importFormat.name]),this.dataService.slice(this.firstPageSlice)),this.dataSlice&&this.applySelection()}applySelection(){this.tableSelector.reset(),this.markSelections(),this.applyDefaultSelections()}applyDefaultSelections(){}markSelections(){}selectFirstTime(e){this.importDetails.firstTimeCell=e,this.markFirstTime()}markFirstTime(){let e=this.firstTimeCell;e&&(this.importDetails.inRows?this.tableSelector.toggleRow(e,!0,G.TIME_BACKGROUND,G.FIRST_TIME_BACKGROUND):this.tableSelector.toggleCol(e,!0,G.TIME_BACKGROUND,G.FIRST_TIME_BACKGROUND))}selectLabels(e){this.importDetails.labelsSelection=e,this.markLabels()}markLabels(){let e=this.labelsSelection;e&&(this.importDetails.inRows?this.tableSelector.toggleCol(e,!1,G.LABELS_BACKGROUND):this.tableSelector.toggleRow(e,!1,G.LABELS_BACKGROUND))}selectDataStart(e){e?this.importDetails.inRows?(!this.firstTimeCell||this.firstTimeCell.rowIx!==e.rowIx)&&(this.importDetails.dataStart=e):(!this.firstTimeCell||this.firstTimeCell.colIx!==e.colIx)&&(this.importDetails.dataStart=e):this.importDetails.dataStart=void 0,this.markDataStart()}markDataStart(){let e=this.dataStart;e&&(this.importDetails.inRows?this.tableSelector.toggleRowSelection(1,e,!1,G.FIST_DATA_BACKGROUND):this.tableSelector.toggleColSelection(1,e,!1,G.FIST_DATA_BACKGROUND))}reselect(e){if(!this.dataSlice||!e)return;let t=this.dataSlice,n=e.colIx,d=e.rowIx;if(n>=t.columnsNumbers.length||d>=t.rowsNumbers.length)return;let h=(d>=0?t.data[d]:[])[n],U=new y(n,t.columnsNumbers[n],t.columnsNames[n],d,t.rowsNumbers[d],t.rowsNames[d],h);return U.fake=e.fake,U}hasMoreTimes(){return!this.importDetails||!this.dataSlice?!1:this.importDetails.inRows?this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns:this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows}hasMoreLabels(){return!this.importDetails||!this.dataSlice?!1:this.importDetails.inRows?this.firstPageSlice.rowPage.pageSize<this.dataSlice.totalRows:this.firstPageSlice.colPage.pageSize<this.dataSlice.totalColumns}};i.\u0275fac=function(t){return new(t||i)(w(N),w(A))},i.\u0275dir=nt({type:i});let a=i;return a})();var Ei=["table"];function Fi(a,i){a&1&&D(0,"th",10)}function Bi(a,i){if(a&1){let o=S();l(0,"td",11),C("click",function(){let t=_(o).index,n=p(2);return g(n.selectCell(-1,t))}),l(1,"label"),m(2),s()()}if(a&2){let o=i.index,e=p(2);r(2),k(e.rowsNames[o])}}function Vi(a,i){if(a&1){let o=S();l(0,"th",15),C("click",function(){_(o);let t=p().index,n=p(2);return g(n.selectCell(t,-1))}),m(1),s()}if(a&2){let o=p(),e=o.$implicit,t=o.index,n=p(2);q("background-color",n.colBackground(t)),r(),b(" ",e," ")}}function Oi(a,i){if(a&1){let o=S();l(0,"td",16),C("click",function(){let t=_(o).index,n=p().index,d=p(2);return g(d.selectCell(n,t))}),m(1),s()}if(a&2){let o=i.$implicit,e=i.index,t=p().index,n=p(2);q("background-color",n.cellBackground(t,e)),c("matRippleCentered",!0),r(),b(" ",o[t]," ")}}function Pi(a,i){if(a&1&&(T(0,12),f(1,Vi,2,3,"th",13)(2,Oi,2,4,"td",14),I()),a&2){let o=i.$implicit;c("matColumnDef",o)}}function Ai(a,i){a&1&&D(0,"tr",17)}function Ui(a,i){if(a&1&&D(0,"tr",18),a&2){let o=i.index,e=p(2);q("background-color",e.rowBackground(o))}}function Wi(a,i){if(a&1&&(l(0,"div",2)(1,"table",3,0),T(3,4),f(4,Fi,1,0,"th",5)(5,Bi,3,1,"td",6),I(),f(6,Pi,3,1,"ng-container",7)(7,Ai,1,0,"tr",8)(8,Ui,1,2,"tr",9),s()()),a&2){let o=p();r(),c("dataSource",o.data),r(5),c("ngForOf",o.columnsNames),r(),c("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),r(),c("matRowDefColumns",o.displayedColumns)}}var ue=(()=>{let i=class i{set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.displayedColumns=["rowNr"].concat(this.columnsNames),this.data=e.data,this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.styler=new ne,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.selected=new W}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}ngOnInit(){}selectCell(e,t){if(e<0&&!this.selectableRowHeader||t<0&&!this.selectableColHeader)return;let d=(t>=0?this.data[t]:[])[e],u=this._dataSlice.columnsNumbers[e],h=this._dataSlice.columnsNames[e],U=this._dataSlice.rowsNumbers[t],Z=this._dataSlice.rowsNames[t],J=new y(e,u,h,t,U,Z,d);this.selected.next(J)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=x({type:i,selectors:[["bd2-data-sheet-mdtable"]],viewQuery:function(t,n){if(t&1&&L(Ei,5),t&2){let d;E(d=F())&&(n.matTable=d.first)}},inputs:{dataSlice:"dataSlice",styler:"styler",selectableColHeader:"selectableColHeader",selectableRowHeader:"selectableRowHeader"},outputs:{selected:"selected"},decls:1,vars:1,consts:[["table",""],["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"click"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color","click",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"matRippleCentered","background-color","click",4,"matCellDef"],["mat-header-cell","",3,"click"],["mat-cell","","matRipple","",3,"click","matRippleCentered"],["mat-header-row",""],["mat-row",""]],template:function(t,n){t&1&&f(0,Wi,9,5,"div",1),t&2&&c("ngIf",n.dataSlice)},dependencies:[j,v,ke,Ne,Be,Le,Me,Ve,Ee,Fe,Oe,Pe,ve],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:300px;overflow:auto}.mat-mdc-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-mdc-header-cell[_ngcontent-%COMP%], .mat-mdc-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}"]});let a=i;return a})();function zi(a,i){if(a&1&&(l(0,"mat-option",9),m(1),s()),a&2){let o=i.$implicit;c("value",o),r(),k(o.label)}}function ji(a,i){if(a&1){let o=S();l(0,"p")(1,"mat-form-field")(2,"input",10),P("ngModelChange",function(t){_(o);let n=p(3);return O(n.importDetails.imgInterval,t)||(n.importDetails.imgInterval=t),g(t)}),s()()()}if(a&2){let o=p(3);r(2),V("ngModel",o.importDetails.imgInterval)}}function Qi(a,i){if(a&1&&(l(0,"div",11),m(1),s()),a&2){let o=p(3);r(),b(" The first time point value ",o.firstTimeCell.value," does not look like a number; ")}}function Gi(a,i){if(a&1){let o=S();l(0,"div")(1,"p"),m(2),l(3,"strong"),m(4),s(),m(5,"\xA0 First time point: "),l(6,"strong"),m(7),s(),m(8),s(),l(9,"p")(10,"mat-form-field")(11,"mat-label"),m(12,"Time unit"),s(),l(13,"mat-select",5),P("valueChange",function(t){_(o);let n=p(2);return O(n.importDetails.timeType,t)||(n.importDetails.timeType=t),g(t)}),f(14,zi,2,2,"mat-option",6),s()()(),l(15,"p")(16,"mat-form-field")(17,"input",7),P("ngModelChange",function(t){_(o);let n=p(2);return O(n.importDetails.timeOffset,t)||(n.importDetails.timeOffset=t),g(t)}),s()()(),f(18,ji,3,1,"p",2)(19,Qi,2,1,"div",8),s()}if(a&2){let o=p(2);r(2),b("Times in ",o.importDetails.inLabel," "),r(2),b("",o.importDetails.inRows?o.firstTimeCell.rowName:o.firstTimeCell.colName,";"),r(3),Ce("",o.firstTimeCell.value," ",o.importDetails.timeType==null?null:o.importDetails.timeType.unit,""),r(),b(" [",o.firstTimeCell.colName+":"+o.firstTimeCell.rowName,"] "),r(5),V("value",o.importDetails.timeType),r(),c("ngForOf",o.timeTypeOptions),r(3),V("ngModel",o.importDetails.timeOffset),r(),c("ngIf",(o.importDetails.timeType==null?null:o.importDetails.timeType.name)=="IMG_NUMBER"),r(),c("ngIf",o.firstTimeNotNumber())}}function qi(a,i){if(a&1&&(l(0,"div",12),m(1),s()),a&2){let o=p(2);r(),b(" Even if only the top part of the data table is presented all times from the selected ",o.importDetails.inLabel," will be imported ")}}function Ki(a,i){if(a&1){let o=S();l(0,"mat-card",1)(1,"mat-card-content"),f(2,Gi,20,10,"div",2),l(3,"div")(4,"div"),m(5),s()(),l(6,"bd2-data-sheet-mdtable",3),C("selected",function(t){_(o);let n=p();return g(n.selectFirstTime(t))}),s(),f(7,qi,2,1,"div",4),s()()}if(a&2){let o=p();r(2),c("ngIf",o.firstTimeCell),r(2),ae(o.firstTimeCell?"alert alert-info":"alert alert-danger"),r(),b(" Click on the first timepoint in the time ",o.importDetails.inLabel," and then select a time unit. "),r(),c("dataSlice",o.dataSlice)("styler",o.tableSelector.tableStyler),r(),c("ngIf",o.hasMoreTimes())}}var ai=(()=>{let i=class i extends Y{constructor(e,t){super(e,t),this.timeTypeOptions=[te.TIME_IN_HOURS,te.TIME_IN_MINUTES,te.TIME_IN_SECONDS,te.IMG_NUMBER]}applyDefaultSelections(){if(super.applyDefaultSelections(),this.firstTimeCell&&!this.firstTimeCell.fake)this.selectFirstTime(this.reselect(this.firstTimeCell));else{let e=this.importDetails.inRows?new y(1,this.colNumber(1),void 0,0,this.rowNumber(0),void 0,void 0):new y(0,this.colNumber(0),void 0,1,this.rowNumber(1),void 0,void 0);e=this.reselect(e),e.fake=!0,this.selectFirstTime(e)}}firstTimeNotNumber(){return this.firstTimeCell?isNaN(Number(this.firstTimeCell.value)):!1}};i.\u0275fac=function(t){return new(t||i)(w(N),w(A))},i.\u0275cmp=x({type:i,selectors:[["bd2-define-time-step"]],inputs:{importDetails:"importDetails"},features:[z],decls:1,vars:1,consts:[["appearance","outlined","class","mat-elevation-z4",4,"ngIf"],["appearance","outlined",1,"mat-elevation-z4"],[4,"ngIf"],[3,"selected","dataSlice","styler"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["required","",3,"valueChange","value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","placeholder","Time offset",3,"ngModelChange","ngModel"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],[3,"value"],["matInput","","type","number","placeholder","Images interval (hours)","required","",3,"ngModelChange","ngModel"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(t,n){t&1&&f(0,Ki,8,7,"mat-card",0),t&2&&c("ngIf",n.importDetails)},dependencies:[j,v,se,ct,$,dt,me,X,Te,Ie,ce,M,B,Re,ue],encapsulation:2});let a=i;return a})();function Xi(a,i){if(a&1&&(l(0,"div",7),m(1),s()),a&2){let o=p(3);r(),b(" Labels ",o.importDetails.inLabelNeg," must be before first time point. ")}}function Yi(a,i){if(a&1&&(l(0,"div")(1,"p"),m(2),l(3,"strong"),m(4),s()(),f(5,Xi,2,1,"div",6),s()),a&2){let o=p(2);r(2),b("Labels in ",o.importDetails.inLabelNeg," "),r(2),b("",o.importDetails.inRows?o.labelsSelection.colName:o.labelsSelection.rowName,";"),r(),c("ngIf",!o.importDetails.areLabelsAfterTime())}}function Zi(a,i){if(a&1&&(l(0,"div",8),m(1),s()),a&2){let o=p(2);r(),b(" Even if only the top part of the data table is presented all labels from the selected ",o.importDetails.inLabelNeg," will be imported ")}}function Ji(a,i){if(a&1){let o=S();l(0,"mat-card",1)(1,"mat-card-content"),f(2,Yi,6,3,"div",2),l(3,"div")(4,"div",3),m(5),s()(),l(6,"bd2-data-sheet-mdtable",4),C("selected",function(t){_(o);let n=p();return g(n.selectLabels(t))}),s(),l(7,"div"),m(8," \xA0 "),f(9,Zi,2,1,"div",5),s()()()}if(a&2){let o=p();r(2),c("ngIf",o.labelsSelection),r(2),ae(o.labelsSelection?"alert alert-info":"alert alert-danger"),r(),b(" Click on the ",o.importDetails.inLabelNeg," containing labels. "),r(),c("dataSlice",o.dataSlice)("selectableColHeader",o.importDetails.inRows)("selectableRowHeader",!o.importDetails.inRows)("styler",o.tableSelector.tableStyler),r(3),c("ngIf",o.hasMoreLabels())}}var ri=(()=>{let i=class i extends Y{constructor(e,t){super(e,t)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.labelsSelection&&!this.labelsSelection.fake)this.selectLabels(this.reselect(this.labelsSelection));else if(this.firstTimeCell){let e=this.reselect(new y(this.firstTimeCell.colIx-1,this.colNumber(this.firstTimeCell.colIx-1),void 0,this.firstTimeCell.rowIx-1,this.rowNumber(this.firstTimeCell.rowIx-1),void 0,void 0));e.fake=!0,this.selectLabels(e)}}markSelections(){super.markSelections(),this.markFirstTime()}};i.\u0275fac=function(t){return new(t||i)(w(N),w(A))},i.\u0275cmp=x({type:i,selectors:[["bd2-import-labels-step"]],inputs:{importDetails:"importDetails"},features:[z],decls:1,vars:1,consts:[["appearance","outlined","class","mat-elevation-z4",4,"ngIf"],["appearance","outlined",1,"mat-elevation-z4"],[4,"ngIf"],["role","alert"],[3,"selected","dataSlice","selectableColHeader","selectableRowHeader","styler"],["type","info","class","alert alert-info small","role","alert",4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"],["type","info","role","alert",1,"alert","alert-info","small"]],template:function(t,n){t&1&&f(0,Ji,10,9,"mat-card",0),t&2&&c("ngIf",n.importDetails)},dependencies:[v,M,B,ue],encapsulation:2});let a=i;return a})();function tn(a,i){if(a&1&&(l(0,"div",5),m(1),s()),a&2){let o=p(3);r(),Ce(" Data start ",o.importDetails.inLabel," must be after time ",o.importDetails.inLabel,". ")}}function nn(a,i){if(a&1&&(l(0,"div")(1,"p"),m(2),l(3,"strong"),m(4),s()(),f(5,tn,2,2,"div",4),s()),a&2){let o=p(2);r(2),b("Data starts in ",o.importDetails.inLabel," "),r(2),b("",o.importDetails.inRows?o.dataStart.rowName:o.dataStart.colName,";"),r(),c("ngIf",!o.importDetails.isDataAfterTime())}}function on(a,i){if(a&1){let o=S();l(0,"mat-card",1)(1,"mat-card-content"),f(2,nn,6,3,"div",2),l(3,"div")(4,"div"),m(5),s()(),l(6,"bd2-data-sheet-mdtable",3),C("selected",function(t){_(o);let n=p();return g(n.selectDataStart(t))}),s()()()}if(a&2){let o=p();r(2),c("ngIf",o.dataStart),r(2),ae(o.dataStart?"alert alert-info":"alert alert-danger"),r(),b(" Click on the first data ",o.importDetails.inLabel,". "),r(),c("dataSlice",o.dataSlice)("selectableColHeader",!o.importDetails.inRows)("selectableRowHeader",o.importDetails.inRows)("styler",o.tableSelector.tableStyler)}}var li=(()=>{let i=class i extends Y{constructor(e,t){super(e,t)}applyDefaultSelections(){if(super.applyDefaultSelections(),this.dataStart&&!this.dataStart.fake)this.selectDataStart(this.reselect(this.dataStart));else if(this.firstTimeCell){let e=this.reselect(new y(this.firstTimeCell.colIx+1,this.colNumber(this.firstTimeCell.colIx+1),void 0,this.firstTimeCell.rowIx+1,this.rowNumber(this.firstTimeCell.rowIx+1),void 0,void 0));e.fake=!0,this.selectDataStart(e)}}markSelections(){super.markSelections(),this.markFirstTime(),this.markLabels()}};i.\u0275fac=function(t){return new(t||i)(w(N),w(A))},i.\u0275cmp=x({type:i,selectors:[["bd2-select-data-start-step"]],inputs:{importDetails:"importDetails"},features:[z],decls:1,vars:1,consts:[["appearance","outlined","class","mat-elevation-z4",4,"ngIf"],["appearance","outlined",1,"mat-elevation-z4"],[4,"ngIf"],[3,"selected","dataSlice","selectableColHeader","selectableRowHeader","styler"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["type","danger","role","alert",1,"alert","alert-danger"]],template:function(t,n){t&1&&f(0,on,7,8,"mat-card",0),t&2&&c("ngIf",n.importDetails)},dependencies:[v,M,B,ue],encapsulation:2});let a=i;return a})();var si=(()=>{let i=class i{constructor(e,t){this.dialogRef=e,this.data=t}ngOnInit(){}sendLabel(){this.dialogRef.close(this.data.label)}};i.\u0275fac=function(t){return new(t||i)(w(Lt),w(Et))},i.\u0275cmp=x({type:i,selectors:[["bd2-edit-label-dialog"]],decls:20,vars:6,consts:[["ok",""],["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","cdkFocusInitial","",3,"ngModelChange","keydown.enter","ngModel"],["align","start"],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-raised-button","","color","primary",3,"mat-dialog-close"]],template:function(t,n){if(t&1){let d=S();l(0,"h1",1),m(1),s(),l(2,"div",2)(3,"p"),m(4),s(),l(5,"mat-form-field")(6,"input",3),P("ngModelChange",function(h){return _(d),O(n.data.label,h)||(n.data.label=h),g(h)}),C("keydown.enter",function(){return _(d),g(n.sendLabel())}),s(),l(7,"mat-hint",4),m(8,"Pressing "),l(9,"strong"),m(10,"Enter"),s(),m(11," submits "),s()()(),l(12,"div",5)(13,"button",6),m(14,"Cancel"),s(),l(15,"button",6),m(16,"Clear"),s(),l(17,"button",7,0),m(19,"Assign"),s()()}t&2&&(r(),k(n.data.title),r(3),b("Write label for ",n.data.regionName,""),r(2),V("ngModel",n.data.label),r(7),c("mat-dialog-close",void 0),r(2),c("mat-dialog-close",""),r(2),c("mat-dialog-close",n.data.label))},dependencies:[se,$,me,X,ht,Re,ye,Bt,Vt,Pt,Ot],encapsulation:2});let a=i;return a})();var sn=["table"];function mn(a,i){a&1&&D(0,"th",20)}function cn(a,i){if(a&1){let o=S();l(0,"td",21),C("mousedown",function(){let t=_(o).index,n=p(2);return g(n.startSelectCell(-1,t))})("mouseup",function(){let t=_(o).index,n=p(2);return g(n.endSelectCell(-1,t))}),l(1,"label"),m(2),s()()}if(a&2){let o=i.index,e=p(2);r(2),k(e.rowsNames[o])}}function pn(a,i){if(a&1){let o=S();l(0,"td",22),C("click",function(){_(o);let t=p(2);return g(t.nextRow())}),m(1),s()}if(a&2){let o=p(2);r(),k(o.hasMoreRows?"...":"end")}}function dn(a,i){a&1&&(l(0,"th",20),m(1,"Labels"),s())}function un(a,i){if(a&1){let o=S();l(0,"td",21),C("mousedown",function(){let t=_(o).index,n=p(2);return g(n.startSelectCell(-1,t))})("mouseup",function(){let t=_(o).index,n=p(2);return g(n.endSelectCell(-1,t))}),l(1,"label",23),m(2),s()()}if(a&2){let o=i.index,e=p(2);r(2),k(e.rowsLabels[o])}}function fn(a,i){if(a&1){let o=S();l(0,"td",22),C("click",function(){_(o);let t=p(2);return g(t.nextRow())}),s()}}function hn(a,i){if(a&1){let o=S();l(0,"th",27),C("mousedown",function(){_(o);let t=p().index,n=p(2);return g(n.startSelectCell(t,-1))})("mouseup",function(){_(o);let t=p().index,n=p(2);return g(n.endSelectCell(t,-1))}),m(1),s()}if(a&2){let o=p(),e=o.$implicit,t=o.index,n=p(2);q("background-color",n.colBackground(t)),r(),b(" ",e," ")}}function _n(a,i){if(a&1&&(l(0,"td",28),m(1),s()),a&2){let o=i.$implicit,e=i.index,t=p().index,n=p(2);q("background-color",n.cellBackground(t,e)),r(),b(" ",o[t]," ")}}function gn(a,i){if(a&1){let o=S();l(0,"td",22),C("click",function(){_(o);let t=p(3);return g(t.nextRow())}),m(1),s()}if(a&2){let o=p(3);r(),k(o.hasMoreRows?"...":"")}}function bn(a,i){if(a&1&&(T(0,24),f(1,hn,2,3,"th",25)(2,_n,2,3,"td",26)(3,gn,2,1,"td",7),I()),a&2){let o=i.$implicit;c("matColumnDef",o)}}function Cn(a,i){if(a&1){let o=S();l(0,"th",29),C("click",function(){_(o);let t=p(2);return g(t.nextColumn())}),m(1,"..."),s()}}function Sn(a,i){if(a&1){let o=S();l(0,"td",30),C("click",function(){_(o);let t=p(2);return g(t.nextColumn())}),m(1,"..."),s()}}function wn(a,i){a&1&&D(0,"td",31)}function xn(a,i){a&1&&(l(0,"th",20),m(1,"Labels"),s())}function Dn(a,i){a&1&&D(0,"th",20)}function vn(a,i){if(a&1){let o=S();l(0,"th",27),C("mousedown",function(){_(o);let t=p().index,n=p(3);return g(n.startSelectCell(t,-1))})("mouseup",function(){_(o);let t=p().index,n=p(3);return g(n.endSelectCell(t,-1))}),l(1,"label",23),m(2),s()()}if(a&2){let o=p().index,e=p(3);q("background-color",e.colBackground(o)),r(2),k(e.columnsLabels[o])}}function yn(a,i){if(a&1&&(T(0,24),f(1,vn,3,3,"th",25),I()),a&2){let o=i.index;c("matColumnDef","label"+o)}}function Tn(a,i){if(a&1&&(T(0),f(1,yn,2,1,"ng-container",9),I()),a&2){let o=p(2);r(),c("ngForOf",o.columnsNames)}}function In(a,i){a&1&&D(0,"tr",32)}function Rn(a,i){a&1&&D(0,"tr",32)}function kn(a,i){if(a&1&&(T(0),f(1,Rn,1,0,"tr",17),I()),a&2){let o=p(2);r(),c("matHeaderRowDef",o.displayedLabelsColumns)("matHeaderRowDefSticky",!0)}}function Mn(a,i){if(a&1&&D(0,"tr",33),a&2){let o=i.index,e=p(2);q("background-color",e.rowBackground(o))}}function Nn(a,i){a&1&&D(0,"tr",34)}function Ln(a,i){if(a&1&&(l(0,"div",2)(1,"table",3,0),T(3,4),f(4,mn,1,0,"th",5)(5,cn,3,1,"td",6)(6,pn,2,1,"td",7),I(),T(7,8),f(8,dn,2,0,"th",5)(9,un,3,1,"td",6)(10,fn,1,0,"td",7),I(),f(11,bn,4,1,"ng-container",9),T(12,10),f(13,Cn,2,0,"th",11)(14,Sn,2,0,"td",12)(15,wn,1,0,"td",13),I(),T(16,14),f(17,xn,2,0,"th",5),I(),T(18,15),f(19,Dn,1,0,"th",5),I(),f(20,Tn,2,1,"ng-container",16)(21,In,1,0,"tr",17)(22,kn,2,2,"ng-container",16)(23,Mn,1,2,"tr",18)(24,Nn,1,0,"tr",19),s()()),a&2){let o=p();r(),c("dataSource",o.data),r(10),c("ngForOf",o.columnsNames),r(9),c("ngIf",o.showColumnsLabels),r(),c("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),r(),c("ngIf",o.showColumnsLabels),r(),c("matRowDefColumns",o.displayedColumns),r(),c("matFooterRowDef",o.displayedColumns)}}var mi=(()=>{let i=class i{set columnsLabels(e){this._columnsLabels=e}get columnsLabels(){return this._columnsLabels}set rowsLabels(e){this._rowsLabels=e}get rowsLabels(){return this._rowsLabels}set dataSlice(e){e&&(this._dataSlice=e,this.columnsNames=e.columnsNames,this.rowsNames=e.rowsNames,this.data=e.data,this.hasMoreColumns=e.columnsNumbers[e.columnsNumbers.length-1]<e.totalColumns-1,this.hasMoreRows=e.rowsNumbers[e.rowsNumbers.length-1]<e.totalRows-1,this.decideColumns(),this.matTable&&this.matTable.renderRows())}get dataSlice(){return this._dataSlice}set selectRows(e){this.selectableRowHeader=e,this.showRowsLabels=e,this.decideColumns()}set selectCols(e){this.selectableColHeader=e,this.showColumnsLabels=e,this.decideColumns()}constructor(){this.columnsNames=[],this.rowsNames=[],this.data=[],this.hasMoreColumns=!1,this.hasMoreRows=!1,this._columnsLabels=[],this._rowsLabels=[],this.styler=new ne,this.selectableColHeader=!1,this.selectableRowHeader=!1,this.showColumnsLabels=!1,this.showRowsLabels=!1,this.selected=new W,this.moreRows=new W,this.moreColumns=new W}decideColumns(){this.displayedColumns=(this.showRowsLabels?["rowNr","rowLabel"]:["rowNr"]).concat(this.columnsNames),this.displayedLabelsColumns=(this.showRowsLabels?["rowNr2","rowLabel2"]:["rowNr2"]).concat(this.columnsNames.map((e,t)=>"label"+t)),this.hasMoreColumns&&(this.displayedColumns.push("more"),this.displayedLabelsColumns.push("more"))}ngOnInit(){}colNumber(e){return e<0?-1:this._dataSlice.columnsNumbers[e]}rowNumber(e){return e<0?-1:this._dataSlice.rowsNumbers[e]}colBackground(e){return this.styler.colBackground(this.colNumber(e))}rowBackground(e){return this.styler.rowBackground(this.rowNumber(e))}cellBackground(e,t){return this.styler.cellBackground(this.colNumber(e),this.rowNumber(t))}startSelectCell(e,t){if(e<0&&!this.selectableRowHeader||t<0&&!this.selectableColHeader)return;let d=(t>=0?this.data[t]:[])[e],u=this._dataSlice.columnsNumbers[e],h=this._dataSlice.columnsNames[e],U=this._dataSlice.rowsNumbers[t],Z=this._dataSlice.rowsNames[t],J=new y(e,u,h,t,U,Z,d);this.selectionStart=J}endSelectCell(e,t){if(!this.selectionStart)return;if(t<0&&this.selectionStart.rowIx>=0){this.selectionStart=void 0;return}if(e<0&&this.selectionStart.colIx>=0){this.selectionStart=void 0;return}if(e<0&&!this.selectableRowHeader||t<0&&!this.selectableColHeader)return;let d=(t>=0?this.data[t]:[])[e],u=this._dataSlice.columnsNumbers[e],h=this._dataSlice.columnsNames[e],U=this._dataSlice.rowsNumbers[t],Z=this._dataSlice.rowsNames[t],J=new y(e,u,h,t,U,Z,d);this.selected.next([this.selectionStart,J])}nextColumn(){this.moreColumns.next(!0)}nextRow(){this.moreRows.next(!0)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=x({type:i,selectors:[["bd2-selectable-region-mdtable"]],viewQuery:function(t,n){if(t&1&&L(sn,5),t&2){let d;E(d=F())&&(n.matTable=d.first)}},inputs:{columnsLabels:"columnsLabels",rowsLabels:"rowsLabels",dataSlice:"dataSlice",selectRows:"selectRows",selectCols:"selectCols",styler:"styler"},outputs:{selected:"selected",moreRows:"moreRows",moreColumns:"moreColumns"},decls:1,vars:1,consts:[["table",""],["class","data-sheet-container",4,"ngIf"],[1,"data-sheet-container"],["mat-table","",3,"dataSource"],["matColumnDef","rowNr","sticky",""],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","matRipple","",3,"mousedown","mouseup",4,"matCellDef"],["mat-footer-cell","",3,"click",4,"matFooterCellDef"],["matColumnDef","rowLabel","sticky",""],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","more","sticky",""],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","rowNr2","sticky",""],["matColumnDef","rowLabel2","sticky",""],[4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"background-color",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],["mat-header-cell",""],["mat-cell","","matRipple","",3,"mousedown","mouseup"],["mat-footer-cell","",3,"click"],[1,"user"],[3,"matColumnDef"],["mat-header-cell","","matRipple","",3,"background-color","mousedown","mouseup",4,"matHeaderCellDef"],["mat-cell","",3,"background-color",4,"matCellDef"],["mat-header-cell","","matRipple","",3,"mousedown","mouseup"],["mat-cell",""],["mat-header-cell","",3,"click"],["mat-cell","",3,"click"],["mat-footer-cell",""],["mat-header-row",""],["mat-row",""],["mat-footer-row",""]],template:function(t,n){t&1&&f(0,Ln,25,8,"div",1),t&2&&c("ngIf",n.dataSlice)},dependencies:[j,v,ke,Ne,Be,Le,Me,Ve,It,kt,Ee,Fe,Rt,Oe,Pe,Mt,ve],styles:[".data-sheet-container[_ngcontent-%COMP%]{max-height:800px;overflow:auto}.mat-mdc-table-sticky[_ngcontent-%COMP%]:first-child{border-right:1px solid #e0e0e0;padding-right:1em}.mat-mdc-header-cell[_ngcontent-%COMP%], .mat-mdc-cell[_ngcontent-%COMP%]{padding-left:.5em;padding-right:.5em}label[_ngcontent-%COMP%]{color:#0000008a}label.user[_ngcontent-%COMP%]{color:#000}"]});let a=i;return a})();var Fn=["colPaginator"],Bn=["rowPaginator"],ci=()=>[10,25,50,100];function Vn(a,i){if(a&1&&(l(0,"div",9),m(1),s()),a&2){let o=p();r(),b(" You have not seen yet all the available ",o.importDetails==null?null:o.importDetails.inLabel,`s for labelling
`)}}var pi=(()=>{let i=class i extends Y{get userLabels(){return this.importDetails?this.importDetails.userLabels:void 0}constructor(e,t,n){super(t,n),this.dialog=e,this.columnsLabels=[],this.rowsLabels=[],this.colorer=new oi}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy(),this.dataService&&this.dataService.close()}ngAfterViewInit(){this.colPaginator._intl=new Qe,this.colPaginator._intl.itemsPerPageLabel="Columns per page",this.rowPaginator._intl=new Qe,this.rowPaginator._intl.itemsPerPageLabel="Rows per page"}markSelections(){super.markSelections(),this.markFirstTime(),this.loadLabels(),this.markLabels(),this.labelsSummary=this.importDetails.summarizeLabels(25),this.labelTime()}labelTime(){if(this.firstTimeCell)if(this.importDetails.inRows){let e=this.dataSlice.rowsNumbers.indexOf(this.firstTimeCell.rowNumber);e>=0&&(this.rowsLabels[e]="Time")}else{let e=this.dataSlice.columnsNumbers.indexOf(this.firstTimeCell.colNumber);e>=0&&(this.columnsLabels[e]="Time")}}loadLabels(){let e=this.dataSlice;this.importDetails.inRows?(this.rowsLabels=this.userLabels.slice(e.rowsNumbers[0],e.rowsNumbers[e.rowsNumbers.length-1]),this.columnsLabels=[]):(this.rowsLabels=[],this.columnsLabels=this.userLabels.slice(e.columnsNumbers[0],e.columnsNumbers[e.columnsNumbers.length-1]))}markLabels(){this.userLabels.forEach((e,t)=>{this.importDetails.inRows?this.tableSelector.selectRow(t,this.colorer.toColor(e)):this.tableSelector.selectCol(t,this.colorer.toColor(e))})}hasSeenAll(){return this.dataSlice?this.importDetails.inRows?this.lastRowSeen>=this.dataSlice.totalRows-1:this.lastColumnSeen>=this.dataSlice.totalColumns-1:!1}selected(e){let t=e[0].colName+e[0].rowName,n=e[1].colName+e[1].rowName;e[1].isBeforeOrSame(e[0])&&(e=[e[1],e[0]]),this.importDetails.inRows?this.labelRows(e[0],e[1]):this.labelColumns(e[0],e[1])}setUserLabel(e,t){this.userLabels[e]=t||void 0,this.labelsSummary=this.importDetails.summarizeLabels(25)}askForLabel(e,t,n){let d;return n?d={title:"Label rows",regionName:e.hasSameIx(t)?"row "+e.rowName:"rows "+e.rowName+"-"+t.rowName,label:this.userLabels[e.rowNumber]}:d={title:"Label columns",regionName:e.hasSameIx(t)?"column "+e.colName:"columns "+e.colName+"-"+t.colName,label:this.userLabels[e.rowNumber]},this.dialog.open(si,{data:d}).afterClosed()}labelRows(e,t){if(e.rowIx<0||t.rowIx<0){console.warn("Label rows with col selection",e);return}this.firstTimeCell&&this.firstTimeCell.rowNumber>=e.rowNumber||this.askForLabel(e,t,!0).subscribe(n=>{n!==void 0&&(this.setRowsLabel(e,t,n),n&&this.selectNextRegion(e,t))})}setRowsLabel(e,t,n){n=n.trim();let d=this.colorer.toColor(n);for(let u=e.rowIx;u<=t.rowIx;u++){let h=this.dataSlice.rowsNumbers[u];h===void 0?console.error("No row number for index "+u):(this.rowsLabels[u]=n,this.setUserLabel(h,n),n?this.tableSelector.selectRow(h,d):this.tableSelector.deselectRow(h))}}labelColumns(e,t){if(e.colIx<0||t.colIx<0){console.warn("Label cols with row selection",e);return}if(this.firstTimeCell&&this.firstTimeCell.colNumber>=e.colNumber){console.log("Ignroing labelling as Time col after selection");return}this.askForLabel(e,t,!1).subscribe(n=>{n!==void 0&&(this.setColumnsLabel(e,t,n),n&&this.selectNextRegion(e,t))})}setColumnsLabel(e,t,n){n=n.trim();let d=this.colorer.toColor(n);for(let u=e.colIx;u<=t.colIx;u++){let h=this.dataSlice.columnsNumbers[u];h===void 0?console.error("No col number for index "+u):(this.columnsLabels[u]=n,this.setUserLabel(h,n),n?this.tableSelector.selectCol(h,d):this.tableSelector.deselectCol(h))}}selectNextRegion(e,t){let n=[t.colIx-e.colIx,t.rowIx-e.rowIx],d=this.moveCell(t,[1,1]),u=this.moveCell(d,n);this.isInPage(d)&&(this.isInPage(u)||(u=this.fitToPage(u)),d=this.reselect(d),u=this.reselect(u),this.selected([d,u]))}isInPage(e){return!(e.colIx>=0&&e.colIx>=this.dataSlice.columnsNumbers.length||e.rowIx>=0&&e.rowIx>=this.dataSlice.rowsNumbers.length)}fitToPage(e){let t=e.colIx>=0?this.dataSlice.columnsNumbers.length-1:-1,n=e.rowIx>=0?this.dataSlice.rowsNumbers.length-1:-1;return new y(t,void 0,void 0,n,void 0,void 0,void 0)}moveCell(e,t){let n=e.colIx>=0?e.colIx+t[0]:-1,d=e.rowIx>=0?e.rowIx+t[1]:-1;return new y(n,void 0,void 0,d,void 0,void 0,void 0)}loadColPage(e){this.dataService.slice(new H(this.currentPageSlice.rowPage,e))}loadRowPage(e){this.dataService.slice(new H(e,this.currentPageSlice.colPage))}moreColumns(){this.importDetails.inRows||this.colPaginator.nextPage()}moreRows(){this.importDetails.inRows&&this.rowPaginator.nextPage()}};i.\u0275fac=function(t){return new(t||i)(w(Ft),w(N),w(A))},i.\u0275cmp=x({type:i,selectors:[["bd2-assign-labels-step"]],viewQuery:function(t,n){if(t&1&&(L(Fn,7),L(Bn,7)),t&2){let d;E(d=F())&&(n.colPaginator=d.first),E(d=F())&&(n.rowPaginator=d.first)}},inputs:{importDetails:"importDetails"},features:[Se([N]),z],decls:14,vars:23,consts:[["colPaginator",""],["rowPaginator",""],["role","alert","type","info",1,"alert","alert-info",3,"hidden"],[3,"hidden"],[3,"page","length","disabled","pageSize","pageIndex","pageSizeOptions"],[3,"selected","moreColumns","moreRows","dataSlice","columnsLabels","rowsLabels","styler","selectRows","selectCols"],[3,"page","length","disabled","pageSize","pageSizeOptions"],["type","danger","class","alert alert-danger mt-2","role","alert",4,"ngIf"],[2,"margin-top","1em"],["type","danger","role","alert",1,"alert","alert-danger","mt-2"]],template:function(t,n){if(t&1){let d=S();l(0,"div",2),m(1),s(),l(2,"div",3)(3,"mat-paginator",4,0),C("page",function(h){return _(d),g(n.loadColPage(h))}),s()(),l(5,"bd2-selectable-region-mdtable",5),C("selected",function(h){return _(d),g(n.selected(h))})("moreColumns",function(){return _(d),g(n.moreColumns())})("moreRows",function(){return _(d),g(n.moreRows())}),s(),l(6,"div",3)(7,"mat-paginator",6,1),C("page",function(h){return _(d),g(n.loadRowPage(h))}),s()(),f(9,Vn,2,1,"div",7),l(10,"div",8)(11,"label"),m(12,"Selected labels: "),s(),m(13),s()}t&2&&(c("hidden",(n.importDetails==null||n.importDetails.userLabels==null?null:n.importDetails.userLabels.length)>1),r(),b(" Click and drag over ",n.importDetails==null?null:n.importDetails.inLabel,` headers to label the data.
`),r(),c("hidden",n.importDetails==null?null:n.importDetails.inRows),r(),c("length",n.dataSlice==null?null:n.dataSlice.totalColumns)("disabled",n.importDetails==null?null:n.importDetails.inRows)("pageSize",n.currentPageSlice.colPage.pageSize)("pageIndex",n.currentPageSlice.colPage.pageIndex)("pageSizeOptions",ze(21,ci)),r(2),c("dataSlice",n.dataSlice)("columnsLabels",n.columnsLabels)("rowsLabels",n.rowsLabels)("styler",n.tableSelector.tableStyler)("selectRows",n.importDetails==null?null:n.importDetails.inRows)("selectCols",!(n.importDetails!=null&&n.importDetails.inRows)),r(),c("hidden",!(n.importDetails!=null&&n.importDetails.inRows)),r(),c("length",n.dataSlice==null?null:n.dataSlice.totalRows)("disabled",!(n.importDetails!=null&&n.importDetails.inRows))("pageSize",n.firstPageSlice.rowPage.pageSize)("pageSizeOptions",ze(22,ci)),r(2),c("ngIf",!n.hasSeenAll()),r(4),b("",n.labelsSummary,`
`))},dependencies:[v,_t,mi],encapsulation:2});let a=i;return a})();var Pn=["backgroundInput"],An=["auto"];function Un(a,i){a&1&&(l(0,"mat-icon",14),m(1,"cancel"),s())}function Wn(a,i){if(a&1){let o=S();l(0,"mat-chip-row",12),C("removed",function(){let t=_(o).$implicit,n=p(2);return g(n.remove(t))}),m(1),f(2,Un,2,0,"mat-icon",13),s()}if(a&2){let o=i.$implicit,e=p(2);c("removable",e.removable),r(),b(" ",o," "),r(),c("ngIf",e.removable)}}function Hn(a,i){if(a&1&&(l(0,"mat-option",15),m(1),s()),a&2){let o=i.$implicit;c("value",o),r(),b(" ",o," ")}}function zn(a,i){if(a&1){let o=S();l(0,"div")(1,"mat-card",4)(2,"mat-card-content")(3,"div",5),m(4," Select labels for which data should be treated as the background noise "),s(),l(5,"mat-form-field",6)(6,"mat-chip-grid",7,0),f(8,Wn,3,3,"mat-chip-row",8),l(9,"input",9,1),C("matChipInputTokenEnd",function(t){_(o);let n=p();return g(n.add(t))}),s()(),l(11,"mat-autocomplete",10,2),C("optionSelected",function(t){_(o);let n=p();return g(n.selected(t))}),f(13,Hn,2,2,"mat-option",11),at(14,"async"),s()()()()()}if(a&2){let o=re(7),e=re(12),t=p();r(8),c("ngForOf",t.backgrounds),r(),c("formControl",t.backgroundCtrl)("matAutocomplete",e)("matChipInputFor",o)("matChipInputSeparatorKeyCodes",t.separatorKeysCodes)("matChipInputAddOnBlur",t.addOnBlur),r(4),c("ngForOf",rt(14,7,t.filteredLabels))}}var di=(()=>{let i=class i{get backgrounds(){return this.importDetails?this.importDetails.backgroundsLabels:[]}set backgrounds(e){this.importDetails.backgroundsLabels=e}constructor(e){this.tsFileService=e,this.selectable=!0,this.removable=!0,this.addOnBlur=!1,this.separatorKeysCodes=[13,188],this.backgroundCtrl=new mt,this.allLabels=[]}ngOnInit(){this.filteredLabels=this.backgroundCtrl.valueChanges.pipe(tt(null),fe(e=>e?this.filter(e):this.allLabels))}loadLabels(){if(!this.importDetails||!this.importDetails.fileId){this.updateAllLabels([]);return}this.importDetails.importLabels?this.importDetails.labelsSelection&&this.tsFileService.previewLabels(this.importDetails.fileId,this.importDetails.importFormat.name,this.importDetails.labelsSelection,this.importDetails.inRows).subscribe(e=>{this.updateAllLabels(this.unique(e))}):this.updateAllLabels(this.unique(this.importDetails.userLabels))}updateAllLabels(e){this.allLabels=e.slice().sort();let t=this.backgrounds||[];this.backgrounds=[],t.forEach(n=>this.addBackground(n)),this.backgroundCtrl.setValue(" "),this.backgroundCtrl.setValue(null)}unique(e){return e=e.filter(n=>!!n).map(n=>n.trim()),[...new Set(e)]}addBackground(e){if((e||"").trim()){let t=this.backgrounds.indexOf(e),n=this.allLabels.indexOf(e);t<0&&n>=0&&this.backgrounds.push(e.trim())}}add(e){if(!this.matAutocomplete.isOpen){let t=e.input,n=e.value;this.addBackground(n),t&&(t.value=""),this.backgroundCtrl.setValue(null)}}remove(e){let t=this.backgrounds.indexOf(e);t>=0&&this.backgrounds.splice(t,1)}selected(e){this.addBackground(e.option.viewValue),this.backgroundInput.nativeElement.value="",this.backgroundCtrl.setValue(null)}filter(e){let t=e.toLowerCase();return this.allLabels.filter(n=>n.toLowerCase().includes(t)).slice(0,7)}};i.\u0275fac=function(t){return new(t||i)(w(pe))},i.\u0275cmp=x({type:i,selectors:[["bd2-select-backgrounds-labels-step"]],viewQuery:function(t,n){if(t&1&&(L(Pn,5),L(An,5)),t&2){let d;E(d=F())&&(n.backgroundInput=d.first),E(d=F())&&(n.matAutocomplete=d.first)}},inputs:{importDetails:"importDetails"},decls:1,vars:1,consts:[["chipList",""],["backgroundInput",""],["auto","matAutocomplete"],[4,"ngIf"],["appearance","outlined",1,"mat-elevation-z4"],["type","info","role","alert",1,"alert","alert-info"],[2,"width","100%"],["aria-label","Backgrounds selection"],[3,"removable","removed",4,"ngFor","ngForOf"],["placeholder","Type to select background label...",3,"matChipInputTokenEnd","formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur"],[3,"optionSelected"],[3,"value",4,"ngFor","ngForOf"],[3,"removed","removable"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"]],template:function(t,n){t&1&&f(0,zn,15,9,"div",3),t&2&&c("ngIf",n.importDetails==null?null:n.importDetails.containsBackgrounds)},dependencies:[j,v,se,$,pt,X,ce,M,B,St,wt,bt,Ct,gt,yt,Tt,lt],encapsulation:2});let a=i;return a})();var Qn=["stepper"],Gn=["importLabelsStep"],qn=["assignLabelsStep"],Kn=["selectBackgroundsStep"];function $n(a,i){a&1&&m(0,"Upload data file")}function Xn(a,i){a&1&&m(0,"Data layout")}function Yn(a,i){if(a&1&&m(0),a&2){let o=p();b("Define time ",o.importDetails.inLabel,"")}}function Zn(a,i){a&1&&m(0,"Label data")}function Jn(a,i){if(a&1){let o=S();T(0),l(1,"mat-step",17),f(2,Zn,1,0,"ng-template",7),D(3,"mat-divider")(4,"bd2-import-details-summary",23)(5,"bd2-assign-labels-step",9,2),l(7,"div")(8,"button",15),m(9,"Back"),s(),l(10,"button",18),C("click",function(){_(o);let t=p();return g(t.startChoosingBackgrounds())}),m(11,"Next"),s()()(),I()}if(a&2){let o=p();r(),c("completed",o.importDetails.areLabelsCorrectlyAssigned()),r(3),c("importDetails",o.importDetails)("showTime",!0),r(),c("importDetails",o.importDetails),r(5),c("disabled",!o.importDetails.areLabelsCorrectlyAssigned())}}function eo(a,i){if(a&1&&m(0),a&2){let o=p(2);b("Select labels ",o.importDetails.inLabelNeg,"")}}function to(a,i){a&1&&m(0,"Select data start")}function io(a,i){if(a&1){let o=S();T(0),l(1,"mat-step",17),f(2,eo,1,1,"ng-template",7),D(3,"mat-divider")(4,"bd2-import-details-summary",23)(5,"bd2-import-labels-step",9,3),l(7,"div")(8,"button",15),m(9,"Back"),s(),l(10,"button",18),C("click",function(){_(o);let t=re(17),n=p();return g(n.loadData(t))}),m(11,"Next"),s()()(),l(12,"mat-step",17),f(13,to,1,0,"ng-template",7),D(14,"mat-divider")(15,"bd2-import-details-summary",24)(16,"bd2-select-data-start-step",9,4),l(18,"div")(19,"button",15),m(20,"Back"),s(),l(21,"button",18),C("click",function(){_(o);let t=p();return g(t.startChoosingBackgrounds())}),m(22,"Next"),s()()(),I()}if(a&2){let o=p();r(),c("completed",o.importDetails.areLabelsCorrectlySelected()),r(3),c("importDetails",o.importDetails)("showTime",!0),r(),c("importDetails",o.importDetails),r(5),c("disabled",!o.importDetails.areLabelsCorrectlySelected()),r(2),c("completed",o.importDetails.areLabelsCorrectlySelected()&&o.importDetails.isDataStartCorrectlySelected()),r(3),c("importDetails",o.importDetails)("showTime",!0)("showLabelling",!0),r(),c("importDetails",o.importDetails),r(5),c("disabled",!o.importDetails.isDataStartCorrectlySelected())}}function no(a,i){a&1&&m(0,"Select backgrounds labels")}function oo(a,i){if(a&1&&(T(0),l(1,"mat-step"),f(2,no,1,0,"ng-template",7),D(3,"mat-divider")(4,"bd2-import-details-summary",20)(5,"bd2-select-backgrounds-labels-step",9,5),l(7,"div")(8,"button",15),m(9,"Back"),s(),l(10,"button",25),m(11,"Next"),s()()(),I()),a&2){let o=p();r(4),c("importDetails",o.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),r(),c("importDetails",o.importDetails)}}function ao(a,i){a&1&&m(0,"Import timeseries")}var ui=(()=>{let i=class i{constructor(e,t,n){this.fileService=e,this.feedback=t,this.dataService=n,this.import=new W,this.oldImport=new W,this.blocked=!1,this.importDetails=new Jt,this.importDetails.timeType=te.TIME_IN_HOURS}ngOnInit(){}ngOnDestroy(){this.dataService&&this.dataService.close()}upload(e){if(!e.files||e.files.length!==1){console.error("Wrong upload files size",e.files);return}this.fileService.uploadFile(e.files[0],e.importFormat).subscribe(t=>{this.importDetails.fileId=t,this.importDetails.fileName=e.files[0].name,this.importDetails.importFormat=e.importFormat,e.importFormat==K.EXCEL_TABLE?this.importDetails.inRows=!1:this.importDetails.inRows=!0,this.stepper.next(),e.importFormat==K.TOPCOUNT&&this.oldImport.next(this.importDetails)},t=>{this.feedback.error(t)})}loadData(e){e.loadData()}startLabelling(){this.importDetails.importLabels?this.importLabelsStep?this.importLabelsStep.loadData():console.error("Missing importLabelStep"):this.assignLabelsStep?this.assignLabelsStep.loadData():console.error("Missing assignLabelsStep")}startChoosingBackgrounds(){this.importDetails.containsBackgrounds&&(this.selectBackgroundsStep?this.selectBackgroundsStep.loadLabels():console.error("Missing selectBackgroundsStep"))}importData(){this.importDetails.isComplete()&&this.import.next(this.importDetails)}};i.\u0275fac=function(t){return new(t||i)(w(pe),w(A),w(N))},i.\u0275cmp=x({type:i,selectors:[["bd2-import-steps"]],viewQuery:function(t,n){if(t&1&&(L(Qn,5),L(Gn,5),L(qn,5),L(Kn,5)),t&2){let d;E(d=F())&&(n.stepper=d.first),E(d=F())&&(n.importLabelsStep=d.first),E(d=F())&&(n.assignLabelsStep=d.first),E(d=F())&&(n.selectBackgroundsStep=d.first)}},inputs:{blocked:"blocked"},outputs:{import:"import",oldImport:"oldImport"},features:[Se([N])],decls:62,vars:26,consts:[["stepper",""],["defineTimeStep",""],["assignLabelsStep",""],["importLabelsStep",""],["selectDataStartStep",""],["selectBackgroundsStep",""],[3,"linear"],["matStepLabel",""],[3,"uploadFiles"],[3,"importDetails"],["appearance","outlined",1,"mat-elevation-z4"],["name","inRows",1,"spaced",3,"ngModelChange","ngModel"],[3,"value"],["name","importLabels",1,"spaced",3,"ngModelChange","ngModel"],["name","containsBackgrounds",1,"spaced",3,"ngModelChange","ngModel"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","type","button",3,"click"],[3,"completed"],["mat-button","","matStepperNext","","type","button",3,"click","disabled"],[4,"ngIf"],[3,"importDetails","showTime","showLabelling","showDataStart"],["type","info","role","alert",1,"alert","alert-info"],["mat-button","",3,"click","disabled"],[3,"importDetails","showTime"],[3,"importDetails","showTime","showLabelling"],["mat-button","","matStepperNext","","type","button"]],template:function(t,n){if(t&1){let d=S();l(0,"mat-vertical-stepper",6,0)(2,"mat-step"),f(3,$n,1,0,"ng-template",7),l(4,"bd2-upload-data-file-step",8),C("uploadFiles",function(h){return _(d),g(n.upload(h))}),s()(),l(5,"mat-step")(6,"form"),f(7,Xn,1,0,"ng-template",7),D(8,"mat-divider")(9,"bd2-import-details-summary",9),l(10,"mat-card",10)(11,"mat-card-content")(12,"p")(13,"mat-radio-group",11),P("ngModelChange",function(h){return _(d),O(n.importDetails.inRows,h)||(n.importDetails.inRows=h),g(h)}),l(14,"mat-radio-button",12),m(15,"Data in rows"),s(),l(16,"mat-radio-button",12),m(17,"Data in columns"),s()()(),l(18,"p")(19,"mat-radio-group",13),P("ngModelChange",function(h){return _(d),O(n.importDetails.importLabels,h)||(n.importDetails.importLabels=h),g(h)}),l(20,"mat-radio-button",12),m(21),s(),l(22,"mat-radio-button",12),m(23,"Manually label"),s()()(),l(24,"p")(25,"mat-radio-group",14),P("ngModelChange",function(h){return _(d),O(n.importDetails.containsBackgrounds,h)||(n.importDetails.containsBackgrounds=h),g(h)}),l(26,"mat-radio-button",12),m(27,"No noise data"),s(),l(28,"mat-radio-button",12),m(29),s()()()(),l(30,"mat-card-actions")(31,"button",15),m(32,"Back"),s(),l(33,"button",16),C("click",function(){_(d);let h=re(40);return g(n.loadData(h))}),m(34,"Next"),s()()()()(),l(35,"mat-step",17),f(36,Yn,1,1,"ng-template",7),D(37,"mat-divider")(38,"bd2-import-details-summary",9)(39,"bd2-define-time-step",9,1),l(41,"div")(42,"button",15),m(43,"Back"),s(),l(44,"button",18),C("click",function(){return _(d),g(n.startLabelling())}),m(45,"Next"),s()()(),f(46,Jn,12,5,"ng-container",19)(47,io,23,11,"ng-container",19)(48,oo,12,5,"ng-container",19),l(49,"mat-step",17),f(50,ao,1,0,"ng-template",7),D(51,"mat-divider")(52,"bd2-import-details-summary",20),l(53,"mat-card",10)(54,"mat-card-content")(55,"div",21),m(56,"You can now import the timeseries"),s()()(),l(57,"div")(58,"button",15),m(59,"Back"),s(),l(60,"button",22),C("click",function(){return _(d),g(n.importData())}),m(61,"Import data"),s()()()()}t&2&&(c("linear",!0),r(9),c("importDetails",n.importDetails),r(4),V("ngModel",n.importDetails.inRows),r(),c("value",!0),r(2),c("value",!1),r(3),V("ngModel",n.importDetails.importLabels),r(),c("value",!0),r(),b("Import labels from ",n.importDetails.inLabelNeg,""),r(),c("value",!1),r(3),V("ngModel",n.importDetails.containsBackgrounds),r(),c("value",!1),r(2),c("value",!0),r(),b("Background noise in ",n.importDetails.inLabel,"s"),r(6),c("completed",n.importDetails.isTimeDefined()),r(3),c("importDetails",n.importDetails),r(),c("importDetails",n.importDetails),r(5),c("disabled",!n.importDetails.isTimeDefined()),r(2),c("ngIf",!n.importDetails.importLabels),r(),c("ngIf",n.importDetails.importLabels),r(),c("ngIf",n.importDetails.containsBackgrounds),r(),c("completed",n.importDetails.isComplete()),r(3),c("importDetails",n.importDetails)("showTime",!0)("showLabelling",!0)("showDataStart",!0),r(8),c("disabled",n.blocked||!n.importDetails.isComplete()))},dependencies:[v,De,$,we,me,xe,Wt,Ht,M,vt,B,xt,Qt,jt,Gt,qt,Kt,ye,ii,ni,ai,ri,li,pi,di],encapsulation:2});let a=i;return a})();function lo(a,i){a&1&&(l(0,"mat-card",2)(1,"mat-card-content"),D(2,"mat-spinner",3),l(3,"div",4),m(4,"Importing ...."),s()()())}var fi=(()=>{let i=class i extends At{constructor(e,t){super(t),this.BD2REST=e,this.importing=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit()}importData(e){if(this.importing)return;let t=new Zt;t.fileId=e.fileId,t.importFormat=e.importFormat,t.importParameters=e,this.importing=!0,this.BD2REST.experimentImportTS(this.assay.id,t).subscribe(n=>{let d="Imported "+n.imported+" timeseries";this.feedback.success(d),this.refreshModel(),this.importing=!1,this.goToTSView()},n=>{this.importing=!1,this.feedback.error(n)})}goToTSView(){let e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}goToOldImport(e){let t=this.expHomePath();t.push("data","ts-old-import",e.importFormat.name,e.fileId),this.router.navigate(t)}};i.\u0275fac=function(t){return new(t||i)(w(le),w(Nt))},i.\u0275cmp=x({type:i,selectors:[["bd2-tsimport-dashboard"]],features:[z],decls:2,vars:1,consts:[[3,"import","oldImport"],["appearance","outlined",4,"ngIf"],["appearance","outlined"],[1,"center-block"],[2,"margin-top","0.5em","text-align","center"]],template:function(t,n){t&1&&(l(0,"bd2-import-steps",0),C("import",function(u){return n.importData(u)})("oldImport",function(u){return n.goToOldImport(u)}),s(),f(1,lo,5,0,"mat-card",1)),t&2&&(r(),c("ngIf",n.importing))},dependencies:[v,zt,M,B,ui],encapsulation:2});let a=i;return a})();var so=[{path:"",children:[{path:"",component:fi}]}],hi=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=be({type:i}),i.\u0275inj=ge({imports:[je.forChild(so),je]});let a=i;return a})();var rr=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=be({type:i}),i.\u0275inj=ge({imports:[st,ut,ft,Xt,$t,hi]});let a=i;return a})();export{rr as TsImportModule};
