import{a as Q}from"./chunk-EDOAR6V4.js";import{a as q,b as J}from"./chunk-SA672R6Q.js";import{Aa as R,Ab as v,Bb as f,Bc as W,Ca as o,Cb as O,Da as b,Ec as Z,Fc as E,Ic as k,Jc as T,Lb as d,Lc as Y,Ma as u,Mb as m,Na as P,Nb as G,Sa as h,Wa as p,X as B,Y as x,_ as A,a as w,ac as I,bc as M,da as N,db as r,eb as s,ec as H,fb as c,fc as C,gc as K,jc as $,mb as z,ob as _,xc as U,za as L,zb as n}from"./chunk-L7CH4MQ7.js";var y=(()=>{class a{constructor(e){this.BD2REST=e}getUsageData(){return this.BD2REST.getUsageData()}static{this.\u0275fac=function(t){return new(t||a)(A(W))}}static{this.\u0275prov=B({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function re(a,S){if(a&1&&(r(0,"tr")(1,"td"),n(2),s(),r(3,"td"),n(4),d(5,"number"),s()()),a&2){let e=S.$implicit;o(2),v(e.country),o(2),v(m(5,2,e.activeUsers))}}var V=(()=>{class a{constructor(e){this.usagedataService=e,this.API_KEY=Q.googleAnalyticsApiKey,this.topCountries=[]}ngOnInit(){this.fetchAnalyticsData()}fetchAnalyticsData(){this.usagedataService.getUsageData().subscribe(e=>{console.log("API Response:",e);let t=e.analytics;this.topCountries=t.sort((i,l)=>l.activeUsers-i.activeUsers).slice(0,5),this.drawChart(t)},e=>{console.error("Error fetching analytics data:",e)})}drawChart(e){google.charts.load("current",{packages:["geochart"],mapsApiKey:this.API_KEY}),google.charts.setOnLoadCallback(()=>{let t=[["Country","Users"]];e.forEach(j=>{t.push([j.country,j.activeUsers])}),console.log("Chart Data:",t);let i=google.visualization.arrayToDataTable(t),l={colorAxis:{colors:["#9fc5e8","#4374e0"]}};new google.visualization.GeoChart(document.getElementById("chart_div")).draw(i,l)})}static{this.\u0275fac=function(t){return new(t||a)(b(y))}}static{this.\u0275cmp=u({type:a,selectors:[["bd2-google-analytics"]],standalone:!1,decls:20,vars:1,consts:[[1,"row"],[1,"col-sm-8"],["id","chart_div",2,"width","100%","height","400px"],[1,"col-sm-4"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"text-right"]],template:function(t,i){t&1&&(r(0,"div")(1,"h3"),n(2,"Number of users per country"),s(),r(3,"small"),n(4,"Includes non-registered users."),s(),r(5,"div",0)(6,"div",1),c(7,"div",2),s(),r(8,"div",3)(9,"table",4)(10,"thead")(11,"tr")(12,"th"),n(13,"Country"),s(),r(14,"th"),n(15,"Active users"),s()()(),r(16,"tbody"),h(17,re,6,4,"tr",5),s()(),r(18,"p",6),n(19,"(last 12 months)"),s()()()()),t&2&&(o(17),p("ngForOf",i.topCountries))},dependencies:[I,C],encapsulation:2})}}return a})();function oe(a,S){if(a&1&&(r(0,"div",1),c(1,"canvas",2),s()),a&2){let e=_();o(),p("type","bar")("datasets",e.dataset)("options",e.barOptions)("labels",e.labels)}}var X=(()=>{class a{constructor(){this.barColor="rgba(75, 192, 192, 0.4)",this.barOptions={scales:{x:{type:"category",position:"bottom",stacked:!0},y:{beginAtZero:!0,stacked:!0}},plugins:{legend:{display:!0,position:"top"}}}}ngOnInit(){this.updateChart()}ngOnChanges(e){(e.publicData||e.privateData)&&this.updateChart()}updateChart(){if(this.publicData||this.privateData){console.log("Input public data:",this.publicData),console.log("Input private data:",this.privateData);let e=this.publicData&&this.publicData.length?this.publicData:this.privateData;e?this.labels=e.map(t=>t.year.toString()):this.labels=[],this.dataset=[],this.privateData&&this.privateData.length&&this.dataset.push({label:this.publicData&&this.publicData.length?`Private ${this.chartLabel}`:this.chartLabel,data:this.privateData.map(t=>t.value),backgroundColor:"rgba(128, 128, 128, 0.4)",borderColor:"rgba(128, 128, 128, 1)",borderWidth:1}),this.publicData&&this.publicData.length&&this.dataset.push({label:this.privateData&&this.privateData.length?`Public ${this.chartLabel}`:this.chartLabel,data:this.publicData.map(t=>t.value),backgroundColor:this.barColor,borderColor:this.barColor.replace("0.4","1"),borderWidth:1}),console.log("Chart labels:",this.labels),console.log("Chart dataset:",this.dataset)}}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275cmp=u({type:a,selectors:[["bd2-usage-stats-plot"]],inputs:{publicData:"publicData",privateData:"privateData",chartLabel:"chartLabel",barColor:"barColor"},standalone:!1,features:[N],decls:1,vars:1,consts:[["class","chart-container",4,"ngIf"],[1,"chart-container"],["baseChart","","width","auto","height","200",3,"type","datasets","options","labels"]],template:function(t,i){t&1&&h(0,oe,2,4,"div",0),t&2&&p("ngIf",i.dataset)},dependencies:[M,q],styles:[".chart-container[_ngcontent-%COMP%]{width:100%;margin:0 auto}"]})}}return a})();function pe(a,S){if(a&1&&(r(0,"div"),n(1),d(2,"number"),d(3,"number"),c(4,"br"),n(5),d(6,"number"),d(7,"number"),c(8,"br"),n(9),d(10,"number"),s()),a&2){let e=_();o(),O(" Number of experiments: ",m(2,5,e.totalSets)," (",m(3,7,e.totalPublicSets)," are public)."),o(4),O(" Number of timeseries: ",m(6,9,e.totalSeries)," (",m(7,11,e.totalPublicSeries)," are public)."),o(4),f(" Number of registered users: ",m(10,13,e.totalUsers),`.
`)}}var ee=(()=>{class a{constructor(e){this.usagedataService=e,this.totalSets=0,this.totalSeries=0,this.totalPublicSets=0,this.totalPublicSeries=0,this.totalUsers=0,this.usersPerYear=[],this.publicSetsPerYear=[],this.publicSeriesPerYear=[],this.privateSetsPerYear=[],this.privateSeriesPerYear=[]}ngOnInit(){this.fetchUsageStats()}fetchUsageStats(){this.usagedataService.getUsageData().subscribe(e=>{console.log("API Response:",e);let t=e.year_stats;this.usageStats=e,this.totalSets=t.reduce((i,l)=>i+l.sets,0),this.totalSeries=t.reduce((i,l)=>i+l.series,0),this.totalPublicSets=t.reduce((i,l)=>i+l.public_sets,0),this.totalPublicSeries=t.reduce((i,l)=>i+l.public_series,0),this.totalUsers=t.reduce((i,l)=>i+l.users,0),this.usersPerYear=t.map(i=>({year:i.year,value:i.users})),this.publicSetsPerYear=t.map(i=>({year:i.year,value:i.public_sets})),this.publicSeriesPerYear=t.map(i=>({year:i.year,value:i.public_series})),this.privateSetsPerYear=t.map(i=>({year:i.year,value:i.sets-i.public_sets})),this.privateSeriesPerYear=t.map(i=>({year:i.year,value:i.series-i.public_series}))},e=>{console.error("Error fetching usage stats:",e)})}static{this.\u0275fac=function(t){return new(t||a)(b(y))}}static{this.\u0275cmp=u({type:a,selectors:[["bd2-usage-stats"]],standalone:!1,decls:9,vars:6,consts:[[4,"ngIf"],[1,"charts-container"],["chartLabel","Exp.","barColor","rgba(31, 119, 180, 0.4)",3,"publicData","privateData"],["chartLabel","Series","barColor","rgba(255, 127, 14, 0.4)",3,"publicData","privateData"],["chartLabel","User Registrations","barColor","rgba(44, 160, 44, 0.4)",3,"publicData"]],template:function(t,i){t&1&&(h(0,pe,11,15,"div",0),c(1,"br"),r(2,"div",1),c(3,"bd2-usage-stats-plot",2)(4,"bd2-usage-stats-plot",3)(5,"bd2-usage-stats-plot",4),s(),r(6,"small"),n(7,`
Hover on the bars to see the exact numbers. Click on the legend to hide/show the data.`),c(8,"br"),s()),t&2&&(p("ngIf",i.usageStats),o(3),p("publicData",i.publicSetsPerYear)("privateData",i.privateSetsPerYear),o(),p("publicData",i.publicSeriesPerYear)("privateData",i.privateSeriesPerYear),o(),p("publicData",i.usersPerYear))},dependencies:[M,X,C],styles:[".charts-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;gap:10px}.charts-container[_ngcontent-%COMP%]   bd2-usage-stats-plot[_ngcontent-%COMP%]{flex:1 1 calc(33.33% - 20px);margin:0;min-width:300px}"]})}}return a})();var te=(()=>{class a{constructor(){this.data={state:"default"}}ngOnInit(){}cardClicked(){this.data.state==="default"?this.data.state="flipped":this.data.state="default"}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275cmp=u({type:a,selectors:[["bd2-species-card"]],inputs:{name:"name",image:"image",reference:"reference",datasets:"datasets",publicDatasets:"publicDatasets",timeseries:"timeseries",publicTimeseries:"publicTimeseries",keywords:"keywords"},standalone:!1,decls:25,vars:18,consts:[[1,"card",3,"click"],[1,"face","back"],[1,"species"],[3,"src"],[1,"reference",3,"innerHTML"],[1,"face","front"]],template:function(t,i){t&1&&(r(0,"div",0),z("click",function(){return i.cardClicked()}),r(1,"div",1)(2,"div",2),n(3),s(),c(4,"img",3)(5,"small",4),s(),r(6,"div",5)(7,"div",2),n(8),s(),n(9),d(10,"number"),c(11,"br"),r(12,"small"),n(13),d(14,"number"),s(),n(15),d(16,"number"),c(17,"br"),r(18,"small"),n(19),d(20,"number"),s(),c(21,"br"),r(22,"b"),n(23,"Popular keywords"),s(),n(24),s()()),t&2&&(p("@cardFlip",i.data.state),o(3),v(i.name),o(),p("src",i.image,R),o(),p("innerHTML",i.reference,L),o(3),v(i.name),o(),f(" Experiments: ",m(10,10,i.datasets)," "),o(4),f("(Public: ",m(14,12,i.publicDatasets),")"),o(2),f(" Timeseries: ",m(16,14,i.timeseries)," "),o(4),f("(Public: ",m(20,16,i.publicTimeseries),")"),o(5),f("",i.keywords," "))},dependencies:[C],styles:["[_nghost-%COMP%]{display:block;perspective:600px}.card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;box-shadow:10px 10px 43px -18px #000000bf;border-radius:20px;height:250px;width:200px;cursor:pointer;position:relative;transform-style:preserve-3d}.face[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;position:absolute;width:100%;height:100%;border-radius:inherit;backface-visibility:hidden}.face[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:90%;height:70%;object-fit:cover;border-radius:inherit}.front[_ngcontent-%COMP%]{transform:rotateY(180deg)}.back[_ngcontent-%COMP%]{transform:rotateY(0)}.reference[_ngcontent-%COMP%]{font-size:.7em}.species[_ngcontent-%COMP%]{font-style:italic;font-weight:700}.reference[_ngcontent-%COMP%]{display:block;height:3em}"],data:{animation:[Z("cardFlip",[T("default",k({transform:"none"})),T("flipped",k({transform:"rotateY(180deg)"})),Y("default => flipped",[E("400ms")]),Y("flipped => default",[E("200ms")])])]}})}}return a})();function me(a,S){if(a&1&&c(0,"bd2-species-card",2),a&2){let e=S.$implicit;p("name",e.name)("image",e.image)("reference",e.reference)("datasets",e.sets)("publicDatasets",e.public_sets)("timeseries",e.series)("publicTimeseries",e.public_series)("keywords",e.keywords)}}var ie=(()=>{class a{constructor(e,t){this.usageDataService=e,this.http=t,this.speciesStats=[],this.speciesInfo=[],this.speciesData=[]}ngOnInit(){this.loadSpeciesInfo()}loadSpeciesInfo(){this.http.get("assets/species/species-info.json").subscribe(e=>{this.speciesInfo=e,this.fetchSpeciesStats()},e=>{console.error("Error loading static species info",e)})}fetchSpeciesStats(){this.usageDataService.getUsageData().subscribe(e=>{this.speciesStats=e.species_stats,this.speciesData=this.speciesInfo.map(t=>{let i=this.speciesStats.find(l=>l.species===t.name);return i?w(w({},t),i):t})},e=>{console.error("Error fetching species stats from backend",e)})}static{this.\u0275fac=function(t){return new(t||a)(b(y),b($))}}static{this.\u0275cmp=u({type:a,selectors:[["bd2-species-cards"]],standalone:!1,decls:6,vars:1,consts:[[1,"species-cards"],[3,"name","image","reference","datasets","publicDatasets","timeseries","publicTimeseries","keywords",4,"ngFor","ngForOf"],[3,"name","image","reference","datasets","publicDatasets","timeseries","publicTimeseries","keywords"]],template:function(t,i){t&1&&(r(0,"h3"),n(1,"Species on BioDare2"),s(),r(2,"small"),n(3,"Click the cards for more details!"),s(),r(4,"div",0),h(5,me,1,8,"bd2-species-card",1),s()),t&2&&(o(5),p("ngForOf",i.speciesData))},dependencies:[I,te],styles:["[_nghost-%COMP%]{display:block;perspective:600px}.card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;box-shadow:10px 10px 43px -18px #000000bf;border-radius:20px;height:250px;width:200px;cursor:pointer;position:relative;transform-style:preserve-3d}.face[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;position:absolute;width:100%;height:100%;border-radius:inherit;backface-visibility:hidden}.face[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:90%;height:70%;object-fit:cover;border-radius:inherit}.front[_ngcontent-%COMP%]{transform:rotateY(180deg)}.reference[_ngcontent-%COMP%]{font-size:.7em}.species[_ngcontent-%COMP%]{font-style:italic;font-weight:700}.species-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;padding:16px}"]})}}return a})();var ae=(()=>{class a{constructor(){this.currentDate=new Date}ngOnInit(){}static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275cmp=u({type:a,selectors:[["bd2-usage"]],standalone:!1,decls:12,vars:4,template:function(t,i){t&1&&(r(0,"div")(1,"h2"),n(2,"BioDare2 Usage Data"),s(),n(3),d(4,"date"),c(5,"br")(6,"br")(7,"bd2-usage-stats")(8,"hr")(9,"bd2-google-analytics")(10,"hr")(11,"bd2-species-cards"),s()),t&2&&(o(3),f(" Last updated: ",G(4,1,i.currentDate,"longDate"),""))},dependencies:[V,ee,ie,H],encapsulation:2})}}return a})();var fe=[{path:"usage",component:ae}],se=(()=>{class a{static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275mod=P({type:a})}static{this.\u0275inj=x({imports:[U.forChild(fe),U]})}}return a})();var Re=(()=>{class a{static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275mod=P({type:a})}static{this.\u0275inj=x({imports:[K,J,se]})}}return a})();export{Re as a};
