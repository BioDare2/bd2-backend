import{a as c,b as M,c as Q,d as V,e as te,f as ie,g as _,h as D,i as S,j as Be,k as Fe,m as Le,n as Ne}from"./chunk-DORUMKOX.js";import{e as Ae}from"./chunk-K3MGPV5B.js";import{a as Re}from"./chunk-6Y46VPV7.js";import"./chunk-PAVY36OZ.js";import{o as Ve}from"./chunk-ET5TKZBH.js";import{b as Ie,c as Oe}from"./chunk-EZ5WBWOW.js";import"./chunk-EYDQJRZM.js";import"./chunk-3ZZ3OJBF.js";import{a as Ee,b as j,c as ke,d as q,e as U,f as K,g as H}from"./chunk-3DGRJVY4.js";import"./chunk-KOYIGQQW.js";import"./chunk-ZV7YAFTP.js";import"./chunk-63EJLF7N.js";import"./chunk-6UWHHRT4.js";import{B as De,F as Me,G as Se,d as P,i as W,j as ge,k as Ce,m as G,n as _e,o as z,p as be,u as Te,v as we,w as ye,y as xe,z as ve}from"./chunk-LPDAYVF7.js";import"./chunk-24L4UUKZ.js";import{Ab as k,Bb as w,Bc as he,Ca as s,Da as b,Eb as y,Fb as x,Gb as v,Hb as pe,Ma as E,Na as F,Pa as ae,Sa as g,Wa as p,X as ne,Xa as Y,Y as B,_ as le,ac as N,bc as R,db as l,ea as f,eb as r,fa as h,fb as L,gc as ue,jb as C,la as re,mb as T,ob as d,rb as $,sc as fe,tb as se,ub as me,vb as ce,xc as ee,yb as de,zb as a}from"./chunk-Z4WVEEB6.js";var Ze=["columnTypeForm"];function Je(o,m){if(o&1){let e=C();l(0,"li")(1,"input",21,1),v("ngModelChange",function(i){f(e);let n=d();return x(n.cellRole,i)||(n.cellRole=i),h(i)}),r(),a(3),r()}if(o&2){let e=m.$implicit,t=d();s(),$("value",e.name),y("ngModel",t.cellRole),s(2),w(" ",e.label," ")}}function Xe(o,m){if(o&1){let e=C();l(0,"div",12)(1,"label",22),a(2,"Propagate until block size"),r(),l(3,"input",23,2),v("ngModelChange",function(i){f(e);let n=d();return x(n.rangeSize,i)||(n.rangeSize=i),h(i)}),r()()}if(o&2){let e=d();s(3),y("ngModel",e.rangeSize)}}function Ye(o,m){if(o&1){let e=C();l(0,"div",12)(1,"label",24),a(2,"Label"),r(),l(3,"input",25,3),v("ngModelChange",function(i){f(e);let n=d();return x(n.dataLabel,i)||(n.dataLabel=i),h(i)}),r()()}if(o&2){let e=d();s(3),y("ngModel",e.dataLabel)}}function $e(o,m){if(o&1&&(l(0,"option",33),a(1),r()),o&2){let e=m.$implicit;$("value",e.name),s(),w("",e.label," ")}}function et(o,m){if(o&1){let e=C();l(0,"div",12)(1,"label",34),a(2,"Time between images (hours)"),r(),l(3,"input",35,7),v("ngModelChange",function(i){f(e);let n=d(2);return x(n.imgInterval,i)||(n.imgInterval=i),h(i)}),r()()}if(o&2){let e=d(2);s(3),y("ngModel",e.imgInterval)}}function tt(o,m){if(o&1){let e=C();l(0,"div")(1,"div",12)(2,"label",26),a(3,"Type of time column"),r(),l(4,"select",27,4),v("ngModelChange",function(i){f(e);let n=d();return x(n.timeType,i)||(n.timeType=i),h(i)}),g(6,$e,2,2,"option",28),r()(),l(7,"div",12)(8,"label",29),a(9,"Row with first timepoint"),r(),l(10,"input",30,5),v("ngModelChange",function(i){f(e);let n=d();return x(n.firstRow,i)||(n.firstRow=i),h(i)}),r()(),l(12,"div",12)(13,"label",31),a(14,"Time offset (hours)"),r(),l(15,"input",32,6),v("ngModelChange",function(i){f(e);let n=d();return x(n.timeOffset,i)||(n.timeOffset=i),h(i)}),r()(),g(17,et,5,1,"div",15),r()}if(o&2){let e=d();s(4),y("ngModel",e.timeType),s(2),p("ngForOf",e.timeTypeOptions),s(4),y("ngModel",e.firstRow),s(5),y("ngModel",e.timeOffset),s(2),p("ngIf",e.isImageBased())}}function it(o,m){if(o&1&&(l(0,"div",37),a(1),r()),o&2){let e=m.$implicit;s(),k(e)}}function ot(o,m){if(o&1&&(l(0,"div"),g(1,it,2,1,"div",36),r()),o&2){let e=d();s(),p("ngForOf",e.errors)}}var Z=class{constructor(m,e,t,i){this.selectedRange=m,this.lastCol=e,this.showTime=t,this.label=i}},Ge=(()=>{class o{constructor(e,t){this.myself=e,this.errors=null,this.cellRoles=[c.IGNORED,c.BACKGROUND,c.TIME,c.DATA],this.timeTypeOptions=[M.TIME_IN_HOURS,M.TIME_IN_MINUTES,M.TIME_IN_SECONDS,M.IMG_NUMBER],this.lastCol=t.lastCol,this.showTime=t.showTime,this.show(t.selectedRange,t.label)}ngOnInit(){}set showTime(e){e?this.cellRoles=[c.IGNORED,c.BACKGROUND,c.TIME,c.DATA]:this.cellRoles=[c.IGNORED,c.BACKGROUND,c.DATA]}isData(){return this.cellRole===c.DATA.name}isTime(){return this.cellRole===c.TIME.name}isImageBased(){return this.isTime()&&this.timeType===M.IMG_NUMBER.name}show(e,t){e&&(this.orgRange=e,this.rangeSize=e.range.size(),this.rangeLabel=t||e.columnRangeLabel,e.role&&(this.cellRole=e.role.name),e.role==c.DATA&&e.details&&(this.dataLabel=e.details.dataLabel),e.role==c.TIME&&e.details&&(this.timeType=e.details.timeType.name,this.timeOffset=e.details.timeOffset,this.imgInterval=e.details.imgInterval,this.firstRow=e.details.firstRow))}hide(){this.myself.close()}accepted(){this.isValid()&&this.myself.close(this.emitDescription())}acceptedAndNext(){if(!this.isValid())return;let e=this.emitDescription();if(!(e.range.lastCol>=this.lastCol)){let t=this.nextRange(e.range,this.rangeSize),i=new S(t);i.role=c.DATA,i.details=e.details,e.follow=i}this.myself.close(e)}nextRange(e,t){let i=e.lastCol+1,n=i+t-1;return n=Math.min(n,this.lastCol),new D(new _(i,e.first.row),new _(n,e.first.row))}emitDescription(){let e=this.recalculateRange(this.orgRange.range),t={};if(this.isData())t=new V(this.dataLabel);else if(this.isTime()){let n=new Q;n.firstRow=this.firstRow,n.timeType=M.get(this.timeType),n.timeOffset=this.timeOffset,this.isImageBased()&&(n.imgInterval=this.imgInterval),t=n}let i=new S(e,this.orgRange.content);return i.role=c.get(this.cellRole),i.details=t,i}isValid(){let e=[];return c.get(this.cellRole)||e.push("Unknown role: "+this.cellRole),this.isData()&&(!this.dataLabel||this.dataLabel.trim()==="")&&(e.push("Non empty data label is required"),this.dataLabel=null),this.isTime()?((!this.firstRow||this.firstRow<1)&&e.push("Row nr of the first time point must be >= 1"),this.isImageBased()&&(!this.imgInterval||this.imgInterval<=0)&&e.push("Image interval must be > 0")):(!this.rangeSize||this.rangeSize<1)&&e.push("Block size must be >= 1"),e.length===0?(this.errors=null,!0):!1}recalculateRange(e){let t=e.first;if(this.isTime())return t=new _(t.col,this.firstRow),new D(t,t);if(this.rangeSize!==e.size()){let i=t.col+this.rangeSize-1,n=new _(Math.min(i,this.lastCol),t.row);return new D(t,n)}return e}static{this.\u0275fac=function(t){return new(t||o)(b(Ee),b(j))}}static{this.\u0275cmp=E({type:o,selectors:[["ng-component"]],viewQuery:function(t,i){if(t&1&&se(Ze,7),t&2){let n;me(n=ce())&&(i.columnTypeForm=n.first)}},standalone:!1,decls:28,vars:8,consts:[["columnTypeForm","ngForm"],["fCellRole","ngModel"],["fSize","ngModel"],["fDataLabel","ngModel"],["fTimeType","ngModel"],["fFirstRow","ngModel"],["fTimeOffset","ngModel"],["fImgInterval","ngModel"],["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],[1,"form-group"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"click","disabled"],[1,"btn","btn-primary","btn-sm","m-1",3,"click","disabled"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","radio","required","","name","fCellRole",3,"ngModelChange","value","ngModel"],["for","size"],["type","number","step","1","min","1","id","size","required","","name","fSize",1,"form-control",3,"ngModelChange","ngModel"],["for","dataLabel"],["type","text","id","dataLabel","placeholder","e.g. TOC1 SD","required","","minlength","2","name","fDataLabel",1,"form-control",3,"ngModelChange","ngModel"],["for","timeType"],["id","timeType","required","","name","fTimeType",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","firstRow"],["type","number","id","firstRow","step","1","min","1","required","","placeholder","e.g. 2","name","fFirstRow",1,"form-control",3,"ngModelChange","ngModel"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],["for","imgInterval"],["type","number","id","imgInterval","required","","step","any","min","0.01","placeholder","e.g. 1.5","name","fImgInterval",1,"form-control",3,"ngModelChange","ngModel"],["dismissOnTimeout","3000","dismissible","true","class","alert alert-danger","role","alert",4,"ngFor","ngForOf"],["dismissOnTimeout","3000","dismissible","true","role","alert",1,"alert","alert-danger"]],template:function(t,i){if(t&1){let n=C();l(0,"h4",8),a(1,"Describe data column(s) "),l(2,"button",9)(3,"span",10),a(4,"\xD7"),r()()(),l(5,"div",11)(6,"p"),a(7," Columns "),l(8,"strong"),a(9),r()(),l(10,"form",null,0)(12,"div",12)(13,"label"),a(14,"Column type"),r(),l(15,"ul",13),g(16,Je,4,3,"li",14),r()(),g(17,Xe,5,1,"div",15)(18,Ye,5,1,"div",15)(19,tt,18,5,"div",16)(20,ot,2,1,"div",16),r()(),l(21,"div",17)(22,"button",18),T("click",function(){return f(n),h(i.acceptedAndNext())}),a(23,"OK and Next "),r(),l(24,"button",19),T("click",function(){return f(n),h(i.accepted())}),a(25,"OK "),r(),l(26,"button",20),T("click",function(){return f(n),h(i.hide())}),a(27,"Cancel"),r()()}if(t&2){let n=de(11);s(9),w("[",i.rangeLabel,"]"),s(7),p("ngForOf",i.cellRoles),s(),p("ngIf",!i.isTime()),s(),p("ngIf",i.isData()),s(),p("ngIf",i.isTime()),s(),p("ngIf",i.errors),s(2),p("disabled",!n.form.valid),s(2),p("disabled",!n.form.valid)}},dependencies:[N,R,_e,we,ye,P,z,Te,be,W,ge,ve,De,xe,G,Ce,q,U,H,K],encapsulation:2})}}return o})();var ze=(()=>{class o{constructor(e){this.show(e)}ngOnInit(){}show(e){this.orgRange=e,this.rowNr=e.range.first.row,this.values=e.content}static{this.\u0275fac=function(t){return new(t||o)(b(j))}}static{this.\u0275cmp=E({type:o,selectors:[["ng-component"]],standalone:!1,decls:24,vars:3,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],[1,"word_wrapping"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"mat-dialog-close"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm"]],template:function(t,i){t&1&&(l(0,"h4",0),a(1,"Use row content as data labels(s) "),l(2,"button",1)(3,"span",2),a(4,"\xD7"),r()()(),l(5,"div",3)(6,"div")(7,"p"),a(8,"Use values from row "),l(9,"strong"),a(10),r(),a(11," as data labels"),r(),l(12,"p"),a(13,"Existing labels and column types will be overwritten"),r()(),l(14,"div",4)(15,"p")(16,"strong"),a(17,"Labels: "),r(),a(18),r()()(),l(19,"div",5)(20,"button",6),a(21,"Copy labels"),r(),l(22,"button",7),a(23,"Cancel"),r()()),t&2&&(s(10),w("[",i.rowNr,"]"),s(8),k(i.values),s(2),p("mat-dialog-close",i.orgRange))},dependencies:[q,U,H,K],encapsulation:2})}}return o})();var je=(()=>{class o{constructor(e){this.BD2REST=e}getSimpleTableView(e){return this.BD2REST.fileViewSimpleTable(e).then(t=>t.data)}verifyFormat(e,t){return this.BD2REST.fileViewVerifyFormat(e,t).toPromise()}static{this.\u0275fac=function(t){return new(t||o)(le(he))}}static{this.\u0275prov=ne({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var J=class o{constructor(m,e,t,i,n){this.rows=m,this.th=e,this.rowsLabels=t,this.specialRows=i,this.specialRowsLabels=n,this.width=o.maxLength(m),e?this.th=e:this.th=m.length<1?[]:o.labelCols(this.width),this.rowsLabels=t||o.labelRows(m.length),this.specialRows=i||[],this.specialRowsLabels=n||o.blankRows(this.specialRows.length)}static labelRows(m){let e=[];for(let t=1;t<=m;t++)e.push(""+t);return e}static blankRows(m){let e=[];for(let t=0;t<m;t++)e.push("");return e}static maxLength(m){return!m||m.length<1?0:Math.max.apply(Math,m.map(e=>e.length))}static labelCols(m){let e=[];for(let t=1;t<=m;t++)e.push(te(t));return e}};var A=(()=>{class o{static{this.TIME_BG="lightyellow"}static{this.IGNORED_BG="lightgrey"}static{this.NOISE_BG="darkgrey"}static{this.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"]}static color(e){return o.colors[e%o.colors.length]}}return o})();function lt(o,m){o&1&&(l(0,"div",10)(1,"strong"),a(2,"Missing data labels. Please use one of the methods:"),r(),l(3,"ul")(4,"li"),a(5,"Click and draw over the headers of columns to select the range and assign the data labels in the popup dialog. "),r(),l(6,"li"),a(7,"Use the form below to manually provide the column range and the data label."),r()()())}function rt(o,m){if(o&1){let e=C();l(0,"div")(1,"div",11)(2,"label",12),a(3,"Time parameter: offset (hours)"),r(),l(4,"input",13,0),v("ngModelChange",function(i){f(e);let n=d(2);return x(n.timeColumnDescription.details.timeOffset,i)||(n.timeColumnDescription.details.timeOffset=i),h(i)}),r()()()}if(o&2){let e=d(2);s(4),y("ngModel",e.timeColumnDescription.details.timeOffset)}}function at(o,m){if(o&1){let e=C();l(0,"li",17),T("click",function(){let i=f(e).$implicit,n=d(3);return h(n.editBlock(i))}),l(1,"span")(2,"strong"),a(3),r(),a(4),r(),l(5,"a",18),T("click",function(){let i=f(e).$implicit,n=d(3);return h(n.deleteBlock(i))}),l(6,"i",19),a(7,"delete_forever"),r()()()}if(o&2){let e=m.$implicit;s(3),k(e.topcountLabel),s(),w(" : ",e.value,"")}}function st(o,m){if(o&1&&(l(0,"div")(1,"p")(2,"strong"),a(3,"Columns descriptions (select to edit)"),r()(),l(4,"div",14)(5,"ul",15),g(6,at,8,2,"li",16),r()()()),o&2){let e=d(2);s(6),p("ngForOf",e.dataBlocks)}}function mt(o,m){if(o&1){let e=C();l(0,"th",20),T("mousedown",function(){let i=f(e).$implicit,n=d(2);return h(n.thSelectStart(i))})("mouseup",function(){let i=f(e).$implicit,n=d(2);return h(n.thSelectEnd(i))}),a(1),r()}if(o&2){let e=m.$implicit,t=d(2);s(),w(" ",t.dataModel.th[e]," ")}}function ct(o,m){if(o&1&&(l(0,"td"),a(1),r()),o&2){let e=m.$implicit,t=d().$implicit,i=d(2);Y("background-color",i.bgColors[e]?i.bgColors[e]:"inherited"),s(),w("",t[e]," ")}}function dt(o,m){if(o&1&&(l(0,"tr")(1,"td",21),a(2),r(),g(3,ct,2,3,"td",22),r()),o&2){let e=m.index,t=d(2);s(2),k(t.dataModel.specialRowsLabels[e]),s(),p("ngForOf",t.visibleColIx)}}function pt(o,m){if(o&1&&(l(0,"td"),a(1),r()),o&2){let e=m.$implicit,t=d().$implicit,i=d(2);Y("background-color",i.bgColors[e]?i.bgColors[e]:"inherited"),s(),w("",t[e]," ")}}function ut(o,m){if(o&1&&(l(0,"tr")(1,"td",21),a(2),r(),g(3,pt,2,3,"td",22),r()),o&2){let e=m.index,t=d(2);s(2),k(t.dataModel.rowsLabels[e]),s(),p("ngForOf",t.visibleColIx)}}function ft(o,m){if(o&1){let e=C();l(0,"div"),L(1,"hr"),l(2,"div")(3,"h4"),a(4,"Current Topcount import parameters "),r(),g(5,lt,8,0,"div",2)(6,rt,6,1,"div",1)(7,st,7,1,"div",3),l(8,"div")(9,"button",4),T("click",function(){f(e);let i=d();return h(i.accept())}),a(10,"Import timeseries "),r()()(),L(11,"hr"),l(12,"h4"),a(13,"Data table "),l(14,"small"),a(15,"(only top rows)"),r()(),l(16,"p"),a(17,"Click on column headers for description options"),r(),l(18,"div",5)(19,"table",6)(20,"thead")(21,"tr",7),L(22,"th"),g(23,mt,2,1,"th",8),r()(),l(24,"tbody"),g(25,dt,4,2,"tr",9)(26,ut,4,2,"tr",9),r()()()()}if(o&2){let e=d();s(5),p("ngIf",!e.hasData()),s(),p("ngIf",e.timeColumnDescription),s(),p("ngIf",e.dataBlocks&&e.dataBlocks.length>0),s(2),p("disabled",e.blocked||!e.hasTime()||!e.hasData()),s(14),p("ngForOf",e.visibleColIx),s(2),p("ngForOf",e.dataModel.specialRows),s(),p("ngForOf",e.dataModel.rows)}}var qe=(()=>{class o{constructor(e,t){this.confDialogs=e,this.matDialog=t,this.onAccepted=new re,this.blocked=!1,this.confirmDataLoss=!1,this.columnBlocks=new Be,this.dataBlocks=[],this.bgColors=[]}set dataTable(e){if(!e||e.length<1)return;let t=new J(e,this.topcountHeaders(),void 0,[[]],["L."]);this.dataModel=t,this.lastCol=t.width,this.visibleColIx=[];for(let i=0;i<t.width;i++)this.visibleColIx.push(i);this.initTime()}topcountHeaders(){let e=[];return["A","B","C","D","E","F","G","H"].forEach(i=>{for(let n=1;n<13;n++)e.push(i+n)}),e}initTime(){let e=new D(new _(0,0),new _(0,0)),t=new Q;t.timeType=M.TIME_IN_HOURS,t.timeOffset=0,t.firstRow=1;let i=new S(e);i.role=c.TIME,i.details=t,this.timeColumnDescription=i}hasTime(){return this.timeColumnDescription&&this.timeColumnDescription.role===c.TIME}hasData(){return this.dataBlocks.some(e=>e.details.role===c.DATA)}rowSelected(e){let t=this.joinRow(e),i=new _(0,e+1),n=new D(i,i),u=new S(n,t);this.askCopyRow(u)}askCopyRow(e){this.matDialog.open(ze,{data:e,autoFocus:!1}).afterClosed().subscribe(i=>{i&&this.copyRowAsLabels(i)})}thSelectStart(e){this.thSelectedCol=e}thSelectEnd(e){if(this.thSelectedCol!==void 0&&this.thSelectedCol!=null){let t=new _(this.thSelectedCol+1,1),i=new _(e+1,1),n=new D(t,i),u=new S(n,void 0),I=this.columnBlocks.details(t.col);I&&(u.role=I.role,u.details=I.details),this.thSelectedCol=void 0,this.askColumnsDetails(u)}}askColumnsDetails(e){let t=this.rangeToTopcountLabel(e),i=new Z(e,this.lastCol,!1,t);this.matDialog.open(Ge,{data:i,autoFocus:!1}).afterClosed().subscribe(u=>{if(u){let I=u.follow;u.follow=void 0,this.setColumnType(u),I&&this.askColumnsDetails(I)}})}rangeToTopcountLabel(e){let t=e.range;return ie(t.firstCol)+"-"+ie(t.lastCol)}editBlock(e){e&&this.askColumnsDetails(e.details)}deleteBlock(e){e&&(e.details.role==c.TIME?this.clearTime():this.resetRegion(e.details.range),this.dataBlocks=this.columnBlocks.blocks)}accept(){if(!this.hasTime()||!this.hasData())return;let e=Promise.resolve(!0);this.containsDataGaps()&&(e=this.confDialogs.confirm("Do you want to import partial data?","Not all columns are described. Data columns without annotations will not be imported.<br>Click OK if you want to proceed.").toPromise()),e.then(t=>t?this.confirmDataLoss?this.confDialogs.confirm("Do you want to replace the existing data?","It will also erase all analysis results. <br>Click OK if you want to proceed.").toPromise():!0:!1).then(t=>{t&&this.emitParameters()}).catch(t=>console.log("Dialog error: "+t))}containsDataGaps(){if(this.dataBlocks.length<1||this.dataBlocks[this.dataBlocks.length-1].end<this.lastCol)return!0;let e=this.dataBlocks[0].start-1;for(let t=0;t<this.dataBlocks.length;t++){if(this.dataBlocks[t].start!==e+1)return!0;e=this.dataBlocks[t].end}return!1}emitParameters(){let e=new Le;e.timeColumn=this.timeColumnDescription,e.dataBlocks=this.dataBlocks.map(t=>t.details),this.onAccepted.emit(e)}joinRow(e){return this.dataModel.rows[e].slice(0,10).join(" | ")+"..."}setColumnType(e){if(e&&e.role!==void 0){this.timeColumnDescription&&(e.role==c.TIME?this.clearTime():this.timeColumnDescription.firstCol>=e.firstCol&&this.timeColumnDescription.firstCol<=e.lastCol&&this.clearTime());let t;switch(e.role){case c.IGNORED:t="ign.";break;case c.BACKGROUND:t="bcg.";break;case c.TIME:t="Time";break;case c.DATA:t=e.details.dataLabel}this.columnBlocks.insert(e,t),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks;let i=this.dataModel.specialRows[0];if(i)for(let n=e.firstCol-1;n<e.lastCol;n++)i[n]=t;e.role==c.TIME&&(this.timeColumnDescription=e),this.updateBackgrounds()}}copyRowAsLabels(e){if(e){this.clearTime();let t=this.dataModel.specialRows[0];this.dataModel.rows[e.range.first.row-1].forEach((n,u)=>{if(n){let I=new V(n),oe=new _(u+1,0),He=new D(oe,oe),X=new S(He,void 0);X.details=I,X.role=c.DATA,this.columnBlocks.insert(X,n),t[u]=n}}),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks,this.updateBackgrounds()}}clearTime(){this.timeColumnDescription&&(this.resetRegion(this.timeColumnDescription.range),this.timeColumnDescription=void 0)}updateBackgrounds(){for(let e=0;e<this.dataBlocks.length;e++){let t=this.dataBlocks[e],i=A.color(e);t.details.role==c.IGNORED&&(i=A.IGNORED_BG),t.details.role==c.BACKGROUND&&(i=A.NOISE_BG),t.details.role==c.TIME&&(i=A.TIME_BG);for(let n=t.start-1;n<t.end;n++)this.bgColors[n]=i}}resetRegion(e){this.resetLabels(e),this.resetBackground(e),this.columnBlocks.delete(e)}resetBackground(e){for(let t=e.firstCol-1;t<e.lastCol;t++)this.bgColors[t]="transparent"}resetLabels(e){let t=this.dataModel.specialRows[0];for(let i=e.firstCol-1;i<e.lastCol;i++)t[i]="-"}fakeData(){let t=[],i=[];i.push("");for(let n=1;n<25;n++)i.push("RO "+n);t.push(i),i=[],i.push("");for(let n=1;n<25;n++)i.push("cls"+Math.round(n/3));t.push(i);for(let n=1;n<5;n++){i=[],i.push(""+n);for(let u=1;u<25;u++)i.push(""+(n+u));t.push(i)}return t}static{this.\u0275fac=function(t){return new(t||o)(b(Re),b(ke))}}static{this.\u0275cmp=E({type:o,selectors:[["bd2-describe-topcount-table"]],inputs:{blocked:"blocked",confirmDataLoss:"confirmDataLoss",dataTable:"dataTable"},outputs:{onAccepted:"onAccepted"},standalone:!1,decls:1,vars:1,consts:[["fTimeOffset","ngModel"],[4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["style","",4,"ngIf"],[1,"btn","btn-primary",3,"click","disabled"],[2,"overflow-x","auto"],["role","grid",1,"table","table-bordered","excel-table",2,"width","auto"],["role","row"],[3,"mousedown","mouseup",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["type","danger","role","alert",1,"alert","alert-danger"],[1,"form-group"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control","short-input",3,"ngModelChange","ngModel"],[2,"max-height","20em","overflow-y","auto","margin-bottom","1em"],[1,"list-group"],["class","list-group-item",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item",3,"click"],["role","button","aria-label","delete",1,"float-right",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[3,"mousedown","mouseup"],[1,"rowh"],[3,"background-color",4,"ngFor","ngForOf"]],template:function(t,i){t&1&&g(0,ft,27,7,"div",1),t&2&&p("ngIf",i.dataModel)},dependencies:[N,R,P,z,W,G],encapsulation:2})}}return o})();function gt(o,m){if(o&1){let e=C();l(0,"bd2-describe-topcount-table",1),T("onAccepted",function(i){f(e);let n=d();return h(n.import(i))}),r()}if(o&2){let e=d();p("dataTable",e.dataTable)("blocked",e.blocked)("confirmDataLoss",e.assay==null?null:e.assay.features.hasTSData)}}var Ue=(()=>{class o extends Oe{constructor(e,t,i){super(i),this.fileViewService=e,this.route=t,this.blocked=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit(),this.route.params.forEach(e=>{let t=e.fileId,i=e.format;t&&i?this.loadData(i,t):console.log(this.constructor.name+" null parameters")})}loadData(e,t){this.format=Fe.get(e),this.fileId=t,this.blocked=!1,this.fileViewService.getSimpleTableView(t).then(i=>{this.dataTable=i}).catch(i=>{this.feedback.error(i)})}import(e){if(e&&this.fileId&&this.format){this.blocked=!0;let t=new Ne;t.fileId=this.fileId,t.importFormat=this.format,t.importParameters=e,this.experimentService.importTimeSeries(this.assay,t).toPromise().then(i=>{let n="Imported "+i.imported+" timeseries";return this.feedback.success(n),i}).then(()=>this.refreshModel()).then(i=>this.goToTSView()).catch(i=>{this.blocked=!1,this.feedback.error(i)})}}goToTSView(){let e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}static{this.\u0275fac=function(t){return new(t||o)(b(je),b(fe),b(Ie))}}static{this.\u0275cmp=E({type:o,selectors:[["ng-component"]],standalone:!1,features:[pe([]),ae],decls:3,vars:1,consts:[[3,"dataTable","blocked","confirmDataLoss","onAccepted",4,"ngIf"],[3,"onAccepted","dataTable","blocked","confirmDataLoss"]],template:function(t,i){t&1&&(l(0,"h3"),a(1,"Timeseries import"),r(),g(2,gt,1,3,"bd2-describe-topcount-table",0)),t&2&&(s(2),p("ngIf",(i.format==null?null:i.format.name)==="TOPCOUNT"))},dependencies:[R,qe],encapsulation:2})}}return o})();var Ct=[{path:"",children:[{path:":format/:fileId",component:Ue}]}],Ke=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275mod=F({type:o})}static{this.\u0275inj=B({imports:[ee.forChild(Ct),ee]})}}return o})();var ci=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275mod=F({type:o})}static{this.\u0275inj=B({imports:[ue,Me,Se,Ae,Ve,Ke]})}}return o})();export{ci as TsOldImportModule};
