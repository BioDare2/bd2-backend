import{a as d,b as R,c as X,d as N,e as ne,f as le,g as b,h as E,i as B,j as Fe,k as Pe,m as We,n as Ge}from"./chunk-ZAWAO4I2.js";import{e as Ne}from"./chunk-WA7O2XOB.js";import{a as Ae}from"./chunk-6C5IN3M7.js";import"./chunk-VOF2332S.js";import{o as Oe}from"./chunk-X3OMUHYN.js";import{b as Re,c as Le}from"./chunk-FB5T6NUV.js";import"./chunk-ZAPWFC3C.js";import"./chunk-QDUVFCGA.js";import{a as Be,b as K,c as Ve,d as H,e as Q,f as Z,g as J}from"./chunk-E2ZG2HAU.js";import"./chunk-6HSKS2XP.js";import"./chunk-I5BPRPCG.js";import"./chunk-DFK6U2UW.js";import"./chunk-K5NGWSTH.js";import{B as Ie,F as ke,G as Ee,d as z,i as j,j as be,k as Te,m as q,n as we,o as U,p as xe,u as ye,v as De,w as Me,y as ve,z as Se}from"./chunk-2RPFGIFO.js";import"./chunk-I6T75M2J.js";import{$a as r,Ab as S,Bb as I,Cb as k,Cc as _e,Da as T,Db as ie,Fb as he,Ha as A,Ia as W,Ka as ce,Na as me,Ua as C,Va as _,Wa as w,X as re,Xa as x,Y as P,Ya as y,Za as D,_ as se,_a as a,ab as G,ba as f,ca as h,eb as g,gb as M,hb as p,hc as ge,lb as de,mb as pe,nb as ue,rb as fe,sb as te,tc as Ce,vb as c,wb as L,xb as v,ya as m,yc as oe}from"./chunk-EXZ64TUM.js";var Xe=["columnTypeForm"];function Ye(l,o){if(l&1){let n=g();a(0,"li")(1,"input",18,1),k("ngModelChange",function(t){f(n);let i=p();return I(i.cellRole,t)||(i.cellRole=t),h(t)}),r(),c(3),r()}if(l&2){let n=o.$implicit,e=p();m(),D("value",ie(n.name)),S("ngModel",e.cellRole),m(2),v(" ",n.label," ")}}function $e(l,o){if(l&1){let n=g();a(0,"div",12)(1,"label",19),c(2,"Propagate until block size"),r(),a(3,"input",20,2),k("ngModelChange",function(t){f(n);let i=p();return I(i.rangeSize,t)||(i.rangeSize=t),h(t)}),r()()}if(l&2){let n=p();m(3),S("ngModel",n.rangeSize)}}function et(l,o){if(l&1){let n=g();a(0,"div",12)(1,"label",21),c(2,"Label"),r(),a(3,"input",22,3),k("ngModelChange",function(t){f(n);let i=p();return I(i.dataLabel,t)||(i.dataLabel=t),h(t)}),r()()}if(l&2){let n=p();m(3),S("ngModel",n.dataLabel)}}function tt(l,o){if(l&1&&(a(0,"option",25),c(1),r()),l&2){let n=o.$implicit;D("value",ie(n.name)),m(),v("",n.label," ")}}function it(l,o){if(l&1){let n=g();a(0,"div",12)(1,"label",30),c(2,"Time between images (hours)"),r(),a(3,"input",31,7),k("ngModelChange",function(t){f(n);let i=p(2);return I(i.imgInterval,t)||(i.imgInterval=t),h(t)}),r()()}if(l&2){let n=p(2);m(3),S("ngModel",n.imgInterval)}}function ot(l,o){if(l&1){let n=g();a(0,"div")(1,"div",12)(2,"label",23),c(3,"Type of time column"),r(),a(4,"select",24,4),k("ngModelChange",function(t){f(n);let i=p();return I(i.timeType,t)||(i.timeType=t),h(t)}),x(6,tt,2,3,"option",25,w),r()(),a(8,"div",12)(9,"label",26),c(10,"Row with first timepoint"),r(),a(11,"input",27,5),k("ngModelChange",function(t){f(n);let i=p();return I(i.firstRow,t)||(i.firstRow=t),h(t)}),r()(),a(13,"div",12)(14,"label",28),c(15,"Time offset (hours)"),r(),a(16,"input",29,6),k("ngModelChange",function(t){f(n);let i=p();return I(i.timeOffset,t)||(i.timeOffset=t),h(t)}),r()(),C(18,it,5,1,"div",12),r()}if(l&2){let n=p();m(4),S("ngModel",n.timeType),m(2),y(n.timeTypeOptions),m(5),S("ngModel",n.firstRow),m(5),S("ngModel",n.timeOffset),m(2),_(n.isImageBased()?18:-1)}}function nt(l,o){if(l&1&&(a(0,"div",32),c(1),r()),l&2){let n=o.$implicit;m(),L(n)}}function lt(l,o){if(l&1&&(a(0,"div"),x(1,nt,2,1,"div",32,w),r()),l&2){let n=p();m(),y(n.errors)}}var Y=class{constructor(o,n,e,t){this.selectedRange=o,this.lastCol=n,this.showTime=e,this.label=t}},je=(()=>{let o=class o{constructor(e,t){this.myself=e,this.errors=null,this.cellRoles=[d.IGNORED,d.BACKGROUND,d.TIME,d.DATA],this.timeTypeOptions=[R.TIME_IN_HOURS,R.TIME_IN_MINUTES,R.TIME_IN_SECONDS,R.IMG_NUMBER],this.lastCol=t.lastCol,this.showTime=t.showTime,this.show(t.selectedRange,t.label)}ngOnInit(){}set showTime(e){e?this.cellRoles=[d.IGNORED,d.BACKGROUND,d.TIME,d.DATA]:this.cellRoles=[d.IGNORED,d.BACKGROUND,d.DATA]}isData(){return this.cellRole===d.DATA.name}isTime(){return this.cellRole===d.TIME.name}isImageBased(){return this.isTime()&&this.timeType===R.IMG_NUMBER.name}show(e,t){e&&(this.orgRange=e,this.rangeSize=e.range.size(),this.rangeLabel=t||e.columnRangeLabel,e.role&&(this.cellRole=e.role.name),e.role==d.DATA&&e.details&&(this.dataLabel=e.details.dataLabel),e.role==d.TIME&&e.details&&(this.timeType=e.details.timeType.name,this.timeOffset=e.details.timeOffset,this.imgInterval=e.details.imgInterval,this.firstRow=e.details.firstRow))}hide(){this.myself.close()}accepted(){this.isValid()&&this.myself.close(this.emitDescription())}acceptedAndNext(){if(!this.isValid())return;let e=this.emitDescription();if(!(e.range.lastCol>=this.lastCol)){let t=this.nextRange(e.range,this.rangeSize),i=new B(t);i.role=d.DATA,i.details=e.details,e.follow=i}this.myself.close(e)}nextRange(e,t){let i=e.lastCol+1,s=i+t-1;return s=Math.min(s,this.lastCol),new E(new b(i,e.first.row),new b(s,e.first.row))}emitDescription(){let e=this.recalculateRange(this.orgRange.range),t={};if(this.isData())t=new N(this.dataLabel);else if(this.isTime()){let s=new X;s.firstRow=this.firstRow,s.timeType=R.get(this.timeType),s.timeOffset=this.timeOffset,this.isImageBased()&&(s.imgInterval=this.imgInterval),t=s}let i=new B(e,this.orgRange.content);return i.role=d.get(this.cellRole),i.details=t,i}isValid(){let e=[];return d.get(this.cellRole)||e.push("Unknown role: "+this.cellRole),this.isData()&&(!this.dataLabel||this.dataLabel.trim()==="")&&(e.push("Non empty data label is required"),this.dataLabel=null),this.isTime()?((!this.firstRow||this.firstRow<1)&&e.push("Row nr of the first time point must be >= 1"),this.isImageBased()&&(!this.imgInterval||this.imgInterval<=0)&&e.push("Image interval must be > 0")):(!this.rangeSize||this.rangeSize<1)&&e.push("Block size must be >= 1"),e.length===0?(this.errors=null,!0):!1}recalculateRange(e){let t=e.first;if(this.isTime())return t=new b(t.col,this.firstRow),new E(t,t);if(this.rangeSize!==e.size()){let i=t.col+this.rangeSize-1,s=new b(Math.min(i,this.lastCol),t.row);return new E(t,s)}return e}};o.\u0275fac=function(t){return new(t||o)(T(Be),T(K))},o.\u0275cmp=A({type:o,selectors:[["ng-component"]],viewQuery:function(t,i){if(t&1&&de(Xe,7),t&2){let s;pe(s=ue())&&(i.columnTypeForm=s.first)}},standalone:!1,decls:29,vars:7,consts:[["columnTypeForm","ngForm"],["fCellRole","ngModel"],["fSize","ngModel"],["fDataLabel","ngModel"],["fTimeType","ngModel"],["fFirstRow","ngModel"],["fTimeOffset","ngModel"],["fImgInterval","ngModel"],["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],[1,"form-group"],[1,"list-unstyled"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"click","disabled"],[1,"btn","btn-primary","btn-sm","m-1",3,"click","disabled"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","radio","required","","name","fCellRole",3,"ngModelChange","value","ngModel"],["for","size"],["type","number","step","1","min","1","id","size","required","","name","fSize",1,"form-control",3,"ngModelChange","ngModel"],["for","dataLabel"],["type","text","id","dataLabel","placeholder","e.g. TOC1 SD","required","","minlength","2","name","fDataLabel",1,"form-control",3,"ngModelChange","ngModel"],["for","timeType"],["id","timeType","required","","name","fTimeType",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],["for","firstRow"],["type","number","id","firstRow","step","1","min","1","required","","placeholder","e.g. 2","name","fFirstRow",1,"form-control",3,"ngModelChange","ngModel"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control",3,"ngModelChange","ngModel"],["for","imgInterval"],["type","number","id","imgInterval","required","","step","any","min","0.01","placeholder","e.g. 1.5","name","fImgInterval",1,"form-control",3,"ngModelChange","ngModel"],["dismissOnTimeout","3000","dismissible","true","role","alert",1,"alert","alert-danger"]],template:function(t,i){if(t&1){let s=g();a(0,"h4",8),c(1,"Describe data column(s) "),a(2,"button",9)(3,"span",10),c(4,"\xD7"),r()()(),a(5,"div",11)(6,"p"),c(7," Columns "),a(8,"strong"),c(9),r()(),a(10,"form",null,0)(12,"div",12)(13,"label"),c(14,"Column type"),r(),a(15,"ul",13),x(16,Ye,4,4,"li",null,w),r()(),C(18,$e,5,1,"div",12),C(19,et,5,1,"div",12),C(20,ot,19,4,"div"),C(21,lt,3,0,"div"),r()(),a(22,"div",14)(23,"button",15),M("click",function(){return f(s),h(i.acceptedAndNext())}),c(24,"OK and Next "),r(),a(25,"button",16),M("click",function(){return f(s),h(i.accepted())}),c(26,"OK "),r(),a(27,"button",17),M("click",function(){return f(s),h(i.hide())}),c(28,"Cancel"),r()()}if(t&2){let s=fe(11);m(9),v("[",i.rangeLabel,"]"),m(7),y(i.cellRoles),m(2),_(i.isTime()?-1:18),m(),_(i.isData()?19:-1),m(),_(i.isTime()?20:-1),m(),_(i.errors?21:-1),m(2),D("disabled",!s.form.valid),m(2),D("disabled",!s.form.valid)}},dependencies:[we,De,Me,z,U,ye,xe,j,be,Se,Ie,ve,q,Te,H,Q,J,Z],encapsulation:2});let l=o;return l})();var qe=(()=>{let o=class o{constructor(e){this.show(e)}ngOnInit(){}show(e){this.orgRange=e,this.rowNr=e.range.first.row,this.values=e.content}};o.\u0275fac=function(t){return new(t||o)(T(K))},o.\u0275cmp=A({type:o,selectors:[["ng-component"]],standalone:!1,decls:24,vars:3,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],[1,"word_wrapping"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"mat-dialog-close"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm"]],template:function(t,i){t&1&&(a(0,"h4",0),c(1,"Use row content as data labels(s) "),a(2,"button",1)(3,"span",2),c(4,"\xD7"),r()()(),a(5,"div",3)(6,"div")(7,"p"),c(8,"Use values from row "),a(9,"strong"),c(10),r(),c(11," as data labels"),r(),a(12,"p"),c(13,"Existing labels and column types will be overwritten"),r()(),a(14,"div",4)(15,"p")(16,"strong"),c(17,"Labels: "),r(),c(18),r()()(),a(19,"div",5)(20,"button",6),c(21,"Copy labels"),r(),a(22,"button",7),c(23,"Cancel"),r()()),t&2&&(m(10),v("[",i.rowNr,"]"),m(8),L(i.values),m(2),D("mat-dialog-close",i.orgRange))},dependencies:[H,Q,J,Z],encapsulation:2});let l=o;return l})();var Ue=(()=>{let o=class o{constructor(e){this.BD2REST=e}getSimpleTableView(e){return this.BD2REST.fileViewSimpleTable(e).then(t=>t.data)}verifyFormat(e,t){return this.BD2REST.fileViewVerifyFormat(e,t).toPromise()}};o.\u0275fac=function(t){return new(t||o)(se(_e))},o.\u0275prov=re({token:o,factory:o.\u0275fac,providedIn:"root"});let l=o;return l})();var $=class l{constructor(o,n,e,t,i){this.rows=o,this.th=n,this.rowsLabels=e,this.specialRows=t,this.specialRowsLabels=i,this.width=l.maxLength(o),n?this.th=n:this.th=o.length<1?[]:l.labelCols(this.width),this.rowsLabels=e||l.labelRows(o.length),this.specialRows=t||[],this.specialRowsLabels=i||l.blankRows(this.specialRows.length)}static labelRows(o){let n=[];for(let e=1;e<=o;e++)n.push(""+e);return n}static blankRows(o){let n=[];for(let e=0;e<o;e++)n.push("");return n}static maxLength(o){return!o||o.length<1?0:Math.max.apply(Math,o.map(n=>n.length))}static labelCols(o){let n=[];for(let e=1;e<=o;e++)n.push(ne(e));return n}};var F=(()=>{let o=class o{static color(e){return o.colors[e%o.colors.length]}};o.TIME_BG="lightyellow",o.IGNORED_BG="lightgrey",o.NOISE_BG="darkgrey",o.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"];let l=o;return l})();function rt(l,o){l&1&&(a(0,"div",1)(1,"strong"),c(2,"Missing data labels. Please use one of the methods:"),r(),a(3,"ul")(4,"li"),c(5,"Click and draw over the headers of columns to select the range and assign the data labels in the popup dialog. "),r(),a(6,"li"),c(7,"Use the form below to manually provide the column range and the data label."),r()()())}function st(l,o){if(l&1){let n=g();a(0,"div")(1,"div",6)(2,"label",7),c(3,"Time parameter: offset (hours)"),r(),a(4,"input",8,0),k("ngModelChange",function(t){f(n);let i=p(2);return I(i.timeColumnDescription.details.timeOffset,t)||(i.timeColumnDescription.details.timeOffset=t),h(t)}),r()()()}if(l&2){let n=p(2);m(4),S("ngModel",n.timeColumnDescription.details.timeOffset)}}function ct(l,o){if(l&1){let n=g();a(0,"li",12),M("click",function(){let t=f(n).$implicit,i=p(3);return h(i.editBlock(t))}),a(1,"span")(2,"strong"),c(3),r(),c(4),r(),a(5,"a",13),M("click",function(){let t=f(n).$implicit,i=p(3);return h(i.deleteBlock(t))}),a(6,"i",14),c(7,"delete_forever"),r()()()}if(l&2){let n=o.$implicit;m(3),L(n.topcountLabel),m(),v(" : ",n.value)}}function mt(l,o){if(l&1&&(a(0,"div")(1,"p")(2,"strong"),c(3,"Columns descriptions (select to edit)"),r()(),a(4,"div",9)(5,"ul",10),x(6,ct,8,2,"li",11,w),r()()()),l&2){let n=p(2);m(6),y(n.dataBlocks)}}function dt(l,o){if(l&1){let n=g();a(0,"th",15),M("mousedown",function(){let t=f(n).$implicit,i=p(2);return h(i.thSelectStart(t))})("mouseup",function(){let t=f(n).$implicit,i=p(2);return h(i.thSelectEnd(t))}),c(1),r()}if(l&2){let n=o.$implicit,e=p(2);m(),v(" ",e.dataModel.th[n]," ")}}function pt(l,o){if(l&1&&(a(0,"td"),c(1),r()),l&2){let n=o.$implicit,e=p().$implicit,t=p(2);te("background-color",t.bgColors[n]?t.bgColors[n]:"inherited"),m(),v("",e[n]," ")}}function ut(l,o){if(l&1&&(a(0,"tr")(1,"td",16),c(2),r(),x(3,pt,2,3,"td",17,w),r()),l&2){let n=o.$index,e=p(2);m(2),L(e.dataModel.specialRowsLabels[n]),m(),y(e.visibleColIx)}}function ft(l,o){if(l&1&&(a(0,"td"),c(1),r()),l&2){let n=o.$implicit,e=p().$implicit,t=p(2);te("background-color",t.bgColors[n]?t.bgColors[n]:"inherited"),m(),v("",e[n]," ")}}function ht(l,o){if(l&1&&(a(0,"tr")(1,"td",16),c(2),r(),x(3,ft,2,3,"td",17,w),r()),l&2){let n=o.$index,e=p(2);m(2),L(e.dataModel.rowsLabels[n]),m(),y(e.visibleColIx)}}function gt(l,o){if(l&1){let n=g();a(0,"div"),G(1,"hr"),a(2,"div")(3,"h4"),c(4,"Current Topcount import parameters "),r(),C(5,rt,8,0,"div",1),C(6,st,6,1,"div"),C(7,mt,8,0,"div"),a(8,"div")(9,"button",2),M("click",function(){f(n);let t=p();return h(t.accept())}),c(10,"Import timeseries "),r()()(),G(11,"hr"),a(12,"h4"),c(13,"Data table "),a(14,"small"),c(15,"(only top rows)"),r()(),a(16,"p"),c(17,"Click on column headers for description options"),r(),a(18,"div",3)(19,"table",4)(20,"thead")(21,"tr",5),G(22,"th"),x(23,dt,2,1,"th",null,w),r()(),a(25,"tbody"),x(26,ut,5,1,"tr",null,w),x(28,ht,5,1,"tr",null,w),r()()()()}if(l&2){let n=p();m(5),_(n.hasData()?-1:5),m(),_(n.timeColumnDescription?6:-1),m(),_(n.dataBlocks&&n.dataBlocks.length>0?7:-1),m(2),D("disabled",n.blocked||!n.hasTime()||!n.hasData()),m(14),y(n.visibleColIx),m(3),y(n.dataModel.specialRows),m(2),y(n.dataModel.rows)}}var Ke=(()=>{let o=class o{constructor(e,t){this.confDialogs=e,this.matDialog=t,this.onAccepted=new me,this.blocked=!1,this.confirmDataLoss=!1,this.columnBlocks=new Fe,this.dataBlocks=[],this.bgColors=[]}set dataTable(e){if(!e||e.length<1)return;let t=new $(e,this.topcountHeaders(),void 0,[[]],["L."]);this.dataModel=t,this.lastCol=t.width,this.visibleColIx=[];for(let i=0;i<t.width;i++)this.visibleColIx.push(i);this.initTime()}topcountHeaders(){let e=[];return["A","B","C","D","E","F","G","H"].forEach(i=>{for(let s=1;s<13;s++)e.push(i+s)}),e}initTime(){let e=new E(new b(0,0),new b(0,0)),t=new X;t.timeType=R.TIME_IN_HOURS,t.timeOffset=0,t.firstRow=1;let i=new B(e);i.role=d.TIME,i.details=t,this.timeColumnDescription=i}hasTime(){return this.timeColumnDescription&&this.timeColumnDescription.role===d.TIME}hasData(){return this.dataBlocks.some(e=>e.details.role===d.DATA)}rowSelected(e){let t=this.joinRow(e),i=new b(0,e+1),s=new E(i,i),u=new B(s,t);this.askCopyRow(u)}askCopyRow(e){this.matDialog.open(qe,{data:e,autoFocus:!1}).afterClosed().subscribe(i=>{i&&this.copyRowAsLabels(i)})}thSelectStart(e){this.thSelectedCol=e}thSelectEnd(e){if(this.thSelectedCol!==void 0&&this.thSelectedCol!=null){let t=new b(this.thSelectedCol+1,1),i=new b(e+1,1),s=new E(t,i),u=new B(s,void 0),V=this.columnBlocks.details(t.col);V&&(u.role=V.role,u.details=V.details),this.thSelectedCol=void 0,this.askColumnsDetails(u)}}askColumnsDetails(e){let t=this.rangeToTopcountLabel(e),i=new Y(e,this.lastCol,!1,t);this.matDialog.open(je,{data:i,autoFocus:!1}).afterClosed().subscribe(u=>{if(u){let V=u.follow;u.follow=void 0,this.setColumnType(u),V&&this.askColumnsDetails(V)}})}rangeToTopcountLabel(e){let t=e.range;return le(t.firstCol)+"-"+le(t.lastCol)}editBlock(e){e&&this.askColumnsDetails(e.details)}deleteBlock(e){e&&(e.details.role==d.TIME?this.clearTime():this.resetRegion(e.details.range),this.dataBlocks=this.columnBlocks.blocks)}accept(){if(!this.hasTime()||!this.hasData())return;let e=Promise.resolve(!0);this.containsDataGaps()&&(e=this.confDialogs.confirm("Do you want to import partial data?","Not all columns are described. Data columns without annotations will not be imported.<br>Click OK if you want to proceed.").toPromise()),e.then(t=>t?this.confirmDataLoss?this.confDialogs.confirm("Do you want to replace the existing data?","It will also erase all analysis results. <br>Click OK if you want to proceed.").toPromise():!0:!1).then(t=>{t&&this.emitParameters()}).catch(t=>console.log("Dialog error: "+t))}containsDataGaps(){if(this.dataBlocks.length<1||this.dataBlocks[this.dataBlocks.length-1].end<this.lastCol)return!0;let e=this.dataBlocks[0].start-1;for(let t=0;t<this.dataBlocks.length;t++){if(this.dataBlocks[t].start!==e+1)return!0;e=this.dataBlocks[t].end}return!1}emitParameters(){let e=new We;e.timeColumn=this.timeColumnDescription,e.dataBlocks=this.dataBlocks.map(t=>t.details),this.onAccepted.emit(e)}joinRow(e){return this.dataModel.rows[e].slice(0,10).join(" | ")+"..."}setColumnType(e){if(e&&e.role!==void 0){this.timeColumnDescription&&(e.role==d.TIME?this.clearTime():this.timeColumnDescription.firstCol>=e.firstCol&&this.timeColumnDescription.firstCol<=e.lastCol&&this.clearTime());let t;switch(e.role){case d.IGNORED:t="ign.";break;case d.BACKGROUND:t="bcg.";break;case d.TIME:t="Time";break;case d.DATA:t=e.details.dataLabel}this.columnBlocks.insert(e,t),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks;let i=this.dataModel.specialRows[0];if(i)for(let s=e.firstCol-1;s<e.lastCol;s++)i[s]=t;e.role==d.TIME&&(this.timeColumnDescription=e),this.updateBackgrounds()}}copyRowAsLabels(e){if(e){this.clearTime();let t=this.dataModel.specialRows[0];this.dataModel.rows[e.range.first.row-1].forEach((s,u)=>{if(s){let V=new N(s),ae=new b(u+1,0),Ze=new E(ae,ae),ee=new B(Ze,void 0);ee.details=V,ee.role=d.DATA,this.columnBlocks.insert(ee,s),t[u]=s}}),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks,this.updateBackgrounds()}}clearTime(){this.timeColumnDescription&&(this.resetRegion(this.timeColumnDescription.range),this.timeColumnDescription=void 0)}updateBackgrounds(){for(let e=0;e<this.dataBlocks.length;e++){let t=this.dataBlocks[e],i=F.color(e);t.details.role==d.IGNORED&&(i=F.IGNORED_BG),t.details.role==d.BACKGROUND&&(i=F.NOISE_BG),t.details.role==d.TIME&&(i=F.TIME_BG);for(let s=t.start-1;s<t.end;s++)this.bgColors[s]=i}}resetRegion(e){this.resetLabels(e),this.resetBackground(e),this.columnBlocks.delete(e)}resetBackground(e){for(let t=e.firstCol-1;t<e.lastCol;t++)this.bgColors[t]="transparent"}resetLabels(e){let t=this.dataModel.specialRows[0];for(let i=e.firstCol-1;i<e.lastCol;i++)t[i]="-"}fakeData(){let t=[],i=[];i.push("");for(let s=1;s<25;s++)i.push("RO "+s);t.push(i),i=[],i.push("");for(let s=1;s<25;s++)i.push("cls"+Math.round(s/3));t.push(i);for(let s=1;s<5;s++){i=[],i.push(""+s);for(let u=1;u<25;u++)i.push(""+(s+u));t.push(i)}return t}};o.\u0275fac=function(t){return new(t||o)(T(Ae),T(Ve))},o.\u0275cmp=A({type:o,selectors:[["bd2-describe-topcount-table"]],inputs:{blocked:"blocked",confirmDataLoss:"confirmDataLoss",dataTable:"dataTable"},outputs:{onAccepted:"onAccepted"},standalone:!1,decls:1,vars:1,consts:[["fTimeOffset","ngModel"],["type","danger","role","alert",1,"alert","alert-danger"],[1,"btn","btn-primary",3,"click","disabled"],[2,"overflow-x","auto"],["role","grid",1,"table","table-bordered","excel-table",2,"width","auto"],["role","row"],[1,"form-group"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control","short-input",3,"ngModelChange","ngModel"],[2,"max-height","20em","overflow-y","auto","margin-bottom","1em"],[1,"list-group"],[1,"list-group-item"],[1,"list-group-item",3,"click"],["role","button","aria-label","delete",1,"float-right",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[3,"mousedown","mouseup"],[1,"rowh"],[3,"background-color"]],template:function(t,i){t&1&&C(0,gt,30,4,"div"),t&2&&_(i.dataModel?0:-1)},dependencies:[z,U,j,q],encapsulation:2});let l=o;return l})();function _t(l,o){if(l&1){let n=g();a(0,"bd2-describe-topcount-table",1),M("onAccepted",function(t){f(n);let i=p();return h(i.import(t))}),r()}if(l&2){let n=p();D("dataTable",n.dataTable)("blocked",n.blocked)("confirmDataLoss",n.assay==null?null:n.assay.features.hasTSData)}}var He=(()=>{let o=class o extends Le{constructor(e,t,i){super(i),this.fileViewService=e,this.route=t,this.blocked=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit(),this.route.params.forEach(e=>{let t=e.fileId,i=e.format;t&&i?this.loadData(i,t):console.log(this.constructor.name+" null parameters")})}loadData(e,t){this.format=Pe.get(e),this.fileId=t,this.blocked=!1,this.fileViewService.getSimpleTableView(t).then(i=>{this.dataTable=i}).catch(i=>{this.feedback.error(i)})}import(e){if(e&&this.fileId&&this.format){this.blocked=!0;let t=new Ge;t.fileId=this.fileId,t.importFormat=this.format,t.importParameters=e,this.experimentService.importTimeSeries(this.assay,t).toPromise().then(i=>{let s="Imported "+i.imported+" timeseries";return this.feedback.success(s),i}).then(()=>this.refreshModel()).then(i=>this.goToTSView()).catch(i=>{this.blocked=!1,this.feedback.error(i)})}}goToTSView(){let e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}};o.\u0275fac=function(t){return new(t||o)(T(Ue),T(Ce),T(Re))},o.\u0275cmp=A({type:o,selectors:[["ng-component"]],standalone:!1,features:[he([]),ce],decls:3,vars:1,consts:[[3,"dataTable","blocked","confirmDataLoss"],[3,"onAccepted","dataTable","blocked","confirmDataLoss"]],template:function(t,i){t&1&&(a(0,"h3"),c(1,"Timeseries import"),r(),C(2,_t,1,3,"bd2-describe-topcount-table",0)),t&2&&(m(2),_((i.format==null?null:i.format.name)==="TOPCOUNT"?2:-1))},dependencies:[Ke],encapsulation:2});let l=o;return l})();var bt=[{path:"",children:[{path:":format/:fileId",component:He}]}],Qe=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=W({type:o}),o.\u0275inj=P({imports:[oe.forChild(bt),oe]});let l=o;return l})();var pi=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=W({type:o}),o.\u0275inj=P({imports:[ge,ke,Ee,Ne,Oe,Qe]});let l=o;return l})();export{pi as TsOldImportModule};
