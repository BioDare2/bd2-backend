import{a as re}from"./chunk-EDOAR6V4.js";import{a as ie,b as se}from"./chunk-NIE2ZYPZ.js";import{$a as a,Cc as te,Da as b,Ha as u,Ia as x,Kb as h,Lb as m,Mb as Z,Ua as P,Va as E,Wa as I,X as K,Xa as F,Y as C,Ya as w,Za as f,_ as z,_a as o,a as Y,ab as d,fc as J,gb as V,gc as S,hb as O,hc as X,ma as H,nc as ee,va as Q,vb as c,wa as W,wb as D,xb as g,ya as l,yb as B,yc as A}from"./chunk-EXZ64TUM.js";var _=(()=>{let e=class e{constructor(s){this.BD2REST=s}getUsageData(){return this.BD2REST.getUsageData()}};e.\u0275fac=function(i){return new(i||e)(z(te))},e.\u0275prov=K({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function he(t,e){if(t&1&&(o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),h(5,"number"),a()()),t&2){let n=e.$implicit;l(2),D(n.country),l(2),D(m(5,2,n.activeUsers))}}var ne=(()=>{let e=class e{constructor(s){this.usagedataService=s,this.API_KEY=re.googleAnalyticsApiKey,this.topCountries=[]}ngOnInit(){this.fetchAnalyticsData()}fetchAnalyticsData(){this.usagedataService.getUsageData().subscribe(s=>{console.log("API Response:",s);let i=s.analytics;this.topCountries=i.sort((r,p)=>p.activeUsers-r.activeUsers).slice(0,5),this.drawChart(i)},s=>{console.error("Error fetching analytics data:",s)})}drawChart(s){google.charts.load("current",{packages:["geochart"],mapsApiKey:this.API_KEY}),google.charts.setOnLoadCallback(()=>{let i=[["Country","Users"]];s.forEach($=>{i.push([$.country,$.activeUsers])}),console.log("Chart Data:",i);let r=google.visualization.arrayToDataTable(i),p={colorAxis:{colors:["#9fc5e8","#4374e0"]}};new google.visualization.GeoChart(document.getElementById("chart_div")).draw(r,p)})}};e.\u0275fac=function(i){return new(i||e)(b(_))},e.\u0275cmp=u({type:e,selectors:[["bd2-google-analytics"]],standalone:!1,decls:21,vars:0,consts:[[1,"row"],[1,"col-sm-8"],["id","chart_div",2,"width","100%","height","400px"],[1,"col-sm-4"],[1,"table","table-striped"],[1,"text-right"]],template:function(i,r){i&1&&(o(0,"div")(1,"h3"),c(2,"Number of users per country"),a(),o(3,"small"),c(4,"Includes non-registered users."),a(),o(5,"div",0)(6,"div",1),d(7,"div",2),a(),o(8,"div",3)(9,"table",4)(10,"thead")(11,"tr")(12,"th"),c(13,"Country"),a(),o(14,"th"),c(15,"Active users"),a()()(),o(16,"tbody"),F(17,he,6,4,"tr",null,I),a()(),o(19,"p",5),c(20,"(last 12 months)"),a()()()()),i&2&&(l(17),w(r.topCountries))},dependencies:[S],encapsulation:2});let t=e;return t})();function ue(t,e){if(t&1&&(o(0,"div",0),d(1,"canvas",1),a()),t&2){let n=O();l(),f("type","bar")("datasets",n.dataset)("options",n.barOptions)("labels",n.labels)}}var ae=(()=>{let e=class e{constructor(){this.barColor="rgba(75, 192, 192, 0.4)",this.barOptions={scales:{x:{type:"category",position:"bottom",stacked:!0},y:{beginAtZero:!0,stacked:!0}},plugins:{legend:{display:!0,position:"top"}}}}ngOnInit(){this.updateChart()}ngOnChanges(s){(s.publicData||s.privateData)&&this.updateChart()}updateChart(){if(this.publicData||this.privateData){console.log("Input public data:",this.publicData),console.log("Input private data:",this.privateData);let s=this.publicData&&this.publicData.length?this.publicData:this.privateData;s?this.labels=s.map(i=>i.year.toString()):this.labels=[],this.dataset=[],this.privateData&&this.privateData.length&&this.dataset.push({label:this.publicData&&this.publicData.length?`Private ${this.chartLabel}`:this.chartLabel,data:this.privateData.map(i=>i.value),backgroundColor:"rgba(128, 128, 128, 0.4)",borderColor:"rgba(128, 128, 128, 1)",borderWidth:1}),this.publicData&&this.publicData.length&&this.dataset.push({label:this.privateData&&this.privateData.length?`Public ${this.chartLabel}`:this.chartLabel,data:this.publicData.map(i=>i.value),backgroundColor:this.barColor,borderColor:this.barColor.replace("0.4","1"),borderWidth:1}),console.log("Chart labels:",this.labels),console.log("Chart dataset:",this.dataset)}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=u({type:e,selectors:[["bd2-usage-stats-plot"]],inputs:{publicData:"publicData",privateData:"privateData",chartLabel:"chartLabel",barColor:"barColor"},standalone:!1,features:[H],decls:1,vars:1,consts:[[1,"chart-container"],["baseChart","","width","auto","height","200",3,"type","datasets","options","labels"]],template:function(i,r){i&1&&P(0,ue,2,4,"div",0),i&2&&E(r.dataset?0:-1)},dependencies:[ie],styles:[".chart-container[_ngcontent-%COMP%]{width:100%;margin:0 auto}"]});let t=e;return t})();function ge(t,e){if(t&1&&(o(0,"div"),c(1),h(2,"number"),h(3,"number"),d(4,"br"),c(5),h(6,"number"),h(7,"number"),d(8,"br"),c(9),h(10,"number"),a()),t&2){let n=O();l(),B(" Number of experiments: ",m(2,5,n.totalSets)," (",m(3,7,n.totalPublicSets)," are public)."),l(4),B(" Number of timeseries: ",m(6,9,n.totalSeries)," (",m(7,11,n.totalPublicSeries)," are public)."),l(4),g(" Number of registered users: ",m(10,13,n.totalUsers),". ")}}var oe=(()=>{let e=class e{constructor(s){this.usagedataService=s,this.totalSets=0,this.totalSeries=0,this.totalPublicSets=0,this.totalPublicSeries=0,this.totalUsers=0,this.usersPerYear=[],this.publicSetsPerYear=[],this.publicSeriesPerYear=[],this.privateSetsPerYear=[],this.privateSeriesPerYear=[]}ngOnInit(){this.fetchUsageStats()}fetchUsageStats(){this.usagedataService.getUsageData().subscribe(s=>{console.log("API Response:",s);let i=s.year_stats;this.usageStats=s,this.totalSets=i.reduce((r,p)=>r+p.sets,0),this.totalSeries=i.reduce((r,p)=>r+p.series,0),this.totalPublicSets=i.reduce((r,p)=>r+p.public_sets,0),this.totalPublicSeries=i.reduce((r,p)=>r+p.public_series,0),this.totalUsers=i.reduce((r,p)=>r+p.users,0),this.usersPerYear=i.map(r=>({year:r.year,value:r.users})),this.publicSetsPerYear=i.map(r=>({year:r.year,value:r.public_sets})),this.publicSeriesPerYear=i.map(r=>({year:r.year,value:r.public_series})),this.privateSetsPerYear=i.map(r=>({year:r.year,value:r.sets-r.public_sets})),this.privateSeriesPerYear=i.map(r=>({year:r.year,value:r.series-r.public_series}))},s=>{console.error("Error fetching usage stats:",s)})}};e.\u0275fac=function(i){return new(i||e)(b(_))},e.\u0275cmp=u({type:e,selectors:[["bd2-usage-stats"]],standalone:!1,decls:9,vars:6,consts:[[1,"charts-container"],["chartLabel","Exp.","barColor","rgba(31, 119, 180, 0.4)",3,"publicData","privateData"],["chartLabel","Series","barColor","rgba(255, 127, 14, 0.4)",3,"publicData","privateData"],["chartLabel","User Registrations","barColor","rgba(44, 160, 44, 0.4)",3,"publicData"]],template:function(i,r){i&1&&(P(0,ge,11,15,"div"),d(1,"br"),o(2,"div",0),d(3,"bd2-usage-stats-plot",1)(4,"bd2-usage-stats-plot",2)(5,"bd2-usage-stats-plot",3),a(),o(6,"small"),c(7," Hover on the bars to see the exact numbers. Click on the legend to hide/show the data."),d(8,"br"),a()),i&2&&(E(r.usageStats?0:-1),l(3),f("publicData",r.publicSetsPerYear)("privateData",r.privateSetsPerYear),l(),f("publicData",r.publicSeriesPerYear)("privateData",r.privateSeriesPerYear),l(),f("publicData",r.usersPerYear))},dependencies:[ae,S],styles:[".charts-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;gap:10px}.charts-container[_ngcontent-%COMP%]   bd2-usage-stats-plot[_ngcontent-%COMP%]{flex:1 1 calc(33.33% - 20px);margin:0;min-width:300px}"]});let t=e;return t})();var v=function(t){return t[t.State=0]="State",t[t.Transition=1]="Transition",t[t.Sequence=2]="Sequence",t[t.Group=3]="Group",t[t.Animate=4]="Animate",t[t.Keyframes=5]="Keyframes",t[t.Style=6]="Style",t[t.Trigger=7]="Trigger",t[t.Reference=8]="Reference",t[t.AnimateChild=9]="AnimateChild",t[t.AnimateRef=10]="AnimateRef",t[t.Query=11]="Query",t[t.Stagger=12]="Stagger",t}(v||{}),ye="*";function q(t,e){return{type:v.Trigger,name:t,definitions:e,options:{}}}function T(t,e=null){return{type:v.Animate,styles:e,timings:t}}function Ie(t,e=null){return{type:v.Sequence,steps:t,options:e}}function M(t){return{type:v.Style,styles:t,offset:null}}function U(t,e,n){return{type:v.State,name:t,styles:e,options:n}}function j(t,e,n=null){return{type:v.Transition,expr:t,animation:e,options:n}}var L=class{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(e=0,n=0){this.totalTime=e+n}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let n=e=="start"?this._onStartFns:this._onDoneFns;n.forEach(s=>s()),n.length=0}},N=class{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(e){this.players=e;let n=0,s=0,i=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(p=>{p.onDone(()=>{++n==r&&this._onFinish()}),p.onDestroy(()=>{++s==r&&this._onDestroy()}),p.onStart(()=>{++i==r&&this._onStart()})}),this.totalTime=this.players.reduce((p,G)=>Math.max(p,G.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let n=e*this.totalTime;this.players.forEach(s=>{let i=s.totalTime?Math.min(1,n/s.totalTime):1;s.setPosition(i)})}getPosition(){let e=this.players.reduce((n,s)=>n===null||s.totalTime>n.totalTime?s:n,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let n=e=="start"?this._onStartFns:this._onDoneFns;n.forEach(s=>s()),n.length=0}},_e="!";var ce=(()=>{let e=class e{constructor(){this.data={state:"default"}}ngOnInit(){}cardClicked(){this.data.state==="default"?this.data.state="flipped":this.data.state="default"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=u({type:e,selectors:[["bd2-species-card"]],inputs:{name:"name",image:"image",reference:"reference",datasets:"datasets",publicDatasets:"publicDatasets",timeseries:"timeseries",publicTimeseries:"publicTimeseries",keywords:"keywords"},standalone:!1,decls:25,vars:18,consts:[[1,"card",3,"click"],[1,"face","back"],[1,"species"],[3,"src"],[1,"reference",3,"innerHTML"],[1,"face","front"]],template:function(i,r){i&1&&(o(0,"div",0),V("click",function(){return r.cardClicked()}),o(1,"div",1)(2,"div",2),c(3),a(),d(4,"img",3)(5,"small",4),a(),o(6,"div",5)(7,"div",2),c(8),a(),c(9),h(10,"number"),d(11,"br"),o(12,"small"),c(13),h(14,"number"),a(),c(15),h(16,"number"),d(17,"br"),o(18,"small"),c(19),h(20,"number"),a(),d(21,"br"),o(22,"b"),c(23,"Popular keywords"),a(),c(24),a()()),i&2&&(f("@cardFlip",r.data.state),l(3),D(r.name),l(),f("src",r.image,W),l(),f("innerHTML",r.reference,Q),l(3),D(r.name),l(),g(" Experiments: ",m(10,10,r.datasets)," "),l(4),g("(Public: ",m(14,12,r.publicDatasets),")"),l(2),g(" Timeseries: ",m(16,14,r.timeseries)," "),l(4),g("(Public: ",m(20,16,r.publicTimeseries),")"),l(5),g("",r.keywords," "))},dependencies:[S],styles:["[_nghost-%COMP%]{display:block;perspective:600px}.card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;box-shadow:10px 10px 43px -18px #000000bf;border-radius:20px;height:250px;width:200px;cursor:pointer;position:relative;transform-style:preserve-3d}.face[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;position:absolute;width:100%;height:100%;border-radius:inherit;backface-visibility:hidden}.face[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:90%;height:70%;object-fit:cover;border-radius:inherit}.front[_ngcontent-%COMP%]{transform:rotateY(180deg)}.back[_ngcontent-%COMP%]{transform:rotateY(0)}.reference[_ngcontent-%COMP%]{font-size:.7em}.species[_ngcontent-%COMP%]{font-style:italic;font-weight:700}.reference[_ngcontent-%COMP%]{display:block;height:3em}"],data:{animation:[q("cardFlip",[U("default",M({transform:"none"})),U("flipped",M({transform:"rotateY(180deg)"})),j("default => flipped",[T("400ms")]),j("flipped => default",[T("200ms")])])]}});let t=e;return t})();function De(t,e){if(t&1&&d(0,"bd2-species-card",1),t&2){let n=e.$implicit;f("name",n.name)("image",n.image)("reference",n.reference)("datasets",n.sets)("publicDatasets",n.public_sets)("timeseries",n.series)("publicTimeseries",n.public_series)("keywords",n.keywords)}}var le=(()=>{let e=class e{constructor(s,i){this.usageDataService=s,this.http=i,this.speciesStats=[],this.speciesInfo=[],this.speciesData=[]}ngOnInit(){this.loadSpeciesInfo()}loadSpeciesInfo(){this.http.get("assets/species/species-info.json").subscribe(s=>{this.speciesInfo=s,this.fetchSpeciesStats()},s=>{console.error("Error loading static species info",s)})}fetchSpeciesStats(){this.usageDataService.getUsageData().subscribe(s=>{this.speciesStats=s.species_stats,this.speciesData=this.speciesInfo.map(i=>{let r=this.speciesStats.find(p=>p.species===i.name);return r?Y(Y({},i),r):i})},s=>{console.error("Error fetching species stats from backend",s)})}};e.\u0275fac=function(i){return new(i||e)(b(_),b(ee))},e.\u0275cmp=u({type:e,selectors:[["bd2-species-cards"]],standalone:!1,decls:7,vars:0,consts:[[1,"species-cards"],[3,"name","image","reference","datasets","publicDatasets","timeseries","publicTimeseries","keywords"]],template:function(i,r){i&1&&(o(0,"h3"),c(1,"Species on BioDare2"),a(),o(2,"small"),c(3,"Click the cards for more details!"),a(),o(4,"div",0),F(5,De,1,8,"bd2-species-card",1,I),a()),i&2&&(l(5),w(r.speciesData))},dependencies:[ce],styles:["[_nghost-%COMP%]{display:block;perspective:600px}.card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;box-shadow:10px 10px 43px -18px #000000bf;border-radius:20px;height:250px;width:200px;cursor:pointer;position:relative;transform-style:preserve-3d}.face[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;position:absolute;width:100%;height:100%;border-radius:inherit;backface-visibility:hidden}.face[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:90%;height:70%;object-fit:cover;border-radius:inherit}.front[_ngcontent-%COMP%]{transform:rotateY(180deg)}.reference[_ngcontent-%COMP%]{font-size:.7em}.species[_ngcontent-%COMP%]{font-style:italic;font-weight:700}.species-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;padding:16px}"]});let t=e;return t})();var pe=(()=>{let e=class e{constructor(s){this.usagedataService=s}ngOnInit(){this.fetchUsageDate()}fetchUsageDate(){this.usagedataService.getUsageData().subscribe(s=>{console.log("API Response:",s),this.currentDate=new Date(s.timestamp)},s=>{console.error("Error fetching usage date:",s)})}};e.\u0275fac=function(i){return new(i||e)(b(_))},e.\u0275cmp=u({type:e,selectors:[["bd2-usage"]],standalone:!1,decls:12,vars:4,template:function(i,r){i&1&&(o(0,"div")(1,"h2"),c(2,"BioDare2 Usage Data"),a(),c(3),h(4,"date"),d(5,"br")(6,"br")(7,"bd2-usage-stats")(8,"hr")(9,"bd2-google-analytics")(10,"hr")(11,"bd2-species-cards"),a()),i&2&&(l(3),g(" Last updated: ",Z(4,1,r.currentDate,"longDate")))},dependencies:[ne,oe,le,J],encapsulation:2});let t=e;return t})();var Ce=[{path:"usage",component:pe}],de=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=C({imports:[A.forChild(Ce),A]});let t=e;return t})();var at=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=x({type:e}),e.\u0275inj=C({imports:[X,se,de]});let t=e;return t})();export{v as a,ye as b,q as c,T as d,Ie as e,M as f,U as g,j as h,L as i,N as j,_e as k,at as l};
