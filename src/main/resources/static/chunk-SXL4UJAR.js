import{a as Ne,b as Q,c as R,d as Oe,e as Y,f as L,g as z,h as B,i as J,j as P,k as Re}from"./chunk-RNCA3VSA.js";import{a as oe,b as Be,c as Pe,d as je,e as Ge}from"./chunk-M7X7JQUQ.js";import{a as H}from"./chunk-UZVDE5XY.js";import{a as Le}from"./chunk-UYPC2SWM.js";import"./chunk-ZQDRPM5J.js";import{a as $,b as I,c as k}from"./chunk-5VP5V2NG.js";import"./chunk-URHLGKLM.js";import"./chunk-FDKJ75ZE.js";import{j as q,k as Me}from"./chunk-VDA2LVPM.js";import"./chunk-PGRVX3MW.js";import"./chunk-6KRAEQXB.js";import{E as ke,a as ye,c as be,h as ge,i as Ee,j as Fe,l as Se,m as we,t as De,u as Ie,v as Ae,y as Te,z as Ve}from"./chunk-6XVRX2RL.js";import{Da as S,Ga as p,Ia as a,Kb as D,Lb as g,Qb as O,R as ce,Ra as o,S as A,Sa as s,Ta as f,U as de,Xa as x,Y as b,Z as T,_a as v,aa as _,ab as c,ac as G,ba as u,bc as ve,cc as W,dc as xe,ec as he,fb as pe,fc as re,gb as _e,hb as ue,ib as fe,ja as le,jb as d,jc as Ce,kb as F,kc as U,lb as w,ob as te,pb as ie,qb as ne,ra as m,rb as V,s as me,sa as h,tb as C,z as ee}from"./chunk-BWZCNJMV.js";var ct=()=>["/experiments"],dt=()=>["."],M=()=>({exact:!0}),lt=()=>["file"],pt=()=>["edit"],_t=()=>[".","data","view","ts"],ut=()=>[".","data","view","heatmap"],ft=()=>["ppa/new"],vt=()=>["ppa"],We=()=>({exact:!1}),xt=()=>["rhythmicity"],ht=()=>[".","data","ts-import"],Ct=()=>["publish"];function yt(e,i){e&1&&(o(0,"a",6),d(1,"Edit"),s()),e&2&&a("routerLink",C(2,pt))("routerLinkActiveOptions",C(3,M))}function bt(e,i){e&1&&(o(0,"a",6),d(1,"Show data"),s()),e&2&&a("routerLink",C(2,_t))("routerLinkActiveOptions",C(3,M))}function gt(e,i){e&1&&(o(0,"a",6),d(1,"Heatmap"),s()),e&2&&a("routerLink",C(2,ut))("routerLinkActiveOptions",C(3,M))}function Et(e,i){e&1&&(o(0,"a",6),d(1,"Period analysis"),s()),e&2&&a("routerLink",C(2,ft))("routerLinkActiveOptions",C(3,M))}function Ft(e,i){e&1&&(o(0,"a",6),d(1,"Period analysis"),s()),e&2&&a("routerLink",C(2,vt))("routerLinkActiveOptions",C(3,We))}function St(e,i){e&1&&(o(0,"a",6),d(1,"Rhythmicity"),s()),e&2&&a("routerLink",C(2,xt))("routerLinkActiveOptions",C(3,We))}function wt(e,i){if(e&1&&(o(0,"a",6),d(1),s()),e&2){let t=c(2);a("routerLink",C(3,ht))("routerLinkActiveOptions",C(4,M)),m(),w(" ",t.experiment.features.hasTSData?"Replace data":"Import data","")}}function Dt(e,i){e&1&&(o(0,"a",6)(1,"i",8),d(2,"lock_open"),s()()),e&2&&a("routerLink",C(2,Ct))("routerLinkActiveOptions",C(3,M))}function It(e,i){if(e&1){let t=x();o(0,"div",1)(1,"nav",2)(2,"a",3)(3,"i",4),d(4,"fast_rewind"),s()(),o(5,"a",5),v("click",function(){_(t);let n=c();return u(n.back())}),o(6,"i",4),d(7,"arrow_left"),s()(),o(8,"a",5),v("click",function(){_(t);let n=c();return u(n.refresh())}),o(9,"i",4),d(10,"refresh"),s()(),o(11,"a",6),d(12,"Overview"),s(),p(13,yt,2,4,"a",7)(14,bt,2,4,"a",7)(15,gt,2,4,"a",7)(16,Et,2,4,"a",7)(17,Ft,2,4,"a",7)(18,St,2,4,"a",7)(19,wt,2,5,"a",7),o(20,"a",6),d(21,"Files"),s(),p(22,Dt,3,4,"a",7),s()()}if(e&2){let t=c();m(2),a("routerLink",C(13,ct)),m(9),a("routerLink",C(14,dt))("routerLinkActiveOptions",C(15,M)),m(2),a("ngIf",t.experiment.security.canWrite),m(),a("ngIf",t.experiment.features.hasTSData),m(),a("ngIf",t.experiment.features.hasTSData),m(),a("ngIf",t.experiment.security.canWrite&&t.experiment.features.hasTSData&&!t.experiment.features.hasPPAJobs),m(),a("ngIf",t.experiment.features.hasPPAJobs),m(),a("ngIf",t.experiment.security.canWrite&&t.experiment.features.hasTSData||t.experiment.features.hasRhythmicityJobs),m(),a("ngIf",t.experiment.security.canWrite),m(),a("routerLink",C(16,lt))("routerLinkActiveOptions",C(17,M)),m(2),a("ngIf",t.experiment.security.isOwner||t.experiment.security.isSuperOwner)}}var Ue=(()=>{let i=class i{constructor(){this.onRefresh=new le}refresh(){this.onRefresh.emit(!0)}back(){window.history.back()}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=b({type:i,selectors:[["bd2-experiment-navigation"]],inputs:{experiment:"experiment"},outputs:{onRefresh:"onRefresh"},features:[V([])],decls:1,vars:1,consts:[["style","margin-bottom: 2em;",4,"ngIf"],[2,"margin-bottom","2em"],[1,"secondary"],[3,"routerLink"],[1,"material-icons","bd-icon"],["role","button",1,"shade",3,"click"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","active",3,"routerLink","routerLinkActiveOptions",4,"ngIf"],[1,"material-icons","bd-icon",2,"color","green"]],template:function(n,l){n&1&&p(0,It,23,18,"div",0),n&2&&a("ngIf",l.experiment)},dependencies:[g,xe,he],encapsulation:2});let e=i;return e})();function Tt(e,i){if(e&1&&(o(0,"div",2)(1,"strong"),d(2,"Open Access: "),s(),d(3," under "),o(4,"strong"),d(5),s(),d(6," license "),s()),e&2){let t=c(2);m(5),F(t.model.features.licence)}}function Vt(e,i){if(e&1&&(o(0,"span"),d(1),s()),e&2){let t=i.$implicit;m(),w("",t.name,", ")}}function kt(e,i){if(e&1&&(o(0,"div",2)(1,"strong"),d(2,"Authors: "),s(),p(3,Vt,2,1,"span",5),s()),e&2){let t=c(2);m(3),a("ngForOf",t.model.contributionDesc.authors)}}function Mt(e,i){if(e&1&&(o(0,"div",1)(1,"div",2)(2,"strong"),d(3,"Purpose: "),s(),d(4),s(),p(5,Tt,7,1,"div",3)(6,kt,4,1,"div",3),o(7,"div",4)(8,"strong"),d(9,"Data category: "),s(),d(10),s()()),e&2){let t=c();m(4),w(" ",t.model.generalDesc.purpose," "),m(),a("ngIf",t.model.features.isOpenAccess),m(),a("ngIf",t.model.contributionDesc.authors),m(4),w(" ",t.model.dataCategory==null?null:t.model.dataCategory.longName," ")}}var qe=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=b({type:i,selectors:[["bd2-experiment-basic-info-view"]],inputs:{model:"model"},decls:1,vars:1,consts:[["class","summary-box",4,"ngIf"],[1,"summary-box"],[1,"item"],["class","item",4,"ngIf"],[1,"item","item-last"],[4,"ngFor","ngForOf"]],template:function(n,l){n&1&&p(0,Mt,11,4,"div",0),n&2&&a("ngIf",l.model)},dependencies:[D,g],encapsulation:2});let e=i;return e})();function Bt(e,i){e&1&&(o(0,"i",7),d(1,"lock_open"),s())}function Pt(e,i){if(e&1){let t=x();o(0,"div")(1,"div",1)(2,"div",2)(3,"h3"),p(4,Bt,2,0,"i",3),d(5),f(6,"br"),o(7,"small"),d(8),s()()(),o(9,"div",4),f(10,"bd2-experiment-basic-info-view",5),s()(),o(11,"bd2-experiment-navigation",6),v("onRefresh",function(){_(t);let n=c();return u(n.refresh())}),s()()}if(e&2){let t=c();m(4),a("ngIf",t.model.features.isOpenAccess),m(),w(" Experiment: ",t.model.id,""),m(3),F(t.model.name),m(2),a("model",t.model),m(),a("experiment",t.model)}}function jt(e,i){e&1&&(o(0,"div"),d(1," ... loading experiment "),o(2,"p"),d(3,"If just logged in try to refresh the window if the experiment is not loading."),s()())}function Gt(e,i){e&1&&(o(0,"div")(1,"h4"),d(2,"You don't have sufficient permissions to see the experiment"),s(),o(3,"p"),d(4,"Try to login"),s()())}var Qe=(()=>{let i=class i{constructor(r,n,l,y,ot,at,st,mt){this.experimentService=r,this.RDMSocial=n,this.currentExperiment=l,this.feedback=y,this.analytics=ot,this.route=at,this.router=st,this.dialogs=mt,this.isUnauthorised=!1}ngOnInit(){this.expSubscription=this.currentExperiment.experiment().pipe(ee(r=>!!r)).subscribe(r=>{this.model=r,this.analytics.experimentView(r.id),this.RDMSocial.shouldShowMeasurementWarning(r).then(n=>{n&&this.showMetadataWarning()})},r=>this.feedback.error(r),()=>console.log("currentExperimentStream completed")),this.paramsSubscription=this.route.paramMap.pipe(me(r=>r.get("id")),ee(r=>!!r)).subscribe(r=>this.loadExperiment(+r))}ngOnDestroy(){this.paramsSubscription&&this.paramsSubscription.unsubscribe(),this.expSubscription&&this.expSubscription.unsubscribe(),this.currentExperiment&&this.currentExperiment.close()}refresh(){this.model&&this.loadExperiment(this.model.id)}loadExperiment(r){this.experimentService.getExperiment(r).then(n=>{this.currentExperiment.push(n),this.isUnauthorised=!1}).catch(n=>{this.isUnauthorised=n.isUnauthorised,this.feedback.error(n)})}handleWarningResponse(r){console.log("Dialog: "+r)}showMetadataWarning(){this.dialogs.confirm("Metadata reminder",`
        <p>
        Please add measurements details, like technique, equipment and short description.
        </p>
        <p>
        It will improve the metadata quality and it will help you when searching for the data.
        </p>
`,"Not now").subscribe(r=>{this.RDMSocial.registerMeasurementWarning(this.model),r&&this.router.navigate(["edit"],{relativeTo:this.route,fragment:"MeasurementSection"})})}};i.\u0275fac=function(n){return new(n||i)(h(q),h(H),h($),h(U),h(ye),h(G),h(W),h(Le))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],features:[V([$,I])],decls:5,vars:3,consts:[[4,"ngIf"],[1,"card","asset-card"],[1,"card-header"],["class","material-icons bd-icon","style","color: green; font-size: 1.5em;",4,"ngIf"],[1,"card-body"],[3,"model"],[3,"onRefresh","experiment"],[1,"material-icons","bd-icon",2,"color","green","font-size","1.5em"]],template:function(n,l){n&1&&(o(0,"div"),p(1,Pt,12,5,"div",0)(2,jt,4,0,"div",0)(3,Gt,5,0,"div",0),f(4,"router-outlet"),s()),n&2&&(m(),a("ngIf",l.model),m(),a("ngIf",!l.model&&!l.isUnauthorised),m(),a("ngIf",!l.model&&l.isUnauthorised))},dependencies:[g,ve,Ue,qe],encapsulation:2});let e=i;return e})();function Wt(e,i){if(e&1&&(o(0,"div")(1,"h3"),d(2,"Overview of experimental details"),s(),o(3,"div",1)(4,"div",2),d(5,"General description"),s(),o(6,"div",3),f(7,"bd2-general-desc-view",4),s()(),o(8,"div",1)(9,"div",2),d(10,"Contributions"),s(),o(11,"div",3),f(12,"bd2-contr-desc-view",4),s()(),o(13,"div",1)(14,"div",2),d(15,"Biological details"),s(),o(16,"div",3),f(17,"bd2-simple-bio-desc-view",4),s()(),o(18,"div",1)(19,"div",2),d(20,"Measurement details"),s(),o(21,"div",3),f(22,"bd2-measurement-desc-view",4),s()()()),e&2){let t=c();m(7),a("model",t.assay.generalDesc),m(5),a("model",t.assay.contributionDesc),m(5),a("model",t.assay),m(5),a("model",t.assay.experimentalDetails.measurementDesc)}}var He=(()=>{let i=class i extends k{constructor(r){super(r)}};i.\u0275fac=function(n){return new(n||i)(h(I))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],features:[V([]),S],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"model"]],template:function(n,l){n&1&&p(0,Wt,23,4,"div",0),n&2&&a("ngIf",l.assay)},dependencies:[g,R,L,B,P],encapsulation:2});let e=i;return e})();var X=class X{constructor(){}validate(i){let t=[];return i?((!i.species||i.species.trim()=="")&&t.push("Non empty species is required"),(!i.dataCategory||i.dataCategory.name=="NONE")&&t.push("Data category is required"),t):["Cannot validate null object"]}};X.INSTANCE=new X;var K=X;var Z=class Z{constructor(){this.generalV=Ne.INSTANCE,this.contribV=Oe.INSTANCE,this.bioV=K.INSTANCE}validate(i){let t=[];return t=t.concat(this.generalV.validate(i.generalDesc),this.contribV.validate(i.contributionDesc),this.bioV.validate(i)),t}};Z.INSTANCE=new Z;var j=Z;function zt(e,i){if(e&1&&(o(0,"li"),d(1),s()),e&2){let t=i.$implicit;m(),F(t)}}function Jt(e,i){if(e&1&&(o(0,"div",8)(1,"ul"),p(2,zt,2,1,"li",9),s()()),e&2){let t=c(2);m(2),a("ngForOf",t.errors)}}function $t(e,i){if(e&1){let t=x();o(0,"bd2-general-desc-form",10),v("onAccepted",function(n){_(t);let l=c(2);return u(l.saveEdits(n))})("onCancelled",function(n){_(t);let l=c(2);return u(l.hideEdits(n))}),s()}if(e&2){let t=c(2);a("blocked",t.blocked)("model",t.assay.generalDesc)}}function Ht(e,i){if(e&1&&f(0,"bd2-general-desc-view",11),e&2){let t=c(2);a("model",t.assay.generalDesc)}}function Kt(e,i){if(e&1){let t=x();o(0,"div"),f(1,"hr"),o(2,"button",12),v("click",function(){_(t);let n=c(2);return u(n.activeGeneralDescForm=!0)}),d(3,"Modify "),s()()}if(e&2){let t=c(2);m(2),a("disabled",t.activeGeneralDescForm)}}function Xt(e,i){if(e&1){let t=x();o(0,"bd2-contr-desc-form",10),v("onAccepted",function(n){_(t);let l=c(2);return u(l.saveEdits(n))})("onCancelled",function(n){_(t);let l=c(2);return u(l.hideEdits(n))}),s()}if(e&2){let t=c(2);a("blocked",t.blocked)("model",t.assay.contributionDesc)}}function Zt(e,i){if(e&1&&f(0,"bd2-contr-desc-view",11),e&2){let t=c(2);a("model",t.assay.contributionDesc)}}function ei(e,i){if(e&1){let t=x();o(0,"div"),f(1,"hr"),o(2,"button",12),v("click",function(){_(t);let n=c(2);return u(n.activeContributionDescForm=!0)}),d(3,"Modify "),s()()}if(e&2){let t=c(2);m(2),a("disabled",t.activeContributionDescForm)}}function ti(e,i){if(e&1){let t=x();o(0,"bd2-simple-bio-desc-form",10),v("onAccepted",function(n){_(t);let l=c(2);return u(l.saveEdits(n))})("onCancelled",function(n){_(t);let l=c(2);return u(l.hideEdits(n))}),s()}if(e&2){let t=c(2);a("blocked",t.blocked)("model",t.assay)}}function ii(e,i){if(e&1&&f(0,"bd2-simple-bio-desc-view",11),e&2){let t=c(2);a("model",t.assay)}}function ni(e,i){if(e&1){let t=x();o(0,"div"),f(1,"hr"),o(2,"button",12),v("click",function(){_(t);let n=c(2);return u(n.activeSimpleBioDescForm=!0)}),d(3,"Modify "),s()()}if(e&2){let t=c(2);m(2),a("disabled",t.activeSimpleBioDescForm)}}function ri(e,i){if(e&1){let t=x();o(0,"bd2-measurement-desc-rform",10),v("onAccepted",function(n){_(t);let l=c(2);return u(l.saveEdits(n))})("onCancelled",function(n){_(t);let l=c(2);return u(l.hideEdits(n))}),s()}if(e&2){let t=c(2);a("blocked",t.blocked)("model",t.assay.experimentalDetails.measurementDesc)}}function oi(e,i){if(e&1&&f(0,"bd2-measurement-desc-view",11),e&2){let t=c(2);a("model",t.assay.experimentalDetails.measurementDesc)}}function ai(e,i){if(e&1){let t=x();o(0,"div"),f(1,"hr"),o(2,"button",12),v("click",function(){_(t);let n=c(2);return u(n.activeMeasurementDescForm=!0)}),d(3,"Modify "),s()()}if(e&2){let t=c(2);m(2),a("disabled",t.activeMeasurementDescForm)}}function si(e,i){if(e&1&&(o(0,"li"),d(1),s()),e&2){let t=i.$implicit;m(),F(t)}}function mi(e,i){if(e&1&&(o(0,"div",8)(1,"ul"),p(2,si,2,1,"li",9),s()()),e&2){let t=c(2);m(2),a("ngForOf",t.errors)}}function ci(e,i){if(e&1&&(o(0,"div")(1,"h3"),d(2,"Modify experiment description"),s(),p(3,Jt,3,1,"div",1),o(4,"div",2)(5,"div",3),d(6,"General description"),s(),o(7,"div",4),p(8,$t,1,2,"bd2-general-desc-form",5)(9,Ht,1,1,"bd2-general-desc-view",6)(10,Kt,4,1,"div",0),s()(),o(11,"div",2)(12,"div",3),d(13,"Contributions"),s(),o(14,"div",4),p(15,Xt,1,2,"bd2-contr-desc-form",5)(16,Zt,1,1,"bd2-contr-desc-view",6)(17,ei,4,1,"div",0),s()(),o(18,"div",2)(19,"div",3),d(20,"Biological details"),s(),o(21,"div",4),p(22,ti,1,2,"bd2-simple-bio-desc-form",5)(23,ii,1,1,"bd2-simple-bio-desc-view",6)(24,ni,4,1,"div",0),s()(),o(25,"div",7)(26,"div",3),d(27,"Measurement details"),s(),o(28,"div",4),p(29,ri,1,2,"bd2-measurement-desc-rform",5)(30,oi,1,1,"bd2-measurement-desc-view",6)(31,ai,4,1,"div",0),s()(),p(32,mi,3,1,"div",1),s()),e&2){let t=c();m(3),a("ngIf",t.errors),m(5),a("ngIf",t.activeGeneralDescForm),m(),a("ngIf",!t.activeGeneralDescForm),m(),a("ngIf",!t.activeGeneralDescForm),m(5),a("ngIf",t.activeContributionDescForm),m(),a("ngIf",!t.activeContributionDescForm),m(),a("ngIf",!t.activeContributionDescForm),m(5),a("ngIf",t.activeSimpleBioDescForm),m(),a("ngIf",!t.activeSimpleBioDescForm),m(),a("ngIf",!t.activeSimpleBioDescForm),m(5),a("ngIf",t.activeMeasurementDescForm),m(),a("ngIf",!t.activeMeasurementDescForm),m(),a("ngIf",!t.activeMeasurementDescForm),m(),a("ngIf",t.errors)}}var Ke=(()=>{let i=class i extends k{constructor(r,n){super(n),this.route=r,this.blocked=!1,this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.titlePart=" Edit",this.validator=j.INSTANCE}ngOnInit(){super.ngOnInit(),this.route.fragment.subscribe(r=>{this.requestedSection=r,this.focusOnSection(r)})}ngAfterViewInit(){this.focusOnSection(this.requestedSection)}focusOnSection(r){if(!r)return;let n=document.getElementById(r);n&&n.scrollIntoView(),r==="MeasurementSection"&&(this.activeMeasurementDescForm=!0)}saveEdits(r){this.assay&&r&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.save(this.assay).then(n=>(this.feedback.success('Experiment: "'+n.name+'" updated.'),n)).then(n=>(this.currentExperiment.push(n),n)).then(n=>{this.blocked=!1,this.hideEdits(r)}).catch(n=>{this.blocked=!1,this.feedback.error(n)}))}hideEdits(r){this.activeGeneralDescForm=!1,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiment",this.assay.id])}updateModel(r){this._orgModel=r,this.assay=r?r.clone():null,this.setTitle()}};i.\u0275fac=function(n){return new(n||i)(h(G),h(I))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],features:[V([]),S],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],[3,"blocked","model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["id","MeasurementSection",1,"card","mb-2"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"],[3,"onAccepted","onCancelled","blocked","model"],[3,"model"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(n,l){n&1&&p(0,ci,33,14,"div",0),n&2&&a("ngIf",l.assay)},dependencies:[D,g,Q,R,Y,L,z,B,J,P],encapsulation:2});let e=i;return e})();var Xe=(()=>{let i=class i{constructor(r){this.BD2REST=r}upload(r,n){let l=new FormData;for(let y=0;y<n.length;y++)l.append("file",n[y],n[y].name);return this.BD2REST.expFileUpload(r.id,l).then(y=>y.data)}getFiles(r){return this.BD2REST.files(r.id).then(n=>n.data).then(n=>this.json2AssetsList(n)).then(n=>this.fillURLs(n,r))}fillURLs(r,n){return r.map(l=>this.fillURL(l,n))}fillURL(r,n){let l=this.BD2REST.fileURL(n.id,r.id);return r.url=l,r.versions.forEach(y=>{y.url=l+"/"+y.versionId}),r}json2AssetsList(r){return r.map(n=>Be.deserialize(n))}};i.\u0275fac=function(n){return new(n||i)(de(Ce))},i.\u0275prov=ce({token:i,factory:i.\u0275fac,providedIn:"root"});let e=i;return e})();var li=["uploadWidget"];function pi(e,i){if(e&1){let t=x();o(0,"div")(1,"bd2-file-upload-widget",3,0),v("uploadFiles",function(n){_(t);let l=c(2);return u(l.upload(n))}),s(),f(3,"hr"),s()}if(e&2){let t=c(2);m(),a("autoReset",!1)("blocked",t.blocked)}}function _i(e,i){if(e&1&&f(0,"bd2-file-asset-view",5),e&2){let t=i.$implicit,r=c(3);a("model",t)("parentId",r.assay.id)}}function ui(e,i){e&1&&(o(0,"div",6),d(1,' Use "Replace data" to change timeseries files. '),s())}function fi(e,i){if(e&1&&(o(0,"div")(1,"h4"),d(2,"Timeseries files"),s(),p(3,_i,1,2,"bd2-file-asset-view",4)(4,ui,2,0,"div",2),f(5,"hr"),s()),e&2){let t=c(2);m(3),a("ngForOf",t.tsData),m(),a("ngIf",t.assay.security.canWrite)}}function vi(e,i){e&1&&(o(0,"div",6),d(1,' Use "Import data" to add timeseries files. '),s())}function xi(e,i){if(e&1&&f(0,"bd2-file-asset-view",5),e&2){let t=i.$implicit,r=c(3);a("model",t)("parentId",r.assay.id)}}function hi(e,i){if(e&1&&(o(0,"div")(1,"h4"),d(2,"Attachments"),s(),p(3,xi,1,2,"bd2-file-asset-view",4),s()),e&2){let t=c(2);m(3),a("ngForOf",t.attachments)}}function Ci(e,i){e&1&&(o(0,"div",6),d(1," Drag and upload files using the upload area in order to update the attachments. "),s())}function yi(e,i){if(e&1&&(o(0,"div"),p(1,pi,4,2,"div",1)(2,fi,6,2,"div",1)(3,vi,2,0,"div",2)(4,hi,4,1,"div",1)(5,Ci,2,0,"div",2),s()),e&2){let t=c();m(),a("ngIf",t.assay.security.canWrite),m(),a("ngIf",t.tsData&&t.tsData.length>0),m(),a("ngIf",!t.tsData||t.tsData.length===0),m(),a("ngIf",t.attachments&&t.attachments.length>0),m(),a("ngIf",t.assay.security.canWrite)}}var Ze=(()=>{let i=class i extends k{constructor(r,n){super(n),this.attachmentsService=r,this.attachments=[],this.tsData=[],this.blocked=!1,this.titlePart=" Files"}updateModel(r){super.updateModel(r),this.refreshAttachments()}refreshAttachments(){this.attachmentsService.getFiles(this.assay).then(r=>this.setFiles(r)).catch(r=>{this.feedback.error(r)})}setFiles(r){this.tsData=r.filter(n=>n.assetType.equals(oe.TS_DATA)),this.attachments=r.filter(n=>!n.assetType.equals(oe.TS_DATA))}upload(r){console.log("Uploading "+r.length),!(!r||r.length===0)&&(this.blocked=!0,this.attachmentsService.upload(this.assay,r).then(n=>{this.uploadWidget.reset(),this.blocked=!1;let l=n.length;this.feedback.success(l+" files uploaded")}).then(()=>this.refreshModel()).catch(n=>{this.blocked=!1,this.feedback.error(n)}))}};i.\u0275fac=function(n){return new(n||i)(h(Xe),h(I))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],viewQuery:function(n,l){if(n&1&&pe(li,5),n&2){let y;_e(y=ue())&&(l.uploadWidget=y.first)}},features:[S],decls:4,vars:1,consts:[["uploadWidget",""],[4,"ngIf"],["type","info","class","alert alert-info","role","alert",4,"ngIf"],[3,"uploadFiles","autoReset","blocked"],[3,"model","parentId",4,"ngFor","ngForOf"],[3,"model","parentId"],["type","info","role","alert",1,"alert","alert-info"]],template:function(n,l){n&1&&(o(0,"h3"),d(1,"Attached files"),s(),f(2,"hr"),p(3,yi,6,5,"div",1)),n&2&&(m(3),a("ngIf",l.assay))},dependencies:[D,g,Pe,je]});let e=i;return e})();function bi(e,i){if(e&1&&(o(0,"div")(1,"div",4),d(2," Experiment is already publicly available under "),o(3,"strong"),d(4),s(),d(5," licence. "),s()()),e&2){let t=c(2);m(4),F(t.assay.features.licence)}}function gi(e,i){if(e&1&&(o(0,"option",12),d(1),s()),e&2){let t=i.$implicit;a("value",t),m(),w("",t," ")}}function Ei(e,i){if(e&1){let t=x();o(0,"div")(1,"div",5),d(2," You are about to make the data public. Once they are public they cannot be made private again. "),o(3,"ul")(4,"li"),d(5,"make sure you know what you are doing"),s(),o(6,"li"),d(7,"make sure all contributors agree to public sharing"),s(),o(8,"li"),d(9,"double check the description is correct, not all changes will be possible after the publishing"),s()()(),o(10,"form",null,0)(12,"div",6)(13,"label",7),d(14,"Licence"),s(),o(15,"select",8,1),ne("ngModelChange",function(n){_(t);let l=c(2);return ie(l.licence,n)||(l.licence=n),u(n)}),p(17,gi,2,2,"option",9),s()(),o(18,"div",6)(19,"label")(20,"input",10,2),ne("ngModelChange",function(n){_(t);let l=c(2);return ie(l.terms,n)||(l.terms=n),u(n)}),s(),d(22," I understand that I cannot undo this operation "),s()(),o(23,"button",11),v("click",function(){_(t);let n=c(2);return u(n.publish())}),d(24," Publish "),s()()()}if(e&2){let t=fe(11),r=c(2);m(15),te("ngModel",r.licence),m(2),a("ngForOf",r.licences),m(3),te("ngModel",r.terms),m(3),a("disabled",!t.form.valid)}}function Fi(e,i){if(e&1&&(o(0,"div")(1,"h3"),d(2,"Publish experiment"),s(),p(3,bi,6,1,"div",3)(4,Ei,25,4,"div",3),s()),e&2){let t=c();m(3),a("ngIf",t.assay.features.isOpenAccess),m(),a("ngIf",!t.assay.features.isOpenAccess)}}var et=(()=>{let i=class i extends k{constructor(r){super(r),this.licences=["CC_BY"]}ngOnInit(){super.ngOnInit(),this.licence=this.licences[0]}publish(){this.terms&&this.licence&&this.experimentService.publish(this.assay,this.licence).then(r=>(this.feedback.success('Experiment: "'+r.name+'" published.'),r)).then(r=>(this.currentExperiment.push(r),r)).then(r=>{this.goToExpHome(r.id)}).catch(r=>{this.feedback.error(r)})}};i.\u0275fac=function(n){return new(n||i)(h(I))},i.\u0275cmp=b({type:i,selectors:[["bd2-publish-form"]],features:[S],decls:1,vars:1,consts:[["publishForm","ngForm"],["licenceF","ngModel"],["fTerms","ngModel"],[4,"ngIf"],["type","info","role","alert",1,"alert","alert-info"],["type","danger","role","alert",1,"alert","alert-danger"],[1,"form-group"],["for","licence"],["id","licence","required","","placeholder","Select licence","name","licence",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","checkbox","required","","id","terms","name","fTerms",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary",3,"click","disabled"],[3,"value"]],template:function(n,l){n&1&&p(0,Fi,5,2,"div",3),n&2&&a("ngIf",l.assay)},dependencies:[D,g,we,Ie,Ae,be,De,ge,Ee,Te,Ve,Se,Fe],encapsulation:2});let e=i;return e})();function Si(e,i){e&1&&(o(0,"div")(1,"h4"),d(2,"You don't have permission to create experiment"),s(),o(3,"p"),d(4,"Try to login"),s()())}function wi(e,i){if(e&1){let t=x();o(0,"bd2-general-desc-form",9),v("onAccepted",function(n){_(t);let l=c(2);return u(l.hideEdits(n))})("onCancelled",function(n){_(t);let l=c(2);return u(l.hideEdits(n))}),s()}if(e&2){let t=c(2);a("model",t.assay.generalDesc)}}function Di(e,i){if(e&1&&f(0,"bd2-general-desc-view",10),e&2){let t=c(2);a("model",t.assay.generalDesc)}}function Ii(e,i){if(e&1){let t=x();o(0,"div"),f(1,"hr"),o(2,"button",11),v("click",function(){_(t);let n=c(2);return u(n.activeGeneralDescForm=!0)}),d(3,"Modify "),s()()}if(e&2){let t=c(2);m(2),a("disabled",t.activeGeneralDescForm)}}function Ai(e,i){if(e&1){let t=x();o(0,"bd2-simple-bio-desc-form",9),v("onAccepted",function(n){_(t);let l=c(2);return u(l.hideEdits(n))})("onCancelled",function(n){_(t);let l=c(2);return u(l.hideEdits(n))}),s()}if(e&2){let t=c(2);a("model",t.assay)}}function Ti(e,i){if(e&1&&f(0,"bd2-simple-bio-desc-view",10),e&2){let t=c(2);a("model",t.assay)}}function Vi(e,i){if(e&1){let t=x();o(0,"div"),f(1,"hr"),o(2,"button",11),v("click",function(){_(t);let n=c(2);return u(n.activeSimpleBioDescForm=!0)}),d(3,"Modify "),s()()}if(e&2){let t=c(2);m(2),a("disabled",t.activeSimpleBioDescForm)}}function ki(e,i){if(e&1){let t=x();o(0,"bd2-contr-desc-form",9),v("onAccepted",function(n){_(t);let l=c(2);return u(l.hideEdits(n))})("onCancelled",function(n){_(t);let l=c(2);return u(l.hideEdits(n))}),s()}if(e&2){let t=c(2);a("model",t.assay.contributionDesc)}}function Mi(e,i){if(e&1&&f(0,"bd2-contr-desc-view",10),e&2){let t=c(2);a("model",t.assay.contributionDesc)}}function Ni(e,i){if(e&1){let t=x();o(0,"div"),f(1,"hr"),o(2,"button",11),v("click",function(){_(t);let n=c(2);return u(n.activeContributionDescForm=!0)}),d(3,"Modify "),s()()}if(e&2){let t=c(2);m(2),a("disabled",t.activeContributionDescForm)}}function Oi(e,i){if(e&1){let t=x();o(0,"bd2-measurement-desc-rform",9),v("onAccepted",function(n){_(t);let l=c(2);return u(l.hideEdits(n))})("onCancelled",function(n){_(t);let l=c(2);return u(l.hideEdits(n))}),s()}if(e&2){let t=c(2);a("model",t.assay.experimentalDetails.measurementDesc)}}function Ri(e,i){if(e&1&&f(0,"bd2-measurement-desc-view",10),e&2){let t=c(2);a("model",t.assay.experimentalDetails.measurementDesc)}}function Li(e,i){if(e&1){let t=x();o(0,"div"),f(1,"hr"),o(2,"button",11),v("click",function(){_(t);let n=c(2);return u(n.activeMeasurementDescForm=!0)}),d(3,"Modify "),s()()}if(e&2){let t=c(2);m(2),a("disabled",t.activeMeasurementDescForm)}}function Bi(e,i){if(e&1&&(o(0,"li"),d(1),s()),e&2){let t=i.$implicit;m(),F(t)}}function Pi(e,i){if(e&1&&(o(0,"div",12)(1,"ul"),p(2,Bi,2,1,"li",13),s()()),e&2){let t=c(2);m(2),a("ngForOf",t.errors)}}function ji(e,i){if(e&1){let t=x();o(0,"div")(1,"h3"),d(2,"Create experiment"),s(),o(3,"div",1)(4,"div",2),d(5,"General description"),s(),o(6,"div",3),p(7,wi,1,1,"bd2-general-desc-form",4)(8,Di,1,1,"bd2-general-desc-view",5)(9,Ii,4,1,"div",0),s()(),o(10,"div",1)(11,"div",2),d(12,"Biological details"),s(),o(13,"div",3),p(14,Ai,1,1,"bd2-simple-bio-desc-form",4)(15,Ti,1,1,"bd2-simple-bio-desc-view",5)(16,Vi,4,1,"div",0),s()(),o(17,"div",1)(18,"div",2),d(19,"Contributions"),s(),o(20,"div",3),p(21,ki,1,1,"bd2-contr-desc-form",4)(22,Mi,1,1,"bd2-contr-desc-view",5)(23,Ni,4,1,"div",0),s()(),o(24,"div",1)(25,"div",2),d(26,"Measurement details"),s(),o(27,"div",3),p(28,Oi,1,1,"bd2-measurement-desc-rform",4)(29,Ri,1,1,"bd2-measurement-desc-view",5)(30,Li,4,1,"div",0),s()(),p(31,Pi,3,1,"div",6),o(32,"button",7),v("click",function(){_(t);let n=c();return u(n.save())}),d(33,"Create"),s(),o(34,"button",8),v("click",function(){_(t);let n=c();return u(n.cancel())}),d(35,"Cancel"),s()()}if(e&2){let t=c();m(7),a("ngIf",t.activeGeneralDescForm),m(),a("ngIf",!t.activeGeneralDescForm),m(),a("ngIf",!t.activeGeneralDescForm),m(5),a("ngIf",t.activeSimpleBioDescForm),m(),a("ngIf",!t.activeSimpleBioDescForm),m(),a("ngIf",!t.activeSimpleBioDescForm),m(5),a("ngIf",t.activeContributionDescForm),m(),a("ngIf",!t.activeContributionDescForm),m(),a("ngIf",!t.activeContributionDescForm),m(5),a("ngIf",t.activeMeasurementDescForm),m(),a("ngIf",!t.activeMeasurementDescForm),m(),a("ngIf",!t.activeMeasurementDescForm),m(),a("ngIf",t.errors),m(),a("disabled",t.blocked||t.errors)}}var tt=(()=>{let i=class i extends Me{constructor(r,n,l,y){super(j.INSTANCE),this.experimentService=r,this.RDMSocial=n,this.feedback=l,this.router=y,this.isUnauthorised=!1,this.blocked=!1,this.activeGeneralDescForm=!0,this.activeContributionDescForm=!1,this.activeSimpleBioDescForm=!0,this.activeMeasurementDescForm=!1}ngOnInit(){this.experimentService.newDraft().then(r=>{this.assay=r}).catch(r=>{this.isUnauthorised=r.isUnauthorised,this.feedback.error(r)})}hideEdits(r){this.assay.generalDesc.name?this.activeGeneralDescForm=!1:this.activeGeneralDescForm=!0,this.assay.species&&this.assay.dataCategory?this.activeSimpleBioDescForm=!1:this.activeSimpleBioDescForm=!0,this.activeContributionDescForm=!1,this.activeMeasurementDescForm=!1,this.triggerValidation()}cancel(){this.clearErrors(),this.router.navigate(["/experiments"])}save(){this.assay&&this.triggerValidation()&&(this.blocked=!0,this.experimentService.newExperiment(this.assay).then(r=>(this.feedback.success('Experiment: "'+r.name+'" created.'),r)).then(r=>this.router.navigate(["/experiment",r.id])).catch(r=>{this.blocked=!1,this.feedback.error(r)}))}getModel(){return this.assay}};i.\u0275fac=function(n){return new(n||i)(h(q),h(H),h(U),h(W))},i.\u0275cmp=b({type:i,selectors:[["ng-component"]],features:[S],decls:2,vars:2,consts:[[4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"card-body"],["okLabel","Accept",3,"model","onAccepted","onCancelled",4,"ngIf"],[3,"model",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","button",1,"btn","btn-primary","mr-1",3,"click","disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["okLabel","Accept",3,"onAccepted","onCancelled","model"],[3,"model"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"alert","alert-danger"],[4,"ngFor","ngForOf"]],template:function(n,l){n&1&&p(0,Si,5,0,"div",0)(1,ji,36,14,"div",0),n&2&&(a("ngIf",l.isUnauthorised),m(),a("ngIf",l.assay))},dependencies:[D,g,Q,R,Y,L,z,B,J,P],encapsulation:2});let e=i;return e})();var Gi=[{path:"new",pathMatch:"full",component:tt},{path:":id",component:Qe,children:[{path:"",pathMatch:"full",component:He},{path:"edit",component:Ke},{path:"file",component:Ze},{path:"publish",component:et},{path:"data",loadChildren:()=>import("./chunk-BUH6FZG7.js").then(e=>e.TsDataModule)},{path:"ppa",loadChildren:()=>import("./chunk-QPP6P72S.js").then(e=>e.PPAModule)},{path:"rhythmicity",loadChildren:()=>import("./chunk-5TYAJFJZ.js").then(e=>e.RhythmicityModule)}]}],it=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=T({type:i}),i.\u0275inj=A({imports:[re.forChild(Gi),re]});let e=i;return e})();var nt=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=T({type:i}),i.\u0275inj=A({imports:[O,Ge]});let e=i;return e})();var rt=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=T({type:i}),i.\u0275inj=A({imports:[O,ke]});let e=i;return e})();var rr=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=T({type:i}),i.\u0275inj=A({imports:[O,Re,nt,rt,it]});let e=i;return e})();export{rr as ExperimentModule};
