import{a as d,b as S,c as Z,d as B,e as ie,f as oe,g as b,h as M,i as I,j as Fe,k as Le,m as Ne,n as Pe}from"./chunk-ZAWAO4I2.js";import{e as Ae}from"./chunk-N4OKHKPS.js";import{a as Ve}from"./chunk-B5P2D2WB.js";import"./chunk-4TYM42TU.js";import{o as Be}from"./chunk-4VNWEMJQ.js";import{b as Ee,c as Oe}from"./chunk-5UA7CFB2.js";import"./chunk-DL43TYWH.js";import"./chunk-UKKXMBWZ.js";import{a as ke,b as q,c as Re,d as U,e as K,f as H,g as Q}from"./chunk-M3J5BCX5.js";import"./chunk-HJGUN3AL.js";import"./chunk-JPGREJS7.js";import"./chunk-CPKRJJ3D.js";import"./chunk-BLUZNFO7.js";import{A as Me,E as Se,F as Ie,d as W,h as G,i as Ce,j as _e,l as z,m as be,n as j,o as we,t as Te,u as xe,v as ye,x as ve,y as De}from"./chunk-CF7GQVNH.js";import{Fa as se,Ia as C,Ka as u,La as $,Qb as P,R as le,Rb as V,S as F,Ta as r,U as re,Ua as a,Va as N,Wb as fe,Y as k,Z as L,Za as _,aa as h,ab as T,ba as g,cb as p,fb as ee,gc as he,ha as ae,hb as ce,ib as me,jb as de,lc as te,mb as pe,nb as c,ob as R,pb as x,pc as ge,sa as m,sb as y,ta as w,tb as v,ub as D,vb as ue}from"./chunk-G55OIOE6.js";var Je=["columnTypeForm"];function Xe(l,o){if(l&1){let n=_();r(0,"li")(1,"input",21,1),D("ngModelChange",function(t){h(n);let i=p();return v(i.cellRole,t)||(i.cellRole=t),g(t)}),a(),c(3),a()}if(l&2){let n=o.$implicit,e=p();m(),ee("value",n.name),y("ngModel",e.cellRole),m(2),x(" ",n.label," ")}}function Ye(l,o){if(l&1){let n=_();r(0,"div",12)(1,"label",22),c(2,"Propagate until block size"),a(),r(3,"input",23,2),D("ngModelChange",function(t){h(n);let i=p();return v(i.rangeSize,t)||(i.rangeSize=t),g(t)}),a()()}if(l&2){let n=p();m(3),y("ngModel",n.rangeSize)}}function $e(l,o){if(l&1){let n=_();r(0,"div",12)(1,"label",24),c(2,"Label"),a(),r(3,"input",25,3),D("ngModelChange",function(t){h(n);let i=p();return v(i.dataLabel,t)||(i.dataLabel=t),g(t)}),a()()}if(l&2){let n=p();m(3),y("ngModel",n.dataLabel)}}function et(l,o){if(l&1&&(r(0,"option",33),c(1),a()),l&2){let n=o.$implicit;ee("value",n.name),m(),x("",n.label," ")}}function tt(l,o){if(l&1){let n=_();r(0,"div",12)(1,"label",34),c(2,"Time between images (hours)"),a(),r(3,"input",35,7),D("ngModelChange",function(t){h(n);let i=p(2);return v(i.imgInterval,t)||(i.imgInterval=t),g(t)}),a()()}if(l&2){let n=p(2);m(3),y("ngModel",n.imgInterval)}}function it(l,o){if(l&1){let n=_();r(0,"div")(1,"div",12)(2,"label",26),c(3,"Type of time column"),a(),r(4,"select",27,4),D("ngModelChange",function(t){h(n);let i=p();return v(i.timeType,t)||(i.timeType=t),g(t)}),C(6,et,2,2,"option",28),a()(),r(7,"div",12)(8,"label",29),c(9,"Row with first timepoint"),a(),r(10,"input",30,5),D("ngModelChange",function(t){h(n);let i=p();return v(i.firstRow,t)||(i.firstRow=t),g(t)}),a()(),r(12,"div",12)(13,"label",31),c(14,"Time offset (hours)"),a(),r(15,"input",32,6),D("ngModelChange",function(t){h(n);let i=p();return v(i.timeOffset,t)||(i.timeOffset=t),g(t)}),a()(),C(17,tt,5,1,"div",15),a()}if(l&2){let n=p();m(4),y("ngModel",n.timeType),m(2),u("ngForOf",n.timeTypeOptions),m(4),y("ngModel",n.firstRow),m(5),y("ngModel",n.timeOffset),m(2),u("ngIf",n.isImageBased())}}function ot(l,o){if(l&1&&(r(0,"div",37),c(1),a()),l&2){let n=o.$implicit;m(),R(n)}}function nt(l,o){if(l&1&&(r(0,"div"),C(1,ot,2,1,"div",36),a()),l&2){let n=p();m(),u("ngForOf",n.errors)}}var J=class{constructor(o,n,e,t){this.selectedRange=o,this.lastCol=n,this.showTime=e,this.label=t}},ze=(()=>{let o=class o{constructor(e,t){this.myself=e,this.errors=null,this.cellRoles=[d.IGNORED,d.BACKGROUND,d.TIME,d.DATA],this.timeTypeOptions=[S.TIME_IN_HOURS,S.TIME_IN_MINUTES,S.TIME_IN_SECONDS,S.IMG_NUMBER],this.lastCol=t.lastCol,this.showTime=t.showTime,this.show(t.selectedRange,t.label)}ngOnInit(){}set showTime(e){e?this.cellRoles=[d.IGNORED,d.BACKGROUND,d.TIME,d.DATA]:this.cellRoles=[d.IGNORED,d.BACKGROUND,d.DATA]}isData(){return this.cellRole===d.DATA.name}isTime(){return this.cellRole===d.TIME.name}isImageBased(){return this.isTime()&&this.timeType===S.IMG_NUMBER.name}show(e,t){e&&(this.orgRange=e,this.rangeSize=e.range.size(),this.rangeLabel=t||e.columnRangeLabel,e.role&&(this.cellRole=e.role.name),e.role==d.DATA&&e.details&&(this.dataLabel=e.details.dataLabel),e.role==d.TIME&&e.details&&(this.timeType=e.details.timeType.name,this.timeOffset=e.details.timeOffset,this.imgInterval=e.details.imgInterval,this.firstRow=e.details.firstRow))}hide(){this.myself.close()}accepted(){this.isValid()&&this.myself.close(this.emitDescription())}acceptedAndNext(){if(!this.isValid())return;let e=this.emitDescription();if(!(e.range.lastCol>=this.lastCol)){let t=this.nextRange(e.range,this.rangeSize),i=new I(t);i.role=d.DATA,i.details=e.details,e.follow=i}this.myself.close(e)}nextRange(e,t){let i=e.lastCol+1,s=i+t-1;return s=Math.min(s,this.lastCol),new M(new b(i,e.first.row),new b(s,e.first.row))}emitDescription(){let e=this.recalculateRange(this.orgRange.range),t={};if(this.isData())t=new B(this.dataLabel);else if(this.isTime()){let s=new Z;s.firstRow=this.firstRow,s.timeType=S.get(this.timeType),s.timeOffset=this.timeOffset,this.isImageBased()&&(s.imgInterval=this.imgInterval),t=s}let i=new I(e,this.orgRange.content);return i.role=d.get(this.cellRole),i.details=t,i}isValid(){let e=[];return d.get(this.cellRole)||e.push("Unknown role: "+this.cellRole),this.isData()&&(!this.dataLabel||this.dataLabel.trim()==="")&&(e.push("Non empty data label is required"),this.dataLabel=null),this.isTime()?((!this.firstRow||this.firstRow<1)&&e.push("Row nr of the first time point must be >= 1"),this.isImageBased()&&(!this.imgInterval||this.imgInterval<=0)&&e.push("Image interval must be > 0")):(!this.rangeSize||this.rangeSize<1)&&e.push("Block size must be >= 1"),e.length===0?(this.errors=null,!0):!1}recalculateRange(e){let t=e.first;if(this.isTime())return t=new b(t.col,this.firstRow),new M(t,t);if(this.rangeSize!==e.size()){let i=t.col+this.rangeSize-1,s=new b(Math.min(i,this.lastCol),t.row);return new M(t,s)}return e}};o.\u0275fac=function(t){return new(t||o)(w(ke),w(q))},o.\u0275cmp=k({type:o,selectors:[["ng-component"]],viewQuery:function(t,i){if(t&1&&ce(Je,7),t&2){let s;me(s=de())&&(i.columnTypeForm=s.first)}},decls:28,vars:8,consts:[["columnTypeForm","ngForm"],["fCellRole","ngModel"],["fSize","ngModel"],["fDataLabel","ngModel"],["fTimeType","ngModel"],["fFirstRow","ngModel"],["fTimeOffset","ngModel"],["fImgInterval","ngModel"],["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],[1,"form-group"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"click","disabled"],[1,"btn","btn-primary","btn-sm","m-1",3,"click","disabled"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","radio","required","","name","fCellRole",3,"ngModelChange","value","ngModel"],["for","size"],["type","number","step","1","min","1","id","size","required","","name","fSize",1,"form-control",3,"ngModelChange","ngModel"],["for","dataLabel"],["type","text","id","dataLabel","placeholder","e.g. TOC1 SD","required","","minlength","2","name","fDataLabel",1,"form-control",3,"ngModelChange","ngModel"],["for","timeType"],["id","timeType","required","","name","fTimeType",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","firstRow"],["type","number","id","firstRow","step","1","min","1","required","","placeholder","e.g. 2","name","fFirstRow",1,"form-control",3,"ngModelChange","ngModel"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control",3,"ngModelChange","ngModel"],[3,"value"],["for","imgInterval"],["type","number","id","imgInterval","required","","step","any","min","0.01","placeholder","e.g. 1.5","name","fImgInterval",1,"form-control",3,"ngModelChange","ngModel"],["dismissOnTimeout","3000","dismissible","true","class","alert alert-danger","role","alert",4,"ngFor","ngForOf"],["dismissOnTimeout","3000","dismissible","true","role","alert",1,"alert","alert-danger"]],template:function(t,i){if(t&1){let s=_();r(0,"h4",8),c(1,"Describe data column(s) "),r(2,"button",9)(3,"span",10),c(4,"\xD7"),a()()(),r(5,"div",11)(6,"p"),c(7," Columns "),r(8,"strong"),c(9),a()(),r(10,"form",null,0)(12,"div",12)(13,"label"),c(14,"Column type"),a(),r(15,"ul",13),C(16,Xe,4,3,"li",14),a()(),C(17,Ye,5,1,"div",15)(18,$e,5,1,"div",15)(19,it,18,5,"div",16)(20,nt,2,1,"div",16),a()(),r(21,"div",17)(22,"button",18),T("click",function(){return h(s),g(i.acceptedAndNext())}),c(23,"OK and Next "),a(),r(24,"button",19),T("click",function(){return h(s),g(i.accepted())}),c(25,"OK "),a(),r(26,"button",20),T("click",function(){return h(s),g(i.hide())}),c(27,"Cancel"),a()()}if(t&2){let s=pe(11);m(9),x("[",i.rangeLabel,"]"),m(7),u("ngForOf",i.cellRoles),m(),u("ngIf",!i.isTime()),m(),u("ngIf",i.isData()),m(),u("ngIf",i.isTime()),m(),u("ngIf",i.errors),m(2),u("disabled",!s.form.valid),m(2),u("disabled",!s.form.valid)}},dependencies:[P,V,be,xe,ye,W,j,Te,we,G,Ce,De,Me,ve,z,_e,U,K,Q,H],encapsulation:2});let l=o;return l})();var je=(()=>{let o=class o{constructor(e){this.show(e)}ngOnInit(){}show(e){this.orgRange=e,this.rowNr=e.range.first.row,this.values=e.content}};o.\u0275fac=function(t){return new(t||o)(w(q))},o.\u0275cmp=k({type:o,selectors:[["ng-component"]],decls:24,vars:3,consts:[["mat-dialog-title","",1,"modal-title"],["mat-dialog-close","","aria-label","Close","type","button",1,"close","float-right"],["aria-hidden","true"],["mat-dialog-content","",1,"modal-body"],[1,"word_wrapping"],["mat-dialog-actions",""],[1,"btn","btn-primary","btn-sm","mr-1",3,"mat-dialog-close"],["mat-dialog-close","",1,"btn","btn-outline-secondary","btn-sm"]],template:function(t,i){t&1&&(r(0,"h4",0),c(1,"Use row content as data labels(s) "),r(2,"button",1)(3,"span",2),c(4,"\xD7"),a()()(),r(5,"div",3)(6,"div")(7,"p"),c(8,"Use values from row "),r(9,"strong"),c(10),a(),c(11," as data labels"),a(),r(12,"p"),c(13,"Existing labels and column types will be overwritten"),a()(),r(14,"div",4)(15,"p")(16,"strong"),c(17,"Labels: "),a(),c(18),a()()(),r(19,"div",5)(20,"button",6),c(21,"Copy labels"),a(),r(22,"button",7),c(23,"Cancel"),a()()),t&2&&(m(10),x("[",i.rowNr,"]"),m(8),R(i.values),m(2),u("mat-dialog-close",i.orgRange))},dependencies:[U,K,Q,H],encapsulation:2});let l=o;return l})();var qe=(()=>{let o=class o{constructor(e){this.BD2REST=e}getSimpleTableView(e){return this.BD2REST.fileViewSimpleTable(e).then(t=>t.data)}verifyFormat(e,t){return this.BD2REST.fileViewVerifyFormat(e,t).toPromise()}};o.\u0275fac=function(t){return new(t||o)(re(ge))},o.\u0275prov=le({token:o,factory:o.\u0275fac,providedIn:"root"});let l=o;return l})();var X=class l{constructor(o,n,e,t,i){this.rows=o,this.th=n,this.rowsLabels=e,this.specialRows=t,this.specialRowsLabels=i,this.width=l.maxLength(o),n?this.th=n:this.th=o.length<1?[]:l.labelCols(this.width),this.rowsLabels=e||l.labelRows(o.length),this.specialRows=t||[],this.specialRowsLabels=i||l.blankRows(this.specialRows.length)}static labelRows(o){let n=[];for(let e=1;e<=o;e++)n.push(""+e);return n}static blankRows(o){let n=[];for(let e=0;e<o;e++)n.push("");return n}static maxLength(o){return!o||o.length<1?0:Math.max.apply(Math,o.map(n=>n.length))}static labelCols(o){let n=[];for(let e=1;e<=o;e++)n.push(ie(e));return n}};var A=(()=>{let o=class o{static color(e){return o.colors[e%o.colors.length]}};o.TIME_BG="lightyellow",o.IGNORED_BG="lightgrey",o.NOISE_BG="darkgrey",o.colors=["lightgreen","lightblue","lightcoral","lightcyan","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","palegoldenrod","paleturquoise","palevioletred"];let l=o;return l})();function rt(l,o){l&1&&(r(0,"div",10)(1,"strong"),c(2,"Missing data labels. Please use one of the methods:"),a(),r(3,"ul")(4,"li"),c(5,"Click and draw over the headers of columns to select the range and assign the data labels in the popup dialog. "),a(),r(6,"li"),c(7,"Use the form below to manually provide the column range and the data label."),a()()())}function at(l,o){if(l&1){let n=_();r(0,"div")(1,"div",11)(2,"label",12),c(3,"Time parameter: offset (hours)"),a(),r(4,"input",13,0),D("ngModelChange",function(t){h(n);let i=p(2);return v(i.timeColumnDescription.details.timeOffset,t)||(i.timeColumnDescription.details.timeOffset=t),g(t)}),a()()()}if(l&2){let n=p(2);m(4),y("ngModel",n.timeColumnDescription.details.timeOffset)}}function st(l,o){if(l&1){let n=_();r(0,"li",17),T("click",function(){let t=h(n).$implicit,i=p(3);return g(i.editBlock(t))}),r(1,"span")(2,"strong"),c(3),a(),c(4),a(),r(5,"a",18),T("click",function(){let t=h(n).$implicit,i=p(3);return g(i.deleteBlock(t))}),r(6,"i",19),c(7,"delete_forever"),a()()()}if(l&2){let n=o.$implicit;m(3),R(n.topcountLabel),m(),x(" : ",n.value,"")}}function ct(l,o){if(l&1&&(r(0,"div")(1,"p")(2,"strong"),c(3,"Columns descriptions (select to edit)"),a()(),r(4,"div",14)(5,"ul",15),C(6,st,8,2,"li",16),a()()()),l&2){let n=p(2);m(6),u("ngForOf",n.dataBlocks)}}function mt(l,o){if(l&1){let n=_();r(0,"th",20),T("mousedown",function(){let t=h(n).$implicit,i=p(2);return g(i.thSelectStart(t))})("mouseup",function(){let t=h(n).$implicit,i=p(2);return g(i.thSelectEnd(t))}),c(1),a()}if(l&2){let n=o.$implicit,e=p(2);m(),x(" ",e.dataModel.th[n]," ")}}function dt(l,o){if(l&1&&(r(0,"td"),c(1),a()),l&2){let n=o.$implicit,e=p().$implicit,t=p(2);$("background-color",t.bgColors[n]?t.bgColors[n]:"inherited"),m(),x("",e[n]," ")}}function pt(l,o){if(l&1&&(r(0,"tr")(1,"td",21),c(2),a(),C(3,dt,2,3,"td",22),a()),l&2){let n=o.index,e=p(2);m(2),R(e.dataModel.specialRowsLabels[n]),m(),u("ngForOf",e.visibleColIx)}}function ut(l,o){if(l&1&&(r(0,"td"),c(1),a()),l&2){let n=o.$implicit,e=p().$implicit,t=p(2);$("background-color",t.bgColors[n]?t.bgColors[n]:"inherited"),m(),x("",e[n]," ")}}function ft(l,o){if(l&1&&(r(0,"tr")(1,"td",21),c(2),a(),C(3,ut,2,3,"td",22),a()),l&2){let n=o.index,e=p(2);m(2),R(e.dataModel.rowsLabels[n]),m(),u("ngForOf",e.visibleColIx)}}function ht(l,o){if(l&1){let n=_();r(0,"div"),N(1,"hr"),r(2,"div")(3,"h4"),c(4,"Current Topcount import parameters "),a(),C(5,rt,8,0,"div",2)(6,at,6,1,"div",1)(7,ct,7,1,"div",3),r(8,"div")(9,"button",4),T("click",function(){h(n);let t=p();return g(t.accept())}),c(10,"Import timeseries "),a()()(),N(11,"hr"),r(12,"h4"),c(13,"Data table "),r(14,"small"),c(15,"(only top rows)"),a()(),r(16,"p"),c(17,"Click on column headers for description options"),a(),r(18,"div",5)(19,"table",6)(20,"thead")(21,"tr",7),N(22,"th"),C(23,mt,2,1,"th",8),a()(),r(24,"tbody"),C(25,pt,4,2,"tr",9)(26,ft,4,2,"tr",9),a()()()()}if(l&2){let n=p();m(5),u("ngIf",!n.hasData()),m(),u("ngIf",n.timeColumnDescription),m(),u("ngIf",n.dataBlocks&&n.dataBlocks.length>0),m(2),u("disabled",n.blocked||!n.hasTime()||!n.hasData()),m(14),u("ngForOf",n.visibleColIx),m(2),u("ngForOf",n.dataModel.specialRows),m(),u("ngForOf",n.dataModel.rows)}}var Ue=(()=>{let o=class o{constructor(e,t){this.confDialogs=e,this.matDialog=t,this.onAccepted=new ae,this.blocked=!1,this.confirmDataLoss=!1,this.columnBlocks=new Fe,this.dataBlocks=[],this.bgColors=[]}set dataTable(e){if(!e||e.length<1)return;let t=new X(e,this.topcountHeaders(),void 0,[[]],["L."]);this.dataModel=t,this.lastCol=t.width,this.visibleColIx=[];for(let i=0;i<t.width;i++)this.visibleColIx.push(i);this.initTime()}topcountHeaders(){let e=[];return["A","B","C","D","E","F","G","H"].forEach(i=>{for(let s=1;s<13;s++)e.push(i+s)}),e}initTime(){let e=new M(new b(0,0),new b(0,0)),t=new Z;t.timeType=S.TIME_IN_HOURS,t.timeOffset=0,t.firstRow=1;let i=new I(e);i.role=d.TIME,i.details=t,this.timeColumnDescription=i}hasTime(){return this.timeColumnDescription&&this.timeColumnDescription.role===d.TIME}hasData(){return this.dataBlocks.some(e=>e.details.role===d.DATA)}rowSelected(e){let t=this.joinRow(e),i=new b(0,e+1),s=new M(i,i),f=new I(s,t);this.askCopyRow(f)}askCopyRow(e){this.matDialog.open(je,{data:e,autoFocus:!1}).afterClosed().subscribe(i=>{i&&this.copyRowAsLabels(i)})}thSelectStart(e){this.thSelectedCol=e}thSelectEnd(e){if(this.thSelectedCol!==void 0&&this.thSelectedCol!=null){let t=new b(this.thSelectedCol+1,1),i=new b(e+1,1),s=new M(t,i),f=new I(s,void 0),E=this.columnBlocks.details(t.col);E&&(f.role=E.role,f.details=E.details),this.thSelectedCol=void 0,this.askColumnsDetails(f)}}askColumnsDetails(e){let t=this.rangeToTopcountLabel(e),i=new J(e,this.lastCol,!1,t);this.matDialog.open(ze,{data:i,autoFocus:!1}).afterClosed().subscribe(f=>{if(f){let E=f.follow;f.follow=void 0,this.setColumnType(f),E&&this.askColumnsDetails(E)}})}rangeToTopcountLabel(e){let t=e.range;return oe(t.firstCol)+"-"+oe(t.lastCol)}editBlock(e){e&&this.askColumnsDetails(e.details)}deleteBlock(e){e&&(e.details.role==d.TIME?this.clearTime():this.resetRegion(e.details.range),this.dataBlocks=this.columnBlocks.blocks)}accept(){if(!this.hasTime()||!this.hasData())return;let e=Promise.resolve(!0);this.containsDataGaps()&&(e=this.confDialogs.confirm("Do you want to import partial data?","Not all columns are described. Data columns without annotations will not be imported.<br>Click OK if you want to proceed.").toPromise()),e.then(t=>t?this.confirmDataLoss?this.confDialogs.confirm("Do you want to replace the existing data?","It will also erase all analysis results. <br>Click OK if you want to proceed.").toPromise():!0:!1).then(t=>{t&&this.emitParameters()}).catch(t=>console.log("Dialog error: "+t))}containsDataGaps(){if(this.dataBlocks.length<1||this.dataBlocks[this.dataBlocks.length-1].end<this.lastCol)return!0;let e=this.dataBlocks[0].start-1;for(let t=0;t<this.dataBlocks.length;t++){if(this.dataBlocks[t].start!==e+1)return!0;e=this.dataBlocks[t].end}return!1}emitParameters(){let e=new Ne;e.timeColumn=this.timeColumnDescription,e.dataBlocks=this.dataBlocks.map(t=>t.details),this.onAccepted.emit(e)}joinRow(e){return this.dataModel.rows[e].slice(0,10).join(" | ")+"..."}setColumnType(e){if(e&&e.role!==void 0){this.timeColumnDescription&&(e.role==d.TIME?this.clearTime():this.timeColumnDescription.firstCol>=e.firstCol&&this.timeColumnDescription.firstCol<=e.lastCol&&this.clearTime());let t;switch(e.role){case d.IGNORED:t="ign.";break;case d.BACKGROUND:t="bcg.";break;case d.TIME:t="Time";break;case d.DATA:t=e.details.dataLabel}this.columnBlocks.insert(e,t),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks;let i=this.dataModel.specialRows[0];if(i)for(let s=e.firstCol-1;s<e.lastCol;s++)i[s]=t;e.role==d.TIME&&(this.timeColumnDescription=e),this.updateBackgrounds()}}copyRowAsLabels(e){if(e){this.clearTime();let t=this.dataModel.specialRows[0];this.dataModel.rows[e.range.first.row-1].forEach((s,f)=>{if(s){let E=new B(s),ne=new b(f+1,0),Qe=new M(ne,ne),Y=new I(Qe,void 0);Y.details=E,Y.role=d.DATA,this.columnBlocks.insert(Y,s),t[f]=s}}),this.columnBlocks.merge(),this.dataBlocks=this.columnBlocks.blocks,this.updateBackgrounds()}}clearTime(){this.timeColumnDescription&&(this.resetRegion(this.timeColumnDescription.range),this.timeColumnDescription=void 0)}updateBackgrounds(){for(let e=0;e<this.dataBlocks.length;e++){let t=this.dataBlocks[e],i=A.color(e);t.details.role==d.IGNORED&&(i=A.IGNORED_BG),t.details.role==d.BACKGROUND&&(i=A.NOISE_BG),t.details.role==d.TIME&&(i=A.TIME_BG);for(let s=t.start-1;s<t.end;s++)this.bgColors[s]=i}}resetRegion(e){this.resetLabels(e),this.resetBackground(e),this.columnBlocks.delete(e)}resetBackground(e){for(let t=e.firstCol-1;t<e.lastCol;t++)this.bgColors[t]="transparent"}resetLabels(e){let t=this.dataModel.specialRows[0];for(let i=e.firstCol-1;i<e.lastCol;i++)t[i]="-"}fakeData(){let t=[],i=[];i.push("");for(let s=1;s<25;s++)i.push("RO "+s);t.push(i),i=[],i.push("");for(let s=1;s<25;s++)i.push("cls"+Math.round(s/3));t.push(i);for(let s=1;s<5;s++){i=[],i.push(""+s);for(let f=1;f<25;f++)i.push(""+(s+f));t.push(i)}return t}};o.\u0275fac=function(t){return new(t||o)(w(Ve),w(Re))},o.\u0275cmp=k({type:o,selectors:[["bd2-describe-topcount-table"]],inputs:{blocked:"blocked",confirmDataLoss:"confirmDataLoss",dataTable:"dataTable"},outputs:{onAccepted:"onAccepted"},decls:1,vars:1,consts:[["fTimeOffset","ngModel"],[4,"ngIf"],["type","danger","class","alert alert-danger","role","alert",4,"ngIf"],["style","",4,"ngIf"],[1,"btn","btn-primary",3,"click","disabled"],[2,"overflow-x","auto"],["role","grid",1,"table","table-bordered","excel-table",2,"width","auto"],["role","row"],[3,"mousedown","mouseup",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["type","danger","role","alert",1,"alert","alert-danger"],[1,"form-group"],["for","timeOffset"],["type","number","id","timeOffset","step","any","placeholder","e.g. -4","name","fTimeOffset",1,"form-control","short-input",3,"ngModelChange","ngModel"],[2,"max-height","20em","overflow-y","auto","margin-bottom","1em"],[1,"list-group"],["class","list-group-item",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item",3,"click"],["role","button","aria-label","delete",1,"float-right",3,"click"],[1,"material-icons","bd-icon","bd-primary"],[3,"mousedown","mouseup"],[1,"rowh"],[3,"background-color",4,"ngFor","ngForOf"]],template:function(t,i){t&1&&C(0,ht,27,7,"div",1),t&2&&u("ngIf",i.dataModel)},dependencies:[P,V,W,j,G,z],encapsulation:2});let l=o;return l})();function Ct(l,o){if(l&1){let n=_();r(0,"bd2-describe-topcount-table",1),T("onAccepted",function(t){h(n);let i=p();return g(i.import(t))}),a()}if(l&2){let n=p();u("dataTable",n.dataTable)("blocked",n.blocked)("confirmDataLoss",n.assay==null?null:n.assay.features.hasTSData)}}var Ke=(()=>{let o=class o extends Oe{constructor(e,t,i){super(i),this.fileViewService=e,this.route=t,this.blocked=!1,this.titlePart=" Import Data"}ngOnInit(){super.ngOnInit(),this.route.params.forEach(e=>{let t=e.fileId,i=e.format;t&&i?this.loadData(i,t):console.log(this.constructor.name+" null parameters")})}loadData(e,t){this.format=Le.get(e),this.fileId=t,this.blocked=!1,this.fileViewService.getSimpleTableView(t).then(i=>{this.dataTable=i}).catch(i=>{this.feedback.error(i)})}import(e){if(e&&this.fileId&&this.format){this.blocked=!0;let t=new Pe;t.fileId=this.fileId,t.importFormat=this.format,t.importParameters=e,this.experimentService.importTimeSeries(this.assay,t).toPromise().then(i=>{let s="Imported "+i.imported+" timeseries";return this.feedback.success(s),i}).then(()=>this.refreshModel()).then(i=>this.goToTSView()).catch(i=>{this.blocked=!1,this.feedback.error(i)})}}goToTSView(){let e=this.expHomePath();e.push("data"),e.push("view"),e.push("ts"),this.router.navigate(e)}};o.\u0275fac=function(t){return new(t||o)(w(qe),w(he),w(Ee))},o.\u0275cmp=k({type:o,selectors:[["ng-component"]],features:[ue([]),se],decls:3,vars:1,consts:[[3,"dataTable","blocked","confirmDataLoss","onAccepted",4,"ngIf"],[3,"onAccepted","dataTable","blocked","confirmDataLoss"]],template:function(t,i){t&1&&(r(0,"h3"),c(1,"Timeseries import"),a(),C(2,Ct,1,3,"bd2-describe-topcount-table",0)),t&2&&(m(2),u("ngIf",(i.format==null?null:i.format.name)==="TOPCOUNT"))},dependencies:[V,Ue],encapsulation:2});let l=o;return l})();var _t=[{path:"",children:[{path:":format/:fileId",component:Ke}]}],He=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=L({type:o}),o.\u0275inj=F({imports:[te.forChild(_t),te]});let l=o;return l})();var di=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=L({type:o}),o.\u0275inj=F({imports:[fe,Se,Ie,Ae,Be,He]});let l=o;return l})();export{di as TsOldImportModule};
