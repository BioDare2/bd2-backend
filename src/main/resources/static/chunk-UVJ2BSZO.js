import{a as se}from"./chunk-EDOAR6V4.js";import{a as Ae}from"./chunk-Z7H6HK2L.js";import{e as je}from"./chunk-ZCBCVESK.js";import{a as C}from"./chunk-AR2Z2RJU.js";import{a as Ve,b as Te}from"./chunk-EYDQJRZM.js";import"./chunk-3DGRJVY4.js";import{a as U,b as G,c as oe,g as W,h as Me,j as Ne,l as O,m as ke,o as Pe}from"./chunk-63EJLF7N.js";import{B as k,D as Ee,E as z,F as Se,G as Ie,H as Q,I as B,J as K,M as qe,d as R,f as u,i as F,j as E,k as re,m as ne,n as S,r as D,s as ae,t as L,z as I}from"./chunk-LPDAYVF7.js";import{a as N}from"./chunk-24L4UUKZ.js";import{Ab as be,Bb as y,Ca as s,Da as c,E as fe,Eb as H,Fb as Y,Gb as Z,Ma as _,Na as q,Sa as h,Wa as m,X as xe,Y as P,_ as Ce,bc as x,db as a,ea as g,eb as r,fa as v,fb as p,gc as ye,jb as b,k as we,la as he,ma as te,mb as w,ob as l,p as X,sc as ie,t as ue,tb as V,ub as T,uc as Re,vb as A,vc as Fe,xc as ge,yb as j,z as ee,zb as o}from"./chunk-Z4WVEEB6.js";var De=(()=>{class t{constructor(e){this.scriptLoaded=!1,this.readySubject=new we(!1),window.reCaptchaOnloadCallback=()=>e.run(this.onloadCallback.bind(this))}getReady(e){if(!this.scriptLoaded){this.scriptLoaded=!0;let i=document.body,n=document.createElement("script");n.innerHTML="",n.src="https://www.google.com/recaptcha/api.js?onload=reCaptchaOnloadCallback&render=explicit"+(e?"&hl="+e:""),n.async=!0,n.defer=!0,i.appendChild(n)}return this.readySubject.asObservable()}onloadCallback(){this.readySubject.next(!0)}static{this.\u0275fac=function(i){return new(i||t)(Ce(te))}}static{this.\u0275prov=xe({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Xe=["target"],me=(()=>{class t{constructor(e,i){this._zone=e,this._captchaService=i,this.site_key=null,this.theme="light",this.type="image",this.size="normal",this.tabindex=0,this.language=null,this.captchaResponse=new he,this.captchaExpired=new he,this.widgetId=null}ngOnInit(){this._captchaService.getReady(this.language).subscribe(e=>{e&&(this.widgetId=window.grecaptcha.render(this.targetRef.nativeElement,{sitekey:this.site_key,theme:this.theme,type:this.type,size:this.size,tabindex:this.tabindex,callback:i=>this._zone.run(this.recaptchaCallback.bind(this,i)),"expired-callback":()=>this._zone.run(this.recaptchaExpiredCallback.bind(this))}))})}reset(){this.widgetId!==null&&window.grecaptcha.reset(this.widgetId)}getResponse(){return this.widgetId?window.grecaptcha.getResponse(this.targetRef.nativeElement):null}recaptchaCallback(e){this.captchaResponse.emit(e)}recaptchaExpiredCallback(){this.captchaExpired.emit()}static{this.\u0275fac=function(i){return new(i||t)(c(te),c(De))}}static{this.\u0275cmp=_({type:t,selectors:[["bd2-recaptcha"]],viewQuery:function(i,n){if(i&1&&V(Xe,7),i&2){let d;T(d=A())&&(n.targetRef=d.first)}},inputs:{site_key:"site_key",theme:"theme",type:"type",size:"size",tabindex:"tabindex",language:"language"},outputs:{captchaResponse:"captchaResponse",captchaExpired:"captchaExpired"},standalone:!1,decls:2,vars:0,consts:[["target",""]],template:function(i,n){i&1&&p(0,"div",null,0)},encapsulation:2})}}return t})();var et=["recaptcha"];function tt(t,f){if(t&1&&(a(0,"div",5),o(1),r()),t&2){let e=l();s(),y("",e.msg," ")}}function it(t,f){if(t&1&&(a(0,"div",6),o(1),r()),t&2){let e=l();s(),y("",e.errMsg," ")}}function rt(t,f){if(t&1){let e=b();a(0,"form",null,0)(2,"div",7)(3,"label",8),o(4,"Login or email"),r(),a(5,"input",9),Z("ngModelChange",function(n){g(e);let d=l();return Y(d.identifier,n)||(d.identifier=n),v(n)}),r()(),a(6,"div",7)(7,"bd2-recaptcha",10,1),w("captchaResponse",function(n){g(e);let d=l();return v(d.captcha(n))})("captchaExpired",function(){g(e);let n=l();return v(n.captchaExpired())}),r(),a(9,"div",11),o(10," Captcha selection is needed "),r()(),a(11,"button",12),w("click",function(){g(e);let n=l();return v(n.request())}),o(12,"Send "),r()()}if(t&2){let e=j(1),i=l();s(5),H("ngModel",i.identifier),s(2),m("site_key",i.captchaSiteKey),s(2),m("hidden",!i.missingCaptcha),s(2),m("disabled",!e.valid)}}var ze=(()=>{class t{constructor(e){this.userService=e,this.requested=!1,this.captchaSiteKey=se.captchaSiteKey}ngOnInit(){}captcha(e){this.gRecaptchaResponse=e,e&&(this.missingCaptcha=!1)}captchaExpired(){this.gRecaptchaResponse=null}request(){!this.identifier||this.identifier.trim()===""||(this.msg=void 0,this.errMsg=void 0,this.userService.requestReset(this.identifier,this.gRecaptchaResponse).then(e=>{this.msg="Reset link was sent to "+e,this.requested=!0}).catch(e=>{this.errMsg=e.message?e.message:e,this.gRecaptchaResponse=null,this.recaptcha&&this.recaptcha.reset()}))}static{this.\u0275fac=function(i){return new(i||t)(c(C))}}static{this.\u0275cmp=_({type:t,selectors:[["bd2-reset-request"]],viewQuery:function(i,n){if(i&1&&V(et,5),i&2){let d;T(d=A())&&(n.recaptcha=d.first)}},standalone:!1,decls:6,vars:3,consts:[["reminderForm","ngForm"],["recaptcha",""],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[4,"ngIf"],[1,"alert","alert-success"],[1,"alert","alert-danger"],[1,"form-group"],["for","identifier"],["type","text","required","","id","identifier","name","identifier",1,"form-control",3,"ngModelChange","ngModel"],[3,"captchaResponse","captchaExpired","site_key"],[1,"alert","alert-danger",3,"hidden"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(a(0,"div")(1,"h3"),o(2,"Forgotten password"),r(),h(3,tt,2,1,"div",2)(4,it,2,1,"div",3)(5,rt,13,4,"form",4),r()),i&2&&(s(3),m("ngIf",n.msg),s(),m("ngIf",n.errMsg),s(),m("ngIf",!n.requested))},dependencies:[x,S,R,F,E,I,ne,re,me],encapsulation:2})}}return t})();var nt=/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/;function at(t){return t=t?t.toLocaleLowerCase():"",!!nt.test(t)}var ot=/^[a-z]+$/,st=/^[A-Z]+$/,mt=/^[0-9]+$/;function ve(t){return!!(!t||t.length<8||ot.test(t)||st.test(t)||mt.test(t))}function le(t){return ve(t)?{"password-weak":!0}:null}function ce(t){return t.password===t.password2?null:{"password-mismatch":!0}}function pe(t){return at(t)?null:{pattern:"Not valid email format"}}function dt(t,f){if(t&1&&(a(0,"div",6),o(1),r()),t&2){let e=l();s(),y("",e.msg," ")}}function lt(t,f){if(t&1&&(a(0,"div",7),o(1),r()),t&2){let e=l();s(),y("",e.errMsg," ")}}function ct(t,f){if(t&1){let e=b();a(0,"form",null,0)(2,"div",8)(3,"label",9),o(4,"Password"),r(),a(5,"input",10,1),Z("ngModelChange",function(n){g(e);let d=l(2);return Y(d.password,n)||(d.password=n),v(n)}),r(),a(7,"div",11),o(8," Password must be at least 8 long, containing a digit or symbol or capital letter "),r()(),a(9,"div",8)(10,"label",12),o(11,"Repeat password"),r(),a(12,"input",13,2),Z("ngModelChange",function(n){g(e);let d=l(2);return Y(d.password2,n)||(d.password2=n),v(n)}),r(),a(14,"div",11),o(15," Passwords do not match "),r()(),a(16,"button",14),w("click",function(){g(e);let n=l(2);return v(n.reset())}),o(17,"Reset "),r()()}if(t&2){let e=j(1),i=j(6),n=j(13),d=l(2);s(5),H("ngModel",d.password),s(2),m("hidden",i.pristine||!d.weakPassword()),s(5),H("ngModel",d.password2),s(2),m("hidden",n.pristine||d.matching()),s(2),m("disabled",!e.form.valid||d.passwordProblem())}}function pt(t,f){if(t&1&&(a(0,"div"),h(1,ct,18,5,"form",5),r()),t&2){let e=l();s(),m("ngIf",!e.requested)}}var Ge=(()=>{class t{constructor(e,i){this.userService=e,this.route=i,this.requested=!1}ngOnInit(){this.token=this.route.snapshot.queryParamMap.get("token"),this.token||(this.errMsg="Missing reset token")}reset(){this.token&&this.userService.resetPassword(this.password,this.token).then(e=>{this.msg="You can sign in with new password and login "+e,this.requested=!0}).catch(e=>{this.errMsg=e.message?e.message:e})}weakPassword(){return ve(this.password)}matching(){return this.password===this.password2}passwordProblem(){return!!(this.weakPassword()||!this.matching())}static{this.\u0275fac=function(i){return new(i||t)(c(C),c(ie))}}static{this.\u0275cmp=_({type:t,selectors:[["ng-component"]],standalone:!1,decls:6,vars:3,consts:[["resetForm","ngForm"],["fPassword","ngModel"],["fPassword2","ngModel"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[4,"ngIf"],[1,"alert","alert-success"],[1,"alert","alert-danger"],[1,"form-group"],["for","password"],["type","password","required","","minlength","8","id","password","placeholder","new password","name","fPassword",1,"form-control",3,"ngModelChange","ngModel"],[1,"alert","alert-danger",3,"hidden"],["for","password2"],["type","password","id","password2","required","","placeholder","password","name","fPassword2",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(a(0,"div")(1,"h3"),o(2,"Password reset"),r(),h(3,dt,2,1,"div",3)(4,lt,2,1,"div",4)(5,pt,2,1,"div",5),r()),i&2&&(s(3),m("ngIf",n.msg),s(),m("ngIf",n.errMsg),s(),m("ngIf",n.token))},dependencies:[x,S,R,F,E,I,k,ne,re],encapsulation:2})}}return t})();function ut(t,f){t&1&&(a(0,"div",1),o(1,"Use the activation link that was sent in the email"),r())}var We=(()=>{class t{constructor(e,i,n,d){this.route=e,this.router=i,this.userService=n,this.feedback=d}ngOnInit(){this.token=this.route.snapshot.queryParamMap.get("token"),this.token&&this.userService.activate(this.token).then(e=>{this.feedback.success("Your account has been activated, use: "+e.login+" to sign in"),this.router.navigate(["/login"])}).catch(e=>{this.feedback.error(e),this.router.navigate(["/login"])})}static{this.\u0275fac=function(i){return new(i||t)(c(ie),c(Re),c(C),c(N))}}static{this.\u0275cmp=_({type:t,selectors:[["ng-component"]],standalone:!1,decls:1,vars:1,consts:[["class","alert alert-danger danger",4,"ngIf"],[1,"alert","alert-danger","danger"]],template:function(i,n){i&1&&h(0,ut,2,0,"div",0),i&2&&m("ngIf",!n.token)},dependencies:[x],encapsulation:2})}}return t})();var ft=["recaptcha"];function ht(t,f){if(t&1&&(a(0,"div",5)(1,"h4"),o(2,"Your registration was successful."),r(),o(3," We have sent you the activation link to "),a(4,"strong"),o(5),r(),o(6,", please use that link before logging in "),r()),t&2){let e=l();s(5),be(e.registeredMsg)}}function gt(t,f){t&1&&(a(0,"mat-error"),o(1,"Alphanumerical login, min length 5, only numbers, small letters and ._"),r())}function vt(t,f){t&1&&(a(0,"mat-error"),o(1,"Such login already exists"),r())}function _t(t,f){t&1&&(a(0,"mat-error"),o(1,"Not valid email format"),r())}function wt(t,f){t&1&&(a(0,"mat-error"),o(1,"Address is already being used"),r())}function xt(t,f){t&1&&(a(0,"mat-error"),o(1," Academic email is required for the registration. Contact us if your email is not recognized as academic. "),r())}function Ct(t,f){t&1&&(a(0,"mat-error"),o(1,"Passwords do not match"),r())}function bt(t,f){if(t&1){let e=b();a(0,"div",6)(1,"form",7,0)(3,"div",8)(4,"mat-form-field",9)(5,"mat-label",10),o(6,"Login"),r(),p(7,"input",11),a(8,"mat-hint"),o(9,"Alphanumerical login, min length 5"),r(),h(10,gt,2,0,"mat-error",12)(11,vt,2,0,"mat-error",12),r()(),a(12,"div",8)(13,"mat-form-field",9)(14,"mat-label",13),o(15,"Email"),r(),p(16,"input",14),h(17,_t,2,0,"mat-error",12)(18,wt,2,0,"mat-error",12)(19,xt,2,0,"mat-error",12),r()(),a(20,"div",15)(21,"div",8)(22,"mat-form-field",9)(23,"mat-label",16),o(24,"Password"),r(),p(25,"input",17),a(26,"mat-hint"),o(27,"Password must be at least 8 long, containing a digit or symbol or capital letter"),r(),a(28,"mat-error"),o(29,"Password must be at least 8 long, containing a digit or symbol or capital letter"),r()()(),a(30,"div",8)(31,"mat-form-field",9)(32,"mat-label",18),o(33,"Repeat password"),r(),p(34,"input",19),h(35,Ct,2,0,"mat-error",12),r()()(),a(36,"div",8)(37,"mat-form-field",9)(38,"mat-label",20),o(39,"First Name"),r(),p(40,"input",21),r()(),a(41,"div",8)(42,"mat-form-field",9)(43,"mat-label",22),o(44,"Family Name"),r(),p(45,"input",23),r()(),a(46,"div",8)(47,"mat-form-field",9)(48,"mat-label",24),o(49,"Institution"),r(),p(50,"input",25),r()(),a(51,"div",8)(52,"bd2-recaptcha",26,1),w("captchaExpired",function(){g(e);let n=l();return v(n.captchaExpired())})("captchaResponse",function(n){g(e);let d=l();return v(d.captcha(n))}),r(),a(54,"div",27),o(55," Captcha selection is needed "),r()(),a(56,"div",8)(57,"mat-checkbox",28),o(58," I agree to conditions of "),a(59,"span",29)(60,"a",30),w("click",function(){g(e);let n=l();return v(n.helpDialog.show("service"))}),o(61,"service"),r()(),o(62,"."),p(63,"br"),o(64," I understand that my data will be shared 3 years after their deposition, unless I subscribe to a paid service for a longer embargo period. "),r()(),a(65,"button",31),w("click",function(){g(e);let n=l();return v(n.register())}),o(66," Register "),r()()()}if(t&2){let e=l();s(),m("formGroup",e.userForm),s(9),m("ngIf",e.userNameField.errors&&!e.userNameField.errors["login-taken"]),s(),m("ngIf",e.userNameField.errors&&e.userNameField.errors["login-taken"]),s(6),m("ngIf",e.emailField.errors&&e.emailField.errors.pattern),s(),m("ngIf",e.emailField.errors&&e.emailField.errors["email-taken"]),s(),m("ngIf",e.emailField.errors&&e.emailField.errors["email-nonacademic"]),s(16),m("ngIf",e.passwordsGroup.errors),s(17),m("site_key",e.captchaSiteKey),s(2),m("hidden",!e.missingCaptcha),s(11),m("disabled",e.blocked||e.userForm.invalid)}}var Ke=(()=>{class t{constructor(e,i,n,d){this.userService=e,this.feedback=i,this.fb=n,this.helpDialog=d,this.blocked=!1,this.missingCaptcha=!1,this.captchaSiteKey=se.captchaSiteKey}ngOnInit(){this.userForm=this.fb.group({username:[void 0,{validators:[u.required],asyncValidators:e=>this.availableLogin(e.value),updateOn:"blur"}],email:[void 0,{validators:[u.required,e=>pe(e.value)],asyncValidators:e=>this.suitableEmail(e.value),updateOn:"blur"}],passwords:this.fb.group({password:[void 0,[u.required,e=>le(e.value)]],password2:[void 0,[u.required]]},{validator:e=>ce(e.value)}),firstName:[void 0,[u.required]],lastName:[void 0,[u.required]],institution:[void 0,[u.required]],terms:[void 0,[u.required]]}),this.userNameField=this.userForm.get("username"),this.emailField=this.userForm.get("email"),this.passwordField=this.userForm.get("passwords.password"),this.password2Field=this.userForm.get("passwords.password2"),this.passwordsGroup=this.userForm.get("passwords")}captcha(e){this.gRecaptchaResponse=e,e&&(this.missingCaptcha=!1)}captchaExpired(){this.gRecaptchaResponse=null}availableLogin(e){return!e||e.length<5?X({"too-short":!0}):this.userService.availableLogin(e).pipe(ue(i=>i?null:{"login-taken":"User "+e+" already exists"}),fe(i=>(this.feedback.error(i),X({"cannot-connect":!0}))))}suitableEmail(e){return this.userService.suitableEmail(e).pipe(ue(i=>{if(i.isFree&&i.isAcademic)return null;let n={};return i.isFree||(n["email-taken"]="Email: "+e+" is already being used"),i.isAcademic||(n["email-nonacademic"]="Academic email is required for the registration. Contact us if your email is not recognized as academic."),n}),fe(i=>(this.feedback.error(i),X({"cannot-connect":!0}))))}register(){if(this.userForm.valid){if(!this.gRecaptchaResponse&&!this.emailField.value.endsWith(".cn")&&!this.emailField.value.endsWith(".tw")){this.missingCaptcha=!0;return}let e=this.makeUserData(this.userForm.value);this.triggerRegistration(e)}}makeUserData(e){return{login:e.username,password:e.passwords.password,email:e.email,firstName:e.firstName,lastName:e.lastName,institution:e.institution,terms:e.terms,g_recaptcha_response:this.gRecaptchaResponse}}triggerRegistration(e){this.userService.register(e).then(i=>{this.registered=!0,this.registeredMsg=i.email,this.feedback.success("Registration successful")}).catch(i=>{this.feedback.error(i),this.gRecaptchaResponse=void 0,this.recaptcha&&this.recaptcha.reset()})}static{this.\u0275fac=function(i){return new(i||t)(c(C),c(N),c(z),c(Ae))}}static{this.\u0275cmp=_({type:t,selectors:[["ng-component"]],viewQuery:function(i,n){if(i&1&&V(ft,5),i&2){let d;T(d=A())&&(n.recaptcha=d.first)}},standalone:!1,decls:7,vars:2,consts:[["registrationForm",""],["recaptcha",""],["appearance","outlined",1,"mb-2"],["class","alert alert-success",4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"alert","alert-success"],[1,"mb-4"],[3,"formGroup"],[1,"form-group"],[1,"w-100"],["for","username"],["matInput","","formControlName","username","id","username","minlength","5","pattern","[0-9a-z._]+","placeholder","choose login","required","","type","text",1,""],[4,"ngIf"],["for","email"],["matInput","","formControlName","email","id","email","placeholder","your email","required","","type","text",1,""],["formGroupName","passwords"],["for","password"],["matInput","","formControlName","password","id","password","minlength","8","placeholder","password","required","","type","password",1,""],["for","password2"],["matInput","","formControlName","password2","id","password2","minlength","8","placeholder","password","required","","type","password",1,""],["for","firstName"],["matInput","","formControlName","firstName","id","firstName","minlength","2","placeholder","e.g. Charles","required","","type","text",1,""],["for","lastName"],["matInput","","formControlName","lastName","id","lastName","minlength","2","placeholder","e.g. Darwin","required","","type","text",1,""],["for","institution"],["matInput","","formControlName","institution","id","institution","minlength","3","placeholder","e.g. University of Edinburgh","required","","type","text",1,""],[3,"captchaExpired","captchaResponse","site_key"],[1,"alert","alert-danger",3,"hidden"],["formControlName","terms","id","terms","required","","type","checkbox"],[2,"font-weight","bold","text-decoration","underline"],["role","button",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(a(0,"mat-card",2)(1,"mat-card-title")(2,"h2"),o(3,"User registration"),r()(),a(4,"mat-card-content"),h(5,ht,7,1,"div",3)(6,bt,67,10,"div",4),r()()),i&2&&(s(5),m("ngIf",n.registered),s(),m("ngIf",!n.registered))},dependencies:[x,S,R,F,E,I,k,Ee,D,L,ae,me,Q,K,B,W,U,oe,G,O,Ve],encapsulation:2})}}return t})();function yt(t,f){t&1&&(a(0,"div",21),o(1,"Account has been updated"),r())}function Rt(t,f){if(t&1){let e=b();a(0,"mat-card",2)(1,"mat-card-title")(2,"h2"),o(3),r()(),a(4,"mat-card-content"),h(5,yt,2,0,"div",3),a(6,"form",4,0)(8,"div",5)(9,"mat-form-field",6)(10,"mat-label",7),o(11,"Login"),r(),p(12,"input",8),r()(),a(13,"div",5)(14,"a",9),o(15,"Change password"),r()(),a(16,"div",5)(17,"mat-form-field",6)(18,"mat-label",10),o(19,"Email"),r(),p(20,"input",11),a(21,"mat-error"),o(22,"Not valid email format"),r()()(),a(23,"div",5)(24,"mat-form-field",6)(25,"mat-label",12),o(26,"First Name"),r(),p(27,"input",13),r()(),a(28,"div",5)(29,"mat-form-field",6)(30,"mat-label",14),o(31,"Family Name"),r(),p(32,"input",15),r()(),a(33,"div",5)(34,"mat-form-field",6)(35,"mat-label",16),o(36,"Institution"),r(),p(37,"input",17),r()(),a(38,"div",5)(39,"mat-form-field",6)(40,"mat-label",18),o(41,"Current password"),r(),p(42,"input",19),r()(),a(43,"button",20),w("click",function(){g(e);let n=l();return v(n.save())}),o(44," Update "),r()()()()}if(t&2){let e=l();s(3),y("Edit user: ",e.user.name,""),s(2),m("ngIf",e.updated),s(),m("formGroup",e.userForm),s(37),m("disabled",e.userForm.invalid)}}var He=(()=>{class t{constructor(e,i,n){this.userService=e,this.feedback=i,this.fb=n,this.updated=!1}ngOnInit(){this.user=this.userService.currentUser,this.userForm=this.fb.group({username:[{value:this.user.login,disabled:!0},[u.required],[]],email:[this.user.email,[u.required,e=>pe(e.value)],[]],firstName:[this.user.firstName,[u.required]],lastName:[this.user.lastName,[u.required]],institution:[this.user.institution,[u.required]],currentPassword:[void 0,[u.required]]}),this.userNameField=this.userForm.get("username"),this.emailField=this.userForm.get("email"),this.currentPasswordField=this.userForm.get("currentPassword")}save(){if(!this.userForm.valid)return;let e=this.userForm.value,i={login:this.user.login,currentPassword:e.currentPassword,email:e.email,firstName:e.firstName,lastName:e.lastName,institution:e.institution};this.updated=!1,this.userService.update(i).subscribe(n=>{this.user=n,this.currentPasswordField.reset(),this.feedback.success("User: "+n.login+" has been updated"),this.updated=!0,ee(5e3).subscribe(()=>this.updated=!1)},n=>{this.feedback.error(n),this.currentPasswordField.reset()})}static{this.\u0275fac=function(i){return new(i||t)(c(C),c(N),c(z))}}static{this.\u0275cmp=_({type:t,selectors:[["ng-component"]],standalone:!1,decls:1,vars:1,consts:[["registrationForm",""],["appearance","outlined","class","mb-2",4,"ngIf"],["appearance","outlined",1,"mb-2"],["class","alert alert-success",4,"ngIf"],[3,"formGroup"],[1,"form-group"],[1,"w-100"],["for","username"],["matInput","","formControlName","username","id","username","required","","type","text",1,""],["routerLink","/account/password"],["for","email"],["matInput","","formControlName","email","id","email","placeholder","your email","required","","type","text",1,""],["for","firstName"],["matInput","","formControlName","firstName","id","firstName","minlength","2","placeholder","e.g. Charles","required","","type","text",1,""],["for","lastName"],["matInput","","formControlName","lastName","id","lastName","minlength","2","placeholder","e.g. Darwin","required","","type","text",1,""],["for","institution"],["matInput","","formControlName","institution","id","institution","placeholder","e.g. University of Edinburgh","required","","type","text",1,""],["for","cPassword"],["matInput","","formControlName","currentPassword","id","cPassword","placeholder","current password","required","","type","password",1,""],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"alert","alert-success"]],template:function(i,n){i&1&&h(0,Rt,45,4,"mat-card",1),i&2&&m("ngIf",n.user&&!n.user.anonymous)},dependencies:[x,S,R,F,E,I,k,D,L,Fe,Q,K,B,W,U,G,O],encapsulation:2})}}return t})();function Ft(t,f){t&1&&(a(0,"div",18),o(1,"Password has been updated"),r())}function Et(t,f){t&1&&(a(0,"mat-error"),o(1,"Passwords do not match"),r())}function St(t,f){if(t&1){let e=b();a(0,"mat-card",2)(1,"mat-card-title")(2,"h2"),o(3),r()(),a(4,"mat-card-content"),h(5,Ft,2,0,"div",3),a(6,"form",4,0)(8,"div",5)(9,"mat-form-field",6)(10,"mat-label",7),o(11,"Login"),r(),p(12,"input",8),r()(),a(13,"div",9)(14,"div",5)(15,"mat-form-field",6)(16,"mat-label",10),o(17,"Password"),r(),p(18,"input",11),a(19,"mat-hint"),o(20,"Password must be at least 8 long, containing a digit or symbol or capital letter"),r(),a(21,"mat-error"),o(22,"Password must be at least 8 long, containing a digit or symbol or capital letter"),r()()(),a(23,"div",5)(24,"mat-form-field",6)(25,"mat-label",12),o(26,"Repeat password"),r(),p(27,"input",13),h(28,Et,2,0,"mat-error",14),r()()(),a(29,"div",5)(30,"mat-form-field",6)(31,"mat-label",15),o(32,"Current password"),r(),p(33,"input",16),r()(),a(34,"button",17),w("click",function(){g(e);let n=l();return v(n.save())}),o(35," Update "),r()()()()}if(t&2){let e=l();s(3),y("Change password for ",e.user.name,""),s(2),m("ngIf",e.updated),s(),m("formGroup",e.userForm),s(22),m("ngIf",e.passwordsGroup.errors),s(6),m("disabled",e.userForm.invalid)}}var Ye=(()=>{class t{constructor(e,i,n){this.userService=e,this.feedback=i,this.fb=n,this.updated=!1}ngOnInit(){this.user=this.userService.currentUser,this.userForm=this.fb.group({username:[{value:this.user.login,disabled:!0},[u.required],[]],passwords:this.fb.group({password:[void 0,[u.required,e=>le(e.value)]],password2:[void 0,[u.required]]},{validator:e=>ce(e.value)}),currentPassword:[void 0,[u.required]]}),this.passwordsGroup=this.userForm.get("passwords")}save(){if(!this.userForm.valid)return;let e=this.userForm.value,i={login:this.user.login,currentPassword:e.currentPassword,password:e.passwords.password};this.updated=!1,this.userService.passwordUpdate(i).subscribe(n=>{this.user=n,this.userForm.reset(),this.feedback.success("User: "+n.login+" password has been updated"),this.updated=!0,ee(5e3).subscribe(()=>this.updated=!1)},n=>{this.userForm.reset(),this.feedback.error(n)})}static{this.\u0275fac=function(i){return new(i||t)(c(C),c(N),c(z))}}static{this.\u0275cmp=_({type:t,selectors:[["ng-component"]],standalone:!1,decls:1,vars:1,consts:[["registrationForm",""],["appearance","outlined","class","mb-2",4,"ngIf"],["appearance","outlined",1,"mb-2"],["class","alert alert-success",4,"ngIf"],[3,"formGroup"],[1,"form-group"],[1,"w-100"],["for","username"],["matInput","","formControlName","username","id","username","required","","type","text",1,""],["formGroupName","passwords"],["for","password"],["matInput","","formControlName","password","id","password","minlength","8","placeholder","password","required","","type","password",1,""],["for","password2"],["matInput","","formControlName","password2","id","password2","minlength","8","placeholder","password","required","","type","password",1,""],[4,"ngIf"],["for","cPassword"],["matInput","","formControlName","currentPassword","id","cPassword","placeholder","current password","required","","type","password",1,""],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"alert","alert-success"]],template:function(i,n){i&1&&h(0,St,36,5,"mat-card",1),i&2&&m("ngIf",n.user&&!n.user.anonymous)},dependencies:[x,S,R,F,E,I,k,D,L,ae,Q,K,B,W,U,oe,G,O],encapsulation:2})}}return t})();var It=[{path:"",children:[{path:"edit",component:He},{path:"password",component:Ye},{path:"register",component:Ke},{path:"activate",component:We},{path:"remind",component:ze},{path:"reset",component:Ge}]}],Ze=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=q({type:t})}static{this.\u0275inj=P({imports:[ge.forChild(It),ge]})}}return t})();var $e=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=q({type:t})}static{this.\u0275inj=P({})}}return t})();var ji=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=q({type:t})}static{this.\u0275inj=P({imports:[ye,Se,Ie,$e,je,Ze,qe,Pe,Me,Ne,ke,Te]})}}return t})();export{ji as AccountModule};
