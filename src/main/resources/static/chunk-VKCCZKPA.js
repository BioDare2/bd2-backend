import{d as m,i as f}from"./chunk-5ZUTOKKG.js";import{g as d,i as b}from"./chunk-YOGZUNLM.js";import{X as c,_ as p,j as u,k as a}from"./chunk-6AXKXNFK.js";var n=class{constructor(i){this.rows=new Map,this.nextColumn=0,this.sorted=!0,i!=null&&(this.sorted=i)}get width(){return this.nextColumn}get size(){return this.rows.size}append(i,t){this.put(i,t,this.nextColumn)}put(i,t,e){this._put(i,t,e),this.nextColumn=Math.max(this.nextColumn,e+1)}putColumn(i,t,e){i.forEach((r,s)=>{this._put(r,t[s],e)}),this.nextColumn=Math.max(this.nextColumn,e+1)}appendColumn(i,t){this.putColumn(i,t,this.nextColumn)}getValue(i,t){let e=this.rows.get(i);if(e)return e[t]}getRow(i){return this.rows.get(i)}forEach(i){this.keys().forEach((t,e)=>{let r={key:t,columns:this.rows.get(t)};i(r,e,this)})}forEachFlat(i){this.keys().forEach((t,e)=>{let r=[t].concat(this.rows.get(t));i(r,e,this)})}keys(){return this.sorted?Array.from(this.rows.keys()).sort((i,t)=>i==t?0:i<t?-1:1):Array.from(this.rows.keys())}_put(i,t,e){let r=this.rows.get(i);r||(r=[],this.rows.set(i,r)),r[e]=t}};var y=class{constructor(){this.SEP=","}renderCSVTable(i,t,e,r,s){let o=this.prepareHeaders(s,t,e,r,i.length);this.appendDataLabels(o,i);let g=this.prepareDataTable(i),l=this.mapToString(o,this.SEP);return l+=this.mapToString(g,this.SEP),l}prepareHeaders(i,t,e,r,s){let o=this.prepareExpHeaders(i);return this.appendDisplayProperties(o,t),this.appendSortingProperties(o,r),this.appendDataProperties(o,s,e),o}prepareExpHeaders(i){let t=new n(!1);return t.put("Exp Id:",""+i.id,0),t.put("Exp URL:","https://biodare2.ed.ac.uk/experiment/"+i.id,0),t.put("Exp Name:",i.name,0),i.contributionDesc.authors.forEach((e,r)=>{t.put("Authors:",e.name,r)}),t}appendDisplayProperties(i,t){i.put("Time range:",t.timeScaleLabel,0),i.put("Detrending:",t.detrending.label,0),t.hourly&&i.put("Hourly binned:","true",0),t.log2&&i.put("Log2 transform:",""+t.log2,0),i.put("Normalization:",t.normalisation,0),i.put("Normalization:",t.trimFirst?"within range":"whole serie",1),i.put("Align:",t.align,0)}appendSortingProperties(i,t){i.put("Sorting:",`${t.active} ${t.direction}`,0),i.put("Sorting jobs:",`${t.ppaJobId} ${t.rhythmJobId}`,0)}appendDataProperties(i,t,e){i.put("Traces",t+" of "+e.length,0);let r=Math.floor(e.length/e.pageSize)+(e.length%e.pageSize===0?0:1);i.put("Data Page",e.pageIndex+1+" of "+r,0)}appendDataLabels(i,t){t.forEach((e,r)=>{i.put("Label:",e.label,r)})}prepareDataTable(i){let t=new n;return i.forEach(e=>{let r=e.data.map(o=>o.x),s=e.data.map(o=>o.y);t.appendColumn(r,s)}),t}mapToString(i,t){let e="";return i.forEachFlat(r=>{for(let s=0;s<r.length;s++)r[s]!==void 0&&(e+=r[s]),e+=t;e+=`
`}),e}};var M=(()=>{class h{constructor(t,e){this.ppa=t,this.rhythmicity=e,this.error$=new u,this.allowedPPAMethods=void 0,this.allowedRhythmMethods=void 0,this.ppaJobs=new a([]),this.rhythmJobs=new a([]),this.ppaJobs$=this.ppaJobs.asObservable(),this.rhythmJobs$=this.rhythmJobs.asObservable()}ngOnDestroy(){this.ppaJobs.complete(),this.rhythmJobs.complete()}experiment(t){this.fetchPPA(t),this.fetchRhythm(t)}fetchPPA(t){this.ppa.getPPAJobs(t).subscribe(e=>{e=e.filter(r=>m.isFinished(r)),this.allowedPPAMethods&&(e=e.filter(r=>this.allowedPPAMethods.includes(r.method))),this.ppaJobs.next(e)},e=>{this.error$.next(e),this.ppaJobs.next([])})}fetchRhythm(t){this.rhythmicity.getJobs(t).subscribe(e=>{e=e.filter(r=>d.isFinished(r)),this.allowedRhythmMethods&&(e=e.filter(r=>this.allowedRhythmMethods.includes(r.parameters.METHOD))),this.rhythmJobs.next(e)},e=>{this.error$.next(e),this.rhythmJobs.next([])})}static{this.\u0275fac=function(e){return new(e||h)(p(f),p(b))}}static{this.\u0275prov=c({token:h,factory:h.\u0275fac})}}return h})();export{y as a,M as b};
