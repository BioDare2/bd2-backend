import{a as Qt,b as Yt}from"./chunk-5OD23FD3.js";import{a as Ht}from"./chunk-2U64YJXG.js";import{a as Wt,b as Xt,o as te}from"./chunk-YYE5ZGGO.js";import{c as Vt,d as Ut,e as Gt,l as rt}from"./chunk-KIR6VN4B.js";import{d as Kt}from"./chunk-7IZ7EKZI.js";import{i as Zt}from"./chunk-AQTLREFF.js";import{E as z,F as jt,G as qt,d as kt,f as R,i as Z,j as Q,n as Y,o as $t,r as W,s as Bt,t as X,u as tt,v as et,w as it,y as zt,z as Jt}from"./chunk-57LGIX4T.js";import{Ab as K,B as A,Bc as Lt,C as ft,Ca as u,Cb as Ot,Da as C,Db as mt,E as gt,F as yt,Ib as Nt,J as M,Lb as ct,Ma as _,Mb as pt,Na as wt,Oa as xt,Pa as Et,Q as St,R as bt,Sa as P,U as $,Wa as d,X as G,Y as vt,_ as j,ac as B,bc as It,db as m,e as S,ea as Pt,eb as c,ec as At,fa as Tt,fb as x,gc as Ct,j as lt,jb as Dt,k as I,la as H,mb as Ft,ob as q,p as ht,t as F,tb as Rt,u as J,ub as Mt,vb as _t,zb as p}from"./chunk-6AXKXNFK.js";function pe(i,a){if(i&1&&(m(0,"div",1),x(1,"canvas",2),c()),i&2){let t=q();u(),d("type","line")("datasets",t.dataset.traces)("options",t.scatterOptions)}}var ee=(()=>{class i{constructor(){this.scatterOptions={scales:{xAxes:{type:"linear",position:"bottom"}},legend:{display:!0,position:"bottom"}}}set data(t){this.dataset=t}ngOnInit(){}chartClicked(t){}chartHovered(t){}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=_({type:i,selectors:[["bd2-ts-plot"]],inputs:{data:"data"},standalone:!1,decls:1,vars:1,consts:[["style","display: block;",4,"ngIf"],[2,"display","block"],["baseChart","","width","auto","height","200",3,"type","datasets","options"]],template:function(e,r){e&1&&P(0,pe,2,3,"div",0),e&2&&d("ngIf",r.dataset)},dependencies:[It,Qt],encapsulation:2})}}return i})();var O=class{constructor(a,t){this.x=a,this.y=t}},at=class{constructor(){this.fill=!1,this.data=[]}},nt=class{constructor(){this.traces=[],this.totalTraces=0}};function ue(i,a){if(i&1&&(m(0,"div")(1,"h4"),p(2),c(),x(3,"bd2-ts-plot",1),c()),i&2){let t=a.$implicit,e=a.index;u(2),Ot("",e+1,". ",t.title,""),u(),d("data",t)}}var qe=(()=>{class i{constructor(){this.tracesPerPlot=7,this.datasets=[]}set data(t){if(!t)return;let e=this.split(t,this.tracesPerPlot).map(r=>{let n=new nt;return n.traces=r,n});this.datasets=e}ngOnInit(){}trackByIx(t,e){return t}split(t,e){let r=[],n=0;for(;n+e<t.length;n+=e){let s=t.slice(n,n+e);r.push(s)}return n<t.length&&r.push(t.slice(n,t.length)),r}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=_({type:i,selectors:[["bd2-ts-plots"]],inputs:{tracesPerPlot:"tracesPerPlot",data:"data"},standalone:!1,decls:1,vars:2,consts:[[4,"ngFor","ngForOf","ngForTrackBy"],[3,"data"]],template:function(e,r){e&1&&P(0,ue,4,3,"div",0),e&2&&d("ngForOf",r.datasets)("ngForTrackBy",r.trackByIx)},dependencies:[B,ee],encapsulation:2})}}return i})();function ie(i){let a=i.timeStart,t=i.timeEnd;return a<0?{validTimeScale:"Start time must >= 0"}:t<0?{validTimeScale:"End time must >= 0"}:t>0&&a>=t?{validTimeScale:"Start time must be < end time"}:null}var b=class i{constructor(a,t,e,r,n,s,o=!1,l=!1,h=!1){this.detrending=e,this.normalisation=r,this.align=n,this.page=s,this.log2=o,this.trimFirst=l,this.hourly=h,this.timeScale={timeStart:a,timeEnd:t},this.page=s||i.firstPage()}get timeStart(){return this.timeScale.timeStart}get timeEnd(){return this.timeScale.timeEnd}get timeScaleLabel(){let a=""+this.timeStart;a==="0"&&(a="min");let t=""+this.timeEnd;return t==="0"&&(t="max"),`${a} to ${t}`}static firstPage(){let a=new Ut;return a.pageIndex=0,a.pageSize=50,a}static equalsPages(a,t){return a?t?a.pageIndex===t.pageIndex&&a.pageSize===t.pageSize:!1:!t}isValid(){return!(this.timeScale.timeStart<0||this.timeScale.timeEnd<0||this.timeScale.timeEnd>0&&this.timeScale.timeStart>=this.timeScale.timeEnd)}equals(a){return!(!a||!this.equalsView(a)||this.detrending!==a.detrending||!this.equalsPage(a.page))}equalsView(a){return!(!a||this.timeScale.timeStart!==a.timeScale.timeStart||this.timeScale.timeEnd!==a.timeScale.timeEnd||this.normalisation!==a.normalisation||this.align!==a.align||this.log2!==a.log2||this.trimFirst!==a.trimFirst||this.hourly!==a.hourly)}equalsPage(a){return i.equalsPages(this.page,a)}clone(){return new i(this.timeStart,this.timeEnd,this.detrending,this.normalisation,this.align,this.page,this.log2,this.trimFirst,this.hourly)}setAll(a){Object.assign(this,a),this.timeScale.timeStart=a.timeScale?a.timeScale.timeStart:a.timeStart,this.timeScale.timeEnd=a.timeScale?a.timeScale.timeEnd:a.timeEnd}};var v=class i{static{this.NO_DTR=new i("NO_DTR","no dtr")}static{this.LIN_DTR=new i("LIN_DTR","linear dtr")}static{this.POLY_DTR=new i("POLY_DTR","cubic dtr")}static{this.BASE_DTR=new i("BASE_DTR","baseline dtr")}static{this.BAMP_DTR=new i("BAMP_DTR","amp&baseline dtr")}static{this.values=[i.NO_DTR,i.LIN_DTR,i.POLY_DTR,i.BASE_DTR,i.BAMP_DTR]}constructor(a,t){this._name=a,this._label=t}get name(){return this._name}get label(){return this._label}static get(a){return i.getValuesMap().get(a)}static getValuesMap(){if(!i.valuesMap){let a=new Map;i.values.forEach(t=>a.set(t.name,t)),i.valuesMap=a}return i.valuesMap}toJSON(){return this.name}equals(a){return a?this===a||this===i.get(a.name?a.name:a):!1}},re=[v.NO_DTR,v.LIN_DTR,v.POLY_DTR,v.BASE_DTR,v.BAMP_DTR],E=class{constructor(a,t){this.name=a,this.label=t}},V=[new E("NO_NORM","none"),new E("RANGE","to [-1,1]"),new E("FOLD","fold change"),new E("Z_SCORE","Z-Score"),new E("MAX_NORM","to extreme")],U=[new E("NONE","none"),new E("MEAN","mean"),new E("SPREAD","spread")];var he=["PERIOD","PHASE","AMP","ERR"],fe=["R_TAU","R_PVALUE","R_PEAK","R_PERIOD"];function ae(i,a){return!(!i||!a||i.active!==a.active||i.direction!==a.direction||he.includes(i.active)&&i.ppaJobId!==a.ppaJobId||fe.includes(i.active)&&i.rhythmJobId!==a.rhythmJobId)}var ge=["dataPaginator"],oe=(()=>{class i{set disabled(t){t?this.mainForm.disable():this.mainForm.enable(),this._disabled=t}get disabled(){return this._disabled}constructor(t){this.fb=t,this.totalTraces=0,this.currentPage=b.firstPage(),this.displayParams=new H,this._disabled=!1,this.disabledPagination=!1,this.page$=new I(b.firstPage()),this.displayParamsForm=this.buildDisplayParamsForm(),this.mainForm=this.buildMainForm(),this.detrendingOptions=re,this.normalisationOptions=V,this.alignOptions=U}ngOnInit(){this.initDisplayParamsStream()}ngOnDestroy(){this.displayParamsSubscription&&this.displayParamsSubscription.unsubscribe(),this.displayParams&&this.displayParams.complete()}initDisplayParamsStream(){let t=ft(this.displayParamsForm.valueChanges,this.displayParamsForm.statusChanges).pipe(St([this.displayParamsForm.value,this.displayParamsForm.status]),A(([r,n])=>n==="VALID"&&r),F(([r,n])=>r)),e=J([t,this.page$]).pipe(F(([r,n])=>new b(r.timeScale.timeStart,r.timeScale.timeEnd,v.get(r.detrending),r.normalisation,r.align,n,r.log2,r.trimFirst,r.hourly)),A(r=>r.isValid()),M((r,n)=>n.equals(r)));this.displayParamsSubscription=e.subscribe(r=>this.displayParams.next(r))}buildDisplayParamsForm(){return this.fb.group({timeScale:this.fb.group({timeStart:[0,[R.required]],timeEnd:[0,[R.required]]},{validator:t=>ie(t.value)}),detrending:[this.defaultDetrending(),[R.required]],normalisation:[V[0].name,[R.required]],align:[U[0].name,[R.required]],log2:[!1],trimFirst:[!0],hourly:[!1]})}defaultDetrending(){return v.LIN_DTR.name}buildMainForm(){return this.displayParamsForm}loadDataPage(t){this.page$.next(t)}ngAfterViewInit(){this.dataPaginator&&(this.dataPaginator._intl=new Vt,this.dataPaginator._intl.itemsPerPageLabel="Series per page")}static{this.\u0275fac=function(e){return new(e||i)(C(z))}}static{this.\u0275dir=xt({type:i,viewQuery:function(e,r){if(e&1&&Rt(ge,7),e&2){let n;Mt(n=_t())&&(r.dataPaginator=n.first)}}})}}return i})();var Se=()=>[10,25,50,100,200];function be(i,a){if(i&1&&(m(0,"option",28),p(1),c()),i&2){let t=a.$implicit;d("value",t.name),u(),K(t.label)}}function ve(i,a){if(i&1&&(m(0,"option",28),p(1),c()),i&2){let t=a.$implicit;d("value",t.name),u(),K(t.label)}}function Pe(i,a){if(i&1&&(m(0,"option",28),p(1),c()),i&2){let t=a.$implicit;d("value",t.name),u(),K(t.label)}}var oi=(()=>{class i extends oe{constructor(t){super(t)}static{this.\u0275fac=function(e){return new(e||i)(C(z))}}static{this.\u0275cmp=_({type:i,selectors:[["bd2-tsdisplay-params-rform"]],inputs:{disabled:"disabled",totalTraces:"totalTraces",currentPage:"currentPage"},outputs:{displayParams:"displayParams"},standalone:!1,features:[Et],decls:47,vars:10,consts:[["dataPaginator",""],["role","form",1,"form-horizontal","container",3,"formGroup"],[1,"row"],[1,"col-md-8","col-sm-10"],["formGroupName","timeScale",1,"form-group","row"],[1,"col-md-3","col-sm-3"],["for","timeStart",1,"col-md-1","col-sm-2"],["type","number","step","any","min","0","size","5","id","timeStart","required","","formControlName","timeStart",1,"form-control"],["for","timeEnd",1,"col-md-1","col-sm-1"],["type","number","step","any","min","0","size","5","required","","id","timeEnd","formControlName","timeEnd",1,"form-control"],[1,"col-md-2","col-sm-4"],["formControlName","hourly",1,"mr-3"],[1,"form-group","row"],["for","detrending",1,"col-sm-2"],[1,"col-sm-3"],["required","","id","detrending","formControlName","detrending",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-1"],["for","align",1,"col-sm-1"],["required","","id","align","formControlName","align",1,"form-control"],[1,"col-sm-2"],["for","normalisation"],["required","","id","normalisation","formControlName","normalisation",1,"form-control"],[1,"col-sm"],["formControlName","trimFirst",1,"mr-3"],["formControlName","log2"],[1,"col-sm-8"],[3,"page","length","disabled","pageSize","pageIndex","pageSizeOptions"],[3,"value"]],template:function(e,r){if(e&1){let n=Dt();m(0,"form",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"label",5),p(5,"Time range"),c(),m(6,"label",6),p(7,"from:"),c(),m(8,"div",5),x(9,"input",7),c(),m(10,"label",8),p(11,"to:"),c(),m(12,"div",5),x(13,"input",9),c()()(),m(14,"div",10)(15,"mat-slide-toggle",11),p(16,"hourly"),c()()(),m(17,"div",12)(18,"label",13),p(19,"Detrending"),c(),m(20,"div",14)(21,"select",15),P(22,be,2,2,"option",16),c()(),x(23,"div",17),m(24,"label",18),p(25,"Align"),c(),m(26,"div",14)(27,"select",19),P(28,ve,2,2,"option",16),c()()(),m(29,"div",12)(30,"div",20)(31,"label",21),p(32,"Normalize"),c()(),m(33,"div",14)(34,"select",22),P(35,Pe,2,2,"option",16),c()(),m(36,"div",23)(37,"mat-slide-toggle",24),p(38,"within range"),c(),m(39,"mat-slide-toggle",25),p(40,"log2 transf."),c()()(),x(41,"div",12),m(42,"div",12),x(43,"label",20),m(44,"div",26)(45,"mat-paginator",27,0),Ft("page",function(o){return Pt(n),Tt(r.loadDataPage(o))}),c()()()()}e&2&&(d("formGroup",r.mainForm),u(22),d("ngForOf",r.detrendingOptions),u(6),d("ngForOf",r.alignOptions),u(7),d("ngForOf",r.normalisationOptions),u(10),d("length",r.totalTraces)("disabled",r.disabledPagination)("pageSize",r.currentPage.pageSize)("pageIndex",r.currentPage.pageIndex)("pageSizeOptions",Nt(9,Se)))},dependencies:[B,Y,et,it,kt,$t,tt,Z,Q,Jt,zt,W,X,Bt,Gt,rt],encapsulation:2})}}return i})();var se=(()=>{class i{constructor(t){this.BD2REST=t}loadDataSet(t,e,r,n){return this.BD2REST.tsdata(t.id,e,r,n)}loadHourlyDataSet(t,e,r,n){return this.BD2REST.tsHourlyData(t.id,e,r,n)}exportURL(t,e){return this.BD2REST.tsdataExportURL(t.id,e.detrending)}dataMetrics(t){return this.BD2REST.tsdataMetrics(t.id)}static{this.\u0275fac=function(e){return new(e||i)(j(Lt))}}static{this.\u0275prov=G({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var ot=class{constructor(a,t,e=0,r=b.firstPage(),n){this.params=a,this.data=t,this.totalTraces=e,this.currentPage=r,this.sorting=n}},le=(()=>{class i{constructor(t,e=!1){this.tsDataService=t,this.error$=new lt,this.loading$=new lt,this.addTraceNr=!0,this.addTraceRef=!0,this.dataSetsStream=new I(void 0),this.sortStream=new I({}),this.experiment$=new I(void 0);let r=new b(0,0,v.LIN_DTR,V[0].name,U[0].name,b.firstPage());this.displayParamsStream=new I(r),e?this.slowParameters$=this.displayParamsStream.pipe(A(n=>!!n)):this.slowParameters$=this.displayParamsStream.pipe(yt(400),A(n=>!!n)),this.initObservables()}changeDisplayParams(t){this.displayParamsStream.next(t)}experiment(t){this.experiment$.next(t)}sort(t){t&&this.sortStream.next(t)}ngOnDestroy(){this.displayParamsStream.complete(),this.sortStream.complete(),this.dataSetsStream.complete(),this.error$.complete(),this.experiment$.complete(),this.loading$.complete()}initObservables(){this.initDataSetsStream(),this.seriesPackStream=this.initSeriesPackStream(this.dataSetsStream)}initDataSetsStream(){let t=this.slowParameters$.pipe(F(o=>o.page),M((o,l)=>b.equalsPages(o,l))),e=this.experiment$.pipe(A(o=>!!o)),r=this.slowParameters$.pipe(F(o=>o.detrending),M((o,l)=>l.equals(o))),n=this.slowParameters$.pipe(F(o=>o.hourly),M()),s=this.sortStream.pipe(M(ae));J([e,r,n,t,s]).pipe($(o=>this.loading$.next(!0)),bt(([o,l,h,y,f])=>this.loadDataSet(o,l,h,y,f)),$(o=>this.loading$.next(!1))).subscribe(o=>this.dataSetsStream.next(o),o=>console.log("Error should not propagate here",o))}initSeriesPackStream(t){let e=this.slowParameters$.pipe(M((r,n)=>n.equalsView(r)));return J([t,e]).pipe(F(([r,n])=>this.processDataSet(r,n)),$(r=>this.current=r))}loadDataSet(t,e,r,n,s){let o;return r?o=this.tsDataService.loadHourlyDataSet(t,e,n,s):o=this.tsDataService.loadDataSet(t,e,n,s),o.pipe($(l=>{l.detrending=l.detrending||e,l.sort=s}),$(l=>l.traces.forEach(h=>this.enrichLabel(h,this.addTraceNr,this.addTraceRef))),gt(l=>(console.log("Caught error",l),this.error$.next(l),ht(void 0))))}enrichLabel(t,e,r){e&&r?t.label=`${t.traceNr}.${t.traceRef} ${t.label}`:e&&(t.label=`${t.traceNr}. ${t.label}`)}getFullDataSet(t,e,r){let n={pageIndex:0,pageSize:5e4};return e=e.clone(),e.timeScale.timeStart=0,e.timeScale.timeEnd=0,this.loadDataSet(t,e.detrending,e.hourly,n,r).pipe(F(s=>this.processDataSet(s,e)))}processDataSet(t,e){if(t){let r=this.processDataTraces(t.traces,e);return e=e.clone(),e.detrending=t.detrending,new ot(e,r,t.totalTraces,t.currentPage,t.sort)}else return new ot(e,[],0,b.firstPage(),{})}processDataTraces(t,e){return e.trimFirst&&(t=this.trimData(t,e)),t=this.logData(t,e),t=this.normalizeData(t,e),e.trimFirst||(t=this.trimData(t,e)),t=this.alignData(t,e),t}normalizeData(t,e){return t.map(r=>this.normalizeTrace(r,e))}normalizeTrace(t,e){switch(e.normalisation){case"MEAN_NORM":return this.normalizeTraceToMean(t);case"MAX_NORM":return this.normalizeTraceToMax(t);case"RANGE":return this.normalizeTraceToRange(t);case"FOLD":return this.normalizeTraceToFoldChange(t);case"Z_SCORE":return this.normalizeTraceToZScore(t);default:return t}}normalizeTraceToMean(t){return this.normalizeTraceToFactor(t,t.mean)}normalizeTraceToMax(t){return this.normalizeTraceToFactor(t,Math.max(t.max,-t.min))}normalizeTraceToFactor(t,e){if(e===0)return t;let r=this.copyTrace(t);return r.data=t.data.map(n=>new O(n.x,n.y/e)),r.min=t.min/e,r.max=t.max/e,r.mean=t.mean/e,r}normalizeTraceToRange(t){let e=this.copyTrace(t),r=t.mean,n=Math.max(t.max-t.mean,Math.abs(t.min-t.mean));return e.data=t.data.map(s=>new O(s.x,(s.y-r)/n)),e.min=(t.min-r)/n,e.max=(t.max-r)/n,e.mean=0,e}normalizeTraceToFoldChange(t){return t.min>0?this.normalizeTraceToFactor(t,t.min):this.emptyTrace(t)}normalizeTraceToZScore(t){if(t.data.length<2)return t;let e=t.data.reduce((o,l)=>o+l.y,0)/t.data.length,r=t.data.reduce((o,l)=>o+Math.pow(l.y-e,2),0),n=Math.sqrt(r/(t.data.length-1)),s=this.copyTrace(t);return s.data=t.data.map(o=>new O(o.x,(o.y-e)/n)),this.updateMinMax(s),s}emptyTrace(t){let e=this.copyTrace(t);return e.data=[],e.min=NaN,e.max=NaN,e.mean=NaN,e}copyTrace(t){return Object.assign(new at,t)}logData(t,e){return e.log2?t.map(r=>this.logTrace(r)):t}logTrace(t){let r=this.copyTrace(t);return r.data=t.data.filter(n=>n.y>=0).map(n=>new O(n.x,Math.log2(n.y+.015625))),this.updateMinMax(r),r}alignData(t,e){return e.align==="MEAN"?t.map(r=>this.zeroTrace(r)):e.align==="SPREAD"?this.spreadMeans(t):t}zeroTrace(t){return this.subTrace(t,t.mean)}subTrace(t,e){let r=this.copyTrace(t);return r.data=t.data.map(n=>new O(n.x,n.y-e)),r.min=t.min-e,r.max=t.max-e,r.mean=t.mean-e,r}trimData(t,e){return t.map(r=>this.trimTrace(r,e)).filter(r=>r.data.length>0)}trimTrace(t,e){if(e.timeStart===0&&e.timeEnd===0)return t;let r=this.copyTrace(t),n=0;if(e.timeStart!==0)for(;n<t.data.length&&!(t.data[n].x>=e.timeStart);n++);let s=t.data.length-1;if(e.timeEnd!==0)for(;s>=0&&!(t.data[s].x<=e.timeEnd);s--);return s++,r.data=t.data.slice(n,s),this.updateMinMax(r),r}spreadMeans(t){let e=[],r=0,n=0;return t.forEach(s=>{let o=Math.max(n,s.mean-s.min),l=r+o;n=s.max-s.mean,e.push(this.subTrace(s,s.mean-l)),r=l}),e}updateMinMax(t){let e=this.minMaxMean(t.data);t.min=e.min,t.max=e.max,t.mean=e.mean}minMaxMean(t){let e={min:NaN,max:NaN,mean:NaN};return t.length===0||(e.min=t[0].y,e.max=t[0].y,e.mean=0,t.forEach(r=>{let n=r.y;n<e.min&&(e.min=n),n>e.max&&(e.max=n),e.mean+=n}),e.mean=e.mean/t.length),e}static{this.\u0275fac=function(e){return new(e||i)(j(se),j(Ht,8))}}static{this.\u0275prov=G({token:i,factory:i.\u0275fac})}}return i})();function xe(i,a){if(i&1&&(m(0,"option",20),p(1),ct(2,"date"),c()),i&2){let t=a.$implicit,e=q();d("value",t.jobId),u(),mt(" ",t.method,": ",e.shortUUID(t.jobId)," (",pt(2,4,e.toLocalDateTime(t.submitted)),") ")}}function Ee(i,a){if(i&1&&(m(0,"option",20),p(1),ct(2,"date"),c()),i&2){let t=a.$implicit,e=q();d("value",t.jobId),u(),mt(" ",e.friendlyRhythmMethod(t.parameters.METHOD),": ",e.shortUUID(t.jobId)," (",pt(2,4,e.toLocalDateTime(t.jobStatus.submitted)),") ")}}var xi=(()=>{class i{set rhythmJobs(t){this._rhythmJobs=t,this.noRhythm=!t||t.length<1,this.sortParamsForm.get("rhythmJobId").setValue(this.noRhythm?void 0:t[0].jobId)}get rhythmJobs(){return this._rhythmJobs}set ppaJobs(t){this._ppaJobs=t,this.noPPA=!t||t.length<1,this.sortParamsForm.get("ppaJobId").setValue(this.noPPA?void 0:t[0].jobId)}get ppaJobs(){return this._ppaJobs}constructor(t,e){this.fb=t,this.fetcher=e,this.sorting=new H,this.noPPA=!0,this.noRhythm=!0,this._rhythmJobs=[],this._ppaJobs=[],this.sortParamsForm=this.buildSortParamsForm(t),this.mainForm=this.buildMainForm(this.sortParamsForm,t),this.ppaJobs=[],this.rhythmJobs=[]}ngOnInit(){this.valuesSubscription=this.mainForm.valueChanges.subscribe(t=>{let e=t;e.direction=t.isAscending?"asc":"desc",this.sorting.next(e),this.fetcher&&this.fetcher.sort(e)})}ngOnDestroy(){this.valuesSubscription&&this.valuesSubscription.unsubscribe(),this.sorting&&this.sorting.complete()}buildSortParamsForm(t){return t.group({active:[this.defaultSorting(),[R.required]],isAscending:[!0,[R.required]],ppaJobId:[],rhythmJobId:[]})}buildMainForm(t,e){return t}defaultSorting(){return"NR"}shortUUID(t){return Zt(t)}toLocalDateTime(t){return Kt.deserialize(t).date}friendlyRhythmMethod(t){return t==="BD2JTK"?"JTK":t==="BD2EJTK"?"eJTK":t}static{this.\u0275fac=function(e){return new(e||i)(C(z),C(le,8))}}static{this.\u0275cmp=_({type:i,selectors:[["bd2-tssort-params-rform"]],inputs:{rhythmJobs:"rhythmJobs",ppaJobs:"ppaJobs"},outputs:{sorting:"sorting"},standalone:!1,decls:42,vars:10,consts:[[1,"container"],["role","form",3,"formGroup"],["aria-label","Sorting options","formControlName","active"],[1,"row","mb-1"],[1,"col-lg-2"],[1,"col-lg-4"],["formControlName","isAscending"],[1,"col-lg-5"],["value","NR"],["value","LABEL"],["id","ppa","aria-label","Select period analysis","formControlName","ppaJobId",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["value","PERIOD",3,"disabled"],["value","PHASE",3,"disabled"],["value","AMP",3,"disabled"],["value","ERR",3,"disabled"],["id","rhythm","aria-label","Select rhythmicity test","formControlName","rhythmJobId",1,"form-control"],["value","R_TAU",3,"disabled"],["value","R_PEAK",3,"disabled"],["value","R_PERIOD",3,"disabled"],[3,"value"]],template:function(e,r){e&1&&(m(0,"div",0)(1,"form",1)(2,"mat-radio-group",2)(3,"div",3)(4,"label",4),p(5,"Sort"),c(),m(6,"div",5)(7,"mat-slide-toggle",6),p(8,"asc."),c()(),m(9,"div",7)(10,"mat-radio-button",8),p(11,"nr."),c(),m(12,"mat-radio-button",9),p(13,"label"),c()()(),m(14,"div",3)(15,"label",4),p(16,"PPA Analysis"),c(),m(17,"div",5)(18,"select",10),P(19,xe,3,6,"option",11),c()(),m(20,"div",7)(21,"mat-radio-button",12),p(22,"period"),c(),m(23,"mat-radio-button",13),p(24,"phase"),c(),m(25,"mat-radio-button",14),p(26,"amp."),c(),m(27,"mat-radio-button",15),p(28,"err"),c()()(),m(29,"div",3)(30,"label",4),p(31,"Rhythmicity Test"),c(),m(32,"div",5)(33,"select",16),P(34,Ee,3,6,"option",11),c()(),m(35,"div",7)(36,"mat-radio-button",17),p(37,"signif."),c(),m(38,"mat-radio-button",18),p(39,"peak"),c(),m(40,"mat-radio-button",19),p(41,"length"),c()()()()()()),e&2&&(u(),d("formGroup",r.mainForm),u(18),d("ngForOf",r.ppaJobs),u(2),d("disabled",r.noPPA),u(2),d("disabled",r.noPPA),u(2),d("disabled",r.noPPA),u(2),d("disabled",r.noPPA),u(7),d("ngForOf",r.rhythmJobs),u(2),d("disabled",r.noRhythm),u(2),d("disabled",r.noRhythm),u(2),d("disabled",r.noRhythm))},dependencies:[B,Y,et,it,tt,Z,Q,W,X,Wt,Xt,rt,At],styles:["mat-radio-button[_ngcontent-%COMP%]{margin-right:.5em}"]})}}return i})();var $i=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=wt({type:i})}static{this.\u0275inj=vt({imports:[Ct,jt,qt,Yt,te]})}}return i})();var ut=(()=>{if(typeof self>"u")return!1;if(!("top"in self&&self!==top)){if("showOpenFilePicker"in self)return"showOpenFilePicker"}return!1})(),zi=ut?Promise.resolve().then(function(){return Me}):Promise.resolve().then(function(){return Ce});var Ji=ut?Promise.resolve().then(function(){return Oe}):Promise.resolve().then(function(){return ke});var De=ut?Promise.resolve().then(function(){return Ie}):Promise.resolve().then(function(){return Be});function ji(...i){return S(this,null,function*(){return(yield De).default(...i)})}var Fe=i=>S(void 0,null,function*(){let a=yield i.getFile();return a.handle=i,a}),Re=(...a)=>S(void 0,[...a],function*(i=[{}]){Array.isArray(i)||(i=[i]);let t=[];i.forEach((n,s)=>{t[s]={description:n.description||"Files",accept:{}},n.mimeTypes?n.mimeTypes.map(o=>{t[s].accept[o]=n.extensions||[]}):t[s].accept["*/*"]=n.extensions||[]});let e=yield window.showOpenFilePicker({id:i[0].id,startIn:i[0].startIn,types:t,multiple:i[0].multiple||!1,excludeAcceptAllOption:i[0].excludeAcceptAllOption||!1}),r=yield Promise.all(e.map(Fe));return i[0].multiple?r:r[0]}),Me={__proto__:null,default:Re};function st(i){function a(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then(function(r){return{value:r,done:e}})}return st=function(t){this.s=t,this.n=t.next},st.prototype={s:null,n:null,next:function(){return a(this.n.apply(this.s,arguments))},return:function(t){var e=this.s.return;return e===void 0?Promise.resolve({value:t,done:!0}):a(e.apply(this.s,arguments))},throw:function(t){var e=this.s.return;return e===void 0?Promise.reject(t):a(e.apply(this.s,arguments))}},new st(i)}var me=(r,n,...s)=>S(void 0,[r,n,...s],function*(i,a,t=i.name,e){let o=[],l=[];var h,y=!1,f=!1;try{for(var T,N=function(g){var D,w,k,ce=2;for(typeof Symbol<"u"&&(w=Symbol.asyncIterator,k=Symbol.iterator);ce--;){if(w&&(D=g[w])!=null)return D.call(g);if(k&&(D=g[k])!=null)return new st(D.call(g));w="@@asyncIterator",k="@@iterator"}throw new TypeError("Object is not async iterable")}(i.values());y=!(T=yield N.next()).done;y=!1){let g=T.value,D=`${t}/${g.name}`;g.kind==="file"?l.push(g.getFile().then(w=>(w.directoryHandle=i,w.handle=g,Object.defineProperty(w,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>D})))):g.kind!=="directory"||!a||e&&e(g)||o.push(me(g,a,D,e))}}catch(g){f=!0,h=g}finally{try{y&&N.return!=null&&(yield N.return())}finally{if(f)throw h}}return[...(yield Promise.all(o)).flat(),...yield Promise.all(l)]}),_e=(...a)=>S(void 0,[...a],function*(i={}){i.recursive=i.recursive||!1,i.mode=i.mode||"read";let t=yield window.showDirectoryPicker({id:i.id,startIn:i.startIn,mode:i.mode});return me(t,i.recursive,void 0,i.skipDirectory)}),Oe={__proto__:null,default:_e},Ne=(n,...s)=>S(void 0,[n,...s],function*(i,a=[{}],t=null,e=!1,r=null){Array.isArray(a)||(a=[a]),a[0].fileName=a[0].fileName||"Untitled";let o=[],l=null;if(i instanceof Blob&&i.type?l=i.type:i.headers&&i.headers.get("content-type")&&(l=i.headers.get("content-type")),a.forEach((f,T)=>{o[T]={description:f.description||"Files",accept:{}},f.mimeTypes?(T===0&&l&&f.mimeTypes.push(l),f.mimeTypes.map(N=>{o[T].accept[N]=f.extensions||[]})):l?o[T].accept[l]=f.extensions||[]:o[T].accept["*/*"]=f.extensions||[]}),t)try{yield t.getFile()}catch(f){if(t=null,e)throw f}let h=t||(yield window.showSaveFilePicker({suggestedName:a[0].fileName,id:a[0].id,startIn:a[0].startIn,types:o,excludeAcceptAllOption:a[0].excludeAcceptAllOption||!1}));!t&&r&&r(h);let y=yield h.createWritable();return"stream"in i?(yield i.stream().pipeTo(y),h):"body"in i?(yield i.body.pipeTo(y),h):(yield y.write(yield i),yield y.close(),h)}),Ie={__proto__:null,default:Ne},Ae=(...a)=>S(void 0,[...a],function*(i=[{}]){return Array.isArray(i)||(i=[i]),new Promise((t,e)=>{let r=document.createElement("input");r.type="file";let n=[...i.map(h=>h.mimeTypes||[]),...i.map(h=>h.extensions||[])].join();r.multiple=i[0].multiple||!1,r.accept=n||"",r.style.display="none",document.body.append(r);let s=h=>{typeof o=="function"&&o(),t(h)},o=i[0].legacySetup&&i[0].legacySetup(s,()=>o(e),r),l=()=>{window.removeEventListener("focus",l),r.remove()};r.addEventListener("click",()=>{window.addEventListener("focus",l)}),r.addEventListener("change",()=>{window.removeEventListener("focus",l),r.remove(),s(r.multiple?Array.from(r.files):r.files[0])}),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})}),Ce={__proto__:null,default:Ae},Le=(...a)=>S(void 0,[...a],function*(i=[{}]){return Array.isArray(i)||(i=[i]),i[0].recursive=i[0].recursive||!1,new Promise((t,e)=>{let r=document.createElement("input");r.type="file",r.webkitdirectory=!0;let n=o=>{typeof s=="function"&&s(),t(o)},s=i[0].legacySetup&&i[0].legacySetup(n,()=>s(e),r);r.addEventListener("change",()=>{let o=Array.from(r.files);i[0].recursive?i[0].recursive&&i[0].skipDirectory&&(o=o.filter(l=>l.webkitRelativePath.split("/").every(h=>!i[0].skipDirectory({name:h,kind:"directory"})))):o=o.filter(l=>l.webkitRelativePath.split("/").length===2),n(o)}),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})}),ke={__proto__:null,default:Le},$e=(t,...e)=>S(void 0,[t,...e],function*(i,a={}){Array.isArray(a)&&(a=a[0]);let r=document.createElement("a"),n=i;"body"in i&&(n=yield function(l,h){return S(this,null,function*(){let y=l.getReader(),f=new ReadableStream({start:g=>function D(){return S(this,null,function*(){return y.read().then(({done:w,value:k})=>{if(!w)return g.enqueue(k),D();g.close()})})}()}),T=new Response(f),N=yield T.blob();return y.releaseLock(),new Blob([N],{type:h})})}(i.body,i.headers.get("content-type"))),r.download=a.fileName||"Untitled",r.href=URL.createObjectURL(yield n);let s=()=>{typeof o=="function"&&o()},o=a.legacySetup&&a.legacySetup(s,()=>o(),r);return r.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(r.href),3e4),s()}),r.click(),null}),Be={__proto__:null,default:$e};export{b as a,O as b,at as c,nt as d,v as e,E as f,le as g,ji as h,ee as i,qe as j,oe as k,oi as l,xi as m,$i as n};
